var e=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),t=`vercel.ai.error`,n=Symbol.for(t),r,i,a=class e extends (i=Error,r=n,i){constructor({name:e,message:t,cause:n}){super(t),this[r]=!0,this.name=e,this.cause=n}static isInstance(n){return e.hasMarker(n,t)}static hasMarker(e,t){let n=Symbol.for(t);return typeof e==`object`&&!!e&&n in e&&typeof e[n]==`boolean`&&e[n]===!0}},o=`AI_APICallError`,s=`vercel.ai.error.${o}`,c=Symbol.for(s),l,u,d=class extends (u=a,l=c,u){constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:i,responseBody:a,cause:s,isRetryable:c=r!=null&&(r===408||r===409||r===429||r>=500),data:u}){super({name:o,message:e,cause:s}),this[l]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=i,this.responseBody=a,this.isRetryable=c,this.data=u}static isInstance(e){return a.hasMarker(e,s)}},f=`AI_EmptyResponseBodyError`,p=`vercel.ai.error.${f}`,m=Symbol.for(p),h,g,_=class extends (g=a,h=m,g){constructor({message:e=`Empty response body`}={}){super({name:f,message:e}),this[h]=!0}static isInstance(e){return a.hasMarker(e,p)}};function v(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}var ee=`AI_InvalidArgumentError`,y=`vercel.ai.error.${ee}`,b=Symbol.for(y),te,x,S=class extends (x=a,te=b,x){constructor({message:e,cause:t,argument:n}){super({name:ee,message:e,cause:t}),this[te]=!0,this.argument=n}static isInstance(e){return a.hasMarker(e,y)}},ne=`AI_InvalidPromptError`,C=`vercel.ai.error.${ne}`,re=Symbol.for(C),w,ie,ae=class extends (ie=a,w=re,ie){constructor({prompt:e,message:t,cause:n}){super({name:ne,message:`Invalid prompt: ${t}`,cause:n}),this[w]=!0,this.prompt=e}static isInstance(e){return a.hasMarker(e,C)}},T=`AI_InvalidResponseDataError`,oe=`vercel.ai.error.${T}`,se=Symbol.for(oe),E,ce,le=class extends (ce=a,E=se,ce){constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:T,message:t}),this[E]=!0,this.data=e}static isInstance(e){return a.hasMarker(e,oe)}},ue=`AI_JSONParseError`,de=`vercel.ai.error.${ue}`,fe=Symbol.for(de),pe,me,he=class extends (me=a,pe=fe,me){constructor({text:e,cause:t}){super({name:ue,message:`JSON parsing failed: Text: ${e}.
Error message: ${v(t)}`,cause:t}),this[pe]=!0,this.text=e}static isInstance(e){return a.hasMarker(e,de)}},ge=`AI_LoadAPIKeyError`,_e=`vercel.ai.error.${ge}`,ve=Symbol.for(_e),ye,be,xe=class extends (be=a,ye=ve,be){constructor({message:e}){super({name:ge,message:e}),this[ye]=!0}static isInstance(e){return a.hasMarker(e,_e)}},Se=`AI_LoadSettingError`,Ce=`vercel.ai.error.${Se}`,we=Symbol.for(Ce),Te,Ee,De=class extends (Ee=a,Te=we,Ee){constructor({message:e}){super({name:Se,message:e}),this[Te]=!0}static isInstance(e){return a.hasMarker(e,Ce)}},Oe=`AI_NoContentGeneratedError`,ke=`vercel.ai.error.${Oe}`,Ae=Symbol.for(ke),je,Me,Ne=class extends (Me=a,je=Ae,Me){constructor({message:e=`No content generated.`}={}){super({name:Oe,message:e}),this[je]=!0}static isInstance(e){return a.hasMarker(e,ke)}},Pe=`AI_NoSuchModelError`,Fe=`vercel.ai.error.${Pe}`,Ie=Symbol.for(Fe),Le,Re,ze=class extends (Re=a,Le=Ie,Re){constructor({errorName:e=Pe,modelId:t,modelType:n,message:r=`No such ${n}: ${t}`}){super({name:e,message:r}),this[Le]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return a.hasMarker(e,Fe)}},Be=`AI_TooManyEmbeddingValuesForCallError`,Ve=`vercel.ai.error.${Be}`,He=Symbol.for(Ve),Ue,We,Ge=class extends (We=a,Ue=He,We){constructor(e){super({name:Be,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Ue]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return a.hasMarker(e,Ve)}},Ke=`AI_TypeValidationError`,qe=`vercel.ai.error.${Ke}`,Je=Symbol.for(qe),Ye,Xe,Ze=class e extends (Xe=a,Ye=Je,Xe){constructor({value:e,cause:t}){super({name:Ke,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${v(t)}`,cause:t}),this[Ye]=!0,this.value=e}static isInstance(e){return a.hasMarker(e,qe)}static wrap({value:t,cause:n}){return e.isInstance(n)&&n.value===t?n:new e({value:t,cause:n})}},Qe=`AI_UnsupportedFunctionalityError`,$e=`vercel.ai.error.${Qe}`,et=Symbol.for($e),tt,nt,rt=class extends (nt=a,tt=et,nt){constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Qe,message:t}),this[tt]=!0,this.functionality=e}static isInstance(e){return a.hasMarker(e,$e)}};function it(e){return e===null||typeof e==`string`||typeof e==`number`||typeof e==`boolean`?!0:Array.isArray(e)?e.every(it):typeof e==`object`?Object.entries(e).every(([e,t])=>typeof e==`string`&&(t===void 0||it(t))):!1}function at(e){return Array.isArray(e)&&e.every(it)}function ot(e){return typeof e==`object`&&!!e&&Object.entries(e).every(([e,t])=>typeof e==`string`&&(t===void 0||it(t)))}Object.freeze({status:`aborted`});function D(e,t,n){function r(n,r){if(n._zod||Object.defineProperty(n,`_zod`,{value:{def:r,constr:o,traits:new Set},enumerable:!1}),n._zod.traits.has(e))return;n._zod.traits.add(e),t(n,r);let i=o.prototype,a=Object.keys(i);for(let e=0;e<a.length;e++){let t=a[e];t in n||(n[t]=i[t].bind(n))}}let i=n?.Parent??Object;class a extends i{}Object.defineProperty(a,`name`,{value:e});function o(e){var t;let i=n?.Parent?new a:this;r(i,e),(t=i._zod).deferred??(t.deferred=[]);for(let e of i._zod.deferred)e();return i}return Object.defineProperty(o,`init`,{value:r}),Object.defineProperty(o,Symbol.hasInstance,{value:t=>n?.Parent&&t instanceof n.Parent?!0:t?._zod?.traits?.has(e)}),Object.defineProperty(o,`name`,{value:e}),o}var st=class extends Error{constructor(){super(`Encountered Promise during synchronous parse. Use .parseAsync() instead.`)}},ct=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name=`ZodEncodeError`}};const lt={};function ut(e){return e&&Object.assign(lt,e),lt}function dt(e){let t=Object.values(e).filter(e=>typeof e==`number`);return Object.entries(e).filter(([e,n])=>t.indexOf(+e)===-1).map(([e,t])=>t)}function ft(e,t){return typeof t==`bigint`?t.toString():t}function pt(e){return{get value(){{let t=e();return Object.defineProperty(this,`value`,{value:t}),t}throw Error(`cached value already set`)}}}function mt(e){return e==null}function ht(e){let t=e.startsWith(`^`)?1:0,n=e.endsWith(`$`)?e.length-1:e.length;return e.slice(t,n)}function gt(e,t){let n=(e.toString().split(`.`)[1]||``).length,r=t.toString(),i=(r.split(`.`)[1]||``).length;if(i===0&&/\d?e-\d?/.test(r)){let e=r.match(/\d?e-(\d?)/);e?.[1]&&(i=Number.parseInt(e[1]))}let a=n>i?n:i;return Number.parseInt(e.toFixed(a).replace(`.`,``))%Number.parseInt(t.toFixed(a).replace(`.`,``))/10**a}const _t=Symbol(`evaluating`);function O(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==_t)return r===void 0&&(r=_t,r=n()),r},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function vt(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function yt(...e){let t={};for(let n of e){let e=Object.getOwnPropertyDescriptors(n);Object.assign(t,e)}return Object.defineProperties({},t)}function bt(e){return JSON.stringify(e)}function xt(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,``).replace(/[\s_-]+/g,`-`).replace(/^-+|-+$/g,``)}const St=`captureStackTrace`in Error?Error.captureStackTrace:(...e)=>{};function Ct(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}const wt=pt(()=>{if(typeof navigator<`u`&&navigator?.userAgent?.includes(`Cloudflare`))return!1;try{return Function(``),!0}catch{return!1}});function Tt(e){if(Ct(e)===!1)return!1;let t=e.constructor;if(t===void 0||typeof t!=`function`)return!0;let n=t.prototype;return!(Ct(n)===!1||Object.prototype.hasOwnProperty.call(n,`isPrototypeOf`)===!1)}function Et(e){return Tt(e)?{...e}:Array.isArray(e)?[...e]:e}const Dt=new Set([`string`,`number`,`symbol`]);function Ot(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function kt(e,t,n){let r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}function k(e){let t=e;if(!t)return{};if(typeof t==`string`)return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error==`string`?{...t,error:()=>t.error}:t}function At(e){return Object.keys(e).filter(t=>e[t]._zod.optin===`optional`&&e[t]._zod.optout===`optional`)}const jt={safeint:[-(2**53-1),2**53-1],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Mt(e,t){let n=e._zod.def,r=n.checks;if(r&&r.length>0)throw Error(`.pick() cannot be used on object schemas containing refinements`);return kt(e,yt(e._zod.def,{get shape(){let e={};for(let r in t){if(!(r in n.shape))throw Error(`Unrecognized key: "${r}"`);t[r]&&(e[r]=n.shape[r])}return vt(this,`shape`,e),e},checks:[]}))}function Nt(e,t){let n=e._zod.def,r=n.checks;if(r&&r.length>0)throw Error(`.omit() cannot be used on object schemas containing refinements`);return kt(e,yt(e._zod.def,{get shape(){let r={...e._zod.def.shape};for(let e in t){if(!(e in n.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete r[e]}return vt(this,`shape`,r),r},checks:[]}))}function Pt(e,t){if(!Tt(t))throw Error(`Invalid input to extend: expected a plain object`);let n=e._zod.def.checks;if(n&&n.length>0){let n=e._zod.def.shape;for(let e in t)if(Object.getOwnPropertyDescriptor(n,e)!==void 0)throw Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}return kt(e,yt(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t};return vt(this,`shape`,n),n}}))}function Ft(e,t){if(!Tt(t))throw Error(`Invalid input to safeExtend: expected a plain object`);return kt(e,yt(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t};return vt(this,`shape`,n),n}}))}function It(e,t){return kt(e,yt(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t._zod.def.shape};return vt(this,`shape`,n),n},get catchall(){return t._zod.def.catchall},checks:[]}))}function Lt(e,t,n){let r=t._zod.def.checks;if(r&&r.length>0)throw Error(`.partial() cannot be used on object schemas containing refinements`);return kt(t,yt(t._zod.def,{get shape(){let r=t._zod.def.shape,i={...r};if(n)for(let t in n){if(!(t in r))throw Error(`Unrecognized key: "${t}"`);n[t]&&(i[t]=e?new e({type:`optional`,innerType:r[t]}):r[t])}else for(let t in r)i[t]=e?new e({type:`optional`,innerType:r[t]}):r[t];return vt(this,`shape`,i),i},checks:[]}))}function Rt(e,t,n){return kt(t,yt(t._zod.def,{get shape(){let r=t._zod.def.shape,i={...r};if(n)for(let t in n){if(!(t in i))throw Error(`Unrecognized key: "${t}"`);n[t]&&(i[t]=new e({type:`nonoptional`,innerType:r[t]}))}else for(let t in r)i[t]=new e({type:`nonoptional`,innerType:r[t]});return vt(this,`shape`,i),i}}))}function zt(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function Bt(e,t){return t.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(e),t})}function Vt(e){return typeof e==`string`?e:e?.message}function Ht(e,t,n){let r={...e,path:e.path??[]};return e.message||(r.message=Vt(e.inst?._zod.def?.error?.(e))??Vt(t?.error?.(e))??Vt(n.customError?.(e))??Vt(n.localeError?.(e))??`Invalid input`),delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function Ut(e){return Array.isArray(e)?`array`:typeof e==`string`?`string`:`unknown`}function Wt(...e){let[t,n,r]=e;return typeof t==`string`?{message:t,code:`custom`,input:n,inst:r}:{...t}}const Gt=(e,t)=>{e.name=`$ZodError`,Object.defineProperty(e,`_zod`,{value:e._zod,enumerable:!1}),Object.defineProperty(e,`issues`,{value:t,enumerable:!1}),e.message=JSON.stringify(t,ft,2),Object.defineProperty(e,`toString`,{value:()=>e.message,enumerable:!1})},Kt=D(`$ZodError`,Gt),qt=D(`$ZodError`,Gt,{Parent:Error});function Jt(e,t=e=>e.message){let n={},r=[];for(let i of e.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:n}}function Yt(e,t=e=>e.message){let n={_errors:[]},r=e=>{for(let i of e.issues)if(i.code===`invalid_union`&&i.errors.length)i.errors.map(e=>r({issues:e}));else if(i.code===`invalid_key`)r({issues:i.issues});else if(i.code===`invalid_element`)r({issues:i.issues});else if(i.path.length===0)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){let n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(e),n}const Xt=e=>(t,n,r,i)=>{let a=r?Object.assign(r,{async:!1}):{async:!1},o=t._zod.run({value:n,issues:[]},a);if(o instanceof Promise)throw new st;if(o.issues.length){let t=new(i?.Err??e)(o.issues.map(e=>Ht(e,a,ut())));throw St(t,i?.callee),t}return o.value},Zt=e=>async(t,n,r,i)=>{let a=r?Object.assign(r,{async:!0}):{async:!0},o=t._zod.run({value:n,issues:[]},a);if(o instanceof Promise&&(o=await o),o.issues.length){let t=new(i?.Err??e)(o.issues.map(e=>Ht(e,a,ut())));throw St(t,i?.callee),t}return o.value},Qt=e=>(t,n,r)=>{let i=r?{...r,async:!1}:{async:!1},a=t._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new st;return a.issues.length?{success:!1,error:new(e??Kt)(a.issues.map(e=>Ht(e,i,ut())))}:{success:!0,data:a.value}},$t=Qt(qt),en=e=>async(t,n,r)=>{let i=r?Object.assign(r,{async:!0}):{async:!0},a=t._zod.run({value:n,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(e=>Ht(e,i,ut())))}:{success:!0,data:a.value}},tn=en(qt),nn=e=>(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Xt(e)(t,n,i)},rn=e=>(t,n,r)=>Xt(e)(t,n,r),an=e=>async(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Zt(e)(t,n,i)},on=e=>async(t,n,r)=>Zt(e)(t,n,r),sn=e=>(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Qt(e)(t,n,i)},cn=e=>(t,n,r)=>Qt(e)(t,n,r),ln=e=>async(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return en(e)(t,n,i)},un=e=>async(t,n,r)=>en(e)(t,n,r),dn=/^[cC][^\s-]{8,}$/,fn=/^[0-9a-z]+$/,pn=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,mn=/^[0-9a-vA-V]{20}$/,hn=/^[A-Za-z0-9]{27}$/,gn=/^[a-zA-Z0-9_-]{21}$/,_n=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,vn=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,yn=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,bn=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function xn(){return RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`)}const Sn=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Cn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,wn=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Tn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,En=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Dn=/^[A-Za-z0-9_-]*$/,On=/^\+[1-9]\d{6,14}$/,kn=`(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))`,An=RegExp(`^${kn}$`);function jn(e){let t=`(?:[01]\\d|2[0-3]):[0-5]\\d`;return typeof e.precision==`number`?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Mn(e){return RegExp(`^${jn(e)}$`)}function Nn(e){let t=jn({precision:e.precision}),n=[`Z`];e.local&&n.push(``),e.offset&&n.push(`([+-](?:[01]\\d|2[0-3]):[0-5]\\d)`);let r=`${t}(?:${n.join(`|`)})`;return RegExp(`^${kn}T(?:${r})$`)}const Pn=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??``}}`:`[\\s\\S]*`;return RegExp(`^${t}$`)},Fn=/^-?\d+$/,In=/^-?\d+(?:\.\d+)?$/,Ln=/^(?:true|false)$/i,Rn=/^null$/i,zn=/^[^A-Z]*$/,Bn=/^[^a-z]*$/,Vn=D(`$ZodCheck`,(e,t)=>{var n;e._zod??={},e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Hn={number:`number`,bigint:`bigint`,object:`date`},Un=D(`$ZodCheckLessThan`,(e,t)=>{Vn.init(e,t);let n=Hn[typeof t.value];e._zod.onattach.push(e=>{let n=e._zod.bag,r=(t.inclusive?n.maximum:n.exclusiveMaximum)??1/0;t.value<r&&(t.inclusive?n.maximum=t.value:n.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:`too_big`,maximum:typeof t.value==`object`?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Wn=D(`$ZodCheckGreaterThan`,(e,t)=>{Vn.init(e,t);let n=Hn[typeof t.value];e._zod.onattach.push(e=>{let n=e._zod.bag,r=(t.inclusive?n.minimum:n.exclusiveMinimum)??-1/0;t.value>r&&(t.inclusive?n.minimum=t.value:n.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:`too_small`,minimum:typeof t.value==`object`?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Gn=D(`$ZodCheckMultipleOf`,(e,t)=>{Vn.init(e,t),e._zod.onattach.push(e=>{var n;(n=e._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw Error(`Cannot mix number and bigint in multiple_of check.`);(typeof n.value==`bigint`?n.value%t.value===BigInt(0):gt(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:`not_multiple_of`,divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Kn=D(`$ZodCheckNumberFormat`,(e,t)=>{Vn.init(e,t),t.format=t.format||`float64`;let n=t.format?.includes(`int`),r=n?`int`:`number`,[i,a]=jt[t.format];e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,r.minimum=i,r.maximum=a,n&&(r.pattern=Fn)}),e._zod.check=o=>{let s=o.value;if(n){if(!Number.isInteger(s)){o.issues.push({expected:r,format:t.format,code:`invalid_type`,continue:!1,input:s,inst:e});return}if(!Number.isSafeInteger(s)){s>0?o.issues.push({input:s,code:`too_big`,maximum:2**53-1,note:`Integers must be within the safe integer range.`,inst:e,origin:r,inclusive:!0,continue:!t.abort}):o.issues.push({input:s,code:`too_small`,minimum:-(2**53-1),note:`Integers must be within the safe integer range.`,inst:e,origin:r,inclusive:!0,continue:!t.abort});return}}s<i&&o.issues.push({origin:`number`,input:s,code:`too_small`,minimum:i,inclusive:!0,inst:e,continue:!t.abort}),s>a&&o.issues.push({origin:`number`,input:s,code:`too_big`,maximum:a,inclusive:!0,inst:e,continue:!t.abort})}}),qn=D(`$ZodCheckMaxLength`,(e,t)=>{var n;Vn.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!mt(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag.maximum??1/0;t.maximum<n&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{let r=n.value;if(r.length<=t.maximum)return;let i=Ut(r);n.issues.push({origin:i,code:`too_big`,maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Jn=D(`$ZodCheckMinLength`,(e,t)=>{var n;Vn.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!mt(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag.minimum??-1/0;t.minimum>n&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{let r=n.value;if(r.length>=t.minimum)return;let i=Ut(r);n.issues.push({origin:i,code:`too_small`,minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Yn=D(`$ZodCheckLengthEquals`,(e,t)=>{var n;Vn.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!mt(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag;n.minimum=t.length,n.maximum=t.length,n.length=t.length}),e._zod.check=n=>{let r=n.value,i=r.length;if(i===t.length)return;let a=Ut(r),o=i>t.length;n.issues.push({origin:a,...o?{code:`too_big`,maximum:t.length}:{code:`too_small`,minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Xn=D(`$ZodCheckStringFormat`,(e,t)=>{var n,r;Vn.init(e,t),e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,t.pattern&&(n.patterns??=new Set,n.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:`string`,code:`invalid_format`,format:t.format,input:n.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),Zn=D(`$ZodCheckRegex`,(e,t)=>{Xn.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:`string`,code:`invalid_format`,format:`regex`,input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Qn=D(`$ZodCheckLowerCase`,(e,t)=>{t.pattern??=zn,Xn.init(e,t)}),$n=D(`$ZodCheckUpperCase`,(e,t)=>{t.pattern??=Bn,Xn.init(e,t)}),er=D(`$ZodCheckIncludes`,(e,t)=>{Vn.init(e,t);let n=Ot(t.includes),r=new RegExp(typeof t.position==`number`?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(r)}),e._zod.check=n=>{n.value.includes(t.includes,t.position)||n.issues.push({origin:`string`,code:`invalid_format`,format:`includes`,includes:t.includes,input:n.value,inst:e,continue:!t.abort})}}),tr=D(`$ZodCheckStartsWith`,(e,t)=>{Vn.init(e,t);let n=RegExp(`^${Ot(t.prefix)}.*`);t.pattern??=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(n)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:`string`,code:`invalid_format`,format:`starts_with`,prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),nr=D(`$ZodCheckEndsWith`,(e,t)=>{Vn.init(e,t);let n=RegExp(`.*${Ot(t.suffix)}$`);t.pattern??=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(n)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:`string`,code:`invalid_format`,format:`ends_with`,suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),rr=D(`$ZodCheckOverwrite`,(e,t)=>{Vn.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});var ir=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),--this.indent}write(e){if(typeof e==`function`){e(this,{execution:`sync`}),e(this,{execution:`async`});return}let t=e.split(`
`).filter(e=>e),n=Math.min(...t.map(e=>e.length-e.trimStart().length)),r=t.map(e=>e.slice(n)).map(e=>` `.repeat(this.indent*2)+e);for(let e of r)this.content.push(e)}compile(){let e=Function,t=this?.args,n=[...(this?.content??[``]).map(e=>`  ${e}`)];return new e(...t,n.join(`
`))}};const ar={major:4,minor:3,patch:5},or=D(`$ZodType`,(e,t)=>{var n;e??={},e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=ar;let r=[...e._zod.def.checks??[]];e._zod.traits.has(`$ZodCheck`)&&r.unshift(e);for(let t of r)for(let n of t._zod.onattach)n(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,n)=>{let r=zt(e),i;for(let a of t){if(a._zod.def.when){if(!a._zod.def.when(e))continue}else if(r)continue;let t=e.issues.length,o=a._zod.check(e);if(o instanceof Promise&&n?.async===!1)throw new st;if(i||o instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await o,e.issues.length!==t&&(r||=zt(e,t))});else{if(e.issues.length===t)continue;r||=zt(e,t)}}return i?i.then(()=>e):e},n=(n,i,a)=>{if(zt(n))return n.aborted=!0,n;let o=t(i,r,a);if(o instanceof Promise){if(a.async===!1)throw new st;return o.then(t=>e._zod.parse(t,a))}return e._zod.parse(o,a)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction===`backward`){let t=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return t instanceof Promise?t.then(e=>n(e,i,a)):n(t,i,a)}let o=e._zod.parse(i,a);if(o instanceof Promise){if(a.async===!1)throw new st;return o.then(e=>t(e,r,a))}return t(o,r,a)}}O(e,`~standard`,()=>({validate:t=>{try{let n=$t(e,t);return n.success?{value:n.data}:{issues:n.error?.issues}}catch{return tn(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:`zod`,version:1}))}),sr=D(`$ZodString`,(e,t)=>{or.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Pn(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value==`string`||n.issues.push({expected:`string`,code:`invalid_type`,input:n.value,inst:e}),n}}),cr=D(`$ZodStringFormat`,(e,t)=>{Xn.init(e,t),sr.init(e,t)}),lr=D(`$ZodGUID`,(e,t)=>{t.pattern??=vn,cr.init(e,t)}),ur=D(`$ZodUUID`,(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(e===void 0)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??=yn(e)}else t.pattern??=yn();cr.init(e,t)}),dr=D(`$ZodEmail`,(e,t)=>{t.pattern??=bn,cr.init(e,t)}),fr=D(`$ZodURL`,(e,t)=>{cr.init(e,t),e._zod.check=n=>{try{let r=n.value.trim(),i=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||n.issues.push({code:`invalid_format`,format:`url`,note:`Invalid hostname`,pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(`:`)?i.protocol.slice(0,-1):i.protocol)||n.issues.push({code:`invalid_format`,format:`url`,note:`Invalid protocol`,pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=i.href:n.value=r;return}catch{n.issues.push({code:`invalid_format`,format:`url`,input:n.value,inst:e,continue:!t.abort})}}}),pr=D(`$ZodEmoji`,(e,t)=>{t.pattern??=xn(),cr.init(e,t)}),mr=D(`$ZodNanoID`,(e,t)=>{t.pattern??=gn,cr.init(e,t)}),hr=D(`$ZodCUID`,(e,t)=>{t.pattern??=dn,cr.init(e,t)}),gr=D(`$ZodCUID2`,(e,t)=>{t.pattern??=fn,cr.init(e,t)}),_r=D(`$ZodULID`,(e,t)=>{t.pattern??=pn,cr.init(e,t)}),vr=D(`$ZodXID`,(e,t)=>{t.pattern??=mn,cr.init(e,t)}),yr=D(`$ZodKSUID`,(e,t)=>{t.pattern??=hn,cr.init(e,t)}),br=D(`$ZodISODateTime`,(e,t)=>{t.pattern??=Nn(t),cr.init(e,t)}),xr=D(`$ZodISODate`,(e,t)=>{t.pattern??=An,cr.init(e,t)}),Sr=D(`$ZodISOTime`,(e,t)=>{t.pattern??=Mn(t),cr.init(e,t)}),Cr=D(`$ZodISODuration`,(e,t)=>{t.pattern??=_n,cr.init(e,t)}),wr=D(`$ZodIPv4`,(e,t)=>{t.pattern??=Sn,cr.init(e,t),e._zod.bag.format=`ipv4`}),Tr=D(`$ZodIPv6`,(e,t)=>{t.pattern??=Cn,cr.init(e,t),e._zod.bag.format=`ipv6`,e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:`invalid_format`,format:`ipv6`,input:n.value,inst:e,continue:!t.abort})}}}),Er=D(`$ZodCIDRv4`,(e,t)=>{t.pattern??=wn,cr.init(e,t)}),Dr=D(`$ZodCIDRv6`,(e,t)=>{t.pattern??=Tn,cr.init(e,t),e._zod.check=n=>{let r=n.value.split(`/`);try{if(r.length!==2)throw Error();let[e,t]=r;if(!t)throw Error();let n=Number(t);if(`${n}`!==t||n<0||n>128)throw Error();new URL(`http://[${e}]`)}catch{n.issues.push({code:`invalid_format`,format:`cidrv6`,input:n.value,inst:e,continue:!t.abort})}}});function Or(e){if(e===``)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const kr=D(`$ZodBase64`,(e,t)=>{t.pattern??=En,cr.init(e,t),e._zod.bag.contentEncoding=`base64`,e._zod.check=n=>{Or(n.value)||n.issues.push({code:`invalid_format`,format:`base64`,input:n.value,inst:e,continue:!t.abort})}});function Ar(e){if(!Dn.test(e))return!1;let t=e.replace(/[-_]/g,e=>e===`-`?`+`:`/`);return Or(t.padEnd(Math.ceil(t.length/4)*4,`=`))}const jr=D(`$ZodBase64URL`,(e,t)=>{t.pattern??=Dn,cr.init(e,t),e._zod.bag.contentEncoding=`base64url`,e._zod.check=n=>{Ar(n.value)||n.issues.push({code:`invalid_format`,format:`base64url`,input:n.value,inst:e,continue:!t.abort})}}),Mr=D(`$ZodE164`,(e,t)=>{t.pattern??=On,cr.init(e,t)});function Nr(e,t=null){try{let n=e.split(`.`);if(n.length!==3)return!1;let[r]=n;if(!r)return!1;let i=JSON.parse(atob(r));return!(`typ`in i&&i?.typ!==`JWT`||!i.alg||t&&(!(`alg`in i)||i.alg!==t))}catch{return!1}}const Pr=D(`$ZodJWT`,(e,t)=>{cr.init(e,t),e._zod.check=n=>{Nr(n.value,t.alg)||n.issues.push({code:`invalid_format`,format:`jwt`,input:n.value,inst:e,continue:!t.abort})}}),Fr=D(`$ZodNumber`,(e,t)=>{or.init(e,t),e._zod.pattern=e._zod.bag.pattern??In,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}let i=n.value;if(typeof i==`number`&&!Number.isNaN(i)&&Number.isFinite(i))return n;let a=typeof i==`number`?Number.isNaN(i)?`NaN`:Number.isFinite(i)?void 0:`Infinity`:void 0;return n.issues.push({expected:`number`,code:`invalid_type`,input:i,inst:e,...a?{received:a}:{}}),n}}),Ir=D(`$ZodNumberFormat`,(e,t)=>{Kn.init(e,t),Fr.init(e,t)}),Lr=D(`$ZodBoolean`,(e,t)=>{or.init(e,t),e._zod.pattern=Ln,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}let i=n.value;return typeof i==`boolean`||n.issues.push({expected:`boolean`,code:`invalid_type`,input:i,inst:e}),n}}),Rr=D(`$ZodNull`,(e,t)=>{or.init(e,t),e._zod.pattern=Rn,e._zod.values=new Set([null]),e._zod.parse=(t,n)=>{let r=t.value;return r===null||t.issues.push({expected:`null`,code:`invalid_type`,input:r,inst:e}),t}}),zr=D(`$ZodAny`,(e,t)=>{or.init(e,t),e._zod.parse=e=>e}),Br=D(`$ZodUnknown`,(e,t)=>{or.init(e,t),e._zod.parse=e=>e}),Vr=D(`$ZodNever`,(e,t)=>{or.init(e,t),e._zod.parse=(t,n)=>(t.issues.push({expected:`never`,code:`invalid_type`,input:t.value,inst:e}),t)});function Hr(e,t,n){e.issues.length&&t.issues.push(...Bt(n,e.issues)),t.value[n]=e.value}const Ur=D(`$ZodArray`,(e,t)=>{or.init(e,t),e._zod.parse=(n,r)=>{let i=n.value;if(!Array.isArray(i))return n.issues.push({expected:`array`,code:`invalid_type`,input:i,inst:e}),n;n.value=Array(i.length);let a=[];for(let e=0;e<i.length;e++){let o=i[e],s=t.element._zod.run({value:o,issues:[]},r);s instanceof Promise?a.push(s.then(t=>Hr(t,n,e))):Hr(s,n,e)}return a.length?Promise.all(a).then(()=>n):n}});function Wr(e,t,n,r,i){if(e.issues.length){if(i&&!(n in r))return;t.issues.push(...Bt(n,e.issues))}e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function Gr(e){let t=Object.keys(e.shape);for(let n of t)if(!e.shape?.[n]?._zod?.traits?.has(`$ZodType`))throw Error(`Invalid element at key "${n}": expected a Zod schema`);let n=At(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function Kr(e,t,n,r,i,a){let o=[],s=i.keySet,c=i.catchall._zod,l=c.def.type,u=c.optout===`optional`;for(let i in t){if(s.has(i))continue;if(l===`never`){o.push(i);continue}let a=c.run({value:t[i],issues:[]},r);a instanceof Promise?e.push(a.then(e=>Wr(e,n,i,t,u))):Wr(a,n,i,t,u)}return o.length&&n.issues.push({code:`unrecognized_keys`,keys:o,input:t,inst:a}),e.length?Promise.all(e).then(()=>n):n}const qr=D(`$ZodObject`,(e,t)=>{if(or.init(e,t),!Object.getOwnPropertyDescriptor(t,`shape`)?.get){let e=t.shape;Object.defineProperty(t,`shape`,{get:()=>{let n={...e};return Object.defineProperty(t,`shape`,{value:n}),n}})}let n=pt(()=>Gr(t));O(e._zod,`propValues`,()=>{let e=t.shape,n={};for(let t in e){let r=e[t]._zod;if(r.values){n[t]??(n[t]=new Set);for(let e of r.values)n[t].add(e)}}return n});let r=Ct,i=t.catchall,a;e._zod.parse=(t,o)=>{a??=n.value;let s=t.value;if(!r(s))return t.issues.push({expected:`object`,code:`invalid_type`,input:s,inst:e}),t;t.value={};let c=[],l=a.shape;for(let e of a.keys){let n=l[e],r=n._zod.optout===`optional`,i=n._zod.run({value:s[e],issues:[]},o);i instanceof Promise?c.push(i.then(n=>Wr(n,t,e,s,r))):Wr(i,t,e,s,r)}return i?Kr(c,s,t,o,n.value,e):c.length?Promise.all(c).then(()=>t):t}}),Jr=D(`$ZodObjectJIT`,(e,t)=>{qr.init(e,t);let n=e._zod.parse,r=pt(()=>Gr(t)),i=e=>{let t=new ir([`shape`,`payload`,`ctx`]),n=r.value,i=e=>{let t=bt(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write(`const input = payload.value;`);let a=Object.create(null),o=0;for(let e of n.keys)a[e]=`key_${o++}`;t.write(`const newResult = {};`);for(let r of n.keys){let n=a[r],o=bt(r),s=e[r]?._zod?.optout===`optional`;t.write(`const ${n} = ${i(r)};`),s?t.write(`
        if (${n}.issues.length) {
          if (${o} in input) {
            payload.issues = payload.issues.concat(${n}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${o}, ...iss.path] : [${o}]
            })));
          }
        }
        
        if (${n}.value === undefined) {
          if (${o} in input) {
            newResult[${o}] = undefined;
          }
        } else {
          newResult[${o}] = ${n}.value;
        }
        
      `):t.write(`
        if (${n}.issues.length) {
          payload.issues = payload.issues.concat(${n}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${o}, ...iss.path] : [${o}]
          })));
        }
        
        if (${n}.value === undefined) {
          if (${o} in input) {
            newResult[${o}] = undefined;
          }
        } else {
          newResult[${o}] = ${n}.value;
        }
        
      `)}t.write(`payload.value = newResult;`),t.write(`return payload;`);let s=t.compile();return(t,n)=>s(e,t,n)},a,o=Ct,s=!lt.jitless,c=s&&wt.value,l=t.catchall,u;e._zod.parse=(d,f)=>{u??=r.value;let p=d.value;return o(p)?s&&c&&f?.async===!1&&f.jitless!==!0?(a||=i(t.shape),d=a(d,f),l?Kr([],p,d,f,u,e):d):n(d,f):(d.issues.push({expected:`object`,code:`invalid_type`,input:p,inst:e}),d)}});function Yr(e,t,n,r){for(let n of e)if(n.issues.length===0)return t.value=n.value,t;let i=e.filter(e=>!zt(e));return i.length===1?(t.value=i[0].value,i[0]):(t.issues.push({code:`invalid_union`,input:t.value,inst:n,errors:e.map(e=>e.issues.map(e=>Ht(e,r,ut())))}),t)}const Xr=D(`$ZodUnion`,(e,t)=>{or.init(e,t),O(e._zod,`optin`,()=>t.options.some(e=>e._zod.optin===`optional`)?`optional`:void 0),O(e._zod,`optout`,()=>t.options.some(e=>e._zod.optout===`optional`)?`optional`:void 0),O(e._zod,`values`,()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),O(e._zod,`pattern`,()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>ht(e.source)).join(`|`)})$`)}});let n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(i,a)=>{if(n)return r(i,a);let o=!1,s=[];for(let e of t.options){let t=e._zod.run({value:i.value,issues:[]},a);if(t instanceof Promise)s.push(t),o=!0;else{if(t.issues.length===0)return t;s.push(t)}}return o?Promise.all(s).then(t=>Yr(t,i,e,a)):Yr(s,i,e,a)}}),Zr=D(`$ZodDiscriminatedUnion`,(e,t)=>{t.inclusive=!1,Xr.init(e,t);let n=e._zod.parse;O(e._zod,`propValues`,()=>{let e={};for(let n of t.options){let r=n._zod.propValues;if(!r||Object.keys(r).length===0)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(n)}"`);for(let[t,n]of Object.entries(r)){e[t]||(e[t]=new Set);for(let r of n)e[t].add(r)}}return e});let r=pt(()=>{let e=t.options,n=new Map;for(let r of e){let e=r._zod.propValues?.[t.discriminator];if(!e||e.size===0)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(let t of e){if(n.has(t))throw Error(`Duplicate discriminator value "${String(t)}"`);n.set(t,r)}}return n});e._zod.parse=(i,a)=>{let o=i.value;if(!Ct(o))return i.issues.push({code:`invalid_type`,expected:`object`,input:o,inst:e}),i;let s=r.value.get(o?.[t.discriminator]);return s?s._zod.run(i,a):t.unionFallback?n(i,a):(i.issues.push({code:`invalid_union`,errors:[],note:`No matching discriminator`,discriminator:t.discriminator,input:o,path:[t.discriminator],inst:e}),i)}}),Qr=D(`$ZodIntersection`,(e,t)=>{or.init(e,t),e._zod.parse=(e,n)=>{let r=e.value,i=t.left._zod.run({value:r,issues:[]},n),a=t.right._zod.run({value:r,issues:[]},n);return i instanceof Promise||a instanceof Promise?Promise.all([i,a]).then(([t,n])=>ei(e,t,n)):ei(e,i,a)}});function $r(e,t){if(e===t||e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Tt(e)&&Tt(t)){let n=Object.keys(t),r=Object.keys(e).filter(e=>n.indexOf(e)!==-1),i={...e,...t};for(let n of r){let r=$r(e[n],t[n]);if(!r.valid)return{valid:!1,mergeErrorPath:[n,...r.mergeErrorPath]};i[n]=r.data}return{valid:!0,data:i}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};let n=[];for(let r=0;r<e.length;r++){let i=e[r],a=t[r],o=$r(i,a);if(!o.valid)return{valid:!1,mergeErrorPath:[r,...o.mergeErrorPath]};n.push(o.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function ei(e,t,n){let r=new Map,i;for(let n of t.issues)if(n.code===`unrecognized_keys`){i??=n;for(let e of n.keys)r.has(e)||r.set(e,{}),r.get(e).l=!0}else e.issues.push(n);for(let t of n.issues)if(t.code===`unrecognized_keys`)for(let e of t.keys)r.has(e)||r.set(e,{}),r.get(e).r=!0;else e.issues.push(t);let a=[...r].filter(([,e])=>e.l&&e.r).map(([e])=>e);if(a.length&&i&&e.issues.push({...i,keys:a}),zt(e))return e;let o=$r(t.value,n.value);if(!o.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const ti=D(`$ZodTuple`,(e,t)=>{or.init(e,t);let n=t.items;e._zod.parse=(r,i)=>{let a=r.value;if(!Array.isArray(a))return r.issues.push({input:a,inst:e,expected:`tuple`,code:`invalid_type`}),r;r.value=[];let o=[],s=[...n].reverse().findIndex(e=>e._zod.optin!==`optional`),c=s===-1?0:n.length-s;if(!t.rest){let t=a.length>n.length,i=a.length<c-1;if(t||i)return r.issues.push({...t?{code:`too_big`,maximum:n.length,inclusive:!0}:{code:`too_small`,minimum:n.length},input:a,inst:e,origin:`array`}),r}let l=-1;for(let e of n){if(l++,l>=a.length&&l>=c)continue;let t=e._zod.run({value:a[l],issues:[]},i);t instanceof Promise?o.push(t.then(e=>ni(e,r,l))):ni(t,r,l)}if(t.rest){let e=a.slice(n.length);for(let n of e){l++;let e=t.rest._zod.run({value:n,issues:[]},i);e instanceof Promise?o.push(e.then(e=>ni(e,r,l))):ni(e,r,l)}}return o.length?Promise.all(o).then(()=>r):r}});function ni(e,t,n){e.issues.length&&t.issues.push(...Bt(n,e.issues)),t.value[n]=e.value}const ri=D(`$ZodRecord`,(e,t)=>{or.init(e,t),e._zod.parse=(n,r)=>{let i=n.value;if(!Tt(i))return n.issues.push({expected:`record`,code:`invalid_type`,input:i,inst:e}),n;let a=[],o=t.keyType._zod.values;if(o){n.value={};let s=new Set;for(let e of o)if(typeof e==`string`||typeof e==`number`||typeof e==`symbol`){s.add(typeof e==`number`?e.toString():e);let o=t.valueType._zod.run({value:i[e],issues:[]},r);o instanceof Promise?a.push(o.then(t=>{t.issues.length&&n.issues.push(...Bt(e,t.issues)),n.value[e]=t.value})):(o.issues.length&&n.issues.push(...Bt(e,o.issues)),n.value[e]=o.value)}let c;for(let e in i)s.has(e)||(c??=[],c.push(e));c&&c.length>0&&n.issues.push({code:`unrecognized_keys`,input:i,inst:e,keys:c})}else{n.value={};for(let o of Reflect.ownKeys(i)){if(o===`__proto__`)continue;let s=t.keyType._zod.run({value:o,issues:[]},r);if(s instanceof Promise)throw Error(`Async schemas not supported in object keys currently`);if(typeof o==`string`&&In.test(o)&&s.issues.length&&s.issues.some(e=>e.code===`invalid_type`&&e.expected===`number`)){let e=t.keyType._zod.run({value:Number(o),issues:[]},r);if(e instanceof Promise)throw Error(`Async schemas not supported in object keys currently`);e.issues.length===0&&(s=e)}if(s.issues.length){t.mode===`loose`?n.value[o]=i[o]:n.issues.push({code:`invalid_key`,origin:`record`,issues:s.issues.map(e=>Ht(e,r,ut())),input:o,path:[o],inst:e});continue}let c=t.valueType._zod.run({value:i[o],issues:[]},r);c instanceof Promise?a.push(c.then(e=>{e.issues.length&&n.issues.push(...Bt(o,e.issues)),n.value[s.value]=e.value})):(c.issues.length&&n.issues.push(...Bt(o,c.issues)),n.value[s.value]=c.value)}}return a.length?Promise.all(a).then(()=>n):n}}),ii=D(`$ZodEnum`,(e,t)=>{or.init(e,t);let n=dt(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=RegExp(`^(${n.filter(e=>Dt.has(typeof e)).map(e=>typeof e==`string`?Ot(e):e.toString()).join(`|`)})$`),e._zod.parse=(t,i)=>{let a=t.value;return r.has(a)||t.issues.push({code:`invalid_value`,values:n,input:a,inst:e}),t}}),ai=D(`$ZodLiteral`,(e,t)=>{if(or.init(e,t),t.values.length===0)throw Error(`Cannot create literal schema with no valid values`);let n=new Set(t.values);e._zod.values=n,e._zod.pattern=RegExp(`^(${t.values.map(e=>typeof e==`string`?Ot(e):e?Ot(e.toString()):String(e)).join(`|`)})$`),e._zod.parse=(r,i)=>{let a=r.value;return n.has(a)||r.issues.push({code:`invalid_value`,values:t.values,input:a,inst:e}),r}}),oi=D(`$ZodTransform`,(e,t)=>{or.init(e,t),e._zod.parse=(n,r)=>{if(r.direction===`backward`)throw new ct(e.constructor.name);let i=t.transform(n.value,n);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(e=>(n.value=e,n));if(i instanceof Promise)throw new st;return n.value=i,n}});function si(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const ci=D(`$ZodOptional`,(e,t)=>{or.init(e,t),e._zod.optin=`optional`,e._zod.optout=`optional`,O(e._zod,`values`,()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),O(e._zod,`pattern`,()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${ht(e.source)})?$`):void 0}),e._zod.parse=(e,n)=>{if(t.innerType._zod.optin===`optional`){let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(t=>si(t,e.value)):si(r,e.value)}return e.value===void 0?e:t.innerType._zod.run(e,n)}}),li=D(`$ZodExactOptional`,(e,t)=>{ci.init(e,t),O(e._zod,`values`,()=>t.innerType._zod.values),O(e._zod,`pattern`,()=>t.innerType._zod.pattern),e._zod.parse=(e,n)=>t.innerType._zod.run(e,n)}),ui=D(`$ZodNullable`,(e,t)=>{or.init(e,t),O(e._zod,`optin`,()=>t.innerType._zod.optin),O(e._zod,`optout`,()=>t.innerType._zod.optout),O(e._zod,`pattern`,()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${ht(e.source)}|null)$`):void 0}),O(e._zod,`values`,()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,n)=>e.value===null?e:t.innerType._zod.run(e,n)}),di=D(`$ZodDefault`,(e,t)=>{or.init(e,t),e._zod.optin=`optional`,O(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);if(e.value===void 0)return e.value=t.defaultValue,e;let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(e=>fi(e,t)):fi(r,t)}});function fi(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const pi=D(`$ZodPrefault`,(e,t)=>{or.init(e,t),e._zod.optin=`optional`,O(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>(n.direction===`backward`||e.value===void 0&&(e.value=t.defaultValue),t.innerType._zod.run(e,n))}),mi=D(`$ZodNonOptional`,(e,t)=>{or.init(e,t),O(e._zod,`values`,()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>e!==void 0)):void 0}),e._zod.parse=(n,r)=>{let i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(t=>hi(t,e)):hi(i,e)}});function hi(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:`invalid_type`,expected:`nonoptional`,input:e.value,inst:t}),e}const gi=D(`$ZodCatch`,(e,t)=>{or.init(e,t),O(e._zod,`optin`,()=>t.innerType._zod.optin),O(e._zod,`optout`,()=>t.innerType._zod.optout),O(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(r=>(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>Ht(e,n,ut()))},input:e.value}),e.issues=[]),e)):(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>Ht(e,n,ut()))},input:e.value}),e.issues=[]),e)}}),_i=D(`$ZodPipe`,(e,t)=>{or.init(e,t),O(e._zod,`values`,()=>t.in._zod.values),O(e._zod,`optin`,()=>t.in._zod.optin),O(e._zod,`optout`,()=>t.out._zod.optout),O(e._zod,`propValues`,()=>t.in._zod.propValues),e._zod.parse=(e,n)=>{if(n.direction===`backward`){let r=t.out._zod.run(e,n);return r instanceof Promise?r.then(e=>vi(e,t.in,n)):vi(r,t.in,n)}let r=t.in._zod.run(e,n);return r instanceof Promise?r.then(e=>vi(e,t.out,n)):vi(r,t.out,n)}});function vi(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const yi=D(`$ZodReadonly`,(e,t)=>{or.init(e,t),O(e._zod,`propValues`,()=>t.innerType._zod.propValues),O(e._zod,`values`,()=>t.innerType._zod.values),O(e._zod,`optin`,()=>t.innerType?._zod?.optin),O(e._zod,`optout`,()=>t.innerType?._zod?.optout),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(bi):bi(r)}});function bi(e){return e.value=Object.freeze(e.value),e}const xi=D(`$ZodLazy`,(e,t)=>{or.init(e,t),O(e._zod,`innerType`,()=>t.getter()),O(e._zod,`pattern`,()=>e._zod.innerType?._zod?.pattern),O(e._zod,`propValues`,()=>e._zod.innerType?._zod?.propValues),O(e._zod,`optin`,()=>e._zod.innerType?._zod?.optin??void 0),O(e._zod,`optout`,()=>e._zod.innerType?._zod?.optout??void 0),e._zod.parse=(t,n)=>e._zod.innerType._zod.run(t,n)}),Si=D(`$ZodCustom`,(e,t)=>{Vn.init(e,t),or.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=n=>{let r=n.value,i=t.fn(r);if(i instanceof Promise)return i.then(t=>Ci(t,n,r,e));Ci(i,n,r,e)}});function Ci(e,t,n,r){if(!e){let e={code:`custom`,input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(e.params=r._zod.def.params),t.issues.push(Wt(e))}}var wi,Ti=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let n=t[0];return this._map.set(e,n),n&&typeof n==`object`&&`id`in n&&this._idmap.set(n.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t==`object`&&`id`in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n={...this.get(t)??{}};delete n.id;let r={...n,...this._map.get(e)};return Object.keys(r).length?r:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function Ei(){return new Ti}(wi=globalThis).__zod_globalRegistry??(wi.__zod_globalRegistry=Ei());const Di=globalThis.__zod_globalRegistry;function Oi(e,t){return new e({type:`string`,...k(t)})}function ki(e,t){return new e({type:`string`,format:`email`,check:`string_format`,abort:!1,...k(t)})}function Ai(e,t){return new e({type:`string`,format:`guid`,check:`string_format`,abort:!1,...k(t)})}function ji(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,...k(t)})}function Mi(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v4`,...k(t)})}function Ni(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v6`,...k(t)})}function Pi(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v7`,...k(t)})}function Fi(e,t){return new e({type:`string`,format:`url`,check:`string_format`,abort:!1,...k(t)})}function Ii(e,t){return new e({type:`string`,format:`emoji`,check:`string_format`,abort:!1,...k(t)})}function Li(e,t){return new e({type:`string`,format:`nanoid`,check:`string_format`,abort:!1,...k(t)})}function Ri(e,t){return new e({type:`string`,format:`cuid`,check:`string_format`,abort:!1,...k(t)})}function zi(e,t){return new e({type:`string`,format:`cuid2`,check:`string_format`,abort:!1,...k(t)})}function Bi(e,t){return new e({type:`string`,format:`ulid`,check:`string_format`,abort:!1,...k(t)})}function Vi(e,t){return new e({type:`string`,format:`xid`,check:`string_format`,abort:!1,...k(t)})}function Hi(e,t){return new e({type:`string`,format:`ksuid`,check:`string_format`,abort:!1,...k(t)})}function Ui(e,t){return new e({type:`string`,format:`ipv4`,check:`string_format`,abort:!1,...k(t)})}function Wi(e,t){return new e({type:`string`,format:`ipv6`,check:`string_format`,abort:!1,...k(t)})}function Gi(e,t){return new e({type:`string`,format:`cidrv4`,check:`string_format`,abort:!1,...k(t)})}function Ki(e,t){return new e({type:`string`,format:`cidrv6`,check:`string_format`,abort:!1,...k(t)})}function qi(e,t){return new e({type:`string`,format:`base64`,check:`string_format`,abort:!1,...k(t)})}function Ji(e,t){return new e({type:`string`,format:`base64url`,check:`string_format`,abort:!1,...k(t)})}function Yi(e,t){return new e({type:`string`,format:`e164`,check:`string_format`,abort:!1,...k(t)})}function Xi(e,t){return new e({type:`string`,format:`jwt`,check:`string_format`,abort:!1,...k(t)})}function Zi(e,t){return new e({type:`string`,format:`datetime`,check:`string_format`,offset:!1,local:!1,precision:null,...k(t)})}function Qi(e,t){return new e({type:`string`,format:`date`,check:`string_format`,...k(t)})}function $i(e,t){return new e({type:`string`,format:`time`,check:`string_format`,precision:null,...k(t)})}function ea(e,t){return new e({type:`string`,format:`duration`,check:`string_format`,...k(t)})}function ta(e,t){return new e({type:`number`,checks:[],...k(t)})}function na(e,t){return new e({type:`number`,coerce:!0,checks:[],...k(t)})}function ra(e,t){return new e({type:`number`,check:`number_format`,abort:!1,format:`safeint`,...k(t)})}function ia(e,t){return new e({type:`boolean`,...k(t)})}function aa(e,t){return new e({type:`null`,...k(t)})}function oa(e){return new e({type:`any`})}function sa(e){return new e({type:`unknown`})}function ca(e,t){return new e({type:`never`,...k(t)})}function la(e,t){return new Un({check:`less_than`,...k(t),value:e,inclusive:!1})}function ua(e,t){return new Un({check:`less_than`,...k(t),value:e,inclusive:!0})}function da(e,t){return new Wn({check:`greater_than`,...k(t),value:e,inclusive:!1})}function fa(e,t){return new Wn({check:`greater_than`,...k(t),value:e,inclusive:!0})}function pa(e,t){return new Gn({check:`multiple_of`,...k(t),value:e})}function ma(e,t){return new qn({check:`max_length`,...k(t),maximum:e})}function ha(e,t){return new Jn({check:`min_length`,...k(t),minimum:e})}function ga(e,t){return new Yn({check:`length_equals`,...k(t),length:e})}function _a(e,t){return new Zn({check:`string_format`,format:`regex`,...k(t),pattern:e})}function va(e){return new Qn({check:`string_format`,format:`lowercase`,...k(e)})}function ya(e){return new $n({check:`string_format`,format:`uppercase`,...k(e)})}function ba(e,t){return new er({check:`string_format`,format:`includes`,...k(t),includes:e})}function xa(e,t){return new tr({check:`string_format`,format:`starts_with`,...k(t),prefix:e})}function Sa(e,t){return new nr({check:`string_format`,format:`ends_with`,...k(t),suffix:e})}function Ca(e){return new rr({check:`overwrite`,tx:e})}function wa(e){return Ca(t=>t.normalize(e))}function Ta(){return Ca(e=>e.trim())}function Ea(){return Ca(e=>e.toLowerCase())}function Da(){return Ca(e=>e.toUpperCase())}function Oa(){return Ca(e=>xt(e))}function ka(e,t,n){return new e({type:`array`,element:t,...k(n)})}function Aa(e,t,n){let r=k(n);return r.abort??=!0,new e({type:`custom`,check:`custom`,fn:t,...r})}function ja(e,t,n){return new e({type:`custom`,check:`custom`,fn:t,...k(n)})}function Ma(e){let t=Na(n=>(n.addIssue=e=>{if(typeof e==`string`)n.issues.push(Wt(e,n.value,t._zod.def));else{let r=e;r.fatal&&(r.continue=!1),r.code??=`custom`,r.input??=n.value,r.inst??=t,r.continue??=!t._zod.def.abort,n.issues.push(Wt(r))}},e(n.value,n)));return t}function Na(e,t){let n=new Vn({check:`custom`,...k(t)});return n._zod.check=e,n}function Pa(e){let t=e?.target??`draft-2020-12`;return t===`draft-4`&&(t=`draft-04`),t===`draft-7`&&(t=`draft-07`),{processors:e.processors??{},metadataRegistry:e?.metadata??Di,target:t,unrepresentable:e?.unrepresentable??`throw`,override:e?.override??(()=>{}),io:e?.io??`output`,counter:0,seen:new Map,cycles:e?.cycles??`ref`,reused:e?.reused??`inline`,external:e?.external??void 0}}function Fa(e,t,n={path:[],schemaPath:[]}){var r;let i=e._zod.def,a=t.seen.get(e);if(a)return a.count++,n.schemaPath.includes(e)&&(a.cycle=n.path),a.schema;let o={schema:{},count:1,cycle:void 0,path:n.path};t.seen.set(e,o);let s=e._zod.toJSONSchema?.();if(s)o.schema=s;else{let r={...n,schemaPath:[...n.schemaPath,e],path:n.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,o.schema,r);else{let n=o.schema,a=t.processors[i.type];if(!a)throw Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);a(e,t,n,r)}let a=e._zod.parent;a&&(o.ref||=a,Fa(a,t,r),t.seen.get(a).isParent=!0)}let c=t.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),t.io===`input`&&Ra(e)&&(delete o.schema.examples,delete o.schema.default),t.io===`input`&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,t.seen.get(e).schema}function Ia(e,t){let n=e.seen.get(t);if(!n)throw Error(`Unprocessed schema. This is a bug in Zod.`);let r=new Map;for(let t of e.seen.entries()){let n=e.metadataRegistry.get(t[0])?.id;if(n){let e=r.get(n);if(e&&e!==t[0])throw Error(`Duplicate schema id "${n}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(n,t[0])}}let i=t=>{let r=e.target===`draft-2020-12`?`$defs`:`definitions`;if(e.external){let n=e.external.registry.get(t[0])?.id,i=e.external.uri??(e=>e);if(n)return{ref:i(n)};let a=t[1].defId??t[1].schema.id??`schema${e.counter++}`;return t[1].defId=a,{defId:a,ref:`${i(`__shared`)}#/${r}/${a}`}}if(t[1]===n)return{ref:`#`};let i=`#/${r}/`,a=t[1].schema.id??`__schema${e.counter++}`;return{defId:a,ref:i+a}},a=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:n,defId:r}=i(e);t.def={...t.schema},r&&(t.defId=r);let a=t.schema;for(let e in a)delete a[e];a.$ref=n};if(e.cycles===`throw`)for(let t of e.seen.entries()){let e=t[1];if(e.cycle)throw Error(`Cycle detected: #/${e.cycle?.join(`/`)}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let n of e.seen.entries()){let r=n[1];if(t===n[0]){a(n);continue}if(e.external){let r=e.external.registry.get(n[0])?.id;if(t!==n[0]&&r){a(n);continue}}if(e.metadataRegistry.get(n[0])?.id){a(n);continue}if(r.cycle){a(n);continue}if(r.count>1&&e.reused===`ref`){a(n);continue}}}function La(e,t){let n=e.seen.get(t);if(!n)throw Error(`Unprocessed schema. This is a bug in Zod.`);let r=t=>{let n=e.seen.get(t);if(n.ref===null)return;let i=n.def??n.schema,a={...i},o=n.ref;if(n.ref=null,o){r(o);let n=e.seen.get(o),s=n.schema;if(s.$ref&&(e.target===`draft-07`||e.target===`draft-04`||e.target===`openapi-3.0`)?(i.allOf=i.allOf??[],i.allOf.push(s)):Object.assign(i,s),Object.assign(i,a),t._zod.parent===o)for(let e in i)e===`$ref`||e===`allOf`||e in a||delete i[e];if(s.$ref)for(let e in i)e===`$ref`||e===`allOf`||e in n.def&&JSON.stringify(i[e])===JSON.stringify(n.def[e])&&delete i[e]}let s=t._zod.parent;if(s&&s!==o){r(s);let t=e.seen.get(s);if(t?.schema.$ref&&(i.$ref=t.schema.$ref,t.def))for(let e in i)e===`$ref`||e===`allOf`||e in t.def&&JSON.stringify(i[e])===JSON.stringify(t.def[e])&&delete i[e]}e.override({zodSchema:t,jsonSchema:i,path:n.path??[]})};for(let t of[...e.seen.entries()].reverse())r(t[0]);let i={};if(e.target===`draft-2020-12`?i.$schema=`https://json-schema.org/draft/2020-12/schema`:e.target===`draft-07`?i.$schema=`http://json-schema.org/draft-07/schema#`:e.target===`draft-04`?i.$schema=`http://json-schema.org/draft-04/schema#`:e.target,e.external?.uri){let n=e.external.registry.get(t)?.id;if(!n)throw Error("Schema is missing an `id` property");i.$id=e.external.uri(n)}Object.assign(i,n.def??n.schema);let a=e.external?.defs??{};for(let t of e.seen.entries()){let e=t[1];e.def&&e.defId&&(a[e.defId]=e.def)}e.external||Object.keys(a).length>0&&(e.target===`draft-2020-12`?i.$defs=a:i.definitions=a);try{let n=JSON.parse(JSON.stringify(i));return Object.defineProperty(n,`~standard`,{value:{...t[`~standard`],jsonSchema:{input:Ba(t,`input`,e.processors),output:Ba(t,`output`,e.processors)}},enumerable:!1,writable:!1}),n}catch{throw Error(`Error converting schema to JSON.`)}}function Ra(e,t){let n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);let r=e._zod.def;if(r.type===`transform`)return!0;if(r.type===`array`)return Ra(r.element,n);if(r.type===`set`)return Ra(r.valueType,n);if(r.type===`lazy`)return Ra(r.getter(),n);if(r.type===`promise`||r.type===`optional`||r.type===`nonoptional`||r.type===`nullable`||r.type===`readonly`||r.type===`default`||r.type===`prefault`)return Ra(r.innerType,n);if(r.type===`intersection`)return Ra(r.left,n)||Ra(r.right,n);if(r.type===`record`||r.type===`map`)return Ra(r.keyType,n)||Ra(r.valueType,n);if(r.type===`pipe`)return Ra(r.in,n)||Ra(r.out,n);if(r.type===`object`){for(let e in r.shape)if(Ra(r.shape[e],n))return!0;return!1}if(r.type===`union`){for(let e of r.options)if(Ra(e,n))return!0;return!1}if(r.type===`tuple`){for(let e of r.items)if(Ra(e,n))return!0;return!!(r.rest&&Ra(r.rest,n))}return!1}const za=(e,t={})=>n=>{let r=Pa({...n,processors:t});return Fa(e,r),Ia(r,e),La(r,e)},Ba=(e,t,n={})=>r=>{let{libraryOptions:i,target:a}=r??{},o=Pa({...i??{},target:a,io:t,processors:n});return Fa(e,o),Ia(o,e),La(o,e)},Va={guid:`uuid`,url:`uri`,datetime:`date-time`,json_string:`json-string`,regex:``},Ha=(e,t,n,r)=>{let i=n;i.type=`string`;let{minimum:a,maximum:o,format:s,patterns:c,contentEncoding:l}=e._zod.bag;if(typeof a==`number`&&(i.minLength=a),typeof o==`number`&&(i.maxLength=o),s&&(i.format=Va[s]??s,i.format===``&&delete i.format,s===`time`&&delete i.format),l&&(i.contentEncoding=l),c&&c.size>0){let e=[...c];e.length===1?i.pattern=e[0].source:e.length>1&&(i.allOf=[...e.map(e=>({...t.target===`draft-07`||t.target===`draft-04`||t.target===`openapi-3.0`?{type:`string`}:{},pattern:e.source}))])}},Ua=(e,t,n,r)=>{let i=n,{minimum:a,maximum:o,format:s,multipleOf:c,exclusiveMaximum:l,exclusiveMinimum:u}=e._zod.bag;typeof s==`string`&&s.includes(`int`)?i.type=`integer`:i.type=`number`,typeof u==`number`&&(t.target===`draft-04`||t.target===`openapi-3.0`?(i.minimum=u,i.exclusiveMinimum=!0):i.exclusiveMinimum=u),typeof a==`number`&&(i.minimum=a,typeof u==`number`&&t.target!==`draft-04`&&(u>=a?delete i.minimum:delete i.exclusiveMinimum)),typeof l==`number`&&(t.target===`draft-04`||t.target===`openapi-3.0`?(i.maximum=l,i.exclusiveMaximum=!0):i.exclusiveMaximum=l),typeof o==`number`&&(i.maximum=o,typeof l==`number`&&t.target!==`draft-04`&&(l<=o?delete i.maximum:delete i.exclusiveMaximum)),typeof c==`number`&&(i.multipleOf=c)},Wa=(e,t,n,r)=>{n.type=`boolean`},Ga=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`BigInt cannot be represented in JSON Schema`)},Ka=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Symbols cannot be represented in JSON Schema`)},qa=(e,t,n,r)=>{t.target===`openapi-3.0`?(n.type=`string`,n.nullable=!0,n.enum=[null]):n.type=`null`},Ja=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Undefined cannot be represented in JSON Schema`)},Ya=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Void cannot be represented in JSON Schema`)},Xa=(e,t,n,r)=>{n.not={}},Za=(e,t,n,r)=>{},Qa=(e,t,n,r)=>{},$a=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Date cannot be represented in JSON Schema`)},eo=(e,t,n,r)=>{let i=e._zod.def,a=dt(i.entries);a.every(e=>typeof e==`number`)&&(n.type=`number`),a.every(e=>typeof e==`string`)&&(n.type=`string`),n.enum=a},to=(e,t,n,r)=>{let i=e._zod.def,a=[];for(let e of i.values)if(e===void 0){if(t.unrepresentable===`throw`)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof e==`bigint`){if(t.unrepresentable===`throw`)throw Error(`BigInt literals cannot be represented in JSON Schema`);a.push(Number(e))}else a.push(e);if(a.length!==0)if(a.length===1){let e=a[0];n.type=e===null?`null`:typeof e,t.target===`draft-04`||t.target===`openapi-3.0`?n.enum=[e]:n.const=e}else a.every(e=>typeof e==`number`)&&(n.type=`number`),a.every(e=>typeof e==`string`)&&(n.type=`string`),a.every(e=>typeof e==`boolean`)&&(n.type=`boolean`),a.every(e=>e===null)&&(n.type=`null`),n.enum=a},no=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`NaN cannot be represented in JSON Schema`)},ro=(e,t,n,r)=>{let i=n,a=e._zod.pattern;if(!a)throw Error(`Pattern not found in template literal`);i.type=`string`,i.pattern=a.source},io=(e,t,n,r)=>{let i=n,a={type:`string`,format:`binary`,contentEncoding:`binary`},{minimum:o,maximum:s,mime:c}=e._zod.bag;o!==void 0&&(a.minLength=o),s!==void 0&&(a.maxLength=s),c?c.length===1?(a.contentMediaType=c[0],Object.assign(i,a)):(Object.assign(i,a),i.anyOf=c.map(e=>({contentMediaType:e}))):Object.assign(i,a)},ao=(e,t,n,r)=>{n.type=`boolean`},oo=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Custom types cannot be represented in JSON Schema`)},so=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Function types cannot be represented in JSON Schema`)},co=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Transforms cannot be represented in JSON Schema`)},lo=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Map cannot be represented in JSON Schema`)},uo=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Set cannot be represented in JSON Schema`)},fo=(e,t,n,r)=>{let i=n,a=e._zod.def,{minimum:o,maximum:s}=e._zod.bag;typeof o==`number`&&(i.minItems=o),typeof s==`number`&&(i.maxItems=s),i.type=`array`,i.items=Fa(a.element,t,{...r,path:[...r.path,`items`]})},po=(e,t,n,r)=>{let i=n,a=e._zod.def;i.type=`object`,i.properties={};let o=a.shape;for(let e in o)i.properties[e]=Fa(o[e],t,{...r,path:[...r.path,`properties`,e]});let s=new Set(Object.keys(o)),c=new Set([...s].filter(e=>{let n=a.shape[e]._zod;return t.io===`input`?n.optin===void 0:n.optout===void 0}));c.size>0&&(i.required=Array.from(c)),a.catchall?._zod.def.type===`never`?i.additionalProperties=!1:a.catchall?a.catchall&&(i.additionalProperties=Fa(a.catchall,t,{...r,path:[...r.path,`additionalProperties`]})):t.io===`output`&&(i.additionalProperties=!1)},mo=(e,t,n,r)=>{let i=e._zod.def,a=i.inclusive===!1,o=i.options.map((e,n)=>Fa(e,t,{...r,path:[...r.path,a?`oneOf`:`anyOf`,n]}));a?n.oneOf=o:n.anyOf=o},ho=(e,t,n,r)=>{let i=e._zod.def,a=Fa(i.left,t,{...r,path:[...r.path,`allOf`,0]}),o=Fa(i.right,t,{...r,path:[...r.path,`allOf`,1]}),s=e=>`allOf`in e&&Object.keys(e).length===1;n.allOf=[...s(a)?a.allOf:[a],...s(o)?o.allOf:[o]]},go=(e,t,n,r)=>{let i=n,a=e._zod.def;i.type=`array`;let o=t.target===`draft-2020-12`?`prefixItems`:`items`,s=t.target===`draft-2020-12`||t.target===`openapi-3.0`?`items`:`additionalItems`,c=a.items.map((e,n)=>Fa(e,t,{...r,path:[...r.path,o,n]})),l=a.rest?Fa(a.rest,t,{...r,path:[...r.path,s,...t.target===`openapi-3.0`?[a.items.length]:[]]}):null;t.target===`draft-2020-12`?(i.prefixItems=c,l&&(i.items=l)):t.target===`openapi-3.0`?(i.items={anyOf:c},l&&i.items.anyOf.push(l),i.minItems=c.length,l||(i.maxItems=c.length)):(i.items=c,l&&(i.additionalItems=l));let{minimum:u,maximum:d}=e._zod.bag;typeof u==`number`&&(i.minItems=u),typeof d==`number`&&(i.maxItems=d)},_o=(e,t,n,r)=>{let i=n,a=e._zod.def;i.type=`object`;let o=a.keyType,s=o._zod.bag?.patterns;if(a.mode===`loose`&&s&&s.size>0){let e=Fa(a.valueType,t,{...r,path:[...r.path,`patternProperties`,`*`]});i.patternProperties={};for(let t of s)i.patternProperties[t.source]=e}else (t.target===`draft-07`||t.target===`draft-2020-12`)&&(i.propertyNames=Fa(a.keyType,t,{...r,path:[...r.path,`propertyNames`]})),i.additionalProperties=Fa(a.valueType,t,{...r,path:[...r.path,`additionalProperties`]});let c=o._zod.values;if(c){let e=[...c].filter(e=>typeof e==`string`||typeof e==`number`);e.length>0&&(i.required=e)}},vo=(e,t,n,r)=>{let i=e._zod.def,a=Fa(i.innerType,t,r),o=t.seen.get(e);t.target===`openapi-3.0`?(o.ref=i.innerType,n.nullable=!0):n.anyOf=[a,{type:`null`}]},yo=(e,t,n,r)=>{let i=e._zod.def;Fa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType},bo=(e,t,n,r)=>{let i=e._zod.def;Fa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType,n.default=JSON.parse(JSON.stringify(i.defaultValue))},xo=(e,t,n,r)=>{let i=e._zod.def;Fa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType,t.io===`input`&&(n._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},So=(e,t,n,r)=>{let i=e._zod.def;Fa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType;let o;try{o=i.catchValue(void 0)}catch{throw Error(`Dynamic catch values are not supported in JSON Schema`)}n.default=o},Co=(e,t,n,r)=>{let i=e._zod.def,a=t.io===`input`?i.in._zod.def.type===`transform`?i.out:i.in:i.out;Fa(a,t,r);let o=t.seen.get(e);o.ref=a},wo=(e,t,n,r)=>{let i=e._zod.def;Fa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType,n.readOnly=!0},To=(e,t,n,r)=>{let i=e._zod.def;Fa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType},Eo=(e,t,n,r)=>{let i=e._zod.def;Fa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType},Do=(e,t,n,r)=>{let i=e._zod.innerType;Fa(i,t,r);let a=t.seen.get(e);a.ref=i},Oo={string:Ha,number:Ua,boolean:Wa,bigint:Ga,symbol:Ka,null:qa,undefined:Ja,void:Ya,never:Xa,any:Za,unknown:Qa,date:$a,enum:eo,literal:to,nan:no,template_literal:ro,file:io,success:ao,custom:oo,function:so,transform:co,map:lo,set:uo,array:fo,object:po,union:mo,intersection:ho,tuple:go,record:_o,nullable:vo,nonoptional:yo,default:bo,prefault:xo,catch:So,pipe:Co,readonly:wo,promise:To,optional:Eo,lazy:Do};function ko(e,t){if(`_idmap`in e){let n=e,r=Pa({...t,processors:Oo}),i={};for(let e of n._idmap.entries()){let[t,n]=e;Fa(n,r)}let a={};r.external={registry:n,uri:t?.uri,defs:i};for(let e of n._idmap.entries()){let[t,n]=e;Ia(r,n),a[t]=La(r,n)}return Object.keys(i).length>0&&(a.__shared={[r.target===`draft-2020-12`?`$defs`:`definitions`]:i}),{schemas:a}}let n=Pa({...t,processors:Oo});return Fa(e,n),Ia(n,e),La(n,e)}const Ao=D(`ZodISODateTime`,(e,t)=>{br.init(e,t),ts.init(e,t)});function jo(e){return Zi(Ao,e)}const Mo=D(`ZodISODate`,(e,t)=>{xr.init(e,t),ts.init(e,t)});function No(e){return Qi(Mo,e)}const Po=D(`ZodISOTime`,(e,t)=>{Sr.init(e,t),ts.init(e,t)});function Fo(e){return $i(Po,e)}const Io=D(`ZodISODuration`,(e,t)=>{Cr.init(e,t),ts.init(e,t)});function Lo(e){return ea(Io,e)}const Ro=(e,t)=>{Kt.init(e,t),e.name=`ZodError`,Object.defineProperties(e,{format:{value:t=>Yt(e,t)},flatten:{value:t=>Jt(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,ft,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,ft,2)}},isEmpty:{get(){return e.issues.length===0}}})};D(`ZodError`,Ro);const zo=D(`ZodError`,Ro,{Parent:Error}),Bo=Xt(zo),Vo=Zt(zo),Ho=Qt(zo),Uo=en(zo),Wo=nn(zo),Go=rn(zo),Ko=an(zo),qo=on(zo),Jo=sn(zo),Yo=cn(zo),Xo=ln(zo),Zo=un(zo),Qo=D(`ZodType`,(e,t)=>(or.init(e,t),Object.assign(e[`~standard`],{jsonSchema:{input:Ba(e,`input`),output:Ba(e,`output`)}}),e.toJSONSchema=za(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,`_def`,{value:t}),e.check=(...n)=>e.clone(yt(t,{checks:[...t.checks??[],...n.map(e=>typeof e==`function`?{_zod:{check:e,def:{check:`custom`},onattach:[]}}:e)]}),{parent:!0}),e.with=e.check,e.clone=(t,n)=>kt(e,t,n),e.brand=()=>e,e.register=((t,n)=>(t.add(e,n),e)),e.parse=(t,n)=>Bo(e,t,n,{callee:e.parse}),e.safeParse=(t,n)=>Ho(e,t,n),e.parseAsync=async(t,n)=>Vo(e,t,n,{callee:e.parseAsync}),e.safeParseAsync=async(t,n)=>Uo(e,t,n),e.spa=e.safeParseAsync,e.encode=(t,n)=>Wo(e,t,n),e.decode=(t,n)=>Go(e,t,n),e.encodeAsync=async(t,n)=>Ko(e,t,n),e.decodeAsync=async(t,n)=>qo(e,t,n),e.safeEncode=(t,n)=>Jo(e,t,n),e.safeDecode=(t,n)=>Yo(e,t,n),e.safeEncodeAsync=async(t,n)=>Xo(e,t,n),e.safeDecodeAsync=async(t,n)=>Zo(e,t,n),e.refine=(t,n)=>e.check(hc(t,n)),e.superRefine=t=>e.check(gc(t)),e.overwrite=t=>e.check(Ca(t)),e.optional=()=>Js(e),e.exactOptional=()=>Xs(e),e.nullable=()=>Qs(e),e.nullish=()=>Js(Qs(e)),e.nonoptional=t=>ic(e,t),e.array=()=>F(e),e.or=t=>L([e,t]),e.and=t=>Rs(e,t),e.transform=t=>cc(e,Ks(t)),e.default=t=>ec(e,t),e.prefault=t=>nc(e,t),e.catch=t=>oc(e,t),e.pipe=t=>cc(e,t),e.readonly=()=>uc(e),e.describe=t=>{let n=e.clone();return Di.add(n,{description:t}),n},Object.defineProperty(e,`description`,{get(){return Di.get(e)?.description},configurable:!0}),e.meta=(...t)=>{if(t.length===0)return Di.get(e);let n=e.clone();return Di.add(n,t[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=t=>t(e),e)),$o=D(`_ZodString`,(e,t)=>{sr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Ha(e,t,n,r);let n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...t)=>e.check(_a(...t)),e.includes=(...t)=>e.check(ba(...t)),e.startsWith=(...t)=>e.check(xa(...t)),e.endsWith=(...t)=>e.check(Sa(...t)),e.min=(...t)=>e.check(ha(...t)),e.max=(...t)=>e.check(ma(...t)),e.length=(...t)=>e.check(ga(...t)),e.nonempty=(...t)=>e.check(ha(1,...t)),e.lowercase=t=>e.check(va(t)),e.uppercase=t=>e.check(ya(t)),e.trim=()=>e.check(Ta()),e.normalize=(...t)=>e.check(wa(...t)),e.toLowerCase=()=>e.check(Ea()),e.toUpperCase=()=>e.check(Da()),e.slugify=()=>e.check(Oa())}),es=D(`ZodString`,(e,t)=>{sr.init(e,t),$o.init(e,t),e.email=t=>e.check(ki(ns,t)),e.url=t=>e.check(Fi(as,t)),e.jwt=t=>e.check(Xi(bs,t)),e.emoji=t=>e.check(Ii(os,t)),e.guid=t=>e.check(Ai(rs,t)),e.uuid=t=>e.check(ji(is,t)),e.uuidv4=t=>e.check(Mi(is,t)),e.uuidv6=t=>e.check(Ni(is,t)),e.uuidv7=t=>e.check(Pi(is,t)),e.nanoid=t=>e.check(Li(ss,t)),e.guid=t=>e.check(Ai(rs,t)),e.cuid=t=>e.check(Ri(cs,t)),e.cuid2=t=>e.check(zi(ls,t)),e.ulid=t=>e.check(Bi(us,t)),e.base64=t=>e.check(qi(_s,t)),e.base64url=t=>e.check(Ji(vs,t)),e.xid=t=>e.check(Vi(ds,t)),e.ksuid=t=>e.check(Hi(fs,t)),e.ipv4=t=>e.check(Ui(ps,t)),e.ipv6=t=>e.check(Wi(ms,t)),e.cidrv4=t=>e.check(Gi(hs,t)),e.cidrv6=t=>e.check(Ki(gs,t)),e.e164=t=>e.check(Yi(ys,t)),e.datetime=t=>e.check(jo(t)),e.date=t=>e.check(No(t)),e.time=t=>e.check(Fo(t)),e.duration=t=>e.check(Lo(t))});function A(e){return Oi(es,e)}const ts=D(`ZodStringFormat`,(e,t)=>{cr.init(e,t),$o.init(e,t)}),ns=D(`ZodEmail`,(e,t)=>{dr.init(e,t),ts.init(e,t)}),rs=D(`ZodGUID`,(e,t)=>{lr.init(e,t),ts.init(e,t)}),is=D(`ZodUUID`,(e,t)=>{ur.init(e,t),ts.init(e,t)}),as=D(`ZodURL`,(e,t)=>{fr.init(e,t),ts.init(e,t)}),os=D(`ZodEmoji`,(e,t)=>{pr.init(e,t),ts.init(e,t)}),ss=D(`ZodNanoID`,(e,t)=>{mr.init(e,t),ts.init(e,t)}),cs=D(`ZodCUID`,(e,t)=>{hr.init(e,t),ts.init(e,t)}),ls=D(`ZodCUID2`,(e,t)=>{gr.init(e,t),ts.init(e,t)}),us=D(`ZodULID`,(e,t)=>{_r.init(e,t),ts.init(e,t)}),ds=D(`ZodXID`,(e,t)=>{vr.init(e,t),ts.init(e,t)}),fs=D(`ZodKSUID`,(e,t)=>{yr.init(e,t),ts.init(e,t)}),ps=D(`ZodIPv4`,(e,t)=>{wr.init(e,t),ts.init(e,t)}),ms=D(`ZodIPv6`,(e,t)=>{Tr.init(e,t),ts.init(e,t)}),hs=D(`ZodCIDRv4`,(e,t)=>{Er.init(e,t),ts.init(e,t)}),gs=D(`ZodCIDRv6`,(e,t)=>{Dr.init(e,t),ts.init(e,t)}),_s=D(`ZodBase64`,(e,t)=>{kr.init(e,t),ts.init(e,t)}),vs=D(`ZodBase64URL`,(e,t)=>{jr.init(e,t),ts.init(e,t)}),ys=D(`ZodE164`,(e,t)=>{Mr.init(e,t),ts.init(e,t)}),bs=D(`ZodJWT`,(e,t)=>{Pr.init(e,t),ts.init(e,t)}),xs=D(`ZodNumber`,(e,t)=>{Fr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Ua(e,t,n,r),e.gt=(t,n)=>e.check(da(t,n)),e.gte=(t,n)=>e.check(fa(t,n)),e.min=(t,n)=>e.check(fa(t,n)),e.lt=(t,n)=>e.check(la(t,n)),e.lte=(t,n)=>e.check(ua(t,n)),e.max=(t,n)=>e.check(ua(t,n)),e.int=t=>e.check(Cs(t)),e.safe=t=>e.check(Cs(t)),e.positive=t=>e.check(da(0,t)),e.nonnegative=t=>e.check(fa(0,t)),e.negative=t=>e.check(la(0,t)),e.nonpositive=t=>e.check(ua(0,t)),e.multipleOf=(t,n)=>e.check(pa(t,n)),e.step=(t,n)=>e.check(pa(t,n)),e.finite=()=>e;let n=e._zod.bag;e.minValue=Math.max(n.minimum??-1/0,n.exclusiveMinimum??-1/0)??null,e.maxValue=Math.min(n.maximum??1/0,n.exclusiveMaximum??1/0)??null,e.isInt=(n.format??``).includes(`int`)||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function j(e){return ta(xs,e)}const Ss=D(`ZodNumberFormat`,(e,t)=>{Ir.init(e,t),xs.init(e,t)});function Cs(e){return ra(Ss,e)}const ws=D(`ZodBoolean`,(e,t)=>{Lr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Wa(e,t,n,r)});function M(e){return ia(ws,e)}const Ts=D(`ZodNull`,(e,t)=>{Rr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>qa(e,t,n,r)});function Es(e){return aa(Ts,e)}const Ds=D(`ZodAny`,(e,t)=>{zr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(e,t,n)=>void 0});function Os(){return oa(Ds)}const ks=D(`ZodUnknown`,(e,t)=>{Br.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(e,t,n)=>void 0});function N(){return sa(ks)}const As=D(`ZodNever`,(e,t)=>{Vr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Xa(e,t,n,r)});function P(e){return ca(As,e)}const js=D(`ZodArray`,(e,t)=>{Ur.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>fo(e,t,n,r),e.element=t.element,e.min=(t,n)=>e.check(ha(t,n)),e.nonempty=t=>e.check(ha(1,t)),e.max=(t,n)=>e.check(ma(t,n)),e.length=(t,n)=>e.check(ga(t,n)),e.unwrap=()=>e.element});function F(e,t){return ka(js,e,t)}const Ms=D(`ZodObject`,(e,t)=>{Jr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>po(e,t,n,r),O(e,`shape`,()=>t.shape),e.keyof=()=>z(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:N()}),e.loose=()=>e.clone({...e._zod.def,catchall:N()}),e.strict=()=>e.clone({...e._zod.def,catchall:P()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>Pt(e,t),e.safeExtend=t=>Ft(e,t),e.merge=t=>It(e,t),e.pick=t=>Mt(e,t),e.omit=t=>Nt(e,t),e.partial=(...t)=>Lt(qs,e,t[0]),e.required=(...t)=>Rt(rc,e,t[0])});function I(e,t){return new Ms({type:`object`,shape:e??{},...k(t)})}function Ns(e,t){return new Ms({type:`object`,shape:e,catchall:P(),...k(t)})}function Ps(e,t){return new Ms({type:`object`,shape:e,catchall:N(),...k(t)})}const Fs=D(`ZodUnion`,(e,t)=>{Xr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>mo(e,t,n,r),e.options=t.options});function L(e,t){return new Fs({type:`union`,options:e,...k(t)})}const Is=D(`ZodDiscriminatedUnion`,(e,t)=>{Fs.init(e,t),Zr.init(e,t)});function R(e,t,n){return new Is({type:`union`,options:t,discriminator:e,...k(n)})}const Ls=D(`ZodIntersection`,(e,t)=>{Qr.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>ho(e,t,n,r)});function Rs(e,t){return new Ls({type:`intersection`,left:e,right:t})}const zs=D(`ZodTuple`,(e,t)=>{ti.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>go(e,t,n,r),e.rest=t=>e.clone({...e._zod.def,rest:t})});function Bs(e,t,n){let r=t instanceof or;return new zs({type:`tuple`,items:e,rest:r?t:null,...k(r?n:t)})}const Vs=D(`ZodRecord`,(e,t)=>{ri.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>_o(e,t,n,r),e.keyType=t.keyType,e.valueType=t.valueType});function Hs(e,t,n){return new Vs({type:`record`,keyType:e,valueType:t,...k(n)})}const Us=D(`ZodEnum`,(e,t)=>{ii.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>eo(e,t,n,r),e.enum=t.entries,e.options=Object.values(t.entries);let n=new Set(Object.keys(t.entries));e.extract=(e,r)=>{let i={};for(let r of e)if(n.has(r))i[r]=t.entries[r];else throw Error(`Key ${r} not found in enum`);return new Us({...t,checks:[],...k(r),entries:i})},e.exclude=(e,r)=>{let i={...t.entries};for(let t of e)if(n.has(t))delete i[t];else throw Error(`Key ${t} not found in enum`);return new Us({...t,checks:[],...k(r),entries:i})}});function z(e,t){return new Us({type:`enum`,entries:Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e,...k(t)})}const Ws=D(`ZodLiteral`,(e,t)=>{ai.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>to(e,t,n,r),e.values=new Set(t.values),Object.defineProperty(e,`value`,{get(){if(t.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function B(e,t){return new Ws({type:`literal`,values:Array.isArray(e)?e:[e],...k(t)})}const Gs=D(`ZodTransform`,(e,t)=>{oi.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>co(e,t,n,r),e._zod.parse=(n,r)=>{if(r.direction===`backward`)throw new ct(e.constructor.name);n.addIssue=r=>{if(typeof r==`string`)n.issues.push(Wt(r,n.value,t));else{let t=r;t.fatal&&(t.continue=!1),t.code??=`custom`,t.input??=n.value,t.inst??=e,n.issues.push(Wt(t))}};let i=t.transform(n.value,n);return i instanceof Promise?i.then(e=>(n.value=e,n)):(n.value=i,n)}});function Ks(e){return new Gs({type:`transform`,transform:e})}const qs=D(`ZodOptional`,(e,t)=>{ci.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Eo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function Js(e){return new qs({type:`optional`,innerType:e})}const Ys=D(`ZodExactOptional`,(e,t)=>{li.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Eo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function Xs(e){return new Ys({type:`optional`,innerType:e})}const Zs=D(`ZodNullable`,(e,t)=>{ui.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>vo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function Qs(e){return new Zs({type:`nullable`,innerType:e})}const $s=D(`ZodDefault`,(e,t)=>{di.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>bo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function ec(e,t){return new $s({type:`default`,innerType:e,get defaultValue(){return typeof t==`function`?t():Et(t)}})}const tc=D(`ZodPrefault`,(e,t)=>{pi.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>xo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function nc(e,t){return new tc({type:`prefault`,innerType:e,get defaultValue(){return typeof t==`function`?t():Et(t)}})}const rc=D(`ZodNonOptional`,(e,t)=>{mi.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>yo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function ic(e,t){return new rc({type:`nonoptional`,innerType:e,...k(t)})}const ac=D(`ZodCatch`,(e,t)=>{gi.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>So(e,t,n,r),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function oc(e,t){return new ac({type:`catch`,innerType:e,catchValue:typeof t==`function`?t:()=>t})}const sc=D(`ZodPipe`,(e,t)=>{_i.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Co(e,t,n,r),e.in=t.in,e.out=t.out});function cc(e,t){return new sc({type:`pipe`,in:e,out:t})}const lc=D(`ZodReadonly`,(e,t)=>{yi.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>wo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function uc(e){return new lc({type:`readonly`,innerType:e})}const dc=D(`ZodLazy`,(e,t)=>{xi.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Do(e,t,n,r),e.unwrap=()=>e._zod.def.getter()});function fc(e){return new dc({type:`lazy`,getter:e})}const pc=D(`ZodCustom`,(e,t)=>{Si.init(e,t),Qo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>oo(e,t,n,r)});function mc(e,t){return Aa(pc,e??(()=>!0),t)}function hc(e,t={}){return ja(pc,e,t)}function gc(e){return Ma(e)}function _c(e,t={}){let n=new pc({type:`custom`,check:`custom`,fn:t=>t instanceof e,abort:!0,...k(t)});return n._zod.bag.Class=e,n._zod.check=t=>{t.value instanceof e||t.issues.push({code:`invalid_type`,expected:e.name,input:t.value,inst:n,path:[...n._zod.def.path??[]]})},n}function vc(e){return na(xs,e)}var V;(function(e){e.assertEqual=e=>{};function t(e){}e.assertIs=t;function n(e){throw Error()}e.assertNever=n,e.arrayToEnum=e=>{let t={};for(let n of e)t[n]=n;return t},e.getValidEnumValues=t=>{let n=e.objectKeys(t).filter(e=>typeof t[t[e]]!=`number`),r={};for(let e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys=typeof Object.keys==`function`?e=>Object.keys(e):e=>{let t=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(let n of e)if(t(n))return n},e.isInteger=typeof Number.isInteger==`function`?e=>Number.isInteger(e):e=>typeof e==`number`&&Number.isFinite(e)&&Math.floor(e)===e;function r(e,t=` | `){return e.map(e=>typeof e==`string`?`'${e}'`:e).join(t)}e.joinValues=r,e.jsonStringifyReplacer=(e,t)=>typeof t==`bigint`?t.toString():t})(V||={});var yc;(function(e){e.mergeShapes=(e,t)=>({...e,...t})})(yc||={});const H=V.arrayToEnum([`string`,`nan`,`number`,`integer`,`float`,`boolean`,`date`,`bigint`,`symbol`,`function`,`undefined`,`null`,`array`,`object`,`unknown`,`promise`,`void`,`never`,`map`,`set`]),bc=e=>{switch(typeof e){case`undefined`:return H.undefined;case`string`:return H.string;case`number`:return Number.isNaN(e)?H.nan:H.number;case`boolean`:return H.boolean;case`function`:return H.function;case`bigint`:return H.bigint;case`symbol`:return H.symbol;case`object`:return Array.isArray(e)?H.array:e===null?H.null:e.then&&typeof e.then==`function`&&e.catch&&typeof e.catch==`function`?H.promise:typeof Map<`u`&&e instanceof Map?H.map:typeof Set<`u`&&e instanceof Set?H.set:typeof Date<`u`&&e instanceof Date?H.date:H.object;default:return H.unknown}},U=V.arrayToEnum([`invalid_type`,`invalid_literal`,`custom`,`invalid_union`,`invalid_union_discriminator`,`invalid_enum_value`,`unrecognized_keys`,`invalid_arguments`,`invalid_return_type`,`invalid_date`,`invalid_string`,`too_small`,`too_big`,`invalid_intersection_types`,`not_multiple_of`,`not_finite`]);var xc=class e extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name=`ZodError`,this.issues=e}format(e){let t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(let i of e.issues)if(i.code===`invalid_union`)i.unionErrors.map(r);else if(i.code===`invalid_return_type`)r(i.returnTypeError);else if(i.code===`invalid_arguments`)r(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){let n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(t){if(!(t instanceof e))throw Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,V.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=e=>e.message){let t=Object.create(null),n=[];for(let r of this.issues)if(r.path.length>0){let n=r.path[0];t[n]=t[n]||[],t[n].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};xc.create=e=>new xc(e);var Sc=(e,t)=>{let n;switch(e.code){case U.invalid_type:n=e.received===H.undefined?`Required`:`Expected ${e.expected}, received ${e.received}`;break;case U.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,V.jsonStringifyReplacer)}`;break;case U.unrecognized_keys:n=`Unrecognized key(s) in object: ${V.joinValues(e.keys,`, `)}`;break;case U.invalid_union:n=`Invalid input`;break;case U.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${V.joinValues(e.options)}`;break;case U.invalid_enum_value:n=`Invalid enum value. Expected ${V.joinValues(e.options)}, received '${e.received}'`;break;case U.invalid_arguments:n=`Invalid function arguments`;break;case U.invalid_return_type:n=`Invalid function return type`;break;case U.invalid_date:n=`Invalid date`;break;case U.invalid_string:typeof e.validation==`object`?`includes`in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position==`number`&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):`startsWith`in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:`endsWith`in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:V.assertNever(e.validation):n=e.validation===`regex`?`Invalid`:`Invalid ${e.validation}`;break;case U.too_small:n=e.type===`array`?`Array must contain ${e.exact?`exactly`:e.inclusive?`at least`:`more than`} ${e.minimum} element(s)`:e.type===`string`?`String must contain ${e.exact?`exactly`:e.inclusive?`at least`:`over`} ${e.minimum} character(s)`:e.type===`number`||e.type===`bigint`?`Number must be ${e.exact?`exactly equal to `:e.inclusive?`greater than or equal to `:`greater than `}${e.minimum}`:e.type===`date`?`Date must be ${e.exact?`exactly equal to `:e.inclusive?`greater than or equal to `:`greater than `}${new Date(Number(e.minimum))}`:`Invalid input`;break;case U.too_big:n=e.type===`array`?`Array must contain ${e.exact?`exactly`:e.inclusive?`at most`:`less than`} ${e.maximum} element(s)`:e.type===`string`?`String must contain ${e.exact?`exactly`:e.inclusive?`at most`:`under`} ${e.maximum} character(s)`:e.type===`number`?`Number must be ${e.exact?`exactly`:e.inclusive?`less than or equal to`:`less than`} ${e.maximum}`:e.type===`bigint`?`BigInt must be ${e.exact?`exactly`:e.inclusive?`less than or equal to`:`less than`} ${e.maximum}`:e.type===`date`?`Date must be ${e.exact?`exactly`:e.inclusive?`smaller than or equal to`:`smaller than`} ${new Date(Number(e.maximum))}`:`Invalid input`;break;case U.custom:n=`Invalid input`;break;case U.invalid_intersection_types:n=`Intersection results could not be merged`;break;case U.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case U.not_finite:n=`Number must be finite`;break;default:n=t.defaultError,V.assertNever(e)}return{message:n}};let Cc=Sc;function wc(){return Cc}const Tc=e=>{let{data:t,path:n,errorMaps:r,issueData:i}=e,a=[...n,...i.path||[]],o={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let s=``,c=r.filter(e=>!!e).slice().reverse();for(let e of c)s=e(o,{data:t,defaultError:s}).message;return{...i,path:a,message:s}};function W(e,t){let n=wc(),r=Tc({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===Sc?void 0:Sc].filter(e=>!!e)});e.common.issues.push(r)}var Ec=class e{constructor(){this.value=`valid`}dirty(){this.value===`valid`&&(this.value=`dirty`)}abort(){this.value!==`aborted`&&(this.value=`aborted`)}static mergeArray(e,t){let n=[];for(let r of t){if(r.status===`aborted`)return G;r.status===`dirty`&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(t,n){let r=[];for(let e of n){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return e.mergeObjectSync(t,r)}static mergeObjectSync(e,t){let n={};for(let r of t){let{key:t,value:i}=r;if(t.status===`aborted`||i.status===`aborted`)return G;t.status===`dirty`&&e.dirty(),i.status===`dirty`&&e.dirty(),t.value!==`__proto__`&&(i.value!==void 0||r.alwaysSet)&&(n[t.value]=i.value)}return{status:e.value,value:n}}};const G=Object.freeze({status:`aborted`}),Dc=e=>({status:`dirty`,value:e}),Oc=e=>({status:`valid`,value:e}),kc=e=>e.status===`aborted`,Ac=e=>e.status===`dirty`,jc=e=>e.status===`valid`,Mc=e=>typeof Promise<`u`&&e instanceof Promise;var K;(function(e){e.errToObj=e=>typeof e==`string`?{message:e}:e||{},e.toString=e=>typeof e==`string`?e:e?.message})(K||={});var Nc=class{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const Pc=(e,t)=>{if(jc(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error(`Validation failed but no issues detected.`);return{success:!1,get error(){return this._error||=new xc(e.common.issues),this._error}}};function q(e){if(!e)return{};let{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{let{message:a}=e;return t.code===`invalid_enum_value`?{message:a??i.defaultError}:i.data===void 0?{message:a??r??i.defaultError}:t.code===`invalid_type`?{message:a??n??i.defaultError}:{message:i.defaultError}},description:i}}var J=class{get description(){return this._def.description}_getType(e){return bc(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:bc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ec,ctx:{common:e.parent.common,data:e.data,parsedType:bc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Mc(t))throw Error(`Synchronous parse encountered promise.`);return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bc(e)};return Pc(n,this._parseSync({data:e,path:n.path,parent:n}))}"~validate"(e){let t={common:{issues:[],async:!!this[`~standard`].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bc(e)};if(!this[`~standard`].async)try{let n=this._parseSync({data:e,path:[],parent:t});return jc(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes(`encountered`)&&(this[`~standard`].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>jc(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bc(e)},r=this._parse({data:e,path:n.path,parent:n});return Pc(n,await(Mc(r)?r:Promise.resolve(r)))}refine(e,t){let n=e=>typeof t==`string`||t===void 0?{message:t}:typeof t==`function`?t(e):t;return this._refinement((t,r)=>{let i=e(t),a=()=>r.addIssue({code:U.custom,...n(t)});return typeof Promise<`u`&&i instanceof Promise?i.then(e=>e?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,r)=>e(n)?!0:(r.addIssue(typeof t==`function`?t(n,r):t),!1))}_refinement(e){return new Il({schema:this,typeName:Y.ZodEffects,effect:{type:`refinement`,refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this[`~standard`]={version:1,vendor:`zod`,validate:e=>this[`~validate`](e)}}optional(){return Ll.create(this,this._def)}nullable(){return Rl.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return _l.create(this)}promise(){return Fl.create(this,this._def)}or(e){return bl.create([this,e],this._def)}and(e){return wl.create(this,e,this._def)}transform(e){return new Il({...q(this._def),schema:this,typeName:Y.ZodEffects,effect:{type:`transform`,transform:e}})}default(e){let t=typeof e==`function`?e:()=>e;return new zl({...q(this._def),innerType:this,defaultValue:t,typeName:Y.ZodDefault})}brand(){return new Hl({typeName:Y.ZodBranded,type:this,...q(this._def)})}catch(e){let t=typeof e==`function`?e:()=>e;return new Bl({...q(this._def),innerType:this,catchValue:t,typeName:Y.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ul.create(this,e)}readonly(){return Wl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const Fc=/^c[^\s-]{8,}$/i,Ic=/^[0-9a-z]+$/,Lc=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Rc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,zc=/^[a-z0-9_-]{21}$/i,Bc=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Vc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Hc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Uc;const Wc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Gc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Kc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,qc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Jc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Yc=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Xc=`((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))`,Zc=RegExp(`^${Xc}$`);function Qc(e){let t=`[0-5]\\d`;e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision??(t=`${t}(\\.\\d+)?`);let n=e.precision?`+`:`?`;return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function $c(e){return RegExp(`^${Qc(e)}$`)}function el(e){let t=`${Xc}T${Qc(e)}`,n=[];return n.push(e.local?`Z?`:`Z`),e.offset&&n.push(`([+-]\\d{2}:?\\d{2})`),t=`${t}(${n.join(`|`)})`,RegExp(`^${t}$`)}function tl(e,t){return!!((t===`v4`||!t)&&Wc.test(e)||(t===`v6`||!t)&&Kc.test(e))}function nl(e,t){if(!Bc.test(e))return!1;try{let[n]=e.split(`.`);if(!n)return!1;let r=n.replace(/-/g,`+`).replace(/_/g,`/`).padEnd(n.length+(4-n.length%4)%4,`=`),i=JSON.parse(atob(r));return!(typeof i!=`object`||!i||`typ`in i&&i?.typ!==`JWT`||!i.alg||t&&i.alg!==t)}catch{return!1}}function rl(e,t){return!!((t===`v4`||!t)&&Gc.test(e)||(t===`v6`||!t)&&qc.test(e))}var il=class e extends J{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==H.string){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.string,received:t.parsedType}),G}let t=new Ec,n;for(let r of this._def.checks)if(r.kind===`min`)e.data.length<r.value&&(n=this._getOrReturnCtx(e,n),W(n,{code:U.too_small,minimum:r.value,type:`string`,inclusive:!0,exact:!1,message:r.message}),t.dirty());else if(r.kind===`max`)e.data.length>r.value&&(n=this._getOrReturnCtx(e,n),W(n,{code:U.too_big,maximum:r.value,type:`string`,inclusive:!0,exact:!1,message:r.message}),t.dirty());else if(r.kind===`length`){let i=e.data.length>r.value,a=e.data.length<r.value;(i||a)&&(n=this._getOrReturnCtx(e,n),i?W(n,{code:U.too_big,maximum:r.value,type:`string`,inclusive:!0,exact:!0,message:r.message}):a&&W(n,{code:U.too_small,minimum:r.value,type:`string`,inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if(r.kind===`email`)Hc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`email`,code:U.invalid_string,message:r.message}),t.dirty());else if(r.kind===`emoji`)Uc||=RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`),Uc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`emoji`,code:U.invalid_string,message:r.message}),t.dirty());else if(r.kind===`uuid`)Rc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`uuid`,code:U.invalid_string,message:r.message}),t.dirty());else if(r.kind===`nanoid`)zc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`nanoid`,code:U.invalid_string,message:r.message}),t.dirty());else if(r.kind===`cuid`)Fc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`cuid`,code:U.invalid_string,message:r.message}),t.dirty());else if(r.kind===`cuid2`)Ic.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`cuid2`,code:U.invalid_string,message:r.message}),t.dirty());else if(r.kind===`ulid`)Lc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`ulid`,code:U.invalid_string,message:r.message}),t.dirty());else if(r.kind===`url`)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),W(n,{validation:`url`,code:U.invalid_string,message:r.message}),t.dirty()}else r.kind===`regex`?(r.regex.lastIndex=0,r.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`regex`,code:U.invalid_string,message:r.message}),t.dirty())):r.kind===`trim`?e.data=e.data.trim():r.kind===`includes`?e.data.includes(r.value,r.position)||(n=this._getOrReturnCtx(e,n),W(n,{code:U.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty()):r.kind===`toLowerCase`?e.data=e.data.toLowerCase():r.kind===`toUpperCase`?e.data=e.data.toUpperCase():r.kind===`startsWith`?e.data.startsWith(r.value)||(n=this._getOrReturnCtx(e,n),W(n,{code:U.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty()):r.kind===`endsWith`?e.data.endsWith(r.value)||(n=this._getOrReturnCtx(e,n),W(n,{code:U.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty()):r.kind===`datetime`?el(r).test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:U.invalid_string,validation:`datetime`,message:r.message}),t.dirty()):r.kind===`date`?Zc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:U.invalid_string,validation:`date`,message:r.message}),t.dirty()):r.kind===`time`?$c(r).test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:U.invalid_string,validation:`time`,message:r.message}),t.dirty()):r.kind===`duration`?Vc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`duration`,code:U.invalid_string,message:r.message}),t.dirty()):r.kind===`ip`?tl(e.data,r.version)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`ip`,code:U.invalid_string,message:r.message}),t.dirty()):r.kind===`jwt`?nl(e.data,r.alg)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`jwt`,code:U.invalid_string,message:r.message}),t.dirty()):r.kind===`cidr`?rl(e.data,r.version)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`cidr`,code:U.invalid_string,message:r.message}),t.dirty()):r.kind===`base64`?Jc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`base64`,code:U.invalid_string,message:r.message}),t.dirty()):r.kind===`base64url`?Yc.test(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{validation:`base64url`,code:U.invalid_string,message:r.message}),t.dirty()):V.assertNever(r);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:U.invalid_string,...K.errToObj(n)})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}email(e){return this._addCheck({kind:`email`,...K.errToObj(e)})}url(e){return this._addCheck({kind:`url`,...K.errToObj(e)})}emoji(e){return this._addCheck({kind:`emoji`,...K.errToObj(e)})}uuid(e){return this._addCheck({kind:`uuid`,...K.errToObj(e)})}nanoid(e){return this._addCheck({kind:`nanoid`,...K.errToObj(e)})}cuid(e){return this._addCheck({kind:`cuid`,...K.errToObj(e)})}cuid2(e){return this._addCheck({kind:`cuid2`,...K.errToObj(e)})}ulid(e){return this._addCheck({kind:`ulid`,...K.errToObj(e)})}base64(e){return this._addCheck({kind:`base64`,...K.errToObj(e)})}base64url(e){return this._addCheck({kind:`base64url`,...K.errToObj(e)})}jwt(e){return this._addCheck({kind:`jwt`,...K.errToObj(e)})}ip(e){return this._addCheck({kind:`ip`,...K.errToObj(e)})}cidr(e){return this._addCheck({kind:`cidr`,...K.errToObj(e)})}datetime(e){return typeof e==`string`?this._addCheck({kind:`datetime`,precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:`datetime`,precision:e?.precision===void 0?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...K.errToObj(e?.message)})}date(e){return this._addCheck({kind:`date`,message:e})}time(e){return typeof e==`string`?this._addCheck({kind:`time`,precision:null,message:e}):this._addCheck({kind:`time`,precision:e?.precision===void 0?null:e?.precision,...K.errToObj(e?.message)})}duration(e){return this._addCheck({kind:`duration`,...K.errToObj(e)})}regex(e,t){return this._addCheck({kind:`regex`,regex:e,...K.errToObj(t)})}includes(e,t){return this._addCheck({kind:`includes`,value:e,position:t?.position,...K.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:`startsWith`,value:e,...K.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:`endsWith`,value:e,...K.errToObj(t)})}min(e,t){return this._addCheck({kind:`min`,value:e,...K.errToObj(t)})}max(e,t){return this._addCheck({kind:`max`,value:e,...K.errToObj(t)})}length(e,t){return this._addCheck({kind:`length`,value:e,...K.errToObj(t)})}nonempty(e){return this.min(1,K.errToObj(e))}trim(){return new e({...this._def,checks:[...this._def.checks,{kind:`trim`}]})}toLowerCase(){return new e({...this._def,checks:[...this._def.checks,{kind:`toLowerCase`}]})}toUpperCase(){return new e({...this._def,checks:[...this._def.checks,{kind:`toUpperCase`}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind===`datetime`)}get isDate(){return!!this._def.checks.find(e=>e.kind===`date`)}get isTime(){return!!this._def.checks.find(e=>e.kind===`time`)}get isDuration(){return!!this._def.checks.find(e=>e.kind===`duration`)}get isEmail(){return!!this._def.checks.find(e=>e.kind===`email`)}get isURL(){return!!this._def.checks.find(e=>e.kind===`url`)}get isEmoji(){return!!this._def.checks.find(e=>e.kind===`emoji`)}get isUUID(){return!!this._def.checks.find(e=>e.kind===`uuid`)}get isNANOID(){return!!this._def.checks.find(e=>e.kind===`nanoid`)}get isCUID(){return!!this._def.checks.find(e=>e.kind===`cuid`)}get isCUID2(){return!!this._def.checks.find(e=>e.kind===`cuid2`)}get isULID(){return!!this._def.checks.find(e=>e.kind===`ulid`)}get isIP(){return!!this._def.checks.find(e=>e.kind===`ip`)}get isCIDR(){return!!this._def.checks.find(e=>e.kind===`cidr`)}get isBase64(){return!!this._def.checks.find(e=>e.kind===`base64`)}get isBase64url(){return!!this._def.checks.find(e=>e.kind===`base64url`)}get minLength(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e}};il.create=e=>new il({checks:[],typeName:Y.ZodString,coerce:e?.coerce??!1,...q(e)});function al(e,t){let n=(e.toString().split(`.`)[1]||``).length,r=(t.toString().split(`.`)[1]||``).length,i=n>r?n:r;return Number.parseInt(e.toFixed(i).replace(`.`,``))%Number.parseInt(t.toFixed(i).replace(`.`,``))/10**i}var ol=class e extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==H.number){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.number,received:t.parsedType}),G}let t,n=new Ec;for(let r of this._def.checks)r.kind===`int`?V.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),W(t,{code:U.invalid_type,expected:`integer`,received:`float`,message:r.message}),n.dirty()):r.kind===`min`?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),W(t,{code:U.too_small,minimum:r.value,type:`number`,inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):r.kind===`max`?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),W(t,{code:U.too_big,maximum:r.value,type:`number`,inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):r.kind===`multipleOf`?al(e.data,r.value)!==0&&(t=this._getOrReturnCtx(e,t),W(t,{code:U.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):r.kind===`finite`?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),W(t,{code:U.not_finite,message:r.message}),n.dirty()):V.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit(`min`,e,!0,K.toString(t))}gt(e,t){return this.setLimit(`min`,e,!1,K.toString(t))}lte(e,t){return this.setLimit(`max`,e,!0,K.toString(t))}lt(e,t){return this.setLimit(`max`,e,!1,K.toString(t))}setLimit(t,n,r,i){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:K.toString(i)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}int(e){return this._addCheck({kind:`int`,message:K.toString(e)})}positive(e){return this._addCheck({kind:`min`,value:0,inclusive:!1,message:K.toString(e)})}negative(e){return this._addCheck({kind:`max`,value:0,inclusive:!1,message:K.toString(e)})}nonpositive(e){return this._addCheck({kind:`max`,value:0,inclusive:!0,message:K.toString(e)})}nonnegative(e){return this._addCheck({kind:`min`,value:0,inclusive:!0,message:K.toString(e)})}multipleOf(e,t){return this._addCheck({kind:`multipleOf`,value:e,message:K.toString(t)})}finite(e){return this._addCheck({kind:`finite`,message:K.toString(e)})}safe(e){return this._addCheck({kind:`min`,inclusive:!0,value:-(2**53-1),message:K.toString(e)})._addCheck({kind:`max`,inclusive:!0,value:2**53-1,message:K.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind===`int`||e.kind===`multipleOf`&&V.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks)if(n.kind===`finite`||n.kind===`int`||n.kind===`multipleOf`)return!0;else n.kind===`min`?(t===null||n.value>t)&&(t=n.value):n.kind===`max`&&(e===null||n.value<e)&&(e=n.value);return Number.isFinite(t)&&Number.isFinite(e)}};ol.create=e=>new ol({checks:[],typeName:Y.ZodNumber,coerce:e?.coerce||!1,...q(e)});var sl=class e extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==H.bigint)return this._getInvalidInput(e);let t,n=new Ec;for(let r of this._def.checks)r.kind===`min`?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),W(t,{code:U.too_small,type:`bigint`,minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):r.kind===`max`?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),W(t,{code:U.too_big,type:`bigint`,maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):r.kind===`multipleOf`?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),W(t,{code:U.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):V.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.bigint,received:t.parsedType}),G}gte(e,t){return this.setLimit(`min`,e,!0,K.toString(t))}gt(e,t){return this.setLimit(`min`,e,!1,K.toString(t))}lte(e,t){return this.setLimit(`max`,e,!0,K.toString(t))}lt(e,t){return this.setLimit(`max`,e,!1,K.toString(t))}setLimit(t,n,r,i){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:K.toString(i)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}positive(e){return this._addCheck({kind:`min`,value:BigInt(0),inclusive:!1,message:K.toString(e)})}negative(e){return this._addCheck({kind:`max`,value:BigInt(0),inclusive:!1,message:K.toString(e)})}nonpositive(e){return this._addCheck({kind:`max`,value:BigInt(0),inclusive:!0,message:K.toString(e)})}nonnegative(e){return this._addCheck({kind:`min`,value:BigInt(0),inclusive:!0,message:K.toString(e)})}multipleOf(e,t){return this._addCheck({kind:`multipleOf`,value:e,message:K.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e}};sl.create=e=>new sl({checks:[],typeName:Y.ZodBigInt,coerce:e?.coerce??!1,...q(e)});var cl=class extends J{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==H.boolean){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.boolean,received:t.parsedType}),G}return Oc(e.data)}};cl.create=e=>new cl({typeName:Y.ZodBoolean,coerce:e?.coerce||!1,...q(e)});var ll=class e extends J{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==H.date){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.date,received:t.parsedType}),G}if(Number.isNaN(e.data.getTime()))return W(this._getOrReturnCtx(e),{code:U.invalid_date}),G;let t=new Ec,n;for(let r of this._def.checks)r.kind===`min`?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),W(n,{code:U.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:`date`}),t.dirty()):r.kind===`max`?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),W(n,{code:U.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:`date`}),t.dirty()):V.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}min(e,t){return this._addCheck({kind:`min`,value:e.getTime(),message:K.toString(t)})}max(e,t){return this._addCheck({kind:`max`,value:e.getTime(),message:K.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e==null?null:new Date(e)}};ll.create=e=>new ll({checks:[],coerce:e?.coerce||!1,typeName:Y.ZodDate,...q(e)});var ul=class extends J{_parse(e){if(this._getType(e)!==H.symbol){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.symbol,received:t.parsedType}),G}return Oc(e.data)}};ul.create=e=>new ul({typeName:Y.ZodSymbol,...q(e)});var dl=class extends J{_parse(e){if(this._getType(e)!==H.undefined){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.undefined,received:t.parsedType}),G}return Oc(e.data)}};dl.create=e=>new dl({typeName:Y.ZodUndefined,...q(e)});var fl=class extends J{_parse(e){if(this._getType(e)!==H.null){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.null,received:t.parsedType}),G}return Oc(e.data)}};fl.create=e=>new fl({typeName:Y.ZodNull,...q(e)});var pl=class extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return Oc(e.data)}};pl.create=e=>new pl({typeName:Y.ZodAny,...q(e)});var ml=class extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Oc(e.data)}};ml.create=e=>new ml({typeName:Y.ZodUnknown,...q(e)});var hl=class extends J{_parse(e){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.never,received:t.parsedType}),G}};hl.create=e=>new hl({typeName:Y.ZodNever,...q(e)});var gl=class extends J{_parse(e){if(this._getType(e)!==H.undefined){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.void,received:t.parsedType}),G}return Oc(e.data)}};gl.create=e=>new gl({typeName:Y.ZodVoid,...q(e)});var _l=class e extends J{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==H.array)return W(t,{code:U.invalid_type,expected:H.array,received:t.parsedType}),G;if(r.exactLength!==null){let e=t.data.length>r.exactLength.value,i=t.data.length<r.exactLength.value;(e||i)&&(W(t,{code:e?U.too_big:U.too_small,minimum:i?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:`array`,inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(W(t,{code:U.too_small,minimum:r.minLength.value,type:`array`,inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(W(t,{code:U.too_big,maximum:r.maxLength.value,type:`array`,inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new Nc(t,e,t.path,n)))).then(e=>Ec.mergeArray(n,e));let i=[...t.data].map((e,n)=>r.type._parseSync(new Nc(t,e,t.path,n)));return Ec.mergeArray(n,i)}get element(){return this._def.type}min(t,n){return new e({...this._def,minLength:{value:t,message:K.toString(n)}})}max(t,n){return new e({...this._def,maxLength:{value:t,message:K.toString(n)}})}length(t,n){return new e({...this._def,exactLength:{value:t,message:K.toString(n)}})}nonempty(e){return this.min(1,e)}};_l.create=(e,t)=>new _l({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Y.ZodArray,...q(t)});function vl(e){if(e instanceof yl){let t={};for(let n in e.shape){let r=e.shape[n];t[n]=Ll.create(vl(r))}return new yl({...e._def,shape:()=>t})}else if(e instanceof _l)return new _l({...e._def,type:vl(e.element)});else if(e instanceof Ll)return Ll.create(vl(e.unwrap()));else if(e instanceof Rl)return Rl.create(vl(e.unwrap()));else if(e instanceof Tl)return Tl.create(e.items.map(e=>vl(e)));else return e}var yl=class e extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:V.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==H.object){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.object,received:t.parsedType}),G}let{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof hl&&this._def.unknownKeys===`strip`))for(let e in n.data)i.includes(e)||a.push(e);let o=[];for(let e of i){let t=r[e],i=n.data[e];o.push({key:{status:`valid`,value:e},value:t._parse(new Nc(n,i,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof hl){let e=this._def.unknownKeys;if(e===`passthrough`)for(let e of a)o.push({key:{status:`valid`,value:e},value:{status:`valid`,value:n.data[e]}});else if(e===`strict`)a.length>0&&(W(n,{code:U.unrecognized_keys,keys:a}),t.dirty());else if(e!==`strip`)throw Error(`Internal ZodObject error: invalid unknownKeys value.`)}else{let e=this._def.catchall;for(let t of a){let r=n.data[t];o.push({key:{status:`valid`,value:t},value:e._parse(new Nc(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of o){let n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>Ec.mergeObjectSync(t,e)):Ec.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(t){return K.errToObj,new e({...this._def,unknownKeys:`strict`,...t===void 0?{}:{errorMap:(e,n)=>{let r=this._def.errorMap?.(e,n).message??n.defaultError;return e.code===`unrecognized_keys`?{message:K.errToObj(t).message??r}:{message:r}}}})}strip(){return new e({...this._def,unknownKeys:`strip`})}passthrough(){return new e({...this._def,unknownKeys:`passthrough`})}extend(t){return new e({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new e({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Y.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(t){return new e({...this._def,catchall:t})}pick(t){let n={};for(let e of V.objectKeys(t))t[e]&&this.shape[e]&&(n[e]=this.shape[e]);return new e({...this._def,shape:()=>n})}omit(t){let n={};for(let e of V.objectKeys(this.shape))t[e]||(n[e]=this.shape[e]);return new e({...this._def,shape:()=>n})}deepPartial(){return vl(this)}partial(t){let n={};for(let e of V.objectKeys(this.shape)){let r=this.shape[e];t&&!t[e]?n[e]=r:n[e]=r.optional()}return new e({...this._def,shape:()=>n})}required(t){let n={};for(let e of V.objectKeys(this.shape))if(t&&!t[e])n[e]=this.shape[e];else{let t=this.shape[e];for(;t instanceof Ll;)t=t._def.innerType;n[e]=t}return new e({...this._def,shape:()=>n})}keyof(){return Ml(V.objectKeys(this.shape))}};yl.create=(e,t)=>new yl({shape:()=>e,unknownKeys:`strip`,catchall:hl.create(),typeName:Y.ZodObject,...q(t)}),yl.strictCreate=(e,t)=>new yl({shape:()=>e,unknownKeys:`strict`,catchall:hl.create(),typeName:Y.ZodObject,...q(t)}),yl.lazycreate=(e,t)=>new yl({shape:e,unknownKeys:`strip`,catchall:hl.create(),typeName:Y.ZodObject,...q(t)});var bl=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function r(e){for(let t of e)if(t.result.status===`valid`)return t.result;for(let n of e)if(n.result.status===`dirty`)return t.common.issues.push(...n.ctx.common.issues),n.result;let n=e.map(e=>new xc(e.ctx.common.issues));return W(t,{code:U.invalid_union,unionErrors:n}),G}if(t.common.async)return Promise.all(n.map(async e=>{let n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(r);{let e,r=[];for(let i of n){let n={...t,common:{...t.common,issues:[]},parent:null},a=i._parseSync({data:t.data,path:t.path,parent:n});if(a.status===`valid`)return a;a.status===`dirty`&&!e&&(e={result:a,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=r.map(e=>new xc(e));return W(t,{code:U.invalid_union,unionErrors:i}),G}}get options(){return this._def.options}};bl.create=(e,t)=>new bl({options:e,typeName:Y.ZodUnion,...q(t)});const xl=e=>e instanceof Al?xl(e.schema):e instanceof Il?xl(e.innerType()):e instanceof jl?[e.value]:e instanceof Nl?e.options:e instanceof Pl?V.objectValues(e.enum):e instanceof zl?xl(e._def.innerType):e instanceof dl?[void 0]:e instanceof fl?[null]:e instanceof Ll?[void 0,...xl(e.unwrap())]:e instanceof Rl?[null,...xl(e.unwrap())]:e instanceof Hl||e instanceof Wl?xl(e.unwrap()):e instanceof Bl?xl(e._def.innerType):[];var Sl=class e extends J{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==H.object)return W(t,{code:U.invalid_type,expected:H.object,received:t.parsedType}),G;let n=this.discriminator,r=t.data[n],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(W(t,{code:U.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),G)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){let i=new Map;for(let e of n){let n=xl(e.shape[t]);if(!n.length)throw Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let r of n){if(i.has(r))throw Error(`Discriminator property ${String(t)} has duplicate value ${String(r)}`);i.set(r,e)}}return new e({typeName:Y.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:i,...q(r)})}};function Cl(e,t){let n=bc(e),r=bc(t);if(e===t)return{valid:!0,data:e};if(n===H.object&&r===H.object){let n=V.objectKeys(t),r=V.objectKeys(e).filter(e=>n.indexOf(e)!==-1),i={...e,...t};for(let n of r){let r=Cl(e[n],t[n]);if(!r.valid)return{valid:!1};i[n]=r.data}return{valid:!0,data:i}}else if(n===H.array&&r===H.array){if(e.length!==t.length)return{valid:!1};let n=[];for(let r=0;r<e.length;r++){let i=e[r],a=t[r],o=Cl(i,a);if(!o.valid)return{valid:!1};n.push(o.data)}return{valid:!0,data:n}}else if(n===H.date&&r===H.date&&+e==+t)return{valid:!0,data:e};else return{valid:!1}}var wl=class extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(kc(e)||kc(r))return G;let i=Cl(e.value,r.value);return i.valid?((Ac(e)||Ac(r))&&t.dirty(),{status:t.value,value:i.data}):(W(n,{code:U.invalid_intersection_types}),G)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};wl.create=(e,t,n)=>new wl({left:e,right:t,typeName:Y.ZodIntersection,...q(n)});var Tl=class e extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.array)return W(n,{code:U.invalid_type,expected:H.array,received:n.parsedType}),G;if(n.data.length<this._def.items.length)return W(n,{code:U.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:`array`}),G;!this._def.rest&&n.data.length>this._def.items.length&&(W(n,{code:U.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:`array`}),t.dirty());let r=[...n.data].map((e,t)=>{let r=this._def.items[t]||this._def.rest;return r?r._parse(new Nc(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>Ec.mergeArray(t,e)):Ec.mergeArray(t,r)}get items(){return this._def.items}rest(t){return new e({...this._def,rest:t})}};Tl.create=(e,t)=>{if(!Array.isArray(e))throw Error(`You must pass an array of schemas to z.tuple([ ... ])`);return new Tl({items:e,typeName:Y.ZodTuple,rest:null,...q(t)})};var El=class e extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.object)return W(n,{code:U.invalid_type,expected:H.object,received:n.parsedType}),G;let r=[],i=this._def.keyType,a=this._def.valueType;for(let e in n.data)r.push({key:i._parse(new Nc(n,e,n.path,e)),value:a._parse(new Nc(n,n.data[e],n.path,e)),alwaysSet:e in n.data});return n.common.async?Ec.mergeObjectAsync(t,r):Ec.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof J?new e({keyType:t,valueType:n,typeName:Y.ZodRecord,...q(r)}):new e({keyType:il.create(),valueType:t,typeName:Y.ZodRecord,...q(n)})}},Dl=class extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.map)return W(n,{code:U.invalid_type,expected:H.map,received:n.parsedType}),G;let r=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([e,t],a)=>({key:r._parse(new Nc(n,e,n.path,[a,`key`])),value:i._parse(new Nc(n,t,n.path,[a,`value`]))}));if(n.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let n of a){let r=await n.key,i=await n.value;if(r.status===`aborted`||i.status===`aborted`)return G;(r.status===`dirty`||i.status===`dirty`)&&t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}})}else{let e=new Map;for(let n of a){let r=n.key,i=n.value;if(r.status===`aborted`||i.status===`aborted`)return G;(r.status===`dirty`||i.status===`dirty`)&&t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}}};Dl.create=(e,t,n)=>new Dl({valueType:t,keyType:e,typeName:Y.ZodMap,...q(n)});var Ol=class e extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==H.set)return W(n,{code:U.invalid_type,expected:H.set,received:n.parsedType}),G;let r=this._def;r.minSize!==null&&n.data.size<r.minSize.value&&(W(n,{code:U.too_small,minimum:r.minSize.value,type:`set`,inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&n.data.size>r.maxSize.value&&(W(n,{code:U.too_big,maximum:r.maxSize.value,type:`set`,inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());let i=this._def.valueType;function a(e){let n=new Set;for(let r of e){if(r.status===`aborted`)return G;r.status===`dirty`&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}let o=[...n.data.values()].map((e,t)=>i._parse(new Nc(n,e,n.path,t)));return n.common.async?Promise.all(o).then(e=>a(e)):a(o)}min(t,n){return new e({...this._def,minSize:{value:t,message:K.toString(n)}})}max(t,n){return new e({...this._def,maxSize:{value:t,message:K.toString(n)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Ol.create=(e,t)=>new Ol({valueType:e,minSize:null,maxSize:null,typeName:Y.ZodSet,...q(t)});var kl=class e extends J{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==H.function)return W(t,{code:U.invalid_type,expected:H.function,received:t.parsedType}),G;function n(e,n){return Tc({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,wc(),Sc].filter(e=>!!e),issueData:{code:U.invalid_arguments,argumentsError:n}})}function r(e,n){return Tc({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,wc(),Sc].filter(e=>!!e),issueData:{code:U.invalid_return_type,returnTypeError:n}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Fl){let e=this;return Oc(async function(...t){let o=new xc([]),s=await e._def.args.parseAsync(t,i).catch(e=>{throw o.addIssue(n(t,e)),o}),c=await Reflect.apply(a,this,s);return await e._def.returns._def.type.parseAsync(c,i).catch(e=>{throw o.addIssue(r(c,e)),o})})}else{let e=this;return Oc(function(...t){let o=e._def.args.safeParse(t,i);if(!o.success)throw new xc([n(t,o.error)]);let s=Reflect.apply(a,this,o.data),c=e._def.returns.safeParse(s,i);if(!c.success)throw new xc([r(s,c.error)]);return c.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new e({...this._def,args:Tl.create(t).rest(ml.create())})}returns(t){return new e({...this._def,returns:t})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(t,n,r){return new e({args:t||Tl.create([]).rest(ml.create()),returns:n||ml.create(),typeName:Y.ZodFunction,...q(r)})}},Al=class extends J{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Al.create=(e,t)=>new Al({getter:e,typeName:Y.ZodLazy,...q(t)});var jl=class extends J{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return W(t,{received:t.data,code:U.invalid_literal,expected:this._def.value}),G}return{status:`valid`,value:e.data}}get value(){return this._def.value}};jl.create=(e,t)=>new jl({value:e,typeName:Y.ZodLiteral,...q(t)});function Ml(e,t){return new Nl({values:e,typeName:Y.ZodEnum,...q(t)})}var Nl=class e extends J{_parse(e){if(typeof e.data!=`string`){let t=this._getOrReturnCtx(e),n=this._def.values;return W(t,{expected:V.joinValues(n),received:t.parsedType,code:U.invalid_type}),G}if(this._cache||=new Set(this._def.values),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return W(t,{received:t.data,code:U.invalid_enum_value,options:n}),G}return Oc(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(t,n=this._def){return e.create(t,{...this._def,...n})}exclude(t,n=this._def){return e.create(this.options.filter(e=>!t.includes(e)),{...this._def,...n})}};Nl.create=Ml;var Pl=class extends J{_parse(e){let t=V.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==H.string&&n.parsedType!==H.number){let e=V.objectValues(t);return W(n,{expected:V.joinValues(e),received:n.parsedType,code:U.invalid_type}),G}if(this._cache||=new Set(V.getValidEnumValues(this._def.values)),!this._cache.has(e.data)){let e=V.objectValues(t);return W(n,{received:n.data,code:U.invalid_enum_value,options:e}),G}return Oc(e.data)}get enum(){return this._def.values}};Pl.create=(e,t)=>new Pl({values:e,typeName:Y.ZodNativeEnum,...q(t)});var Fl=class extends J{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==H.promise&&t.common.async===!1?(W(t,{code:U.invalid_type,expected:H.promise,received:t.parsedType}),G):Oc((t.parsedType===H.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Fl.create=(e,t)=>new Fl({type:e,typeName:Y.ZodPromise,...q(t)});var Il=class extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:e=>{W(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),r.type===`preprocess`){let e=r.transform(n.data,i);if(n.common.async)return Promise.resolve(e).then(async e=>{if(t.value===`aborted`)return G;let r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return r.status===`aborted`?G:r.status===`dirty`||t.value===`dirty`?Dc(r.value):r});{if(t.value===`aborted`)return G;let r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return r.status===`aborted`?G:r.status===`dirty`||t.value===`dirty`?Dc(r.value):r}}if(r.type===`refinement`){let e=e=>{let t=r.refinement(e,i);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error(`Async refinement encountered during synchronous parse operation. Use .parseAsync instead.`);return e};if(n.common.async===!1){let r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return r.status===`aborted`?G:(r.status===`dirty`&&t.dirty(),e(r.value),{status:t.value,value:r.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>n.status===`aborted`?G:(n.status===`dirty`&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if(r.type===`transform`)if(n.common.async===!1){let e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!jc(e))return G;let a=r.transform(e.value,i);if(a instanceof Promise)throw Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>jc(e)?Promise.resolve(r.transform(e.value,i)).then(e=>({status:t.value,value:e})):G);V.assertNever(r)}};Il.create=(e,t,n)=>new Il({schema:e,typeName:Y.ZodEffects,effect:t,...q(n)}),Il.createWithPreprocess=(e,t,n)=>new Il({schema:t,effect:{type:`preprocess`,transform:e},typeName:Y.ZodEffects,...q(n)});var Ll=class extends J{_parse(e){return this._getType(e)===H.undefined?Oc(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ll.create=(e,t)=>new Ll({innerType:e,typeName:Y.ZodOptional,...q(t)});var Rl=class extends J{_parse(e){return this._getType(e)===H.null?Oc(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Rl.create=(e,t)=>new Rl({innerType:e,typeName:Y.ZodNullable,...q(t)});var zl=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===H.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};zl.create=(e,t)=>new zl({innerType:e,typeName:Y.ZodDefault,defaultValue:typeof t.default==`function`?t.default:()=>t.default,...q(t)});var Bl=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Mc(r)?r.then(e=>({status:`valid`,value:e.status===`valid`?e.value:this._def.catchValue({get error(){return new xc(n.common.issues)},input:n.data})})):{status:`valid`,value:r.status===`valid`?r.value:this._def.catchValue({get error(){return new xc(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Bl.create=(e,t)=>new Bl({innerType:e,typeName:Y.ZodCatch,catchValue:typeof t.catch==`function`?t.catch:()=>t.catch,...q(t)});var Vl=class extends J{_parse(e){if(this._getType(e)!==H.nan){let t=this._getOrReturnCtx(e);return W(t,{code:U.invalid_type,expected:H.nan,received:t.parsedType}),G}return{status:`valid`,value:e.data}}};Vl.create=e=>new Vl({typeName:Y.ZodNaN,...q(e)});var Hl=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Ul=class e extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return e.status===`aborted`?G:e.status===`dirty`?(t.dirty(),Dc(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{let e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return e.status===`aborted`?G:e.status===`dirty`?(t.dirty(),{status:`dirty`,value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(t,n){return new e({in:t,out:n,typeName:Y.ZodPipeline})}},Wl=class extends J{_parse(e){let t=this._def.innerType._parse(e),n=e=>(jc(e)&&(e.value=Object.freeze(e.value)),e);return Mc(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}};Wl.create=(e,t)=>new Wl({innerType:e,typeName:Y.ZodReadonly,...q(t)}),yl.lazycreate;var Y;(function(e){e.ZodString=`ZodString`,e.ZodNumber=`ZodNumber`,e.ZodNaN=`ZodNaN`,e.ZodBigInt=`ZodBigInt`,e.ZodBoolean=`ZodBoolean`,e.ZodDate=`ZodDate`,e.ZodSymbol=`ZodSymbol`,e.ZodUndefined=`ZodUndefined`,e.ZodNull=`ZodNull`,e.ZodAny=`ZodAny`,e.ZodUnknown=`ZodUnknown`,e.ZodNever=`ZodNever`,e.ZodVoid=`ZodVoid`,e.ZodArray=`ZodArray`,e.ZodObject=`ZodObject`,e.ZodUnion=`ZodUnion`,e.ZodDiscriminatedUnion=`ZodDiscriminatedUnion`,e.ZodIntersection=`ZodIntersection`,e.ZodTuple=`ZodTuple`,e.ZodRecord=`ZodRecord`,e.ZodMap=`ZodMap`,e.ZodSet=`ZodSet`,e.ZodFunction=`ZodFunction`,e.ZodLazy=`ZodLazy`,e.ZodLiteral=`ZodLiteral`,e.ZodEnum=`ZodEnum`,e.ZodEffects=`ZodEffects`,e.ZodNativeEnum=`ZodNativeEnum`,e.ZodOptional=`ZodOptional`,e.ZodNullable=`ZodNullable`,e.ZodDefault=`ZodDefault`,e.ZodCatch=`ZodCatch`,e.ZodPromise=`ZodPromise`,e.ZodBranded=`ZodBranded`,e.ZodPipeline=`ZodPipeline`,e.ZodReadonly=`ZodReadonly`})(Y||={}),il.create,ol.create,Vl.create,sl.create,cl.create,ll.create,ul.create,dl.create,fl.create,pl.create,ml.create,hl.create,gl.create,_l.create,yl.create,yl.strictCreate,bl.create,Sl.create,wl.create,Tl.create,El.create,Dl.create,Ol.create,kl.create,Al.create,jl.create,Nl.create,Pl.create,Fl.create,Il.create,Ll.create,Rl.create,Il.createWithPreprocess,Ul.create;var Gl=class extends Error{constructor(e,t){super(e),this.name=`ParseError`,this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function Kl(e){}function ql(e){if(typeof e==`function`)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=Kl,onError:n=Kl,onRetry:r=Kl,onComment:i}=e,a=``,o=!0,s,c=``,l=``;function u(e){let t=o?e.replace(/^\xEF\xBB\xBF/,``):e,[n,r]=Jl(`${a}${t}`);for(let e of n)d(e);a=r,o=!1}function d(e){if(e===``){p();return}if(e.startsWith(`:`)){i&&i(e.slice(e.startsWith(`: `)?2:1));return}let t=e.indexOf(`:`);if(t!==-1){let n=e.slice(0,t),r=e[t+1]===` `?2:1;f(n,e.slice(t+r),e);return}f(e,``,e)}function f(e,t,i){switch(e){case`event`:l=t;break;case`data`:c=`${c}${t}
`;break;case`id`:s=t.includes(`\0`)?void 0:t;break;case`retry`:/^\d+$/.test(t)?r(parseInt(t,10)):n(new Gl(`Invalid \`retry\` value: "${t}"`,{type:`invalid-retry`,value:t,line:i}));break;default:n(new Gl(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:`unknown-field`,field:e,value:t,line:i}));break}}function p(){c.length>0&&t({id:s,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),s=void 0,c=``,l=``}function m(e={}){a&&e.consume&&d(a),o=!0,s=void 0,c=``,l=``,a=``}return{feed:u,reset:m}}function Jl(e){let t=[],n=``,r=0;for(;r<e.length;){let i=e.indexOf(`\r`,r),a=e.indexOf(`
`,r),o=-1;if(i!==-1&&a!==-1?o=Math.min(i,a):i===-1?a!==-1&&(o=a):o=i===e.length-1?-1:i,o===-1){n=e.slice(r);break}else{let n=e.slice(r,o);t.push(n),r=o+1,e[r-1]===`\r`&&e[r]===`
`&&r++}}return[t,n]}var Yl=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:n}={}){let r;super({start(i){r=ql({onEvent:e=>{i.enqueue(e)},onError(t){e===`terminate`?i.error(t):typeof e==`function`&&e(t)},onRetry:t,onComment:n})},transform(e){r.feed(e)}})}};function Xl(...e){return e.reduce((e,t)=>({...e,...t??{}}),{})}function Zl({tools:e=[],providerToolNames:t}){let n={},r={};for(let i of e)if(i.type===`provider`&&i.id in t){let e=t[i.id];n[i.name]=e,r[e]=i.name}return{toProviderToolName:e=>n[e]??e,toCustomToolName:e=>r[e]??e}}async function Ql(e,t){if(e==null)return Promise.resolve();let n=t?.abortSignal;return new Promise((t,r)=>{if(n?.aborted){r($l());return}let i=setTimeout(()=>{a(),t()},e),a=()=>{clearTimeout(i),n?.removeEventListener(`abort`,o)},o=()=>{a(),r($l())};n?.addEventListener(`abort`,o)})}function $l(){return new DOMException(`Delay was aborted`,`AbortError`)}var eu=class{constructor(){this.status={type:`pending`},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||=new Promise((e,t)=>{this.status.type===`resolved`?e(this.status.value):this.status.type===`rejected`&&t(this.status.error),this._resolve=e,this._reject=t}),this._promise}resolve(e){var t;this.status={type:`resolved`,value:e},this._promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:`rejected`,error:e},this._promise&&((t=this._reject)==null||t.call(this,e))}isResolved(){return this.status.type===`resolved`}isRejected(){return this.status.type===`rejected`}isPending(){return this.status.type===`pending`}};function tu(e){return Object.fromEntries([...e.headers])}var{btoa:nu,atob:ru}=globalThis;function iu(e){let t=ru(e.replace(/-/g,`+`).replace(/_/g,`/`));return Uint8Array.from(t,e=>e.codePointAt(0))}function au(e){let t=``;for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return nu(t)}function ou(e){return e instanceof Uint8Array?au(e):e}function su(e,t={}){let{useArrayBrackets:n=!0}=t,r=new FormData;for(let[t,i]of Object.entries(e))if(i!=null){if(Array.isArray(i)){if(i.length===1){r.append(t,i[0]);continue}let e=n?`${t}[]`:t;for(let t of i)r.append(e,t);continue}r.append(t,i)}return r}var cu=`AI_DownloadError`,lu=`vercel.ai.error.${cu}`,uu=Symbol.for(lu),du,fu,pu=class extends (fu=a,du=uu,fu){constructor({url:e,statusCode:t,statusText:n,cause:r,message:i=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:cu,message:i,cause:r}),this[du]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return a.hasMarker(e,lu)}};async function mu(e){try{let t=await fetch(e);if(!t.ok)throw new pu({url:e,statusCode:t.status,statusText:t.statusText});return await t.blob()}catch(t){throw pu.isInstance(t)?t:new pu({url:e,cause:t})}}var hu=({prefix:e,size:t=16,alphabet:n=`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`,separator:r=`-`}={})=>{let i=()=>{let e=n.length,r=Array(t);for(let i=0;i<t;i++)r[i]=n[Math.random()*e|0];return r.join(``)};if(e==null)return i;if(n.includes(r))throw new S({argument:`separator`,message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${i()}`},gu=hu();function _u(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}function vu(e){return(e instanceof Error||e instanceof DOMException)&&(e.name===`AbortError`||e.name===`ResponseAborted`||e.name===`TimeoutError`)}var yu=[`fetch failed`,`failed to fetch`];function bu({error:e,url:t,requestBodyValues:n}){if(vu(e))return e;if(e instanceof TypeError&&yu.includes(e.message.toLowerCase())){let r=e.cause;if(r!=null)return new d({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}function xu(e=globalThis){return e.window?`runtime/browser`:e.navigator?.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:e.process?.versions?.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?`runtime/vercel-edge`:`runtime/unknown`}function Su(e){if(e==null)return{};let t={};if(e instanceof Headers)e.forEach((e,n)=>{t[n.toLowerCase()]=e});else{Array.isArray(e)||(e=Object.entries(e));for(let[n,r]of e)r!=null&&(t[n.toLowerCase()]=r)}return t}function Cu(e,...t){let n=new Headers(Su(e)),r=n.get(`user-agent`)||``;return n.set(`user-agent`,[r,...t].filter(Boolean).join(` `)),Object.fromEntries(n.entries())}var wu=`4.0.8`,Tu=()=>globalThis.fetch,Eu=async({url:e,headers:t={},successfulResponseHandler:n,failedResponseHandler:r,abortSignal:i,fetch:a=Tu()})=>{try{let o=await a(e,{method:`GET`,headers:Cu(t,`ai-sdk/provider-utils/${wu}`,xu()),signal:i}),s=tu(o);if(!o.ok){let t;try{t=await r({response:o,url:e,requestBodyValues:{}})}catch(t){throw vu(t)||d.isInstance(t)?t:new d({message:`Failed to process error response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}throw t.value}try{return await n({response:o,url:e,requestBodyValues:{}})}catch(t){throw t instanceof Error&&(vu(t)||d.isInstance(t))?t:new d({message:`Failed to process successful response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}}catch(t){throw bu({error:t,url:e,requestBodyValues:{}})}},Du=`JSON schema:`,Ou=`You MUST answer with a JSON object that matches the JSON schema above.`,ku=`You MUST answer with JSON.`;function Au({prompt:e,schema:t,schemaPrefix:n=t==null?void 0:Du,schemaSuffix:r=t==null?ku:Ou}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?``:void 0,n,t==null?void 0:JSON.stringify(t),r].filter(e=>e!=null).join(`
`)}function ju({messages:e,schema:t,schemaPrefix:n,schemaSuffix:r}){let i=e[0]?.role===`system`?{...e[0]}:{role:`system`,content:``};return i.content=Au({prompt:i.content,schema:t,schemaPrefix:n,schemaSuffix:r}),[i,...e[0]?.role===`system`?e.slice(1):e]}function Mu(e){return e!=null}function Nu({mediaType:e,url:t,supportedUrls:n}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(n).map(([e,t])=>{let n=e.toLowerCase();return n===`*`||n===`*/*`?{mediaTypePrefix:``,regexes:t}:{mediaTypePrefix:n.replace(/\*/,``),regexes:t}}).filter(({mediaTypePrefix:t})=>e.startsWith(t)).flatMap(({regexes:e})=>e).some(e=>e.test(t))}function Pu({apiKey:e,environmentVariableName:t,apiKeyParameterName:n=`apiKey`,description:r}){if(typeof e==`string`)return e;if(e!=null)throw new xe({message:`${r} API key must be a string.`});if(typeof process>`u`)throw new xe({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new xe({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!=`string`)throw new xe({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function Fu({settingValue:e,environmentVariableName:t}){if(typeof e==`string`||!(e!=null||typeof process>`u`)&&(e=process.env[t],!(e==null||typeof e!=`string`)))return e}function Iu(e){let[t,n=``]=e.toLowerCase().split(`/`);return{mpeg:`mp3`,"x-wav":`wav`,opus:`ogg`,mp4:`m4a`,"x-m4a":`m4a`}[n]??n}var Lu=/"__proto__"\s*:/,Ru=/"constructor"\s*:/;function zu(e){let t=JSON.parse(e);return typeof t!=`object`||!t||Lu.test(e)===!1&&Ru.test(e)===!1?t:Bu(t)}function Bu(e){let t=[e];for(;t.length;){let e=t;t=[];for(let n of e){if(Object.prototype.hasOwnProperty.call(n,`__proto__`)||Object.prototype.hasOwnProperty.call(n,`constructor`)&&Object.prototype.hasOwnProperty.call(n.constructor,`prototype`))throw SyntaxError(`Object contains forbidden prototype property`);for(let e in n){let r=n[e];r&&typeof r==`object`&&t.push(r)}}}return e}function Vu(e){let{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return zu(e)}try{return zu(e)}finally{Error.stackTraceLimit=t}}function Hu(e){if(e.type===`object`||Array.isArray(e.type)&&e.type.includes(`object`)){e.additionalProperties=!1;let{properties:t}=e;if(t!=null)for(let e of Object.keys(t))t[e]=Uu(t[e])}e.items!=null&&(e.items=Array.isArray(e.items)?e.items.map(Uu):Uu(e.items)),e.anyOf!=null&&(e.anyOf=e.anyOf.map(Uu)),e.allOf!=null&&(e.allOf=e.allOf.map(Uu)),e.oneOf!=null&&(e.oneOf=e.oneOf.map(Uu));let{definitions:t}=e;if(t!=null)for(let e of Object.keys(t))t[e]=Uu(t[e]);return e}function Uu(e){return typeof e==`boolean`?e:Hu(e)}var Wu=Symbol(`Let zodToJsonSchema decide on which parser to use`),Gu={name:void 0,$refStrategy:`root`,basePath:[`#`],effectStrategy:`input`,pipeStrategy:`all`,dateStrategy:`format:date-time`,mapStrategy:`entries`,removeAdditionalStrategy:`passthrough`,allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:`definitions`,strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:`escape`,applyRegexFlags:!1,emailStrategy:`format:email`,base64Strategy:`contentEncoding:base64`,nameStrategy:`ref`},Ku=e=>typeof e==`string`?{...Gu,name:e}:{...Gu,...e};function qu(){return{}}function Ju(e,t){let n={type:`array`};return e.type?._def&&e.type?._def?.typeName!==Y.ZodAny&&(n.items=zd(e.type._def,{...t,currentPath:[...t.currentPath,`items`]})),e.minLength&&(n.minItems=e.minLength.value),e.maxLength&&(n.maxItems=e.maxLength.value),e.exactLength&&(n.minItems=e.exactLength.value,n.maxItems=e.exactLength.value),n}function Yu(e){let t={type:`integer`,format:`int64`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function Xu(){return{type:`boolean`}}function Zu(e,t){return zd(e.type._def,t)}var Qu=(e,t)=>zd(e.innerType._def,t);function $u(e,t,n){let r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,r)=>$u(e,t,n))};switch(r){case`string`:case`format:date-time`:return{type:`string`,format:`date-time`};case`format:date`:return{type:`string`,format:`date`};case`integer`:return ed(e)}}var ed=e=>{let t={type:`integer`,format:`unix-time`};for(let n of e.checks)switch(n.kind){case`min`:t.minimum=n.value;break;case`max`:t.maximum=n.value;break}return t};function td(e,t){return{...zd(e.innerType._def,t),default:e.defaultValue()}}function nd(e,t){return t.effectStrategy===`input`?zd(e.schema._def,t):qu()}function rd(e){return{type:`string`,enum:Array.from(e.values)}}var id=e=>`type`in e&&e.type===`string`?!1:`allOf`in e;function ad(e,t){let n=[zd(e.left._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]}),zd(e.right._def,{...t,currentPath:[...t.currentPath,`allOf`,`1`]})].filter(e=>!!e),r=[];return n.forEach(e=>{if(id(e))r.push(...e.allOf);else{let t=e;if(`additionalProperties`in e&&e.additionalProperties===!1){let{additionalProperties:n,...r}=e;t=r}r.push(t)}}),r.length?{allOf:r}:void 0}function od(e){let t=typeof e.value;return t!==`bigint`&&t!==`number`&&t!==`boolean`&&t!==`string`?{type:Array.isArray(e.value)?`array`:`object`}:{type:t===`bigint`?`integer`:t,const:e.value}}var sd=void 0,cd={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(sd===void 0&&(sd=RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`)),sd),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function ld(e,t){let n={type:`string`};if(e.checks)for(let r of e.checks)switch(r.kind){case`min`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value;break;case`max`:n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`email`:switch(t.emailStrategy){case`format:email`:pd(n,`email`,r.message,t);break;case`format:idn-email`:pd(n,`idn-email`,r.message,t);break;case`pattern:zod`:md(n,cd.email,r.message,t);break}break;case`url`:pd(n,`uri`,r.message,t);break;case`uuid`:pd(n,`uuid`,r.message,t);break;case`regex`:md(n,r.regex,r.message,t);break;case`cuid`:md(n,cd.cuid,r.message,t);break;case`cuid2`:md(n,cd.cuid2,r.message,t);break;case`startsWith`:md(n,RegExp(`^${ud(r.value,t)}`),r.message,t);break;case`endsWith`:md(n,RegExp(`${ud(r.value,t)}$`),r.message,t);break;case`datetime`:pd(n,`date-time`,r.message,t);break;case`date`:pd(n,`date`,r.message,t);break;case`time`:pd(n,`time`,r.message,t);break;case`duration`:pd(n,`duration`,r.message,t);break;case`length`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value,n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`includes`:md(n,RegExp(ud(r.value,t)),r.message,t);break;case`ip`:r.version!==`v6`&&pd(n,`ipv4`,r.message,t),r.version!==`v4`&&pd(n,`ipv6`,r.message,t);break;case`base64url`:md(n,cd.base64url,r.message,t);break;case`jwt`:md(n,cd.jwt,r.message,t);break;case`cidr`:r.version!==`v6`&&md(n,cd.ipv4Cidr,r.message,t),r.version!==`v4`&&md(n,cd.ipv6Cidr,r.message,t);break;case`emoji`:md(n,cd.emoji(),r.message,t);break;case`ulid`:md(n,cd.ulid,r.message,t);break;case`base64`:switch(t.base64Strategy){case`format:binary`:pd(n,`binary`,r.message,t);break;case`contentEncoding:base64`:n.contentEncoding=`base64`;break;case`pattern:zod`:md(n,cd.base64,r.message,t);break}break;case`nanoid`:md(n,cd.nanoid,r.message,t);case`toLowerCase`:case`toUpperCase`:case`trim`:break;default:}return n}function ud(e,t){return t.patternStrategy===`escape`?fd(e):e}var dd=new Set(`ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789`);function fd(e){let t=``;for(let n=0;n<e.length;n++)dd.has(e[n])||(t+=`\\`),t+=e[n];return t}function pd(e,t,n,r){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||=[],e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function md(e,t,n,r){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||=[],e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:hd(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=hd(t,r)}function hd(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let n={i:e.flags.includes(`i`),m:e.flags.includes(`m`),s:e.flags.includes(`s`)},r=n.i?e.source.toLowerCase():e.source,i=``,a=!1,o=!1,s=!1;for(let e=0;e<r.length;e++){if(a){i+=r[e],a=!1;continue}if(n.i){if(o){if(r[e].match(/[a-z]/)){s?(i+=r[e],i+=`${r[e-2]}-${r[e]}`.toUpperCase(),s=!1):r[e+1]===`-`&&r[e+2]?.match(/[a-z]/)?(i+=r[e],s=!0):i+=`${r[e]}${r[e].toUpperCase()}`;continue}}else if(r[e].match(/[a-z]/)){i+=`[${r[e]}${r[e].toUpperCase()}]`;continue}}if(n.m){if(r[e]===`^`){i+=`(^|(?<=[\r
]))`;continue}else if(r[e]===`$`){i+=`($|(?=[\r
]))`;continue}}if(n.s&&r[e]===`.`){i+=o?`${r[e]}\r
`:`[${r[e]}\r
]`;continue}i+=r[e],r[e]===`\\`?a=!0:o&&r[e]===`]`?o=!1:!o&&r[e]===`[`&&(o=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join(`/`)} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function gd(e,t){let n={type:`object`,additionalProperties:zd(e.valueType._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]})??t.allowedAdditionalProperties};if(e.keyType?._def.typeName===Y.ZodString&&e.keyType._def.checks?.length){let{type:r,...i}=ld(e.keyType._def,t);return{...n,propertyNames:i}}else if(e.keyType?._def.typeName===Y.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};else if(e.keyType?._def.typeName===Y.ZodBranded&&e.keyType._def.type._def.typeName===Y.ZodString&&e.keyType._def.type._def.checks?.length){let{type:r,...i}=Zu(e.keyType._def,t);return{...n,propertyNames:i}}return n}function _d(e,t){return t.mapStrategy===`record`?gd(e,t):{type:`array`,maxItems:125,items:{type:`array`,items:[zd(e.keyType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`0`]})||qu(),zd(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`1`]})||qu()],minItems:2,maxItems:2}}}function vd(e){let t=e.values,n=Object.keys(e.values).filter(e=>typeof t[t[e]]!=`number`).map(e=>t[e]),r=Array.from(new Set(n.map(e=>typeof e)));return{type:r.length===1?r[0]===`string`?`string`:`number`:[`string`,`number`],enum:n}}function yd(){return{not:qu()}}function bd(){return{type:`null`}}var xd={ZodString:`string`,ZodNumber:`number`,ZodBigInt:`integer`,ZodBoolean:`boolean`,ZodNull:`null`};function Sd(e,t){let n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in xd&&(!e._def.checks||!e._def.checks.length))){let e=n.reduce((e,t)=>{let n=xd[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}else if(n.every(e=>e._def.typeName===`ZodLiteral`&&!e.description)){let e=n.reduce((e,t)=>{let n=typeof t._def.value;switch(n){case`string`:case`number`:case`boolean`:return[...e,n];case`bigint`:return[...e,`integer`];case`object`:if(t._def.value===null)return[...e,`null`];case`symbol`:case`undefined`:case`function`:default:return e}},[]);if(e.length===n.length){let t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>e._def.typeName===`ZodEnum`))return{type:`string`,enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return Cd(e,t)}var Cd=(e,t)=>{let n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>zd(e._def,{...t,currentPath:[...t.currentPath,`anyOf`,`${n}`]})).filter(e=>!!e&&(!t.strictUnions||typeof e==`object`&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function wd(e,t){if([`ZodString`,`ZodNumber`,`ZodBigInt`,`ZodBoolean`,`ZodNull`].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[xd[e.innerType._def.typeName],`null`]};let n=zd(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`0`]});return n&&{anyOf:[n,{type:`null`}]}}function Td(e){let t={type:`number`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`int`:t.type=`integer`;break;case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function Ed(e,t){let n={type:`object`,properties:{}},r=[],i=e.shape();for(let e in i){let a=i[e];if(a===void 0||a._def===void 0)continue;let o=Od(a),s=zd(a._def,{...t,currentPath:[...t.currentPath,`properties`,e],propertyPath:[...t.currentPath,`properties`,e]});s!==void 0&&(n.properties[e]=s,o||r.push(e))}r.length&&(n.required=r);let a=Dd(e,t);return a!==void 0&&(n.additionalProperties=a),n}function Dd(e,t){if(e.catchall._def.typeName!==`ZodNever`)return zd(e.catchall._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]});switch(e.unknownKeys){case`passthrough`:return t.allowedAdditionalProperties;case`strict`:return t.rejectedAdditionalProperties;case`strip`:return t.removeAdditionalStrategy===`strict`?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Od(e){try{return e.isOptional()}catch{return!0}}var kd=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return zd(e.innerType._def,t);let n=zd(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`1`]});return n?{anyOf:[{not:qu()},n]}:qu()},Ad=(e,t)=>{if(t.pipeStrategy===`input`)return zd(e.in._def,t);if(t.pipeStrategy===`output`)return zd(e.out._def,t);let n=zd(e.in._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]});return{allOf:[n,zd(e.out._def,{...t,currentPath:[...t.currentPath,`allOf`,n?`1`:`0`]})].filter(e=>e!==void 0)}};function jd(e,t){return zd(e.type._def,t)}function Md(e,t){let n={type:`array`,uniqueItems:!0,items:zd(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`]})};return e.minSize&&(n.minItems=e.minSize.value),e.maxSize&&(n.maxItems=e.maxSize.value),n}function Nd(e,t){return e.rest?{type:`array`,minItems:e.items.length,items:e.items.map((e,n)=>zd(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[]),additionalItems:zd(e.rest._def,{...t,currentPath:[...t.currentPath,`additionalItems`]})}:{type:`array`,minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>zd(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[])}}function Pd(){return{not:qu()}}function Fd(){return qu()}var Id=(e,t)=>zd(e.innerType._def,t),Ld=(e,t,n)=>{switch(t){case Y.ZodString:return ld(e,n);case Y.ZodNumber:return Td(e);case Y.ZodObject:return Ed(e,n);case Y.ZodBigInt:return Yu(e);case Y.ZodBoolean:return Xu();case Y.ZodDate:return $u(e,n);case Y.ZodUndefined:return Pd();case Y.ZodNull:return bd();case Y.ZodArray:return Ju(e,n);case Y.ZodUnion:case Y.ZodDiscriminatedUnion:return Sd(e,n);case Y.ZodIntersection:return ad(e,n);case Y.ZodTuple:return Nd(e,n);case Y.ZodRecord:return gd(e,n);case Y.ZodLiteral:return od(e);case Y.ZodEnum:return rd(e);case Y.ZodNativeEnum:return vd(e);case Y.ZodNullable:return wd(e,n);case Y.ZodOptional:return kd(e,n);case Y.ZodMap:return _d(e,n);case Y.ZodSet:return Md(e,n);case Y.ZodLazy:return()=>e.getter()._def;case Y.ZodPromise:return jd(e,n);case Y.ZodNaN:case Y.ZodNever:return yd();case Y.ZodEffects:return nd(e,n);case Y.ZodAny:return qu();case Y.ZodUnknown:return Fd();case Y.ZodDefault:return td(e,n);case Y.ZodBranded:return Zu(e,n);case Y.ZodReadonly:return Id(e,n);case Y.ZodCatch:return Qu(e,n);case Y.ZodPipeline:return Ad(e,n);case Y.ZodFunction:case Y.ZodVoid:case Y.ZodSymbol:return;default:return(e=>void 0)(t)}},Rd=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join(`/`)};function zd(e,t,n=!1){let r=t.seen.get(e);if(t.override){let i=t.override?.call(t,e,t,r,n);if(i!==Wu)return i}if(r&&!n){let e=Bd(r,t);if(e!==void 0)return e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let a=Ld(e,e.typeName,t),o=typeof a==`function`?zd(a(),t):a;if(o&&Vd(e,t,o),t.postProcess){let n=t.postProcess(o,e,t);return i.jsonSchema=o,n}return i.jsonSchema=o,o}var Bd=(e,t)=>{switch(t.$refStrategy){case`root`:return{$ref:e.path.join(`/`)};case`relative`:return{$ref:Rd(t.currentPath,e.path)};case`none`:case`seen`:return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join(`/`)}! Defaulting to any`),qu()):t.$refStrategy===`seen`?qu():void 0}},Vd=(e,t,n)=>(e.description&&(n.description=e.description),n),Hd=e=>{let t=Ku(e),n=t.name===void 0?t.basePath:[...t.basePath,t.definitionPath,t.name];return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}},Ud=(e,t)=>{let n=Hd(t),r=typeof t==`object`&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>({...e,[t]:zd(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??qu()}),{}):void 0,i=typeof t==`string`?t:t?.nameStrategy===`title`?void 0:t?.name,a=zd(e._def,i===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,i]},!1)??qu(),o=typeof t==`object`&&t.name!==void 0&&t.nameStrategy===`title`?t.name:void 0;o!==void 0&&(a.title=o);let s=i===void 0?r?{...a,[n.definitionPath]:r}:a:{$ref:[...n.$refStrategy===`relative`?[]:n.basePath,n.definitionPath,i].join(`/`),[n.definitionPath]:{...r,[i]:a}};return s.$schema=`http://json-schema.org/draft-07/schema#`,s},Wd=Symbol.for(`vercel.ai.schema`);function X(e){let t;return()=>(t??=e(),t)}function Gd(e,{validate:t}={}){return{[Wd]:!0,_type:void 0,get jsonSchema(){return typeof e==`function`&&(e=e()),e},validate:t}}function Kd(e){return typeof e==`object`&&!!e&&Wd in e&&e[Wd]===!0&&`jsonSchema`in e&&`validate`in e}function qd(e){return e==null?Gd({properties:{},additionalProperties:!1}):Kd(e)?e:`~standard`in e?e[`~standard`].vendor===`zod`?Z(e):Jd(e):e()}function Jd(e){return Gd(()=>Hu(e[`~standard`].jsonSchema.input({target:`draft-07`})),{validate:async t=>{let n=await e[`~standard`].validate(t);return`value`in n?{success:!0,value:n.value}:{success:!1,error:new Ze({value:t,cause:n.issues})}}})}function Yd(e,t){let n=t?.useReferences??!1;return Gd(()=>Ud(e,{$refStrategy:n?`root`:`none`}),{validate:async t=>{let n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Xd(e,t){let n=t?.useReferences??!1;return Gd(()=>Hu(ko(e,{target:`draft-7`,io:`input`,reused:n?`ref`:`inline`})),{validate:async t=>{let n=await Uo(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Zd(e){return`_zod`in e}function Z(e,t){return Zd(e)?Xd(e,t):Yd(e,t)}async function Qd({value:e,schema:t}){let n=await $d({value:e,schema:t});if(!n.success)throw Ze.wrap({value:e,cause:n.error});return n.value}async function $d({value:e,schema:t}){let n=qd(t);try{if(n.validate==null)return{success:!0,value:e,rawValue:e};let t=await n.validate(e);return t.success?{success:!0,value:t.value,rawValue:e}:{success:!1,error:Ze.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:Ze.wrap({value:e,cause:t}),rawValue:e}}}async function ef({text:e,schema:t}){try{let n=Vu(e);return t==null?n:Qd({value:n,schema:t})}catch(t){throw he.isInstance(t)||Ze.isInstance(t)?t:new he({text:e,cause:t})}}async function tf({text:e,schema:t}){try{let n=Vu(e);return t==null?{success:!0,value:n,rawValue:n}:await $d({value:n,schema:t})}catch(t){return{success:!1,error:he.isInstance(t)?t:new he({text:e,cause:t}),rawValue:void 0}}}function nf(e){try{return Vu(e),!0}catch{return!1}}function rf({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Yl).pipeThrough(new TransformStream({async transform({data:e},n){e!==`[DONE]`&&n.enqueue(await tf({text:e,schema:t}))}}))}async function af({provider:e,providerOptions:t,schema:n}){if(t?.[e]==null)return;let r=await $d({value:t[e],schema:n});if(!r.success)throw new S({argument:`providerOptions`,message:`invalid ${e} provider options`,cause:r.error});return r.value}var of=()=>globalThis.fetch,sf=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>lf({url:e,headers:{"Content-Type":`application/json`,...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),cf=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>lf({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),lf=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:a,fetch:o=of()})=>{try{let s=await o(e,{method:`POST`,headers:Cu(t,`ai-sdk/provider-utils/${wu}`,xu()),body:n.content,signal:a}),c=tu(s);if(!s.ok){let t;try{t=await i({response:s,url:e,requestBodyValues:n.values})}catch(t){throw vu(t)||d.isInstance(t)?t:new d({message:`Failed to process error response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}throw t.value}try{return await r({response:s,url:e,requestBodyValues:n.values})}catch(t){throw t instanceof Error&&(vu(t)||d.isInstance(t))?t:new d({message:`Failed to process successful response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}}catch(t){throw bu({error:t,url:e,requestBodyValues:n.values})}};function uf(e){return e}function df(e){return{...e,type:`dynamic`}}function ff({id:e,inputSchema:t}){return({execute:n,outputSchema:r,needsApproval:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c,...l})=>uf({type:`provider`,id:e,args:l,inputSchema:t,outputSchema:r,execute:n,needsApproval:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c})}function pf({id:e,inputSchema:t,outputSchema:n,supportsDeferredResults:r}){return({execute:i,needsApproval:a,toModelOutput:o,onInputStart:s,onInputDelta:c,onInputAvailable:l,...u})=>uf({type:`provider`,id:e,args:u,inputSchema:t,outputSchema:n,execute:i,needsApproval:a,toModelOutput:o,onInputStart:s,onInputDelta:c,onInputAvailable:l,supportsDeferredResults:r})}async function mf(e){return typeof e==`function`&&(e=e()),Promise.resolve(e)}var hf=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:i,requestBodyValues:a})=>{let o=await r.text(),s=tu(r);if(o.trim()===``)return{responseHeaders:s,value:new d({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})};try{let c=await ef({text:o,schema:e});return{responseHeaders:s,value:new d({message:t(c),url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,data:c,isRetryable:n?.(r,c)})}}catch{return{responseHeaders:s,value:new d({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})}}},gf=e=>async({response:t})=>{let n=tu(t);if(t.body==null)throw new _({});return{responseHeaders:n,value:rf({stream:t.body,schema:e})}},_f=e=>async({response:t,url:n,requestBodyValues:r})=>{let i=await t.text(),a=await tf({text:i,schema:e}),o=tu(t);if(!a.success)throw new d({message:`Invalid JSON response`,cause:a.error,statusCode:t.status,responseHeaders:o,responseBody:i,url:n,requestBodyValues:r});return{responseHeaders:o,value:a.value,rawValue:a.rawValue}},vf=()=>async({response:e,url:t,requestBodyValues:n})=>{let r=tu(e);if(!e.body)throw new d({message:`Response body is empty`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{let t=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(t)}}catch(i){throw new d({message:`Failed to read response as array buffer`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:i})}};function yf(e){return e?.replace(/\/$/,``)}function bf(e){return e!=null&&typeof e[Symbol.asyncIterator]==`function`}async function*xf({execute:e,input:t,options:n}){let r=e(t,n);if(bf(r)){let e;for await(let t of r)e=t,yield{type:`preliminary`,output:t};yield{type:`final`,output:e}}else yield{type:`final`,output:await r}}var Sf=`3.0.18`,Cf=hf({errorSchema:X(()=>Z(I({type:B(`error`),error:I({type:A(),message:A()})}))),errorToMessage:e=>e.error.message}),wf=X(()=>Z(I({type:B(`message`),id:A().nullish(),model:A().nullish(),content:F(R(`type`,[I({type:B(`text`),text:A(),citations:F(R(`type`,[I({type:B(`web_search_result_location`),cited_text:A(),url:A(),title:A(),encrypted_index:A()}),I({type:B(`page_location`),cited_text:A(),document_index:j(),document_title:A().nullable(),start_page_number:j(),end_page_number:j()}),I({type:B(`char_location`),cited_text:A(),document_index:j(),document_title:A().nullable(),start_char_index:j(),end_char_index:j()})])).optional()}),I({type:B(`thinking`),thinking:A(),signature:A()}),I({type:B(`redacted_thinking`),data:A()}),I({type:B(`tool_use`),id:A(),name:A(),input:N(),caller:L([I({type:B(`code_execution_20250825`),tool_id:A()}),I({type:B(`direct`)})]).optional()}),I({type:B(`server_tool_use`),id:A(),name:A(),input:Hs(A(),N()).nullish()}),I({type:B(`mcp_tool_use`),id:A(),name:A(),input:N(),server_name:A()}),I({type:B(`mcp_tool_result`),tool_use_id:A(),is_error:M(),content:F(L([A(),I({type:B(`text`),text:A()})]))}),I({type:B(`web_fetch_tool_result`),tool_use_id:A(),content:L([I({type:B(`web_fetch_result`),url:A(),retrieved_at:A(),content:I({type:B(`document`),title:A().nullable(),citations:I({enabled:M()}).optional(),source:L([I({type:B(`base64`),media_type:B(`application/pdf`),data:A()}),I({type:B(`text`),media_type:B(`text/plain`),data:A()})])})}),I({type:B(`web_fetch_tool_result_error`),error_code:A()})])}),I({type:B(`web_search_tool_result`),tool_use_id:A(),content:L([F(I({type:B(`web_search_result`),url:A(),title:A(),encrypted_content:A(),page_age:A().nullish()})),I({type:B(`web_search_tool_result_error`),error_code:A()})])}),I({type:B(`code_execution_tool_result`),tool_use_id:A(),content:L([I({type:B(`code_execution_result`),stdout:A(),stderr:A(),return_code:j(),content:F(I({type:B(`code_execution_output`),file_id:A()})).optional().default([])}),I({type:B(`code_execution_tool_result_error`),error_code:A()})])}),I({type:B(`bash_code_execution_tool_result`),tool_use_id:A(),content:R(`type`,[I({type:B(`bash_code_execution_result`),content:F(I({type:B(`bash_code_execution_output`),file_id:A()})),stdout:A(),stderr:A(),return_code:j()}),I({type:B(`bash_code_execution_tool_result_error`),error_code:A()})])}),I({type:B(`text_editor_code_execution_tool_result`),tool_use_id:A(),content:R(`type`,[I({type:B(`text_editor_code_execution_tool_result_error`),error_code:A()}),I({type:B(`text_editor_code_execution_view_result`),content:A(),file_type:A(),num_lines:j().nullable(),start_line:j().nullable(),total_lines:j().nullable()}),I({type:B(`text_editor_code_execution_create_result`),is_file_update:M()}),I({type:B(`text_editor_code_execution_str_replace_result`),lines:F(A()).nullable(),new_lines:j().nullable(),new_start:j().nullable(),old_lines:j().nullable(),old_start:j().nullable()})])}),I({type:B(`tool_search_tool_result`),tool_use_id:A(),content:L([I({type:B(`tool_search_tool_search_result`),tool_references:F(I({type:B(`tool_reference`),tool_name:A()}))}),I({type:B(`tool_search_tool_result_error`),error_code:A()})])})])),stop_reason:A().nullish(),stop_sequence:A().nullish(),usage:Ps({input_tokens:j(),output_tokens:j(),cache_creation_input_tokens:j().nullish(),cache_read_input_tokens:j().nullish()}),container:I({expires_at:A(),id:A(),skills:F(I({type:L([B(`anthropic`),B(`custom`)]),skill_id:A(),version:A()})).nullish()}).nullish(),context_management:I({applied_edits:F(L([I({type:B(`clear_tool_uses_20250919`),cleared_tool_uses:j(),cleared_input_tokens:j()}),I({type:B(`clear_thinking_20251015`),cleared_thinking_turns:j(),cleared_input_tokens:j()})]))}).nullish()}))),Tf=X(()=>Z(R(`type`,[I({type:B(`message_start`),message:I({id:A().nullish(),model:A().nullish(),role:A().nullish(),usage:Ps({input_tokens:j(),cache_creation_input_tokens:j().nullish(),cache_read_input_tokens:j().nullish()}),content:F(R(`type`,[I({type:B(`tool_use`),id:A(),name:A(),input:N(),caller:L([I({type:B(`code_execution_20250825`),tool_id:A()}),I({type:B(`direct`)})]).optional()})])).nullish(),stop_reason:A().nullish(),container:I({expires_at:A(),id:A()}).nullish()})}),I({type:B(`content_block_start`),index:j(),content_block:R(`type`,[I({type:B(`text`),text:A()}),I({type:B(`thinking`),thinking:A()}),I({type:B(`tool_use`),id:A(),name:A(),input:Hs(A(),N()).optional(),caller:L([I({type:B(`code_execution_20250825`),tool_id:A()}),I({type:B(`direct`)})]).optional()}),I({type:B(`redacted_thinking`),data:A()}),I({type:B(`server_tool_use`),id:A(),name:A(),input:Hs(A(),N()).nullish()}),I({type:B(`mcp_tool_use`),id:A(),name:A(),input:N(),server_name:A()}),I({type:B(`mcp_tool_result`),tool_use_id:A(),is_error:M(),content:F(L([A(),I({type:B(`text`),text:A()})]))}),I({type:B(`web_fetch_tool_result`),tool_use_id:A(),content:L([I({type:B(`web_fetch_result`),url:A(),retrieved_at:A(),content:I({type:B(`document`),title:A().nullable(),citations:I({enabled:M()}).optional(),source:L([I({type:B(`base64`),media_type:B(`application/pdf`),data:A()}),I({type:B(`text`),media_type:B(`text/plain`),data:A()})])})}),I({type:B(`web_fetch_tool_result_error`),error_code:A()})])}),I({type:B(`web_search_tool_result`),tool_use_id:A(),content:L([F(I({type:B(`web_search_result`),url:A(),title:A(),encrypted_content:A(),page_age:A().nullish()})),I({type:B(`web_search_tool_result_error`),error_code:A()})])}),I({type:B(`code_execution_tool_result`),tool_use_id:A(),content:L([I({type:B(`code_execution_result`),stdout:A(),stderr:A(),return_code:j(),content:F(I({type:B(`code_execution_output`),file_id:A()})).optional().default([])}),I({type:B(`code_execution_tool_result_error`),error_code:A()})])}),I({type:B(`bash_code_execution_tool_result`),tool_use_id:A(),content:R(`type`,[I({type:B(`bash_code_execution_result`),content:F(I({type:B(`bash_code_execution_output`),file_id:A()})),stdout:A(),stderr:A(),return_code:j()}),I({type:B(`bash_code_execution_tool_result_error`),error_code:A()})])}),I({type:B(`text_editor_code_execution_tool_result`),tool_use_id:A(),content:R(`type`,[I({type:B(`text_editor_code_execution_tool_result_error`),error_code:A()}),I({type:B(`text_editor_code_execution_view_result`),content:A(),file_type:A(),num_lines:j().nullable(),start_line:j().nullable(),total_lines:j().nullable()}),I({type:B(`text_editor_code_execution_create_result`),is_file_update:M()}),I({type:B(`text_editor_code_execution_str_replace_result`),lines:F(A()).nullable(),new_lines:j().nullable(),new_start:j().nullable(),old_lines:j().nullable(),old_start:j().nullable()})])}),I({type:B(`tool_search_tool_result`),tool_use_id:A(),content:L([I({type:B(`tool_search_tool_search_result`),tool_references:F(I({type:B(`tool_reference`),tool_name:A()}))}),I({type:B(`tool_search_tool_result_error`),error_code:A()})])})])}),I({type:B(`content_block_delta`),index:j(),delta:R(`type`,[I({type:B(`input_json_delta`),partial_json:A()}),I({type:B(`text_delta`),text:A()}),I({type:B(`thinking_delta`),thinking:A()}),I({type:B(`signature_delta`),signature:A()}),I({type:B(`citations_delta`),citation:R(`type`,[I({type:B(`web_search_result_location`),cited_text:A(),url:A(),title:A(),encrypted_index:A()}),I({type:B(`page_location`),cited_text:A(),document_index:j(),document_title:A().nullable(),start_page_number:j(),end_page_number:j()}),I({type:B(`char_location`),cited_text:A(),document_index:j(),document_title:A().nullable(),start_char_index:j(),end_char_index:j()})])})])}),I({type:B(`content_block_stop`),index:j()}),I({type:B(`error`),error:I({type:A(),message:A()})}),I({type:B(`message_delta`),delta:I({stop_reason:A().nullish(),stop_sequence:A().nullish(),container:I({expires_at:A(),id:A(),skills:F(I({type:L([B(`anthropic`),B(`custom`)]),skill_id:A(),version:A()})).nullish()}).nullish(),context_management:I({applied_edits:F(L([I({type:B(`clear_tool_uses_20250919`),cleared_tool_uses:j(),cleared_input_tokens:j()}),I({type:B(`clear_thinking_20251015`),cleared_thinking_turns:j(),cleared_input_tokens:j()})]))}).nullish()}),usage:Ps({input_tokens:j().nullish(),output_tokens:j(),cache_creation_input_tokens:j().nullish()})}),I({type:B(`message_stop`)}),I({type:B(`ping`)})]))),Ef=X(()=>Z(I({signature:A().optional(),redactedData:A().optional()}))),Df=I({citations:I({enabled:M()}).optional(),title:A().optional(),context:A().optional()}),Of=I({sendReasoning:M().optional(),structuredOutputMode:z([`outputFormat`,`jsonTool`,`auto`]).optional(),thinking:I({type:L([B(`enabled`),B(`disabled`)]),budgetTokens:j().optional()}).optional(),disableParallelToolUse:M().optional(),cacheControl:I({type:B(`ephemeral`),ttl:L([B(`5m`),B(`1h`)]).optional()}).optional(),mcpServers:F(I({type:B(`url`),name:A(),url:A(),authorizationToken:A().nullish(),toolConfiguration:I({enabled:M().nullish(),allowedTools:F(A()).nullish()}).nullish()})).optional(),container:I({id:A().optional(),skills:F(I({type:L([B(`anthropic`),B(`custom`)]),skillId:A(),version:A().optional()})).optional()}).optional(),toolStreaming:M().optional(),effort:z([`low`,`medium`,`high`]).optional(),contextManagement:I({edits:F(R(`type`,[I({type:B(`clear_tool_uses_20250919`),trigger:R(`type`,[I({type:B(`input_tokens`),value:j()}),I({type:B(`tool_uses`),value:j()})]).optional(),keep:I({type:B(`tool_uses`),value:j()}).optional(),clearAtLeast:I({type:B(`input_tokens`),value:j()}).optional(),clearToolInputs:M().optional(),excludeTools:F(A()).optional()}),I({type:B(`clear_thinking_20251015`),keep:L([B(`all`),I({type:B(`thinking_turns`),value:j()})]).optional()})]))}).optional()}),kf=4;function Af(e){let t=e?.anthropic;return t?.cacheControl??t?.cache_control}var jf=class{constructor(){this.breakpointCount=0,this.warnings=[]}getCacheControl(e,t){let n=Af(e);if(n){if(!t.canCache){this.warnings.push({type:`unsupported`,feature:`cache_control on non-cacheable context`,details:`cache_control cannot be set on ${t.type}. It will be ignored.`});return}if(this.breakpointCount++,this.breakpointCount>kf){this.warnings.push({type:`unsupported`,feature:`cacheControl breakpoint limit`,details:`Maximum ${kf} cache breakpoints exceeded (found ${this.breakpointCount}). This breakpoint will be ignored.`});return}return n}}getWarnings(){return this.warnings}},Mf=X(()=>Z(I({maxCharacters:j().optional()}))),Nf=ff({id:`anthropic.text_editor_20250728`,inputSchema:X(()=>Z(I({command:z([`view`,`create`,`str_replace`,`insert`]),path:A(),file_text:A().optional(),insert_line:j().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:F(j().int()).optional()})))}),Pf=(e={})=>Nf(e),Ff=X(()=>Z(I({maxUses:j().optional(),allowedDomains:F(A()).optional(),blockedDomains:F(A()).optional(),userLocation:I({type:B(`approximate`),city:A().optional(),region:A().optional(),country:A().optional(),timezone:A().optional()}).optional()}))),If=X(()=>Z(F(I({url:A(),title:A().nullable(),pageAge:A().nullable(),encryptedContent:A(),type:B(`web_search_result`)})))),Lf=pf({id:`anthropic.web_search_20250305`,inputSchema:X(()=>Z(I({query:A()}))),outputSchema:If,supportsDeferredResults:!0}),Rf=(e={})=>Lf(e),zf=X(()=>Z(I({maxUses:j().optional(),allowedDomains:F(A()).optional(),blockedDomains:F(A()).optional(),citations:I({enabled:M()}).optional(),maxContentTokens:j().optional()}))),Bf=X(()=>Z(I({type:B(`web_fetch_result`),url:A(),content:I({type:B(`document`),title:A().nullable(),citations:I({enabled:M()}).optional(),source:L([I({type:B(`base64`),mediaType:B(`application/pdf`),data:A()}),I({type:B(`text`),mediaType:B(`text/plain`),data:A()})])}),retrievedAt:A().nullable()}))),Vf=pf({id:`anthropic.web_fetch_20250910`,inputSchema:X(()=>Z(I({url:A()}))),outputSchema:Bf,supportsDeferredResults:!0}),Hf=(e={})=>Vf(e);async function Uf({tools:e,toolChoice:t,disableParallelToolUse:n,cacheControlValidator:r,supportsStructuredOutput:i}){e=e?.length?e:void 0;let a=[],o=new Set,s=r||new jf;if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:a,betas:o};let c=[];for(let t of e)switch(t.type){case`function`:{let e=s.getCacheControl(t.providerOptions,{type:`tool definition`,canCache:!0}),n=t.providerOptions?.anthropic,r=n?.deferLoading,a=n?.allowedCallers;c.push({name:t.name,description:t.description,input_schema:t.inputSchema,cache_control:e,...i===!0&&t.strict!=null?{strict:t.strict}:{},...r==null?{}:{defer_loading:r},...a==null?{}:{allowed_callers:a},...t.inputExamples==null?{}:{input_examples:t.inputExamples.map(e=>e.input)}}),i===!0&&o.add(`structured-outputs-2025-11-13`),(t.inputExamples!=null||a!=null)&&o.add(`advanced-tool-use-2025-11-20`);break}case`provider`:switch(t.id){case`anthropic.code_execution_20250522`:o.add(`code-execution-2025-05-22`),c.push({type:`code_execution_20250522`,name:`code_execution`,cache_control:void 0});break;case`anthropic.code_execution_20250825`:o.add(`code-execution-2025-08-25`),c.push({type:`code_execution_20250825`,name:`code_execution`});break;case`anthropic.computer_20250124`:o.add(`computer-use-2025-01-24`),c.push({name:`computer`,type:`computer_20250124`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber,cache_control:void 0});break;case`anthropic.computer_20241022`:o.add(`computer-use-2024-10-22`),c.push({name:`computer`,type:`computer_20241022`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber,cache_control:void 0});break;case`anthropic.text_editor_20250124`:o.add(`computer-use-2025-01-24`),c.push({name:`str_replace_editor`,type:`text_editor_20250124`,cache_control:void 0});break;case`anthropic.text_editor_20241022`:o.add(`computer-use-2024-10-22`),c.push({name:`str_replace_editor`,type:`text_editor_20241022`,cache_control:void 0});break;case`anthropic.text_editor_20250429`:o.add(`computer-use-2025-01-24`),c.push({name:`str_replace_based_edit_tool`,type:`text_editor_20250429`,cache_control:void 0});break;case`anthropic.text_editor_20250728`:{let e=await Qd({value:t.args,schema:Mf});c.push({name:`str_replace_based_edit_tool`,type:`text_editor_20250728`,max_characters:e.maxCharacters,cache_control:void 0});break}case`anthropic.bash_20250124`:o.add(`computer-use-2025-01-24`),c.push({name:`bash`,type:`bash_20250124`,cache_control:void 0});break;case`anthropic.bash_20241022`:o.add(`computer-use-2024-10-22`),c.push({name:`bash`,type:`bash_20241022`,cache_control:void 0});break;case`anthropic.memory_20250818`:o.add(`context-management-2025-06-27`),c.push({name:`memory`,type:`memory_20250818`});break;case`anthropic.web_fetch_20250910`:{o.add(`web-fetch-2025-09-10`);let e=await Qd({value:t.args,schema:zf});c.push({type:`web_fetch_20250910`,name:`web_fetch`,max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,citations:e.citations,max_content_tokens:e.maxContentTokens,cache_control:void 0});break}case`anthropic.web_search_20250305`:{let e=await Qd({value:t.args,schema:Ff});c.push({type:`web_search_20250305`,name:`web_search`,max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,user_location:e.userLocation,cache_control:void 0});break}case`anthropic.tool_search_regex_20251119`:o.add(`advanced-tool-use-2025-11-20`),c.push({type:`tool_search_tool_regex_20251119`,name:`tool_search_tool_regex`});break;case`anthropic.tool_search_bm25_20251119`:o.add(`advanced-tool-use-2025-11-20`),c.push({type:`tool_search_tool_bm25_20251119`,name:`tool_search_tool_bm25`});break;default:a.push({type:`unsupported`,feature:`provider-defined tool ${t.id}`});break}break;default:a.push({type:`unsupported`,feature:`tool ${t}`});break}if(t==null)return{tools:c,toolChoice:n?{type:`auto`,disable_parallel_tool_use:n}:void 0,toolWarnings:a,betas:o};let l=t.type;switch(l){case`auto`:return{tools:c,toolChoice:{type:`auto`,disable_parallel_tool_use:n},toolWarnings:a,betas:o};case`required`:return{tools:c,toolChoice:{type:`any`,disable_parallel_tool_use:n},toolWarnings:a,betas:o};case`none`:return{tools:void 0,toolChoice:void 0,toolWarnings:a,betas:o};case`tool`:return{tools:c,toolChoice:{type:`tool`,name:t.toolName,disable_parallel_tool_use:n},toolWarnings:a,betas:o};default:throw new rt({functionality:`tool choice type: ${l}`})}}function Wf(e){let t=e.input_tokens,n=e.output_tokens,r=e.cache_creation_input_tokens??0,i=e.cache_read_input_tokens??0;return{inputTokens:{total:t+r+i,noCache:t,cacheRead:i,cacheWrite:r},outputTokens:{total:n,text:void 0,reasoning:void 0},raw:e}}var Gf=X(()=>Z(I({type:B(`code_execution_result`),stdout:A(),stderr:A(),return_code:j(),content:F(I({type:B(`code_execution_output`),file_id:A()})).optional().default([])}))),Kf=pf({id:`anthropic.code_execution_20250522`,inputSchema:X(()=>Z(I({code:A()}))),outputSchema:Gf}),qf=(e={})=>Kf(e),Jf=X(()=>Z(R(`type`,[I({type:B(`code_execution_result`),stdout:A(),stderr:A(),return_code:j(),content:F(I({type:B(`code_execution_output`),file_id:A()})).optional().default([])}),I({type:B(`bash_code_execution_result`),content:F(I({type:B(`bash_code_execution_output`),file_id:A()})),stdout:A(),stderr:A(),return_code:j()}),I({type:B(`bash_code_execution_tool_result_error`),error_code:A()}),I({type:B(`text_editor_code_execution_tool_result_error`),error_code:A()}),I({type:B(`text_editor_code_execution_view_result`),content:A(),file_type:A(),num_lines:j().nullable(),start_line:j().nullable(),total_lines:j().nullable()}),I({type:B(`text_editor_code_execution_create_result`),is_file_update:M()}),I({type:B(`text_editor_code_execution_str_replace_result`),lines:F(A()).nullable(),new_lines:j().nullable(),new_start:j().nullable(),old_lines:j().nullable(),old_start:j().nullable()})]))),Yf=pf({id:`anthropic.code_execution_20250825`,inputSchema:X(()=>Z(R(`type`,[I({type:B(`programmatic-tool-call`),code:A()}),I({type:B(`bash_code_execution`),command:A()}),R(`command`,[I({type:B(`text_editor_code_execution`),command:B(`view`),path:A()}),I({type:B(`text_editor_code_execution`),command:B(`create`),path:A(),file_text:A().nullish()}),I({type:B(`text_editor_code_execution`),command:B(`str_replace`),path:A(),old_str:A(),new_str:A()})])]))),outputSchema:Jf,supportsDeferredResults:!0}),Xf=(e={})=>Yf(e),Zf=X(()=>Z(F(I({type:B(`tool_reference`),toolName:A()})))),Qf=pf({id:`anthropic.tool_search_regex_20251119`,inputSchema:X(()=>Z(I({pattern:A(),limit:j().optional()}))),outputSchema:Zf}),$f=(e={})=>Qf(e);function ep(e){if(typeof e==`string`)return Buffer.from(e,`base64`).toString(`utf-8`);if(e instanceof Uint8Array)return new TextDecoder().decode(e);throw e instanceof URL?new rt({functionality:`URL-based text documents are not supported for citations`}):new rt({functionality:`unsupported data type for text documents: ${typeof e}`})}function tp(e){return e instanceof URL||np(e)}function np(e){return typeof e==`string`&&/^https?:\/\//i.test(e)}function rp(e){return e instanceof URL?e.toString():e}async function ip({prompt:e,sendReasoning:t,warnings:n,cacheControlValidator:r,toolNameMapping:i}){let a=new Set,o=ap(e),s=r||new jf,c,l=[];async function u(e){return(await af({provider:`anthropic`,providerOptions:e,schema:Df}))?.citations?.enabled??!1}async function d(e){let t=await af({provider:`anthropic`,providerOptions:e,schema:Df});return{title:t?.title,context:t?.context}}for(let e=0;e<o.length;e++){let r=o[e],f=e===o.length-1,p=r.type;switch(p){case`system`:if(c!=null)throw new rt({functionality:`Multiple system messages that are separated by user/assistant messages`});c=r.messages.map(({content:e,providerOptions:t})=>({type:`text`,text:e,cache_control:s.getCacheControl(t,{type:`system message`,canCache:!0})}));break;case`user`:{let e=[];for(let t of r.messages){let{role:r,content:i}=t;switch(r){case`user`:for(let n=0;n<i.length;n++){let r=i[n],o=n===i.length-1,c=s.getCacheControl(r.providerOptions,{type:`user message part`,canCache:!0})??(o?s.getCacheControl(t.providerOptions,{type:`user message`,canCache:!0}):void 0);switch(r.type){case`text`:e.push({type:`text`,text:r.text,cache_control:c});break;case`file`:if(r.mediaType.startsWith(`image/`))e.push({type:`image`,source:tp(r.data)?{type:`url`,url:rp(r.data)}:{type:`base64`,media_type:r.mediaType===`image/*`?`image/jpeg`:r.mediaType,data:ou(r.data)},cache_control:c});else if(r.mediaType===`application/pdf`){a.add(`pdfs-2024-09-25`);let t=await u(r.providerOptions),n=await d(r.providerOptions);e.push({type:`document`,source:tp(r.data)?{type:`url`,url:rp(r.data)}:{type:`base64`,media_type:`application/pdf`,data:ou(r.data)},title:n.title??r.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:c})}else if(r.mediaType===`text/plain`){let t=await u(r.providerOptions),n=await d(r.providerOptions);e.push({type:`document`,source:tp(r.data)?{type:`url`,url:rp(r.data)}:{type:`text`,media_type:`text/plain`,data:ep(r.data)},title:n.title??r.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:c})}else throw new rt({functionality:`media type: ${r.mediaType}`});break}}break;case`tool`:for(let r=0;r<i.length;r++){let o=i[r];if(o.type===`tool-approval-response`)continue;let c=r===i.length-1,l=s.getCacheControl(o.providerOptions,{type:`tool result part`,canCache:!0})??(c?s.getCacheControl(t.providerOptions,{type:`tool result message`,canCache:!0}):void 0),u=o.output,d;switch(u.type){case`content`:d=u.value.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`image-data`:return{type:`image`,source:{type:`base64`,media_type:e.mediaType,data:e.data}};case`image-url`:return{type:`image`,source:{type:`url`,url:e.url}};case`file-url`:return{type:`document`,source:{type:`url`,url:e.url}};case`file-data`:if(e.mediaType===`application/pdf`)return a.add(`pdfs-2024-09-25`),{type:`document`,source:{type:`base64`,media_type:e.mediaType,data:e.data}};n.push({type:`other`,message:`unsupported tool content part type: ${e.type} with media type: ${e.mediaType}`});return;default:n.push({type:`other`,message:`unsupported tool content part type: ${e.type}`});return}}).filter(Mu);break;case`text`:case`error-text`:d=u.value;break;case`execution-denied`:d=u.reason??`Tool execution denied.`;break;case`json`:case`error-json`:default:d=JSON.stringify(u.value);break}e.push({type:`tool_result`,tool_use_id:o.toolCallId,content:d,is_error:u.type===`error-text`||u.type===`error-json`?!0:void 0,cache_control:l})}break;default:{let e=r;throw Error(`Unsupported role: ${e}`)}}}l.push({role:`user`,content:e});break}case`assistant`:{let e=[],a=new Set;for(let o=0;o<r.messages.length;o++){let c=r.messages[o],l=o===r.messages.length-1,{content:u}=c;for(let r=0;r<u.length;r++){let o=u[r],d=r===u.length-1,p=s.getCacheControl(o.providerOptions,{type:`assistant message part`,canCache:!0})??(d?s.getCacheControl(c.providerOptions,{type:`assistant message`,canCache:!0}):void 0);switch(o.type){case`text`:e.push({type:`text`,text:f&&l&&d?o.text.trim():o.text,cache_control:p});break;case`reasoning`:if(t){let t=await af({provider:`anthropic`,providerOptions:o.providerOptions,schema:Ef});t==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):t.signature==null?t.redactedData==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):(s.getCacheControl(o.providerOptions,{type:`redacted thinking block`,canCache:!1}),e.push({type:`redacted_thinking`,data:t.redactedData})):(s.getCacheControl(o.providerOptions,{type:`thinking block`,canCache:!1}),e.push({type:`thinking`,thinking:o.text,signature:t.signature}))}else n.push({type:`other`,message:`sending reasoning content is disabled for this model`});break;case`tool-call`:{if(o.providerExecuted){let t=i.toProviderToolName(o.toolName);if(o.providerOptions?.anthropic?.type===`mcp-tool-use`){a.add(o.toolCallId);let t=o.providerOptions?.anthropic?.serverName;if(t==null||typeof t!=`string`){n.push({type:`other`,message:`mcp tool use server name is required and must be a string`});break}e.push({type:`mcp_tool_use`,id:o.toolCallId,name:o.toolName,input:o.input,server_name:t,cache_control:p})}else if(t===`code_execution`&&o.input!=null&&typeof o.input==`object`&&`type`in o.input&&typeof o.input.type==`string`&&(o.input.type===`bash_code_execution`||o.input.type===`text_editor_code_execution`))e.push({type:`server_tool_use`,id:o.toolCallId,name:o.input.type,input:o.input,cache_control:p});else if(t===`code_execution`&&o.input!=null&&typeof o.input==`object`&&`type`in o.input&&o.input.type===`programmatic-tool-call`){let{type:t,...n}=o.input;e.push({type:`server_tool_use`,id:o.toolCallId,name:`code_execution`,input:n,cache_control:p})}else t===`code_execution`||t===`web_fetch`||t===`web_search`||t===`tool_search_tool_regex`||t===`tool_search_tool_bm25`?e.push({type:`server_tool_use`,id:o.toolCallId,name:t,input:o.input,cache_control:p}):n.push({type:`other`,message:`provider executed tool call for tool ${o.toolName} is not supported`});break}let t=o.providerOptions?.anthropic,r=t?.caller?t.caller.type===`code_execution_20250825`&&t.caller.toolId?{type:`code_execution_20250825`,tool_id:t.caller.toolId}:t.caller.type===`direct`?{type:`direct`}:void 0:void 0;e.push({type:`tool_use`,id:o.toolCallId,name:o.toolName,input:o.input,...r&&{caller:r},cache_control:p});break}case`tool-result`:{let t=i.toProviderToolName(o.toolName);if(a.has(o.toolCallId)){let t=o.output;if(t.type!==`json`&&t.type!==`error-json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}e.push({type:`mcp_tool_result`,tool_use_id:o.toolCallId,is_error:t.type===`error-json`,content:t.value,cache_control:p})}else if(t===`code_execution`){let t=o.output;if(t.type===`error-text`||t.type===`error-json`){let n={};try{typeof t.value==`string`?n=JSON.parse(t.value):typeof t.value==`object`&&t.value!==null&&(n=t.value)}catch{}n.type===`code_execution_tool_result_error`?e.push({type:`code_execution_tool_result`,tool_use_id:o.toolCallId,content:{type:`code_execution_tool_result_error`,error_code:n.errorCode??`unknown`},cache_control:p}):e.push({type:`bash_code_execution_tool_result`,tool_use_id:o.toolCallId,cache_control:p,content:{type:`bash_code_execution_tool_result_error`,error_code:n.errorCode??`unknown`}});break}if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}if(t.value==null||typeof t.value!=`object`||!(`type`in t.value)||typeof t.value.type!=`string`){n.push({type:`other`,message:`provider executed tool result output value is not a valid code execution result for tool ${o.toolName}`});break}if(t.value.type===`code_execution_result`){let n=await Qd({value:t.value,schema:Gf});e.push({type:`code_execution_tool_result`,tool_use_id:o.toolCallId,content:{type:n.type,stdout:n.stdout,stderr:n.stderr,return_code:n.return_code,content:n.content??[]},cache_control:p})}else{let n=await Qd({value:t.value,schema:Jf});n.type===`code_execution_result`?e.push({type:`code_execution_tool_result`,tool_use_id:o.toolCallId,content:{type:n.type,stdout:n.stdout,stderr:n.stderr,return_code:n.return_code,content:n.content??[]},cache_control:p}):n.type===`bash_code_execution_result`||n.type===`bash_code_execution_tool_result_error`?e.push({type:`bash_code_execution_tool_result`,tool_use_id:o.toolCallId,cache_control:p,content:n}):e.push({type:`text_editor_code_execution_tool_result`,tool_use_id:o.toolCallId,cache_control:p,content:n})}break}if(t===`web_fetch`){let t=o.output;if(t.type===`error-json`){let n={};try{typeof t.value==`string`?n=JSON.parse(t.value):typeof t.value==`object`&&t.value!==null&&(n=t.value)}catch{let e=t.value?.errorCode;n={errorCode:typeof e==`string`?e:`unknown`}}e.push({type:`web_fetch_tool_result`,tool_use_id:o.toolCallId,content:{type:`web_fetch_tool_result_error`,error_code:n.errorCode??`unknown`},cache_control:p});break}if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}let r=await Qd({value:t.value,schema:Bf});e.push({type:`web_fetch_tool_result`,tool_use_id:o.toolCallId,content:{type:`web_fetch_result`,url:r.url,retrieved_at:r.retrievedAt,content:{type:`document`,title:r.content.title,citations:r.content.citations,source:{type:r.content.source.type,media_type:r.content.source.mediaType,data:r.content.source.data}}},cache_control:p});break}if(t===`web_search`){let t=o.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}let r=await Qd({value:t.value,schema:If});e.push({type:`web_search_tool_result`,tool_use_id:o.toolCallId,content:r.map(e=>({url:e.url,title:e.title,page_age:e.pageAge,encrypted_content:e.encryptedContent,type:e.type})),cache_control:p});break}if(t===`tool_search_tool_regex`||t===`tool_search_tool_bm25`){let t=o.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}let r=(await Qd({value:t.value,schema:Zf})).map(e=>({type:`tool_reference`,tool_name:e.toolName}));e.push({type:`tool_search_tool_result`,tool_use_id:o.toolCallId,content:{type:`tool_search_tool_search_result`,tool_references:r},cache_control:p});break}n.push({type:`other`,message:`provider executed tool result for tool ${o.toolName} is not supported`});break}}}}l.push({role:`assistant`,content:e});break}default:{let e=p;throw Error(`content type: ${e}`)}}}return{prompt:{system:c,messages:l},betas:a}}function ap(e){let t=[],n;for(let r of e){let{role:e}=r;switch(e){case`system`:n?.type!==`system`&&(n={type:`system`,messages:[]},t.push(n)),n.messages.push(r);break;case`assistant`:n?.type!==`assistant`&&(n={type:`assistant`,messages:[]},t.push(n)),n.messages.push(r);break;case`user`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;case`tool`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;default:{let t=e;throw Error(`Unsupported role: ${t}`)}}}return t}function op({finishReason:e,isJsonResponseFromTool:t}){switch(e){case`pause_turn`:case`end_turn`:case`stop_sequence`:return`stop`;case`refusal`:return`content-filter`;case`tool_use`:return t?`stop`:`tool-calls`;case`max_tokens`:case`model_context_window_exceeded`:return`length`;default:return`other`}}function sp(e,t,n){if(e.type===`web_search_result_location`)return{type:`source`,sourceType:`url`,id:n(),url:e.url,title:e.title,providerMetadata:{anthropic:{citedText:e.cited_text,encryptedIndex:e.encrypted_index}}};if(e.type!==`page_location`&&e.type!==`char_location`)return;let r=t[e.document_index];if(r)return{type:`source`,sourceType:`document`,id:n(),mediaType:r.mediaType,title:e.document_title??r.title,filename:r.filename,providerMetadata:{anthropic:e.type===`page_location`?{citedText:e.cited_text,startPageNumber:e.start_page_number,endPageNumber:e.end_page_number}:{citedText:e.cited_text,startCharIndex:e.start_char_index,endCharIndex:e.end_char_index}}}}var cp=class{constructor(e,t){this.specificationVersion=`v3`,this.modelId=e,this.config=t,this.generateId=t.generateId??gu}supportsUrl(e){return e.protocol===`https:`}get provider(){return this.config.provider}get supportedUrls(){var e;return(e=this.config).supportedUrls?.call(e)??{}}async getArgs({userSuppliedBetas:e,prompt:t,maxOutputTokens:n,temperature:r,topP:i,topK:a,frequencyPenalty:o,presencePenalty:s,stopSequences:c,responseFormat:l,seed:u,tools:d,toolChoice:f,providerOptions:p,stream:m}){let h=[];o!=null&&h.push({type:`unsupported`,feature:`frequencyPenalty`}),s!=null&&h.push({type:`unsupported`,feature:`presencePenalty`}),u!=null&&h.push({type:`unsupported`,feature:`seed`}),r!=null&&r>1?(h.push({type:`unsupported`,feature:`temperature`,details:`${r} exceeds anthropic maximum of 1.0. clamped to 1.0`}),r=1):r!=null&&r<0&&(h.push({type:`unsupported`,feature:`temperature`,details:`${r} is below anthropic minimum of 0. clamped to 0`}),r=0),l?.type===`json`&&(l.schema??h.push({type:`unsupported`,feature:`responseFormat`,details:`JSON response format requires a schema. The response format is ignored.`}));let g=await af({provider:`anthropic`,providerOptions:p,schema:Of}),{maxOutputTokens:_,supportsStructuredOutput:v,isKnownModel:ee}=lp(this.modelId),y=(this.config.supportsNativeStructuredOutput??!0)&&v,b=g?.structuredOutputMode??`auto`,te=b===`outputFormat`||b===`auto`&&y,x=l?.type===`json`&&l.schema!=null&&!te?{type:`function`,name:`json`,description:`Respond with a JSON object.`,inputSchema:l.schema}:void 0,S=g?.contextManagement,ne=new jf,C=Zl({tools:d,providerToolNames:{"anthropic.code_execution_20250522":`code_execution`,"anthropic.code_execution_20250825":`code_execution`,"anthropic.computer_20241022":`computer`,"anthropic.computer_20250124":`computer`,"anthropic.text_editor_20241022":`str_replace_editor`,"anthropic.text_editor_20250124":`str_replace_editor`,"anthropic.text_editor_20250429":`str_replace_based_edit_tool`,"anthropic.text_editor_20250728":`str_replace_based_edit_tool`,"anthropic.bash_20241022":`bash`,"anthropic.bash_20250124":`bash`,"anthropic.memory_20250818":`memory`,"anthropic.web_search_20250305":`web_search`,"anthropic.web_fetch_20250910":`web_fetch`,"anthropic.tool_search_regex_20251119":`tool_search_tool_regex`,"anthropic.tool_search_bm25_20251119":`tool_search_tool_bm25`}}),{prompt:re,betas:w}=await ip({prompt:t,sendReasoning:g?.sendReasoning??!0,warnings:h,cacheControlValidator:ne,toolNameMapping:C}),ie=g?.thinking?.type===`enabled`,ae=g?.thinking?.budgetTokens,T=n??_,oe={model:this.modelId,max_tokens:T,temperature:r,top_k:a,top_p:i,stop_sequences:c,...ie&&{thinking:{type:`enabled`,budget_tokens:ae}},...g?.effort&&{output_config:{effort:g.effort}},...te&&l?.type===`json`&&l.schema!=null&&{output_format:{type:`json_schema`,schema:l.schema}},...g?.mcpServers&&g.mcpServers.length>0&&{mcp_servers:g.mcpServers.map(e=>({type:e.type,name:e.name,url:e.url,authorization_token:e.authorizationToken,tool_configuration:e.toolConfiguration?{allowed_tools:e.toolConfiguration.allowedTools,enabled:e.toolConfiguration.enabled}:void 0}))},...g?.container&&{container:g.container.skills&&g.container.skills.length>0?{id:g.container.id,skills:g.container.skills.map(e=>({type:e.type,skill_id:e.skillId,version:e.version}))}:g.container.id},system:re.system,messages:re.messages,...S&&{context_management:{edits:S.edits.map(e=>{let t=e.type;switch(t){case`clear_tool_uses_20250919`:return{type:e.type,...e.trigger!==void 0&&{trigger:e.trigger},...e.keep!==void 0&&{keep:e.keep},...e.clearAtLeast!==void 0&&{clear_at_least:e.clearAtLeast},...e.clearToolInputs!==void 0&&{clear_tool_inputs:e.clearToolInputs},...e.excludeTools!==void 0&&{exclude_tools:e.excludeTools}};case`clear_thinking_20251015`:return{type:e.type,...e.keep!==void 0&&{keep:e.keep}};default:h.push({type:`other`,message:`Unknown context management strategy: ${t}`});return}}).filter(e=>e!==void 0)}}};ie?(ae??=(h.push({type:`compatibility`,feature:`extended thinking`,details:`thinking budget is required when thinking is enabled. using default budget of 1024 tokens.`}),oe.thinking={type:`enabled`,budget_tokens:1024},1024),oe.temperature!=null&&(oe.temperature=void 0,h.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported when thinking is enabled`})),a!=null&&(oe.top_k=void 0,h.push({type:`unsupported`,feature:`topK`,details:`topK is not supported when thinking is enabled`})),i!=null&&(oe.top_p=void 0,h.push({type:`unsupported`,feature:`topP`,details:`topP is not supported when thinking is enabled`})),oe.max_tokens=T+(ae??0)):i!=null&&r!=null&&(h.push({type:`unsupported`,feature:`topP`,details:`topP is not supported when temperature is set. topP is ignored.`}),oe.top_p=void 0),ee&&oe.max_tokens>_&&(n!=null&&h.push({type:`unsupported`,feature:`maxOutputTokens`,details:`${oe.max_tokens} (maxOutputTokens + thinkingBudget) is greater than ${this.modelId} ${_} max output tokens. The max output tokens have been limited to ${_}.`}),oe.max_tokens=_),g?.mcpServers&&g.mcpServers.length>0&&w.add(`mcp-client-2025-04-04`),S&&w.add(`context-management-2025-06-27`),g?.container&&g.container.skills&&g.container.skills.length>0&&(w.add(`code-execution-2025-08-25`),w.add(`skills-2025-10-02`),w.add(`files-api-2025-04-14`),d?.some(e=>e.type===`provider`&&e.id===`anthropic.code_execution_20250825`)||h.push({type:`other`,message:`code execution tool is required when using skills`})),g?.effort&&w.add(`effort-2025-11-24`),m&&(g?.toolStreaming??!0)&&w.add(`fine-grained-tool-streaming-2025-05-14`),te&&l?.type===`json`&&l.schema!=null&&w.add(`structured-outputs-2025-11-13`);let{tools:se,toolChoice:E,toolWarnings:ce,betas:le}=await Uf(x==null?{tools:d??[],toolChoice:f,disableParallelToolUse:g?.disableParallelToolUse,cacheControlValidator:ne,supportsStructuredOutput:y}:{tools:[...d??[],x],toolChoice:{type:`required`},disableParallelToolUse:!0,cacheControlValidator:ne,supportsStructuredOutput:!1}),ue=ne.getWarnings();return{args:{...oe,tools:se,tool_choice:E,stream:m===!0?!0:void 0},warnings:[...h,...ce,...ue],betas:new Set([...w,...le,...e]),usesJsonResponseTool:x!=null,toolNameMapping:C}}async getHeaders({betas:e,headers:t}){return Xl(await mf(this.config.headers),t,e.size>0?{"anthropic-beta":Array.from(e).join(`,`)}:{})}async getBetasFromHeaders(e){let t=(await mf(this.config.headers))[`anthropic-beta`]??``,n=e?.[`anthropic-beta`]??``;return new Set([...t.toLowerCase().split(`,`),...n.toLowerCase().split(`,`)].map(e=>e.trim()).filter(e=>e!==``))}buildRequestUrl(e){var t;return(t=this.config).buildRequestUrl?.call(t,this.config.baseURL,e)??`${this.config.baseURL}/messages`}transformRequestBody(e){var t;return(t=this.config).transformRequestBody?.call(t,e)??e}extractCitationDocuments(e){return e.filter(e=>e.role===`user`).flatMap(e=>e.content).filter(e=>e.type!==`file`||e.mediaType!==`application/pdf`&&e.mediaType!==`text/plain`?!1:e.providerOptions?.anthropic?.citations?.enabled??!1).map(e=>{let t=e;return{title:t.filename??`Untitled Document`,filename:t.filename,mediaType:t.mediaType}})}async doGenerate(e){let{args:t,warnings:n,betas:r,usesJsonResponseTool:i,toolNameMapping:a}=await this.getArgs({...e,stream:!1,userSuppliedBetas:await this.getBetasFromHeaders(e.headers)}),o=[...this.extractCitationDocuments(e.prompt)],{responseHeaders:s,value:c,rawValue:l}=await sf({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(t),failedResponseHandler:Cf,successfulResponseHandler:_f(wf),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=[],d={},f={},p=!1;for(let e of c.content)switch(e.type){case`text`:if(!i&&(u.push({type:`text`,text:e.text}),e.citations))for(let t of e.citations){let e=sp(t,o,this.generateId);e&&u.push(e)}break;case`thinking`:u.push({type:`reasoning`,text:e.thinking,providerMetadata:{anthropic:{signature:e.signature}}});break;case`redacted_thinking`:u.push({type:`reasoning`,text:``,providerMetadata:{anthropic:{redactedData:e.data}}});break;case`tool_use`:if(i&&e.name===`json`)p=!0,u.push({type:`text`,text:JSON.stringify(e.input)});else{let t=e.caller,n=t?{type:t.type,toolId:`tool_id`in t?t.tool_id:void 0}:void 0;u.push({type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),...n&&{providerMetadata:{anthropic:{caller:n}}}})}break;case`server_tool_use`:if(e.name===`text_editor_code_execution`||e.name===`bash_code_execution`)u.push({type:`tool-call`,toolCallId:e.id,toolName:a.toCustomToolName(`code_execution`),input:JSON.stringify({type:e.name,...e.input}),providerExecuted:!0});else if(e.name===`web_search`||e.name===`code_execution`||e.name===`web_fetch`){let t=e.name===`code_execution`&&e.input!=null&&typeof e.input==`object`&&`code`in e.input&&!(`type`in e.input)?{type:`programmatic-tool-call`,...e.input}:e.input;u.push({type:`tool-call`,toolCallId:e.id,toolName:a.toCustomToolName(e.name),input:JSON.stringify(t),providerExecuted:!0})}else (e.name===`tool_search_tool_regex`||e.name===`tool_search_tool_bm25`)&&(f[e.id]=e.name,u.push({type:`tool-call`,toolCallId:e.id,toolName:a.toCustomToolName(e.name),input:JSON.stringify(e.input),providerExecuted:!0}));break;case`mcp_tool_use`:d[e.id]={type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),providerExecuted:!0,dynamic:!0,providerMetadata:{anthropic:{type:`mcp-tool-use`,serverName:e.server_name}}},u.push(d[e.id]);break;case`mcp_tool_result`:u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:d[e.tool_use_id].toolName,isError:e.is_error,result:e.content,dynamic:!0,providerMetadata:d[e.tool_use_id].providerMetadata});break;case`web_fetch_tool_result`:e.content.type===`web_fetch_result`?(o.push({title:e.content.content.title??e.content.url,mediaType:e.content.content.source.media_type}),u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),result:{type:`web_fetch_result`,url:e.content.url,retrievedAt:e.content.retrieved_at,content:{type:e.content.content.type,title:e.content.content.title,citations:e.content.content.citations,source:{type:e.content.content.source.type,mediaType:e.content.content.source.media_type,data:e.content.content.source.data}}}})):e.content.type===`web_fetch_tool_result_error`&&u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),isError:!0,result:{type:`web_fetch_tool_result_error`,errorCode:e.content.error_code}});break;case`web_search_tool_result`:if(Array.isArray(e.content)){u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),result:e.content.map(e=>({url:e.url,title:e.title,pageAge:e.page_age??null,encryptedContent:e.encrypted_content,type:e.type}))});for(let t of e.content)u.push({type:`source`,sourceType:`url`,id:this.generateId(),url:t.url,title:t.title,providerMetadata:{anthropic:{pageAge:t.page_age??null}}})}else u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code}});break;case`code_execution_tool_result`:e.content.type===`code_execution_result`?u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code,content:e.content.content??[]}}):e.content.type===`code_execution_tool_result_error`&&u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code}});break;case`bash_code_execution_tool_result`:case`text_editor_code_execution_tool_result`:u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:e.content});break;case`tool_search_tool_result`:{let t=f[e.tool_use_id]??`tool_search_tool_regex`;e.content.type===`tool_search_tool_search_result`?u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(t),result:e.content.tool_references.map(e=>({type:e.type,toolName:e.tool_name}))}):u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(t),isError:!0,result:{type:`tool_search_tool_result_error`,errorCode:e.content.error_code}});break}}return{content:u,finishReason:{unified:op({finishReason:c.stop_reason,isJsonResponseFromTool:p}),raw:c.stop_reason??void 0},usage:Wf(c.usage),request:{body:t},response:{id:c.id??void 0,modelId:c.model??void 0,headers:s,body:l},warnings:n,providerMetadata:{anthropic:{usage:c.usage,cacheCreationInputTokens:c.usage.cache_creation_input_tokens??null,stopSequence:c.stop_sequence??null,container:c.container?{expiresAt:c.container.expires_at,id:c.container.id,skills:c.container.skills?.map(e=>({type:e.type,skillId:e.skill_id,version:e.version}))??null}:null,contextManagement:up(c.context_management)??null}}}}async doStream(e){let{args:t,warnings:n,betas:r,usesJsonResponseTool:i,toolNameMapping:a}=await this.getArgs({...e,stream:!0,userSuppliedBetas:await this.getBetasFromHeaders(e.headers)}),o=[...this.extractCitationDocuments(e.prompt)],s=this.buildRequestUrl(!0),{responseHeaders:c,value:l}=await sf({url:s,headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(t),failedResponseHandler:Cf,successfulResponseHandler:gf(Tf),abortSignal:e.abortSignal,fetch:this.config.fetch}),u={unified:`other`,raw:void 0},f={input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0},p={},m={},h={},g=null,_,v=null,ee=null,y=null,b=!1,te,x=this.generateId,[S,ne]=l.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let r=t.value;switch(r.type){case`ping`:return;case`content_block_start`:{let e=r.content_block,t=e.type;switch(te=t,t){case`text`:if(i)return;p[r.index]={type:`text`},n.enqueue({type:`text-start`,id:String(r.index)});return;case`thinking`:p[r.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(r.index)});return;case`redacted_thinking`:p[r.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(r.index),providerMetadata:{anthropic:{redactedData:e.data}}});return;case`tool_use`:if(i&&e.name===`json`)b=!0,p[r.index]={type:`text`},n.enqueue({type:`text-start`,id:String(r.index)});else{let t=e.caller,i=t?{type:t.type,toolId:`tool_id`in t?t.tool_id:void 0}:void 0,a=e.input&&Object.keys(e.input).length>0?JSON.stringify(e.input):``;p[r.index]={type:`tool-call`,toolCallId:e.id,toolName:e.name,input:a,firstDelta:a.length===0,...i&&{caller:i}},n.enqueue({type:`tool-input-start`,id:e.id,toolName:e.name})}return;case`server_tool_use`:if([`web_fetch`,`web_search`,`code_execution`,`text_editor_code_execution`,`bash_code_execution`].includes(e.name)){let t=e.name===`text_editor_code_execution`||e.name===`bash_code_execution`?`code_execution`:e.name,i=a.toCustomToolName(t);p[r.index]={type:`tool-call`,toolCallId:e.id,toolName:i,input:``,providerExecuted:!0,firstDelta:!0,providerToolName:e.name},n.enqueue({type:`tool-input-start`,id:e.id,toolName:i,providerExecuted:!0})}else if(e.name===`tool_search_tool_regex`||e.name===`tool_search_tool_bm25`){h[e.id]=e.name;let t=a.toCustomToolName(e.name);p[r.index]={type:`tool-call`,toolCallId:e.id,toolName:t,input:``,providerExecuted:!0,firstDelta:!0,providerToolName:e.name},n.enqueue({type:`tool-input-start`,id:e.id,toolName:t,providerExecuted:!0})}return;case`web_fetch_tool_result`:e.content.type===`web_fetch_result`?(o.push({title:e.content.content.title??e.content.url,mediaType:e.content.content.source.media_type}),n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),result:{type:`web_fetch_result`,url:e.content.url,retrievedAt:e.content.retrieved_at,content:{type:e.content.content.type,title:e.content.content.title,citations:e.content.content.citations,source:{type:e.content.content.source.type,mediaType:e.content.content.source.media_type,data:e.content.content.source.data}}}})):e.content.type===`web_fetch_tool_result_error`&&n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),isError:!0,result:{type:`web_fetch_tool_result_error`,errorCode:e.content.error_code}});return;case`web_search_tool_result`:if(Array.isArray(e.content)){n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),result:e.content.map(e=>({url:e.url,title:e.title,pageAge:e.page_age??null,encryptedContent:e.encrypted_content,type:e.type}))});for(let t of e.content)n.enqueue({type:`source`,sourceType:`url`,id:x(),url:t.url,title:t.title,providerMetadata:{anthropic:{pageAge:t.page_age??null}}})}else n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code}});return;case`code_execution_tool_result`:e.content.type===`code_execution_result`?n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code,content:e.content.content??[]}}):e.content.type===`code_execution_tool_result_error`&&n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code}});return;case`bash_code_execution_tool_result`:case`text_editor_code_execution_tool_result`:n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:e.content});return;case`tool_search_tool_result`:{let t=h[e.tool_use_id]??`tool_search_tool_regex`;e.content.type===`tool_search_tool_search_result`?n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(t),result:e.content.tool_references.map(e=>({type:e.type,toolName:e.tool_name}))}):n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(t),isError:!0,result:{type:`tool_search_tool_result_error`,errorCode:e.content.error_code}});return}case`mcp_tool_use`:m[e.id]={type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),providerExecuted:!0,dynamic:!0,providerMetadata:{anthropic:{type:`mcp-tool-use`,serverName:e.server_name}}},n.enqueue(m[e.id]);return;case`mcp_tool_result`:n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:m[e.tool_use_id].toolName,isError:e.is_error,result:e.content,dynamic:!0,providerMetadata:m[e.tool_use_id].providerMetadata});return;default:{let e=t;throw Error(`Unsupported content block type: ${e}`)}}}case`content_block_stop`:if(p[r.index]!=null){let e=p[r.index];switch(e.type){case`text`:n.enqueue({type:`text-end`,id:String(r.index)});break;case`reasoning`:n.enqueue({type:`reasoning-end`,id:String(r.index)});break;case`tool-call`:if(!(i&&e.toolName===`json`)){n.enqueue({type:`tool-input-end`,id:e.toolCallId});let t=e.input===``?`{}`:e.input;if(e.providerToolName===`code_execution`)try{let e=JSON.parse(t);typeof e==`object`&&e&&`code`in e&&!(`type`in e)&&(t=JSON.stringify({type:`programmatic-tool-call`,...e}))}catch{}n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:t,providerExecuted:e.providerExecuted,...e.caller&&{providerMetadata:{anthropic:{caller:e.caller}}}})}break}delete p[r.index]}te=void 0;return;case`content_block_delta`:{let e=r.delta.type;switch(e){case`text_delta`:if(i)return;n.enqueue({type:`text-delta`,id:String(r.index),delta:r.delta.text});return;case`thinking_delta`:n.enqueue({type:`reasoning-delta`,id:String(r.index),delta:r.delta.thinking});return;case`signature_delta`:te===`thinking`&&n.enqueue({type:`reasoning-delta`,id:String(r.index),delta:``,providerMetadata:{anthropic:{signature:r.delta.signature}}});return;case`input_json_delta`:{let e=p[r.index],t=r.delta.partial_json;if(t.length===0)return;if(b){if(e?.type!==`text`)return;n.enqueue({type:`text-delta`,id:String(r.index),delta:t})}else{if(e?.type!==`tool-call`)return;e.firstDelta&&(e.providerToolName===`bash_code_execution`||e.providerToolName===`text_editor_code_execution`)&&(t=`{"type": "${e.providerToolName}",${t.substring(1)}`),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:t}),e.input+=t,e.firstDelta=!1}return}case`citations_delta`:{let e=r.delta.citation,t=sp(e,o,x);t&&n.enqueue(t);return}default:{let t=e;throw Error(`Unsupported delta type: ${t}`)}}}case`message_start`:if(f.input_tokens=r.message.usage.input_tokens,f.cache_read_input_tokens=r.message.usage.cache_read_input_tokens??0,f.cache_creation_input_tokens=r.message.usage.cache_creation_input_tokens??0,_={...r.message.usage},v=r.message.usage.cache_creation_input_tokens??null,r.message.container!=null&&(y={expiresAt:r.message.container.expires_at,id:r.message.container.id,skills:null}),r.message.stop_reason!=null&&(u={unified:op({finishReason:r.message.stop_reason,isJsonResponseFromTool:b}),raw:r.message.stop_reason}),n.enqueue({type:`response-metadata`,id:r.message.id??void 0,modelId:r.message.model??void 0}),r.message.content!=null)for(let e=0;e<r.message.content.length;e++){let t=r.message.content[e];if(t.type===`tool_use`){let e=t.caller,r=e?{type:e.type,toolId:`tool_id`in e?e.tool_id:void 0}:void 0;n.enqueue({type:`tool-input-start`,id:t.id,toolName:t.name});let i=JSON.stringify(t.input??{});n.enqueue({type:`tool-input-delta`,id:t.id,delta:i}),n.enqueue({type:`tool-input-end`,id:t.id}),n.enqueue({type:`tool-call`,toolCallId:t.id,toolName:t.name,input:i,...r&&{providerMetadata:{anthropic:{caller:r}}}})}}return;case`message_delta`:r.usage.input_tokens!=null&&f.input_tokens!==r.usage.input_tokens&&(f.input_tokens=r.usage.input_tokens),f.output_tokens=r.usage.output_tokens,u={unified:op({finishReason:r.delta.stop_reason,isJsonResponseFromTool:b}),raw:r.delta.stop_reason??void 0},ee=r.delta.stop_sequence??null,y=r.delta.container==null?null:{expiresAt:r.delta.container.expires_at,id:r.delta.container.id,skills:r.delta.container.skills?.map(e=>({type:e.type,skillId:e.skill_id,version:e.version}))??null},r.delta.context_management&&(g=up(r.delta.context_management)),_={..._,...r.usage};return;case`message_stop`:n.enqueue({type:`finish`,finishReason:u,usage:Wf(f),providerMetadata:{anthropic:{usage:_??null,cacheCreationInputTokens:v,stopSequence:ee,container:y,contextManagement:g}}});return;case`error`:n.enqueue({type:`error`,error:r.error});return;default:{let e=r;throw Error(`Unsupported chunk type: ${e}`)}}}})).tee(),C=S.getReader();try{await C.read();let e=await C.read();if(e.value?.type===`raw`&&(e=await C.read()),e.value?.type===`error`){let n=e.value.error;throw new d({message:n.message,url:s,requestBodyValues:t,statusCode:n.type===`overloaded_error`?529:500,responseHeaders:c,responseBody:JSON.stringify(n),isRetryable:n.type===`overloaded_error`})}}finally{C.cancel().catch(()=>{}),C.releaseLock()}return{stream:ne,request:{body:t},response:{headers:c}}}};function lp(e){return e.includes(`claude-sonnet-4-5`)||e.includes(`claude-opus-4-5`)||e.includes(`claude-haiku-4-5`)?{maxOutputTokens:64e3,supportsStructuredOutput:!0,isKnownModel:!0}:e.includes(`claude-opus-4-1`)?{maxOutputTokens:32e3,supportsStructuredOutput:!0,isKnownModel:!0}:e.includes(`claude-sonnet-4-`)||e.includes(`claude-3-7-sonnet`)?{maxOutputTokens:64e3,supportsStructuredOutput:!1,isKnownModel:!0}:e.includes(`claude-opus-4-`)?{maxOutputTokens:32e3,supportsStructuredOutput:!1,isKnownModel:!0}:e.includes(`claude-3-5-haiku`)?{maxOutputTokens:8192,supportsStructuredOutput:!1,isKnownModel:!0}:e.includes(`claude-3-haiku`)?{maxOutputTokens:4096,supportsStructuredOutput:!1,isKnownModel:!0}:{maxOutputTokens:4096,supportsStructuredOutput:!1,isKnownModel:!1}}function up(e){return e?{appliedEdits:e.applied_edits.map(e=>{switch(e.type){case`clear_tool_uses_20250919`:return{type:e.type,clearedToolUses:e.cleared_tool_uses,clearedInputTokens:e.cleared_input_tokens};case`clear_thinking_20251015`:return{type:e.type,clearedThinkingTurns:e.cleared_thinking_turns,clearedInputTokens:e.cleared_input_tokens}}}).filter(e=>e!==void 0)}:null}var dp=ff({id:`anthropic.bash_20241022`,inputSchema:X(()=>Z(I({command:A(),restart:M().optional()})))}),fp=ff({id:`anthropic.bash_20250124`,inputSchema:X(()=>Z(I({command:A(),restart:M().optional()})))}),pp=ff({id:`anthropic.computer_20241022`,inputSchema:X(()=>Z(I({action:z([`key`,`type`,`mouse_move`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`screenshot`,`cursor_position`]),coordinate:F(j().int()).optional(),text:A().optional()})))}),mp=ff({id:`anthropic.computer_20250124`,inputSchema:X(()=>Z(I({action:z([`key`,`hold_key`,`type`,`cursor_position`,`mouse_move`,`left_mouse_down`,`left_mouse_up`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`triple_click`,`scroll`,`wait`,`screenshot`]),coordinate:Bs([j().int(),j().int()]).optional(),duration:j().optional(),scroll_amount:j().optional(),scroll_direction:z([`up`,`down`,`left`,`right`]).optional(),start_coordinate:Bs([j().int(),j().int()]).optional(),text:A().optional()})))}),hp=ff({id:`anthropic.memory_20250818`,inputSchema:X(()=>Z(R(`command`,[I({command:B(`view`),path:A(),view_range:Bs([j(),j()]).optional()}),I({command:B(`create`),path:A(),file_text:A()}),I({command:B(`str_replace`),path:A(),old_str:A(),new_str:A()}),I({command:B(`insert`),path:A(),insert_line:j(),insert_text:A()}),I({command:B(`delete`),path:A()}),I({command:B(`rename`),old_path:A(),new_path:A()})])))}),gp=ff({id:`anthropic.text_editor_20241022`,inputSchema:X(()=>Z(I({command:z([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:A(),file_text:A().optional(),insert_line:j().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:F(j().int()).optional()})))}),_p=ff({id:`anthropic.text_editor_20250124`,inputSchema:X(()=>Z(I({command:z([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:A(),file_text:A().optional(),insert_line:j().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:F(j().int()).optional()})))}),vp=ff({id:`anthropic.text_editor_20250429`,inputSchema:X(()=>Z(I({command:z([`view`,`create`,`str_replace`,`insert`]),path:A(),file_text:A().optional(),insert_line:j().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:F(j().int()).optional()})))}),yp=X(()=>Z(F(I({type:B(`tool_reference`),toolName:A()})))),bp=pf({id:`anthropic.tool_search_bm25_20251119`,inputSchema:X(()=>Z(I({query:A(),limit:j().optional()}))),outputSchema:yp}),xp={bash_20241022:dp,bash_20250124:fp,codeExecution_20250522:qf,codeExecution_20250825:Xf,computer_20241022:pp,computer_20250124:mp,memory_20250818:hp,textEditor_20241022:gp,textEditor_20250124:_p,textEditor_20250429:vp,textEditor_20250728:Pf,webFetch_20250910:Hf,webSearch_20250305:Rf,toolSearchRegex_20251119:$f,toolSearchBm25_20251119:(e={})=>bp(e)};function Sp(e={}){let t=yf(Fu({settingValue:e.baseURL,environmentVariableName:`ANTHROPIC_BASE_URL`}))??`https://api.anthropic.com/v1`,n=e.name??`anthropic.messages`,r=()=>Cu({"anthropic-version":`2023-06-01`,"x-api-key":Pu({apiKey:e.apiKey,environmentVariableName:`ANTHROPIC_API_KEY`,description:`Anthropic`}),...e.headers},`ai-sdk/anthropic/${Sf}`),i=i=>new cp(i,{provider:n,baseURL:t,headers:r,fetch:e.fetch,generateId:e.generateId??gu,supportedUrls:()=>({"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]})}),a=function(e){if(new.target)throw Error(`The Anthropic model function cannot be called with the new keyword.`);return i(e)};return a.specificationVersion=`v3`,a.languageModel=i,a.chat=i,a.messages=i,a.embeddingModel=e=>{throw new ze({modelId:e,modelType:`embeddingModel`})},a.textEmbeddingModel=a.embeddingModel,a.imageModel=e=>{throw new ze({modelId:e,modelType:`imageModel`})},a.tools=xp,a}var Cp=Sp();function wp({steps:e}){for(let t=e.length-1;t>=0;t--){let n=e[t].providerMetadata?.anthropic?.container?.id;if(n)return{providerOptions:{anthropic:{container:{id:n}}}}}}var Tp=`3.0.10`,Ep=hf({errorSchema:X(()=>Z(I({error:I({code:j().nullable(),message:A(),status:A()})}))),errorToMessage:e=>e.error.message}),Dp=X(()=>Z(I({outputDimensionality:j().optional(),taskType:z([`SEMANTIC_SIMILARITY`,`CLASSIFICATION`,`CLUSTERING`,`RETRIEVAL_DOCUMENT`,`RETRIEVAL_QUERY`,`QUESTION_ANSWERING`,`FACT_VERIFICATION`,`CODE_RETRIEVAL_QUERY`]).optional()}))),Op=class{constructor(e,t){this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){let i=await af({provider:`google`,providerOptions:r,schema:Dp});if(e.length>this.maxEmbeddingsPerCall)throw new Ge({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=Xl(await mf(this.config.headers),t);if(e.length===1){let{responseHeaders:t,value:r,rawValue:o}=await sf({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:a,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType},failedResponseHandler:Ep,successfulResponseHandler:_f(Ap),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:[r.embedding.values],usage:void 0,response:{headers:t,body:o}}}let{responseHeaders:o,value:s,rawValue:c}=await sf({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:a,body:{requests:e.map(e=>({model:`models/${this.modelId}`,content:{role:`user`,parts:[{text:e}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType}))},failedResponseHandler:Ep,successfulResponseHandler:_f(kp),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:s.embeddings.map(e=>e.values),usage:void 0,response:{headers:o,body:c}}}},kp=X(()=>Z(I({embeddings:F(I({values:F(j())}))}))),Ap=X(()=>Z(I({embedding:I({values:F(j())})})));function jp(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.promptTokenCount??0,n=e.candidatesTokenCount??0,r=e.cachedContentTokenCount??0,i=e.thoughtsTokenCount??0;return{inputTokens:{total:t,noCache:t-r,cacheRead:r,cacheWrite:void 0},outputTokens:{total:n+i,text:n,reasoning:i},raw:e}}function Mp(e,t=!0){if(e==null)return;if(Np(e))return t?void 0:typeof e==`object`&&e.description?{type:`object`,description:e.description}:{type:`object`};if(typeof e==`boolean`)return{type:`boolean`,properties:{}};let{type:n,description:r,required:i,properties:a,items:o,allOf:s,anyOf:c,oneOf:l,format:u,const:d,minLength:f,enum:p}=e,m={};if(r&&(m.description=r),i&&(m.required=i),u&&(m.format=u),d!==void 0&&(m.enum=[d]),n)if(Array.isArray(n)){let e=n.includes(`null`),t=n.filter(e=>e!==`null`);t.length===0?m.type=`null`:(m.anyOf=t.map(e=>({type:e})),e&&(m.nullable=!0))}else m.type=n;if(p!==void 0&&(m.enum=p),a!=null&&(m.properties=Object.entries(a).reduce((e,[t,n])=>(e[t]=Mp(n,!1),e),{})),o&&(m.items=Array.isArray(o)?o.map(e=>Mp(e,!1)):Mp(o,!1)),s&&(m.allOf=s.map(e=>Mp(e,!1))),c)if(c.some(e=>typeof e==`object`&&e?.type===`null`)){let e=c.filter(e=>!(typeof e==`object`&&e?.type===`null`));if(e.length===1){let t=Mp(e[0],!1);typeof t==`object`&&(m.nullable=!0,Object.assign(m,t))}else m.anyOf=e.map(e=>Mp(e,!1)),m.nullable=!0}else m.anyOf=c.map(e=>Mp(e,!1));return l&&(m.oneOf=l.map(e=>Mp(e,!1))),f!==void 0&&(m.minLength=f),m}function Np(e){return typeof e==`object`&&!!e&&e.type===`object`&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function Pp(e,t){let n=[],r=[],i=!0,a=t?.isGemmaModel??!1,o=t?.providerOptionsName??`google`;for(let{role:t,content:a}of e)switch(t){case`system`:if(!i)throw new rt({functionality:`system messages are only supported at the beginning of the conversation`});n.push({text:a});break;case`user`:{i=!1;let e=[];for(let t of a)switch(t.type){case`text`:e.push({text:t.text});break;case`file`:{let n=t.mediaType===`image/*`?`image/jpeg`:t.mediaType;e.push(t.data instanceof URL?{fileData:{mimeType:n,fileUri:t.data.toString()}}:{inlineData:{mimeType:n,data:ou(t.data)}});break}}r.push({role:`user`,parts:e});break}case`assistant`:i=!1,r.push({role:`model`,parts:a.map(e=>{let t=e.providerOptions?.[o],n=t?.thoughtSignature==null?void 0:String(t.thoughtSignature);switch(e.type){case`text`:return e.text.length===0?void 0:{text:e.text,thoughtSignature:n};case`reasoning`:return e.text.length===0?void 0:{text:e.text,thought:!0,thoughtSignature:n};case`file`:if(e.data instanceof URL)throw new rt({functionality:`File data URLs in assistant messages are not supported`});return{inlineData:{mimeType:e.mediaType,data:ou(e.data)},thoughtSignature:n};case`tool-call`:return{functionCall:{name:e.toolName,args:e.input},thoughtSignature:n}}}).filter(e=>e!==void 0)});break;case`tool`:{i=!1;let e=[];for(let t of a){if(t.type===`tool-approval-response`)continue;let n=t.output;if(n.type===`content`)for(let r of n.value)switch(r.type){case`text`:e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:r.text}}});break;case`image-data`:e.push({inlineData:{mimeType:r.mediaType,data:r.data}},{text:`Tool executed successfully and returned this image as a response`});break;default:e.push({text:JSON.stringify(r)});break}else e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:n.type===`execution-denied`?n.reason??`Tool execution denied.`:n.value}}})}r.push({role:`user`,parts:e});break}}if(a&&n.length>0&&r.length>0&&r[0].role===`user`){let e=n.map(e=>e.text).join(`

`);r[0].parts.unshift({text:e+`

`})}return{systemInstruction:n.length>0&&!a?{parts:n}:void 0,contents:r}}function Fp(e){return e.includes(`/`)?e:`models/${e}`}var Ip=X(()=>Z(I({responseModalities:F(z([`TEXT`,`IMAGE`])).optional(),thinkingConfig:I({thinkingBudget:j().optional(),includeThoughts:M().optional(),thinkingLevel:z([`minimal`,`low`,`medium`,`high`]).optional()}).optional(),cachedContent:A().optional(),structuredOutputs:M().optional(),safetySettings:F(I({category:z([`HARM_CATEGORY_UNSPECIFIED`,`HARM_CATEGORY_HATE_SPEECH`,`HARM_CATEGORY_DANGEROUS_CONTENT`,`HARM_CATEGORY_HARASSMENT`,`HARM_CATEGORY_SEXUALLY_EXPLICIT`,`HARM_CATEGORY_CIVIC_INTEGRITY`]),threshold:z([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`])})).optional(),threshold:z([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`]).optional(),audioTimestamp:M().optional(),labels:Hs(A(),A()).optional(),mediaResolution:z([`MEDIA_RESOLUTION_UNSPECIFIED`,`MEDIA_RESOLUTION_LOW`,`MEDIA_RESOLUTION_MEDIUM`,`MEDIA_RESOLUTION_HIGH`]).optional(),imageConfig:I({aspectRatio:z([`1:1`,`2:3`,`3:2`,`3:4`,`4:3`,`4:5`,`5:4`,`9:16`,`16:9`,`21:9`]).optional(),imageSize:z([`1K`,`2K`,`4K`]).optional()}).optional(),retrievalConfig:I({latLng:I({latitude:j(),longitude:j()}).optional()}).optional()})));function Lp({tools:e,toolChoice:t,modelId:n}){e=e?.length?e:void 0;let r=[],i=[`gemini-flash-latest`,`gemini-flash-lite-latest`,`gemini-pro-latest`].some(e=>e===n),a=n.includes(`gemini-2`)||n.includes(`gemini-3`)||i,o=n.includes(`gemini-1.5-flash`)&&!n.includes(`-8b`),s=n.includes(`gemini-2.5`)||n.includes(`gemini-3`);if(e==null)return{tools:void 0,toolConfig:void 0,toolWarnings:r};let c=e.some(e=>e.type===`function`),l=e.some(e=>e.type===`provider`);if(c&&l&&r.push({type:`unsupported`,feature:`combination of function and provider-defined tools`}),l){let t=[];return e.filter(e=>e.type===`provider`).forEach(e=>{switch(e.id){case`google.google_search`:a?t.push({googleSearch:{}}):o?t.push({googleSearchRetrieval:{dynamicRetrievalConfig:{mode:e.args.mode,dynamicThreshold:e.args.dynamicThreshold}}}):t.push({googleSearchRetrieval:{}});break;case`google.enterprise_web_search`:a?t.push({enterpriseWebSearch:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`Enterprise Web Search requires Gemini 2.0 or newer.`});break;case`google.url_context`:a?t.push({urlContext:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The URL context tool is not supported with other Gemini models than Gemini 2.`});break;case`google.code_execution`:a?t.push({codeExecution:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The code execution tools is not supported with other Gemini models than Gemini 2.`});break;case`google.file_search`:s?t.push({fileSearch:{...e.args}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The file search tool is only supported with Gemini 2.5 models and Gemini 3 models.`});break;case`google.vertex_rag_store`:a?t.push({retrieval:{vertex_rag_store:{rag_resources:{rag_corpus:e.args.ragCorpus},similarity_top_k:e.args.topK}}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The RAG store tool is not supported with other Gemini models than Gemini 2.`});break;case`google.google_maps`:a?t.push({googleMaps:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The Google Maps grounding tool is not supported with Gemini models other than Gemini 2 or newer.`});break;default:r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`});break}}),{tools:t.length>0?t:void 0,toolConfig:void 0,toolWarnings:r}}let u=[];for(let t of e)switch(t.type){case`function`:u.push({name:t.name,description:t.description??``,parameters:Mp(t.inputSchema)});break;default:r.push({type:`unsupported`,feature:`function tool ${t.name}`});break}if(t==null)return{tools:[{functionDeclarations:u}],toolConfig:void 0,toolWarnings:r};let d=t.type;switch(d){case`auto`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`AUTO`}},toolWarnings:r};case`none`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`NONE`}},toolWarnings:r};case`required`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`ANY`}},toolWarnings:r};case`tool`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`ANY`,allowedFunctionNames:[t.toolName]}},toolWarnings:r};default:throw new rt({functionality:`tool choice type: ${d}`})}}function Rp({finishReason:e,hasToolCalls:t}){switch(e){case`STOP`:return t?`tool-calls`:`stop`;case`MAX_TOKENS`:return`length`;case`IMAGE_SAFETY`:case`RECITATION`:case`SAFETY`:case`BLOCKLIST`:case`PROHIBITED_CONTENT`:case`SPII`:return`content-filter`;case`MALFORMED_FUNCTION_CALL`:return`error`;case`FINISH_REASON_UNSPECIFIED`:case`OTHER`:default:return`other`}}var zp=class{constructor(e,t){this.specificationVersion=`v3`,this.modelId=e,this.config=t,this.generateId=t.generateId??gu}get provider(){return this.config.provider}get supportedUrls(){var e;return(e=this.config).supportedUrls?.call(e)??{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){let p=[],m=this.config.provider.includes(`vertex`)?`vertex`:`google`,h=await af({provider:m,providerOptions:f,schema:Ip});h==null&&m!==`google`&&(h=await af({provider:`google`,providerOptions:f,schema:Ip})),u?.some(e=>e.type===`provider`&&e.id===`google.vertex_rag_store`)&&!this.config.provider.startsWith(`google.vertex.`)&&p.push({type:`other`,message:`The 'vertex_rag_store' tool is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let g=this.modelId.toLowerCase().startsWith(`gemma-`),{contents:_,systemInstruction:v}=Pp(e,{isGemmaModel:g,providerOptionsName:m}),{tools:ee,toolConfig:y,toolWarnings:b}=Lp({tools:u,toolChoice:d,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:t,temperature:n,topK:i,topP:r,frequencyPenalty:a,presencePenalty:o,stopSequences:s,seed:l,responseMimeType:c?.type===`json`?`application/json`:void 0,responseSchema:c?.type===`json`&&c.schema!=null&&(h?.structuredOutputs??!0)?Mp(c.schema):void 0,...h?.audioTimestamp&&{audioTimestamp:h.audioTimestamp},responseModalities:h?.responseModalities,thinkingConfig:h?.thinkingConfig,...h?.mediaResolution&&{mediaResolution:h.mediaResolution},...h?.imageConfig&&{imageConfig:h.imageConfig}},contents:_,systemInstruction:g?void 0:v,safetySettings:h?.safetySettings,tools:ee,toolConfig:h?.retrievalConfig?{...y,retrievalConfig:h.retrievalConfig}:y,cachedContent:h?.cachedContent,labels:h?.labels},warnings:[...p,...b],providerOptionsName:m}}async doGenerate(e){let{args:t,warnings:n,providerOptionsName:r}=await this.getArgs(e),i=Xl(await mf(this.config.headers),e.headers),{responseHeaders:a,value:o,rawValue:s}=await sf({url:`${this.config.baseURL}/${Fp(this.modelId)}:generateContent`,headers:i,body:t,failedResponseHandler:Ep,successfulResponseHandler:_f(qp),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=o.candidates[0],l=[],u=c.content?.parts??[],d=o.usageMetadata,f;for(let e of u)if(`executableCode`in e&&e.executableCode?.code){let t=this.config.generateId();f=t,l.push({type:`tool-call`,toolCallId:t,toolName:`code_execution`,input:JSON.stringify(e.executableCode),providerExecuted:!0})}else `codeExecutionResult`in e&&e.codeExecutionResult?(l.push({type:`tool-result`,toolCallId:f,toolName:`code_execution`,result:{outcome:e.codeExecutionResult.outcome,output:e.codeExecutionResult.output}}),f=void 0):`text`in e&&e.text!=null&&e.text.length>0?l.push({type:e.thought===!0?`reasoning`:`text`,text:e.text,providerMetadata:e.thoughtSignature?{[r]:{thoughtSignature:e.thoughtSignature}}:void 0}):`functionCall`in e?l.push({type:`tool-call`,toolCallId:this.config.generateId(),toolName:e.functionCall.name,input:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{[r]:{thoughtSignature:e.thoughtSignature}}:void 0}):`inlineData`in e&&l.push({type:`file`,data:e.inlineData.data,mediaType:e.inlineData.mimeType,providerMetadata:e.thoughtSignature?{[r]:{thoughtSignature:e.thoughtSignature}}:void 0});let p=Vp({groundingMetadata:c.groundingMetadata,generateId:this.config.generateId})??[];for(let e of p)l.push(e);return{content:l,finishReason:{unified:Rp({finishReason:c.finishReason,hasToolCalls:l.some(e=>e.type===`tool-call`&&!e.providerExecuted)}),raw:c.finishReason??void 0},usage:jp(d),warnings:n,providerMetadata:{[r]:{promptFeedback:o.promptFeedback??null,groundingMetadata:c.groundingMetadata??null,urlContextMetadata:c.urlContextMetadata??null,safetyRatings:c.safetyRatings??null,usageMetadata:d??null}},request:{body:t},response:{headers:a,body:s}}}async doStream(e){let{args:t,warnings:n,providerOptionsName:r}=await this.getArgs(e),i=Xl(await mf(this.config.headers),e.headers),{responseHeaders:a,value:o}=await sf({url:`${this.config.baseURL}/${Fp(this.modelId)}:streamGenerateContent?alt=sse`,headers:i,body:t,failedResponseHandler:Ep,successfulResponseHandler:gf(Jp),abortSignal:e.abortSignal,fetch:this.config.fetch}),s={unified:`other`,raw:void 0},c,l,u=this.config.generateId,d=!1,f=null,p=null,m=0,h=new Set,g;return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let i=t.value,a=i.usageMetadata;a!=null&&(c=a);let o=i.candidates?.[0];if(o==null)return;let _=o.content,v=Vp({groundingMetadata:o.groundingMetadata,generateId:u});if(v!=null)for(let e of v)e.sourceType===`url`&&!h.has(e.url)&&(h.add(e.url),n.enqueue(e));if(_!=null){let e=_.parts??[];for(let t of e)if(`executableCode`in t&&t.executableCode?.code){let e=u();g=e,n.enqueue({type:`tool-call`,toolCallId:e,toolName:`code_execution`,input:JSON.stringify(t.executableCode),providerExecuted:!0})}else if(`codeExecutionResult`in t&&t.codeExecutionResult){let e=g;e&&(n.enqueue({type:`tool-result`,toolCallId:e,toolName:`code_execution`,result:{outcome:t.codeExecutionResult.outcome,output:t.codeExecutionResult.output}}),g=void 0)}else `text`in t&&t.text!=null&&t.text.length>0?t.thought===!0?(f!==null&&(n.enqueue({type:`text-end`,id:f}),f=null),p===null&&(p=String(m++),n.enqueue({type:`reasoning-start`,id:p,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`reasoning-delta`,id:p,delta:t.text,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})):(p!==null&&(n.enqueue({type:`reasoning-end`,id:p}),p=null),f===null&&(f=String(m++),n.enqueue({type:`text-start`,id:f,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`text-delta`,id:f,delta:t.text,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})):`inlineData`in t&&n.enqueue({type:`file`,mediaType:t.inlineData.mimeType,data:t.inlineData.data});let t=Bp({parts:_.parts,generateId:u,providerOptionsName:r});if(t!=null)for(let e of t)n.enqueue({type:`tool-input-start`,id:e.toolCallId,toolName:e.toolName,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:e.args,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-end`,id:e.toolCallId,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.args,providerMetadata:e.providerMetadata}),d=!0}o.finishReason!=null&&(s={unified:Rp({finishReason:o.finishReason,hasToolCalls:d}),raw:o.finishReason},l={[r]:{promptFeedback:i.promptFeedback??null,groundingMetadata:o.groundingMetadata??null,urlContextMetadata:o.urlContextMetadata??null,safetyRatings:o.safetyRatings??null}},a!=null&&(l[r].usageMetadata=a))},flush(e){f!==null&&e.enqueue({type:`text-end`,id:f}),p!==null&&e.enqueue({type:`reasoning-end`,id:p}),e.enqueue({type:`finish`,finishReason:s,usage:jp(c),providerMetadata:l})}})),response:{headers:a},request:{body:t}}}};function Bp({parts:e,generateId:t,providerOptionsName:n}){let r=e?.filter(e=>`functionCall`in e);return r==null||r.length===0?void 0:r.map(e=>({type:`tool-call`,toolCallId:t(),toolName:e.functionCall.name,args:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{[n]:{thoughtSignature:e.thoughtSignature}}:void 0}))}function Vp({groundingMetadata:e,generateId:t}){if(!e?.groundingChunks)return;let n=[];for(let r of e.groundingChunks)if(r.web!=null)n.push({type:`source`,sourceType:`url`,id:t(),url:r.web.uri,title:r.web.title??void 0});else if(r.retrievedContext!=null){let e=r.retrievedContext.uri,i=r.retrievedContext.fileSearchStore;if(e&&(e.startsWith(`http://`)||e.startsWith(`https://`)))n.push({type:`source`,sourceType:`url`,id:t(),url:e,title:r.retrievedContext.title??void 0});else if(e){let i=r.retrievedContext.title??`Unknown Document`,a=`application/octet-stream`,o;e.endsWith(`.pdf`)?(a=`application/pdf`,o=e.split(`/`).pop()):e.endsWith(`.txt`)?(a=`text/plain`,o=e.split(`/`).pop()):e.endsWith(`.docx`)?(a=`application/vnd.openxmlformats-officedocument.wordprocessingml.document`,o=e.split(`/`).pop()):e.endsWith(`.doc`)?(a=`application/msword`,o=e.split(`/`).pop()):(e.match(/\.(md|markdown)$/)&&(a=`text/markdown`),o=e.split(`/`).pop()),n.push({type:`source`,sourceType:`document`,id:t(),mediaType:a,title:i,filename:o})}else if(i){let e=r.retrievedContext.title??`Unknown Document`;n.push({type:`source`,sourceType:`document`,id:t(),mediaType:`application/octet-stream`,title:e,filename:i.split(`/`).pop()})}}else r.maps!=null&&r.maps.uri&&n.push({type:`source`,sourceType:`url`,id:t(),url:r.maps.uri,title:r.maps.title??void 0});return n.length>0?n:void 0}var Hp=()=>I({webSearchQueries:F(A()).nullish(),retrievalQueries:F(A()).nullish(),searchEntryPoint:I({renderedContent:A()}).nullish(),groundingChunks:F(I({web:I({uri:A(),title:A().nullish()}).nullish(),retrievedContext:I({uri:A().nullish(),title:A().nullish(),text:A().nullish(),fileSearchStore:A().nullish()}).nullish(),maps:I({uri:A().nullish(),title:A().nullish(),text:A().nullish(),placeId:A().nullish()}).nullish()})).nullish(),groundingSupports:F(I({segment:I({startIndex:j().nullish(),endIndex:j().nullish(),text:A().nullish()}),segment_text:A().nullish(),groundingChunkIndices:F(j()).nullish(),supportChunkIndices:F(j()).nullish(),confidenceScores:F(j()).nullish(),confidenceScore:F(j()).nullish()})).nullish(),retrievalMetadata:L([I({webDynamicRetrievalScore:j()}),I({})]).nullish()}),Up=()=>I({parts:F(L([I({functionCall:I({name:A(),args:N()}),thoughtSignature:A().nullish()}),I({inlineData:I({mimeType:A(),data:A()}),thoughtSignature:A().nullish()}),I({executableCode:I({language:A(),code:A()}).nullish(),codeExecutionResult:I({outcome:A(),output:A()}).nullish(),text:A().nullish(),thought:M().nullish(),thoughtSignature:A().nullish()})])).nullish()}),Wp=()=>I({category:A().nullish(),probability:A().nullish(),probabilityScore:j().nullish(),severity:A().nullish(),severityScore:j().nullish(),blocked:M().nullish()}),Gp=I({cachedContentTokenCount:j().nullish(),thoughtsTokenCount:j().nullish(),promptTokenCount:j().nullish(),candidatesTokenCount:j().nullish(),totalTokenCount:j().nullish(),trafficType:A().nullish()}),Kp=()=>I({urlMetadata:F(I({retrievedUrl:A(),urlRetrievalStatus:A()}))}),qp=X(()=>Z(I({candidates:F(I({content:Up().nullish().or(I({}).strict()),finishReason:A().nullish(),safetyRatings:F(Wp()).nullish(),groundingMetadata:Hp().nullish(),urlContextMetadata:Kp().nullish()})),usageMetadata:Gp.nullish(),promptFeedback:I({blockReason:A().nullish(),safetyRatings:F(Wp()).nullish()}).nullish()}))),Jp=X(()=>Z(I({candidates:F(I({content:Up().nullish(),finishReason:A().nullish(),safetyRatings:F(Wp()).nullish(),groundingMetadata:Hp().nullish(),urlContextMetadata:Kp().nullish()})).nullish(),usageMetadata:Gp.nullish(),promptFeedback:I({blockReason:A().nullish(),safetyRatings:F(Wp()).nullish()}).nullish()}))),Yp=pf({id:`google.code_execution`,inputSchema:I({language:A().describe(`The programming language of the code.`),code:A().describe(`The code to be executed.`)}),outputSchema:I({outcome:A().describe(`The outcome of the execution (e.g., "OUTCOME_OK").`),output:A().describe(`The output from the code execution.`)})}),Xp=ff({id:`google.enterprise_web_search`,inputSchema:X(()=>Z(I({})))}),Zp=I({fileSearchStoreNames:F(A()).describe("The names of the file_search_stores to retrieve from. Example: `fileSearchStores/my-file-search-store-123`"),topK:j().int().positive().describe(`The number of file search retrieval chunks to retrieve.`).optional(),metadataFilter:A().describe(`Metadata filter to apply to the file search retrieval documents. See https://google.aip.dev/160 for the syntax of the filter expression.`).optional()}).passthrough(),Qp=ff({id:`google.file_search`,inputSchema:X(()=>Z(Zp))}),$p=ff({id:`google.google_maps`,inputSchema:X(()=>Z(I({})))}),em={googleSearch:ff({id:`google.google_search`,inputSchema:X(()=>Z(I({mode:z([`MODE_DYNAMIC`,`MODE_UNSPECIFIED`]).default(`MODE_UNSPECIFIED`),dynamicThreshold:j().default(1)})))}),enterpriseWebSearch:Xp,googleMaps:$p,urlContext:ff({id:`google.url_context`,inputSchema:X(()=>Z(I({})))}),fileSearch:Qp,codeExecution:Yp,vertexRagStore:ff({id:`google.vertex_rag_store`,inputSchema:I({ragCorpus:A(),topK:j().optional()})})},tm=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion=`v3`}get maxImagesPerCall(){return this.settings.maxImagesPerCall??4}get provider(){return this.config.provider}async doGenerate(e){var t;let{prompt:n,n:r=1,size:i,aspectRatio:a=`1:1`,seed:o,providerOptions:s,headers:c,abortSignal:l,files:u,mask:d}=e,f=[];if(u!=null&&u.length>0)throw Error(`Google Generative AI does not support image editing. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.`);if(d!=null)throw Error(`Google Generative AI does not support image editing with masks. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.`);i!=null&&f.push({type:`unsupported`,feature:`size`,details:"This model does not support the `size` option. Use `aspectRatio` instead."}),o!=null&&f.push({type:`unsupported`,feature:`seed`,details:"This model does not support the `seed` option through this provider."});let p=await af({provider:`google`,providerOptions:s,schema:rm}),m=((t=this.config._internal)?.currentDate)?.call(t)??new Date,h={sampleCount:r};a!=null&&(h.aspectRatio=a),p&&Object.assign(h,p);let g={instances:[{prompt:n}],parameters:h},{responseHeaders:_,value:v}=await sf({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:Xl(await mf(this.config.headers),c),body:g,failedResponseHandler:Ep,successfulResponseHandler:_f(nm),abortSignal:l,fetch:this.config.fetch});return{images:v.predictions.map(e=>e.bytesBase64Encoded),warnings:f??[],providerMetadata:{google:{images:v.predictions.map(e=>({}))}},response:{timestamp:m,modelId:this.modelId,headers:_}}}},nm=X(()=>Z(I({predictions:F(I({bytesBase64Encoded:A()})).default([])}))),rm=X(()=>Z(I({personGeneration:z([`dont_allow`,`allow_adult`,`allow_all`]).nullish(),aspectRatio:z([`1:1`,`3:4`,`4:3`,`9:16`,`16:9`]).nullish()})));function im(e={}){let t=yf(e.baseURL)??`https://generativelanguage.googleapis.com/v1beta`,n=e.name??`google.generative-ai`,r=()=>Cu({"x-goog-api-key":Pu({apiKey:e.apiKey,environmentVariableName:`GOOGLE_GENERATIVE_AI_API_KEY`,description:`Google Generative AI`}),...e.headers},`ai-sdk/google/${Tp}`),i=i=>new zp(i,{provider:n,baseURL:t,headers:r,generateId:e.generateId??gu,supportedUrls:()=>({"*":[RegExp(`^${t}/files/.*$`),RegExp(`^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$`),RegExp(`^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$`)]}),fetch:e.fetch}),a=i=>new Op(i,{provider:n,baseURL:t,headers:r,fetch:e.fetch}),o=(i,a={})=>new tm(i,a,{provider:n,baseURL:t,headers:r,fetch:e.fetch}),s=function(e){if(new.target)throw Error(`The Google Generative AI model function cannot be called with the new keyword.`);return i(e)};return s.specificationVersion=`v3`,s.languageModel=i,s.chat=i,s.generativeAI=i,s.embedding=a,s.embeddingModel=a,s.textEmbedding=a,s.textEmbeddingModel=a,s.image=o,s.imageModel=o,s.tools=em,s}var am=im();function om(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.prompt_tokens,n=e.completion_tokens;return{inputTokens:{total:t,noCache:t,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:n,text:n,reasoning:void 0},raw:e}}function sm({data:e,mediaType:t}){return e instanceof URL?e.toString():`data:${t};base64,${ou(e)}`}function cm(e){let t=[];for(let n=0;n<e.length;n++){let{role:r,content:i}=e[n],a=n===e.length-1;switch(r){case`system`:t.push({role:`system`,content:i});break;case`user`:t.push({role:`user`,content:i.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:sm({data:e.data,mediaType:t})}}else if(e.mediaType===`application/pdf`)return{type:`document_url`,document_url:sm({data:e.data,mediaType:`application/pdf`})};else throw new rt({functionality:`Only images and PDF file parts are supported`})}})});break;case`assistant`:{let e=``,n=[];for(let t of i)switch(t.type){case`text`:e+=t.text;break;case`tool-call`:n.push({id:t.toolCallId,type:`function`,function:{name:t.toolName,arguments:JSON.stringify(t.input)}});break;case`reasoning`:e+=t.text;break;default:throw Error(`Unsupported content type in assistant message: ${t.type}`)}t.push({role:`assistant`,content:e,prefix:a?!0:void 0,tool_calls:n.length>0?n:void 0});break}case`tool`:for(let e of i){if(e.type===`tool-approval-response`)continue;let n=e.output,r;switch(n.type){case`text`:case`error-text`:r=n.value;break;case`execution-denied`:r=n.reason??`Tool execution denied.`;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(n.value);break}t.push({role:`tool`,name:e.toolName,tool_call_id:e.toolCallId,content:r})}break;default:{let e=r;throw Error(`Unsupported role: ${e}`)}}}return t}function lm({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function um(e){switch(e){case`stop`:return`stop`;case`length`:case`model_length`:return`length`;case`tool_calls`:return`tool-calls`;default:return`other`}}var dm=I({safePrompt:M().optional(),documentImageLimit:j().optional(),documentPageLimit:j().optional(),structuredOutputs:M().optional(),strictJsonSchema:M().optional(),parallelToolCalls:M().optional()}),fm=hf({errorSchema:I({object:B(`error`),message:A(),type:A(),param:A().nullable(),code:A().nullable()}),errorToMessage:e=>e.message});function pm({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)t.type===`provider`?n.push({type:`unsupported`,feature:`provider-defined tool ${t.id}`}):r.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema,...t.strict==null?{}:{strict:t.strict}}});if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:return{tools:r,toolChoice:i,toolWarnings:n};case`required`:return{tools:r,toolChoice:`any`,toolWarnings:n};case`tool`:return{tools:r.filter(e=>e.function.name===t.toolName),toolChoice:`any`,toolWarnings:n};default:throw new rt({functionality:`tool choice type: ${i}`})}}var mm=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={"application/pdf":[/^https:\/\/.*$/]},this.modelId=e,this.config=t,this.generateId=t.generateId??gu}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,providerOptions:u,tools:d,toolChoice:f}){let p=[],m=await af({provider:`mistral`,providerOptions:u,schema:dm})??{};i!=null&&p.push({type:`unsupported`,feature:`topK`}),a!=null&&p.push({type:`unsupported`,feature:`frequencyPenalty`}),o!=null&&p.push({type:`unsupported`,feature:`presencePenalty`}),s!=null&&p.push({type:`unsupported`,feature:`stopSequences`});let h=m.structuredOutputs??!0,g=m.strictJsonSchema??!1;c?.type===`json`&&!c?.schema&&(e=ju({messages:e,schema:c.schema}));let _={model:this.modelId,safe_prompt:m.safePrompt,max_tokens:t,temperature:n,top_p:r,random_seed:l,response_format:c?.type===`json`?h&&c?.schema!=null?{type:`json_schema`,json_schema:{schema:c.schema,strict:g,name:c.name??`response`,description:c.description}}:{type:`json_object`}:void 0,document_image_limit:m.documentImageLimit,document_page_limit:m.documentPageLimit,messages:cm(e)},{tools:v,toolChoice:ee,toolWarnings:y}=pm({tools:d,toolChoice:f});return{args:{..._,tools:v,tool_choice:ee,...v!=null&&m.parallelToolCalls!==void 0?{parallel_tool_calls:m.parallelToolCalls}:{}},warnings:[...p,...y]}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:r,value:i,rawValue:a}=await sf({url:`${this.config.baseURL}/chat/completions`,headers:Xl(this.config.headers(),e.headers),body:t,failedResponseHandler:fm,successfulResponseHandler:_f(ym),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=i.choices[0],s=[];if(o.message.content!=null&&Array.isArray(o.message.content))for(let e of o.message.content)if(e.type===`thinking`){let t=hm(e.thinking);t.length>0&&s.push({type:`reasoning`,text:t})}else e.type===`text`&&e.text.length>0&&s.push({type:`text`,text:e.text});else{let e=gm(o.message.content);e!=null&&e.length>0&&s.push({type:`text`,text:e})}if(o.message.tool_calls!=null)for(let e of o.message.tool_calls)s.push({type:`tool-call`,toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});return{content:s,finishReason:{unified:um(o.finish_reason),raw:o.finish_reason??void 0},usage:om(i.usage),request:{body:t},response:{...lm(i),headers:r,body:a},warnings:n}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0},{responseHeaders:i,value:a}=await sf({url:`${this.config.baseURL}/chat/completions`,headers:Xl(this.config.headers(),e.headers),body:r,failedResponseHandler:fm,successfulResponseHandler:gf(bm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o={unified:`other`,raw:void 0},s,c=!0,l=!1,u=null,d=this.generateId;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let r=t.value;c&&(c=!1,n.enqueue({type:`response-metadata`,...lm(r)})),r.usage!=null&&(s=r.usage);let i=r.choices[0],a=i.delta,f=gm(a.content);if(a.content!=null&&Array.isArray(a.content)){for(let e of a.content)if(e.type===`thinking`){let t=hm(e.thinking);t.length>0&&(u??(l&&=(n.enqueue({type:`text-end`,id:`0`}),!1),u=d(),n.enqueue({type:`reasoning-start`,id:u})),n.enqueue({type:`reasoning-delta`,id:u,delta:t}))}}if(f!=null&&f.length>0&&(l||=(u!=null&&(n.enqueue({type:`reasoning-end`,id:u}),u=null),n.enqueue({type:`text-start`,id:`0`}),!0),n.enqueue({type:`text-delta`,id:`0`,delta:f})),a?.tool_calls!=null)for(let e of a.tool_calls){let t=e.id,r=e.function.name,i=e.function.arguments;n.enqueue({type:`tool-input-start`,id:t,toolName:r}),n.enqueue({type:`tool-input-delta`,id:t,delta:i}),n.enqueue({type:`tool-input-end`,id:t}),n.enqueue({type:`tool-call`,toolCallId:t,toolName:r,input:i})}i.finish_reason!=null&&(o={unified:um(i.finish_reason),raw:i.finish_reason})},flush(e){u!=null&&e.enqueue({type:`reasoning-end`,id:u}),l&&e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:o,usage:om(s)})}})),request:{body:r},response:{headers:i}}}};function hm(e){return e.filter(e=>e.type===`text`).map(e=>e.text).join(``)}function gm(e){if(typeof e==`string`)return e;if(e==null)return;let t=[];for(let n of e){let{type:e}=n;switch(e){case`text`:t.push(n.text);break;case`thinking`:case`image_url`:case`reference`:break;default:{let t=e;throw Error(`Unsupported type: ${t}`)}}}return t.length?t.join(``):void 0}var _m=L([A(),F(R(`type`,[I({type:B(`text`),text:A()}),I({type:B(`image_url`),image_url:L([A(),I({url:A(),detail:A().nullable()})])}),I({type:B(`reference`),reference_ids:F(L([A(),j()]))}),I({type:B(`thinking`),thinking:F(I({type:B(`text`),text:A()}))})]))]).nullish(),vm=I({prompt_tokens:j(),completion_tokens:j(),total_tokens:j()}),ym=I({id:A().nullish(),created:j().nullish(),model:A().nullish(),choices:F(I({message:I({role:B(`assistant`),content:_m,tool_calls:F(I({id:A(),function:I({name:A(),arguments:A()})})).nullish()}),index:j(),finish_reason:A().nullish()})),object:B(`chat.completion`),usage:vm}),bm=I({id:A().nullish(),created:j().nullish(),model:A().nullish(),choices:F(I({delta:I({role:z([`assistant`]).optional(),content:_m,tool_calls:F(I({id:A(),function:I({name:A(),arguments:A()})})).nullish()}),finish_reason:A().nullish(),index:j()})),usage:vm.nullish()}),xm=class{constructor(e,t){this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=32,this.supportsParallelCalls=!1,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,abortSignal:t,headers:n}){if(e.length>this.maxEmbeddingsPerCall)throw new Ge({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:r,value:i,rawValue:a}=await sf({url:`${this.config.baseURL}/embeddings`,headers:Xl(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:`float`},failedResponseHandler:fm,successfulResponseHandler:_f(Sm),abortSignal:t,fetch:this.config.fetch});return{warnings:[],embeddings:i.data.map(e=>e.embedding),usage:i.usage?{tokens:i.usage.prompt_tokens}:void 0,response:{headers:r,body:a}}}},Sm=I({data:F(I({embedding:F(j())})),usage:I({prompt_tokens:j()}).nullish()}),Cm=`3.0.9`;function wm(e={}){let t=yf(e.baseURL)??`https://api.mistral.ai/v1`,n=()=>Cu({Authorization:`Bearer ${Pu({apiKey:e.apiKey,environmentVariableName:`MISTRAL_API_KEY`,description:`Mistral`})}`,...e.headers},`ai-sdk/mistral/${Cm}`),r=r=>new mm(r,{provider:`mistral.chat`,baseURL:t,headers:n,fetch:e.fetch,generateId:e.generateId}),i=r=>new xm(r,{provider:`mistral.embedding`,baseURL:t,headers:n,fetch:e.fetch}),a=function(e){if(new.target)throw Error(`The Mistral model function cannot be called with the new keyword.`);return r(e)};return a.specificationVersion=`v3`,a.languageModel=r,a.chat=r,a.embedding=i,a.embeddingModel=i,a.textEmbedding=i,a.textEmbeddingModel=i,a.imageModel=e=>{throw new ze({modelId:e,modelType:`imageModel`})},a}var Tm=wm(),Em=I({error:I({message:A(),type:A().nullish(),param:Os().nullish(),code:L([A(),j()]).nullish()})}),Dm=hf({errorSchema:Em,errorToMessage:e=>e.error.message});function Om(e){let t=e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`),n=e.startsWith(`gpt-4`)||e.startsWith(`gpt-5-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-nano`)&&!e.startsWith(`gpt-5-chat`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`),r=e.startsWith(`o1`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`codex-mini`)||e.startsWith(`computer-use-preview`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`),i=e.startsWith(`gpt-5.1`)||e.startsWith(`gpt-5.2`);return{supportsFlexProcessing:t,supportsPriorityProcessing:n,isReasoningModel:r,systemMessageMode:r?`developer`:`system`,supportsNonReasoningParameters:i}}function km(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.prompt_tokens??0,n=e.completion_tokens??0,r=e.prompt_tokens_details?.cached_tokens??0,i=e.completion_tokens_details?.reasoning_tokens??0;return{inputTokens:{total:t,noCache:t-r,cacheRead:r,cacheWrite:void 0},outputTokens:{total:n,text:n-i,reasoning:i},raw:e}}function Am({prompt:e,systemMessageMode:t=`system`}){let n=[],r=[];for(let{role:i,content:a}of e)switch(i){case`system`:switch(t){case`system`:n.push({role:`system`,content:a});break;case`developer`:n.push({role:`developer`,content:a});break;case`remove`:r.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=t;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:if(a.length===1&&a[0].type===`text`){n.push({role:`user`,content:a[0].text});break}n.push({role:`user`,content:a.map((e,t)=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${ou(e.data)}`,detail:e.providerOptions?.openai?.imageDetail}}}else if(e.mediaType.startsWith(`audio/`)){if(e.data instanceof URL)throw new rt({functionality:`audio file parts with URLs`});switch(e.mediaType){case`audio/wav`:return{type:`input_audio`,input_audio:{data:ou(e.data),format:`wav`}};case`audio/mp3`:case`audio/mpeg`:return{type:`input_audio`,input_audio:{data:ou(e.data),format:`mp3`}};default:throw new rt({functionality:`audio content parts with media type ${e.mediaType}`})}}else if(e.mediaType===`application/pdf`){if(e.data instanceof URL)throw new rt({functionality:`PDF file parts with URLs`});return{type:`file`,file:typeof e.data==`string`&&e.data.startsWith(`file-`)?{file_id:e.data}:{filename:e.filename??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${ou(e.data)}`}}}else throw new rt({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e=``,t=[];for(let n of a)switch(n.type){case`text`:e+=n.text;break;case`tool-call`:t.push({id:n.toolCallId,type:`function`,function:{name:n.toolName,arguments:JSON.stringify(n.input)}});break}n.push({role:`assistant`,content:e,tool_calls:t.length>0?t:void 0});break}case`tool`:for(let e of a){if(e.type===`tool-approval-response`)continue;let t=e.output,r;switch(t.type){case`text`:case`error-text`:r=t.value;break;case`execution-denied`:r=t.reason??`Tool execution denied.`;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(t.value);break}n.push({role:`tool`,tool_call_id:e.toolCallId,content:r})}break;default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return{messages:n,warnings:r}}function jm({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n?new Date(n*1e3):void 0}}function Mm(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`other`}}var Nm=X(()=>Z(I({id:A().nullish(),created:j().nullish(),model:A().nullish(),choices:F(I({message:I({role:B(`assistant`).nullish(),content:A().nullish(),tool_calls:F(I({id:A().nullish(),type:B(`function`),function:I({name:A(),arguments:A()})})).nullish(),annotations:F(I({type:B(`url_citation`),url_citation:I({start_index:j(),end_index:j(),url:A(),title:A()})})).nullish()}),index:j(),logprobs:I({content:F(I({token:A(),logprob:j(),top_logprobs:F(I({token:A(),logprob:j()}))})).nullish()}).nullish(),finish_reason:A().nullish()})),usage:I({prompt_tokens:j().nullish(),completion_tokens:j().nullish(),total_tokens:j().nullish(),prompt_tokens_details:I({cached_tokens:j().nullish()}).nullish(),completion_tokens_details:I({reasoning_tokens:j().nullish(),accepted_prediction_tokens:j().nullish(),rejected_prediction_tokens:j().nullish()}).nullish()}).nullish()}))),Pm=X(()=>Z(L([I({id:A().nullish(),created:j().nullish(),model:A().nullish(),choices:F(I({delta:I({role:z([`assistant`]).nullish(),content:A().nullish(),tool_calls:F(I({index:j(),id:A().nullish(),type:B(`function`).nullish(),function:I({name:A().nullish(),arguments:A().nullish()})})).nullish(),annotations:F(I({type:B(`url_citation`),url_citation:I({start_index:j(),end_index:j(),url:A(),title:A()})})).nullish()}).nullish(),logprobs:I({content:F(I({token:A(),logprob:j(),top_logprobs:F(I({token:A(),logprob:j()}))})).nullish()}).nullish(),finish_reason:A().nullish(),index:j()})),usage:I({prompt_tokens:j().nullish(),completion_tokens:j().nullish(),total_tokens:j().nullish(),prompt_tokens_details:I({cached_tokens:j().nullish()}).nullish(),completion_tokens_details:I({reasoning_tokens:j().nullish(),accepted_prediction_tokens:j().nullish(),rejected_prediction_tokens:j().nullish()}).nullish()}).nullish()}),Em]))),Fm=X(()=>Z(I({logitBias:Hs(vc(),j()).optional(),logprobs:L([M(),j()]).optional(),parallelToolCalls:M().optional(),user:A().optional(),reasoningEffort:z([`none`,`minimal`,`low`,`medium`,`high`,`xhigh`]).optional(),maxCompletionTokens:j().optional(),store:M().optional(),metadata:Hs(A().max(64),A().max(512)).optional(),prediction:Hs(A(),Os()).optional(),serviceTier:z([`auto`,`flex`,`priority`,`default`]).optional(),strictJsonSchema:M().optional(),textVerbosity:z([`low`,`medium`,`high`]).optional(),promptCacheKey:A().optional(),promptCacheRetention:z([`in_memory`,`24h`]).optional(),safetyIdentifier:A().optional(),systemMessageMode:z([`system`,`developer`,`remove`]).optional(),forceReasoning:M().optional()})));function Im({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)switch(t.type){case`function`:r.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema,...t.strict==null?{}:{strict:t.strict}}});break;default:n.push({type:`unsupported`,feature:`tool type: ${t.type}`});break}if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:case`required`:return{tools:r,toolChoice:i,toolWarnings:n};case`tool`:return{tools:r,toolChoice:{type:`function`,function:{name:t.toolName}},toolWarnings:n};default:throw new rt({functionality:`tool choice type: ${i}`})}}var Lm=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){let p=[],m=await af({provider:`openai`,providerOptions:f,schema:Fm})??{},h=Om(this.modelId),g=m.forceReasoning??h.isReasoningModel;i!=null&&p.push({type:`unsupported`,feature:`topK`});let{messages:_,warnings:v}=Am({prompt:e,systemMessageMode:m.systemMessageMode??(g?`developer`:h.systemMessageMode)});p.push(...v);let ee=m.strictJsonSchema??!0,y={model:this.modelId,logit_bias:m.logitBias,logprobs:m.logprobs===!0||typeof m.logprobs==`number`?!0:void 0,top_logprobs:typeof m.logprobs==`number`?m.logprobs:typeof m.logprobs==`boolean`&&m.logprobs?0:void 0,user:m.user,parallel_tool_calls:m.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,response_format:c?.type===`json`?c.schema==null?{type:`json_object`}:{type:`json_schema`,json_schema:{schema:c.schema,strict:ee,name:c.name??`response`,description:c.description}}:void 0,stop:s,seed:l,verbosity:m.textVerbosity,max_completion_tokens:m.maxCompletionTokens,store:m.store,metadata:m.metadata,prediction:m.prediction,reasoning_effort:m.reasoningEffort,service_tier:m.serviceTier,prompt_cache_key:m.promptCacheKey,prompt_cache_retention:m.promptCacheRetention,safety_identifier:m.safetyIdentifier,messages:_};g?((m.reasoningEffort!==`none`||!h.supportsNonReasoningParameters)&&(y.temperature!=null&&(y.temperature=void 0,p.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported for reasoning models`})),y.top_p!=null&&(y.top_p=void 0,p.push({type:`unsupported`,feature:`topP`,details:`topP is not supported for reasoning models`})),y.logprobs!=null&&(y.logprobs=void 0,p.push({type:`other`,message:`logprobs is not supported for reasoning models`}))),y.frequency_penalty!=null&&(y.frequency_penalty=void 0,p.push({type:`unsupported`,feature:`frequencyPenalty`,details:`frequencyPenalty is not supported for reasoning models`})),y.presence_penalty!=null&&(y.presence_penalty=void 0,p.push({type:`unsupported`,feature:`presencePenalty`,details:`presencePenalty is not supported for reasoning models`})),y.logit_bias!=null&&(y.logit_bias=void 0,p.push({type:`other`,message:`logitBias is not supported for reasoning models`})),y.top_logprobs!=null&&(y.top_logprobs=void 0,p.push({type:`other`,message:`topLogprobs is not supported for reasoning models`})),y.max_tokens!=null&&(y.max_completion_tokens??=y.max_tokens,y.max_tokens=void 0)):(this.modelId.startsWith(`gpt-4o-search-preview`)||this.modelId.startsWith(`gpt-4o-mini-search-preview`))&&y.temperature!=null&&(y.temperature=void 0,p.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported for the search preview models and has been removed.`})),m.serviceTier===`flex`&&!h.supportsFlexProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),y.service_tier=void 0),m.serviceTier===`priority`&&!h.supportsPriorityProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),y.service_tier=void 0);let{tools:b,toolChoice:te,toolWarnings:x}=Im({tools:u,toolChoice:d});return{args:{...y,tools:b,tool_choice:te},warnings:[...p,...x]}}async doGenerate(e){var t;let{args:n,warnings:r}=await this.getArgs(e),{responseHeaders:i,value:a,rawValue:o}=await sf({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:Xl(this.config.headers(),e.headers),body:n,failedResponseHandler:Dm,successfulResponseHandler:_f(Nm),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=a.choices[0],c=[],l=s.message.content;l!=null&&l.length>0&&c.push({type:`text`,text:l});for(let e of s.message.tool_calls??[])c.push({type:`tool-call`,toolCallId:e.id??gu(),toolName:e.function.name,input:e.function.arguments});for(let e of s.message.annotations??[])c.push({type:`source`,sourceType:`url`,id:gu(),url:e.url_citation.url,title:e.url_citation.title});let u=a.usage?.completion_tokens_details;(t=a.usage)==null||t.prompt_tokens_details;let d={openai:{}};return u?.accepted_prediction_tokens!=null&&(d.openai.acceptedPredictionTokens=u?.accepted_prediction_tokens),u?.rejected_prediction_tokens!=null&&(d.openai.rejectedPredictionTokens=u?.rejected_prediction_tokens),s.logprobs?.content!=null&&(d.openai.logprobs=s.logprobs.content),{content:c,finishReason:{unified:Mm(s.finish_reason),raw:s.finish_reason??void 0},usage:km(a.usage),request:{body:n},response:{...jm(a),headers:i,body:o},warnings:r,providerMetadata:d}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await sf({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:Xl(this.config.headers(),e.headers),body:r,failedResponseHandler:Dm,successfulResponseHandler:gf(Pm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=[],s={unified:`other`,raw:void 0},c,l=!1,u=!1,d={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){s={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:t.error});return}let r=t.value;if(`error`in r){s={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:r.error});return}if(!l){let e=jm(r);Object.values(e).some(Boolean)&&(l=!0,n.enqueue({type:`response-metadata`,...jm(r)}))}r.usage!=null&&(c=r.usage,r.usage.completion_tokens_details?.accepted_prediction_tokens!=null&&(d.openai.acceptedPredictionTokens=r.usage.completion_tokens_details?.accepted_prediction_tokens),r.usage.completion_tokens_details?.rejected_prediction_tokens!=null&&(d.openai.rejectedPredictionTokens=r.usage.completion_tokens_details?.rejected_prediction_tokens));let i=r.choices[0];if(i?.finish_reason!=null&&(s={unified:Mm(i.finish_reason),raw:i.finish_reason}),i?.logprobs?.content!=null&&(d.openai.logprobs=i.logprobs.content),i?.delta==null)return;let a=i.delta;if(a.content!=null&&(u||=(n.enqueue({type:`text-start`,id:`0`}),!0),n.enqueue({type:`text-delta`,id:`0`,delta:a.content})),a.tool_calls!=null)for(let e of a.tool_calls){let t=e.index;if(o[t]==null){if(e.type!==`function`)throw new le({data:e,message:`Expected 'function' type.`});if(e.id==null)throw new le({data:e,message:`Expected 'id' to be a string.`});if(e.function?.name==null)throw new le({data:e,message:`Expected 'function.name' to be a string.`});n.enqueue({type:`tool-input-start`,id:e.id,toolName:e.function.name}),o[t]={id:e.id,type:`function`,function:{name:e.function.name,arguments:e.function.arguments??``},hasFinished:!1};let r=o[t];r.function?.name!=null&&r.function?.arguments!=null&&(r.function.arguments.length>0&&n.enqueue({type:`tool-input-delta`,id:r.id,delta:r.function.arguments}),nf(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:r.id??gu(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}let r=o[t];r.hasFinished||(e.function?.arguments!=null&&(r.function.arguments+=e.function?.arguments??``),n.enqueue({type:`tool-input-delta`,id:r.id,delta:e.function.arguments??``}),r.function?.name!=null&&r.function?.arguments!=null&&nf(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:r.id??gu(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0))}if(a.annotations!=null)for(let e of a.annotations)n.enqueue({type:`source`,sourceType:`url`,id:gu(),url:e.url_citation.url,title:e.url_citation.title})},flush(e){u&&e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:s,usage:km(c),...d==null?{}:{providerMetadata:d}})}})),request:{body:r},response:{headers:i}}}};function Rm(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.prompt_tokens??0,n=e.completion_tokens??0;return{inputTokens:{total:e.prompt_tokens??void 0,noCache:t,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:e.completion_tokens??void 0,text:n,reasoning:void 0},raw:e}}function zm({prompt:e,user:t=`user`,assistant:n=`assistant`}){let r=``;e[0].role===`system`&&(r+=`${e[0].content}

`,e=e.slice(1));for(let{role:i,content:a}of e)switch(i){case`system`:throw new ae({message:"Unexpected system message in prompt: ${content}",prompt:e});case`user`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text}}).filter(Boolean).join(``);r+=`${t}:
${e}

`;break}case`assistant`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text;case`tool-call`:throw new rt({functionality:`tool-call messages`})}}).join(``);r+=`${n}:
${e}

`;break}case`tool`:throw new rt({functionality:`tool messages`});default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${t}:`]}}function Bm({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function Vm(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`other`}}var Hm=X(()=>Z(I({id:A().nullish(),created:j().nullish(),model:A().nullish(),choices:F(I({text:A(),finish_reason:A(),logprobs:I({tokens:F(A()),token_logprobs:F(j()),top_logprobs:F(Hs(A(),j())).nullish()}).nullish()})),usage:I({prompt_tokens:j(),completion_tokens:j(),total_tokens:j()}).nullish()}))),Um=X(()=>Z(L([I({id:A().nullish(),created:j().nullish(),model:A().nullish(),choices:F(I({text:A(),finish_reason:A().nullish(),index:j(),logprobs:I({tokens:F(A()),token_logprobs:F(j()),top_logprobs:F(Hs(A(),j())).nullish()}).nullish()})),usage:I({prompt_tokens:j(),completion_tokens:j(),total_tokens:j()}).nullish()}),Em]))),Wm=X(()=>Z(I({echo:M().optional(),logitBias:Hs(A(),j()).optional(),suffix:A().optional(),user:A().optional(),logprobs:L([M(),j()]).optional()}))),Gm=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(`.`)[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,tools:l,toolChoice:u,seed:d,providerOptions:f}){let p=[],m={...await af({provider:`openai`,providerOptions:f,schema:Wm}),...await af({provider:this.providerOptionsName,providerOptions:f,schema:Wm})};i!=null&&p.push({type:`unsupported`,feature:`topK`}),l?.length&&p.push({type:`unsupported`,feature:`tools`}),u!=null&&p.push({type:`unsupported`,feature:`toolChoice`}),c!=null&&c.type!==`text`&&p.push({type:`unsupported`,feature:`responseFormat`,details:`JSON response format is not supported.`});let{prompt:h,stopSequences:g}=zm({prompt:e}),_=[...g??[],...s??[]];return{args:{model:this.modelId,echo:m.echo,logit_bias:m.logitBias,logprobs:m?.logprobs===!0?0:m?.logprobs===!1?void 0:m?.logprobs,suffix:m.suffix,user:m.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,seed:d,prompt:h,stop:_.length>0?_:void 0},warnings:p}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:r,value:i,rawValue:a}=await sf({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:Xl(this.config.headers(),e.headers),body:t,failedResponseHandler:Dm,successfulResponseHandler:_f(Hm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=i.choices[0],s={openai:{}};return o.logprobs!=null&&(s.openai.logprobs=o.logprobs),{content:[{type:`text`,text:o.text}],usage:Rm(i.usage),finishReason:{unified:Vm(o.finish_reason),raw:o.finish_reason??void 0},request:{body:t},response:{...Bm(i),headers:r,body:a},providerMetadata:s,warnings:n}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await sf({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:Xl(this.config.headers(),e.headers),body:r,failedResponseHandler:Dm,successfulResponseHandler:gf(Um),abortSignal:e.abortSignal,fetch:this.config.fetch}),o={unified:`other`,raw:void 0},s={openai:{}},c,l=!0;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){o={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:t.error});return}let r=t.value;if(`error`in r){o={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:r.error});return}l&&(l=!1,n.enqueue({type:`response-metadata`,...Bm(r)}),n.enqueue({type:`text-start`,id:`0`})),r.usage!=null&&(c=r.usage);let i=r.choices[0];i?.finish_reason!=null&&(o={unified:Vm(i.finish_reason),raw:i.finish_reason}),i?.logprobs!=null&&(s.openai.logprobs=i.logprobs),i?.text!=null&&i.text.length>0&&n.enqueue({type:`text-delta`,id:`0`,delta:i.text})},flush(e){l||e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:o,providerMetadata:s,usage:Rm(c)})}})),request:{body:r},response:{headers:i}}}},Km=X(()=>Z(I({dimensions:j().optional(),user:A().optional()}))),qm=X(()=>Z(I({data:F(I({embedding:F(j())})),usage:I({prompt_tokens:j()}).nullish()}))),Jm=class{constructor(e,t){this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){if(e.length>this.maxEmbeddingsPerCall)throw new Ge({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let i=await af({provider:`openai`,providerOptions:r,schema:Km})??{},{responseHeaders:a,value:o,rawValue:s}=await sf({url:this.config.url({path:`/embeddings`,modelId:this.modelId}),headers:Xl(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:`float`,dimensions:i.dimensions,user:i.user},failedResponseHandler:Dm,successfulResponseHandler:_f(qm),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:o.data.map(e=>e.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,response:{headers:a,body:s}}}},Ym=X(()=>Z(I({created:j().nullish(),data:F(I({b64_json:A(),revised_prompt:A().nullish()})),background:A().nullish(),output_format:A().nullish(),size:A().nullish(),quality:A().nullish(),usage:I({input_tokens:j().nullish(),output_tokens:j().nullish(),total_tokens:j().nullish(),input_tokens_details:I({image_tokens:j().nullish(),text_tokens:j().nullish()}).nullish()}).nullish()}))),Xm={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},Zm=[`gpt-image-1-mini`,`gpt-image-1.5`,`gpt-image-1`];function Qm(e){return Zm.some(t=>e.startsWith(t))}var $m=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`}get maxImagesPerCall(){return Xm[this.modelId]??1}get provider(){return this.config.provider}async doGenerate({prompt:e,files:t,mask:n,n:r,size:i,aspectRatio:a,seed:o,providerOptions:s,headers:c,abortSignal:l}){var u;let d=[];a!=null&&d.push({type:`unsupported`,feature:`aspectRatio`,details:"This model does not support aspect ratio. Use `size` instead."}),o!=null&&d.push({type:`unsupported`,feature:`seed`});let f=((u=this.config._internal)?.currentDate)?.call(u)??new Date;if(t!=null){let{value:a,responseHeaders:o}=await cf({url:this.config.url({path:`/images/edits`,modelId:this.modelId}),headers:Xl(this.config.headers(),c),formData:su({model:this.modelId,prompt:e,image:await Promise.all(t.map(e=>e.type===`file`?new Blob([e.data instanceof Uint8Array?new Blob([e.data],{type:e.mediaType}):new Blob([iu(e.data)],{type:e.mediaType})],{type:e.mediaType}):mu(e.url))),mask:n==null?void 0:await eh(n),n:r,size:i,...s.openai??{}}),failedResponseHandler:Dm,successfulResponseHandler:_f(Ym),abortSignal:l,fetch:this.config.fetch});return{images:a.data.map(e=>e.b64_json),warnings:d,usage:a.usage==null?void 0:{inputTokens:a.usage.input_tokens??void 0,outputTokens:a.usage.output_tokens??void 0,totalTokens:a.usage.total_tokens??void 0},response:{timestamp:f,modelId:this.modelId,headers:o},providerMetadata:{openai:{images:a.data.map(e=>({...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},created:a.created??void 0,size:a.size??void 0,quality:a.quality??void 0,background:a.background??void 0,outputFormat:a.output_format??void 0}))}}}}let{value:p,responseHeaders:m}=await sf({url:this.config.url({path:`/images/generations`,modelId:this.modelId}),headers:Xl(this.config.headers(),c),body:{model:this.modelId,prompt:e,n:r,size:i,...s.openai??{},...Qm(this.modelId)?{}:{response_format:`b64_json`}},failedResponseHandler:Dm,successfulResponseHandler:_f(Ym),abortSignal:l,fetch:this.config.fetch});return{images:p.data.map(e=>e.b64_json),warnings:d,usage:p.usage==null?void 0:{inputTokens:p.usage.input_tokens??void 0,outputTokens:p.usage.output_tokens??void 0,totalTokens:p.usage.total_tokens??void 0},response:{timestamp:f,modelId:this.modelId,headers:m},providerMetadata:{openai:{images:p.data.map(e=>({...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},created:p.created??void 0,size:p.size??void 0,quality:p.quality??void 0,background:p.background??void 0,outputFormat:p.output_format??void 0}))}}}}};async function eh(e){if(!e)return;if(e.type===`url`)return mu(e.url);let t=e.data instanceof Uint8Array?e.data:iu(e.data);return new Blob([t],{type:e.mediaType})}var th=X(()=>Z(I({callId:A(),operation:R(`type`,[I({type:B(`create_file`),path:A(),diff:A()}),I({type:B(`delete_file`),path:A()}),I({type:B(`update_file`),path:A(),diff:A()})])}))),nh=X(()=>Z(I({status:z([`completed`,`failed`]),output:A().optional()}))),rh=pf({id:`openai.apply_patch`,inputSchema:th,outputSchema:nh}),ih=X(()=>Z(I({code:A().nullish(),containerId:A()}))),ah=X(()=>Z(I({outputs:F(R(`type`,[I({type:B(`logs`),logs:A()}),I({type:B(`image`),url:A()})])).nullish()}))),oh=X(()=>Z(I({container:L([A(),I({fileIds:F(A()).optional()})]).optional()}))),sh=pf({id:`openai.code_interpreter`,inputSchema:ih,outputSchema:ah}),ch=(e={})=>sh(e),lh=I({key:A(),type:z([`eq`,`ne`,`gt`,`gte`,`lt`,`lte`,`in`,`nin`]),value:L([A(),j(),M(),F(A())])}),uh=I({type:z([`and`,`or`]),filters:F(L([lh,fc(()=>uh)]))}),dh=X(()=>Z(I({vectorStoreIds:F(A()),maxNumResults:j().optional(),ranking:I({ranker:A().optional(),scoreThreshold:j().optional()}).optional(),filters:L([lh,uh]).optional()}))),fh=X(()=>Z(I({queries:F(A()),results:F(I({attributes:Hs(A(),N()),fileId:A(),filename:A(),score:j(),text:A()})).nullable()}))),ph=pf({id:`openai.file_search`,inputSchema:I({}),outputSchema:fh}),mh=X(()=>Z(I({background:z([`auto`,`opaque`,`transparent`]).optional(),inputFidelity:z([`low`,`high`]).optional(),inputImageMask:I({fileId:A().optional(),imageUrl:A().optional()}).optional(),model:A().optional(),moderation:z([`auto`]).optional(),outputCompression:j().int().min(0).max(100).optional(),outputFormat:z([`png`,`jpeg`,`webp`]).optional(),partialImages:j().int().min(0).max(3).optional(),quality:z([`auto`,`low`,`medium`,`high`]).optional(),size:z([`1024x1024`,`1024x1536`,`1536x1024`,`auto`]).optional()}).strict())),hh=pf({id:`openai.image_generation`,inputSchema:X(()=>Z(I({}))),outputSchema:X(()=>Z(I({result:A()})))}),gh=(e={})=>hh(e),_h=X(()=>Z(I({action:I({type:B(`exec`),command:F(A()),timeoutMs:j().optional(),user:A().optional(),workingDirectory:A().optional(),env:Hs(A(),A()).optional()})}))),vh=X(()=>Z(I({output:A()}))),yh=pf({id:`openai.local_shell`,inputSchema:_h,outputSchema:vh}),bh=X(()=>Z(I({action:I({commands:F(A()),timeoutMs:j().optional(),maxOutputLength:j().optional()})}))),xh=X(()=>Z(I({output:F(I({stdout:A(),stderr:A(),outcome:R(`type`,[I({type:B(`timeout`)}),I({type:B(`exit`),exitCode:j()})])}))}))),Sh=pf({id:`openai.shell`,inputSchema:bh,outputSchema:xh}),Ch=X(()=>Z(I({externalWebAccess:M().optional(),filters:I({allowedDomains:F(A()).optional()}).optional(),searchContextSize:z([`low`,`medium`,`high`]).optional(),userLocation:I({type:B(`approximate`),country:A().optional(),city:A().optional(),region:A().optional(),timezone:A().optional()}).optional()}))),wh=pf({id:`openai.web_search`,inputSchema:X(()=>Z(I({}))),outputSchema:X(()=>Z(I({action:R(`type`,[I({type:B(`search`),query:A().optional()}),I({type:B(`openPage`),url:A().nullish()}),I({type:B(`findInPage`),url:A().nullish(),pattern:A().nullish()})]),sources:F(R(`type`,[I({type:B(`url`),url:A()}),I({type:B(`api`),name:A()})])).optional()})))}),Th=(e={})=>wh(e),Eh=X(()=>Z(I({searchContextSize:z([`low`,`medium`,`high`]).optional(),userLocation:I({type:B(`approximate`),country:A().optional(),city:A().optional(),region:A().optional(),timezone:A().optional()}).optional()}))),Dh=pf({id:`openai.web_search_preview`,inputSchema:X(()=>Z(I({}))),outputSchema:X(()=>Z(I({action:R(`type`,[I({type:B(`search`),query:A().optional()}),I({type:B(`openPage`),url:A().nullish()}),I({type:B(`findInPage`),url:A().nullish(),pattern:A().nullish()})])})))}),Oh=fc(()=>L([A(),j(),M(),Es(),F(Oh),Hs(A(),Oh)])),kh=X(()=>Z(I({serverLabel:A(),allowedTools:L([F(A()),I({readOnly:M().optional(),toolNames:F(A()).optional()})]).optional(),authorization:A().optional(),connectorId:A().optional(),headers:Hs(A(),A()).optional(),requireApproval:L([z([`always`,`never`]),I({never:I({toolNames:F(A()).optional()}).optional()})]).optional(),serverDescription:A().optional(),serverUrl:A().optional()}).refine(e=>e.serverUrl!=null||e.connectorId!=null,`One of serverUrl or connectorId must be provided.`))),Ah=pf({id:`openai.mcp`,inputSchema:X(()=>Z(I({}))),outputSchema:X(()=>Z(I({type:B(`call`),serverLabel:A(),name:A(),arguments:A(),output:A().nullish(),error:L([A(),Oh]).optional()})))}),jh={applyPatch:rh,codeInterpreter:ch,fileSearch:ph,imageGeneration:gh,localShell:yh,shell:Sh,webSearchPreview:Dh,webSearch:Th,mcp:e=>Ah(e)};function Mh(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.input_tokens,n=e.output_tokens,r=e.input_tokens_details?.cached_tokens??0,i=e.output_tokens_details?.reasoning_tokens??0;return{inputTokens:{total:t,noCache:t-r,cacheRead:r,cacheWrite:void 0},outputTokens:{total:n,text:n-i,reasoning:i},raw:e}}function Nh(e,t){return t?t.some(t=>e.startsWith(t)):!1}async function Ph({prompt:e,toolNameMapping:t,systemMessageMode:n,providerOptionsName:r,fileIdPrefixes:i,store:a,hasConversation:o=!1,hasLocalShellTool:s=!1,hasShellTool:c=!1,hasApplyPatchTool:l=!1}){let u=[],d=[],f=new Set;for(let{role:p,content:m}of e)switch(p){case`system`:switch(n){case`system`:u.push({role:`system`,content:m});break;case`developer`:u.push({role:`developer`,content:m});break;case`remove`:d.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=n;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:u.push({role:`user`,content:m.map((e,t)=>{switch(e.type){case`text`:return{type:`input_text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`input_image`,...e.data instanceof URL?{image_url:e.data.toString()}:typeof e.data==`string`&&Nh(e.data,i)?{file_id:e.data}:{image_url:`data:${t};base64,${ou(e.data)}`},detail:e.providerOptions?.[r]?.imageDetail}}else if(e.mediaType===`application/pdf`)return e.data instanceof URL?{type:`input_file`,file_url:e.data.toString()}:{type:`input_file`,...typeof e.data==`string`&&Nh(e.data,i)?{file_id:e.data}:{filename:e.filename??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${ou(e.data)}`}};else throw new rt({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e={};for(let n of m)switch(n.type){case`text`:{let e=n.providerOptions?.[r]?.itemId;if(o&&e!=null)break;if(a&&e!=null){u.push({type:`item_reference`,id:e});break}u.push({role:`assistant`,content:[{type:`output_text`,text:n.text}],id:e});break}case`tool-call`:{let e=n.providerOptions?.[r]?.itemId??n.providerMetadata?.[r]?.itemId;if(o&&e!=null)break;if(n.providerExecuted){a&&e!=null&&u.push({type:`item_reference`,id:e});break}if(a&&e!=null){u.push({type:`item_reference`,id:e});break}let i=t.toProviderToolName(n.toolName);if(s&&i===`local_shell`){let t=await Qd({value:n.input,schema:_h});u.push({type:`local_shell_call`,call_id:n.toolCallId,id:e,action:{type:`exec`,command:t.action.command,timeout_ms:t.action.timeoutMs,user:t.action.user,working_directory:t.action.workingDirectory,env:t.action.env}});break}if(c&&i===`shell`){let t=await Qd({value:n.input,schema:bh});u.push({type:`shell_call`,call_id:n.toolCallId,id:e,status:`completed`,action:{commands:t.action.commands,timeout_ms:t.action.timeoutMs,max_output_length:t.action.maxOutputLength}});break}u.push({type:`function_call`,call_id:n.toolCallId,name:i,arguments:JSON.stringify(n.input),id:e});break}case`tool-result`:if(n.output.type===`execution-denied`||n.output.type===`json`&&typeof n.output.value==`object`&&n.output.value!=null&&`type`in n.output.value&&n.output.value.type===`execution-denied`||o)break;if(a){let e=n.providerMetadata?.[r]?.itemId??n.toolCallId;u.push({type:`item_reference`,id:e})}else d.push({type:`other`,message:`Results for OpenAI tool ${n.toolName} are not sent to the API when store is false`});break;case`reasoning`:{let t=await af({provider:r,providerOptions:n.providerOptions,schema:Fh}),i=t?.itemId;if(o&&i!=null)break;if(i!=null){let r=e[i];if(a)r===void 0&&(u.push({type:`item_reference`,id:i}),e[i]={type:`reasoning`,id:i,summary:[]});else{let a=[];n.text.length>0?a.push({type:`summary_text`,text:n.text}):r!==void 0&&d.push({type:`other`,message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(n)}.`}),r===void 0?(e[i]={type:`reasoning`,id:i,encrypted_content:t?.reasoningEncryptedContent,summary:a},u.push(e[i])):(r.summary.push(...a),t?.reasoningEncryptedContent!=null&&(r.encrypted_content=t.reasoningEncryptedContent))}}else d.push({type:`other`,message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(n)}.`});break}}break}case`tool`:for(let e of m){if(e.type===`tool-approval-response`){let t=e;if(f.has(t.approvalId))continue;f.add(t.approvalId),a&&u.push({type:`item_reference`,id:t.approvalId}),u.push({type:`mcp_approval_response`,approval_request_id:t.approvalId,approve:t.approved});continue}let n=e.output;if(n.type===`execution-denied`&&n.providerOptions?.openai?.approvalId)continue;let r=t.toProviderToolName(e.toolName);if(s&&r===`local_shell`&&n.type===`json`){let t=await Qd({value:n.value,schema:vh});u.push({type:`local_shell_call_output`,call_id:e.toolCallId,output:t.output});continue}if(c&&r===`shell`&&n.type===`json`){let t=await Qd({value:n.value,schema:xh});u.push({type:`shell_call_output`,call_id:e.toolCallId,output:t.output.map(e=>({stdout:e.stdout,stderr:e.stderr,outcome:e.outcome.type===`timeout`?{type:`timeout`}:{type:`exit`,exit_code:e.outcome.exitCode}}))});continue}if(l&&e.toolName===`apply_patch`&&n.type===`json`){let t=await Qd({value:n.value,schema:nh});u.push({type:`apply_patch_call_output`,call_id:e.toolCallId,status:t.status,output:t.output});continue}let i;switch(n.type){case`text`:case`error-text`:i=n.value;break;case`execution-denied`:i=n.reason??`Tool execution denied.`;break;case`json`:case`error-json`:i=JSON.stringify(n.value);break;case`content`:i=n.value.map(e=>{switch(e.type){case`text`:return{type:`input_text`,text:e.text};case`image-data`:return{type:`input_image`,image_url:`data:${e.mediaType};base64,${e.data}`};case`image-url`:return{type:`input_image`,image_url:e.url};case`file-data`:return{type:`input_file`,filename:e.filename??`data`,file_data:`data:${e.mediaType};base64,${e.data}`};default:d.push({type:`other`,message:`unsupported tool content part type: ${e.type}`});return}}).filter(Mu);break}u.push({type:`function_call_output`,call_id:e.toolCallId,output:i})}break;default:{let e=p;throw Error(`Unsupported role: ${e}`)}}return{input:u,warnings:d}}var Fh=I({itemId:A().nullish(),reasoningEncryptedContent:A().nullish()});function Ih({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?`tool-calls`:`stop`;case`max_output_tokens`:return`length`;case`content_filter`:return`content-filter`;default:return t?`tool-calls`:`other`}}var Lh=X(()=>Z(L([I({type:B(`response.output_text.delta`),item_id:A(),delta:A(),logprobs:F(I({token:A(),logprob:j(),top_logprobs:F(I({token:A(),logprob:j()}))})).nullish()}),I({type:z([`response.completed`,`response.incomplete`]),response:I({incomplete_details:I({reason:A()}).nullish(),usage:I({input_tokens:j(),input_tokens_details:I({cached_tokens:j().nullish()}).nullish(),output_tokens:j(),output_tokens_details:I({reasoning_tokens:j().nullish()}).nullish()}),service_tier:A().nullish()})}),I({type:B(`response.created`),response:I({id:A(),created_at:j(),model:A(),service_tier:A().nullish()})}),I({type:B(`response.output_item.added`),output_index:j(),item:R(`type`,[I({type:B(`message`),id:A()}),I({type:B(`reasoning`),id:A(),encrypted_content:A().nullish()}),I({type:B(`function_call`),id:A(),call_id:A(),name:A(),arguments:A()}),I({type:B(`web_search_call`),id:A(),status:A()}),I({type:B(`computer_call`),id:A(),status:A()}),I({type:B(`file_search_call`),id:A()}),I({type:B(`image_generation_call`),id:A()}),I({type:B(`code_interpreter_call`),id:A(),container_id:A(),code:A().nullable(),outputs:F(R(`type`,[I({type:B(`logs`),logs:A()}),I({type:B(`image`),url:A()})])).nullable(),status:A()}),I({type:B(`mcp_call`),id:A(),status:A(),approval_request_id:A().nullish()}),I({type:B(`mcp_list_tools`),id:A()}),I({type:B(`mcp_approval_request`),id:A()}),I({type:B(`apply_patch_call`),id:A(),call_id:A(),status:z([`in_progress`,`completed`]),operation:R(`type`,[I({type:B(`create_file`),path:A(),diff:A()}),I({type:B(`delete_file`),path:A()}),I({type:B(`update_file`),path:A(),diff:A()})])}),I({type:B(`shell_call`),id:A(),call_id:A(),status:z([`in_progress`,`completed`,`incomplete`]),action:I({commands:F(A())})})])}),I({type:B(`response.output_item.done`),output_index:j(),item:R(`type`,[I({type:B(`message`),id:A()}),I({type:B(`reasoning`),id:A(),encrypted_content:A().nullish()}),I({type:B(`function_call`),id:A(),call_id:A(),name:A(),arguments:A(),status:B(`completed`)}),I({type:B(`code_interpreter_call`),id:A(),code:A().nullable(),container_id:A(),outputs:F(R(`type`,[I({type:B(`logs`),logs:A()}),I({type:B(`image`),url:A()})])).nullable()}),I({type:B(`image_generation_call`),id:A(),result:A()}),I({type:B(`web_search_call`),id:A(),status:A(),action:R(`type`,[I({type:B(`search`),query:A().nullish(),sources:F(R(`type`,[I({type:B(`url`),url:A()}),I({type:B(`api`),name:A()})])).nullish()}),I({type:B(`open_page`),url:A().nullish()}),I({type:B(`find_in_page`),url:A().nullish(),pattern:A().nullish()})])}),I({type:B(`file_search_call`),id:A(),queries:F(A()),results:F(I({attributes:Hs(A(),L([A(),j(),M()])),file_id:A(),filename:A(),score:j(),text:A()})).nullish()}),I({type:B(`local_shell_call`),id:A(),call_id:A(),action:I({type:B(`exec`),command:F(A()),timeout_ms:j().optional(),user:A().optional(),working_directory:A().optional(),env:Hs(A(),A()).optional()})}),I({type:B(`computer_call`),id:A(),status:B(`completed`)}),I({type:B(`mcp_call`),id:A(),status:A(),arguments:A(),name:A(),server_label:A(),output:A().nullish(),error:L([A(),I({type:A().optional(),code:L([j(),A()]).optional(),message:A().optional()}).loose()]).nullish(),approval_request_id:A().nullish()}),I({type:B(`mcp_list_tools`),id:A(),server_label:A(),tools:F(I({name:A(),description:A().optional(),input_schema:Os(),annotations:Hs(A(),N()).optional()})),error:L([A(),I({type:A().optional(),code:L([j(),A()]).optional(),message:A().optional()}).loose()]).optional()}),I({type:B(`mcp_approval_request`),id:A(),server_label:A(),name:A(),arguments:A(),approval_request_id:A().optional()}),I({type:B(`apply_patch_call`),id:A(),call_id:A(),status:z([`in_progress`,`completed`]),operation:R(`type`,[I({type:B(`create_file`),path:A(),diff:A()}),I({type:B(`delete_file`),path:A()}),I({type:B(`update_file`),path:A(),diff:A()})])}),I({type:B(`shell_call`),id:A(),call_id:A(),status:z([`in_progress`,`completed`,`incomplete`]),action:I({commands:F(A())})})])}),I({type:B(`response.function_call_arguments.delta`),item_id:A(),output_index:j(),delta:A()}),I({type:B(`response.image_generation_call.partial_image`),item_id:A(),output_index:j(),partial_image_b64:A()}),I({type:B(`response.code_interpreter_call_code.delta`),item_id:A(),output_index:j(),delta:A()}),I({type:B(`response.code_interpreter_call_code.done`),item_id:A(),output_index:j(),code:A()}),I({type:B(`response.output_text.annotation.added`),annotation:R(`type`,[I({type:B(`url_citation`),start_index:j(),end_index:j(),url:A(),title:A()}),I({type:B(`file_citation`),file_id:A(),filename:A(),index:j()}),I({type:B(`container_file_citation`),container_id:A(),file_id:A(),filename:A(),start_index:j(),end_index:j()}),I({type:B(`file_path`),file_id:A(),index:j()})])}),I({type:B(`response.reasoning_summary_part.added`),item_id:A(),summary_index:j()}),I({type:B(`response.reasoning_summary_text.delta`),item_id:A(),summary_index:j(),delta:A()}),I({type:B(`response.reasoning_summary_part.done`),item_id:A(),summary_index:j()}),I({type:B(`response.apply_patch_call_operation_diff.delta`),item_id:A(),output_index:j(),delta:A(),obfuscation:A().nullish()}),I({type:B(`response.apply_patch_call_operation_diff.done`),item_id:A(),output_index:j(),diff:A()}),I({type:B(`error`),sequence_number:j(),error:I({type:A(),code:A(),message:A(),param:A().nullish()})}),I({type:A()}).loose().transform(e=>({type:`unknown_chunk`,message:e.type}))]))),Rh=X(()=>Z(I({id:A().optional(),created_at:j().optional(),error:I({message:A(),type:A(),param:A().nullish(),code:A()}).nullish(),model:A().optional(),output:F(R(`type`,[I({type:B(`message`),role:B(`assistant`),id:A(),content:F(I({type:B(`output_text`),text:A(),logprobs:F(I({token:A(),logprob:j(),top_logprobs:F(I({token:A(),logprob:j()}))})).nullish(),annotations:F(R(`type`,[I({type:B(`url_citation`),start_index:j(),end_index:j(),url:A(),title:A()}),I({type:B(`file_citation`),file_id:A(),filename:A(),index:j()}),I({type:B(`container_file_citation`),container_id:A(),file_id:A(),filename:A(),start_index:j(),end_index:j()}),I({type:B(`file_path`),file_id:A(),index:j()})]))}))}),I({type:B(`web_search_call`),id:A(),status:A(),action:R(`type`,[I({type:B(`search`),query:A().nullish(),sources:F(R(`type`,[I({type:B(`url`),url:A()}),I({type:B(`api`),name:A()})])).nullish()}),I({type:B(`open_page`),url:A().nullish()}),I({type:B(`find_in_page`),url:A().nullish(),pattern:A().nullish()})])}),I({type:B(`file_search_call`),id:A(),queries:F(A()),results:F(I({attributes:Hs(A(),L([A(),j(),M()])),file_id:A(),filename:A(),score:j(),text:A()})).nullish()}),I({type:B(`code_interpreter_call`),id:A(),code:A().nullable(),container_id:A(),outputs:F(R(`type`,[I({type:B(`logs`),logs:A()}),I({type:B(`image`),url:A()})])).nullable()}),I({type:B(`image_generation_call`),id:A(),result:A()}),I({type:B(`local_shell_call`),id:A(),call_id:A(),action:I({type:B(`exec`),command:F(A()),timeout_ms:j().optional(),user:A().optional(),working_directory:A().optional(),env:Hs(A(),A()).optional()})}),I({type:B(`function_call`),call_id:A(),name:A(),arguments:A(),id:A()}),I({type:B(`computer_call`),id:A(),status:A().optional()}),I({type:B(`reasoning`),id:A(),encrypted_content:A().nullish(),summary:F(I({type:B(`summary_text`),text:A()}))}),I({type:B(`mcp_call`),id:A(),status:A(),arguments:A(),name:A(),server_label:A(),output:A().nullish(),error:L([A(),I({type:A().optional(),code:L([j(),A()]).optional(),message:A().optional()}).loose()]).nullish(),approval_request_id:A().nullish()}),I({type:B(`mcp_list_tools`),id:A(),server_label:A(),tools:F(I({name:A(),description:A().optional(),input_schema:Os(),annotations:Hs(A(),N()).optional()})),error:L([A(),I({type:A().optional(),code:L([j(),A()]).optional(),message:A().optional()}).loose()]).optional()}),I({type:B(`mcp_approval_request`),id:A(),server_label:A(),name:A(),arguments:A(),approval_request_id:A().optional()}),I({type:B(`apply_patch_call`),id:A(),call_id:A(),status:z([`in_progress`,`completed`]),operation:R(`type`,[I({type:B(`create_file`),path:A(),diff:A()}),I({type:B(`delete_file`),path:A()}),I({type:B(`update_file`),path:A(),diff:A()})])}),I({type:B(`shell_call`),id:A(),call_id:A(),status:z([`in_progress`,`completed`,`incomplete`]),action:I({commands:F(A())})})])).optional(),service_tier:A().nullish(),incomplete_details:I({reason:A()}).nullish(),usage:I({input_tokens:j(),input_tokens_details:I({cached_tokens:j().nullish()}).nullish(),output_tokens:j(),output_tokens_details:I({reasoning_tokens:j().nullish()}).nullish()}).optional()}))),zh=20,Bh=X(()=>Z(I({conversation:A().nullish(),include:F(z([`reasoning.encrypted_content`,`file_search_call.results`,`message.output_text.logprobs`])).nullish(),instructions:A().nullish(),logprobs:L([M(),j().min(1).max(zh)]).optional(),maxToolCalls:j().nullish(),metadata:Os().nullish(),parallelToolCalls:M().nullish(),previousResponseId:A().nullish(),promptCacheKey:A().nullish(),promptCacheRetention:z([`in_memory`,`24h`]).nullish(),reasoningEffort:A().nullish(),reasoningSummary:A().nullish(),safetyIdentifier:A().nullish(),serviceTier:z([`auto`,`flex`,`priority`,`default`]).nullish(),store:M().nullish(),strictJsonSchema:M().nullish(),textVerbosity:z([`low`,`medium`,`high`]).nullish(),truncation:z([`auto`,`disabled`]).nullish(),user:A().nullish(),systemMessageMode:z([`system`,`developer`,`remove`]).optional(),forceReasoning:M().optional()})));async function Vh({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)switch(t.type){case`function`:r.push({type:`function`,name:t.name,description:t.description,parameters:t.inputSchema,...t.strict==null?{}:{strict:t.strict}});break;case`provider`:switch(t.id){case`openai.file_search`:{let e=await Qd({value:t.args,schema:dh});r.push({type:`file_search`,vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker,score_threshold:e.ranking.scoreThreshold}:void 0,filters:e.filters});break}case`openai.local_shell`:r.push({type:`local_shell`});break;case`openai.shell`:r.push({type:`shell`});break;case`openai.apply_patch`:r.push({type:`apply_patch`});break;case`openai.web_search_preview`:{let e=await Qd({value:t.args,schema:Eh});r.push({type:`web_search_preview`,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.web_search`:{let e=await Qd({value:t.args,schema:Ch});r.push({type:`web_search`,filters:e.filters==null?void 0:{allowed_domains:e.filters.allowedDomains},external_web_access:e.externalWebAccess,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.code_interpreter`:{let e=await Qd({value:t.args,schema:oh});r.push({type:`code_interpreter`,container:e.container==null?{type:`auto`,file_ids:void 0}:typeof e.container==`string`?e.container:{type:`auto`,file_ids:e.container.fileIds}});break}case`openai.image_generation`:{let e=await Qd({value:t.args,schema:mh});r.push({type:`image_generation`,background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask?{file_id:e.inputImageMask.fileId,image_url:e.inputImageMask.imageUrl}:void 0,model:e.model,moderation:e.moderation,partial_images:e.partialImages,quality:e.quality,output_compression:e.outputCompression,output_format:e.outputFormat,size:e.size});break}case`openai.mcp`:{let e=await Qd({value:t.args,schema:kh}),n=e=>({tool_names:e.toolNames}),i=e.requireApproval,a=i==null?void 0:typeof i==`string`?i:i.never==null?void 0:{never:n(i.never)};r.push({type:`mcp`,server_label:e.serverLabel,allowed_tools:Array.isArray(e.allowedTools)?e.allowedTools:e.allowedTools?{read_only:e.allowedTools.readOnly,tool_names:e.allowedTools.toolNames}:void 0,authorization:e.authorization,connector_id:e.connectorId,headers:e.headers,require_approval:a??`never`,server_description:e.serverDescription,server_url:e.serverUrl});break}}break;default:n.push({type:`unsupported`,feature:`function tool ${t}`});break}if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:case`required`:return{tools:r,toolChoice:i,toolWarnings:n};case`tool`:return{tools:r,toolChoice:t.toolName===`code_interpreter`||t.toolName===`file_search`||t.toolName===`image_generation`||t.toolName===`web_search_preview`||t.toolName===`web_search`||t.toolName===`mcp`||t.toolName===`apply_patch`?{type:t.toolName}:{type:`function`,name:t.toolName},toolWarnings:n};default:throw new rt({functionality:`tool choice type: ${i}`})}}function Hh(e){let t={};for(let n of e)if(n.role===`assistant`)for(let e of n.content){if(e.type!==`tool-call`)continue;let n=e.providerOptions?.openai?.approvalRequestId;n!=null&&(t[n]=e.toolCallId)}return t}var Uh=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:r,topK:i,presencePenalty:a,frequencyPenalty:o,seed:s,prompt:c,providerOptions:l,tools:u,toolChoice:d,responseFormat:f}){let p=[],m=Om(this.modelId);i!=null&&p.push({type:`unsupported`,feature:`topK`}),s!=null&&p.push({type:`unsupported`,feature:`seed`}),a!=null&&p.push({type:`unsupported`,feature:`presencePenalty`}),o!=null&&p.push({type:`unsupported`,feature:`frequencyPenalty`}),n!=null&&p.push({type:`unsupported`,feature:`stopSequences`});let h=this.config.provider.includes(`azure`)?`azure`:`openai`,g=await af({provider:h,providerOptions:l,schema:Bh});g==null&&h!==`openai`&&(g=await af({provider:`openai`,providerOptions:l,schema:Bh}));let _=g?.forceReasoning??m.isReasoningModel;g?.conversation&&g?.previousResponseId&&p.push({type:`unsupported`,feature:`conversation`,details:`conversation and previousResponseId cannot be used together`});let v=Zl({tools:u,providerToolNames:{"openai.code_interpreter":`code_interpreter`,"openai.file_search":`file_search`,"openai.image_generation":`image_generation`,"openai.local_shell":`local_shell`,"openai.shell":`shell`,"openai.web_search":`web_search`,"openai.web_search_preview":`web_search_preview`,"openai.mcp":`mcp`,"openai.apply_patch":`apply_patch`}}),{input:ee,warnings:y}=await Ph({prompt:c,toolNameMapping:v,systemMessageMode:g?.systemMessageMode??(_?`developer`:m.systemMessageMode),providerOptionsName:h,fileIdPrefixes:this.config.fileIdPrefixes,store:g?.store??!0,hasConversation:g?.conversation!=null,hasLocalShellTool:S(`openai.local_shell`),hasShellTool:S(`openai.shell`),hasApplyPatchTool:S(`openai.apply_patch`)});p.push(...y);let b=g?.strictJsonSchema??!0,te=g?.include;function x(e){te==null?te=[e]:te.includes(e)||(te=[...te,e])}function S(e){return u?.find(t=>t.type===`provider`&&t.id===e)!=null}let ne=typeof g?.logprobs==`number`?g?.logprobs:g?.logprobs===!0?zh:void 0;ne&&x(`message.output_text.logprobs`);let C=u?.find(e=>e.type===`provider`&&(e.id===`openai.web_search`||e.id===`openai.web_search_preview`))?.name;C&&x(`web_search_call.action.sources`),S(`openai.code_interpreter`)&&x(`code_interpreter_call.outputs`);let re=g?.store;re===!1&&_&&x(`reasoning.encrypted_content`);let w={model:this.modelId,input:ee,temperature:t,top_p:r,max_output_tokens:e,...(f?.type===`json`||g?.textVerbosity)&&{text:{...f?.type===`json`&&{format:f.schema==null?{type:`json_object`}:{type:`json_schema`,strict:b,name:f.name??`response`,description:f.description,schema:f.schema}},...g?.textVerbosity&&{verbosity:g.textVerbosity}}},conversation:g?.conversation,max_tool_calls:g?.maxToolCalls,metadata:g?.metadata,parallel_tool_calls:g?.parallelToolCalls,previous_response_id:g?.previousResponseId,store:re,user:g?.user,instructions:g?.instructions,service_tier:g?.serviceTier,include:te,prompt_cache_key:g?.promptCacheKey,prompt_cache_retention:g?.promptCacheRetention,safety_identifier:g?.safetyIdentifier,top_logprobs:ne,truncation:g?.truncation,..._&&(g?.reasoningEffort!=null||g?.reasoningSummary!=null)&&{reasoning:{...g?.reasoningEffort!=null&&{effort:g.reasoningEffort},...g?.reasoningSummary!=null&&{summary:g.reasoningSummary}}}};_?g?.reasoningEffort===`none`&&m.supportsNonReasoningParameters||(w.temperature!=null&&(w.temperature=void 0,p.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported for reasoning models`})),w.top_p!=null&&(w.top_p=void 0,p.push({type:`unsupported`,feature:`topP`,details:`topP is not supported for reasoning models`}))):(g?.reasoningEffort!=null&&p.push({type:`unsupported`,feature:`reasoningEffort`,details:`reasoningEffort is not supported for non-reasoning models`}),g?.reasoningSummary!=null&&p.push({type:`unsupported`,feature:`reasoningSummary`,details:`reasoningSummary is not supported for non-reasoning models`})),g?.serviceTier===`flex`&&!m.supportsFlexProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),delete w.service_tier),g?.serviceTier===`priority`&&!m.supportsPriorityProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),delete w.service_tier);let{tools:ie,toolChoice:ae,toolWarnings:T}=await Vh({tools:u,toolChoice:d});return{webSearchToolName:C,args:{...w,tools:ie,tool_choice:ae},warnings:[...p,...T],store:re,toolNameMapping:v,providerOptionsName:h}}async doGenerate(e){var t,n,r,i,a;let{args:o,warnings:s,webSearchToolName:c,toolNameMapping:l,providerOptionsName:u}=await this.getArgs(e),f=this.config.url({path:`/responses`,modelId:this.modelId}),p=Hh(e.prompt),{responseHeaders:m,value:h,rawValue:g}=await sf({url:f,headers:Xl(this.config.headers(),e.headers),body:o,failedResponseHandler:Dm,successfulResponseHandler:_f(Rh),abortSignal:e.abortSignal,fetch:this.config.fetch});if(h.error)throw new d({message:h.error.message,url:f,requestBodyValues:o,statusCode:400,responseHeaders:m,responseBody:g,isRetryable:!1});let _=[],v=[],ee=!1;for(let o of h.output)switch(o.type){case`reasoning`:o.summary.length===0&&o.summary.push({type:`summary_text`,text:``});for(let e of o.summary)_.push({type:`reasoning`,text:e.text,providerMetadata:{[u]:{itemId:o.id,reasoningEncryptedContent:o.encrypted_content??null}}});break;case`image_generation_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`image_generation`),input:`{}`,providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`image_generation`),result:{result:o.result}});break;case`local_shell_call`:_.push({type:`tool-call`,toolCallId:o.call_id,toolName:l.toCustomToolName(`local_shell`),input:JSON.stringify({action:o.action}),providerMetadata:{[u]:{itemId:o.id}}});break;case`shell_call`:_.push({type:`tool-call`,toolCallId:o.call_id,toolName:l.toCustomToolName(`shell`),input:JSON.stringify({action:{commands:o.action.commands}}),providerMetadata:{[u]:{itemId:o.id}}});break;case`message`:for(let a of o.content){e.providerOptions?.[u]?.logprobs&&a.logprobs&&v.push(a.logprobs);let s={itemId:o.id,...a.annotations.length>0&&{annotations:a.annotations}};_.push({type:`text`,text:a.text,providerMetadata:{[u]:s}});for(let e of a.annotations)e.type===`url_citation`?_.push({type:`source`,sourceType:`url`,id:(t=this.config).generateId?.call(t)??gu(),url:e.url,title:e.title}):e.type===`file_citation`?_.push({type:`source`,sourceType:`document`,id:(n=this.config).generateId?.call(n)??gu(),mediaType:`text/plain`,title:e.filename,filename:e.filename,providerMetadata:{[u]:{type:e.type,fileId:e.file_id,index:e.index}}}):e.type===`container_file_citation`?_.push({type:`source`,sourceType:`document`,id:(r=this.config).generateId?.call(r)??gu(),mediaType:`text/plain`,title:e.filename,filename:e.filename,providerMetadata:{[u]:{type:e.type,fileId:e.file_id,containerId:e.container_id}}}):e.type===`file_path`&&_.push({type:`source`,sourceType:`document`,id:(i=this.config).generateId?.call(i)??gu(),mediaType:`application/octet-stream`,title:e.file_id,filename:e.file_id,providerMetadata:{[u]:{type:e.type,fileId:e.file_id,index:e.index}}})}break;case`function_call`:ee=!0,_.push({type:`tool-call`,toolCallId:o.call_id,toolName:o.name,input:o.arguments,providerMetadata:{[u]:{itemId:o.id}}});break;case`web_search_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(c??`web_search`),input:JSON.stringify({}),providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(c??`web_search`),result:rg(o.action)});break;case`mcp_call`:{let e=o.approval_request_id==null?o.id:p[o.approval_request_id]??o.id,t=`mcp.${o.name}`;_.push({type:`tool-call`,toolCallId:e,toolName:t,input:o.arguments,providerExecuted:!0,dynamic:!0}),_.push({type:`tool-result`,toolCallId:e,toolName:t,result:{type:`call`,serverLabel:o.server_label,name:o.name,arguments:o.arguments,...o.output==null?{}:{output:o.output},...o.error==null?{}:{error:o.error}},providerMetadata:{[u]:{itemId:o.id}}});break}case`mcp_list_tools`:break;case`mcp_approval_request`:{let e=o.approval_request_id??o.id,t=(a=this.config).generateId?.call(a)??gu(),n=`mcp.${o.name}`;_.push({type:`tool-call`,toolCallId:t,toolName:n,input:o.arguments,providerExecuted:!0,dynamic:!0}),_.push({type:`tool-approval-request`,approvalId:e,toolCallId:t});break}case`computer_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`computer_use`),input:``,providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`computer_use`),result:{type:`computer_use_tool_result`,status:o.status||`completed`}});break;case`file_search_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`file_search`),input:`{}`,providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`file_search`),result:{queries:o.queries,results:o.results?.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text}))??null}});break;case`code_interpreter_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`code_interpreter`),input:JSON.stringify({code:o.code,containerId:o.container_id}),providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`code_interpreter`),result:{outputs:o.outputs}});break;case`apply_patch_call`:_.push({type:`tool-call`,toolCallId:o.call_id,toolName:l.toCustomToolName(`apply_patch`),input:JSON.stringify({callId:o.call_id,operation:o.operation}),providerMetadata:{[u]:{itemId:o.id}}});break}let y={[u]:{responseId:h.id}};v.length>0&&(y[u].logprobs=v),typeof h.service_tier==`string`&&(y[u].serviceTier=h.service_tier);let b=h.usage;return{content:_,finishReason:{unified:Ih({finishReason:h.incomplete_details?.reason,hasFunctionCall:ee}),raw:h.incomplete_details?.reason??void 0},usage:Mh(b),request:{body:o},response:{id:h.id,timestamp:new Date(h.created_at*1e3),modelId:h.model,headers:m,body:g},providerMetadata:y,warnings:s}}async doStream(e){let{args:t,warnings:n,webSearchToolName:r,toolNameMapping:i,store:a,providerOptionsName:o}=await this.getArgs(e),{responseHeaders:s,value:c}=await sf({url:this.config.url({path:`/responses`,modelId:this.modelId}),headers:Xl(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:Dm,successfulResponseHandler:gf(Lh),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=this,u=Hh(e.prompt),d=new Map,f={unified:`other`,raw:void 0},p,m=[],h=null,g={},_=[],v=!1,ee={},y;return{stream:c.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var s,c,b,te,x;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){f={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:t.error});return}let S=t.value;if(eg(S)){if(S.item.type===`function_call`)g[S.output_index]={toolName:S.item.name,toolCallId:S.item.call_id},n.enqueue({type:`tool-input-start`,id:S.item.call_id,toolName:S.item.name});else if(S.item.type===`web_search_call`)g[S.output_index]={toolName:i.toCustomToolName(r??`web_search`),toolCallId:S.item.id},n.enqueue({type:`tool-input-start`,id:S.item.id,toolName:i.toCustomToolName(r??`web_search`),providerExecuted:!0}),n.enqueue({type:`tool-input-end`,id:S.item.id}),n.enqueue({type:`tool-call`,toolCallId:S.item.id,toolName:i.toCustomToolName(r??`web_search`),input:JSON.stringify({}),providerExecuted:!0});else if(S.item.type===`computer_call`)g[S.output_index]={toolName:i.toCustomToolName(`computer_use`),toolCallId:S.item.id},n.enqueue({type:`tool-input-start`,id:S.item.id,toolName:i.toCustomToolName(`computer_use`),providerExecuted:!0});else if(S.item.type===`code_interpreter_call`)g[S.output_index]={toolName:i.toCustomToolName(`code_interpreter`),toolCallId:S.item.id,codeInterpreter:{containerId:S.item.container_id}},n.enqueue({type:`tool-input-start`,id:S.item.id,toolName:i.toCustomToolName(`code_interpreter`),providerExecuted:!0}),n.enqueue({type:`tool-input-delta`,id:S.item.id,delta:`{"containerId":"${S.item.container_id}","code":"`});else if(S.item.type===`file_search_call`)n.enqueue({type:`tool-call`,toolCallId:S.item.id,toolName:i.toCustomToolName(`file_search`),input:`{}`,providerExecuted:!0});else if(S.item.type===`image_generation_call`)n.enqueue({type:`tool-call`,toolCallId:S.item.id,toolName:i.toCustomToolName(`image_generation`),input:`{}`,providerExecuted:!0});else if(!(S.item.type===`mcp_call`||S.item.type===`mcp_list_tools`||S.item.type===`mcp_approval_request`))if(S.item.type===`apply_patch_call`){let{call_id:e,operation:t}=S.item;if(g[S.output_index]={toolName:i.toCustomToolName(`apply_patch`),toolCallId:e,applyPatch:{hasDiff:t.type===`delete_file`,endEmitted:t.type===`delete_file`}},n.enqueue({type:`tool-input-start`,id:e,toolName:i.toCustomToolName(`apply_patch`)}),t.type===`delete_file`){let r=JSON.stringify({callId:e,operation:t});n.enqueue({type:`tool-input-delta`,id:e,delta:r}),n.enqueue({type:`tool-input-end`,id:e})}else n.enqueue({type:`tool-input-delta`,id:e,delta:`{"callId":"${ig(e)}","operation":{"type":"${ig(t.type)}","path":"${ig(t.path)}","diff":"`})}else S.item.type===`shell_call`?g[S.output_index]={toolName:i.toCustomToolName(`shell`),toolCallId:S.item.call_id}:S.item.type===`message`?(_.splice(0,_.length),n.enqueue({type:`text-start`,id:S.item.id,providerMetadata:{[o]:{itemId:S.item.id}}})):eg(S)&&S.item.type===`reasoning`&&(ee[S.item.id]={encryptedContent:S.item.encrypted_content,summaryParts:{0:`active`}},n.enqueue({type:`reasoning-start`,id:`${S.item.id}:0`,providerMetadata:{[o]:{itemId:S.item.id,reasoningEncryptedContent:S.item.encrypted_content??null}}}))}else if(Gh(S)){if(S.item.type===`message`)n.enqueue({type:`text-end`,id:S.item.id,providerMetadata:{[o]:{itemId:S.item.id,..._.length>0&&{annotations:_}}}});else if(S.item.type===`function_call`)g[S.output_index]=void 0,v=!0,n.enqueue({type:`tool-input-end`,id:S.item.call_id}),n.enqueue({type:`tool-call`,toolCallId:S.item.call_id,toolName:S.item.name,input:S.item.arguments,providerMetadata:{[o]:{itemId:S.item.id}}});else if(S.item.type===`web_search_call`)g[S.output_index]=void 0,n.enqueue({type:`tool-result`,toolCallId:S.item.id,toolName:i.toCustomToolName(r??`web_search`),result:rg(S.item.action)});else if(S.item.type===`computer_call`)g[S.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:S.item.id}),n.enqueue({type:`tool-call`,toolCallId:S.item.id,toolName:i.toCustomToolName(`computer_use`),input:``,providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:S.item.id,toolName:i.toCustomToolName(`computer_use`),result:{type:`computer_use_tool_result`,status:S.item.status||`completed`}});else if(S.item.type===`file_search_call`)g[S.output_index]=void 0,n.enqueue({type:`tool-result`,toolCallId:S.item.id,toolName:i.toCustomToolName(`file_search`),result:{queries:S.item.queries,results:S.item.results?.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text}))??null}});else if(S.item.type===`code_interpreter_call`)g[S.output_index]=void 0,n.enqueue({type:`tool-result`,toolCallId:S.item.id,toolName:i.toCustomToolName(`code_interpreter`),result:{outputs:S.item.outputs}});else if(S.item.type===`image_generation_call`)n.enqueue({type:`tool-result`,toolCallId:S.item.id,toolName:i.toCustomToolName(`image_generation`),result:{result:S.item.result}});else if(S.item.type===`mcp_call`){g[S.output_index]=void 0;let e=S.item.approval_request_id??void 0,t=e==null?S.item.id:d.get(e)??u[e]??S.item.id,r=`mcp.${S.item.name}`;n.enqueue({type:`tool-call`,toolCallId:t,toolName:r,input:S.item.arguments,providerExecuted:!0,dynamic:!0}),n.enqueue({type:`tool-result`,toolCallId:t,toolName:r,result:{type:`call`,serverLabel:S.item.server_label,name:S.item.name,arguments:S.item.arguments,...S.item.output==null?{}:{output:S.item.output},...S.item.error==null?{}:{error:S.item.error}},providerMetadata:{[o]:{itemId:S.item.id}}})}else if(S.item.type===`mcp_list_tools`)g[S.output_index]=void 0;else if(S.item.type===`apply_patch_call`){let e=g[S.output_index];e?.applyPatch&&!e.applyPatch.endEmitted&&S.item.operation.type!==`delete_file`&&(e.applyPatch.hasDiff||n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:ig(S.item.operation.diff)}),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:`"}}`}),n.enqueue({type:`tool-input-end`,id:e.toolCallId}),e.applyPatch.endEmitted=!0),e&&S.item.status===`completed`&&n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:i.toCustomToolName(`apply_patch`),input:JSON.stringify({callId:S.item.call_id,operation:S.item.operation}),providerMetadata:{[o]:{itemId:S.item.id}}}),g[S.output_index]=void 0}else if(S.item.type===`mcp_approval_request`){g[S.output_index]=void 0;let e=(s=l.config).generateId?.call(s)??gu(),t=S.item.approval_request_id??S.item.id;d.set(t,e);let r=`mcp.${S.item.name}`;n.enqueue({type:`tool-call`,toolCallId:e,toolName:r,input:S.item.arguments,providerExecuted:!0,dynamic:!0}),n.enqueue({type:`tool-approval-request`,approvalId:t,toolCallId:e})}else if(S.item.type===`local_shell_call`)g[S.output_index]=void 0,n.enqueue({type:`tool-call`,toolCallId:S.item.call_id,toolName:i.toCustomToolName(`local_shell`),input:JSON.stringify({action:{type:`exec`,command:S.item.action.command,timeoutMs:S.item.action.timeout_ms,user:S.item.action.user,workingDirectory:S.item.action.working_directory,env:S.item.action.env}}),providerMetadata:{[o]:{itemId:S.item.id}}});else if(S.item.type===`shell_call`)g[S.output_index]=void 0,n.enqueue({type:`tool-call`,toolCallId:S.item.call_id,toolName:i.toCustomToolName(`shell`),input:JSON.stringify({action:{commands:S.item.action.commands}}),providerMetadata:{[o]:{itemId:S.item.id}}});else if(S.item.type===`reasoning`){let e=ee[S.item.id],t=Object.entries(e.summaryParts).filter(([e,t])=>t===`active`||t===`can-conclude`).map(([e])=>e);for(let e of t)n.enqueue({type:`reasoning-end`,id:`${S.item.id}:${e}`,providerMetadata:{[o]:{itemId:S.item.id,reasoningEncryptedContent:S.item.encrypted_content??null}}});delete ee[S.item.id]}}else if(Jh(S)){let e=g[S.output_index];e!=null&&n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:S.delta})}else if(Qh(S)){let e=g[S.output_index];e?.applyPatch&&(n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:ig(S.delta)}),e.applyPatch.hasDiff=!0)}else if($h(S)){let e=g[S.output_index];e?.applyPatch&&!e.applyPatch.endEmitted&&(e.applyPatch.hasDiff||(n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:ig(S.diff)}),e.applyPatch.hasDiff=!0),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:`"}}`}),n.enqueue({type:`tool-input-end`,id:e.toolCallId}),e.applyPatch.endEmitted=!0)}else if(Yh(S))n.enqueue({type:`tool-result`,toolCallId:S.item_id,toolName:i.toCustomToolName(`image_generation`),result:{result:S.partial_image_b64},preliminary:!0});else if(Xh(S)){let e=g[S.output_index];e!=null&&n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:ig(S.delta)})}else if(Zh(S)){let e=g[S.output_index];e!=null&&(n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:`"}`}),n.enqueue({type:`tool-input-end`,id:e.toolCallId}),n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:i.toCustomToolName(`code_interpreter`),input:JSON.stringify({code:S.code,containerId:e.codeInterpreter.containerId}),providerExecuted:!0}))}else if(qh(S))h=S.response.id,n.enqueue({type:`response-metadata`,id:S.response.id,timestamp:new Date(S.response.created_at*1e3),modelId:S.response.model});else if(Wh(S))n.enqueue({type:`text-delta`,id:S.item_id,delta:S.delta}),e.providerOptions?.[o]?.logprobs&&S.logprobs&&m.push(S.logprobs);else if(S.type===`response.reasoning_summary_part.added`){if(S.summary_index>0){let e=ee[S.item_id];e.summaryParts[S.summary_index]=`active`;for(let t of Object.keys(e.summaryParts))e.summaryParts[t]===`can-conclude`&&(n.enqueue({type:`reasoning-end`,id:`${S.item_id}:${t}`,providerMetadata:{[o]:{itemId:S.item_id}}}),e.summaryParts[t]=`concluded`);n.enqueue({type:`reasoning-start`,id:`${S.item_id}:${S.summary_index}`,providerMetadata:{[o]:{itemId:S.item_id,reasoningEncryptedContent:ee[S.item_id]?.encryptedContent??null}}})}}else S.type===`response.reasoning_summary_text.delta`?n.enqueue({type:`reasoning-delta`,id:`${S.item_id}:${S.summary_index}`,delta:S.delta,providerMetadata:{[o]:{itemId:S.item_id}}}):S.type===`response.reasoning_summary_part.done`?a?(n.enqueue({type:`reasoning-end`,id:`${S.item_id}:${S.summary_index}`,providerMetadata:{[o]:{itemId:S.item_id}}}),ee[S.item_id].summaryParts[S.summary_index]=`concluded`):ee[S.item_id].summaryParts[S.summary_index]=`can-conclude`:Kh(S)?(f={unified:Ih({finishReason:S.response.incomplete_details?.reason,hasFunctionCall:v}),raw:S.response.incomplete_details?.reason??void 0},p=S.response.usage,typeof S.response.service_tier==`string`&&(y=S.response.service_tier)):tg(S)?(_.push(S.annotation),S.annotation.type===`url_citation`?n.enqueue({type:`source`,sourceType:`url`,id:(c=l.config).generateId?.call(c)??gu(),url:S.annotation.url,title:S.annotation.title}):S.annotation.type===`file_citation`?n.enqueue({type:`source`,sourceType:`document`,id:(b=l.config).generateId?.call(b)??gu(),mediaType:`text/plain`,title:S.annotation.filename,filename:S.annotation.filename,providerMetadata:{[o]:{type:S.annotation.type,fileId:S.annotation.file_id,index:S.annotation.index}}}):S.annotation.type===`container_file_citation`?n.enqueue({type:`source`,sourceType:`document`,id:(te=l.config).generateId?.call(te)??gu(),mediaType:`text/plain`,title:S.annotation.filename,filename:S.annotation.filename,providerMetadata:{[o]:{type:S.annotation.type,fileId:S.annotation.file_id,containerId:S.annotation.container_id}}}):S.annotation.type===`file_path`&&n.enqueue({type:`source`,sourceType:`document`,id:(x=l.config).generateId?.call(x)??gu(),mediaType:`application/octet-stream`,title:S.annotation.file_id,filename:S.annotation.file_id,providerMetadata:{[o]:{type:S.annotation.type,fileId:S.annotation.file_id,index:S.annotation.index}}})):ng(S)&&n.enqueue({type:`error`,error:S})},flush(e){let t={[o]:{responseId:h}};m.length>0&&(t[o].logprobs=m),y!==void 0&&(t[o].serviceTier=y),e.enqueue({type:`finish`,finishReason:f,usage:Mh(p),providerMetadata:t})}})),request:{body:t},response:{headers:s}}}};function Wh(e){return e.type===`response.output_text.delta`}function Gh(e){return e.type===`response.output_item.done`}function Kh(e){return e.type===`response.completed`||e.type===`response.incomplete`}function qh(e){return e.type===`response.created`}function Jh(e){return e.type===`response.function_call_arguments.delta`}function Yh(e){return e.type===`response.image_generation_call.partial_image`}function Xh(e){return e.type===`response.code_interpreter_call_code.delta`}function Zh(e){return e.type===`response.code_interpreter_call_code.done`}function Qh(e){return e.type===`response.apply_patch_call_operation_diff.delta`}function $h(e){return e.type===`response.apply_patch_call_operation_diff.done`}function eg(e){return e.type===`response.output_item.added`}function tg(e){return e.type===`response.output_text.annotation.added`}function ng(e){return e.type===`error`}function rg(e){switch(e.type){case`search`:return{action:{type:`search`,query:e.query??void 0},...e.sources!=null&&{sources:e.sources}};case`open_page`:return{action:{type:`openPage`,url:e.url}};case`find_in_page`:return{action:{type:`findInPage`,url:e.url,pattern:e.pattern}}}}function ig(e){return JSON.stringify(e).slice(1,-1)}var ag=X(()=>Z(I({instructions:A().nullish(),speed:j().min(.25).max(4).default(1).nullish()}))),og=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`}get provider(){return this.config.provider}async getArgs({text:e,voice:t=`alloy`,outputFormat:n=`mp3`,speed:r,instructions:i,language:a,providerOptions:o}){let s=[],c=await af({provider:`openai`,providerOptions:o,schema:ag}),l={model:this.modelId,input:e,voice:t,response_format:`mp3`,speed:r,instructions:i};if(n&&([`mp3`,`opus`,`aac`,`flac`,`wav`,`pcm`].includes(n)?l.response_format=n:s.push({type:`unsupported`,feature:`outputFormat`,details:`Unsupported output format: ${n}. Using mp3 instead.`})),c){let e={};for(let t in e){let n=e[t];n!==void 0&&(l[t]=n)}}return a&&s.push({type:`unsupported`,feature:`language`,details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:l,warnings:s}}async doGenerate(e){var t;let n=((t=this.config._internal)?.currentDate)?.call(t)??new Date,{requestBody:r,warnings:i}=await this.getArgs(e),{value:a,responseHeaders:o,rawValue:s}=await sf({url:this.config.url({path:`/audio/speech`,modelId:this.modelId}),headers:Xl(this.config.headers(),e.headers),body:r,failedResponseHandler:Dm,successfulResponseHandler:vf(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:a,warnings:i,request:{body:JSON.stringify(r)},response:{timestamp:n,modelId:this.modelId,headers:o,body:s}}}},sg=X(()=>Z(I({text:A(),language:A().nullish(),duration:j().nullish(),words:F(I({word:A(),start:j(),end:j()})).nullish(),segments:F(I({id:j(),seek:j(),start:j(),end:j(),text:A(),tokens:F(j()),temperature:j(),avg_logprob:j(),compression_ratio:j(),no_speech_prob:j()})).nullish()}))),cg=X(()=>Z(I({include:F(A()).optional(),language:A().optional(),prompt:A().optional(),temperature:j().min(0).max(1).default(0).optional(),timestampGranularities:F(z([`word`,`segment`])).default([`segment`]).optional()}))),lg={afrikaans:`af`,arabic:`ar`,armenian:`hy`,azerbaijani:`az`,belarusian:`be`,bosnian:`bs`,bulgarian:`bg`,catalan:`ca`,chinese:`zh`,croatian:`hr`,czech:`cs`,danish:`da`,dutch:`nl`,english:`en`,estonian:`et`,finnish:`fi`,french:`fr`,galician:`gl`,german:`de`,greek:`el`,hebrew:`he`,hindi:`hi`,hungarian:`hu`,icelandic:`is`,indonesian:`id`,italian:`it`,japanese:`ja`,kannada:`kn`,kazakh:`kk`,korean:`ko`,latvian:`lv`,lithuanian:`lt`,macedonian:`mk`,malay:`ms`,marathi:`mr`,maori:`mi`,nepali:`ne`,norwegian:`no`,persian:`fa`,polish:`pl`,portuguese:`pt`,romanian:`ro`,russian:`ru`,serbian:`sr`,slovak:`sk`,slovenian:`sl`,spanish:`es`,swahili:`sw`,swedish:`sv`,tagalog:`tl`,tamil:`ta`,thai:`th`,turkish:`tr`,ukrainian:`uk`,urdu:`ur`,vietnamese:`vi`,welsh:`cy`},ug=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let r=[],i=await af({provider:`openai`,providerOptions:n,schema:cg}),a=new FormData,o=e instanceof Uint8Array?new Blob([e]):new Blob([iu(e)]);a.append(`model`,this.modelId);let s=Iu(t);if(a.append(`file`,new File([o],`audio`,{type:t}),`audio.${s}`),i){let e={include:i.include,language:i.language,prompt:i.prompt,response_format:[`gpt-4o-transcribe`,`gpt-4o-mini-transcribe`].includes(this.modelId)?`json`:`verbose_json`,temperature:i.temperature,timestamp_granularities:i.timestampGranularities};for(let[t,n]of Object.entries(e))if(n!=null)if(Array.isArray(n))for(let e of n)a.append(`${t}[]`,String(e));else a.append(t,String(n))}return{formData:a,warnings:r}}async doGenerate(e){var t;let n=((t=this.config._internal)?.currentDate)?.call(t)??new Date,{formData:r,warnings:i}=await this.getArgs(e),{value:a,responseHeaders:o,rawValue:s}=await cf({url:this.config.url({path:`/audio/transcriptions`,modelId:this.modelId}),headers:Xl(this.config.headers(),e.headers),formData:r,failedResponseHandler:Dm,successfulResponseHandler:_f(sg),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=a.language!=null&&a.language in lg?lg[a.language]:void 0;return{text:a.text,segments:a.segments?.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end}))??a.words?.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end}))??[],language:c,durationInSeconds:a.duration??void 0,warnings:i,response:{timestamp:n,modelId:this.modelId,headers:o,body:s}}}},dg=`3.0.14`;function fg(e={}){let t=yf(Fu({settingValue:e.baseURL,environmentVariableName:`OPENAI_BASE_URL`}))??`https://api.openai.com/v1`,n=e.name??`openai`,r=()=>Cu({Authorization:`Bearer ${Pu({apiKey:e.apiKey,environmentVariableName:`OPENAI_API_KEY`,description:`OpenAI`})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},`ai-sdk/openai/${dg}`),i=i=>new Lm(i,{provider:`${n}.chat`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),a=i=>new Gm(i,{provider:`${n}.completion`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),o=i=>new Jm(i,{provider:`${n}.embedding`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),s=i=>new $m(i,{provider:`${n}.image`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),c=i=>new ug(i,{provider:`${n}.transcription`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),l=i=>new og(i,{provider:`${n}.speech`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),u=e=>{if(new.target)throw Error(`The OpenAI model function cannot be called with the new keyword.`);return d(e)},d=i=>new Uh(i,{provider:`${n}.responses`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch,fileIdPrefixes:[`file-`]}),f=function(e){return u(e)};return f.specificationVersion=`v3`,f.languageModel=u,f.chat=i,f.completion=a,f.responses=d,f.embedding=o,f.embeddingModel=o,f.textEmbedding=o,f.textEmbeddingModel=o,f.image=s,f.imageModel=s,f.transcription=c,f.transcriptionModel=c,f.speech=l,f.speechModel=l,f.tools=jh,f}var pg=fg(),mg=e(((e,t)=>{var n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o=(e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})},s=(e,t,o,s)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let c of i(t))!a.call(e,c)&&c!==o&&n(e,c,{get:()=>t[c],enumerable:!(s=r(t,c))||s.enumerable});return e},c=e=>s(n({},`__esModule`,{value:!0}),e),l={};o(l,{SYMBOL_FOR_REQ_CONTEXT:()=>u,getContext:()=>d}),t.exports=c(l);let u=Symbol.for(`@vercel/request-context`);function d(){return globalThis[u]?.get?.()??{}}})),hg=e(((e,t)=>{var n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o=(e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})},s=(e,t,o,s)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let c of i(t))!a.call(e,c)&&c!==o&&n(e,c,{get:()=>t[c],enumerable:!(s=r(t,c))||s.enumerable});return e},c=e=>s(n({},`__esModule`,{value:!0}),e),l={};o(l,{getContext:()=>u.getContext,getVercelOidcToken:()=>d,getVercelOidcTokenSync:()=>f}),t.exports=c(l);var u=mg();async function d(){return``}function f(){return``}}))(),gg=Symbol.for(`vercel.ai.gateway.error`),_g,vg,yg=class e extends (vg=Error,_g=gg,vg){constructor({message:e,statusCode:t=500,cause:n,generationId:r}){super(r?`${e} [${r}]`:e),this[_g]=!0,this.statusCode=t,this.cause=n,this.generationId=r}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return typeof e==`object`&&!!e&&gg in e&&e[gg]===!0}},bg=`GatewayAuthenticationError`,xg=`vercel.ai.gateway.error.${bg}`,Sg=Symbol.for(xg),Cg,wg,Tg=class e extends (wg=yg,Cg=Sg,wg){constructor({message:e=`Authentication failed`,statusCode:t=401,cause:n,generationId:r}={}){super({message:e,statusCode:t,cause:n,generationId:r}),this[Cg]=!0,this.name=bg,this.type=`authentication_error`}static isInstance(e){return yg.hasMarker(e)&&Sg in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:n,message:r=`Authentication failed`,statusCode:i=401,cause:a,generationId:o}){let s;return s=t?`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:n?`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new e({message:s,statusCode:i,cause:a,generationId:o})}},Eg=`GatewayInvalidRequestError`,Dg=`vercel.ai.gateway.error.${Eg}`,Og=Symbol.for(Dg),kg,Ag,jg=class extends (Ag=yg,kg=Og,Ag){constructor({message:e=`Invalid request`,statusCode:t=400,cause:n,generationId:r}={}){super({message:e,statusCode:t,cause:n,generationId:r}),this[kg]=!0,this.name=Eg,this.type=`invalid_request_error`}static isInstance(e){return yg.hasMarker(e)&&Og in e}},Mg=`GatewayRateLimitError`,Ng=`vercel.ai.gateway.error.${Mg}`,Pg=Symbol.for(Ng),Fg,Ig,Lg=class extends (Ig=yg,Fg=Pg,Ig){constructor({message:e=`Rate limit exceeded`,statusCode:t=429,cause:n,generationId:r}={}){super({message:e,statusCode:t,cause:n,generationId:r}),this[Fg]=!0,this.name=Mg,this.type=`rate_limit_exceeded`}static isInstance(e){return yg.hasMarker(e)&&Pg in e}},Rg=`GatewayModelNotFoundError`,zg=`vercel.ai.gateway.error.${Rg}`,Bg=Symbol.for(zg),Vg=X(()=>Z(I({modelId:A()}))),Hg,Ug,Wg=class extends (Ug=yg,Hg=Bg,Ug){constructor({message:e=`Model not found`,statusCode:t=404,modelId:n,cause:r,generationId:i}={}){super({message:e,statusCode:t,cause:r,generationId:i}),this[Hg]=!0,this.name=Rg,this.type=`model_not_found`,this.modelId=n}static isInstance(e){return yg.hasMarker(e)&&Bg in e}},Gg=`GatewayInternalServerError`,Kg=`vercel.ai.gateway.error.${Gg}`,qg=Symbol.for(Kg),Jg,Yg,Xg=class extends (Yg=yg,Jg=qg,Yg){constructor({message:e=`Internal server error`,statusCode:t=500,cause:n,generationId:r}={}){super({message:e,statusCode:t,cause:n,generationId:r}),this[Jg]=!0,this.name=Gg,this.type=`internal_server_error`}static isInstance(e){return yg.hasMarker(e)&&qg in e}},Zg=`GatewayResponseError`,Qg=`vercel.ai.gateway.error.${Zg}`,$g=Symbol.for(Qg),e_,t_,n_=class extends (t_=yg,e_=$g,t_){constructor({message:e=`Invalid response from Gateway`,statusCode:t=502,response:n,validationError:r,cause:i,generationId:a}={}){super({message:e,statusCode:t,cause:i,generationId:a}),this[e_]=!0,this.name=Zg,this.type=`response_error`,this.response=n,this.validationError=r}static isInstance(e){return yg.hasMarker(e)&&$g in e}};async function r_({response:e,statusCode:t,defaultMessage:n=`Gateway request failed`,cause:r,authMethod:i}){let a=await $d({value:e,schema:i_});if(!a.success){let i=typeof e==`object`&&e&&`generationId`in e?e.generationId:void 0;return new n_({message:`Invalid error response format: ${n}`,statusCode:t,response:e,validationError:a.error,cause:r,generationId:i})}let o=a.value,s=o.error.type,c=o.error.message,l=o.generationId??void 0;switch(s){case`authentication_error`:return Tg.createContextualError({apiKeyProvided:i===`api-key`,oidcTokenProvided:i===`oidc`,statusCode:t,cause:r,generationId:l});case`invalid_request_error`:return new jg({message:c,statusCode:t,cause:r,generationId:l});case`rate_limit_exceeded`:return new Lg({message:c,statusCode:t,cause:r,generationId:l});case`model_not_found`:{let e=await $d({value:o.error.param,schema:Vg});return new Wg({message:c,statusCode:t,modelId:e.success?e.value.modelId:void 0,cause:r,generationId:l})}case`internal_server_error`:return new Xg({message:c,statusCode:t,cause:r,generationId:l});default:return new Xg({message:c,statusCode:t,cause:r,generationId:l})}}var i_=X(()=>Z(I({error:I({message:A(),type:A().nullish(),param:N().nullish(),code:L([A(),j()]).nullish()}),generationId:A().nullish()})));function a_(e,t){return yg.isInstance(e)?e:d.isInstance(e)?r_({response:o_(e),statusCode:e.statusCode??500,defaultMessage:`Gateway request failed`,cause:e,authMethod:t}):r_({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:`Unknown Gateway error`,cause:e,authMethod:t})}function o_(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var s_=`ai-gateway-auth-method`;async function c_(e){let t=await $d({value:e[s_],schema:l_});return t.success?t.value:void 0}var l_=X(()=>Z(L([B(`api-key`),B(`oidc`)]))),u_=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await Eu({url:`${this.config.baseURL}/config`,headers:await mf(this.config.headers()),successfulResponseHandler:_f(d_),failedResponseHandler:hf({errorSchema:Os(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw await a_(e)}}async getCredits(){try{let{value:e}=await Eu({url:`${new URL(this.config.baseURL).origin}/v1/credits`,headers:await mf(this.config.headers()),successfulResponseHandler:_f(f_),failedResponseHandler:hf({errorSchema:Os(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw await a_(e)}}},d_=X(()=>Z(I({models:F(I({id:A(),name:A(),description:A().nullish(),pricing:I({input:A(),output:A(),input_cache_read:A().nullish(),input_cache_write:A().nullish()}).transform(({input:e,output:t,input_cache_read:n,input_cache_write:r})=>({input:e,output:t,...n?{cachedInputTokens:n}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:I({specificationVersion:B(`v3`),provider:A(),modelId:A()}),modelType:z([`language`,`embedding`,`image`]).nullish()}))}))),f_=X(()=>Z(I({balance:A(),total_used:A()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),p_=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`,this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...n}=e;return{args:this.maybeEncodeFileParts(n),warnings:[]}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:r}=e,i=await mf(this.config.headers());try{let{responseHeaders:a,value:o,rawValue:s}=await sf({url:this.getUrl(),headers:Xl(i,e.headers,this.getModelConfigHeaders(this.modelId,!1),await mf(this.config.o11yHeaders)),body:t,successfulResponseHandler:_f(Os()),failedResponseHandler:hf({errorSchema:Os(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...o,request:{body:t},response:{headers:a,body:s},warnings:n}}catch(e){throw await a_(e,await c_(i))}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:r}=e,i=await mf(this.config.headers());try{let{value:a,responseHeaders:o}=await sf({url:this.getUrl(),headers:Xl(i,e.headers,this.getModelConfigHeaders(this.modelId,!0),await mf(this.config.o11yHeaders)),body:t,successfulResponseHandler:gf(Os()),failedResponseHandler:hf({errorSchema:Os(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:a.pipeThrough(new TransformStream({start(e){n.length>0&&e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(t.success){let r=t.value;if(r.type===`raw`&&!e.includeRawChunks)return;r.type===`response-metadata`&&r.timestamp&&typeof r.timestamp==`string`&&(r.timestamp=new Date(r.timestamp)),n.enqueue(r)}else n.error(t.error)}})),request:{body:t},response:{headers:o}}}catch(e){throw await a_(e,await c_(i))}}isFilePart(e){return e&&typeof e==`object`&&`type`in e&&e.type===`file`}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)){let t=e;if(t.data instanceof Uint8Array){let e=Uint8Array.from(t.data),n=Buffer.from(e).toString(`base64`);t.data=new URL(`data:${t.mediaType||`application/octet-stream`};base64,${n}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":`3`,"ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},m_=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){let i=await mf(this.config.headers());try{let{responseHeaders:a,value:o,rawValue:s}=await sf({url:this.getUrl(),headers:Xl(i,t??{},this.getModelConfigHeaders(),await mf(this.config.o11yHeaders)),body:{values:e,...r?{providerOptions:r}:{}},successfulResponseHandler:_f(h_),failedResponseHandler:hf({errorSchema:Os(),errorToMessage:e=>e}),...n&&{abortSignal:n},fetch:this.config.fetch});return{embeddings:o.embeddings,usage:o.usage??void 0,providerMetadata:o.providerMetadata,response:{headers:a,body:s},warnings:[]}}catch(e){throw await a_(e,await c_(i))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":`3`,"ai-model-id":this.modelId}}},h_=X(()=>Z(I({embeddings:F(F(j())),usage:I({tokens:j()}).nullish(),providerMetadata:Hs(A(),Hs(A(),N())).optional()}))),g_=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`,this.maxImagesPerCall=2**53-1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:i,files:a,mask:o,providerOptions:s,headers:c,abortSignal:l}){let u=await mf(this.config.headers());try{let{responseHeaders:d,value:f,rawValue:p}=await sf({url:this.getUrl(),headers:Xl(u,c??{},this.getModelConfigHeaders(),await mf(this.config.o11yHeaders)),body:{prompt:e,n:t,...n&&{size:n},...r&&{aspectRatio:r},...i&&{seed:i},...s&&{providerOptions:s},...a&&{files:a.map(e=>__(e))},...o&&{mask:__(o)}},successfulResponseHandler:_f(y_),failedResponseHandler:hf({errorSchema:Os(),errorToMessage:e=>e}),...l&&{abortSignal:l},fetch:this.config.fetch});return{images:f.images,warnings:f.warnings??[],providerMetadata:f.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:d}}}catch(e){throw a_(e,await c_(u))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":`3`,"ai-model-id":this.modelId}}};function __(e){return e.type===`file`&&e.data instanceof Uint8Array?{...e,data:au(e.data)}:e}var v_=I({images:F(N()).optional()}).catchall(N()),y_=I({images:F(A()),warnings:F(I({type:B(`other`),message:A()})).optional(),providerMetadata:Hs(A(),v_).optional()}),b_=pf({id:`gateway.perplexity_search`,inputSchema:X(()=>Z(I({query:L([A(),F(A())]).describe(`Search query (string) or multiple queries (array of up to 5 strings). Multi-query searches return combined results from all queries.`),max_results:j().optional().describe(`Maximum number of search results to return (1-20, default: 10)`),max_tokens_per_page:j().optional().describe(`Maximum number of tokens to extract per search result page (256-2048, default: 2048)`),max_tokens:j().optional().describe(`Maximum total tokens across all search results (default: 25000, max: 1000000)`),country:A().optional().describe(`Two-letter ISO 3166-1 alpha-2 country code for regional search results (e.g., 'US', 'GB', 'FR')`),search_domain_filter:F(A()).optional().describe(`List of domains to include or exclude from search results (max 20). To include: ['nature.com', 'science.org']. To exclude: ['-example.com', '-spam.net']`),search_language_filter:F(A()).optional().describe(`List of ISO 639-1 language codes to filter results (max 10, lowercase). Examples: ['en', 'fr', 'de']`),search_after_date:A().optional().describe(`Include only results published after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter.`),search_before_date:A().optional().describe(`Include only results published before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter.`),last_updated_after_filter:A().optional().describe(`Include only results last updated after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter.`),last_updated_before_filter:A().optional().describe(`Include only results last updated before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter.`),search_recency_filter:z([`day`,`week`,`month`,`year`]).optional().describe(`Filter results by relative time period. Cannot be used with search_after_date or search_before_date.`)}))),outputSchema:X(()=>Z(L([I({results:F(I({title:A(),url:A(),snippet:A(),date:A().optional(),lastUpdated:A().optional()})),id:A()}),I({error:z([`api_error`,`rate_limit`,`timeout`,`invalid_input`,`unknown`]),statusCode:j().optional(),message:A()})])))}),x_={perplexitySearch:(e={})=>b_(e)};async function S_(){return(0,hg.getContext)().headers?.[`x-vercel-id`]}var C_=`3.0.19`,w_=`0.0.1`;function T_(e={}){let t=null,n=null,r=e.metadataCacheRefreshMillis??1e3*60*5,i=0,a=yf(e.baseURL)??`https://ai-gateway.vercel.sh/v3/ai`,o=async()=>{try{let t=await D_(e);return Cu({Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":w_,[s_]:t.authMethod,...e.headers},`ai-sdk/gateway/${C_}`)}catch(e){throw Tg.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401,cause:e})}},s=()=>{let e=Fu({settingValue:void 0,environmentVariableName:`VERCEL_DEPLOYMENT_ID`}),t=Fu({settingValue:void 0,environmentVariableName:`VERCEL_ENV`}),n=Fu({settingValue:void 0,environmentVariableName:`VERCEL_REGION`});return async()=>{let r=await S_();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...n&&{"ai-o11y-region":n},...r&&{"ai-o11y-request-id":r}}}},c=t=>new p_(t,{provider:`gateway`,baseURL:a,headers:o,fetch:e.fetch,o11yHeaders:s()}),l=async()=>{var s;let c=((s=e._internal)?.currentDate)?.call(s).getTime()??Date.now();return(!t||c-i>r)&&(i=c,t=new u_({baseURL:a,headers:o,fetch:e.fetch}).getAvailableModels().then(e=>(n=e,e)).catch(async e=>{throw await a_(e,await c_(await o()))})),n?Promise.resolve(n):t},u=async()=>new u_({baseURL:a,headers:o,fetch:e.fetch}).getCredits().catch(async e=>{throw await a_(e,await c_(await o()))}),d=function(e){if(new.target)throw Error(`The Gateway Provider model function cannot be called with the new keyword.`);return c(e)};d.specificationVersion=`v3`,d.getAvailableModels=l,d.getCredits=u,d.imageModel=t=>new g_(t,{provider:`gateway`,baseURL:a,headers:o,fetch:e.fetch,o11yHeaders:s()}),d.languageModel=c;let f=t=>new m_(t,{provider:`gateway`,baseURL:a,headers:o,fetch:e.fetch,o11yHeaders:s()});return d.embeddingModel=f,d.textEmbeddingModel=f,d.tools=x_,d}var E_=T_();async function D_(e){let t=Fu({settingValue:e.apiKey,environmentVariableName:`AI_GATEWAY_API_KEY`});return t?{token:t,authMethod:`api-key`}:{token:await(0,hg.getVercelOidcToken)(),authMethod:`oidc`}}var O_=typeof globalThis==`object`?globalThis:typeof self==`object`?self:typeof window==`object`?window:typeof global==`object`?global:{},k_=`1.9.0`,A_=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function j_(e){var t=new Set([e]),n=new Set,r=e.match(A_);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(t){return t===e};function a(e){return n.add(e),!1}function o(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(A_);if(!r)return a(e);var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};return s.prerelease!=null||i.major!==s.major?a(e):i.major===0?i.minor===s.minor&&i.patch<=s.patch?o(e):a(e):i.minor<=s.minor?o(e):a(e)}}var M_=j_(k_),N_=k_.split(`.`)[0],P_=Symbol.for(`opentelemetry.js.api.`+N_),F_=O_;function I_(e,t,n,r){r===void 0&&(r=!1);var i=F_[P_]=F_[P_]??{version:k_};if(!r&&i[e]){var a=Error(`@opentelemetry/api: Attempted duplicate registration of API: `+e);return n.error(a.stack||a.message),!1}if(i.version!==k_){var a=Error(`@opentelemetry/api: Registration of version v`+i.version+` for `+e+` does not match previously registered API v`+k_);return n.error(a.stack||a.message),!1}return i[e]=t,n.debug(`@opentelemetry/api: Registered a global for `+e+` v`+k_+`.`),!0}function L_(e){var t=F_[P_]?.version;if(!(!t||!M_(t)))return F_[P_]?.[e]}function R_(e,t){t.debug(`@opentelemetry/api: Unregistering a global for `+e+` v`+k_+`.`);var n=F_[P_];n&&delete n[e]}var z_=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},B_=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},V_=function(){function e(e){this._namespace=e.namespace||`DiagComponentLogger`}return e.prototype.debug=function(){var e=[...arguments];return H_(`debug`,this._namespace,e)},e.prototype.error=function(){var e=[...arguments];return H_(`error`,this._namespace,e)},e.prototype.info=function(){var e=[...arguments];return H_(`info`,this._namespace,e)},e.prototype.warn=function(){var e=[...arguments];return H_(`warn`,this._namespace,e)},e.prototype.verbose=function(){var e=[...arguments];return H_(`verbose`,this._namespace,e)},e}();function H_(e,t,n){var r=L_(`diag`);if(r)return n.unshift(t),r[e].apply(r,B_([],z_(n),!1))}var U_;(function(e){e[e.NONE=0]=`NONE`,e[e.ERROR=30]=`ERROR`,e[e.WARN=50]=`WARN`,e[e.INFO=60]=`INFO`,e[e.DEBUG=70]=`DEBUG`,e[e.VERBOSE=80]=`VERBOSE`,e[e.ALL=9999]=`ALL`})(U_||={});function W_(e,t){e<U_.NONE?e=U_.NONE:e>U_.ALL&&(e=U_.ALL),t||={};function n(n,r){var i=t[n];return typeof i==`function`&&e>=r?i.bind(t):function(){}}return{error:n(`error`,U_.ERROR),warn:n(`warn`,U_.WARN),info:n(`info`,U_.INFO),debug:n(`debug`,U_.DEBUG),verbose:n(`verbose`,U_.VERBOSE)}}var G_=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},K_=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},q_=`diag`,J_=function(){function e(){function e(e){return function(){var t=[...arguments],n=L_(`diag`);if(n)return n[e].apply(n,K_([],G_(t),!1))}}var t=this;t.setLogger=function(e,n){if(n===void 0&&(n={logLevel:U_.INFO}),e===t){var r=Error(`Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation`);return t.error(r.stack??r.message),!1}typeof n==`number`&&(n={logLevel:n});var i=L_(`diag`),a=W_(n.logLevel??U_.INFO,e);if(i&&!n.suppressOverrideMessage){var o=Error().stack??`<failed to generate stacktrace>`;i.warn(`Current logger will be overwritten from `+o),a.warn(`Current logger will overwrite one already registered from `+o)}return I_(`diag`,a,t,!0)},t.disable=function(){R_(q_,t)},t.createComponentLogger=function(e){return new V_(e)},t.verbose=e(`verbose`),t.debug=e(`debug`),t.info=e(`info`),t.warn=e(`warn`),t.error=e(`error`)}return e.instance=function(){return this._instance||=new e,this._instance},e}();function Y_(e){return Symbol.for(e)}var X_=new(function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var i=new e(n._currentContext);return i._currentContext.set(t,r),i},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}}return e}()),Z_=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Q_=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},$_=function(){function e(){}return e.prototype.active=function(){return X_},e.prototype.with=function(e,t,n){var r=[...arguments].slice(3);return t.call.apply(t,Q_([n],Z_(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),ev=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},tv=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},nv=`context`,rv=new $_,iv=function(){function e(){}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalContextManager=function(e){return I_(nv,e,J_.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,i=[],a=3;a<arguments.length;a++)i[a-3]=arguments[a];return(r=this._getContextManager()).with.apply(r,tv([e,t,n],ev(i),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return L_(nv)||rv},e.prototype.disable=function(){this._getContextManager().disable(),R_(nv,J_.instance())},e}(),av;(function(e){e[e.NONE=0]=`NONE`,e[e.SAMPLED=1]=`SAMPLED`})(av||={});var ov=`0000000000000000`,sv=`00000000000000000000000000000000`,cv={traceId:sv,spanId:ov,traceFlags:av.NONE},lv=function(){function e(e){e===void 0&&(e=cv),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),uv=Y_(`OpenTelemetry Context Key SPAN`);function dv(e){return e.getValue(uv)||void 0}function fv(){return dv(iv.getInstance().active())}function pv(e,t){return e.setValue(uv,t)}function mv(e){return e.deleteValue(uv)}function hv(e,t){return pv(e,new lv(t))}function gv(e){return dv(e)?.spanContext()}var _v=/^([0-9a-f]{32})$/i,vv=/^[0-9a-f]{16}$/i;function yv(e){return _v.test(e)&&e!==sv}function bv(e){return vv.test(e)&&e!==ov}function xv(e){return yv(e.traceId)&&bv(e.spanId)}function Sv(e){return new lv(e)}var Cv=iv.getInstance(),wv=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(n===void 0&&(n=Cv.active()),t?.root)return new lv;var r=n&&gv(n);return Tv(r)&&xv(r)?new lv(r):new lv},e.prototype.startActiveSpan=function(e,t,n,r){var i,a,o;if(!(arguments.length<2)){arguments.length===2?o=t:arguments.length===3?(i=t,o=n):(i=t,a=n,o=r);var s=a??Cv.active(),c=this.startSpan(e,i,s),l=pv(s,c);return Cv.with(l,o,void 0,c)}},e}();function Tv(e){return typeof e==`object`&&typeof e.spanId==`string`&&typeof e.traceId==`string`&&typeof e.traceFlags==`number`}var Ev=new wv,Dv=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Ev},e}(),Ov=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new wv},e}()),kv=function(){function e(){}return e.prototype.getTracer=function(e,t,n){return this.getDelegateTracer(e,t,n)??new Dv(this,e,t,n)},e.prototype.getDelegate=function(){return this._delegate??Ov},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){return this._delegate?.getTracer(e,t,n)},e}(),Av;(function(e){e[e.UNSET=0]=`UNSET`,e[e.OK=1]=`OK`,e[e.ERROR=2]=`ERROR`})(Av||={});var jv=iv.getInstance(),Mv=`trace`,Nv=function(){function e(){this._proxyTracerProvider=new kv,this.wrapSpanContext=Sv,this.isSpanContextValid=xv,this.deleteSpan=mv,this.getSpan=dv,this.getActiveSpan=fv,this.getSpanContext=gv,this.setSpan=pv,this.setSpanContext=hv}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=I_(Mv,this._proxyTracerProvider,J_.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return L_(Mv)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){R_(Mv,J_.instance()),this._proxyTracerProvider=new kv},e}().getInstance(),Pv=Object.defineProperty,Fv=(e,t)=>{for(var n in t)Pv(e,n,{get:t[n],enumerable:!0})},Iv=`AI_InvalidArgumentError`,Lv=`vercel.ai.error.${Iv}`,Rv=Symbol.for(Lv),zv,Bv=class extends a{constructor({parameter:e,value:t,message:n}){super({name:Iv,message:`Invalid argument for parameter ${e}: ${n}`}),this[zv]=!0,this.parameter=e,this.value=t}static isInstance(e){return a.hasMarker(e,Lv)}};zv=Rv;var Vv=`AI_InvalidStreamPartError`,Hv=`vercel.ai.error.${Vv}`,Uv=Symbol.for(Hv),Wv,Gv=class extends a{constructor({chunk:e,message:t}){super({name:Vv,message:t}),this[Wv]=!0,this.chunk=e}static isInstance(e){return a.hasMarker(e,Hv)}};Wv=Uv;var Kv=`AI_InvalidToolApprovalError`,qv=`vercel.ai.error.${Kv}`,Jv=Symbol.for(qv),Yv,Xv=class extends a{constructor({approvalId:e}){super({name:Kv,message:`Tool approval response references unknown approvalId: "${e}". No matching tool-approval-request found in message history.`}),this[Yv]=!0,this.approvalId=e}static isInstance(e){return a.hasMarker(e,qv)}};Yv=Jv;var Zv=`AI_InvalidToolInputError`,Qv=`vercel.ai.error.${Zv}`,$v=Symbol.for(Qv),ey,ty=class extends a{constructor({toolInput:e,toolName:t,cause:n,message:r=`Invalid input for tool ${t}: ${v(n)}`}){super({name:Zv,message:r,cause:n}),this[ey]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return a.hasMarker(e,Qv)}};ey=$v;var ny=`AI_ToolCallNotFoundForApprovalError`,ry=`vercel.ai.error.${ny}`,iy=Symbol.for(ry),ay,oy=class extends a{constructor({toolCallId:e,approvalId:t}){super({name:ny,message:`Tool call "${e}" not found for approval request "${t}".`}),this[ay]=!0,this.toolCallId=e,this.approvalId=t}static isInstance(e){return a.hasMarker(e,ry)}};ay=iy;var sy=`AI_MissingToolResultsError`,cy=`vercel.ai.error.${sy}`,ly=Symbol.for(cy),uy,dy=class extends a{constructor({toolCallIds:e}){super({name:sy,message:`Tool result${e.length>1?`s are`:` is`} missing for tool call${e.length>1?`s`:``} ${e.join(`, `)}.`}),this[uy]=!0,this.toolCallIds=e}static isInstance(e){return a.hasMarker(e,cy)}};uy=ly;var fy=`AI_NoImageGeneratedError`,py=`vercel.ai.error.${fy}`,my=Symbol.for(py),hy,gy=class extends a{constructor({message:e=`No image generated.`,cause:t,responses:n}){super({name:fy,message:e,cause:t}),this[hy]=!0,this.responses=n}static isInstance(e){return a.hasMarker(e,py)}};hy=my;var _y=`AI_NoObjectGeneratedError`,vy=`vercel.ai.error.${_y}`,yy=Symbol.for(vy),by,xy=class extends a{constructor({message:e=`No object generated.`,cause:t,text:n,response:r,usage:i,finishReason:a}){super({name:_y,message:e,cause:t}),this[by]=!0,this.text=n,this.response=r,this.usage=i,this.finishReason=a}static isInstance(e){return a.hasMarker(e,vy)}};by=yy;var Sy=`AI_NoOutputGeneratedError`,Cy=`vercel.ai.error.${Sy}`,wy=Symbol.for(Cy),Ty,Ey=class extends a{constructor({message:e=`No output generated.`,cause:t}={}){super({name:Sy,message:e,cause:t}),this[Ty]=!0}static isInstance(e){return a.hasMarker(e,Cy)}};Ty=wy;var Dy=class extends a{constructor(e){super({name:`AI_NoSpeechGeneratedError`,message:`No speech audio generated.`}),this.responses=e.responses}},Oy=`AI_NoSuchToolError`,ky=`vercel.ai.error.${Oy}`,Ay=Symbol.for(ky),jy,My=class extends a{constructor({toolName:e,availableTools:t=void 0,message:n=`Model tried to call unavailable tool '${e}'. ${t===void 0?`No tools are available.`:`Available tools: ${t.join(`, `)}.`}`}){super({name:Oy,message:n}),this[jy]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return a.hasMarker(e,ky)}};jy=Ay;var Ny=`AI_ToolCallRepairError`,Py=`vercel.ai.error.${Ny}`,Fy=Symbol.for(Py),Iy,Ly=class extends a{constructor({cause:e,originalError:t,message:n=`Error repairing tool call: ${v(e)}`}){super({name:Ny,message:n,cause:e}),this[Iy]=!0,this.originalError=t}static isInstance(e){return a.hasMarker(e,Py)}};Iy=Fy;var Ry=class extends a{constructor(e){super({name:`AI_UnsupportedModelVersionError`,message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},zy=`AI_UIMessageStreamError`,By=`vercel.ai.error.${zy}`,Vy=Symbol.for(By),Hy,Uy=class extends a{constructor({chunkType:e,chunkId:t,message:n}){super({name:zy,message:n}),this[Hy]=!0,this.chunkType=e,this.chunkId=t}static isInstance(e){return a.hasMarker(e,By)}};Hy=Vy;var Wy=`AI_InvalidDataContentError`,Gy=`vercel.ai.error.${Wy}`,Ky=Symbol.for(Gy),qy,Jy=class extends a{constructor({content:e,cause:t,message:n=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:Wy,message:n,cause:t}),this[qy]=!0,this.content=e}static isInstance(e){return a.hasMarker(e,Gy)}};qy=Ky;var Yy=`AI_InvalidMessageRoleError`,Xy=`vercel.ai.error.${Yy}`,Zy=Symbol.for(Xy),Qy,$y=class extends a{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Yy,message:t}),this[Qy]=!0,this.role=e}static isInstance(e){return a.hasMarker(e,Xy)}};Qy=Zy;var eb=`AI_MessageConversionError`,tb=`vercel.ai.error.${eb}`,nb=Symbol.for(tb),rb,ib=class extends a{constructor({originalMessage:e,message:t}){super({name:eb,message:t}),this[rb]=!0,this.originalMessage=e}static isInstance(e){return a.hasMarker(e,tb)}};rb=nb;var ab=`AI_RetryError`,ob=`vercel.ai.error.${ab}`,sb=Symbol.for(ob),cb,lb=class extends a{constructor({message:e,reason:t,errors:n}){super({name:ab,message:e}),this[cb]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return a.hasMarker(e,ob)}};cb=sb;function ub({warning:e,provider:t,model:n}){let r=`AI SDK Warning (${t} / ${n}):`;switch(e.type){case`unsupported`:{let t=`${r} The feature "${e.feature}" is not supported.`;return e.details&&(t+=` ${e.details}`),t}case`compatibility`:{let t=`${r} The feature "${e.feature}" is used in a compatibility mode.`;return e.details&&(t+=` ${e.details}`),t}case`other`:return`${r} ${e.message}`;default:return`${r} ${JSON.stringify(e,null,2)}`}}var db=`AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.`,fb=!1,pb=e=>{if(e.warnings.length===0)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t==`function`){t(e);return}fb||(fb=!0,console.info(db));for(let t of e.warnings)console.warn(ub({warning:t,provider:e.provider,model:e.model}))}};function mb({provider:e,modelId:t}){pb({warnings:[{type:`compatibility`,feature:`specificationVersion`,details:`Using v2 specification compatibility mode. Some features may not be available.`}],provider:e,model:t})}function hb(e){return e.specificationVersion===`v3`?e:(mb({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function gb(e){return e.specificationVersion===`v3`?e:(mb({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function _b(e){return e.specificationVersion===`v3`?e:(mb({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){switch(t){case`specificationVersion`:return`v3`;case`doGenerate`:return async(...t)=>{let n=await e.doGenerate(...t);return{...n,finishReason:yb(n.finishReason),usage:bb(n.usage)}};case`doStream`:return async(...t)=>{let n=await e.doStream(...t);return{...n,stream:vb(n.stream)}};default:return e[t]}}}))}function vb(e){return e.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case`finish`:t.enqueue({...e,finishReason:yb(e.finishReason),usage:bb(e.usage)});break;default:t.enqueue(e);break}}}))}function yb(e){return{unified:e===`unknown`?`other`:e,raw:void 0}}function bb(e){return{inputTokens:{total:e.inputTokens,noCache:void 0,cacheRead:e.cachedInputTokens,cacheWrite:void 0},outputTokens:{total:e.outputTokens,text:void 0,reasoning:e.reasoningTokens}}}function xb(e){return e.specificationVersion===`v3`?e:(mb({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function Sb(e){return e.specificationVersion===`v3`?e:(mb({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function Cb(e){if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new Ry({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return _b(e)}return Ob().languageModel(e)}function wb(e){if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new Ry({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return hb(e)}return Ob().embeddingModel(e)}function Tb(e){var t;if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new Ry({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return Sb(e)}return(t=Ob()).transcriptionModel?.call(t,e)}function Eb(e){var t;if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new Ry({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return xb(e)}return(t=Ob()).speechModel?.call(t,e)}function Db(e){if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new Ry({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return gb(e)}return Ob().imageModel(e)}function Ob(){return globalThis.AI_SDK_DEFAULT_PROVIDER??E_}function kb(e){if(e!=null)return typeof e==`number`?e:e.totalMs}function Ab(e){if(!(e==null||typeof e==`number`))return e.stepMs}function jb(e){if(!(e==null||typeof e==`number`))return e.chunkMs}var Mb=[{mediaType:`image/gif`,bytesPrefix:[71,73,70]},{mediaType:`image/png`,bytesPrefix:[137,80,78,71]},{mediaType:`image/jpeg`,bytesPrefix:[255,216]},{mediaType:`image/webp`,bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:`image/bmp`,bytesPrefix:[66,77]},{mediaType:`image/tiff`,bytesPrefix:[73,73,42,0]},{mediaType:`image/tiff`,bytesPrefix:[77,77,0,42]},{mediaType:`image/avif`,bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:`image/heic`,bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],Nb=[{mediaType:`audio/mpeg`,bytesPrefix:[255,251]},{mediaType:`audio/mpeg`,bytesPrefix:[255,250]},{mediaType:`audio/mpeg`,bytesPrefix:[255,243]},{mediaType:`audio/mpeg`,bytesPrefix:[255,242]},{mediaType:`audio/mpeg`,bytesPrefix:[255,227]},{mediaType:`audio/mpeg`,bytesPrefix:[255,226]},{mediaType:`audio/wav`,bytesPrefix:[82,73,70,70,null,null,null,null,87,65,86,69]},{mediaType:`audio/ogg`,bytesPrefix:[79,103,103,83]},{mediaType:`audio/flac`,bytesPrefix:[102,76,97,67]},{mediaType:`audio/aac`,bytesPrefix:[64,21,0,0]},{mediaType:`audio/mp4`,bytesPrefix:[102,116,121,112]},{mediaType:`audio/webm`,bytesPrefix:[26,69,223,163]}],Pb=e=>{let t=typeof e==`string`?iu(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)};function Fb(e){return typeof e==`string`&&e.startsWith(`SUQz`)||typeof e!=`string`&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Pb(e):e}function Ib({data:e,signatures:t}){let n=Fb(e),r=typeof n==`string`?iu(n.substring(0,Math.min(n.length,24))):n;for(let e of t)if(r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>e===null||r[t]===e))return e.mediaType}var Lb=`6.0.45`,Rb=async({url:e})=>{let t=e.toString();try{let e=await fetch(t,{headers:Cu({},`ai-sdk/${Lb}`,xu())});if(!e.ok)throw new pu({url:t,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:e.headers.get(`content-type`)??void 0}}catch(e){throw pu.isInstance(e)?e:new pu({url:t,cause:e})}},zb=(e=Rb)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t)));function Bb(e){try{let[t,n]=e.split(`,`);return{mediaType:t.split(`;`)[0].split(`:`)[1],base64Content:n}}catch{return{mediaType:void 0,base64Content:void 0}}}var Vb=L([A(),_c(Uint8Array),_c(ArrayBuffer),mc(e=>globalThis.Buffer?.isBuffer(e)??!1,{message:`Must be a Buffer`})]);function Hb(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e==`string`)try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol===`data:`){let{mediaType:t,base64Content:n}=Bb(e.toString());if(t==null||n==null)throw new a({name:`InvalidDataContentError`,message:`Invalid data URL format in content ${e.toString()}`});return{data:n,mediaType:t}}return{data:e,mediaType:void 0}}function Ub(e){return typeof e==`string`?e:e instanceof ArrayBuffer?au(new Uint8Array(e)):au(e)}function Wb(e){if(e instanceof Uint8Array)return e;if(typeof e==`string`)try{return iu(e)}catch(t){throw new Jy({message:`Invalid data content. Content string is not a base64-encoded media.`,content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Jy({content:e})}function Gb(e){return e===void 0?[]:Array.isArray(e)?e:[e]}async function Kb({prompt:e,supportedUrls:t,download:n=zb()}){let r=await Jb(e.messages,n,t),i=new Map;for(let t of e.messages)if(t.role===`assistant`&&Array.isArray(t.content))for(let e of t.content)e.type===`tool-approval-request`&&`approvalId`in e&&`toolCallId`in e&&i.set(e.approvalId,e.toolCallId);let a=new Set;for(let t of e.messages)if(t.role===`tool`){for(let e of t.content)if(e.type===`tool-approval-response`){let t=i.get(e.approvalId);t&&a.add(t)}}let o=[...e.system==null?[]:typeof e.system==`string`?[{role:`system`,content:e.system}]:Gb(e.system).map(e=>({role:`system`,content:e.content,providerOptions:e.providerOptions})),...e.messages.map(e=>qb({message:e,downloadedAssets:r}))],s=[];for(let e of o){if(e.role!==`tool`){s.push(e);continue}let t=s.at(-1);t?.role===`tool`?t.content.push(...e.content):s.push(e)}let c=new Set;for(let e of s)switch(e.role){case`assistant`:for(let t of e.content)t.type===`tool-call`&&!t.providerExecuted&&c.add(t.toolCallId);break;case`tool`:for(let t of e.content)t.type===`tool-result`&&c.delete(t.toolCallId);break;case`user`:case`system`:for(let e of a)c.delete(e);if(c.size>0)throw new dy({toolCallIds:Array.from(c)});break}for(let e of a)c.delete(e);if(c.size>0)throw new dy({toolCallIds:Array.from(c)});return s.filter(e=>e.role!==`tool`||e.content.length>0)}function qb({message:e,downloadedAssets:t}){let n=e.role;switch(n){case`system`:return{role:`system`,content:e.content,providerOptions:e.providerOptions};case`user`:return typeof e.content==`string`?{role:`user`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`user`,content:e.content.map(e=>Yb(e,t)).filter(e=>e.type!==`text`||e.text!==``),providerOptions:e.providerOptions};case`assistant`:return typeof e.content==`string`?{role:`assistant`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`assistant`,content:e.content.filter(e=>e.type!==`text`||e.text!==``||e.providerOptions!=null).filter(e=>e.type!==`tool-approval-request`).map(e=>{let t=e.providerOptions;switch(e.type){case`file`:{let{data:n,mediaType:r}=Hb(e.data);return{type:`file`,data:n,filename:e.filename,mediaType:r??e.mediaType,providerOptions:t}}case`reasoning`:return{type:`reasoning`,text:e.text,providerOptions:t};case`text`:return{type:`text`,text:e.text,providerOptions:t};case`tool-call`:return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:Xb(e.output),providerOptions:t}}}),providerOptions:e.providerOptions};case`tool`:return{role:`tool`,content:e.content.filter(e=>e.type!==`tool-approval-response`||e.providerExecuted).map(e=>{switch(e.type){case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:Xb(e.output),providerOptions:e.providerOptions};case`tool-approval-response`:return{type:`tool-approval-response`,approvalId:e.approvalId,approved:e.approved,reason:e.reason}}}),providerOptions:e.providerOptions};default:throw new $y({role:n})}}async function Jb(e,t,n){let r=e.filter(e=>e.role===`user`).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>e.type===`image`||e.type===`file`).map(e=>{let t=e.mediaType??(e.type===`image`?`image/*`:void 0),n=e.type===`image`?e.image:e.data;if(typeof n==`string`)try{n=new URL(n)}catch{}return{mediaType:t,data:n}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:e.mediaType!=null&&Nu({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:n})})),i=await t(r);return Object.fromEntries(i.map((e,t)=>e==null?null:[r[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>e!=null))}function Yb(e,t){if(e.type===`text`)return{type:`text`,text:e.text,providerOptions:e.providerOptions};let n,r=e.type;switch(r){case`image`:n=e.image;break;case`file`:n=e.data;break;default:throw Error(`Unsupported part type: ${r}`)}let{data:i,mediaType:a}=Hb(n),o=a??e.mediaType,s=i;if(s instanceof URL){let e=t[s.toString()];e&&(s=e.data,o??=e.mediaType)}switch(r){case`image`:return(s instanceof Uint8Array||typeof s==`string`)&&(o=Ib({data:s,signatures:Mb})??o),{type:`file`,mediaType:o??`image/*`,filename:void 0,data:s,providerOptions:e.providerOptions};case`file`:if(o==null)throw Error(`Media type is missing for file part`);return{type:`file`,mediaType:o,filename:e.filename,data:s,providerOptions:e.providerOptions}}}function Xb(e){return e.type===`content`?{type:`content`,value:e.value.map(e=>e.type===`media`?e.mediaType.startsWith(`image/`)?{type:`image-data`,data:e.data,mediaType:e.mediaType}:{type:`file-data`,data:e.data,mediaType:e.mediaType}:e)}:e}async function Zb({toolCallId:e,input:t,output:n,tool:r,errorMode:i}){return i===`text`?{type:`error-text`,value:v(n)}:i===`json`?{type:`error-json`,value:Qb(n)}:r?.toModelOutput?await r.toModelOutput({toolCallId:e,input:t,output:n}):typeof n==`string`?{type:`text`,value:n}:{type:`json`,value:Qb(n)}}function Qb(e){return e===void 0?null:e}function $b({maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,seed:o,stopSequences:s}){if(e!=null){if(!Number.isInteger(e))throw new Bv({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be an integer`});if(e<1)throw new Bv({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be >= 1`})}if(t!=null&&typeof t!=`number`)throw new Bv({parameter:`temperature`,value:t,message:`temperature must be a number`});if(n!=null&&typeof n!=`number`)throw new Bv({parameter:`topP`,value:n,message:`topP must be a number`});if(r!=null&&typeof r!=`number`)throw new Bv({parameter:`topK`,value:r,message:`topK must be a number`});if(i!=null&&typeof i!=`number`)throw new Bv({parameter:`presencePenalty`,value:i,message:`presencePenalty must be a number`});if(a!=null&&typeof a!=`number`)throw new Bv({parameter:`frequencyPenalty`,value:a,message:`frequencyPenalty must be a number`});if(o!=null&&!Number.isInteger(o))throw new Bv({parameter:`seed`,value:o,message:`seed must be an integer`});return{maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,stopSequences:s,seed:o}}function ex(e){return e!=null&&Object.keys(e).length>0}async function tx({tools:e,toolChoice:t,activeTools:n}){if(!ex(e))return{tools:void 0,toolChoice:void 0};let r=n==null?Object.entries(e):Object.entries(e).filter(([e])=>n.includes(e)),i=[];for(let[e,t]of r){let n=t.type;switch(n){case void 0:case`dynamic`:case`function`:i.push({type:`function`,name:e,description:t.description,inputSchema:await qd(t.inputSchema).jsonSchema,...t.inputExamples==null?{}:{inputExamples:t.inputExamples},providerOptions:t.providerOptions,...t.strict==null?{}:{strict:t.strict}});break;case`provider`:i.push({type:`provider`,name:e,id:t.id,args:t.args});break;default:{let e=n;throw Error(`Unsupported tool type: ${e}`)}}}return{tools:i,toolChoice:t==null?{type:`auto`}:typeof t==`string`?{type:t}:{type:`tool`,toolName:t.toolName}}}var nx=fc(()=>L([Es(),A(),j(),M(),Hs(A(),nx.optional()),F(nx)])),Q=Hs(A(),Hs(A(),nx.optional())),rx=I({type:B(`text`),text:A(),providerOptions:Q.optional()}),ix=I({type:B(`image`),image:L([Vb,_c(URL)]),mediaType:A().optional(),providerOptions:Q.optional()}),ax=I({type:B(`file`),data:L([Vb,_c(URL)]),filename:A().optional(),mediaType:A(),providerOptions:Q.optional()}),ox=I({type:B(`reasoning`),text:A(),providerOptions:Q.optional()}),sx=I({type:B(`tool-call`),toolCallId:A(),toolName:A(),input:N(),providerOptions:Q.optional(),providerExecuted:M().optional()}),cx=R(`type`,[I({type:B(`text`),value:A(),providerOptions:Q.optional()}),I({type:B(`json`),value:nx,providerOptions:Q.optional()}),I({type:B(`execution-denied`),reason:A().optional(),providerOptions:Q.optional()}),I({type:B(`error-text`),value:A(),providerOptions:Q.optional()}),I({type:B(`error-json`),value:nx,providerOptions:Q.optional()}),I({type:B(`content`),value:F(L([I({type:B(`text`),text:A(),providerOptions:Q.optional()}),I({type:B(`media`),data:A(),mediaType:A()}),I({type:B(`file-data`),data:A(),mediaType:A(),filename:A().optional(),providerOptions:Q.optional()}),I({type:B(`file-url`),url:A(),providerOptions:Q.optional()}),I({type:B(`file-id`),fileId:L([A(),Hs(A(),A())]),providerOptions:Q.optional()}),I({type:B(`image-data`),data:A(),mediaType:A(),providerOptions:Q.optional()}),I({type:B(`image-url`),url:A(),providerOptions:Q.optional()}),I({type:B(`image-file-id`),fileId:L([A(),Hs(A(),A())]),providerOptions:Q.optional()}),I({type:B(`custom`),providerOptions:Q.optional()})]))})]),lx=I({type:B(`tool-result`),toolCallId:A(),toolName:A(),output:cx,providerOptions:Q.optional()}),ux=I({type:B(`tool-approval-request`),approvalId:A(),toolCallId:A()}),dx=I({type:B(`tool-approval-response`),approvalId:A(),approved:M(),reason:A().optional()}),fx=I({role:B(`system`),content:A(),providerOptions:Q.optional()}),px=I({role:B(`user`),content:L([A(),F(L([rx,ix,ax]))]),providerOptions:Q.optional()}),mx=I({role:B(`assistant`),content:L([A(),F(L([rx,ax,ox,sx,lx,ux]))]),providerOptions:Q.optional()}),hx=I({role:B(`tool`),content:F(L([lx,dx])),providerOptions:Q.optional()}),gx=L([fx,px,mx,hx]);async function _x(e){if(e.prompt==null&&e.messages==null)throw new ae({prompt:e,message:`prompt or messages must be defined`});if(e.prompt!=null&&e.messages!=null)throw new ae({prompt:e,message:`prompt and messages cannot be defined at the same time`});if(e.system!=null&&typeof e.system!=`string`&&!Gb(e.system).every(e=>typeof e==`object`&&!!e&&`role`in e&&e.role===`system`))throw new ae({prompt:e,message:`system must be a string, SystemModelMessage, or array of SystemModelMessage`});let t;if(e.prompt!=null&&typeof e.prompt==`string`)t=[{role:`user`,content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new ae({prompt:e,message:`prompt or messages must be defined`});if(t.length===0)throw new ae({prompt:e,message:`messages must not be empty`});let n=await $d({value:t,schema:F(gx)});if(!n.success)throw new ae({prompt:e,message:`The messages do not match the ModelMessage[] schema.`,cause:n.error});return{messages:t,system:e.system}}function vx(e){if(!Tg.isInstance(e))return e;let t=(process==null?void 0:`production`)===`production`,n=`https://ai-sdk.dev/unauthenticated-ai-gateway`;return t?new a({name:`GatewayError`,message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${n}`}):Object.assign(Error(`\x1B[1m\x1B[31mUnauthenticated request to AI Gateway.\x1B[0m

To authenticate, set the \x1B[33mAI_GATEWAY_API_KEY\x1B[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1B[34m${n}\x1B[0m

`),{name:`GatewayAuthenticationError`})}function yx({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId==null?``:` ${t.functionId}`}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function bx({model:e,settings:t,telemetry:n,headers:r}){return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,n])=>{if(t===`timeout`){let r=kb(n);r!=null&&(e[`ai.settings.${t}`]=r)}else e[`ai.settings.${t}`]=n;return e},{}),...Object.entries(n?.metadata??{}).reduce((e,[t,n])=>(e[`ai.telemetry.metadata.${t}`]=n,e),{}),...Object.entries(r??{}).reduce((e,[t,n])=>(n!==void 0&&(e[`ai.request.headers.${t}`]=n),e),{})}}var xx={startSpan(){return Sx},startActiveSpan(e,t,n,r){if(typeof t==`function`)return t(Sx);if(typeof n==`function`)return n(Sx);if(typeof r==`function`)return r(Sx)}},Sx={spanContext(){return Cx},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Cx={traceId:``,spanId:``,traceFlags:0};function wx({isEnabled:e=!1,tracer:t}={}){return e?t||Nv.getTracer(`ai`):xx}async function Tx({name:e,tracer:t,attributes:n,fn:r,endWhenDone:i=!0}){return t.startActiveSpan(e,{attributes:await n},async e=>{let t=jv.active();try{let n=await jv.with(t,()=>r(e));return i&&e.end(),n}catch(t){try{Ex(e,t)}finally{e.end()}throw t}})}function Ex(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Av.ERROR,message:t.message})):e.setStatus({code:Av.ERROR})}async function $({telemetry:e,attributes:t}){if(e?.isEnabled!==!0)return{};let n={};for(let[r,i]of Object.entries(t))if(i!=null){if(typeof i==`object`&&`input`in i&&typeof i.input==`function`){if(e?.recordInputs===!1)continue;let t=await i.input();t!=null&&(n[r]=t);continue}if(typeof i==`object`&&`output`in i&&typeof i.output==`function`){if(e?.recordOutputs===!1)continue;let t=await i.output();t!=null&&(n[r]=t);continue}n[r]=i}return n}function Dx(e){return JSON.stringify(e.map(e=>({...e,content:typeof e.content==`string`?e.content:e.content.map(e=>e.type===`file`?{...e,data:e.data instanceof Uint8Array?Ub(e.data):e.data}:e)})))}function Ox(e){return{inputTokens:e.inputTokens.total,inputTokenDetails:{noCacheTokens:e.inputTokens.noCache,cacheReadTokens:e.inputTokens.cacheRead,cacheWriteTokens:e.inputTokens.cacheWrite},outputTokens:e.outputTokens.total,outputTokenDetails:{textTokens:e.outputTokens.text,reasoningTokens:e.outputTokens.reasoning},totalTokens:jx(e.inputTokens.total,e.outputTokens.total),raw:e.raw,reasoningTokens:e.outputTokens.reasoning,cachedInputTokens:e.inputTokens.cacheRead}}function kx(){return{inputTokens:void 0,inputTokenDetails:{noCacheTokens:void 0,cacheReadTokens:void 0,cacheWriteTokens:void 0},outputTokens:void 0,outputTokenDetails:{textTokens:void 0,reasoningTokens:void 0},totalTokens:void 0,raw:void 0}}function Ax(e,t){return{inputTokens:jx(e.inputTokens,t.inputTokens),inputTokenDetails:{noCacheTokens:jx(e.inputTokenDetails?.noCacheTokens,t.inputTokenDetails?.noCacheTokens),cacheReadTokens:jx(e.inputTokenDetails?.cacheReadTokens,t.inputTokenDetails?.cacheReadTokens),cacheWriteTokens:jx(e.inputTokenDetails?.cacheWriteTokens,t.inputTokenDetails?.cacheWriteTokens)},outputTokens:jx(e.outputTokens,t.outputTokens),outputTokenDetails:{textTokens:jx(e.outputTokenDetails?.textTokens,t.outputTokenDetails?.textTokens),reasoningTokens:jx(e.outputTokenDetails?.reasoningTokens,t.outputTokenDetails?.reasoningTokens)},totalTokens:jx(e.totalTokens,t.totalTokens),reasoningTokens:jx(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:jx(e.cachedInputTokens,t.cachedInputTokens)}}function jx(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function Mx(e,t){return{inputTokens:jx(e.inputTokens,t.inputTokens),outputTokens:jx(e.outputTokens,t.outputTokens),totalTokens:jx(e.totalTokens,t.totalTokens)}}function Nx(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;let n={...e};for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let i=t[r];if(i===void 0)continue;let a=r in e?e[r]:void 0,o=typeof i==`object`&&!!i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp),s=typeof a==`object`&&!!a&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp);o&&s?n[r]=Nx(a,i):n[r]=i}return n}function Px({error:e,exponentialBackoffDelay:t}){let n=e.responseHeaders;if(!n)return t;let r,i=n[`retry-after-ms`];if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n[`retry-after`];if(a&&r===void 0){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():e*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<t)?r:t}var Fx=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2,abortSignal:r}={})=>async i=>Ix(i,{maxRetries:e,delayInMs:t,backoffFactor:n,abortSignal:r});async function Ix(e,{maxRetries:t,delayInMs:n,backoffFactor:r,abortSignal:i},a=[]){try{return await e()}catch(o){if(vu(o)||t===0)throw o;let s=_u(o),c=[...a,o],l=c.length;if(l>t)throw new lb({message:`Failed after ${l} attempts. Last error: ${s}`,reason:`maxRetriesExceeded`,errors:c});if(o instanceof Error&&d.isInstance(o)&&o.isRetryable===!0&&l<=t)return await Ql(Px({error:o,exponentialBackoffDelay:n}),{abortSignal:i}),Ix(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r,abortSignal:i},c);throw l===1?o:new lb({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:`errorNotRetryable`,errors:c})}}function Lx({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new Bv({parameter:`maxRetries`,value:e,message:`maxRetries must be an integer`});if(e<0)throw new Bv({parameter:`maxRetries`,value:e,message:`maxRetries must be >= 0`})}let n=e??2;return{maxRetries:n,retry:Fx({maxRetries:n,abortSignal:t})}}function Rx({messages:e}){let t=e.at(-1);if(t?.role!=`tool`)return{approvedToolApprovals:[],deniedToolApprovals:[]};let n={};for(let t of e)if(t.role===`assistant`&&typeof t.content!=`string`){let e=t.content;for(let t of e)t.type===`tool-call`&&(n[t.toolCallId]=t)}let r={};for(let t of e)if(t.role===`assistant`&&typeof t.content!=`string`){let e=t.content;for(let t of e)t.type===`tool-approval-request`&&(r[t.approvalId]=t)}let i={};for(let e of t.content)e.type===`tool-result`&&(i[e.toolCallId]=e);let a=[],o=[],s=t.content.filter(e=>e.type===`tool-approval-response`);for(let e of s){let t=r[e.approvalId];if(t==null)throw new Xv({approvalId:e.approvalId});if(i[t.toolCallId]!=null)continue;let s=n[t.toolCallId];if(s==null)throw new oy({toolCallId:t.toolCallId,approvalId:t.approvalId});let c={approvalRequest:t,approvalResponse:e,toolCall:s};e.approved?a.push(c):o.push(c)}return{approvedToolApprovals:a,deniedToolApprovals:o}}async function zx({toolCall:e,tools:t,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:o,onPreliminaryToolResult:s}){let{toolName:c,toolCallId:l,input:u}=e,d=t?.[c];if(d?.execute!=null)return Tx({name:`ai.toolCall`,attributes:$({telemetry:r,attributes:{...yx({operationId:`ai.toolCall`,telemetry:r}),"ai.toolCall.name":c,"ai.toolCall.id":l,"ai.toolCall.args":{output:()=>JSON.stringify(u)}}}),tracer:n,fn:async t=>{let n;try{let t=xf({execute:d.execute.bind(d),input:u,options:{toolCallId:l,messages:i,abortSignal:a,experimental_context:o}});for await(let r of t)r.type===`preliminary`?s?.({...e,type:`tool-result`,output:r.output,preliminary:!0}):n=r.output}catch(n){return Ex(t,n),{type:`tool-error`,toolCallId:l,toolName:c,input:u,error:n,dynamic:d.type===`dynamic`,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}}try{t.setAttributes(await $({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(n)}}}))}catch{}return{type:`tool-result`,toolCallId:l,toolName:c,input:u,output:n,dynamic:d.type===`dynamic`,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}}})}function Bx(e){let t=e.filter(e=>e.type===`text`);if(t.length!==0)return t.map(e=>e.text).join(``)}var Vx=class{constructor({data:e,mediaType:t}){let n=e instanceof Uint8Array;this.base64Data=n?void 0:e,this.uint8ArrayData=n?e:void 0,this.mediaType=t}get base64(){return this.base64Data??=au(this.uint8ArrayData),this.base64Data}get uint8Array(){return this.uint8ArrayData??=iu(this.base64Data),this.uint8ArrayData}},Hx=class extends Vx{constructor(e){super(e),this.type=`file`}};async function Ux({tool:e,toolCall:t,messages:n,experimental_context:r}){return e.needsApproval==null?!1:typeof e.needsApproval==`boolean`?e.needsApproval:await e.needsApproval(t.input,{toolCallId:t.toolCallId,messages:n,experimental_context:r})}var Wx={};Fv(Wx,{array:()=>Yx,choice:()=>Xx,json:()=>Zx,object:()=>Jx,text:()=>qx});function Gx(e){let t=[`ROOT`],n=-1,r=null;function i(e,i,a){switch(e){case`"`:n=i,t.pop(),t.push(a),t.push(`INSIDE_STRING`);break;case`f`:case`t`:case`n`:n=i,r=i,t.pop(),t.push(a),t.push(`INSIDE_LITERAL`);break;case`-`:t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=i,t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`{`:n=i,t.pop(),t.push(a),t.push(`INSIDE_OBJECT_START`);break;case`[`:n=i,t.pop(),t.push(a),t.push(`INSIDE_ARRAY_START`);break}}function a(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_COMMA`);break;case`}`:n=r,t.pop();break}}function o(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=r,t.pop();break}}for(let s=0;s<e.length;s++){let c=e[s];switch(t[t.length-1]){case`ROOT`:i(c,s,`FINISH`);break;case`INSIDE_OBJECT_START`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break;case`}`:n=s,t.pop();break}break;case`INSIDE_OBJECT_AFTER_COMMA`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break}break;case`INSIDE_OBJECT_KEY`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_KEY`);break}break;case`INSIDE_OBJECT_AFTER_KEY`:switch(c){case`:`:t.pop(),t.push(`INSIDE_OBJECT_BEFORE_VALUE`);break}break;case`INSIDE_OBJECT_BEFORE_VALUE`:i(c,s,`INSIDE_OBJECT_AFTER_VALUE`);break;case`INSIDE_OBJECT_AFTER_VALUE`:a(c,s);break;case`INSIDE_STRING`:switch(c){case`"`:t.pop(),n=s;break;case`\\`:t.push(`INSIDE_STRING_ESCAPE`);break;default:n=s}break;case`INSIDE_ARRAY_START`:switch(c){case`]`:n=s,t.pop();break;default:n=s,i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break}break;case`INSIDE_ARRAY_AFTER_VALUE`:switch(c){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=s,t.pop();break;default:n=s;break}break;case`INSIDE_ARRAY_AFTER_COMMA`:i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break;case`INSIDE_STRING_ESCAPE`:t.pop(),n=s;break;case`INSIDE_NUMBER`:switch(c){case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=s;break;case`e`:case`E`:case`-`:case`.`:break;case`,`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`}`:t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`]`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s);break;default:t.pop();break}break;case`INSIDE_LITERAL`:{let i=e.substring(r,s+1);!`false`.startsWith(i)&&!`true`.startsWith(i)&&!`null`.startsWith(i)?(t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`?a(c,s):t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s)):n=s;break}}}let s=e.slice(0,n+1);for(let n=t.length-1;n>=0;n--)switch(t[n]){case`INSIDE_STRING`:s+=`"`;break;case`INSIDE_OBJECT_KEY`:case`INSIDE_OBJECT_AFTER_KEY`:case`INSIDE_OBJECT_AFTER_COMMA`:case`INSIDE_OBJECT_START`:case`INSIDE_OBJECT_BEFORE_VALUE`:case`INSIDE_OBJECT_AFTER_VALUE`:s+=`}`;break;case`INSIDE_ARRAY_START`:case`INSIDE_ARRAY_AFTER_COMMA`:case`INSIDE_ARRAY_AFTER_VALUE`:s+=`]`;break;case`INSIDE_LITERAL`:{let t=e.substring(r,e.length);`true`.startsWith(t)?s+=`true`.slice(t.length):`false`.startsWith(t)?s+=`false`.slice(t.length):`null`.startsWith(t)&&(s+=`null`.slice(t.length))}}return s}async function Kx(e){if(e===void 0)return{value:void 0,state:`undefined-input`};let t=await tf({text:e});return t.success?{value:t.value,state:`successful-parse`}:(t=await tf({text:Gx(e)}),t.success?{value:t.value,state:`repaired-parse`}:{value:void 0,state:`failed-parse`})}var qx=()=>({name:`text`,responseFormat:Promise.resolve({type:`text`}),async parseCompleteOutput({text:e}){return e},async parsePartialOutput({text:e}){return{partial:e}},createElementStreamTransform(){}}),Jx=({schema:e,name:t,description:n})=>{let r=qd(e);return{name:`object`,responseFormat:mf(r.jsonSchema).then(e=>({type:`json`,schema:e,...t!=null&&{name:t},...n!=null&&{description:n}})),async parseCompleteOutput({text:e},t){let n=await tf({text:e});if(!n.success)throw new xy({message:`No object generated: could not parse the response.`,cause:n.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let i=await $d({value:n.value,schema:r});if(!i.success)throw new xy({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return i.value},async parsePartialOutput({text:e}){let t=await Kx(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:return{partial:t.value}}},createElementStreamTransform(){}}},Yx=({element:e,name:t,description:n})=>{let r=qd(e);return{name:`array`,responseFormat:mf(r.jsonSchema).then(e=>{let{$schema:r,...i}=e;return{type:`json`,schema:{$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{elements:{type:`array`,items:i}},required:[`elements`],additionalProperties:!1},...t!=null&&{name:t},...n!=null&&{description:n}}}),async parseCompleteOutput({text:e},t){let n=await tf({text:e});if(!n.success)throw new xy({message:`No object generated: could not parse the response.`,cause:n.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let i=n.value;if(typeof i!=`object`||!i||!(`elements`in i)||!Array.isArray(i.elements))throw new xy({message:`No object generated: response did not match schema.`,cause:new Ze({value:i,cause:`response must be an object with an elements array`}),text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});for(let n of i.elements){let i=await $d({value:n,schema:r});if(!i.success)throw new xy({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason})}return i.elements},async parsePartialOutput({text:e}){let t=await Kx(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:{let e=t.value;if(typeof e!=`object`||!e||!(`elements`in e)||!Array.isArray(e.elements))return;let n=t.state===`repaired-parse`&&e.elements.length>0?e.elements.slice(0,-1):e.elements,i=[];for(let e of n){let t=await $d({value:e,schema:r});t.success&&i.push(t.value)}return{partial:i}}}},createElementStreamTransform(){let e=0;return new TransformStream({transform({partialOutput:t},n){if(t!=null)for(;e<t.length;e++)n.enqueue(t[e])}})}}},Xx=({options:e,name:t,description:n})=>({name:`choice`,responseFormat:Promise.resolve({type:`json`,schema:{$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{result:{type:`string`,enum:e}},required:[`result`],additionalProperties:!1},...t!=null&&{name:t},...n!=null&&{description:n}}),async parseCompleteOutput({text:t},n){let r=await tf({text:t});if(!r.success)throw new xy({message:`No object generated: could not parse the response.`,cause:r.error,text:t,response:n.response,usage:n.usage,finishReason:n.finishReason});let i=r.value;if(typeof i!=`object`||!i||!(`result`in i)||typeof i.result!=`string`||!e.includes(i.result))throw new xy({message:`No object generated: response did not match schema.`,cause:new Ze({value:i,cause:`response must be an object that contains a choice value.`}),text:t,response:n.response,usage:n.usage,finishReason:n.finishReason});return i.result},async parsePartialOutput({text:t}){let n=await Kx(t);switch(n.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:{let t=n.value;if(typeof t!=`object`||!t||!(`result`in t)||typeof t.result!=`string`)return;let r=e.filter(e=>e.startsWith(t.result));return n.state===`successful-parse`?r.includes(t.result)?{partial:t.result}:void 0:r.length===1?{partial:r[0]}:void 0}}},createElementStreamTransform(){}}),Zx=({name:e,description:t}={})=>({name:`json`,responseFormat:Promise.resolve({type:`json`,...e!=null&&{name:e},...t!=null&&{description:t}}),async parseCompleteOutput({text:e},t){let n=await tf({text:e});if(!n.success)throw new xy({message:`No object generated: could not parse the response.`,cause:n.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return n.value},async parsePartialOutput({text:e}){let t=await Kx(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:return t.value===void 0?void 0:{partial:t.value}}},createElementStreamTransform(){}});async function Qx({toolCall:e,tools:t,repairToolCall:n,system:r,messages:i}){try{if(t==null){if(e.providerExecuted&&e.dynamic)return await $x(e);throw new My({toolName:e.toolName})}try{return await eS({toolCall:e,tools:t})}catch(a){if(n==null||!(My.isInstance(a)||ty.isInstance(a)))throw a;let o=null;try{o=await n({toolCall:e,tools:t,inputSchema:async({toolName:e})=>{let{inputSchema:n}=t[e];return await qd(n).jsonSchema},system:r,messages:i,error:a})}catch(e){throw new Ly({cause:e,originalError:a})}if(o==null)throw a;return await eS({toolCall:o,tools:t})}}catch(n){let r=await tf({text:e.input}),i=r.success?r.value:e.input;return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:i,dynamic:!0,invalid:!0,error:n,title:t?.[e.toolName]?.title,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}}async function $x(e){let t=e.input.trim()===``?{success:!0,value:{}}:await tf({text:e.input});if(t.success===!1)throw new ty({toolName:e.toolName,toolInput:e.input,cause:t.error});return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:t.value,providerExecuted:!0,dynamic:!0,providerMetadata:e.providerMetadata}}async function eS({toolCall:e,tools:t}){let n=e.toolName,r=t[n];if(r==null){if(e.providerExecuted&&e.dynamic)return await $x(e);throw new My({toolName:e.toolName,availableTools:Object.keys(t)})}let i=qd(r.inputSchema),a=e.input.trim()===``?await $d({value:{},schema:i}):await tf({text:e.input,schema:i});if(a.success===!1)throw new ty({toolName:n,toolInput:e.input,cause:a.error});return r.type===`dynamic`?{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0,title:r.title}:{type:`tool-call`,toolCallId:e.toolCallId,toolName:n,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:r.title}}var tS=class{constructor({content:e,finishReason:t,rawFinishReason:n,usage:r,warnings:i,request:a,response:o,providerMetadata:s}){this.content=e,this.finishReason=t,this.rawFinishReason=n,this.usage=r,this.warnings=i,this.request=a,this.response=o,this.providerMetadata=s}get text(){return this.content.filter(e=>e.type===`text`).map(e=>e.text).join(``)}get reasoning(){return this.content.filter(e=>e.type===`reasoning`)}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join(``)}get files(){return this.content.filter(e=>e.type===`file`).map(e=>e.file)}get sources(){return this.content.filter(e=>e.type===`source`)}get toolCalls(){return this.content.filter(e=>e.type===`tool-call`)}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type===`tool-result`)}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function nS(e){return({steps:t})=>t.length===e}function rS(e){return({steps:t})=>(t[t.length-1]?.toolCalls)?.some(t=>t.toolName===e)??!1}async function iS({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}async function aS({content:e,tools:t}){let n=[],r=[];for(let n of e)if(n.type!==`source`&&!((n.type===`tool-result`||n.type===`tool-error`)&&!n.providerExecuted)&&!(n.type===`text`&&n.text.length===0))switch(n.type){case`text`:r.push({type:`text`,text:n.text,providerOptions:n.providerMetadata});break;case`reasoning`:r.push({type:`reasoning`,text:n.text,providerOptions:n.providerMetadata});break;case`file`:r.push({type:`file`,data:n.file.base64,mediaType:n.file.mediaType,providerOptions:n.providerMetadata});break;case`tool-call`:r.push({type:`tool-call`,toolCallId:n.toolCallId,toolName:n.toolName,input:n.input,providerExecuted:n.providerExecuted,providerOptions:n.providerMetadata});break;case`tool-result`:{let e=await Zb({toolCallId:n.toolCallId,input:n.input,tool:t?.[n.toolName],output:n.output,errorMode:`none`});r.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,output:e,providerOptions:n.providerMetadata});break}case`tool-error`:{let e=await Zb({toolCallId:n.toolCallId,input:n.input,tool:t?.[n.toolName],output:n.error,errorMode:`json`});r.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,output:e,providerOptions:n.providerMetadata});break}case`tool-approval-request`:r.push({type:`tool-approval-request`,approvalId:n.approvalId,toolCallId:n.toolCall.toolCallId});break}r.length>0&&n.push({role:`assistant`,content:r});let i=[];for(let n of e){if(!(n.type===`tool-result`||n.type===`tool-error`)||n.providerExecuted)continue;let e=await Zb({toolCallId:n.toolCallId,input:n.input,tool:t?.[n.toolName],output:n.type===`tool-result`?n.output:n.error,errorMode:n.type===`tool-error`?`text`:`none`});i.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,output:e,...n.providerMetadata==null?{}:{providerOptions:n.providerMetadata}})}return i.length>0&&n.push({role:`tool`,content:i}),n}function oS(...e){let t=e.filter(e=>e!=null);if(t.length===0)return;if(t.length===1)return t[0];let n=new AbortController;for(let e of t){if(e.aborted)return n.abort(e.reason),n.signal;e.addEventListener(`abort`,()=>{n.abort(e.reason)},{once:!0})}return n.signal}var sS=hu({prefix:`aitxt`,size:24});async function cS({model:e,tools:t,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,timeout:c,headers:l,stopWhen:u=nS(1),experimental_output:d,output:f=d,experimental_telemetry:p,providerOptions:m,experimental_activeTools:h,activeTools:g=h,experimental_prepareStep:_,prepareStep:v=_,experimental_repairToolCall:ee,experimental_download:y,experimental_context:b,_internal:{generateId:te=sS}={},onStepFinish:x,onFinish:S,...ne}){let C=Cb(e),re=Gb(u),w=kb(c),ie=Ab(c),ae=ie==null?void 0:new AbortController,T=oS(s,w==null?void 0:AbortSignal.timeout(w),ae?.signal),{maxRetries:oe,retry:se}=Lx({maxRetries:o,abortSignal:T}),E=$b(ne),ce=Cu(l??{},`ai/${Lb}`),le=bx({model:C,telemetry:p,headers:ce,settings:{...E,maxRetries:oe}}),ue=await _x({system:r,prompt:i,messages:a}),de=wx(p);try{return await Tx({name:`ai.generateText`,attributes:$({telemetry:p,attributes:{...yx({operationId:`ai.generateText`,telemetry:p}),...le,"ai.model.provider":C.provider,"ai.model.id":C.modelId,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:i,messages:a})}}}),tracer:de,fn:async e=>{let i=ue.messages,a=[],{approvedToolApprovals:o,deniedToolApprovals:s}=Rx({messages:i}),c=o.filter(e=>!e.toolCall.providerExecuted);if(s.length>0||c.length>0){let e=await lS({toolCalls:c.map(e=>e.toolCall),tools:t,tracer:de,telemetry:p,messages:i,abortSignal:T,experimental_context:b}),n=[];for(let r of e){let e=await Zb({toolCallId:r.toolCallId,input:r.input,tool:t?.[r.toolName],output:r.type===`tool-result`?r.output:r.error,errorMode:r.type===`tool-error`?`json`:`none`});n.push({type:`tool-result`,toolCallId:r.toolCallId,toolName:r.toolName,output:e})}for(let e of s)n.push({type:`tool-result`,toolCallId:e.toolCall.toolCallId,toolName:e.toolCall.toolName,output:{type:`execution-denied`,reason:e.approvalResponse.reason,...e.toolCall.providerExecuted&&{providerOptions:{openai:{approvalId:e.approvalResponse.approvalId}}}}});a.push({role:`tool`,content:n})}let l=[...o,...s].filter(e=>e.toolCall.providerExecuted);l.length>0&&a.push({role:`tool`,content:l.map(e=>({type:`tool-approval-response`,approvalId:e.approvalResponse.approvalId,approved:e.approvalResponse.approved,reason:e.approvalResponse.reason,providerExecuted:!0}))});let u=$b(ne),d,h=[],_=[],w=[],oe=new Map;do{let e=ie==null?void 0:setTimeout(()=>ae.abort(),ie);try{let e=[...i,...a],o=await v?.({model:C,steps:w,stepNumber:w.length,messages:e,experimental_context:b}),s=Cb(o?.model??C),c=await Kb({prompt:{system:o?.system??ue.system,messages:o?.messages??e},supportedUrls:await s.supportedUrls,download:y});b=o?.experimental_context??b;let{toolChoice:l,tools:S}=await tx({tools:t,toolChoice:o?.toolChoice??n,activeTools:o?.activeTools??g});d=await se(()=>Tx({name:`ai.generateText.doGenerate`,attributes:$({telemetry:p,attributes:{...yx({operationId:`ai.generateText.doGenerate`,telemetry:p}),...le,"ai.model.provider":s.provider,"ai.model.id":s.modelId,"ai.prompt.messages":{input:()=>Dx(c)},"ai.prompt.tools":{input:()=>S?.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>l==null?void 0:JSON.stringify(l)},"gen_ai.system":s.provider,"gen_ai.request.model":s.modelId,"gen_ai.request.frequency_penalty":ne.frequencyPenalty,"gen_ai.request.max_tokens":ne.maxOutputTokens,"gen_ai.request.presence_penalty":ne.presencePenalty,"gen_ai.request.stop_sequences":ne.stopSequences,"gen_ai.request.temperature":ne.temperature??void 0,"gen_ai.request.top_k":ne.topK,"gen_ai.request.top_p":ne.topP}}),tracer:de,fn:async e=>{let t=Nx(m,o?.providerOptions),n=await s.doGenerate({...u,tools:S,toolChoice:l,responseFormat:await f?.responseFormat,prompt:c,providerOptions:t,abortSignal:T,headers:ce}),r={id:n.response?.id??te(),timestamp:n.response?.timestamp??new Date,modelId:n.response?.modelId??s.modelId,headers:n.response?.headers,body:n.response?.body};return e.setAttributes(await $({telemetry:p,attributes:{"ai.response.finishReason":n.finishReason.unified,"ai.response.text":{output:()=>Bx(n.content)},"ai.response.toolCalls":{output:()=>{let e=dS(n.content);return e==null?void 0:JSON.stringify(e)}},"ai.response.id":r.id,"ai.response.model":r.modelId,"ai.response.timestamp":r.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(n.providerMetadata),"ai.usage.promptTokens":n.usage.inputTokens.total,"ai.usage.completionTokens":n.usage.outputTokens.total,"gen_ai.response.finish_reasons":[n.finishReason.unified],"gen_ai.response.id":r.id,"gen_ai.response.model":r.modelId,"gen_ai.usage.input_tokens":n.usage.inputTokens.total,"gen_ai.usage.output_tokens":n.usage.outputTokens.total}})),{...n,response:r}}}));let re=await Promise.all(d.content.filter(e=>e.type===`tool-call`).map(n=>Qx({toolCall:n,tools:t,repairToolCall:ee,system:r,messages:e}))),ie={};for(let n of re){if(n.invalid)continue;let r=t?.[n.toolName];r!=null&&(r?.onInputAvailable!=null&&await r.onInputAvailable({input:n.input,toolCallId:n.toolCallId,messages:e,abortSignal:T,experimental_context:b}),await Ux({tool:r,toolCall:n,messages:e,experimental_context:b})&&(ie[n.toolCallId]={type:`tool-approval-request`,approvalId:te(),toolCall:n}))}let ae=re.filter(e=>e.invalid&&e.dynamic);_=[];for(let e of ae)_.push({type:`tool-error`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,error:_u(e.error),dynamic:!0});h=re.filter(e=>!e.providerExecuted),t!=null&&_.push(...await lS({toolCalls:h.filter(e=>!e.invalid&&ie[e.toolCallId]==null),tools:t,tracer:de,telemetry:p,messages:e,abortSignal:T,experimental_context:b}));for(let e of re){if(!e.providerExecuted)continue;let n=t?.[e.toolName];n?.type===`provider`&&n.supportsDeferredResults&&(d.content.some(t=>t.type===`tool-result`&&t.toolCallId===e.toolCallId)||oe.set(e.toolCallId,{toolName:e.toolName}))}for(let e of d.content)e.type===`tool-result`&&oe.delete(e.toolCallId);let E=fS({content:d.content,toolCalls:re,toolOutputs:_,toolApprovalRequests:Object.values(ie),tools:t});a.push(...await aS({content:E,tools:t}));let fe=new tS({content:E,finishReason:d.finishReason.unified,rawFinishReason:d.finishReason.raw,usage:Ox(d.usage),warnings:d.warnings,providerMetadata:d.providerMetadata,request:d.request??{},response:{...d.response,messages:structuredClone(a)}});pb({warnings:d.warnings??[],provider:s.provider,model:s.modelId}),w.push(fe),await x?.(fe)}finally{e!=null&&clearTimeout(e)}}while((h.length>0&&_.length===h.length||oe.size>0)&&!await iS({stopConditions:re,steps:w}));e.setAttributes(await $({telemetry:p,attributes:{"ai.response.finishReason":d.finishReason.unified,"ai.response.text":{output:()=>Bx(d.content)},"ai.response.toolCalls":{output:()=>{let e=dS(d.content);return e==null?void 0:JSON.stringify(e)}},"ai.response.providerMetadata":JSON.stringify(d.providerMetadata),"ai.usage.promptTokens":d.usage.inputTokens.total,"ai.usage.completionTokens":d.usage.outputTokens.total}}));let E=w[w.length-1],fe=w.reduce((e,t)=>Ax(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0});await S?.({finishReason:E.finishReason,rawFinishReason:E.rawFinishReason,usage:E.usage,content:E.content,text:E.text,reasoningText:E.reasoningText,reasoning:E.reasoning,files:E.files,sources:E.sources,toolCalls:E.toolCalls,staticToolCalls:E.staticToolCalls,dynamicToolCalls:E.dynamicToolCalls,toolResults:E.toolResults,staticToolResults:E.staticToolResults,dynamicToolResults:E.dynamicToolResults,request:E.request,response:E.response,warnings:E.warnings,providerMetadata:E.providerMetadata,steps:w,totalUsage:fe,experimental_context:b});let pe;return E.finishReason===`stop`&&(pe=await(f??qx()).parseCompleteOutput({text:E.text},{response:E.response,usage:E.usage,finishReason:E.finishReason})),new uS({steps:w,totalUsage:fe,output:pe})}})}catch(e){throw vx(e)}}async function lS({toolCalls:e,tools:t,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:o}){return(await Promise.all(e.map(async e=>zx({toolCall:e,tools:t,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:o})))).filter(e=>e!=null)}var uS=class{constructor(e){this.steps=e.steps,this._output=e.output,this.totalUsage=e.totalUsage}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get rawFinishReason(){return this.finalStep.rawFinishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get experimental_output(){return this.output}get output(){if(this._output==null)throw new Ey;return this._output}};function dS(e){let t=e.filter(e=>e.type===`tool-call`);if(t.length!==0)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function fS({content:e,toolCalls:t,toolOutputs:n,toolApprovalRequests:r,tools:i}){let a=[];for(let n of e)switch(n.type){case`text`:case`reasoning`:case`source`:a.push(n);break;case`file`:a.push({type:`file`,file:new Vx(n),...n.providerMetadata==null?{}:{providerMetadata:n.providerMetadata}});break;case`tool-call`:a.push(t.find(e=>e.toolCallId===n.toolCallId));break;case`tool-result`:{let e=t.find(e=>e.toolCallId===n.toolCallId);if(e==null){let e=i?.[n.toolName];if(!(e?.type===`provider`&&e.supportsDeferredResults))throw Error(`Tool call ${n.toolCallId} not found.`);n.isError?a.push({type:`tool-error`,toolCallId:n.toolCallId,toolName:n.toolName,input:void 0,error:n.result,providerExecuted:!0,dynamic:n.dynamic}):a.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,input:void 0,output:n.result,providerExecuted:!0,dynamic:n.dynamic});break}n.isError?a.push({type:`tool-error`,toolCallId:n.toolCallId,toolName:n.toolName,input:e.input,error:n.result,providerExecuted:!0,dynamic:e.dynamic}):a.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,input:e.input,output:n.result,providerExecuted:!0,dynamic:e.dynamic});break}case`tool-approval-request`:{let e=t.find(e=>e.toolCallId===n.toolCallId);if(e==null)throw new oy({toolCallId:n.toolCallId,approvalId:n.approvalId});a.push({type:`tool-approval-request`,approvalId:n.approvalId,toolCall:e});break}}return[...a,...n,...r]}function pS(e,t){let n=new Headers(e??{});for(let[e,r]of Object.entries(t))n.has(e)||n.set(e,r);return n}function mS({status:e,statusText:t,headers:n,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:pS(n,{"content-type":`text/plain; charset=utf-8`})})}function hS({response:e,status:t,statusText:n,headers:r,stream:i}){let a=t??200;n===void 0?e.writeHead(a,r):e.writeHead(a,n,r);let o=i.getReader();(async()=>{try{for(;;){let{done:t,value:n}=await o.read();if(t)break;e.write(n)||await new Promise(t=>{e.once(`drain`,t)})}}catch(e){throw e}finally{e.end()}})()}function gS({response:e,status:t,statusText:n,headers:r,textStream:i}){hS({response:e,status:t,statusText:n,headers:Object.fromEntries(pS(r,{"content-type":`text/plain; charset=utf-8`}).entries()),stream:i.pipeThrough(new TextEncoderStream)})}var _S=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},vS={"content-type":`text/event-stream`,"cache-control":`no-cache`,connection:`keep-alive`,"x-vercel-ai-ui-message-stream":`v1`,"x-accel-buffering":`no`};function yS({status:e,statusText:t,headers:n,stream:r,consumeSseStream:i}){let a=r.pipeThrough(new _S);if(i){let[e,t]=a.tee();a=e,i({stream:t})}return new Response(a.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:pS(n,vS)})}function bS({originalMessages:e,responseMessageId:t}){if(e==null)return;let n=e[e.length-1];return n?.role===`assistant`?n.id:typeof t==`function`?t():t}var xS=X(()=>Z(L([Ns({type:B(`text-start`),id:A(),providerMetadata:Q.optional()}),Ns({type:B(`text-delta`),id:A(),delta:A(),providerMetadata:Q.optional()}),Ns({type:B(`text-end`),id:A(),providerMetadata:Q.optional()}),Ns({type:B(`error`),errorText:A()}),Ns({type:B(`tool-input-start`),toolCallId:A(),toolName:A(),providerExecuted:M().optional(),providerMetadata:Q.optional(),dynamic:M().optional(),title:A().optional()}),Ns({type:B(`tool-input-delta`),toolCallId:A(),inputTextDelta:A()}),Ns({type:B(`tool-input-available`),toolCallId:A(),toolName:A(),input:N(),providerExecuted:M().optional(),providerMetadata:Q.optional(),dynamic:M().optional(),title:A().optional()}),Ns({type:B(`tool-input-error`),toolCallId:A(),toolName:A(),input:N(),providerExecuted:M().optional(),providerMetadata:Q.optional(),dynamic:M().optional(),errorText:A(),title:A().optional()}),Ns({type:B(`tool-approval-request`),approvalId:A(),toolCallId:A()}),Ns({type:B(`tool-output-available`),toolCallId:A(),output:N(),providerExecuted:M().optional(),dynamic:M().optional(),preliminary:M().optional()}),Ns({type:B(`tool-output-error`),toolCallId:A(),errorText:A(),providerExecuted:M().optional(),dynamic:M().optional()}),Ns({type:B(`tool-output-denied`),toolCallId:A()}),Ns({type:B(`reasoning-start`),id:A(),providerMetadata:Q.optional()}),Ns({type:B(`reasoning-delta`),id:A(),delta:A(),providerMetadata:Q.optional()}),Ns({type:B(`reasoning-end`),id:A(),providerMetadata:Q.optional()}),Ns({type:B(`source-url`),sourceId:A(),url:A(),title:A().optional(),providerMetadata:Q.optional()}),Ns({type:B(`source-document`),sourceId:A(),mediaType:A(),title:A(),filename:A().optional(),providerMetadata:Q.optional()}),Ns({type:B(`file`),url:A(),mediaType:A(),providerMetadata:Q.optional()}),Ns({type:mc(e=>typeof e==`string`&&e.startsWith(`data-`),{message:`Type must start with "data-"`}),id:A().optional(),data:N(),transient:M().optional()}),Ns({type:B(`start-step`)}),Ns({type:B(`finish-step`)}),Ns({type:B(`start`),messageId:A().optional(),messageMetadata:N().optional()}),Ns({type:B(`finish`),finishReason:z([`stop`,`length`,`content-filter`,`tool-calls`,`error`,`other`]).optional(),messageMetadata:N().optional()}),Ns({type:B(`abort`),reason:A().optional()}),Ns({type:B(`message-metadata`),messageMetadata:N()})])));function SS(e){return e.type.startsWith(`data-`)}function CS(e){return e.type.startsWith(`data-`)}function wS(e){return e.type===`text`}function TS(e){return e.type===`file`}function ES(e){return e.type===`reasoning`}function DS(e){return e.type.startsWith(`tool-`)}function OS(e){return e.type===`dynamic-tool`}function kS(e){return DS(e)||OS(e)}var AS=kS;function jS(e){return e.type.split(`-`).slice(1).join(`-`)}function MS(e){return OS(e)?e.toolName:jS(e)}var NS=MS;function PS({lastMessage:e,messageId:t}){return{message:e?.role===`assistant`?e:{id:t,metadata:void 0,role:`assistant`,parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function FS({stream:e,messageMetadataSchema:t,dataPartSchemas:n,runUpdateMessageJob:r,onError:i,onToolCall:a,onData:o}){return e.pipeThrough(new TransformStream({async transform(e,s){await r(async({state:r,write:c})=>{function l(e){let t=r.message.parts.filter(kS).find(t=>t.toolCallId===e);if(t==null)throw new Uy({chunkType:`tool-invocation`,chunkId:e,message:`No tool invocation found for tool call ID "${e}".`});return t}function u(e){let t=r.message.parts.find(t=>DS(t)&&t.toolCallId===e.toolCallId),n=e,i=t;t==null?r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,title:e.title,input:n.input,output:n.output,rawInput:n.rawInput,errorText:n.errorText,providerExecuted:n.providerExecuted,preliminary:n.preliminary,...n.providerMetadata==null?{}:{callProviderMetadata:n.providerMetadata}}):(t.state=e.state,i.input=n.input,i.output=n.output,i.errorText=n.errorText,i.rawInput=n.rawInput,i.preliminary=n.preliminary,e.title!==void 0&&(i.title=e.title),i.providerExecuted=n.providerExecuted??t.providerExecuted,n.providerMetadata!=null&&(t.callProviderMetadata=n.providerMetadata))}function d(e){let t=r.message.parts.find(t=>t.type===`dynamic-tool`&&t.toolCallId===e.toolCallId),n=e,i=t;t==null?r.message.parts.push({type:`dynamic-tool`,toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:n.input,output:n.output,errorText:n.errorText,preliminary:n.preliminary,providerExecuted:n.providerExecuted,title:e.title,...n.providerMetadata==null?{}:{callProviderMetadata:n.providerMetadata}}):(t.state=e.state,i.toolName=e.toolName,i.input=n.input,i.output=n.output,i.errorText=n.errorText,i.rawInput=n.rawInput??i.rawInput,i.preliminary=n.preliminary,e.title!==void 0&&(i.title=e.title),i.providerExecuted=n.providerExecuted??t.providerExecuted,n.providerMetadata!=null&&(t.callProviderMetadata=n.providerMetadata))}async function f(e){if(e!=null){let n=r.message.metadata==null?e:Nx(r.message.metadata,e);t!=null&&await Qd({value:n,schema:t}),r.message.metadata=n}}switch(e.type){case`text-start`:{let t={type:`text`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeTextParts[e.id]=t,r.message.parts.push(t),c();break}case`text-delta`:{let t=r.activeTextParts[e.id];if(t==null)throw new Uy({chunkType:`text-delta`,chunkId:e.id,message:`Received text-delta for missing text part with ID "${e.id}". Ensure a "text-start" chunk is sent before any "text-delta" chunks.`});t.text+=e.delta,t.providerMetadata=e.providerMetadata??t.providerMetadata,c();break}case`text-end`:{let t=r.activeTextParts[e.id];if(t==null)throw new Uy({chunkType:`text-end`,chunkId:e.id,message:`Received text-end for missing text part with ID "${e.id}". Ensure a "text-start" chunk is sent before any "text-end" chunks.`});t.state=`done`,t.providerMetadata=e.providerMetadata??t.providerMetadata,delete r.activeTextParts[e.id],c();break}case`reasoning-start`:{let t={type:`reasoning`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),c();break}case`reasoning-delta`:{let t=r.activeReasoningParts[e.id];if(t==null)throw new Uy({chunkType:`reasoning-delta`,chunkId:e.id,message:`Received reasoning-delta for missing reasoning part with ID "${e.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-delta" chunks.`});t.text+=e.delta,t.providerMetadata=e.providerMetadata??t.providerMetadata,c();break}case`reasoning-end`:{let t=r.activeReasoningParts[e.id];if(t==null)throw new Uy({chunkType:`reasoning-end`,chunkId:e.id,message:`Received reasoning-end for missing reasoning part with ID "${e.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-end" chunks.`});t.providerMetadata=e.providerMetadata??t.providerMetadata,t.state=`done`,delete r.activeReasoningParts[e.id],c();break}case`file`:r.message.parts.push({type:`file`,mediaType:e.mediaType,url:e.url}),c();break;case`source-url`:r.message.parts.push({type:`source-url`,sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),c();break;case`source-document`:r.message.parts.push({type:`source-document`,sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),c();break;case`tool-input-start`:{let t=r.message.parts.filter(DS);r.partialToolCalls[e.toolCallId]={text:``,toolName:e.toolName,index:t.length,dynamic:e.dynamic,title:e.title},e.dynamic?d({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0,providerExecuted:e.providerExecuted,title:e.title,providerMetadata:e.providerMetadata}):u({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0,providerExecuted:e.providerExecuted,title:e.title,providerMetadata:e.providerMetadata}),c();break}case`tool-input-delta`:{let t=r.partialToolCalls[e.toolCallId];if(t==null)throw new Uy({chunkType:`tool-input-delta`,chunkId:e.toolCallId,message:`Received tool-input-delta for missing tool call with ID "${e.toolCallId}". Ensure a "tool-input-start" chunk is sent before any "tool-input-delta" chunks.`});t.text+=e.inputTextDelta;let{value:n}=await Kx(t.text);t.dynamic?d({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n,title:t.title}):u({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n,title:t.title}),c();break}case`tool-input-available`:e.dynamic?d({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}):u({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}),c(),a&&!e.providerExecuted&&await a({toolCall:e});break;case`tool-input-error`:e.dynamic?d({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):u({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),c();break;case`tool-approval-request`:{let t=l(e.toolCallId);t.state=`approval-requested`,t.approval={id:e.approvalId},c();break}case`tool-output-denied`:{let t=l(e.toolCallId);t.state=`output-denied`,c();break}case`tool-output-available`:{let t=l(e.toolCallId);t.type===`dynamic-tool`?d({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-available`,input:t.input,output:e.output,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:t.title}):u({toolCallId:e.toolCallId,toolName:jS(t),state:`output-available`,input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary,title:t.title}),c();break}case`tool-output-error`:{let t=l(e.toolCallId);t.type===`dynamic-tool`?d({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-error`,input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}):u({toolCallId:e.toolCallId,toolName:jS(t),state:`output-error`,input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}),c();break}case`start-step`:r.message.parts.push({type:`step-start`});break;case`finish-step`:r.activeTextParts={},r.activeReasoningParts={};break;case`start`:e.messageId!=null&&(r.message.id=e.messageId),await f(e.messageMetadata),(e.messageId!=null||e.messageMetadata!=null)&&c();break;case`finish`:e.finishReason!=null&&(r.finishReason=e.finishReason),await f(e.messageMetadata),e.messageMetadata!=null&&c();break;case`message-metadata`:await f(e.messageMetadata),e.messageMetadata!=null&&c();break;case`error`:i?.(Error(e.errorText));break;default:if(SS(e)){n?.[e.type]!=null&&await Qd({value:e.data,schema:n[e.type]});let t=e;if(t.transient){o?.(t);break}let i=t.id==null?void 0:r.message.parts.find(e=>t.type===e.type&&t.id===e.id);i==null?r.message.parts.push(t):i.data=t.data,o?.(t),c()}}s.enqueue(e)})}}))}function IS({messageId:e,originalMessages:t=[],onFinish:n,onError:r,stream:i}){let a=t?.[t.length-1];a?.role===`assistant`?e=a.id:a=void 0;let o=!1,s=i.pipeThrough(new TransformStream({transform(t,n){if(t.type===`start`){let n=t;n.messageId==null&&e!=null&&(n.messageId=e)}t.type===`abort`&&(o=!0),n.enqueue(t)}}));if(n==null)return s;let c=PS({lastMessage:a?structuredClone(a):void 0,messageId:e??``}),l=async e=>{await e({state:c,write:()=>{}})},u=!1,d=async()=>{if(u||!n)return;u=!0;let e=c.message.id===a?.id;await n({isAborted:o,isContinuation:e,responseMessage:c.message,messages:[...e?t.slice(0,-1):t,c.message],finishReason:c.finishReason})};return FS({stream:s,runUpdateMessageJob:l,onError:r}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await d()},async flush(){await d()}}))}function LS({response:e,status:t,statusText:n,headers:r,stream:i,consumeSseStream:a}){let o=i.pipeThrough(new _S);if(a){let[e,t]=o.tee();o=e,a({stream:t})}hS({response:e,status:t,statusText:n,headers:Object.fromEntries(pS(r,vS).entries()),stream:o.pipeThrough(new TextEncoderStream)})}function RS(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function n(n){if(!t){t=!0;try{n&&await e.cancel?.call(e)}finally{try{e.releaseLock()}catch{}}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:r,value:i}=await e.read();return r?(await n(!0),{done:!0,value:void 0}):{done:!1,value:i}},async return(){return await n(!0),{done:!0,value:void 0}},async throw(e){throw await n(!0),e}}},t}async function zS({stream:e,onError:t}){let n=e.getReader();try{for(;;){let{done:e}=await n.read();if(e)break}}catch(e){t?.(e)}finally{n.releaseLock()}}function BS(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}function VS(){let e=[],t=null,n=!1,r=BS(),i=()=>{n=!0,r.resolve(),e.forEach(e=>e.cancel()),e=[],t?.close()},a=async()=>{if(n&&e.length===0){t?.close();return}if(e.length===0)return r=BS(),await r.promise,a();try{let{value:r,done:i}=await e[0].read();i?(e.shift(),e.length===0&&n?t?.close():await a()):t?.enqueue(r)}catch(n){t?.error(n),e.shift(),i()}};return{stream:new ReadableStream({start(e){t=e},pull:a,async cancel(){for(let t of e)await t.cancel();e=[],n=!0}}),addStream:t=>{if(n)throw Error(`Cannot add inner stream: outer stream is closed`);e.push(t.getReader()),r.resolve()},close:()=>{n=!0,r.resolve(),e.length===0&&t?.close()},terminate:i}}function HS(){return(globalThis==null?void 0:globalThis.performance)?.now()??Date.now()}function US({tools:e,generatorStream:t,tracer:n,telemetry:r,system:i,messages:a,abortSignal:o,repairToolCall:s,experimental_context:c,generateId:l}){let u=null,d=new ReadableStream({start(e){u=e}}),f=new Set,p=new Map,m=new Map,h=!1,g;function _(){h&&f.size===0&&(g!=null&&u.enqueue(g),u.close())}let v=new TransformStream({async transform(t,d){let h=t.type;switch(h){case`stream-start`:case`text-start`:case`text-delta`:case`text-end`:case`reasoning-start`:case`reasoning-delta`:case`reasoning-end`:case`tool-input-start`:case`tool-input-delta`:case`tool-input-end`:case`source`:case`response-metadata`:case`error`:case`raw`:d.enqueue(t);break;case`file`:d.enqueue({type:`file`,file:new Hx({data:t.data,mediaType:t.mediaType})});break;case`finish`:g={type:`finish`,finishReason:t.finishReason.unified,rawFinishReason:t.finishReason.raw,usage:Ox(t.usage),providerMetadata:t.providerMetadata};break;case`tool-approval-request`:{let e=m.get(t.toolCallId);if(e==null){u.enqueue({type:`error`,error:new oy({toolCallId:t.toolCallId,approvalId:t.approvalId})});break}d.enqueue({type:`tool-approval-request`,approvalId:t.approvalId,toolCall:e});break}case`tool-call`:try{let h=await Qx({toolCall:t,tools:e,repairToolCall:s,system:i,messages:a});if(m.set(h.toolCallId,h),d.enqueue(h),h.invalid){u.enqueue({type:`tool-error`,toolCallId:h.toolCallId,toolName:h.toolName,input:h.input,error:_u(h.error),dynamic:!0,title:h.title});break}let g=e?.[h.toolName];if(g==null)break;if(g.onInputAvailable!=null&&await g.onInputAvailable({input:h.input,toolCallId:h.toolCallId,messages:a,abortSignal:o,experimental_context:c}),await Ux({tool:g,toolCall:h,messages:a,experimental_context:c})){u.enqueue({type:`tool-approval-request`,approvalId:l(),toolCall:h});break}if(p.set(h.toolCallId,h.input),g.execute!=null&&h.providerExecuted!==!0){let t=l();f.add(t),zx({toolCall:h,tools:e,tracer:n,telemetry:r,messages:a,abortSignal:o,experimental_context:c,onPreliminaryToolResult:e=>{u.enqueue(e)}}).then(e=>{u.enqueue(e)}).catch(e=>{u.enqueue({type:`error`,error:e})}).finally(()=>{f.delete(t),_()})}}catch(e){u.enqueue({type:`error`,error:e})}break;case`tool-result`:{let e=t.toolName;t.isError?u.enqueue({type:`tool-error`,toolCallId:t.toolCallId,toolName:e,input:p.get(t.toolCallId),providerExecuted:!0,error:t.result,dynamic:t.dynamic}):d.enqueue({type:`tool-result`,toolCallId:t.toolCallId,toolName:e,input:p.get(t.toolCallId),output:t.result,providerExecuted:!0,dynamic:t.dynamic});break}default:{let e=h;throw Error(`Unhandled chunk type: ${e}`)}}},flush(){h=!0,_()}});return new ReadableStream({async start(e){return Promise.all([t.pipeThrough(v).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])}})}var WS=hu({prefix:`aitxt`,size:24});function GS({model:e,tools:t,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,timeout:c,headers:l,stopWhen:u=nS(1),experimental_output:d,output:f=d,experimental_telemetry:p,prepareStep:m,providerOptions:h,experimental_activeTools:g,activeTools:_=g,experimental_repairToolCall:v,experimental_transform:ee,experimental_download:y,includeRawChunks:b=!1,onChunk:te,onError:x=({error:e})=>{console.error(e)},onFinish:S,onAbort:ne,onStepFinish:C,experimental_context:re,_internal:{now:w=HS,generateId:ie=WS}={},...ae}){let T=kb(c),oe=Ab(c),se=jb(c),E=oe==null?void 0:new AbortController,ce=se==null?void 0:new AbortController;return new qS({model:Cb(e),telemetry:p,headers:l,settings:ae,maxRetries:o,abortSignal:oS(s,T==null?void 0:AbortSignal.timeout(T),E?.signal,ce?.signal),stepTimeoutMs:oe,stepAbortController:E,chunkTimeoutMs:se,chunkAbortController:ce,system:r,prompt:i,messages:a,tools:t,toolChoice:n,transforms:Gb(ee),activeTools:_,repairToolCall:v,stopConditions:Gb(u),output:f,providerOptions:h,prepareStep:m,includeRawChunks:b,onChunk:te,onError:x,onFinish:S,onAbort:ne,onStepFinish:C,now:w,generateId:ie,experimental_context:re,download:y})}function KS(e){let t,n=``,r=``,i,a=``;function o({controller:e,partialOutput:n=void 0}){e.enqueue({part:{type:`text-delta`,id:t,text:r,providerMetadata:i},partialOutput:n}),r=``}return new TransformStream({async transform(s,c){if(s.type===`finish-step`&&r.length>0&&o({controller:c}),s.type!==`text-delta`&&s.type!==`text-start`&&s.type!==`text-end`){c.enqueue({part:s,partialOutput:void 0});return}if(t==null)t=s.id;else if(s.id!==t){c.enqueue({part:s,partialOutput:void 0});return}if(s.type===`text-start`){c.enqueue({part:s,partialOutput:void 0});return}if(s.type===`text-end`){r.length>0&&o({controller:c}),c.enqueue({part:s,partialOutput:void 0});return}n+=s.text,r+=s.text,i=s.providerMetadata??i;let l=await e.parsePartialOutput({text:n});if(l!==void 0){let e=JSON.stringify(l.partial);e!==a&&(o({controller:c,partialOutput:l.partial}),a=e)}}})}var qS=class{constructor({model:e,telemetry:t,headers:n,settings:r,maxRetries:i,abortSignal:a,stepTimeoutMs:o,stepAbortController:s,chunkTimeoutMs:c,chunkAbortController:l,system:u,prompt:d,messages:f,tools:p,toolChoice:m,transforms:h,activeTools:g,repairToolCall:_,stopConditions:ee,output:y,providerOptions:b,prepareStep:te,includeRawChunks:x,now:S,generateId:ne,onChunk:C,onError:re,onFinish:w,onAbort:ie,onStepFinish:ae,experimental_context:T,download:oe}){this._totalUsage=new eu,this._finishReason=new eu,this._rawFinishReason=new eu,this._steps=new eu,this.outputSpecification=y,this.includeRawChunks=x,this.tools=p;let se,E=[],ce=[],le,ue,de,fe={},pe=[],me=[],he=new Map,ge,_e={},ve={},ye=new TransformStream({async transform(t,n){n.enqueue(t);let{part:r}=t;if((r.type===`text-delta`||r.type===`reasoning-delta`||r.type===`source`||r.type===`tool-call`||r.type===`tool-result`||r.type===`tool-input-start`||r.type===`tool-input-delta`||r.type===`raw`)&&await C?.({chunk:r}),r.type===`error`&&await re({error:vx(r.error)}),r.type===`text-start`&&(_e[r.id]={type:`text`,text:``,providerMetadata:r.providerMetadata},E.push(_e[r.id])),r.type===`text-delta`){let e=_e[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`text part ${r.id} not found`},partialOutput:void 0});return}e.text+=r.text,e.providerMetadata=r.providerMetadata??e.providerMetadata}if(r.type===`text-end`){let e=_e[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`text part ${r.id} not found`},partialOutput:void 0});return}e.providerMetadata=r.providerMetadata??e.providerMetadata,delete _e[r.id]}if(r.type===`reasoning-start`&&(ve[r.id]={type:`reasoning`,text:``,providerMetadata:r.providerMetadata},E.push(ve[r.id])),r.type===`reasoning-delta`){let e=ve[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`reasoning part ${r.id} not found`},partialOutput:void 0});return}e.text+=r.text,e.providerMetadata=r.providerMetadata??e.providerMetadata}if(r.type===`reasoning-end`){let e=ve[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`reasoning part ${r.id} not found`},partialOutput:void 0});return}e.providerMetadata=r.providerMetadata??e.providerMetadata,delete ve[r.id]}if(r.type===`file`&&E.push({type:`file`,file:r.file}),r.type===`source`&&E.push(r),r.type===`tool-call`&&E.push(r),r.type===`tool-result`&&!r.preliminary&&E.push(r),r.type===`tool-approval-request`&&E.push(r),r.type===`tool-error`&&E.push(r),r.type===`start-step`&&(E=[],ve={},_e={},fe=r.request,pe=r.warnings),r.type===`finish-step`){let t=await aS({content:E,tools:p}),n=new tS({content:E,finishReason:r.finishReason,rawFinishReason:r.rawFinishReason,usage:r.usage,warnings:pe,request:fe,response:{...r.response,messages:[...ce,...t]},providerMetadata:r.providerMetadata});await ae?.(n),pb({warnings:pe,provider:e.provider,model:e.modelId}),me.push(n),ce.push(...t),se.resolve()}r.type===`finish`&&(de=r.totalUsage,le=r.finishReason,ue=r.rawFinishReason)},async flush(e){try{if(me.length===0){let e=a?.aborted?a.reason:new Ey({message:`No output generated. Check the stream for errors.`});Oe._finishReason.reject(e),Oe._rawFinishReason.reject(e),Oe._totalUsage.reject(e),Oe._steps.reject(e);return}let e=le??`other`,n=de??kx();Oe._finishReason.resolve(e),Oe._rawFinishReason.resolve(ue),Oe._totalUsage.resolve(n),Oe._steps.resolve(me);let r=me[me.length-1];await w?.({finishReason:r.finishReason,rawFinishReason:r.rawFinishReason,totalUsage:n,usage:r.usage,content:r.content,text:r.text,reasoningText:r.reasoningText,reasoning:r.reasoning,files:r.files,sources:r.sources,toolCalls:r.toolCalls,staticToolCalls:r.staticToolCalls,dynamicToolCalls:r.dynamicToolCalls,toolResults:r.toolResults,staticToolResults:r.staticToolResults,dynamicToolResults:r.dynamicToolResults,request:r.request,response:r.response,warnings:r.warnings,providerMetadata:r.providerMetadata,steps:me,experimental_context:T}),ge.setAttributes(await $({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>r.text},"ai.response.toolCalls":{output:()=>r.toolCalls?.length?JSON.stringify(r.toolCalls):void 0},"ai.response.providerMetadata":JSON.stringify(r.providerMetadata),"ai.usage.inputTokens":n.inputTokens,"ai.usage.outputTokens":n.outputTokens,"ai.usage.totalTokens":n.totalTokens,"ai.usage.reasoningTokens":n.reasoningTokens,"ai.usage.cachedInputTokens":n.cachedInputTokens}}))}catch(t){e.error(t)}finally{ge.end()}}}),be=VS();this.addStream=be.addStream,this.closeStream=be.close;let xe=be.stream.getReader(),Se=new ReadableStream({async start(e){e.enqueue({type:`start`})},async pull(e){function t(){ie?.({steps:me}),e.enqueue({type:`abort`,...a?.reason===void 0?{}:{reason:v(a.reason)}}),e.close()}try{let{done:n,value:r}=await xe.read();if(n){e.close();return}if(a?.aborted){t();return}e.enqueue(r)}catch(n){vu(n)&&a?.aborted?t():e.error(n)}},cancel(e){return be.stream.cancel(e)}});for(let e of h)Se=Se.pipeThrough(e({tools:p,stopStream(){be.terminate()}}));this.baseStream=Se.pipeThrough(KS(y??qx())).pipeThrough(ye);let{maxRetries:Ce,retry:we}=Lx({maxRetries:i,abortSignal:a}),Te=wx(t),Ee=$b(r),De=bx({model:e,telemetry:t,headers:n,settings:{...Ee,maxRetries:Ce}}),Oe=this;Tx({name:`ai.streamText`,attributes:$({telemetry:t,attributes:{...yx({operationId:`ai.streamText`,telemetry:t}),...De,"ai.prompt":{input:()=>JSON.stringify({system:u,prompt:d,messages:f})}}}),tracer:Te,endWhenDone:!1,fn:async r=>{ge=r;let i=await _x({system:u,prompt:d,messages:f}),h=i.messages,v=[],{approvedToolApprovals:x,deniedToolApprovals:C}=Rx({messages:h});if(C.length>0||x.length>0){let e=[...x,...C].filter(e=>e.toolCall.providerExecuted),n=x.filter(e=>!e.toolCall.providerExecuted),r=C.filter(e=>!e.toolCall.providerExecuted),i=C.filter(e=>e.toolCall.providerExecuted),o,s=new ReadableStream({start(e){o=e}});Oe.addStream(s);try{for(let e of[...r,...i])o?.enqueue({type:`tool-output-denied`,toolCallId:e.toolCall.toolCallId,toolName:e.toolCall.toolName});let s=[];if(await Promise.all(n.map(async e=>{let n=await zx({toolCall:e.toolCall,tools:p,tracer:Te,telemetry:t,messages:h,abortSignal:a,experimental_context:T,onPreliminaryToolResult:e=>{o?.enqueue(e)}});n!=null&&(o?.enqueue(n),s.push(n))})),e.length>0&&v.push({role:`tool`,content:e.map(e=>({type:`tool-approval-response`,approvalId:e.approvalResponse.approvalId,approved:e.approvalResponse.approved,reason:e.approvalResponse.reason,providerExecuted:!0}))}),s.length>0||r.length>0){let e=[];for(let t of s)e.push({type:`tool-result`,toolCallId:t.toolCallId,toolName:t.toolName,output:await Zb({toolCallId:t.toolCallId,input:t.input,tool:p?.[t.toolName],output:t.type===`tool-result`?t.output:t.error,errorMode:t.type===`tool-error`?`json`:`none`})});for(let t of r)e.push({type:`tool-result`,toolCallId:t.toolCall.toolCallId,toolName:t.toolCall.toolName,output:{type:`execution-denied`,reason:t.approvalResponse.reason}});v.push({role:`tool`,content:e})}}finally{o?.close()}}ce.push(...v);async function re({currentStep:r,responseMessages:d,usage:f}){let v=Oe.includeRawChunks,x=o==null?void 0:setTimeout(()=>s.abort(),o),C;function w(){c!=null&&(C!=null&&clearTimeout(C),C=setTimeout(()=>l.abort(),c))}function ie(){C!=null&&(clearTimeout(C),C=void 0)}function ae(){x!=null&&clearTimeout(x)}se=new eu;let E=[...h,...d],ce=await te?.({model:e,steps:me,stepNumber:me.length,messages:E,experimental_context:T}),le=Cb(ce?.model??e),ue=await Kb({prompt:{system:ce?.system??i.system,messages:ce?.messages??E},supportedUrls:await le.supportedUrls,download:oe}),{toolChoice:de,tools:fe}=await tx({tools:p,toolChoice:ce?.toolChoice??m,activeTools:ce?.activeTools??g});T=ce?.experimental_context??T;let pe=Nx(b,ce?.providerOptions),{result:{stream:ge,response:_e,request:ve},doStreamSpan:ye,startTimestampMs:be}=await we(()=>Tx({name:`ai.streamText.doStream`,attributes:$({telemetry:t,attributes:{...yx({operationId:`ai.streamText.doStream`,telemetry:t}),...De,"ai.model.provider":le.provider,"ai.model.id":le.modelId,"ai.prompt.messages":{input:()=>Dx(ue)},"ai.prompt.tools":{input:()=>fe?.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>de==null?void 0:JSON.stringify(de)},"gen_ai.system":le.provider,"gen_ai.request.model":le.modelId,"gen_ai.request.frequency_penalty":Ee.frequencyPenalty,"gen_ai.request.max_tokens":Ee.maxOutputTokens,"gen_ai.request.presence_penalty":Ee.presencePenalty,"gen_ai.request.stop_sequences":Ee.stopSequences,"gen_ai.request.temperature":Ee.temperature,"gen_ai.request.top_k":Ee.topK,"gen_ai.request.top_p":Ee.topP}}),tracer:Te,endWhenDone:!1,fn:async e=>({startTimestampMs:S(),doStreamSpan:e,result:await le.doStream({...Ee,tools:fe,toolChoice:de,responseFormat:await y?.responseFormat,prompt:ue,providerOptions:pe,abortSignal:a,headers:n,includeRawChunks:v})})})),xe=US({tools:p,generatorStream:ge,tracer:Te,telemetry:t,system:u,messages:E,repairToolCall:_,abortSignal:a,experimental_context:T,generateId:ne}),Se=ve??{},Ce=[],ke=[],Ae,je={},Me=`other`,Ne,Pe=kx(),Fe,Ie=!0,Le={id:ne(),timestamp:new Date,modelId:e.modelId},Re=``;Oe.addStream(xe.pipeThrough(new TransformStream({async transform(e,t){if(w(),e.type===`stream-start`){Ae=e.warnings;return}if(Ie){let e=S()-be;Ie=!1,ye.addEvent(`ai.stream.firstChunk`,{"ai.response.msToFirstChunk":e}),ye.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:`start-step`,request:Se,warnings:Ae??[]})}let n=e.type;switch(n){case`tool-approval-request`:case`text-start`:case`text-end`:t.enqueue(e);break;case`text-delta`:e.delta.length>0&&(t.enqueue({type:`text-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),Re+=e.delta);break;case`reasoning-start`:case`reasoning-end`:t.enqueue(e);break;case`reasoning-delta`:t.enqueue({type:`reasoning-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case`tool-call`:t.enqueue(e),Ce.push(e);break;case`tool-result`:t.enqueue(e),e.preliminary||ke.push(e);break;case`tool-error`:t.enqueue(e),ke.push(e);break;case`response-metadata`:Le={id:e.id??Le.id,timestamp:e.timestamp??Le.timestamp,modelId:e.modelId??Le.modelId};break;case`finish`:{Pe=e.usage,Me=e.finishReason,Ne=e.rawFinishReason,Fe=e.providerMetadata;let t=S()-be;ye.addEvent(`ai.stream.finish`),ye.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*(Pe.outputTokens??0)/t});break}case`file`:t.enqueue(e);break;case`source`:t.enqueue(e);break;case`tool-input-start`:{je[e.id]=e.toolName;let n=p?.[e.toolName];n?.onInputStart!=null&&await n.onInputStart({toolCallId:e.id,messages:E,abortSignal:a,experimental_context:T}),t.enqueue({...e,dynamic:e.dynamic??n?.type===`dynamic`,title:n?.title});break}case`tool-input-end`:delete je[e.id],t.enqueue(e);break;case`tool-input-delta`:{let n=je[e.id],r=p?.[n];r?.onInputDelta!=null&&await r.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:E,abortSignal:a,experimental_context:T}),t.enqueue(e);break}case`error`:t.enqueue(e),Me=`error`;break;case`raw`:v&&t.enqueue(e);break;default:{let e=n;throw Error(`Unknown chunk type: ${e}`)}}},async flush(e){let n=Ce.length>0?JSON.stringify(Ce):void 0;try{ye.setAttributes(await $({telemetry:t,attributes:{"ai.response.finishReason":Me,"ai.response.text":{output:()=>Re},"ai.response.toolCalls":{output:()=>n},"ai.response.id":Le.id,"ai.response.model":Le.modelId,"ai.response.timestamp":Le.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Fe),"ai.usage.inputTokens":Pe.inputTokens,"ai.usage.outputTokens":Pe.outputTokens,"ai.usage.totalTokens":Pe.totalTokens,"ai.usage.reasoningTokens":Pe.reasoningTokens,"ai.usage.cachedInputTokens":Pe.cachedInputTokens,"gen_ai.response.finish_reasons":[Me],"gen_ai.response.id":Le.id,"gen_ai.response.model":Le.modelId,"gen_ai.usage.input_tokens":Pe.inputTokens,"gen_ai.usage.output_tokens":Pe.outputTokens}}))}catch{}finally{ye.end()}e.enqueue({type:`finish-step`,finishReason:Me,rawFinishReason:Ne,usage:Pe,providerMetadata:Fe,response:{...Le,headers:_e?.headers}});let i=Ax(f,Pe);await se.promise;let a=Ce.filter(e=>e.providerExecuted!==!0),o=ke.filter(e=>e.providerExecuted!==!0);for(let e of Ce){if(e.providerExecuted!==!0)continue;let t=p?.[e.toolName];t?.type===`provider`&&t.supportsDeferredResults&&(ke.some(t=>t.type===`tool-result`&&t.toolCallId===e.toolCallId)||he.set(e.toolCallId,{toolName:e.toolName}))}for(let e of ke)e.type===`tool-result`&&he.delete(e.toolCallId);if(ae(),ie(),(a.length>0&&o.length===a.length||he.size>0)&&!await iS({stopConditions:ee,steps:me})){d.push(...await aS({content:me[me.length-1].content,tools:p}));try{await re({currentStep:r+1,responseMessages:d,usage:i})}catch(t){e.enqueue({type:`error`,error:t}),Oe.closeStream()}}else e.enqueue({type:`finish`,finishReason:Me,rawFinishReason:Ne,totalUsage:i}),Oe.closeStream()}})))}await re({currentStep:0,responseMessages:v,usage:kx()})}}).catch(e=>{Oe.addStream(new ReadableStream({start(t){t.enqueue({type:`error`,error:e}),t.close()}})),Oe.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}get rawFinishReason(){return this.consumeStream(),this._rawFinishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return RS(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type===`text-delta`&&t.enqueue(e.text)}})))}get fullStream(){return RS(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await zS({stream:this.fullStream,onError:e?.onError})}catch(n){(t=e?.onError)==null||t.call(e,n)}}get experimental_partialOutputStream(){return this.partialOutputStream}get partialOutputStream(){return RS(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}get elementStream(){let e=this.outputSpecification?.createElementStreamTransform();if(e==null)throw new rt({functionality:`element streams in ${this.outputSpecification?.name??`text`} mode`});return RS(this.teeStream().pipeThrough(e))}get output(){return this.finalStep.then(e=>(this.outputSpecification??qx()).parseCompleteOutput({text:e.text},{response:e.response,usage:e.usage,finishReason:e.finishReason}))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i=!0,sendSources:a=!1,sendStart:o=!0,sendFinish:s=!0,onError:c=v}={}){let l=t==null?void 0:bS({originalMessages:e,responseMessageId:t}),u=e=>{let t=this.tools?.[e.toolName];return t==null?e.dynamic:t?.type===`dynamic`?!0:void 0};return RS(IS({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let n=r?.({part:e}),d=e.type;switch(d){case`text-start`:t.enqueue({type:`text-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-delta`:t.enqueue({type:`text-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-end`:t.enqueue({type:`text-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-start`:t.enqueue({type:`reasoning-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-delta`:i&&t.enqueue({type:`reasoning-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-end`:t.enqueue({type:`reasoning-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`file`:t.enqueue({type:`file`,mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case`source`:a&&e.sourceType===`url`&&t.enqueue({type:`source-url`,sourceId:e.id,url:e.url,title:e.title,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}),a&&e.sourceType===`document`&&t.enqueue({type:`source-document`,sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`tool-input-start`:{let n=u(e);t.enqueue({type:`tool-input-start`,toolCallId:e.id,toolName:e.toolName,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n},...e.title==null?{}:{title:e.title}});break}case`tool-input-delta`:t.enqueue({type:`tool-input-delta`,toolCallId:e.id,inputTextDelta:e.delta});break;case`tool-call`:{let n=u(e);e.invalid?t.enqueue({type:`tool-input-error`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n},errorText:c(e.error),...e.title==null?{}:{title:e.title}}):t.enqueue({type:`tool-input-available`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n},...e.title==null?{}:{title:e.title}});break}case`tool-approval-request`:t.enqueue({type:`tool-approval-request`,approvalId:e.approvalId,toolCallId:e.toolCall.toolCallId});break;case`tool-result`:{let n=u(e);t.enqueue({type:`tool-output-available`,toolCallId:e.toolCallId,output:e.output,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.preliminary==null?{}:{preliminary:e.preliminary},...n==null?{}:{dynamic:n}});break}case`tool-error`:{let n=u(e);t.enqueue({type:`tool-output-error`,toolCallId:e.toolCallId,errorText:c(e.error),...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...n==null?{}:{dynamic:n}});break}case`tool-output-denied`:t.enqueue({type:`tool-output-denied`,toolCallId:e.toolCallId});break;case`error`:t.enqueue({type:`error`,errorText:c(e.error)});break;case`start-step`:t.enqueue({type:`start-step`});break;case`finish-step`:t.enqueue({type:`finish-step`});break;case`start`:o&&t.enqueue({type:`start`,...n==null?{}:{messageMetadata:n},...l==null?{}:{messageId:l}});break;case`finish`:s&&t.enqueue({type:`finish`,finishReason:e.finishReason,...n==null?{}:{messageMetadata:n}});break;case`abort`:t.enqueue(e);break;case`tool-input-end`:break;case`raw`:break;default:{let e=d;throw Error(`Unknown chunk type: ${e}`)}}n!=null&&d!==`start`&&d!==`finish`&&t.enqueue({type:`message-metadata`,messageMetadata:n})}})),messageId:l??t?.(),originalMessages:e,onFinish:n,onError:c}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l,...u}={}){LS({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l}),...u})}pipeTextStreamToResponse(e,t){gS({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c,...l}={}){return yS({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c}),...l})}toTextStreamResponse(e){return mS({textStream:this.textStream,...e})}},JS=class{constructor(e){this.version=`agent-v1`,this.settings=e}get id(){return this.settings.id}get tools(){return this.settings.tools}async prepareCall(e){var t;let n={...this.settings,stopWhen:this.settings.stopWhen??nS(20),...e},{instructions:r,messages:i,prompt:a,...o}=await(t=this.settings).prepareCall?.call(t,n)??n;return{...o,system:r,messages:i,prompt:a}}async generate({abortSignal:e,timeout:t,...n}){return cS({...await this.prepareCall(n),abortSignal:e,timeout:t})}async stream({abortSignal:e,timeout:t,experimental_transform:n,...r}){return GS({...await this.prepareCall(r),abortSignal:e,timeout:t,experimental_transform:n})}};function YS({execute:e,onError:t=_u,originalMessages:n,onFinish:r,generateId:i=gu}){let a,o=[],s=new ReadableStream({start(e){a=e}});function c(e){try{a.enqueue(e)}catch{}}try{let n=e({writer:{write(e){c(e)},merge(e){o.push((async()=>{let t=e.getReader();for(;;){let{done:e,value:n}=await t.read();if(e)break;c(n)}})().catch(e=>{c({type:`error`,errorText:t(e)})}))},onError:t}});n&&o.push(n.catch(e=>{c({type:`error`,errorText:t(e)})}))}catch(e){c({type:`error`,errorText:t(e)})}return new Promise(async e=>{for(;o.length>0;)await o.shift();e()}).finally(()=>{try{a.close()}catch{}}),IS({stream:s,messageId:i(),originalMessages:n,onFinish:r,onError:t})}function XS({message:e,stream:t,onError:n,terminateOnError:r=!1}){let i,a=!1,o=new ReadableStream({start(e){i=e}}),s=PS({messageId:e?.id??``,lastMessage:e}),c=e=>{n?.(e),!a&&r&&(a=!0,i?.error(e))};return zS({stream:FS({stream:t,runUpdateMessageJob(e){return e({state:s,write:()=>{i?.enqueue(structuredClone(s.message))}})},onError:c}),onError:c}).finally(()=>{a||i?.close()}),RS(o)}async function ZS(e,t){let n=[];t?.ignoreIncompleteToolCalls&&(e=e.map(e=>({...e,parts:e.parts.filter(e=>!kS(e)||e.state!==`input-streaming`&&e.state!==`input-available`)})));for(let r of e)switch(r.role){case`system`:{let e=r.parts.filter(e=>e.type===`text`),t=e.reduce((e,t)=>t.providerMetadata==null?e:{...e,...t.providerMetadata},{});n.push({role:`system`,content:e.map(e=>e.text).join(``),...Object.keys(t).length>0?{providerOptions:t}:{}});break}case`user`:n.push({role:`user`,content:r.parts.map(e=>{if(wS(e))return{type:`text`,text:e.text,...e.providerMetadata==null?{}:{providerOptions:e.providerMetadata}};if(TS(e))return{type:`file`,mediaType:e.mediaType,filename:e.filename,data:e.url,...e.providerMetadata==null?{}:{providerOptions:e.providerMetadata}};if(CS(e))return(t?.convertDataPart)?.call(t,e)}).filter(Mu)});break;case`assistant`:if(r.parts!=null){let e=[];async function i(){if(e.length===0)return;let r=[];for(let n of e)if(wS(n))r.push({type:`text`,text:n.text,...n.providerMetadata==null?{}:{providerOptions:n.providerMetadata}});else if(TS(n))r.push({type:`file`,mediaType:n.mediaType,filename:n.filename,data:n.url});else if(ES(n))r.push({type:`reasoning`,text:n.text,providerOptions:n.providerMetadata});else if(kS(n)){let e=MS(n);n.state!==`input-streaming`&&(r.push({type:`tool-call`,toolCallId:n.toolCallId,toolName:e,input:n.state===`output-error`?n.input??(`rawInput`in n?n.rawInput:void 0):n.input,providerExecuted:n.providerExecuted,...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}}),n.approval!=null&&r.push({type:`tool-approval-request`,approvalId:n.approval.id,toolCallId:n.toolCallId}),n.providerExecuted===!0&&n.state!==`approval-responded`&&(n.state===`output-available`||n.state===`output-error`)&&r.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:e,output:await Zb({toolCallId:n.toolCallId,input:n.input,output:n.state===`output-error`?n.errorText:n.output,tool:t?.tools?.[e],errorMode:n.state===`output-error`?`json`:`none`}),...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}}))}else if(CS(n)){let e=(t?.convertDataPart)?.call(t,n);e!=null&&r.push(e)}else{let e=n;throw Error(`Unsupported part: ${e}`)}n.push({role:`assistant`,content:r});let i=e.filter(e=>kS(e)&&(e.providerExecuted!==!0||e.approval?.approved!=null));if(i.length>0){let e=[];for(let n of i)if(n.approval?.approved!=null&&e.push({type:`tool-approval-response`,approvalId:n.approval.id,approved:n.approval.approved,reason:n.approval.reason,providerExecuted:n.providerExecuted}),n.providerExecuted!==!0)switch(n.state){case`output-denied`:e.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:MS(n),output:{type:`error-text`,value:n.approval.reason??`Tool execution denied.`},...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}});break;case`output-error`:case`output-available`:{let r=MS(n);e.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:r,output:await Zb({toolCallId:n.toolCallId,input:n.input,output:n.state===`output-error`?n.errorText:n.output,tool:t?.tools?.[r],errorMode:n.state===`output-error`?`text`:`none`}),...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}});break}}e.length>0&&n.push({role:`tool`,content:e})}e=[]}for(let t of r.parts)wS(t)||ES(t)||TS(t)||kS(t)||CS(t)?e.push(t):t.type===`step-start`&&await i();await i();break}break;default:{let e=r.role;throw new ib({originalMessage:r,message:`Unsupported role: ${e}`})}}return n}var QS=X(()=>Z(F(I({id:A(),role:z([`system`,`user`,`assistant`]),metadata:N().optional(),parts:F(L([I({type:B(`text`),text:A(),state:z([`streaming`,`done`]).optional(),providerMetadata:Q.optional()}),I({type:B(`reasoning`),text:A(),state:z([`streaming`,`done`]).optional(),providerMetadata:Q.optional()}),I({type:B(`source-url`),sourceId:A(),url:A(),title:A().optional(),providerMetadata:Q.optional()}),I({type:B(`source-document`),sourceId:A(),mediaType:A(),title:A(),filename:A().optional(),providerMetadata:Q.optional()}),I({type:B(`file`),mediaType:A(),filename:A().optional(),url:A(),providerMetadata:Q.optional()}),I({type:B(`step-start`)}),I({type:A().startsWith(`data-`),id:A().optional(),data:N()}),I({type:B(`dynamic-tool`),toolName:A(),toolCallId:A(),state:B(`input-streaming`),input:N().optional(),providerExecuted:M().optional(),callProviderMetadata:Q.optional(),output:P().optional(),errorText:P().optional(),approval:P().optional()}),I({type:B(`dynamic-tool`),toolName:A(),toolCallId:A(),state:B(`input-available`),input:N(),providerExecuted:M().optional(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:P().optional()}),I({type:B(`dynamic-tool`),toolName:A(),toolCallId:A(),state:B(`approval-requested`),input:N(),providerExecuted:M().optional(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:P().optional(),reason:P().optional()})}),I({type:B(`dynamic-tool`),toolName:A(),toolCallId:A(),state:B(`approval-responded`),input:N(),providerExecuted:M().optional(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:M(),reason:A().optional()})}),I({type:B(`dynamic-tool`),toolName:A(),toolCallId:A(),state:B(`output-available`),input:N(),providerExecuted:M().optional(),output:N(),errorText:P().optional(),callProviderMetadata:Q.optional(),preliminary:M().optional(),approval:I({id:A(),approved:B(!0),reason:A().optional()}).optional()}),I({type:B(`dynamic-tool`),toolName:A(),toolCallId:A(),state:B(`output-error`),input:N(),rawInput:N().optional(),providerExecuted:M().optional(),output:P().optional(),errorText:A(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:B(!0),reason:A().optional()}).optional()}),I({type:B(`dynamic-tool`),toolName:A(),toolCallId:A(),state:B(`output-denied`),input:N(),providerExecuted:M().optional(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:B(!1),reason:A().optional()})}),I({type:A().startsWith(`tool-`),toolCallId:A(),state:B(`input-streaming`),providerExecuted:M().optional(),callProviderMetadata:Q.optional(),input:N().optional(),output:P().optional(),errorText:P().optional(),approval:P().optional()}),I({type:A().startsWith(`tool-`),toolCallId:A(),state:B(`input-available`),providerExecuted:M().optional(),input:N(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:P().optional()}),I({type:A().startsWith(`tool-`),toolCallId:A(),state:B(`approval-requested`),input:N(),providerExecuted:M().optional(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:P().optional(),reason:P().optional()})}),I({type:A().startsWith(`tool-`),toolCallId:A(),state:B(`approval-responded`),input:N(),providerExecuted:M().optional(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:M(),reason:A().optional()})}),I({type:A().startsWith(`tool-`),toolCallId:A(),state:B(`output-available`),providerExecuted:M().optional(),input:N(),output:N(),errorText:P().optional(),callProviderMetadata:Q.optional(),preliminary:M().optional(),approval:I({id:A(),approved:B(!0),reason:A().optional()}).optional()}),I({type:A().startsWith(`tool-`),toolCallId:A(),state:B(`output-error`),providerExecuted:M().optional(),input:N(),rawInput:N().optional(),output:P().optional(),errorText:A(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:B(!0),reason:A().optional()}).optional()}),I({type:A().startsWith(`tool-`),toolCallId:A(),state:B(`output-denied`),providerExecuted:M().optional(),input:N(),output:P().optional(),errorText:P().optional(),callProviderMetadata:Q.optional(),approval:I({id:A(),approved:B(!1),reason:A().optional()})})])).nonempty(`Message must contain at least one part`)})).nonempty(`Messages array must not be empty`)));async function $S({messages:e,metadataSchema:t,dataSchemas:n,tools:r}){try{if(e==null)return{success:!1,error:new Bv({parameter:`messages`,value:e,message:`messages parameter must be provided`})};let i=await Qd({value:e,schema:QS});if(t)for(let e of i)await Qd({value:e.metadata,schema:t});if(n)for(let e of i){let t=e.parts.filter(e=>e.type.startsWith(`data-`));for(let e of t){let t=e.type.slice(5),r=n[t];if(!r)return{success:!1,error:new Ze({value:e.data,cause:`No data schema found for data part ${t}`})};await Qd({value:e.data,schema:r})}}if(r)for(let e of i){let t=e.parts.filter(e=>e.type.startsWith(`tool-`));for(let e of t){let t=e.type.slice(5),n=r[t];if(!n)return{success:!1,error:new Ze({value:e.input,cause:`No tool schema found for tool part ${t}`})};(e.state===`input-available`||e.state===`output-available`||e.state===`output-error`&&e.input!==void 0)&&await Qd({value:e.input,schema:n.inputSchema}),e.state===`output-available`&&n.outputSchema&&await Qd({value:e.output,schema:n.outputSchema})}}return{success:!0,data:i}}catch(e){return{success:!1,error:e}}}async function eC({messages:e,metadataSchema:t,dataSchemas:n,tools:r}){let i=await $S({messages:e,metadataSchema:t,dataSchemas:n,tools:r});if(!i.success)throw i.error;return i.data}async function tC({agent:e,uiMessages:t,options:n,abortSignal:r,timeout:i,experimental_transform:a,...o}){let s=await ZS(await eC({messages:t,tools:e.tools}),{tools:e.tools});return(await e.stream({prompt:s,options:n,abortSignal:r,timeout:i,experimental_transform:a})).toUIMessageStream(o)}async function nC({headers:e,status:t,statusText:n,consumeSseStream:r,...i}){return yS({headers:e,status:t,statusText:n,consumeSseStream:r,stream:await tC(i)})}async function rC({response:e,headers:t,status:n,statusText:r,consumeSseStream:i,...a}){LS({response:e,headers:t,status:n,statusText:r,consumeSseStream:i,stream:await tC(a)})}async function iC({model:e,value:t,providerOptions:n,maxRetries:r,abortSignal:i,headers:a,experimental_telemetry:o}){let s=wb(e),{maxRetries:c,retry:l}=Lx({maxRetries:r,abortSignal:i}),u=Cu(a??{},`ai/${Lb}`),d=bx({model:s,telemetry:o,headers:u,settings:{maxRetries:c}}),f=wx(o);return Tx({name:`ai.embed`,attributes:$({telemetry:o,attributes:{...yx({operationId:`ai.embed`,telemetry:o}),...d,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:f,fn:async e=>{let{embedding:r,usage:a,warnings:c,response:p,providerMetadata:m}=await l(()=>Tx({name:`ai.embed.doEmbed`,attributes:$({telemetry:o,attributes:{...yx({operationId:`ai.embed.doEmbed`,telemetry:o}),...d,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:f,fn:async e=>{let r=await s.doEmbed({values:[t],abortSignal:i,headers:u,providerOptions:n}),a=r.embeddings[0],c=r.usage??{tokens:NaN};return e.setAttributes(await $({telemetry:o,attributes:{"ai.embeddings":{output:()=>r.embeddings.map(e=>JSON.stringify(e))},"ai.usage.tokens":c.tokens}})),{embedding:a,usage:c,warnings:r.warnings,providerMetadata:r.providerMetadata,response:r.response}}}));return e.setAttributes(await $({telemetry:o,attributes:{"ai.embedding":{output:()=>JSON.stringify(r)},"ai.usage.tokens":a.tokens}})),pb({warnings:c,provider:s.provider,model:s.modelId}),new aC({value:t,embedding:r,usage:a,warnings:c,providerMetadata:m,response:p})}})}var aC=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response}};function oC(e,t){if(t<=0)throw Error(`chunkSize must be greater than 0`);let n=[];for(let r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}async function sC({model:e,values:t,maxParallelCalls:n=1/0,maxRetries:r,abortSignal:i,headers:a,providerOptions:o,experimental_telemetry:s}){let c=wb(e),{maxRetries:l,retry:u}=Lx({maxRetries:r,abortSignal:i}),d=Cu(a??{},`ai/${Lb}`),f=bx({model:c,telemetry:s,headers:d,settings:{maxRetries:l}}),p=wx(s);return Tx({name:`ai.embedMany`,attributes:$({telemetry:s,attributes:{...yx({operationId:`ai.embedMany`,telemetry:s}),...f,"ai.values":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async e=>{let[r,a]=await Promise.all([c.maxEmbeddingsPerCall,c.supportsParallelCalls]);if(r==null||r===1/0){let{embeddings:n,usage:r,warnings:a,response:l,providerMetadata:m}=await u(()=>Tx({name:`ai.embedMany.doEmbed`,attributes:$({telemetry:s,attributes:{...yx({operationId:`ai.embedMany.doEmbed`,telemetry:s}),...f,"ai.values":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async e=>{let n=await c.doEmbed({values:t,abortSignal:i,headers:d,providerOptions:o}),r=n.embeddings,a=n.usage??{tokens:NaN};return e.setAttributes(await $({telemetry:s,attributes:{"ai.embeddings":{output:()=>r.map(e=>JSON.stringify(e))},"ai.usage.tokens":a.tokens}})),{embeddings:r,usage:a,warnings:n.warnings,providerMetadata:n.providerMetadata,response:n.response}}}));return e.setAttributes(await $({telemetry:s,attributes:{"ai.embeddings":{output:()=>n.map(e=>JSON.stringify(e))},"ai.usage.tokens":r.tokens}})),pb({warnings:a,provider:c.provider,model:c.modelId}),new cC({values:t,embeddings:n,usage:r,warnings:a,providerMetadata:m,responses:[l]})}let l=oC(t,r),m=[],h=[],g=[],_=0,v,ee=oC(l,a?n:1);for(let e of ee){let t=await Promise.all(e.map(e=>u(()=>Tx({name:`ai.embedMany.doEmbed`,attributes:$({telemetry:s,attributes:{...yx({operationId:`ai.embedMany.doEmbed`,telemetry:s}),...f,"ai.values":{input:()=>e.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async t=>{let n=await c.doEmbed({values:e,abortSignal:i,headers:d,providerOptions:o}),r=n.embeddings,a=n.usage??{tokens:NaN};return t.setAttributes(await $({telemetry:s,attributes:{"ai.embeddings":{output:()=>r.map(e=>JSON.stringify(e))},"ai.usage.tokens":a.tokens}})),{embeddings:r,usage:a,warnings:n.warnings,providerMetadata:n.providerMetadata,response:n.response}}}))));for(let e of t)if(m.push(...e.embeddings),h.push(...e.warnings),g.push(e.response),_+=e.usage.tokens,e.providerMetadata)if(!v)v={...e.providerMetadata};else for(let[t,n]of Object.entries(e.providerMetadata))v[t]={...v[t]??{},...n}}return e.setAttributes(await $({telemetry:s,attributes:{"ai.embeddings":{output:()=>m.map(e=>JSON.stringify(e))},"ai.usage.tokens":_}})),pb({warnings:h,provider:c.provider,model:c.modelId}),new cC({values:t,embeddings:m,usage:{tokens:_},warnings:h,providerMetadata:v,responses:g})}})}var cC=class{constructor(e){this.values=e.values,this.embeddings=e.embeddings,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.responses=e.responses}};async function lC({model:e,prompt:t,n=1,maxImagesPerCall:r,size:i,aspectRatio:a,seed:o,providerOptions:s,maxRetries:c,abortSignal:l,headers:u}){let d=Db(e),f=Cu(u??{},`ai/${Lb}`),{retry:p}=Lx({maxRetries:c,abortSignal:l}),m=r??await dC(d)??1,h=Math.ceil(n/m),g=Array.from({length:h},(e,t)=>{if(t<h-1)return m;let r=n%m;return r===0?m:r}),_=await Promise.all(g.map(async e=>p(()=>{let{prompt:n,files:r,mask:c}=fC(t);return d.doGenerate({prompt:n,files:r,mask:c,n:e,abortSignal:l,headers:f,size:i,aspectRatio:a,seed:o,providerOptions:s??{}})}))),v=[],ee=[],y=[],b={},te={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};for(let e of _){if(v.push(...e.images.map(e=>new Vx({data:e,mediaType:Ib({data:e,signatures:Mb})??`image/png`}))),ee.push(...e.warnings),e.usage!=null&&(te=Mx(te,e.usage)),e.providerMetadata)for(let[t,n]of Object.entries(e.providerMetadata))if(t===`gateway`){let e=b[t];typeof e==`object`&&e?b[t]={...e,...n}:b[t]=n;let r=b[t].images;Array.isArray(r)&&r.length===0&&delete b[t].images}else b[t]??(b[t]={images:[]}),b[t].images.push(...e.providerMetadata[t].images);y.push(e.response)}if(pb({warnings:ee,provider:d.provider,model:d.modelId}),!v.length)throw new gy({responses:y});return new uC({images:v,warnings:ee,responses:y,providerMetadata:b,usage:te})}var uC=class{constructor(e){this.images=e.images,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata,this.usage=e.usage}get image(){return this.images[0]}};async function dC(e){return e.maxImagesPerCall instanceof Function?e.maxImagesPerCall({modelId:e.modelId}):e.maxImagesPerCall}function fC(e){return typeof e==`string`?{prompt:e,files:void 0,mask:void 0}:{prompt:e.text,files:e.images.map(pC),mask:e.mask?pC(e.mask):void 0}}function pC(e){if(typeof e==`string`&&e.startsWith(`http`))return{type:`url`,url:e};if(typeof e==`string`&&e.startsWith(`data:`)){let{mediaType:t,base64Content:n}=Bb(e);if(n!=null){let e=iu(n);return{type:`file`,data:e,mediaType:t||Ib({data:e,signatures:Mb})||`image/png`}}}let t=Wb(e);return{type:`file`,data:t,mediaType:Ib({data:t,signatures:Mb})||`image/png`}}var mC=lC;function hC(e){let t=e.filter(e=>e.type===`reasoning`);return t.length===0?void 0:t.map(e=>e.text).join(`
`)}var gC={type:`no-schema`,jsonSchema:async()=>void 0,async validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},async validateFinalResult(e,t){return e===void 0?{success:!1,error:new xy({message:`No object generated: response did not match schema.`,text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e}},createElementStream(){throw new rt({functionality:`element streams in no-schema mode`})}},_C=e=>({type:`object`,jsonSchema:async()=>await e.jsonSchema,async validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},async validateFinalResult(t){return $d({value:t,schema:e})},createElementStream(){throw new rt({functionality:`element streams in object mode`})}}),vC=e=>({type:`array`,jsonSchema:async()=>{let{$schema:t,...n}=await e.jsonSchema;return{$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{elements:{type:`array`,items:n}},required:[`elements`],additionalProperties:!1}},async validatePartialResult({value:t,latestObject:n,isFirstDelta:r,isFinalDelta:i}){if(!ot(t)||!at(t.elements))return{success:!1,error:new Ze({value:t,cause:`value must be an object that contains an array of elements`})};let a=t.elements,o=[];for(let t=0;t<a.length;t++){let n=a[t],r=await $d({value:n,schema:e});if(!(t===a.length-1&&!i)){if(!r.success)return r;o.push(r.value)}}let s=n?.length??0,c=``;return r&&(c+=`[`),s>0&&(c+=`,`),c+=o.slice(s).map(e=>JSON.stringify(e)).join(`,`),i&&(c+=`]`),{success:!0,value:{partial:o,textDelta:c}}},async validateFinalResult(t){if(!ot(t)||!at(t.elements))return{success:!1,error:new Ze({value:t,cause:`value must be an object that contains an array of elements`})};let n=t.elements;for(let t of n){let n=await $d({value:t,schema:e});if(!n.success)return n}return{success:!0,value:n}},createElementStream(e){let t=0;return RS(e.pipeThrough(new TransformStream({transform(e,n){switch(e.type){case`object`:{let r=e.object;for(;t<r.length;t++)n.enqueue(r[t]);break}case`text-delta`:case`finish`:case`error`:break;default:{let t=e;throw Error(`Unsupported chunk type: ${t}`)}}}})))}}),yC=e=>({type:`enum`,jsonSchema:async()=>({$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{result:{type:`string`,enum:e}},required:[`result`],additionalProperties:!1}),async validateFinalResult(t){if(!ot(t)||typeof t.result!=`string`)return{success:!1,error:new Ze({value:t,cause:`value must be an object that contains a string in the "result" property.`})};let n=t.result;return e.includes(n)?{success:!0,value:n}:{success:!1,error:new Ze({value:t,cause:`value must be a string in the enum`})}},async validatePartialResult({value:t,textDelta:n}){if(!ot(t)||typeof t.result!=`string`)return{success:!1,error:new Ze({value:t,cause:`value must be an object that contains a string in the "result" property.`})};let r=t.result,i=e.filter(e=>e.startsWith(r));return t.result.length===0||i.length===0?{success:!1,error:new Ze({value:t,cause:`value must be a string in the enum`})}:{success:!0,value:{partial:i.length>1?r:i[0],textDelta:n}}},createElementStream(){throw new rt({functionality:`element streams in enum mode`})}});function bC({output:e,schema:t,enumValues:n}){switch(e){case`object`:return _C(qd(t));case`array`:return vC(qd(t));case`enum`:return yC(n);case`no-schema`:return gC;default:{let t=e;throw Error(`Unsupported output: ${t}`)}}}async function xC(e,t,n){let r=await tf({text:e});if(!r.success)throw new xy({message:`No object generated: could not parse the response.`,cause:r.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});let i=await t.validateFinalResult(r.value,{text:e,response:n.response,usage:n.usage});if(!i.success)throw new xy({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});return i.value}async function SC(e,t,n,r){try{return await xC(e,t,r)}catch(i){if(n!=null&&xy.isInstance(i)&&(he.isInstance(i.cause)||Ze.isInstance(i.cause))){let a=await n({text:e,error:i.cause});if(a===null)throw i;return await xC(a,t,r)}throw i}}function CC({output:e,schema:t,schemaName:n,schemaDescription:r,enumValues:i}){if(e!=null&&e!==`object`&&e!==`array`&&e!==`enum`&&e!==`no-schema`)throw new Bv({parameter:`output`,value:e,message:`Invalid output type.`});if(e===`no-schema`){if(t!=null)throw new Bv({parameter:`schema`,value:t,message:`Schema is not supported for no-schema output.`});if(r!=null)throw new Bv({parameter:`schemaDescription`,value:r,message:`Schema description is not supported for no-schema output.`});if(n!=null)throw new Bv({parameter:`schemaName`,value:n,message:`Schema name is not supported for no-schema output.`});if(i!=null)throw new Bv({parameter:`enumValues`,value:i,message:`Enum values are not supported for no-schema output.`})}if(e===`object`){if(t==null)throw new Bv({parameter:`schema`,value:t,message:`Schema is required for object output.`});if(i!=null)throw new Bv({parameter:`enumValues`,value:i,message:`Enum values are not supported for object output.`})}if(e===`array`){if(t==null)throw new Bv({parameter:`schema`,value:t,message:`Element schema is required for array output.`});if(i!=null)throw new Bv({parameter:`enumValues`,value:i,message:`Enum values are not supported for array output.`})}if(e===`enum`){if(t!=null)throw new Bv({parameter:`schema`,value:t,message:`Schema is not supported for enum output.`});if(r!=null)throw new Bv({parameter:`schemaDescription`,value:r,message:`Schema description is not supported for enum output.`});if(n!=null)throw new Bv({parameter:`schemaName`,value:n,message:`Schema name is not supported for enum output.`});if(i==null)throw new Bv({parameter:`enumValues`,value:i,message:`Enum values are required for enum output.`});for(let e of i)if(typeof e!=`string`)throw new Bv({parameter:`enumValues`,value:e,message:`Enum values must be strings.`})}}var wC=hu({prefix:`aiobj`,size:24});async function TC(e){let{model:t,output:n=`object`,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,experimental_repairText:l,experimental_telemetry:u,experimental_download:d,providerOptions:f,_internal:{generateId:p=wC,currentDate:m=()=>new Date}={},...h}=e,g=Cb(t),_=`enum`in e?e.enum:void 0,{schema:v,schemaDescription:ee,schemaName:y}=`schema`in e?e:{};CC({output:n,schema:v,schemaName:y,schemaDescription:ee,enumValues:_});let{maxRetries:b,retry:te}=Lx({maxRetries:o,abortSignal:s}),x=bC({output:n,schema:v,enumValues:_}),S=$b(h),ne=Cu(c??{},`ai/${Lb}`),C=bx({model:g,telemetry:u,headers:ne,settings:{...S,maxRetries:b}}),re=wx(u),w=await x.jsonSchema();try{return await Tx({name:`ai.generateObject`,attributes:$({telemetry:u,attributes:{...yx({operationId:`ai.generateObject`,telemetry:u}),...C,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:i,messages:a})},"ai.schema":w==null?void 0:{input:()=>JSON.stringify(w)},"ai.schema.name":y,"ai.schema.description":ee,"ai.settings.output":x.type}}),tracer:re,fn:async e=>{let t,n,o,c,_,v,b,ie,ae=await Kb({prompt:await _x({system:r,prompt:i,messages:a}),supportedUrls:await g.supportedUrls,download:d}),T=await te(()=>Tx({name:`ai.generateObject.doGenerate`,attributes:$({telemetry:u,attributes:{...yx({operationId:`ai.generateObject.doGenerate`,telemetry:u}),...C,"ai.prompt.messages":{input:()=>Dx(ae)},"gen_ai.system":g.provider,"gen_ai.request.model":g.modelId,"gen_ai.request.frequency_penalty":S.frequencyPenalty,"gen_ai.request.max_tokens":S.maxOutputTokens,"gen_ai.request.presence_penalty":S.presencePenalty,"gen_ai.request.temperature":S.temperature,"gen_ai.request.top_k":S.topK,"gen_ai.request.top_p":S.topP}}),tracer:re,fn:async e=>{let t=await g.doGenerate({responseFormat:{type:`json`,schema:w,name:y,description:ee},...$b(h),prompt:ae,providerOptions:f,abortSignal:s,headers:ne}),n={id:t.response?.id??p(),timestamp:t.response?.timestamp??m(),modelId:t.response?.modelId??g.modelId,headers:t.response?.headers,body:t.response?.body},r=Bx(t.content),i=hC(t.content);if(r===void 0)throw new xy({message:`No object generated: the model did not return a response.`,response:n,usage:Ox(t.usage),finishReason:t.finishReason.unified});return e.setAttributes(await $({telemetry:u,attributes:{"ai.response.finishReason":t.finishReason.unified,"ai.response.object":{output:()=>r},"ai.response.id":n.id,"ai.response.model":n.modelId,"ai.response.timestamp":n.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(t.providerMetadata),"ai.usage.promptTokens":t.usage.inputTokens.total,"ai.usage.completionTokens":t.usage.outputTokens.total,"gen_ai.response.finish_reasons":[t.finishReason.unified],"gen_ai.response.id":n.id,"gen_ai.response.model":n.modelId,"gen_ai.usage.input_tokens":t.usage.inputTokens.total,"gen_ai.usage.output_tokens":t.usage.outputTokens.total}})),{...t,objectText:r,reasoning:i,responseData:n}}}));t=T.objectText,n=T.finishReason.unified,o=Ox(T.usage),c=T.warnings,b=T.providerMetadata,v=T.request??{},_=T.responseData,ie=T.reasoning,pb({warnings:c,provider:g.provider,model:g.modelId});let oe=await SC(t,x,l,{response:_,usage:o,finishReason:n});return e.setAttributes(await $({telemetry:u,attributes:{"ai.response.finishReason":n,"ai.response.object":{output:()=>JSON.stringify(oe)},"ai.response.providerMetadata":JSON.stringify(b),"ai.usage.promptTokens":o.inputTokens,"ai.usage.completionTokens":o.outputTokens}})),new EC({object:oe,reasoning:ie,finishReason:n,usage:o,warnings:c,request:v,response:_,providerMetadata:b})}})}catch(e){throw vx(e)}}var EC=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.reasoning=e.reasoning}toJsonResponse(e){return new Response(JSON.stringify(this.object),{status:e?.status??200,headers:pS(e?.headers,{"content-type":`application/json; charset=utf-8`})})}};function DC(e,t){if(e.length!==t.length)throw new Bv({parameter:`vector1,vector2`,value:{vector1Length:e.length,vector2Length:t.length},message:`Vectors must have the same length`});let n=e.length;if(n===0)return 0;let r=0,i=0,a=0;for(let o=0;o<n;o++){let n=e[o],s=t[o];r+=n*n,i+=s*s,a+=n*s}return r===0||i===0?0:a/(Math.sqrt(r)*Math.sqrt(i))}function OC(e){let[t,n]=e.split(`,`);if(t.split(`;`)[0].split(`:`)[1]==null||n==null)throw Error(`Invalid data URL format`);try{return window.atob(n)}catch{throw Error(`Error decoding data URL`)}}function kC(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!=`object`&&typeof t!=`object`)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!kC(e[n],t[n]))return!1;return!0}let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let i of n)if(!r.includes(i)||!kC(e[i],t[i]))return!1;return!0}var AC=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,n)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){n(e)}}),this.processQueue()})}};function jC({chunks:e,initialDelayInMs:t=0,chunkDelayInMs:n=0,_internal:r}){let i=r?.delay??Ql,a=0;return new ReadableStream({async pull(r){a<e.length?(await i(a===0?t:n),r.enqueue(e[a++])):r.close()}})}var MC=hu({prefix:`aiobj`,size:24});function NC(e){let{model:t,output:n=`object`,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,experimental_repairText:l,experimental_telemetry:u,experimental_download:d,providerOptions:f,onError:p=({error:e})=>{console.error(e)},onFinish:m,_internal:{generateId:h=MC,currentDate:g=()=>new Date,now:_=HS}={},...v}=e,ee=`enum`in e&&e.enum?e.enum:void 0,{schema:y,schemaDescription:b,schemaName:te}=`schema`in e?e:{};return CC({output:n,schema:y,schemaName:te,schemaDescription:b,enumValues:ee}),new PC({model:t,telemetry:u,headers:c,settings:v,maxRetries:o,abortSignal:s,outputStrategy:bC({output:n,schema:y,enumValues:ee}),system:r,prompt:i,messages:a,schemaName:te,schemaDescription:b,providerOptions:f,repairText:l,onError:p,onFinish:m,download:d,generateId:h,currentDate:g,now:_})}var PC=class{constructor({model:e,headers:t,telemetry:n,settings:r,maxRetries:i,abortSignal:a,outputStrategy:o,system:s,prompt:c,messages:l,schemaName:u,schemaDescription:d,providerOptions:f,repairText:p,onError:m,onFinish:h,download:g,generateId:_,currentDate:v,now:ee}){this._object=new eu,this._usage=new eu,this._providerMetadata=new eu,this._warnings=new eu,this._request=new eu,this._response=new eu,this._finishReason=new eu;let y=Cb(e),{maxRetries:b,retry:te}=Lx({maxRetries:i,abortSignal:a}),x=$b(r),S=bx({model:y,telemetry:n,headers:t,settings:{...x,maxRetries:b}}),ne=wx(n),C=this,re=VS(),w=new TransformStream({transform(e,t){t.enqueue(e),e.type===`error`&&m({error:vx(e.error)})}});this.baseStream=re.stream.pipeThrough(w),Tx({name:`ai.streamObject`,attributes:$({telemetry:n,attributes:{...yx({operationId:`ai.streamObject`,telemetry:n}),...S,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:c,messages:l})},"ai.schema":{input:async()=>JSON.stringify(await o.jsonSchema())},"ai.schema.name":u,"ai.schema.description":d,"ai.settings.output":o.type}}),tracer:ne,endWhenDone:!1,fn:async e=>{let i=await _x({system:s,prompt:c,messages:l}),m={responseFormat:{type:`json`,schema:await o.jsonSchema(),name:u,description:d},...$b(r),prompt:await Kb({prompt:i,supportedUrls:await y.supportedUrls,download:g}),providerOptions:f,abortSignal:a,headers:t,includeRawChunks:!1},b={transform:(e,t)=>{switch(e.type){case`text-delta`:t.enqueue(e.delta);break;case`response-metadata`:case`finish`:case`error`:case`stream-start`:t.enqueue(e);break}}},{result:{stream:w,response:ie,request:ae},doStreamSpan:T,startTimestampMs:oe}=await te(()=>Tx({name:`ai.streamObject.doStream`,attributes:$({telemetry:n,attributes:{...yx({operationId:`ai.streamObject.doStream`,telemetry:n}),...S,"ai.prompt.messages":{input:()=>Dx(m.prompt)},"gen_ai.system":y.provider,"gen_ai.request.model":y.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxOutputTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.temperature":x.temperature,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:ne,endWhenDone:!1,fn:async e=>({startTimestampMs:ee(),doStreamSpan:e,result:await y.doStream(m)})}));C._request.resolve(ae??{});let se,E=kx(),ce,le,ue,de,fe=``,pe=``,me={id:_(),timestamp:v(),modelId:y.modelId},he,ge,_e=!0,ve=!0,ye=w.pipeThrough(new TransformStream(b)).pipeThrough(new TransformStream({async transform(e,t){if(typeof e==`object`&&e.type===`stream-start`){se=e.warnings;return}if(_e){let e=ee()-oe;_e=!1,T.addEvent(`ai.stream.firstChunk`,{"ai.stream.msToFirstChunk":e}),T.setAttributes({"ai.stream.msToFirstChunk":e})}if(typeof e==`string`){fe+=e,pe+=e;let{value:n,state:r}=await Kx(fe);if(n!==void 0&&!kC(he,n)){let e=await o.validatePartialResult({value:n,textDelta:pe,latestObject:ge,isFirstDelta:ve,isFinalDelta:r===`successful-parse`});e.success&&!kC(ge,e.value.partial)&&(he=n,ge=e.value.partial,t.enqueue({type:`object`,object:ge}),t.enqueue({type:`text-delta`,textDelta:e.value.textDelta}),pe=``,ve=!1)}return}switch(e.type){case`response-metadata`:me={id:e.id??me.id,timestamp:e.timestamp??me.timestamp,modelId:e.modelId??me.modelId};break;case`finish`:pe!==``&&t.enqueue({type:`text-delta`,textDelta:pe}),ce=e.finishReason.unified,E=Ox(e.usage),le=e.providerMetadata,t.enqueue({...e,finishReason:e.finishReason.unified,usage:E,response:me}),pb({warnings:se??[],provider:y.provider,model:y.modelId}),C._usage.resolve(E),C._providerMetadata.resolve(le),C._warnings.resolve(se),C._response.resolve({...me,headers:ie?.headers}),C._finishReason.resolve(ce??`other`);try{ue=await SC(fe,o,p,{response:me,usage:E,finishReason:ce}),C._object.resolve(ue)}catch(e){de=e,C._object.reject(e)}break;default:t.enqueue(e);break}},async flush(t){try{let t=E??{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};T.setAttributes(await $({telemetry:n,attributes:{"ai.response.finishReason":ce,"ai.response.object":{output:()=>JSON.stringify(ue)},"ai.response.id":me.id,"ai.response.model":me.modelId,"ai.response.timestamp":me.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(le),"ai.usage.inputTokens":t.inputTokens,"ai.usage.outputTokens":t.outputTokens,"ai.usage.totalTokens":t.totalTokens,"ai.usage.reasoningTokens":t.reasoningTokens,"ai.usage.cachedInputTokens":t.cachedInputTokens,"gen_ai.response.finish_reasons":[ce],"gen_ai.response.id":me.id,"gen_ai.response.model":me.modelId,"gen_ai.usage.input_tokens":t.inputTokens,"gen_ai.usage.output_tokens":t.outputTokens}})),T.end(),e.setAttributes(await $({telemetry:n,attributes:{"ai.usage.inputTokens":t.inputTokens,"ai.usage.outputTokens":t.outputTokens,"ai.usage.totalTokens":t.totalTokens,"ai.usage.reasoningTokens":t.reasoningTokens,"ai.usage.cachedInputTokens":t.cachedInputTokens,"ai.response.object":{output:()=>JSON.stringify(ue)},"ai.response.providerMetadata":JSON.stringify(le)}})),await h?.({usage:t,object:ue,error:de,response:{...me,headers:ie?.headers},warnings:se,providerMetadata:le})}catch(e){t.enqueue({type:`error`,error:e})}finally{e.end()}}}));re.addStream(ye)}}).catch(e=>{re.addStream(new ReadableStream({start(t){t.enqueue({type:`error`,error:e}),t.close()}}))}).finally(()=>{re.close()}),this.outputStrategy=o}get object(){return this._object.promise}get usage(){return this._usage.promise}get providerMetadata(){return this._providerMetadata.promise}get warnings(){return this._warnings.promise}get request(){return this._request.promise}get response(){return this._response.promise}get finishReason(){return this._finishReason.promise}get partialObjectStream(){return RS(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case`object`:t.enqueue(e.object);break;case`text-delta`:case`finish`:case`error`:break;default:{let t=e;throw Error(`Unsupported chunk type: ${t}`)}}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return RS(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case`text-delta`:t.enqueue(e.textDelta);break;case`object`:case`finish`:case`error`:break;default:{let t=e;throw Error(`Unsupported chunk type: ${t}`)}}}})))}get fullStream(){return RS(this.baseStream)}pipeTextStreamToResponse(e,t){gS({response:e,textStream:this.textStream,...t})}toTextStreamResponse(e){return mS({textStream:this.textStream,...e})}},FC=class extends Vx{constructor({data:e,mediaType:t}){super({data:e,mediaType:t});let n=`mp3`;if(t){let e=t.split(`/`);e.length===2&&t!==`audio/mpeg`&&(n=e[1])}if(!n)throw Error(`Audio format must be provided or determinable from media type`);this.format=n}};async function IC({model:e,text:t,voice:n,outputFormat:r,instructions:i,speed:a,language:o,providerOptions:s={},maxRetries:c,abortSignal:l,headers:u}){let d=Eb(e);if(!d)throw Error(`Model could not be resolved`);let f=Cu(u??{},`ai/${Lb}`),{retry:p}=Lx({maxRetries:c,abortSignal:l}),m=await p(()=>d.doGenerate({text:t,voice:n,outputFormat:r,instructions:i,speed:a,language:o,abortSignal:l,headers:f,providerOptions:s}));if(!m.audio||m.audio.length===0)throw new Dy({responses:[m.response]});return pb({warnings:m.warnings,provider:d.provider,model:d.modelId}),new LC({audio:new FC({data:m.audio,mediaType:Ib({data:m.audio,signatures:Nb})??`audio/mp3`}),warnings:m.warnings,responses:[m.response],providerMetadata:m.providerMetadata})}var LC=class{constructor(e){this.audio=e.audio,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata??{}}};function RC({messages:e,reasoning:t=`none`,toolCalls:n=[],emptyMessages:r=`remove`}){(t===`all`||t===`before-last-message`)&&(e=e.map((n,r)=>n.role!==`assistant`||typeof n.content==`string`||t===`before-last-message`&&r===e.length-1?n:{...n,content:n.content.filter(e=>e.type!==`reasoning`)})),n===`none`?n=[]:n===`all`?n=[{type:`all`}]:n===`before-last-message`?n=[{type:`before-last-message`}]:typeof n==`string`&&(n=[{type:n}]);for(let t of n){let n=t.type===`all`?void 0:t.type===`before-last-message`?1:Number(t.type.slice(12).slice(0,-9)),r=new Set,i=new Set;if(n!=null){for(let t of e.slice(-n))if((t.role===`assistant`||t.role===`tool`)&&typeof t.content!=`string`)for(let e of t.content)e.type===`tool-call`||e.type===`tool-result`?r.add(e.toolCallId):(e.type===`tool-approval-request`||e.type===`tool-approval-response`)&&i.add(e.approvalId)}e=e.map((a,o)=>{if(a.role!==`assistant`&&a.role!==`tool`||typeof a.content==`string`||n&&o>=e.length-n)return a;let s={},c={};return{...a,content:a.content.filter(e=>e.type!==`tool-call`&&e.type!==`tool-result`&&e.type!==`tool-approval-request`&&e.type!==`tool-approval-response`||(e.type===`tool-call`?s[e.toolCallId]=e.toolName:e.type===`tool-approval-request`&&(c[e.approvalId]=s[e.toolCallId]),(e.type===`tool-call`||e.type===`tool-result`)&&r.has(e.toolCallId)||(e.type===`tool-approval-request`||e.type===`tool-approval-response`)&&i.has(e.approvalId))?!0:t.tools!=null&&!t.tools.includes(e.type===`tool-call`||e.type===`tool-result`?e.toolName:c[e.approvalId]))}})}return r===`remove`&&(e=e.filter(e=>e.content.length>0)),e}var zC={word:/\S+\s+/m,line:/\n+/m};function BC({delayInMs:e=10,chunking:t=`word`,_internal:{delay:n=Ql}={}}={}){let r;if(typeof t==`object`&&t&&`segment`in t&&typeof t.segment==`function`){let e=t;r=t=>t.length===0?null:e.segment(t)[Symbol.iterator]().next().value?.segment||null}else if(typeof t==`function`)r=e=>{let n=t(e);if(n==null)return null;if(!n.length)throw Error(`Chunking function must return a non-empty string.`);if(!e.startsWith(n))throw Error(`Chunking function must return a match that is a prefix of the buffer. Received: "${n}" expected to start with "${e}"`);return n};else{let e=typeof t==`string`?zC[t]:t instanceof RegExp?t:void 0;if(e==null)throw new S({argument:`chunking`,message:`Chunking must be "word", "line", a RegExp, an Intl.Segmenter, or a ChunkDetector function. Received: ${t}`});r=t=>{let n=e.exec(t);return n?t.slice(0,n.index)+n?.[0]:null}}return()=>{let t=``,i=``,a,o;function s(e){t.length>0&&a!==void 0&&(e.enqueue({type:a,text:t,id:i,...o==null?{}:{providerMetadata:o}}),t=``,o=void 0)}return new TransformStream({async transform(c,l){if(c.type!==`text-delta`&&c.type!==`reasoning-delta`){s(l),l.enqueue(c);return}(c.type!==a||c.id!==i)&&t.length>0&&s(l),t+=c.text,i=c.id,a=c.type,c.providerMetadata!=null&&(o=c.providerMetadata);let u;for(;(u=r(t))!=null;)l.enqueue({type:a,text:u,id:i}),t=t.slice(u.length),await n(e)}})}}function VC({settings:e}){return{specificationVersion:`v3`,transformParams:async({params:t})=>Nx(e,t)}}function HC({settings:e}){return{specificationVersion:`v3`,transformParams:async({params:t})=>Nx(e,t)}}function UC(e){return e.replace(/^```(?:json)?\s*\n?/,``).replace(/\n?```\s*$/,``).trim()}function WC(e){let t=e?.transform??UC,n=e?.transform!==void 0;return{specificationVersion:`v3`,wrapGenerate:async({doGenerate:e})=>{let{content:n,...r}=await e(),i=[];for(let e of n){if(e.type!==`text`){i.push(e);continue}i.push({...e,text:t(e.text)})}return{content:i,...r}},wrapStream:async({doStream:e})=>{let{stream:r,...i}=await e(),a={};return{stream:r.pipeThrough(new TransformStream({transform:(e,r)=>{if(e.type===`text-start`){a[e.id]={startEvent:e,phase:n?`buffering`:`prefix`,buffer:``,prefixStripped:!1};return}if(e.type===`text-delta`){let t=a[e.id];if(!t){r.enqueue(e);return}if(t.buffer+=e.delta,t.phase===`buffering`)return;if(t.phase===`prefix`)if(t.buffer.length>0&&!t.buffer.startsWith("`"))t.phase=`streaming`,r.enqueue(t.startEvent);else if(t.buffer.startsWith("```")){if(t.buffer.includes(`
`)){let e=t.buffer.match(/^```(?:json)?\s*\n/);e?(t.buffer=t.buffer.slice(e[0].length),t.prefixStripped=!0,t.phase=`streaming`,r.enqueue(t.startEvent)):(t.phase=`streaming`,r.enqueue(t.startEvent))}}else t.buffer.length>=3&&!t.buffer.startsWith("```")&&(t.phase=`streaming`,r.enqueue(t.startEvent));if(t.phase===`streaming`&&t.buffer.length>12){let n=t.buffer.slice(0,-12);t.buffer=t.buffer.slice(-12),r.enqueue({type:`text-delta`,id:e.id,delta:n})}return}if(e.type===`text-end`){let n=a[e.id];if(n){(n.phase===`prefix`||n.phase===`buffering`)&&r.enqueue(n.startEvent);let i=n.buffer;i=n.phase===`buffering`?t(i):n.prefixStripped?i.replace(/\n?```\s*$/,``).trimEnd():t(i),i.length>0&&r.enqueue({type:`text-delta`,id:e.id,delta:i}),r.enqueue(e),delete a[e.id];return}}r.enqueue(e)}})),...i}}}}function GC(e,t){if(t.length===0)return null;let n=e.indexOf(t);if(n!==-1)return n;for(let n=e.length-1;n>=0;n--){let r=e.substring(n);if(t.startsWith(r))return n}return null}function KC({tagName:e,separator:t=`
`,startWithReasoning:n=!1}){let r=`<${e}>`,i=`</${e}>`;return{specificationVersion:`v3`,wrapGenerate:async({doGenerate:e})=>{let{content:a,...o}=await e(),s=[];for(let e of a){if(e.type!==`text`){s.push(e);continue}let a=n?r+e.text:e.text,o=RegExp(`${r}(.*?)${i}`,`gs`),c=Array.from(a.matchAll(o));if(!c.length){s.push(e);continue}let l=c.map(e=>e[1]).join(t),u=a;for(let e=c.length-1;e>=0;e--){let n=c[e],r=u.slice(0,n.index),i=u.slice(n.index+n[0].length);u=r+(r.length>0&&i.length>0?t:``)+i}s.push({type:`reasoning`,text:l}),s.push({type:`text`,text:u})}return{content:s,...o}},wrapStream:async({doStream:e})=>{let{stream:a,...o}=await e(),s={},c;return{stream:a.pipeThrough(new TransformStream({transform:(e,a)=>{if(e.type===`text-start`){c=e;return}if(e.type===`text-end`&&c&&(a.enqueue(c),c=void 0),e.type!==`text-delta`){a.enqueue(e);return}s[e.id]??(s[e.id]={isFirstReasoning:!0,isFirstText:!0,afterSwitch:!1,isReasoning:n,buffer:``,idCounter:0,textId:e.id});let o=s[e.id];o.buffer+=e.delta;function l(e){if(e.length>0){let n=o.afterSwitch&&(o.isReasoning?!o.isFirstReasoning:!o.isFirstText)?t:``;o.isReasoning&&(o.afterSwitch||o.isFirstReasoning)&&a.enqueue({type:`reasoning-start`,id:`reasoning-${o.idCounter}`}),o.isReasoning?a.enqueue({type:`reasoning-delta`,delta:n+e,id:`reasoning-${o.idCounter}`}):(c&&=(a.enqueue(c),void 0),a.enqueue({type:`text-delta`,delta:n+e,id:o.textId})),o.afterSwitch=!1,o.isReasoning?o.isFirstReasoning=!1:o.isFirstText=!1}}do{let e=o.isReasoning?i:r,t=GC(o.buffer,e);if(t==null){l(o.buffer),o.buffer=``;break}if(l(o.buffer.slice(0,t)),t+e.length<=o.buffer.length)o.buffer=o.buffer.slice(t+e.length),o.isReasoning&&a.enqueue({type:`reasoning-end`,id:`reasoning-${o.idCounter++}`}),o.isReasoning=!o.isReasoning,o.afterSwitch=!0;else{o.buffer=o.buffer.slice(t);break}}while(!0)}})),...o}}}}function qC(){return{specificationVersion:`v3`,wrapStream:async({doGenerate:e})=>{let t=await e(),n=0;return{stream:new ReadableStream({start(e){e.enqueue({type:`stream-start`,warnings:t.warnings}),e.enqueue({type:`response-metadata`,...t.response});for(let r of t.content)switch(r.type){case`text`:r.text.length>0&&(e.enqueue({type:`text-start`,id:String(n)}),e.enqueue({type:`text-delta`,id:String(n),delta:r.text}),e.enqueue({type:`text-end`,id:String(n)}),n++);break;case`reasoning`:e.enqueue({type:`reasoning-start`,id:String(n),providerMetadata:r.providerMetadata}),e.enqueue({type:`reasoning-delta`,id:String(n),delta:r.text}),e.enqueue({type:`reasoning-end`,id:String(n)}),n++;break;default:e.enqueue(r);break}e.enqueue({type:`finish`,finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata}),e.close()}}),request:t.request,response:t.response}}}}function JC(e){return JSON.stringify(e.input)}function YC({prefix:e=`Input Examples:`,format:t=JC,remove:n=!0}={}){return{specificationVersion:`v3`,transformParams:async({params:r})=>{if(!r.tools?.length)return r;let i=r.tools.map(r=>{if(r.type!==`function`||!r.inputExamples?.length)return r;let i=`${e}
${r.inputExamples.map((e,n)=>t(e,n)).join(`
`)}`,a=r.description?`${r.description}

${i}`:i;return{...r,description:a,inputExamples:n?void 0:r.inputExamples}});return{...r,tools:i}}}}var XC=({model:e,middleware:t,modelId:n,providerId:r})=>[...Gb(t)].reverse().reduce((e,t)=>ZC({model:e,middleware:t,modelId:n,providerId:r}),e),ZC=({model:e,middleware:{transformParams:t,wrapGenerate:n,wrapStream:r,overrideProvider:i,overrideModelId:a,overrideSupportedUrls:o},modelId:s,providerId:c})=>{async function l({params:n,type:r}){return t?await t({params:n,type:r,model:e}):n}return{specificationVersion:`v3`,provider:c??i?.({model:e})??e.provider,modelId:s??a?.({model:e})??e.modelId,supportedUrls:o?.({model:e})??e.supportedUrls,async doGenerate(t){let r=await l({params:t,type:`generate`}),i=async()=>e.doGenerate(r);return n?n({doGenerate:i,doStream:async()=>e.doStream(r),params:r,model:e}):i()},async doStream(t){let n=await l({params:t,type:`stream`}),i=async()=>e.doGenerate(n),a=async()=>e.doStream(n);return r?r({doGenerate:i,doStream:a,params:n,model:e}):a()}}},QC=({model:e,middleware:t,modelId:n,providerId:r})=>[...Gb(t)].reverse().reduce((e,t)=>$C({model:e,middleware:t,modelId:n,providerId:r}),e),$C=({model:e,middleware:{transformParams:t,wrapEmbed:n,overrideProvider:r,overrideModelId:i,overrideMaxEmbeddingsPerCall:a,overrideSupportsParallelCalls:o},modelId:s,providerId:c})=>{async function l({params:n}){return t?await t({params:n,model:e}):n}return{specificationVersion:`v3`,provider:c??r?.({model:e})??e.provider,modelId:s??i?.({model:e})??e.modelId,maxEmbeddingsPerCall:a?.({model:e})??e.maxEmbeddingsPerCall,supportsParallelCalls:o?.({model:e})??e.supportsParallelCalls,async doEmbed(t){let r=await l({params:t}),i=async()=>e.doEmbed(r);return n?n({doEmbed:i,params:r,model:e}):i()}}},ew=({model:e,middleware:t,modelId:n,providerId:r})=>[...Gb(t)].reverse().reduce((e,t)=>tw({model:e,middleware:t,modelId:n,providerId:r}),e),tw=({model:e,middleware:{transformParams:t,wrapGenerate:n,overrideProvider:r,overrideModelId:i,overrideMaxImagesPerCall:a},modelId:o,providerId:s})=>{async function c({params:n}){return t?await t({params:n,model:e}):n}let l=a?.({model:e})??e.maxImagesPerCall,u=l instanceof Function?l.bind(e):l;return{specificationVersion:`v3`,provider:s??r?.({model:e})??e.provider,modelId:o??i?.({model:e})??e.modelId,maxImagesPerCall:u,async doGenerate(t){let r=await c({params:t}),i=async()=>e.doGenerate(r);return n?n({doGenerate:i,params:r,model:e}):i()}}};function nw(e){if(`specificationVersion`in e&&e.specificationVersion===`v3`)return e;let t=e;return{specificationVersion:`v3`,languageModel:e=>_b(t.languageModel(e)),embeddingModel:e=>hb(t.textEmbeddingModel(e)),imageModel:e=>gb(t.imageModel(e)),transcriptionModel:t.transcriptionModel?e=>Sb(t.transcriptionModel(e)):void 0,speechModel:t.speechModel?e=>xb(t.speechModel(e)):void 0,rerankingModel:void 0}}function rw({provider:e,languageModelMiddleware:t,imageModelMiddleware:n}){let r=nw(e);return{specificationVersion:`v3`,languageModel:e=>XC({model:r.languageModel(e),middleware:t}),embeddingModel:r.embeddingModel,imageModel:e=>{let t=r.imageModel(e);return n!=null&&(t=ew({model:t,middleware:n})),t},transcriptionModel:r.transcriptionModel,speechModel:r.speechModel,rerankingModel:r.rerankingModel}}function iw({languageModels:e,embeddingModels:t,imageModels:n,transcriptionModels:r,speechModels:i,rerankingModels:a,fallbackProvider:o}){let s=o?nw(o):void 0;return{specificationVersion:`v3`,languageModel(t){if(e!=null&&t in e)return e[t];if(s)return s.languageModel(t);throw new ze({modelId:t,modelType:`languageModel`})},embeddingModel(e){if(t!=null&&e in t)return t[e];if(s)return s.embeddingModel(e);throw new ze({modelId:e,modelType:`embeddingModel`})},imageModel(e){if(n!=null&&e in n)return n[e];if(s?.imageModel)return s.imageModel(e);throw new ze({modelId:e,modelType:`imageModel`})},transcriptionModel(e){if(r!=null&&e in r)return r[e];if(s?.transcriptionModel)return s.transcriptionModel(e);throw new ze({modelId:e,modelType:`transcriptionModel`})},speechModel(e){if(i!=null&&e in i)return i[e];if(s?.speechModel)return s.speechModel(e);throw new ze({modelId:e,modelType:`speechModel`})},rerankingModel(e){if(a!=null&&e in a)return a[e];if(s?.rerankingModel)return s.rerankingModel(e);throw new ze({modelId:e,modelType:`rerankingModel`})}}}var aw=iw,ow=`AI_NoSuchProviderError`,sw=`vercel.ai.error.${ow}`,cw=Symbol.for(sw),lw,uw=class extends ze{constructor({modelId:e,modelType:t,providerId:n,availableProviders:r,message:i=`No such provider: ${n} (available providers: ${r.join()})`}){super({errorName:ow,modelId:e,modelType:t,message:i}),this[lw]=!0,this.providerId=n,this.availableProviders=r}static isInstance(e){return a.hasMarker(e,sw)}};lw=cw;function dw(e,{separator:t=`:`,languageModelMiddleware:n,imageModelMiddleware:r}={}){let i=new pw({separator:t,languageModelMiddleware:n,imageModelMiddleware:r});for(let[t,n]of Object.entries(e))i.registerProvider({id:t,provider:n});return i}var fw=dw,pw=class{constructor({separator:e,languageModelMiddleware:t,imageModelMiddleware:n}){this.providers={},this.separator=e,this.languageModelMiddleware=t,this.imageModelMiddleware=n}registerProvider({id:e,provider:t}){this.providers[e]=t}getProvider(e,t){let n=this.providers[e];if(n==null)throw new uw({modelId:e,modelType:t,providerId:e,availableProviders:Object.keys(this.providers)});return n}splitId(e,t){let n=e.indexOf(this.separator);if(n===-1)throw new ze({modelId:e,modelType:t,message:`Invalid ${t} id for registry: ${e} (must be in the format "providerId${this.separator}modelId")`});return[e.slice(0,n),e.slice(n+this.separator.length)]}languageModel(e){var t;let[n,r]=this.splitId(e,`languageModel`),i=(t=this.getProvider(n,`languageModel`)).languageModel?.call(t,r);if(i==null)throw new ze({modelId:e,modelType:`languageModel`});return this.languageModelMiddleware!=null&&(i=XC({model:i,middleware:this.languageModelMiddleware})),i}embeddingModel(e){let[t,n]=this.splitId(e,`embeddingModel`),r=this.getProvider(t,`embeddingModel`),i=r.embeddingModel?.call(r,n);if(i==null)throw new ze({modelId:e,modelType:`embeddingModel`});return i}imageModel(e){let[t,n]=this.splitId(e,`imageModel`),r=this.getProvider(t,`imageModel`),i=r.imageModel?.call(r,n);if(i==null)throw new ze({modelId:e,modelType:`imageModel`});return this.imageModelMiddleware!=null&&(i=ew({model:i,middleware:this.imageModelMiddleware})),i}transcriptionModel(e){let[t,n]=this.splitId(e,`transcriptionModel`),r=this.getProvider(t,`transcriptionModel`),i=r.transcriptionModel?.call(r,n);if(i==null)throw new ze({modelId:e,modelType:`transcriptionModel`});return i}speechModel(e){let[t,n]=this.splitId(e,`speechModel`),r=this.getProvider(t,`speechModel`),i=r.speechModel?.call(r,n);if(i==null)throw new ze({modelId:e,modelType:`speechModel`});return i}rerankingModel(e){let[t,n]=this.splitId(e,`rerankingModel`),r=this.getProvider(t,`rerankingModel`),i=r.rerankingModel?.call(r,n);if(i==null)throw new ze({modelId:e,modelType:`rerankingModel`});return i}};async function mw({model:e,documents:t,query:n,topN:r,maxRetries:i,abortSignal:a,headers:o,providerOptions:s,experimental_telemetry:c}){if(t.length===0)return new hw({originalDocuments:[],ranking:[],providerMetadata:void 0,response:{timestamp:new Date,modelId:e.modelId}});let{maxRetries:l,retry:u}=Lx({maxRetries:i,abortSignal:a}),d=typeof t[0]==`string`?{type:`text`,values:t}:{type:`object`,values:t},f=bx({model:e,telemetry:c,headers:o,settings:{maxRetries:l}}),p=wx(c);return Tx({name:`ai.rerank`,attributes:$({telemetry:c,attributes:{...yx({operationId:`ai.rerank`,telemetry:c}),...f,"ai.documents":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async()=>{let{ranking:i,response:l,providerMetadata:m,warnings:h}=await u(()=>Tx({name:`ai.rerank.doRerank`,attributes:$({telemetry:c,attributes:{...yx({operationId:`ai.rerank.doRerank`,telemetry:c}),...f,"ai.documents":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async t=>{let i=await e.doRerank({documents:d,query:n,topN:r,providerOptions:s,abortSignal:a,headers:o}),l=i.ranking;return t.setAttributes(await $({telemetry:c,attributes:{"ai.ranking.type":d.type,"ai.ranking":{output:()=>l.map(e=>JSON.stringify(e))}}})),{ranking:l,providerMetadata:i.providerMetadata,response:i.response,warnings:i.warnings}}}));return pb({warnings:h??[],provider:e.provider,model:e.modelId}),new hw({originalDocuments:t,ranking:i.map(e=>({originalIndex:e.index,score:e.relevanceScore,document:t[e.index]})),providerMetadata:m,response:{id:l?.id,timestamp:l?.timestamp??new Date,modelId:l?.modelId??e.modelId,headers:l?.headers,body:l?.body}})}})}var hw=class{constructor(e){this.originalDocuments=e.originalDocuments,this.ranking=e.ranking,this.response=e.response,this.providerMetadata=e.providerMetadata}get rerankedDocuments(){return this.ranking.map(e=>e.document)}},gw=class extends a{constructor(e){super({name:`AI_NoTranscriptGeneratedError`,message:`No transcript generated.`}),this.responses=e.responses}};async function _w({model:e,audio:t,providerOptions:n={},maxRetries:r,abortSignal:i,headers:a}){let o=Tb(e);if(!o)throw Error(`Model could not be resolved`);let{retry:s}=Lx({maxRetries:r,abortSignal:i}),c=Cu(a??{},`ai/${Lb}`),l=t instanceof URL?(await Rb({url:t})).data:Wb(t),u=await s(()=>o.doGenerate({audio:l,abortSignal:i,headers:c,providerOptions:n,mediaType:Ib({data:l,signatures:Nb})??`audio/wav`}));if(pb({warnings:u.warnings,provider:o.provider,model:o.modelId}),!u.text)throw new gw({responses:[u.response]});return new vw({text:u.text,segments:u.segments,language:u.language,durationInSeconds:u.durationInSeconds,warnings:u.warnings,responses:[u.response],providerMetadata:u.providerMetadata})}var vw=class{constructor(e){this.text=e.text,this.segments=e.segments,this.language=e.language,this.durationInSeconds=e.durationInSeconds,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata??{}}};async function yw({stream:e,onTextPart:t}){let n=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:e,value:r}=await n.read();if(e)break;await t(r)}}var bw=()=>fetch;async function xw({api:e,prompt:t,credentials:n,headers:r,body:i,streamProtocol:a=`data`,setCompletion:o,setLoading:s,setError:c,setAbortController:l,onFinish:u,onError:d,fetch:f=bw()}){try{s(!0),c(void 0);let d=new AbortController;l(d),o(``);let p=await f(e,{method:`POST`,body:JSON.stringify({prompt:t,...i}),credentials:n,headers:Cu({"Content-Type":`application/json`,...r},`ai-sdk/${Lb}`,xu()),signal:d.signal}).catch(e=>{throw e});if(!p.ok)throw Error(await p.text()??`Failed to fetch the chat response.`);if(!p.body)throw Error(`The response body is empty.`);let m=``;switch(a){case`text`:await yw({stream:p.body,onTextPart:e=>{m+=e,o(m)}});break;case`data`:await zS({stream:rf({stream:p.body,schema:xS}).pipeThrough(new TransformStream({async transform(e){if(!e.success)throw e.error;let t=e.value;if(t.type===`text-delta`)m+=t.delta,o(m);else if(t.type===`error`)throw Error(t.errorText)}})),onError:e=>{throw e}});break;default:{let e=a;throw Error(`Unknown stream protocol: ${e}`)}}return u&&u(t,m),l(null),m}catch(e){if(e.name===`AbortError`)return l(null),null;e instanceof Error&&d&&d(e),c(e)}finally{s(!1)}}async function Sw(e){if(e==null)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error(`FileList is not supported in the current environment`);return Promise.all(Array.from(e).map(async e=>{let{name:t,type:n}=e;return{type:`file`,mediaType:n,filename:t,url:await new Promise((t,n)=>{let r=new FileReader;r.onload=e=>{t(e.target?.result)},r.onerror=e=>n(e),r.readAsDataURL(e)})}}))}var Cw=class{constructor({api:e=`/api/chat`,credentials:t,headers:n,body:r,fetch:i,prepareSendMessagesRequest:a,prepareReconnectToStreamRequest:o}){this.api=e,this.credentials=t,this.headers=n,this.body=r,this.fetch=i,this.prepareSendMessagesRequest=a,this.prepareReconnectToStreamRequest=o}async sendMessages({abortSignal:e,...t}){let n=await mf(this.body),r=await mf(this.headers),i=await mf(this.credentials),a={...Su(r),...Su(t.headers)},o=await this.prepareSendMessagesRequest?.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...n,...t.body},headers:a,credentials:i,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId}),s=o?.api??this.api,c=o?.headers===void 0?a:Su(o.headers),l=o?.body===void 0?{...n,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId}:o.body,u=o?.credentials??i,d=await(this.fetch??globalThis.fetch)(s,{method:`POST`,headers:Cu({"Content-Type":`application/json`,...c},`ai-sdk/${Lb}`,xu()),body:JSON.stringify(l),credentials:u,signal:e});if(!d.ok)throw Error(await d.text()??`Failed to fetch the chat response.`);if(!d.body)throw Error(`The response body is empty.`);return this.processResponseStream(d.body)}async reconnectToStream(e){let t=await mf(this.body),n=await mf(this.headers),r=await mf(this.credentials),i={...Su(n),...Su(e.headers)},a=await this.prepareReconnectToStreamRequest?.call(this,{api:this.api,id:e.chatId,body:{...t,...e.body},headers:i,credentials:r,requestMetadata:e.metadata}),o=a?.api??`${this.api}/${e.chatId}/stream`,s=a?.headers===void 0?i:Su(a.headers),c=a?.credentials??r,l=await(this.fetch??globalThis.fetch)(o,{method:`GET`,headers:Cu(s,`ai-sdk/${Lb}`,xu()),credentials:c});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??`Failed to fetch the chat response.`);if(!l.body)throw Error(`The response body is empty.`);return this.processResponseStream(l.body)}},ww=class extends Cw{constructor(e={}){super(e)}processResponseStream(e){return rf({stream:e,schema:xS}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},Tw=class{constructor({generateId:e=gu,id:t=e(),transport:n=new ww,messageMetadataSchema:r,dataPartSchemas:i,state:a,onError:o,onToolCall:s,onFinish:c,onData:l,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new AC,this.sendMessage=async(e,t)=>{if(e==null){await this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id,...t});return}let n;if(n=`text`in e||`files`in e?{parts:[...Array.isArray(e.files)?e.files:await Sw(e.files),...`text`in e&&e.text!=null?[{type:`text`,text:e.text}]:[]]}:e,e.messageId!=null){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(t===-1)throw Error(`message with id ${e.messageId} not found`);if(this.state.messages[t].role!==`user`)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...n,id:e.messageId,role:n.role??`user`,metadata:e.metadata})}else this.state.pushMessage({...n,id:n.id??this.generateId(),role:n.role??`user`,metadata:e.metadata});await this.makeRequest({trigger:`submit-message`,messageId:e.messageId,...t})},this.regenerate=async({messageId:e,...t}={})=>{let n=e==null?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(n===-1)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,this.messages[n].role===`assistant`?n:n+1),await this.makeRequest({trigger:`regenerate-message`,messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:`resume-stream`,...e})},this.clearError=()=>{this.status===`error`&&(this.state.error=void 0,this.setStatus({status:`ready`}))},this.addToolApprovalResponse=async({id:e,approved:t,reason:n})=>this.jobExecutor.run(async()=>{let r=this.state.messages,i=r[r.length-1],a=r=>kS(r)&&r.state===`approval-requested`&&r.approval.id===e?{...r,state:`approval-responded`,approval:{id:e,approved:t,reason:n}}:r;this.state.replaceMessage(r.length-1,{...i,parts:i.parts.map(a)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(a)),this.status!==`streaming`&&this.status!==`submitted`&&this.sendAutomaticallyWhen?.call(this,{messages:this.state.messages})&&this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id})}),this.addToolOutput=async({state:e=`output-available`,tool:t,toolCallId:n,output:r,errorText:i})=>this.jobExecutor.run(async()=>{let t=this.state.messages,a=t[t.length-1],o=t=>kS(t)&&t.toolCallId===n?{...t,state:e,output:r,errorText:i}:t;this.state.replaceMessage(t.length-1,{...a,parts:a.parts.map(o)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(o)),this.status!==`streaming`&&this.status!==`submitted`&&this.sendAutomaticallyWhen?.call(this,{messages:this.state.messages})&&this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{this.status!==`streaming`&&this.status!==`submitted`||this.activeResponse?.abortController&&this.activeResponse.abortController.abort()},this.id=t,this.transport=n,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=i,this.state=a,this.onError=o,this.onToolCall=s,this.onFinish=c,this.onData=l,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:n,body:r,messageId:i}){var a;this.setStatus({status:`submitted`,error:void 0});let o=this.lastMessage,s=!1,c=!1,l=!1;try{let a={state:PS({lastMessage:this.state.snapshot(o),messageId:this.generateId()}),abortController:new AbortController};a.abortController.signal.addEventListener(`abort`,()=>{s=!0}),this.activeResponse=a;let c;if(e===`resume-stream`){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:n,body:r});if(e==null){this.setStatus({status:`ready`});return}c=e}else c=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:a.abortController.signal,metadata:t,headers:n,body:r,trigger:e,messageId:i});await zS({stream:FS({stream:c,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:e=>this.jobExecutor.run(()=>e({state:a.state,write:()=>{this.setStatus({status:`streaming`}),a.state.message.id===this.lastMessage?.id?this.state.replaceMessage(this.state.messages.length-1,a.state.message):this.state.pushMessage(a.state.message)}})),onError:e=>{throw e}}),onError:e=>{throw e}}),this.setStatus({status:`ready`})}catch(e){if(s||e.name===`AbortError`)return s=!0,this.setStatus({status:`ready`}),null;l=!0,e instanceof TypeError&&(e.message.toLowerCase().includes(`fetch`)||e.message.toLowerCase().includes(`network`))&&(c=!0),this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:`error`,error:e})}finally{try{(a=this.onFinish)==null||a.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:s,isDisconnect:c,isError:l,finishReason:this.activeResponse?.state.finishReason})}catch(e){console.error(e)}this.activeResponse=void 0}this.sendAutomaticallyWhen?.call(this,{messages:this.state.messages})&&!l&&await this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id,metadata:t,headers:n,body:r})}},Ew=class{constructor({agent:e,options:t,...n}){this.agent=e,this.agentOptions=t,this.uiMessageStreamOptions=n}async sendMessages({messages:e,abortSignal:t}){let n=await ZS(await eC({messages:e,tools:this.agent.tools}),{tools:this.agent.tools});return(await this.agent.stream({prompt:n,abortSignal:t,...this.agentOptions===void 0?{}:{options:this.agentOptions}})).toUIMessageStream(this.uiMessageStreamOptions)}async reconnectToStream(e){return null}};function Dw({messages:e}){let t=e[e.length-1];if(!t||t.role!==`assistant`)return!1;let n=t.parts.reduce((e,t,n)=>t.type===`step-start`?n:e,-1),r=t.parts.slice(n+1).filter(kS).filter(e=>!e.providerExecuted);return r.filter(e=>e.state===`approval-responded`).length>0&&r.every(e=>e.state===`output-available`||e.state===`output-error`||e.state===`approval-responded`)}function Ow({messages:e}){let t=e[e.length-1];if(!t||t.role!==`assistant`)return!1;let n=t.parts.reduce((e,t,n)=>t.type===`step-start`?n:e,-1),r=t.parts.slice(n+1).filter(kS).filter(e=>!e.providerExecuted);return r.length>0&&r.every(e=>e.state===`output-available`||e.state===`output-error`)}function kw({stream:e}){return e.pipeThrough(new TransformStream({start(e){e.enqueue({type:`start`}),e.enqueue({type:`start-step`}),e.enqueue({type:`text-start`,id:`text-1`})},async transform(e,t){t.enqueue({type:`text-delta`,id:`text-1`,delta:e})},async flush(e){e.enqueue({type:`text-end`,id:`text-1`}),e.enqueue({type:`finish-step`}),e.enqueue({type:`finish`})}}))}var Aw=class extends Cw{constructor(e={}){super(e)}processResponseStream(e){return kw({stream:e.pipeThrough(new TextDecoderStream)})}};export{a as AISDKError,d as APICallError,Tw as AbstractChat,ww as DefaultChatTransport,Ew as DirectChatTransport,pu as DownloadError,_ as EmptyResponseBodyError,JS as Experimental_Agent,JS as ToolLoopAgent,Cw as HttpChatTransport,Bv as InvalidArgumentError,Jy as InvalidDataContentError,$y as InvalidMessageRoleError,ae as InvalidPromptError,le as InvalidResponseDataError,Gv as InvalidStreamPartError,Xv as InvalidToolApprovalError,ty as InvalidToolInputError,he as JSONParseError,_S as JsonToSseTransformStream,xe as LoadAPIKeyError,De as LoadSettingError,ib as MessageConversionError,dy as MissingToolResultsError,Ne as NoContentGeneratedError,gy as NoImageGeneratedError,xy as NoObjectGeneratedError,Ey as NoOutputGeneratedError,Dy as NoSpeechGeneratedError,ze as NoSuchModelError,uw as NoSuchProviderError,My as NoSuchToolError,Wx as Output,lb as RetryError,AC as SerialJobExecutor,Aw as TextStreamChatTransport,Ge as TooManyEmbeddingValuesForCallError,oy as ToolCallNotFoundForApprovalError,Ly as ToolCallRepairError,Ze as TypeValidationError,Uy as UIMessageStreamError,vS as UI_MESSAGE_STREAM_HEADERS,rt as UnsupportedFunctionalityError,Ry as UnsupportedModelVersionError,YC as addToolInputExamplesMiddleware,Cp as anthropic,qd as asSchema,mx as assistantModelMessageSchema,xw as callCompletionApi,zS as consumeStream,Sw as convertFileListToFileUIParts,ZS as convertToModelMessages,DC as cosineSimilarity,tC as createAgentUIStream,nC as createAgentUIStreamResponse,Sp as createAnthropic,T_ as createGateway,im as createGoogleGenerativeAI,hu as createIdGenerator,wm as createMistral,fg as createOpenAI,dw as createProviderRegistry,mS as createTextStreamResponse,YS as createUIMessageStream,yS as createUIMessageStreamResponse,iw as customProvider,VC as defaultEmbeddingSettingsMiddleware,HC as defaultSettingsMiddleware,df as dynamicTool,iC as embed,sC as embedMany,fw as experimental_createProviderRegistry,aw as experimental_customProvider,mC as experimental_generateImage,IC as experimental_generateSpeech,_w as experimental_transcribe,WC as extractJsonMiddleware,KC as extractReasoningMiddleware,wp as forwardAnthropicContainerIdFromLastStep,E_ as gateway,gu as generateId,lC as generateImage,TC as generateObject,cS as generateText,jS as getStaticToolName,OC as getTextFromDataUrl,MS as getToolName,NS as getToolOrDynamicToolName,am as google,rS as hasToolCall,CS as isDataUIPart,kC as isDeepEqualData,TS as isFileUIPart,ES as isReasoningUIPart,DS as isStaticToolUIPart,wS as isTextUIPart,AS as isToolOrDynamicToolUIPart,kS as isToolUIPart,Gd as jsonSchema,Dw as lastAssistantMessageIsCompleteWithApprovalResponses,Ow as lastAssistantMessageIsCompleteWithToolCalls,Tm as mistral,gx as modelMessageSchema,pg as openai,rf as parseJsonEventStream,Kx as parsePartialJson,rC as pipeAgentUIStreamToResponse,gS as pipeTextStreamToResponse,LS as pipeUIMessageStreamToResponse,RC as pruneMessages,XS as readUIMessageStream,mw as rerank,$S as safeValidateUIMessages,jC as simulateReadableStream,qC as simulateStreamingMiddleware,BC as smoothStream,nS as stepCountIs,NC as streamObject,GS as streamText,fx as systemModelMessageSchema,uf as tool,hx as toolModelMessageSchema,xS as uiMessageChunkSchema,px as userModelMessageSchema,eC as validateUIMessages,QC as wrapEmbeddingModel,ew as wrapImageModel,XC as wrapLanguageModel,rw as wrapProvider,Z as zodSchema};
var e=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),t=`vercel.ai.error`,n=Symbol.for(t),r,i,a=class e extends (i=Error,r=n,i){constructor({name:e,message:t,cause:n}){super(t),this[r]=!0,this.name=e,this.cause=n}static isInstance(n){return e.hasMarker(n,t)}static hasMarker(e,t){let n=Symbol.for(t);return typeof e==`object`&&!!e&&n in e&&typeof e[n]==`boolean`&&e[n]===!0}},o=`AI_APICallError`,s=`vercel.ai.error.${o}`,c=Symbol.for(s),l,u,d=class extends (u=a,l=c,u){constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:i,responseBody:a,cause:s,isRetryable:c=r!=null&&(r===408||r===409||r===429||r>=500),data:u}){super({name:o,message:e,cause:s}),this[l]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=i,this.responseBody=a,this.isRetryable=c,this.data=u}static isInstance(e){return a.hasMarker(e,s)}},f=`AI_EmptyResponseBodyError`,p=`vercel.ai.error.${f}`,m=Symbol.for(p),h,g,_=class extends (g=a,h=m,g){constructor({message:e=`Empty response body`}={}){super({name:f,message:e}),this[h]=!0}static isInstance(e){return a.hasMarker(e,p)}};function v(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}var y=`AI_InvalidArgumentError`,b=`vercel.ai.error.${y}`,x=Symbol.for(b),S,C,w=class extends (C=a,S=x,C){constructor({message:e,cause:t,argument:n}){super({name:y,message:e,cause:t}),this[S]=!0,this.argument=n}static isInstance(e){return a.hasMarker(e,b)}},T=`AI_InvalidPromptError`,ee=`vercel.ai.error.${T}`,te=Symbol.for(ee),ne,re,E=class extends (re=a,ne=te,re){constructor({prompt:e,message:t,cause:n}){super({name:T,message:`Invalid prompt: ${t}`,cause:n}),this[ne]=!0,this.prompt=e}static isInstance(e){return a.hasMarker(e,ee)}},ie=`AI_InvalidResponseDataError`,ae=`vercel.ai.error.${ie}`,oe=Symbol.for(ae),se,ce,le=class extends (ce=a,se=oe,ce){constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:ie,message:t}),this[se]=!0,this.data=e}static isInstance(e){return a.hasMarker(e,ae)}},D=`AI_JSONParseError`,ue=`vercel.ai.error.${D}`,de=Symbol.for(ue),fe,pe,me=class extends (pe=a,fe=de,pe){constructor({text:e,cause:t}){super({name:D,message:`JSON parsing failed: Text: ${e}.
Error message: ${v(t)}`,cause:t}),this[fe]=!0,this.text=e}static isInstance(e){return a.hasMarker(e,ue)}},he=`AI_LoadAPIKeyError`,ge=`vercel.ai.error.${he}`,_e=Symbol.for(ge),ve,ye,be=class extends (ye=a,ve=_e,ye){constructor({message:e}){super({name:he,message:e}),this[ve]=!0}static isInstance(e){return a.hasMarker(e,ge)}},xe=`AI_LoadSettingError`,Se=`vercel.ai.error.${xe}`,Ce=Symbol.for(Se),we,Te,Ee=class extends (Te=a,we=Ce,Te){constructor({message:e}){super({name:xe,message:e}),this[we]=!0}static isInstance(e){return a.hasMarker(e,Se)}},De=`AI_NoContentGeneratedError`,Oe=`vercel.ai.error.${De}`,ke=Symbol.for(Oe),Ae,je,Me=class extends (je=a,Ae=ke,je){constructor({message:e=`No content generated.`}={}){super({name:De,message:e}),this[Ae]=!0}static isInstance(e){return a.hasMarker(e,Oe)}},Ne=`AI_NoSuchModelError`,Pe=`vercel.ai.error.${Ne}`,Fe=Symbol.for(Pe),Ie,Le,Re=class extends (Le=a,Ie=Fe,Le){constructor({errorName:e=Ne,modelId:t,modelType:n,message:r=`No such ${n}: ${t}`}){super({name:e,message:r}),this[Ie]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return a.hasMarker(e,Pe)}},ze=`AI_TooManyEmbeddingValuesForCallError`,Be=`vercel.ai.error.${ze}`,Ve=Symbol.for(Be),He,Ue,We=class extends (Ue=a,He=Ve,Ue){constructor(e){super({name:ze,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[He]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return a.hasMarker(e,Be)}},Ge=`AI_TypeValidationError`,Ke=`vercel.ai.error.${Ge}`,qe=Symbol.for(Ke),Je,Ye,Xe=class e extends (Ye=a,Je=qe,Ye){constructor({value:e,cause:t}){super({name:Ge,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${v(t)}`,cause:t}),this[Je]=!0,this.value=e}static isInstance(e){return a.hasMarker(e,Ke)}static wrap({value:t,cause:n}){return e.isInstance(n)&&n.value===t?n:new e({value:t,cause:n})}},Ze=`AI_UnsupportedFunctionalityError`,Qe=`vercel.ai.error.${Ze}`,$e=Symbol.for(Qe),et,tt,nt=class extends (tt=a,et=$e,tt){constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Ze,message:t}),this[et]=!0,this.functionality=e}static isInstance(e){return a.hasMarker(e,Qe)}};function rt(e){return e===null||typeof e==`string`||typeof e==`number`||typeof e==`boolean`?!0:Array.isArray(e)?e.every(rt):typeof e==`object`?Object.entries(e).every(([e,t])=>typeof e==`string`&&(t===void 0||rt(t))):!1}function it(e){return Array.isArray(e)&&e.every(rt)}function at(e){return typeof e==`object`&&!!e&&Object.entries(e).every(([e,t])=>typeof e==`string`&&(t===void 0||rt(t)))}Object.freeze({status:`aborted`});function O(e,t,n){function r(n,r){if(n._zod||Object.defineProperty(n,`_zod`,{value:{def:r,constr:o,traits:new Set},enumerable:!1}),n._zod.traits.has(e))return;n._zod.traits.add(e),t(n,r);let i=o.prototype,a=Object.keys(i);for(let e=0;e<a.length;e++){let t=a[e];t in n||(n[t]=i[t].bind(n))}}let i=n?.Parent??Object;class a extends i{}Object.defineProperty(a,`name`,{value:e});function o(e){var t;let i=n?.Parent?new a:this;r(i,e),(t=i._zod).deferred??(t.deferred=[]);for(let e of i._zod.deferred)e();return i}return Object.defineProperty(o,`init`,{value:r}),Object.defineProperty(o,Symbol.hasInstance,{value:t=>n?.Parent&&t instanceof n.Parent?!0:t?._zod?.traits?.has(e)}),Object.defineProperty(o,`name`,{value:e}),o}var ot=class extends Error{constructor(){super(`Encountered Promise during synchronous parse. Use .parseAsync() instead.`)}},st=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name=`ZodEncodeError`}};const ct={};function lt(e){return e&&Object.assign(ct,e),ct}function ut(e){let t=Object.values(e).filter(e=>typeof e==`number`);return Object.entries(e).filter(([e,n])=>t.indexOf(+e)===-1).map(([e,t])=>t)}function dt(e,t){return typeof t==`bigint`?t.toString():t}function ft(e){return{get value(){{let t=e();return Object.defineProperty(this,`value`,{value:t}),t}throw Error(`cached value already set`)}}}function pt(e){return e==null}function mt(e){let t=e.startsWith(`^`)?1:0,n=e.endsWith(`$`)?e.length-1:e.length;return e.slice(t,n)}function ht(e,t){let n=(e.toString().split(`.`)[1]||``).length,r=t.toString(),i=(r.split(`.`)[1]||``).length;if(i===0&&/\d?e-\d?/.test(r)){let e=r.match(/\d?e-(\d?)/);e?.[1]&&(i=Number.parseInt(e[1]))}let a=n>i?n:i;return Number.parseInt(e.toFixed(a).replace(`.`,``))%Number.parseInt(t.toFixed(a).replace(`.`,``))/10**a}const gt=Symbol(`evaluating`);function k(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==gt)return r===void 0&&(r=gt,r=n()),r},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function _t(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function vt(...e){let t={};for(let n of e){let e=Object.getOwnPropertyDescriptors(n);Object.assign(t,e)}return Object.defineProperties({},t)}function yt(e){return JSON.stringify(e)}function bt(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,``).replace(/[\s_-]+/g,`-`).replace(/^-+|-+$/g,``)}const xt=`captureStackTrace`in Error?Error.captureStackTrace:(...e)=>{};function St(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}const Ct=ft(()=>{if(typeof navigator<`u`&&navigator?.userAgent?.includes(`Cloudflare`))return!1;try{return Function(``),!0}catch{return!1}});function wt(e){if(St(e)===!1)return!1;let t=e.constructor;if(t===void 0||typeof t!=`function`)return!0;let n=t.prototype;return!(St(n)===!1||Object.prototype.hasOwnProperty.call(n,`isPrototypeOf`)===!1)}function Tt(e){return wt(e)?{...e}:Array.isArray(e)?[...e]:e}const Et=new Set([`string`,`number`,`symbol`]);function Dt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function Ot(e,t,n){let r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}function A(e){let t=e;if(!t)return{};if(typeof t==`string`)return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error==`string`?{...t,error:()=>t.error}:t}function kt(e){return Object.keys(e).filter(t=>e[t]._zod.optin===`optional`&&e[t]._zod.optout===`optional`)}const At={safeint:[-(2**53-1),2**53-1],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function jt(e,t){let n=e._zod.def,r=n.checks;if(r&&r.length>0)throw Error(`.pick() cannot be used on object schemas containing refinements`);return Ot(e,vt(e._zod.def,{get shape(){let e={};for(let r in t){if(!(r in n.shape))throw Error(`Unrecognized key: "${r}"`);t[r]&&(e[r]=n.shape[r])}return _t(this,`shape`,e),e},checks:[]}))}function Mt(e,t){let n=e._zod.def,r=n.checks;if(r&&r.length>0)throw Error(`.omit() cannot be used on object schemas containing refinements`);return Ot(e,vt(e._zod.def,{get shape(){let r={...e._zod.def.shape};for(let e in t){if(!(e in n.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete r[e]}return _t(this,`shape`,r),r},checks:[]}))}function Nt(e,t){if(!wt(t))throw Error(`Invalid input to extend: expected a plain object`);let n=e._zod.def.checks;if(n&&n.length>0){let n=e._zod.def.shape;for(let e in t)if(Object.getOwnPropertyDescriptor(n,e)!==void 0)throw Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}return Ot(e,vt(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t};return _t(this,`shape`,n),n}}))}function Pt(e,t){if(!wt(t))throw Error(`Invalid input to safeExtend: expected a plain object`);return Ot(e,vt(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t};return _t(this,`shape`,n),n}}))}function Ft(e,t){return Ot(e,vt(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t._zod.def.shape};return _t(this,`shape`,n),n},get catchall(){return t._zod.def.catchall},checks:[]}))}function It(e,t,n){let r=t._zod.def.checks;if(r&&r.length>0)throw Error(`.partial() cannot be used on object schemas containing refinements`);return Ot(t,vt(t._zod.def,{get shape(){let r=t._zod.def.shape,i={...r};if(n)for(let t in n){if(!(t in r))throw Error(`Unrecognized key: "${t}"`);n[t]&&(i[t]=e?new e({type:`optional`,innerType:r[t]}):r[t])}else for(let t in r)i[t]=e?new e({type:`optional`,innerType:r[t]}):r[t];return _t(this,`shape`,i),i},checks:[]}))}function Lt(e,t,n){return Ot(t,vt(t._zod.def,{get shape(){let r=t._zod.def.shape,i={...r};if(n)for(let t in n){if(!(t in i))throw Error(`Unrecognized key: "${t}"`);n[t]&&(i[t]=new e({type:`nonoptional`,innerType:r[t]}))}else for(let t in r)i[t]=new e({type:`nonoptional`,innerType:r[t]});return _t(this,`shape`,i),i}}))}function Rt(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function zt(e,t){return t.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(e),t})}function Bt(e){return typeof e==`string`?e:e?.message}function Vt(e,t,n){let r={...e,path:e.path??[]};return e.message||(r.message=Bt(e.inst?._zod.def?.error?.(e))??Bt(t?.error?.(e))??Bt(n.customError?.(e))??Bt(n.localeError?.(e))??`Invalid input`),delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function Ht(e){return Array.isArray(e)?`array`:typeof e==`string`?`string`:`unknown`}function Ut(...e){let[t,n,r]=e;return typeof t==`string`?{message:t,code:`custom`,input:n,inst:r}:{...t}}const Wt=(e,t)=>{e.name=`$ZodError`,Object.defineProperty(e,`_zod`,{value:e._zod,enumerable:!1}),Object.defineProperty(e,`issues`,{value:t,enumerable:!1}),e.message=JSON.stringify(t,dt,2),Object.defineProperty(e,`toString`,{value:()=>e.message,enumerable:!1})},Gt=O(`$ZodError`,Wt),Kt=O(`$ZodError`,Wt,{Parent:Error});function qt(e,t=e=>e.message){let n={},r=[];for(let i of e.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:n}}function Jt(e,t=e=>e.message){let n={_errors:[]},r=e=>{for(let i of e.issues)if(i.code===`invalid_union`&&i.errors.length)i.errors.map(e=>r({issues:e}));else if(i.code===`invalid_key`)r({issues:i.issues});else if(i.code===`invalid_element`)r({issues:i.issues});else if(i.path.length===0)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){let n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(e),n}const Yt=e=>(t,n,r,i)=>{let a=r?Object.assign(r,{async:!1}):{async:!1},o=t._zod.run({value:n,issues:[]},a);if(o instanceof Promise)throw new ot;if(o.issues.length){let t=new(i?.Err??e)(o.issues.map(e=>Vt(e,a,lt())));throw xt(t,i?.callee),t}return o.value},Xt=e=>async(t,n,r,i)=>{let a=r?Object.assign(r,{async:!0}):{async:!0},o=t._zod.run({value:n,issues:[]},a);if(o instanceof Promise&&(o=await o),o.issues.length){let t=new(i?.Err??e)(o.issues.map(e=>Vt(e,a,lt())));throw xt(t,i?.callee),t}return o.value},Zt=e=>(t,n,r)=>{let i=r?{...r,async:!1}:{async:!1},a=t._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new ot;return a.issues.length?{success:!1,error:new(e??Gt)(a.issues.map(e=>Vt(e,i,lt())))}:{success:!0,data:a.value}},Qt=Zt(Kt),$t=e=>async(t,n,r)=>{let i=r?Object.assign(r,{async:!0}):{async:!0},a=t._zod.run({value:n,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(e=>Vt(e,i,lt())))}:{success:!0,data:a.value}},en=$t(Kt),tn=e=>(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Yt(e)(t,n,i)},nn=e=>(t,n,r)=>Yt(e)(t,n,r),rn=e=>async(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Xt(e)(t,n,i)},an=e=>async(t,n,r)=>Xt(e)(t,n,r),on=e=>(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Zt(e)(t,n,i)},sn=e=>(t,n,r)=>Zt(e)(t,n,r),cn=e=>async(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return $t(e)(t,n,i)},ln=e=>async(t,n,r)=>$t(e)(t,n,r),un=/^[cC][^\s-]{8,}$/,dn=/^[0-9a-z]+$/,fn=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,pn=/^[0-9a-vA-V]{20}$/,mn=/^[A-Za-z0-9]{27}$/,hn=/^[a-zA-Z0-9_-]{21}$/,gn=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,_n=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,vn=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,yn=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function bn(){return RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`)}const xn=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Sn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Cn=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,wn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Tn=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,En=/^[A-Za-z0-9_-]*$/,Dn=/^\+[1-9]\d{6,14}$/,On=`(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))`,kn=RegExp(`^${On}$`);function An(e){let t=`(?:[01]\\d|2[0-3]):[0-5]\\d`;return typeof e.precision==`number`?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function jn(e){return RegExp(`^${An(e)}$`)}function Mn(e){let t=An({precision:e.precision}),n=[`Z`];e.local&&n.push(``),e.offset&&n.push(`([+-](?:[01]\\d|2[0-3]):[0-5]\\d)`);let r=`${t}(?:${n.join(`|`)})`;return RegExp(`^${On}T(?:${r})$`)}const Nn=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??``}}`:`[\\s\\S]*`;return RegExp(`^${t}$`)},Pn=/^-?\d+$/,Fn=/^-?\d+(?:\.\d+)?$/,In=/^(?:true|false)$/i,Ln=/^null$/i,Rn=/^[^A-Z]*$/,zn=/^[^a-z]*$/,Bn=O(`$ZodCheck`,(e,t)=>{var n;e._zod??={},e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Vn={number:`number`,bigint:`bigint`,object:`date`},Hn=O(`$ZodCheckLessThan`,(e,t)=>{Bn.init(e,t);let n=Vn[typeof t.value];e._zod.onattach.push(e=>{let n=e._zod.bag,r=(t.inclusive?n.maximum:n.exclusiveMaximum)??1/0;t.value<r&&(t.inclusive?n.maximum=t.value:n.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:`too_big`,maximum:typeof t.value==`object`?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Un=O(`$ZodCheckGreaterThan`,(e,t)=>{Bn.init(e,t);let n=Vn[typeof t.value];e._zod.onattach.push(e=>{let n=e._zod.bag,r=(t.inclusive?n.minimum:n.exclusiveMinimum)??-1/0;t.value>r&&(t.inclusive?n.minimum=t.value:n.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:`too_small`,minimum:typeof t.value==`object`?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Wn=O(`$ZodCheckMultipleOf`,(e,t)=>{Bn.init(e,t),e._zod.onattach.push(e=>{var n;(n=e._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw Error(`Cannot mix number and bigint in multiple_of check.`);(typeof n.value==`bigint`?n.value%t.value===BigInt(0):ht(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:`not_multiple_of`,divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Gn=O(`$ZodCheckNumberFormat`,(e,t)=>{Bn.init(e,t),t.format=t.format||`float64`;let n=t.format?.includes(`int`),r=n?`int`:`number`,[i,a]=At[t.format];e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,r.minimum=i,r.maximum=a,n&&(r.pattern=Pn)}),e._zod.check=o=>{let s=o.value;if(n){if(!Number.isInteger(s)){o.issues.push({expected:r,format:t.format,code:`invalid_type`,continue:!1,input:s,inst:e});return}if(!Number.isSafeInteger(s)){s>0?o.issues.push({input:s,code:`too_big`,maximum:2**53-1,note:`Integers must be within the safe integer range.`,inst:e,origin:r,inclusive:!0,continue:!t.abort}):o.issues.push({input:s,code:`too_small`,minimum:-(2**53-1),note:`Integers must be within the safe integer range.`,inst:e,origin:r,inclusive:!0,continue:!t.abort});return}}s<i&&o.issues.push({origin:`number`,input:s,code:`too_small`,minimum:i,inclusive:!0,inst:e,continue:!t.abort}),s>a&&o.issues.push({origin:`number`,input:s,code:`too_big`,maximum:a,inclusive:!0,inst:e,continue:!t.abort})}}),Kn=O(`$ZodCheckMaxLength`,(e,t)=>{var n;Bn.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!pt(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag.maximum??1/0;t.maximum<n&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{let r=n.value;if(r.length<=t.maximum)return;let i=Ht(r);n.issues.push({origin:i,code:`too_big`,maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),qn=O(`$ZodCheckMinLength`,(e,t)=>{var n;Bn.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!pt(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag.minimum??-1/0;t.minimum>n&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{let r=n.value;if(r.length>=t.minimum)return;let i=Ht(r);n.issues.push({origin:i,code:`too_small`,minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Jn=O(`$ZodCheckLengthEquals`,(e,t)=>{var n;Bn.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!pt(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag;n.minimum=t.length,n.maximum=t.length,n.length=t.length}),e._zod.check=n=>{let r=n.value,i=r.length;if(i===t.length)return;let a=Ht(r),o=i>t.length;n.issues.push({origin:a,...o?{code:`too_big`,maximum:t.length}:{code:`too_small`,minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Yn=O(`$ZodCheckStringFormat`,(e,t)=>{var n,r;Bn.init(e,t),e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,t.pattern&&(n.patterns??=new Set,n.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:`string`,code:`invalid_format`,format:t.format,input:n.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),Xn=O(`$ZodCheckRegex`,(e,t)=>{Yn.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:`string`,code:`invalid_format`,format:`regex`,input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Zn=O(`$ZodCheckLowerCase`,(e,t)=>{t.pattern??=Rn,Yn.init(e,t)}),Qn=O(`$ZodCheckUpperCase`,(e,t)=>{t.pattern??=zn,Yn.init(e,t)}),$n=O(`$ZodCheckIncludes`,(e,t)=>{Bn.init(e,t);let n=Dt(t.includes),r=new RegExp(typeof t.position==`number`?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(r)}),e._zod.check=n=>{n.value.includes(t.includes,t.position)||n.issues.push({origin:`string`,code:`invalid_format`,format:`includes`,includes:t.includes,input:n.value,inst:e,continue:!t.abort})}}),er=O(`$ZodCheckStartsWith`,(e,t)=>{Bn.init(e,t);let n=RegExp(`^${Dt(t.prefix)}.*`);t.pattern??=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(n)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:`string`,code:`invalid_format`,format:`starts_with`,prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),tr=O(`$ZodCheckEndsWith`,(e,t)=>{Bn.init(e,t);let n=RegExp(`.*${Dt(t.suffix)}$`);t.pattern??=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(n)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:`string`,code:`invalid_format`,format:`ends_with`,suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),nr=O(`$ZodCheckOverwrite`,(e,t)=>{Bn.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});var rr=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),--this.indent}write(e){if(typeof e==`function`){e(this,{execution:`sync`}),e(this,{execution:`async`});return}let t=e.split(`
`).filter(e=>e),n=Math.min(...t.map(e=>e.length-e.trimStart().length)),r=t.map(e=>e.slice(n)).map(e=>` `.repeat(this.indent*2)+e);for(let e of r)this.content.push(e)}compile(){let e=Function,t=this?.args,n=[...(this?.content??[``]).map(e=>`  ${e}`)];return new e(...t,n.join(`
`))}};const ir={major:4,minor:3,patch:4},ar=O(`$ZodType`,(e,t)=>{var n;e??={},e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=ir;let r=[...e._zod.def.checks??[]];e._zod.traits.has(`$ZodCheck`)&&r.unshift(e);for(let t of r)for(let n of t._zod.onattach)n(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,n)=>{let r=Rt(e),i;for(let a of t){if(a._zod.def.when){if(!a._zod.def.when(e))continue}else if(r)continue;let t=e.issues.length,o=a._zod.check(e);if(o instanceof Promise&&n?.async===!1)throw new ot;if(i||o instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await o,e.issues.length!==t&&(r||=Rt(e,t))});else{if(e.issues.length===t)continue;r||=Rt(e,t)}}return i?i.then(()=>e):e},n=(n,i,a)=>{if(Rt(n))return n.aborted=!0,n;let o=t(i,r,a);if(o instanceof Promise){if(a.async===!1)throw new ot;return o.then(t=>e._zod.parse(t,a))}return e._zod.parse(o,a)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction===`backward`){let t=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return t instanceof Promise?t.then(e=>n(e,i,a)):n(t,i,a)}let o=e._zod.parse(i,a);if(o instanceof Promise){if(a.async===!1)throw new ot;return o.then(e=>t(e,r,a))}return t(o,r,a)}}k(e,`~standard`,()=>({validate:t=>{try{let n=Qt(e,t);return n.success?{value:n.data}:{issues:n.error?.issues}}catch{return en(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:`zod`,version:1}))}),or=O(`$ZodString`,(e,t)=>{ar.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Nn(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value==`string`||n.issues.push({expected:`string`,code:`invalid_type`,input:n.value,inst:e}),n}}),sr=O(`$ZodStringFormat`,(e,t)=>{Yn.init(e,t),or.init(e,t)}),cr=O(`$ZodGUID`,(e,t)=>{t.pattern??=_n,sr.init(e,t)}),lr=O(`$ZodUUID`,(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(e===void 0)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??=vn(e)}else t.pattern??=vn();sr.init(e,t)}),ur=O(`$ZodEmail`,(e,t)=>{t.pattern??=yn,sr.init(e,t)}),dr=O(`$ZodURL`,(e,t)=>{sr.init(e,t),e._zod.check=n=>{try{let r=n.value.trim(),i=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||n.issues.push({code:`invalid_format`,format:`url`,note:`Invalid hostname`,pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(`:`)?i.protocol.slice(0,-1):i.protocol)||n.issues.push({code:`invalid_format`,format:`url`,note:`Invalid protocol`,pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=i.href:n.value=r;return}catch{n.issues.push({code:`invalid_format`,format:`url`,input:n.value,inst:e,continue:!t.abort})}}}),fr=O(`$ZodEmoji`,(e,t)=>{t.pattern??=bn(),sr.init(e,t)}),pr=O(`$ZodNanoID`,(e,t)=>{t.pattern??=hn,sr.init(e,t)}),mr=O(`$ZodCUID`,(e,t)=>{t.pattern??=un,sr.init(e,t)}),hr=O(`$ZodCUID2`,(e,t)=>{t.pattern??=dn,sr.init(e,t)}),gr=O(`$ZodULID`,(e,t)=>{t.pattern??=fn,sr.init(e,t)}),_r=O(`$ZodXID`,(e,t)=>{t.pattern??=pn,sr.init(e,t)}),vr=O(`$ZodKSUID`,(e,t)=>{t.pattern??=mn,sr.init(e,t)}),yr=O(`$ZodISODateTime`,(e,t)=>{t.pattern??=Mn(t),sr.init(e,t)}),br=O(`$ZodISODate`,(e,t)=>{t.pattern??=kn,sr.init(e,t)}),xr=O(`$ZodISOTime`,(e,t)=>{t.pattern??=jn(t),sr.init(e,t)}),Sr=O(`$ZodISODuration`,(e,t)=>{t.pattern??=gn,sr.init(e,t)}),Cr=O(`$ZodIPv4`,(e,t)=>{t.pattern??=xn,sr.init(e,t),e._zod.bag.format=`ipv4`}),wr=O(`$ZodIPv6`,(e,t)=>{t.pattern??=Sn,sr.init(e,t),e._zod.bag.format=`ipv6`,e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:`invalid_format`,format:`ipv6`,input:n.value,inst:e,continue:!t.abort})}}}),Tr=O(`$ZodCIDRv4`,(e,t)=>{t.pattern??=Cn,sr.init(e,t)}),Er=O(`$ZodCIDRv6`,(e,t)=>{t.pattern??=wn,sr.init(e,t),e._zod.check=n=>{let r=n.value.split(`/`);try{if(r.length!==2)throw Error();let[e,t]=r;if(!t)throw Error();let n=Number(t);if(`${n}`!==t||n<0||n>128)throw Error();new URL(`http://[${e}]`)}catch{n.issues.push({code:`invalid_format`,format:`cidrv6`,input:n.value,inst:e,continue:!t.abort})}}});function Dr(e){if(e===``)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const Or=O(`$ZodBase64`,(e,t)=>{t.pattern??=Tn,sr.init(e,t),e._zod.bag.contentEncoding=`base64`,e._zod.check=n=>{Dr(n.value)||n.issues.push({code:`invalid_format`,format:`base64`,input:n.value,inst:e,continue:!t.abort})}});function kr(e){if(!En.test(e))return!1;let t=e.replace(/[-_]/g,e=>e===`-`?`+`:`/`);return Dr(t.padEnd(Math.ceil(t.length/4)*4,`=`))}const Ar=O(`$ZodBase64URL`,(e,t)=>{t.pattern??=En,sr.init(e,t),e._zod.bag.contentEncoding=`base64url`,e._zod.check=n=>{kr(n.value)||n.issues.push({code:`invalid_format`,format:`base64url`,input:n.value,inst:e,continue:!t.abort})}}),jr=O(`$ZodE164`,(e,t)=>{t.pattern??=Dn,sr.init(e,t)});function Mr(e,t=null){try{let n=e.split(`.`);if(n.length!==3)return!1;let[r]=n;if(!r)return!1;let i=JSON.parse(atob(r));return!(`typ`in i&&i?.typ!==`JWT`||!i.alg||t&&(!(`alg`in i)||i.alg!==t))}catch{return!1}}const Nr=O(`$ZodJWT`,(e,t)=>{sr.init(e,t),e._zod.check=n=>{Mr(n.value,t.alg)||n.issues.push({code:`invalid_format`,format:`jwt`,input:n.value,inst:e,continue:!t.abort})}}),Pr=O(`$ZodNumber`,(e,t)=>{ar.init(e,t),e._zod.pattern=e._zod.bag.pattern??Fn,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}let i=n.value;if(typeof i==`number`&&!Number.isNaN(i)&&Number.isFinite(i))return n;let a=typeof i==`number`?Number.isNaN(i)?`NaN`:Number.isFinite(i)?void 0:`Infinity`:void 0;return n.issues.push({expected:`number`,code:`invalid_type`,input:i,inst:e,...a?{received:a}:{}}),n}}),Fr=O(`$ZodNumberFormat`,(e,t)=>{Gn.init(e,t),Pr.init(e,t)}),Ir=O(`$ZodBoolean`,(e,t)=>{ar.init(e,t),e._zod.pattern=In,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}let i=n.value;return typeof i==`boolean`||n.issues.push({expected:`boolean`,code:`invalid_type`,input:i,inst:e}),n}}),Lr=O(`$ZodNull`,(e,t)=>{ar.init(e,t),e._zod.pattern=Ln,e._zod.values=new Set([null]),e._zod.parse=(t,n)=>{let r=t.value;return r===null||t.issues.push({expected:`null`,code:`invalid_type`,input:r,inst:e}),t}}),Rr=O(`$ZodAny`,(e,t)=>{ar.init(e,t),e._zod.parse=e=>e}),zr=O(`$ZodUnknown`,(e,t)=>{ar.init(e,t),e._zod.parse=e=>e}),Br=O(`$ZodNever`,(e,t)=>{ar.init(e,t),e._zod.parse=(t,n)=>(t.issues.push({expected:`never`,code:`invalid_type`,input:t.value,inst:e}),t)});function Vr(e,t,n){e.issues.length&&t.issues.push(...zt(n,e.issues)),t.value[n]=e.value}const Hr=O(`$ZodArray`,(e,t)=>{ar.init(e,t),e._zod.parse=(n,r)=>{let i=n.value;if(!Array.isArray(i))return n.issues.push({expected:`array`,code:`invalid_type`,input:i,inst:e}),n;n.value=Array(i.length);let a=[];for(let e=0;e<i.length;e++){let o=i[e],s=t.element._zod.run({value:o,issues:[]},r);s instanceof Promise?a.push(s.then(t=>Vr(t,n,e))):Vr(s,n,e)}return a.length?Promise.all(a).then(()=>n):n}});function Ur(e,t,n,r,i){if(e.issues.length){if(i&&!(n in r))return;t.issues.push(...zt(n,e.issues))}e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function Wr(e){let t=Object.keys(e.shape);for(let n of t)if(!e.shape?.[n]?._zod?.traits?.has(`$ZodType`))throw Error(`Invalid element at key "${n}": expected a Zod schema`);let n=kt(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function Gr(e,t,n,r,i,a){let o=[],s=i.keySet,c=i.catchall._zod,l=c.def.type,u=c.optout===`optional`;for(let i in t){if(s.has(i))continue;if(l===`never`){o.push(i);continue}let a=c.run({value:t[i],issues:[]},r);a instanceof Promise?e.push(a.then(e=>Ur(e,n,i,t,u))):Ur(a,n,i,t,u)}return o.length&&n.issues.push({code:`unrecognized_keys`,keys:o,input:t,inst:a}),e.length?Promise.all(e).then(()=>n):n}const Kr=O(`$ZodObject`,(e,t)=>{if(ar.init(e,t),!Object.getOwnPropertyDescriptor(t,`shape`)?.get){let e=t.shape;Object.defineProperty(t,`shape`,{get:()=>{let n={...e};return Object.defineProperty(t,`shape`,{value:n}),n}})}let n=ft(()=>Wr(t));k(e._zod,`propValues`,()=>{let e=t.shape,n={};for(let t in e){let r=e[t]._zod;if(r.values){n[t]??(n[t]=new Set);for(let e of r.values)n[t].add(e)}}return n});let r=St,i=t.catchall,a;e._zod.parse=(t,o)=>{a??=n.value;let s=t.value;if(!r(s))return t.issues.push({expected:`object`,code:`invalid_type`,input:s,inst:e}),t;t.value={};let c=[],l=a.shape;for(let e of a.keys){let n=l[e],r=n._zod.optout===`optional`,i=n._zod.run({value:s[e],issues:[]},o);i instanceof Promise?c.push(i.then(n=>Ur(n,t,e,s,r))):Ur(i,t,e,s,r)}return i?Gr(c,s,t,o,n.value,e):c.length?Promise.all(c).then(()=>t):t}}),qr=O(`$ZodObjectJIT`,(e,t)=>{Kr.init(e,t);let n=e._zod.parse,r=ft(()=>Wr(t)),i=e=>{let t=new rr([`shape`,`payload`,`ctx`]),n=r.value,i=e=>{let t=yt(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write(`const input = payload.value;`);let a=Object.create(null),o=0;for(let e of n.keys)a[e]=`key_${o++}`;t.write(`const newResult = {};`);for(let r of n.keys){let n=a[r],o=yt(r),s=e[r]?._zod?.optout===`optional`;t.write(`const ${n} = ${i(r)};`),s?t.write(`
        if (${n}.issues.length) {
          if (${o} in input) {
            payload.issues = payload.issues.concat(${n}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${o}, ...iss.path] : [${o}]
            })));
          }
        }
        
        if (${n}.value === undefined) {
          if (${o} in input) {
            newResult[${o}] = undefined;
          }
        } else {
          newResult[${o}] = ${n}.value;
        }
        
      `):t.write(`
        if (${n}.issues.length) {
          payload.issues = payload.issues.concat(${n}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${o}, ...iss.path] : [${o}]
          })));
        }
        
        if (${n}.value === undefined) {
          if (${o} in input) {
            newResult[${o}] = undefined;
          }
        } else {
          newResult[${o}] = ${n}.value;
        }
        
      `)}t.write(`payload.value = newResult;`),t.write(`return payload;`);let s=t.compile();return(t,n)=>s(e,t,n)},a,o=St,s=!ct.jitless,c=s&&Ct.value,l=t.catchall,u;e._zod.parse=(d,f)=>{u??=r.value;let p=d.value;return o(p)?s&&c&&f?.async===!1&&f.jitless!==!0?(a||=i(t.shape),d=a(d,f),l?Gr([],p,d,f,u,e):d):n(d,f):(d.issues.push({expected:`object`,code:`invalid_type`,input:p,inst:e}),d)}});function Jr(e,t,n,r){for(let n of e)if(n.issues.length===0)return t.value=n.value,t;let i=e.filter(e=>!Rt(e));return i.length===1?(t.value=i[0].value,i[0]):(t.issues.push({code:`invalid_union`,input:t.value,inst:n,errors:e.map(e=>e.issues.map(e=>Vt(e,r,lt())))}),t)}const Yr=O(`$ZodUnion`,(e,t)=>{ar.init(e,t),k(e._zod,`optin`,()=>t.options.some(e=>e._zod.optin===`optional`)?`optional`:void 0),k(e._zod,`optout`,()=>t.options.some(e=>e._zod.optout===`optional`)?`optional`:void 0),k(e._zod,`values`,()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),k(e._zod,`pattern`,()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>mt(e.source)).join(`|`)})$`)}});let n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(i,a)=>{if(n)return r(i,a);let o=!1,s=[];for(let e of t.options){let t=e._zod.run({value:i.value,issues:[]},a);if(t instanceof Promise)s.push(t),o=!0;else{if(t.issues.length===0)return t;s.push(t)}}return o?Promise.all(s).then(t=>Jr(t,i,e,a)):Jr(s,i,e,a)}}),Xr=O(`$ZodDiscriminatedUnion`,(e,t)=>{t.inclusive=!1,Yr.init(e,t);let n=e._zod.parse;k(e._zod,`propValues`,()=>{let e={};for(let n of t.options){let r=n._zod.propValues;if(!r||Object.keys(r).length===0)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(n)}"`);for(let[t,n]of Object.entries(r)){e[t]||(e[t]=new Set);for(let r of n)e[t].add(r)}}return e});let r=ft(()=>{let e=t.options,n=new Map;for(let r of e){let e=r._zod.propValues?.[t.discriminator];if(!e||e.size===0)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(let t of e){if(n.has(t))throw Error(`Duplicate discriminator value "${String(t)}"`);n.set(t,r)}}return n});e._zod.parse=(i,a)=>{let o=i.value;if(!St(o))return i.issues.push({code:`invalid_type`,expected:`object`,input:o,inst:e}),i;let s=r.value.get(o?.[t.discriminator]);return s?s._zod.run(i,a):t.unionFallback?n(i,a):(i.issues.push({code:`invalid_union`,errors:[],note:`No matching discriminator`,discriminator:t.discriminator,input:o,path:[t.discriminator],inst:e}),i)}}),Zr=O(`$ZodIntersection`,(e,t)=>{ar.init(e,t),e._zod.parse=(e,n)=>{let r=e.value,i=t.left._zod.run({value:r,issues:[]},n),a=t.right._zod.run({value:r,issues:[]},n);return i instanceof Promise||a instanceof Promise?Promise.all([i,a]).then(([t,n])=>$r(e,t,n)):$r(e,i,a)}});function Qr(e,t){if(e===t||e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(wt(e)&&wt(t)){let n=Object.keys(t),r=Object.keys(e).filter(e=>n.indexOf(e)!==-1),i={...e,...t};for(let n of r){let r=Qr(e[n],t[n]);if(!r.valid)return{valid:!1,mergeErrorPath:[n,...r.mergeErrorPath]};i[n]=r.data}return{valid:!0,data:i}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};let n=[];for(let r=0;r<e.length;r++){let i=e[r],a=t[r],o=Qr(i,a);if(!o.valid)return{valid:!1,mergeErrorPath:[r,...o.mergeErrorPath]};n.push(o.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function $r(e,t,n){let r=new Map,i;for(let n of t.issues)if(n.code===`unrecognized_keys`){i??=n;for(let e of n.keys)r.has(e)||r.set(e,{}),r.get(e).l=!0}else e.issues.push(n);for(let t of n.issues)if(t.code===`unrecognized_keys`)for(let e of t.keys)r.has(e)||r.set(e,{}),r.get(e).r=!0;else e.issues.push(t);let a=[...r].filter(([,e])=>e.l&&e.r).map(([e])=>e);if(a.length&&i&&e.issues.push({...i,keys:a}),Rt(e))return e;let o=Qr(t.value,n.value);if(!o.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const ei=O(`$ZodTuple`,(e,t)=>{ar.init(e,t);let n=t.items;e._zod.parse=(r,i)=>{let a=r.value;if(!Array.isArray(a))return r.issues.push({input:a,inst:e,expected:`tuple`,code:`invalid_type`}),r;r.value=[];let o=[],s=[...n].reverse().findIndex(e=>e._zod.optin!==`optional`),c=s===-1?0:n.length-s;if(!t.rest){let t=a.length>n.length,i=a.length<c-1;if(t||i)return r.issues.push({...t?{code:`too_big`,maximum:n.length,inclusive:!0}:{code:`too_small`,minimum:n.length},input:a,inst:e,origin:`array`}),r}let l=-1;for(let e of n){if(l++,l>=a.length&&l>=c)continue;let t=e._zod.run({value:a[l],issues:[]},i);t instanceof Promise?o.push(t.then(e=>ti(e,r,l))):ti(t,r,l)}if(t.rest){let e=a.slice(n.length);for(let n of e){l++;let e=t.rest._zod.run({value:n,issues:[]},i);e instanceof Promise?o.push(e.then(e=>ti(e,r,l))):ti(e,r,l)}}return o.length?Promise.all(o).then(()=>r):r}});function ti(e,t,n){e.issues.length&&t.issues.push(...zt(n,e.issues)),t.value[n]=e.value}const ni=O(`$ZodRecord`,(e,t)=>{ar.init(e,t),e._zod.parse=(n,r)=>{let i=n.value;if(!wt(i))return n.issues.push({expected:`record`,code:`invalid_type`,input:i,inst:e}),n;let a=[],o=t.keyType._zod.values;if(o){n.value={};let s=new Set;for(let e of o)if(typeof e==`string`||typeof e==`number`||typeof e==`symbol`){s.add(typeof e==`number`?e.toString():e);let o=t.valueType._zod.run({value:i[e],issues:[]},r);o instanceof Promise?a.push(o.then(t=>{t.issues.length&&n.issues.push(...zt(e,t.issues)),n.value[e]=t.value})):(o.issues.length&&n.issues.push(...zt(e,o.issues)),n.value[e]=o.value)}let c;for(let e in i)s.has(e)||(c??=[],c.push(e));c&&c.length>0&&n.issues.push({code:`unrecognized_keys`,input:i,inst:e,keys:c})}else{n.value={};for(let o of Reflect.ownKeys(i)){if(o===`__proto__`)continue;let s=t.keyType._zod.run({value:o,issues:[]},r);if(s instanceof Promise)throw Error(`Async schemas not supported in object keys currently`);if(typeof o==`string`&&Fn.test(o)&&s.issues.length&&s.issues.some(e=>e.code===`invalid_type`&&e.expected===`number`)){let e=t.keyType._zod.run({value:Number(o),issues:[]},r);if(e instanceof Promise)throw Error(`Async schemas not supported in object keys currently`);e.issues.length===0&&(s=e)}if(s.issues.length){t.mode===`loose`?n.value[o]=i[o]:n.issues.push({code:`invalid_key`,origin:`record`,issues:s.issues.map(e=>Vt(e,r,lt())),input:o,path:[o],inst:e});continue}let c=t.valueType._zod.run({value:i[o],issues:[]},r);c instanceof Promise?a.push(c.then(e=>{e.issues.length&&n.issues.push(...zt(o,e.issues)),n.value[s.value]=e.value})):(c.issues.length&&n.issues.push(...zt(o,c.issues)),n.value[s.value]=c.value)}}return a.length?Promise.all(a).then(()=>n):n}}),ri=O(`$ZodEnum`,(e,t)=>{ar.init(e,t);let n=ut(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=RegExp(`^(${n.filter(e=>Et.has(typeof e)).map(e=>typeof e==`string`?Dt(e):e.toString()).join(`|`)})$`),e._zod.parse=(t,i)=>{let a=t.value;return r.has(a)||t.issues.push({code:`invalid_value`,values:n,input:a,inst:e}),t}}),ii=O(`$ZodLiteral`,(e,t)=>{if(ar.init(e,t),t.values.length===0)throw Error(`Cannot create literal schema with no valid values`);let n=new Set(t.values);e._zod.values=n,e._zod.pattern=RegExp(`^(${t.values.map(e=>typeof e==`string`?Dt(e):e?Dt(e.toString()):String(e)).join(`|`)})$`),e._zod.parse=(r,i)=>{let a=r.value;return n.has(a)||r.issues.push({code:`invalid_value`,values:t.values,input:a,inst:e}),r}}),ai=O(`$ZodTransform`,(e,t)=>{ar.init(e,t),e._zod.parse=(n,r)=>{if(r.direction===`backward`)throw new st(e.constructor.name);let i=t.transform(n.value,n);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(e=>(n.value=e,n));if(i instanceof Promise)throw new ot;return n.value=i,n}});function oi(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const si=O(`$ZodOptional`,(e,t)=>{ar.init(e,t),e._zod.optin=`optional`,e._zod.optout=`optional`,k(e._zod,`values`,()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),k(e._zod,`pattern`,()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${mt(e.source)})?$`):void 0}),e._zod.parse=(e,n)=>{if(t.innerType._zod.optin===`optional`){let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(t=>oi(t,e.value)):oi(r,e.value)}return e.value===void 0?e:t.innerType._zod.run(e,n)}}),ci=O(`$ZodExactOptional`,(e,t)=>{si.init(e,t),k(e._zod,`values`,()=>t.innerType._zod.values),k(e._zod,`pattern`,()=>t.innerType._zod.pattern),e._zod.parse=(e,n)=>t.innerType._zod.run(e,n)}),li=O(`$ZodNullable`,(e,t)=>{ar.init(e,t),k(e._zod,`optin`,()=>t.innerType._zod.optin),k(e._zod,`optout`,()=>t.innerType._zod.optout),k(e._zod,`pattern`,()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${mt(e.source)}|null)$`):void 0}),k(e._zod,`values`,()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,n)=>e.value===null?e:t.innerType._zod.run(e,n)}),ui=O(`$ZodDefault`,(e,t)=>{ar.init(e,t),e._zod.optin=`optional`,k(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);if(e.value===void 0)return e.value=t.defaultValue,e;let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(e=>di(e,t)):di(r,t)}});function di(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const fi=O(`$ZodPrefault`,(e,t)=>{ar.init(e,t),e._zod.optin=`optional`,k(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>(n.direction===`backward`||e.value===void 0&&(e.value=t.defaultValue),t.innerType._zod.run(e,n))}),pi=O(`$ZodNonOptional`,(e,t)=>{ar.init(e,t),k(e._zod,`values`,()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>e!==void 0)):void 0}),e._zod.parse=(n,r)=>{let i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(t=>mi(t,e)):mi(i,e)}});function mi(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:`invalid_type`,expected:`nonoptional`,input:e.value,inst:t}),e}const hi=O(`$ZodCatch`,(e,t)=>{ar.init(e,t),k(e._zod,`optin`,()=>t.innerType._zod.optin),k(e._zod,`optout`,()=>t.innerType._zod.optout),k(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(r=>(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>Vt(e,n,lt()))},input:e.value}),e.issues=[]),e)):(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>Vt(e,n,lt()))},input:e.value}),e.issues=[]),e)}}),gi=O(`$ZodPipe`,(e,t)=>{ar.init(e,t),k(e._zod,`values`,()=>t.in._zod.values),k(e._zod,`optin`,()=>t.in._zod.optin),k(e._zod,`optout`,()=>t.out._zod.optout),k(e._zod,`propValues`,()=>t.in._zod.propValues),e._zod.parse=(e,n)=>{if(n.direction===`backward`){let r=t.out._zod.run(e,n);return r instanceof Promise?r.then(e=>_i(e,t.in,n)):_i(r,t.in,n)}let r=t.in._zod.run(e,n);return r instanceof Promise?r.then(e=>_i(e,t.out,n)):_i(r,t.out,n)}});function _i(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const vi=O(`$ZodReadonly`,(e,t)=>{ar.init(e,t),k(e._zod,`propValues`,()=>t.innerType._zod.propValues),k(e._zod,`values`,()=>t.innerType._zod.values),k(e._zod,`optin`,()=>t.innerType?._zod?.optin),k(e._zod,`optout`,()=>t.innerType?._zod?.optout),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(yi):yi(r)}});function yi(e){return e.value=Object.freeze(e.value),e}const bi=O(`$ZodLazy`,(e,t)=>{ar.init(e,t),k(e._zod,`innerType`,()=>t.getter()),k(e._zod,`pattern`,()=>e._zod.innerType?._zod?.pattern),k(e._zod,`propValues`,()=>e._zod.innerType?._zod?.propValues),k(e._zod,`optin`,()=>e._zod.innerType?._zod?.optin??void 0),k(e._zod,`optout`,()=>e._zod.innerType?._zod?.optout??void 0),e._zod.parse=(t,n)=>e._zod.innerType._zod.run(t,n)}),xi=O(`$ZodCustom`,(e,t)=>{Bn.init(e,t),ar.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=n=>{let r=n.value,i=t.fn(r);if(i instanceof Promise)return i.then(t=>Si(t,n,r,e));Si(i,n,r,e)}});function Si(e,t,n,r){if(!e){let e={code:`custom`,input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(e.params=r._zod.def.params),t.issues.push(Ut(e))}}var Ci,wi=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let n=t[0];return this._map.set(e,n),n&&typeof n==`object`&&`id`in n&&this._idmap.set(n.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t==`object`&&`id`in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n={...this.get(t)??{}};delete n.id;let r={...n,...this._map.get(e)};return Object.keys(r).length?r:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function Ti(){return new wi}(Ci=globalThis).__zod_globalRegistry??(Ci.__zod_globalRegistry=Ti());const Ei=globalThis.__zod_globalRegistry;function Di(e,t){return new e({type:`string`,...A(t)})}function Oi(e,t){return new e({type:`string`,format:`email`,check:`string_format`,abort:!1,...A(t)})}function ki(e,t){return new e({type:`string`,format:`guid`,check:`string_format`,abort:!1,...A(t)})}function Ai(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,...A(t)})}function ji(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v4`,...A(t)})}function Mi(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v6`,...A(t)})}function Ni(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v7`,...A(t)})}function Pi(e,t){return new e({type:`string`,format:`url`,check:`string_format`,abort:!1,...A(t)})}function Fi(e,t){return new e({type:`string`,format:`emoji`,check:`string_format`,abort:!1,...A(t)})}function Ii(e,t){return new e({type:`string`,format:`nanoid`,check:`string_format`,abort:!1,...A(t)})}function Li(e,t){return new e({type:`string`,format:`cuid`,check:`string_format`,abort:!1,...A(t)})}function Ri(e,t){return new e({type:`string`,format:`cuid2`,check:`string_format`,abort:!1,...A(t)})}function zi(e,t){return new e({type:`string`,format:`ulid`,check:`string_format`,abort:!1,...A(t)})}function Bi(e,t){return new e({type:`string`,format:`xid`,check:`string_format`,abort:!1,...A(t)})}function Vi(e,t){return new e({type:`string`,format:`ksuid`,check:`string_format`,abort:!1,...A(t)})}function Hi(e,t){return new e({type:`string`,format:`ipv4`,check:`string_format`,abort:!1,...A(t)})}function Ui(e,t){return new e({type:`string`,format:`ipv6`,check:`string_format`,abort:!1,...A(t)})}function Wi(e,t){return new e({type:`string`,format:`cidrv4`,check:`string_format`,abort:!1,...A(t)})}function Gi(e,t){return new e({type:`string`,format:`cidrv6`,check:`string_format`,abort:!1,...A(t)})}function Ki(e,t){return new e({type:`string`,format:`base64`,check:`string_format`,abort:!1,...A(t)})}function qi(e,t){return new e({type:`string`,format:`base64url`,check:`string_format`,abort:!1,...A(t)})}function Ji(e,t){return new e({type:`string`,format:`e164`,check:`string_format`,abort:!1,...A(t)})}function Yi(e,t){return new e({type:`string`,format:`jwt`,check:`string_format`,abort:!1,...A(t)})}function Xi(e,t){return new e({type:`string`,format:`datetime`,check:`string_format`,offset:!1,local:!1,precision:null,...A(t)})}function Zi(e,t){return new e({type:`string`,format:`date`,check:`string_format`,...A(t)})}function Qi(e,t){return new e({type:`string`,format:`time`,check:`string_format`,precision:null,...A(t)})}function $i(e,t){return new e({type:`string`,format:`duration`,check:`string_format`,...A(t)})}function ea(e,t){return new e({type:`number`,checks:[],...A(t)})}function ta(e,t){return new e({type:`number`,coerce:!0,checks:[],...A(t)})}function na(e,t){return new e({type:`number`,check:`number_format`,abort:!1,format:`safeint`,...A(t)})}function ra(e,t){return new e({type:`boolean`,...A(t)})}function ia(e,t){return new e({type:`null`,...A(t)})}function aa(e){return new e({type:`any`})}function oa(e){return new e({type:`unknown`})}function sa(e,t){return new e({type:`never`,...A(t)})}function ca(e,t){return new Hn({check:`less_than`,...A(t),value:e,inclusive:!1})}function la(e,t){return new Hn({check:`less_than`,...A(t),value:e,inclusive:!0})}function ua(e,t){return new Un({check:`greater_than`,...A(t),value:e,inclusive:!1})}function da(e,t){return new Un({check:`greater_than`,...A(t),value:e,inclusive:!0})}function fa(e,t){return new Wn({check:`multiple_of`,...A(t),value:e})}function pa(e,t){return new Kn({check:`max_length`,...A(t),maximum:e})}function ma(e,t){return new qn({check:`min_length`,...A(t),minimum:e})}function ha(e,t){return new Jn({check:`length_equals`,...A(t),length:e})}function ga(e,t){return new Xn({check:`string_format`,format:`regex`,...A(t),pattern:e})}function _a(e){return new Zn({check:`string_format`,format:`lowercase`,...A(e)})}function va(e){return new Qn({check:`string_format`,format:`uppercase`,...A(e)})}function ya(e,t){return new $n({check:`string_format`,format:`includes`,...A(t),includes:e})}function ba(e,t){return new er({check:`string_format`,format:`starts_with`,...A(t),prefix:e})}function xa(e,t){return new tr({check:`string_format`,format:`ends_with`,...A(t),suffix:e})}function Sa(e){return new nr({check:`overwrite`,tx:e})}function Ca(e){return Sa(t=>t.normalize(e))}function wa(){return Sa(e=>e.trim())}function Ta(){return Sa(e=>e.toLowerCase())}function Ea(){return Sa(e=>e.toUpperCase())}function Da(){return Sa(e=>bt(e))}function Oa(e,t,n){return new e({type:`array`,element:t,...A(n)})}function ka(e,t,n){let r=A(n);return r.abort??=!0,new e({type:`custom`,check:`custom`,fn:t,...r})}function Aa(e,t,n){return new e({type:`custom`,check:`custom`,fn:t,...A(n)})}function ja(e){let t=Ma(n=>(n.addIssue=e=>{if(typeof e==`string`)n.issues.push(Ut(e,n.value,t._zod.def));else{let r=e;r.fatal&&(r.continue=!1),r.code??=`custom`,r.input??=n.value,r.inst??=t,r.continue??=!t._zod.def.abort,n.issues.push(Ut(r))}},e(n.value,n)));return t}function Ma(e,t){let n=new Bn({check:`custom`,...A(t)});return n._zod.check=e,n}function Na(e){let t=e?.target??`draft-2020-12`;return t===`draft-4`&&(t=`draft-04`),t===`draft-7`&&(t=`draft-07`),{processors:e.processors??{},metadataRegistry:e?.metadata??Ei,target:t,unrepresentable:e?.unrepresentable??`throw`,override:e?.override??(()=>{}),io:e?.io??`output`,counter:0,seen:new Map,cycles:e?.cycles??`ref`,reused:e?.reused??`inline`,external:e?.external??void 0}}function Pa(e,t,n={path:[],schemaPath:[]}){var r;let i=e._zod.def,a=t.seen.get(e);if(a)return a.count++,n.schemaPath.includes(e)&&(a.cycle=n.path),a.schema;let o={schema:{},count:1,cycle:void 0,path:n.path};t.seen.set(e,o);let s=e._zod.toJSONSchema?.();if(s)o.schema=s;else{let r={...n,schemaPath:[...n.schemaPath,e],path:n.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,o.schema,r);else{let n=o.schema,a=t.processors[i.type];if(!a)throw Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);a(e,t,n,r)}let a=e._zod.parent;a&&(o.ref||=a,Pa(a,t,r),t.seen.get(a).isParent=!0)}let c=t.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),t.io===`input`&&La(e)&&(delete o.schema.examples,delete o.schema.default),t.io===`input`&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,t.seen.get(e).schema}function Fa(e,t){let n=e.seen.get(t);if(!n)throw Error(`Unprocessed schema. This is a bug in Zod.`);let r=new Map;for(let t of e.seen.entries()){let n=e.metadataRegistry.get(t[0])?.id;if(n){let e=r.get(n);if(e&&e!==t[0])throw Error(`Duplicate schema id "${n}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(n,t[0])}}let i=t=>{let r=e.target===`draft-2020-12`?`$defs`:`definitions`;if(e.external){let n=e.external.registry.get(t[0])?.id,i=e.external.uri??(e=>e);if(n)return{ref:i(n)};let a=t[1].defId??t[1].schema.id??`schema${e.counter++}`;return t[1].defId=a,{defId:a,ref:`${i(`__shared`)}#/${r}/${a}`}}if(t[1]===n)return{ref:`#`};let i=`#/${r}/`,a=t[1].schema.id??`__schema${e.counter++}`;return{defId:a,ref:i+a}},a=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:n,defId:r}=i(e);t.def={...t.schema},r&&(t.defId=r);let a=t.schema;for(let e in a)delete a[e];a.$ref=n};if(e.cycles===`throw`)for(let t of e.seen.entries()){let e=t[1];if(e.cycle)throw Error(`Cycle detected: #/${e.cycle?.join(`/`)}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let n of e.seen.entries()){let r=n[1];if(t===n[0]){a(n);continue}if(e.external){let r=e.external.registry.get(n[0])?.id;if(t!==n[0]&&r){a(n);continue}}if(e.metadataRegistry.get(n[0])?.id){a(n);continue}if(r.cycle){a(n);continue}if(r.count>1&&e.reused===`ref`){a(n);continue}}}function Ia(e,t){let n=e.seen.get(t);if(!n)throw Error(`Unprocessed schema. This is a bug in Zod.`);let r=t=>{let n=e.seen.get(t);if(n.ref===null)return;let i=n.def??n.schema,a={...i},o=n.ref;if(n.ref=null,o){r(o);let n=e.seen.get(o),s=n.schema;if(s.$ref&&(e.target===`draft-07`||e.target===`draft-04`||e.target===`openapi-3.0`)?(i.allOf=i.allOf??[],i.allOf.push(s)):Object.assign(i,s),Object.assign(i,a),t._zod.parent===o)for(let e in i)e===`$ref`||e===`allOf`||e in a||delete i[e];if(s.$ref)for(let e in i)e===`$ref`||e===`allOf`||e in n.def&&JSON.stringify(i[e])===JSON.stringify(n.def[e])&&delete i[e]}let s=t._zod.parent;if(s&&s!==o){r(s);let t=e.seen.get(s);if(t?.schema.$ref&&(i.$ref=t.schema.$ref,t.def))for(let e in i)e===`$ref`||e===`allOf`||e in t.def&&JSON.stringify(i[e])===JSON.stringify(t.def[e])&&delete i[e]}e.override({zodSchema:t,jsonSchema:i,path:n.path??[]})};for(let t of[...e.seen.entries()].reverse())r(t[0]);let i={};if(e.target===`draft-2020-12`?i.$schema=`https://json-schema.org/draft/2020-12/schema`:e.target===`draft-07`?i.$schema=`http://json-schema.org/draft-07/schema#`:e.target===`draft-04`?i.$schema=`http://json-schema.org/draft-04/schema#`:e.target,e.external?.uri){let n=e.external.registry.get(t)?.id;if(!n)throw Error("Schema is missing an `id` property");i.$id=e.external.uri(n)}Object.assign(i,n.def??n.schema);let a=e.external?.defs??{};for(let t of e.seen.entries()){let e=t[1];e.def&&e.defId&&(a[e.defId]=e.def)}e.external||Object.keys(a).length>0&&(e.target===`draft-2020-12`?i.$defs=a:i.definitions=a);try{let n=JSON.parse(JSON.stringify(i));return Object.defineProperty(n,`~standard`,{value:{...t[`~standard`],jsonSchema:{input:za(t,`input`,e.processors),output:za(t,`output`,e.processors)}},enumerable:!1,writable:!1}),n}catch{throw Error(`Error converting schema to JSON.`)}}function La(e,t){let n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);let r=e._zod.def;if(r.type===`transform`)return!0;if(r.type===`array`)return La(r.element,n);if(r.type===`set`)return La(r.valueType,n);if(r.type===`lazy`)return La(r.getter(),n);if(r.type===`promise`||r.type===`optional`||r.type===`nonoptional`||r.type===`nullable`||r.type===`readonly`||r.type===`default`||r.type===`prefault`)return La(r.innerType,n);if(r.type===`intersection`)return La(r.left,n)||La(r.right,n);if(r.type===`record`||r.type===`map`)return La(r.keyType,n)||La(r.valueType,n);if(r.type===`pipe`)return La(r.in,n)||La(r.out,n);if(r.type===`object`){for(let e in r.shape)if(La(r.shape[e],n))return!0;return!1}if(r.type===`union`){for(let e of r.options)if(La(e,n))return!0;return!1}if(r.type===`tuple`){for(let e of r.items)if(La(e,n))return!0;return!!(r.rest&&La(r.rest,n))}return!1}const Ra=(e,t={})=>n=>{let r=Na({...n,processors:t});return Pa(e,r),Fa(r,e),Ia(r,e)},za=(e,t,n={})=>r=>{let{libraryOptions:i,target:a}=r??{},o=Na({...i??{},target:a,io:t,processors:n});return Pa(e,o),Fa(o,e),Ia(o,e)},Ba={guid:`uuid`,url:`uri`,datetime:`date-time`,json_string:`json-string`,regex:``},Va=(e,t,n,r)=>{let i=n;i.type=`string`;let{minimum:a,maximum:o,format:s,patterns:c,contentEncoding:l}=e._zod.bag;if(typeof a==`number`&&(i.minLength=a),typeof o==`number`&&(i.maxLength=o),s&&(i.format=Ba[s]??s,i.format===``&&delete i.format,s===`time`&&delete i.format),l&&(i.contentEncoding=l),c&&c.size>0){let e=[...c];e.length===1?i.pattern=e[0].source:e.length>1&&(i.allOf=[...e.map(e=>({...t.target===`draft-07`||t.target===`draft-04`||t.target===`openapi-3.0`?{type:`string`}:{},pattern:e.source}))])}},Ha=(e,t,n,r)=>{let i=n,{minimum:a,maximum:o,format:s,multipleOf:c,exclusiveMaximum:l,exclusiveMinimum:u}=e._zod.bag;typeof s==`string`&&s.includes(`int`)?i.type=`integer`:i.type=`number`,typeof u==`number`&&(t.target===`draft-04`||t.target===`openapi-3.0`?(i.minimum=u,i.exclusiveMinimum=!0):i.exclusiveMinimum=u),typeof a==`number`&&(i.minimum=a,typeof u==`number`&&t.target!==`draft-04`&&(u>=a?delete i.minimum:delete i.exclusiveMinimum)),typeof l==`number`&&(t.target===`draft-04`||t.target===`openapi-3.0`?(i.maximum=l,i.exclusiveMaximum=!0):i.exclusiveMaximum=l),typeof o==`number`&&(i.maximum=o,typeof l==`number`&&t.target!==`draft-04`&&(l<=o?delete i.maximum:delete i.exclusiveMaximum)),typeof c==`number`&&(i.multipleOf=c)},Ua=(e,t,n,r)=>{n.type=`boolean`},Wa=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`BigInt cannot be represented in JSON Schema`)},Ga=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Symbols cannot be represented in JSON Schema`)},Ka=(e,t,n,r)=>{t.target===`openapi-3.0`?(n.type=`string`,n.nullable=!0,n.enum=[null]):n.type=`null`},qa=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Undefined cannot be represented in JSON Schema`)},Ja=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Void cannot be represented in JSON Schema`)},Ya=(e,t,n,r)=>{n.not={}},Xa=(e,t,n,r)=>{},Za=(e,t,n,r)=>{},Qa=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Date cannot be represented in JSON Schema`)},$a=(e,t,n,r)=>{let i=e._zod.def,a=ut(i.entries);a.every(e=>typeof e==`number`)&&(n.type=`number`),a.every(e=>typeof e==`string`)&&(n.type=`string`),n.enum=a},eo=(e,t,n,r)=>{let i=e._zod.def,a=[];for(let e of i.values)if(e===void 0){if(t.unrepresentable===`throw`)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof e==`bigint`){if(t.unrepresentable===`throw`)throw Error(`BigInt literals cannot be represented in JSON Schema`);a.push(Number(e))}else a.push(e);if(a.length!==0)if(a.length===1){let e=a[0];n.type=e===null?`null`:typeof e,t.target===`draft-04`||t.target===`openapi-3.0`?n.enum=[e]:n.const=e}else a.every(e=>typeof e==`number`)&&(n.type=`number`),a.every(e=>typeof e==`string`)&&(n.type=`string`),a.every(e=>typeof e==`boolean`)&&(n.type=`boolean`),a.every(e=>e===null)&&(n.type=`null`),n.enum=a},to=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`NaN cannot be represented in JSON Schema`)},no=(e,t,n,r)=>{let i=n,a=e._zod.pattern;if(!a)throw Error(`Pattern not found in template literal`);i.type=`string`,i.pattern=a.source},ro=(e,t,n,r)=>{let i=n,a={type:`string`,format:`binary`,contentEncoding:`binary`},{minimum:o,maximum:s,mime:c}=e._zod.bag;o!==void 0&&(a.minLength=o),s!==void 0&&(a.maxLength=s),c?c.length===1?(a.contentMediaType=c[0],Object.assign(i,a)):(Object.assign(i,a),i.anyOf=c.map(e=>({contentMediaType:e}))):Object.assign(i,a)},io=(e,t,n,r)=>{n.type=`boolean`},ao=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Custom types cannot be represented in JSON Schema`)},oo=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Function types cannot be represented in JSON Schema`)},so=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Transforms cannot be represented in JSON Schema`)},co=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Map cannot be represented in JSON Schema`)},lo=(e,t,n,r)=>{if(t.unrepresentable===`throw`)throw Error(`Set cannot be represented in JSON Schema`)},uo=(e,t,n,r)=>{let i=n,a=e._zod.def,{minimum:o,maximum:s}=e._zod.bag;typeof o==`number`&&(i.minItems=o),typeof s==`number`&&(i.maxItems=s),i.type=`array`,i.items=Pa(a.element,t,{...r,path:[...r.path,`items`]})},fo=(e,t,n,r)=>{let i=n,a=e._zod.def;i.type=`object`,i.properties={};let o=a.shape;for(let e in o)i.properties[e]=Pa(o[e],t,{...r,path:[...r.path,`properties`,e]});let s=new Set(Object.keys(o)),c=new Set([...s].filter(e=>{let n=a.shape[e]._zod;return t.io===`input`?n.optin===void 0:n.optout===void 0}));c.size>0&&(i.required=Array.from(c)),a.catchall?._zod.def.type===`never`?i.additionalProperties=!1:a.catchall?a.catchall&&(i.additionalProperties=Pa(a.catchall,t,{...r,path:[...r.path,`additionalProperties`]})):t.io===`output`&&(i.additionalProperties=!1)},po=(e,t,n,r)=>{let i=e._zod.def,a=i.inclusive===!1,o=i.options.map((e,n)=>Pa(e,t,{...r,path:[...r.path,a?`oneOf`:`anyOf`,n]}));a?n.oneOf=o:n.anyOf=o},mo=(e,t,n,r)=>{let i=e._zod.def,a=Pa(i.left,t,{...r,path:[...r.path,`allOf`,0]}),o=Pa(i.right,t,{...r,path:[...r.path,`allOf`,1]}),s=e=>`allOf`in e&&Object.keys(e).length===1;n.allOf=[...s(a)?a.allOf:[a],...s(o)?o.allOf:[o]]},ho=(e,t,n,r)=>{let i=n,a=e._zod.def;i.type=`array`;let o=t.target===`draft-2020-12`?`prefixItems`:`items`,s=t.target===`draft-2020-12`||t.target===`openapi-3.0`?`items`:`additionalItems`,c=a.items.map((e,n)=>Pa(e,t,{...r,path:[...r.path,o,n]})),l=a.rest?Pa(a.rest,t,{...r,path:[...r.path,s,...t.target===`openapi-3.0`?[a.items.length]:[]]}):null;t.target===`draft-2020-12`?(i.prefixItems=c,l&&(i.items=l)):t.target===`openapi-3.0`?(i.items={anyOf:c},l&&i.items.anyOf.push(l),i.minItems=c.length,l||(i.maxItems=c.length)):(i.items=c,l&&(i.additionalItems=l));let{minimum:u,maximum:d}=e._zod.bag;typeof u==`number`&&(i.minItems=u),typeof d==`number`&&(i.maxItems=d)},go=(e,t,n,r)=>{let i=n,a=e._zod.def;i.type=`object`;let o=a.keyType,s=o._zod.bag?.patterns;if(a.mode===`loose`&&s&&s.size>0){let e=Pa(a.valueType,t,{...r,path:[...r.path,`patternProperties`,`*`]});i.patternProperties={};for(let t of s)i.patternProperties[t.source]=e}else (t.target===`draft-07`||t.target===`draft-2020-12`)&&(i.propertyNames=Pa(a.keyType,t,{...r,path:[...r.path,`propertyNames`]})),i.additionalProperties=Pa(a.valueType,t,{...r,path:[...r.path,`additionalProperties`]});let c=o._zod.values;if(c){let e=[...c].filter(e=>typeof e==`string`||typeof e==`number`);e.length>0&&(i.required=e)}},_o=(e,t,n,r)=>{let i=e._zod.def,a=Pa(i.innerType,t,r),o=t.seen.get(e);t.target===`openapi-3.0`?(o.ref=i.innerType,n.nullable=!0):n.anyOf=[a,{type:`null`}]},vo=(e,t,n,r)=>{let i=e._zod.def;Pa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType},yo=(e,t,n,r)=>{let i=e._zod.def;Pa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType,n.default=JSON.parse(JSON.stringify(i.defaultValue))},bo=(e,t,n,r)=>{let i=e._zod.def;Pa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType,t.io===`input`&&(n._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},xo=(e,t,n,r)=>{let i=e._zod.def;Pa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType;let o;try{o=i.catchValue(void 0)}catch{throw Error(`Dynamic catch values are not supported in JSON Schema`)}n.default=o},So=(e,t,n,r)=>{let i=e._zod.def,a=t.io===`input`?i.in._zod.def.type===`transform`?i.out:i.in:i.out;Pa(a,t,r);let o=t.seen.get(e);o.ref=a},Co=(e,t,n,r)=>{let i=e._zod.def;Pa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType,n.readOnly=!0},wo=(e,t,n,r)=>{let i=e._zod.def;Pa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType},To=(e,t,n,r)=>{let i=e._zod.def;Pa(i.innerType,t,r);let a=t.seen.get(e);a.ref=i.innerType},Eo=(e,t,n,r)=>{let i=e._zod.innerType;Pa(i,t,r);let a=t.seen.get(e);a.ref=i},Do={string:Va,number:Ha,boolean:Ua,bigint:Wa,symbol:Ga,null:Ka,undefined:qa,void:Ja,never:Ya,any:Xa,unknown:Za,date:Qa,enum:$a,literal:eo,nan:to,template_literal:no,file:ro,success:io,custom:ao,function:oo,transform:so,map:co,set:lo,array:uo,object:fo,union:po,intersection:mo,tuple:ho,record:go,nullable:_o,nonoptional:vo,default:yo,prefault:bo,catch:xo,pipe:So,readonly:Co,promise:wo,optional:To,lazy:Eo};function Oo(e,t){if(`_idmap`in e){let n=e,r=Na({...t,processors:Do}),i={};for(let e of n._idmap.entries()){let[t,n]=e;Pa(n,r)}let a={};r.external={registry:n,uri:t?.uri,defs:i};for(let e of n._idmap.entries()){let[t,n]=e;Fa(r,n),a[t]=Ia(r,n)}return Object.keys(i).length>0&&(a.__shared={[r.target===`draft-2020-12`?`$defs`:`definitions`]:i}),{schemas:a}}let n=Na({...t,processors:Do});return Pa(e,n),Fa(n,e),Ia(n,e)}const ko=O(`ZodISODateTime`,(e,t)=>{yr.init(e,t),es.init(e,t)});function Ao(e){return Xi(ko,e)}const jo=O(`ZodISODate`,(e,t)=>{br.init(e,t),es.init(e,t)});function Mo(e){return Zi(jo,e)}const No=O(`ZodISOTime`,(e,t)=>{xr.init(e,t),es.init(e,t)});function Po(e){return Qi(No,e)}const Fo=O(`ZodISODuration`,(e,t)=>{Sr.init(e,t),es.init(e,t)});function Io(e){return $i(Fo,e)}const Lo=(e,t)=>{Gt.init(e,t),e.name=`ZodError`,Object.defineProperties(e,{format:{value:t=>Jt(e,t)},flatten:{value:t=>qt(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,dt,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,dt,2)}},isEmpty:{get(){return e.issues.length===0}}})};O(`ZodError`,Lo);const Ro=O(`ZodError`,Lo,{Parent:Error}),zo=Yt(Ro),Bo=Xt(Ro),Vo=Zt(Ro),Ho=$t(Ro),Uo=tn(Ro),Wo=nn(Ro),Go=rn(Ro),Ko=an(Ro),qo=on(Ro),Jo=sn(Ro),Yo=cn(Ro),Xo=ln(Ro),Zo=O(`ZodType`,(e,t)=>(ar.init(e,t),Object.assign(e[`~standard`],{jsonSchema:{input:za(e,`input`),output:za(e,`output`)}}),e.toJSONSchema=Ra(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,`_def`,{value:t}),e.check=(...n)=>e.clone(vt(t,{checks:[...t.checks??[],...n.map(e=>typeof e==`function`?{_zod:{check:e,def:{check:`custom`},onattach:[]}}:e)]}),{parent:!0}),e.with=e.check,e.clone=(t,n)=>Ot(e,t,n),e.brand=()=>e,e.register=((t,n)=>(t.add(e,n),e)),e.parse=(t,n)=>zo(e,t,n,{callee:e.parse}),e.safeParse=(t,n)=>Vo(e,t,n),e.parseAsync=async(t,n)=>Bo(e,t,n,{callee:e.parseAsync}),e.safeParseAsync=async(t,n)=>Ho(e,t,n),e.spa=e.safeParseAsync,e.encode=(t,n)=>Uo(e,t,n),e.decode=(t,n)=>Wo(e,t,n),e.encodeAsync=async(t,n)=>Go(e,t,n),e.decodeAsync=async(t,n)=>Ko(e,t,n),e.safeEncode=(t,n)=>qo(e,t,n),e.safeDecode=(t,n)=>Jo(e,t,n),e.safeEncodeAsync=async(t,n)=>Yo(e,t,n),e.safeDecodeAsync=async(t,n)=>Xo(e,t,n),e.refine=(t,n)=>e.check(mc(t,n)),e.superRefine=t=>e.check(hc(t)),e.overwrite=t=>e.check(Sa(t)),e.optional=()=>qs(e),e.exactOptional=()=>Ys(e),e.nullable=()=>Zs(e),e.nullish=()=>qs(Zs(e)),e.nonoptional=t=>rc(e,t),e.array=()=>I(e),e.or=t=>R([e,t]),e.and=t=>Ls(e,t),e.transform=t=>sc(e,Gs(t)),e.default=t=>$s(e,t),e.prefault=t=>tc(e,t),e.catch=t=>ac(e,t),e.pipe=t=>sc(e,t),e.readonly=()=>lc(e),e.describe=t=>{let n=e.clone();return Ei.add(n,{description:t}),n},Object.defineProperty(e,`description`,{get(){return Ei.get(e)?.description},configurable:!0}),e.meta=(...t)=>{if(t.length===0)return Ei.get(e);let n=e.clone();return Ei.add(n,t[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=t=>t(e),e)),Qo=O(`_ZodString`,(e,t)=>{or.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Va(e,t,n,r);let n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...t)=>e.check(ga(...t)),e.includes=(...t)=>e.check(ya(...t)),e.startsWith=(...t)=>e.check(ba(...t)),e.endsWith=(...t)=>e.check(xa(...t)),e.min=(...t)=>e.check(ma(...t)),e.max=(...t)=>e.check(pa(...t)),e.length=(...t)=>e.check(ha(...t)),e.nonempty=(...t)=>e.check(ma(1,...t)),e.lowercase=t=>e.check(_a(t)),e.uppercase=t=>e.check(va(t)),e.trim=()=>e.check(wa()),e.normalize=(...t)=>e.check(Ca(...t)),e.toLowerCase=()=>e.check(Ta()),e.toUpperCase=()=>e.check(Ea()),e.slugify=()=>e.check(Da())}),$o=O(`ZodString`,(e,t)=>{or.init(e,t),Qo.init(e,t),e.email=t=>e.check(Oi(ts,t)),e.url=t=>e.check(Pi(is,t)),e.jwt=t=>e.check(Yi(ys,t)),e.emoji=t=>e.check(Fi(as,t)),e.guid=t=>e.check(ki(ns,t)),e.uuid=t=>e.check(Ai(rs,t)),e.uuidv4=t=>e.check(ji(rs,t)),e.uuidv6=t=>e.check(Mi(rs,t)),e.uuidv7=t=>e.check(Ni(rs,t)),e.nanoid=t=>e.check(Ii(os,t)),e.guid=t=>e.check(ki(ns,t)),e.cuid=t=>e.check(Li(ss,t)),e.cuid2=t=>e.check(Ri(cs,t)),e.ulid=t=>e.check(zi(ls,t)),e.base64=t=>e.check(Ki(gs,t)),e.base64url=t=>e.check(qi(_s,t)),e.xid=t=>e.check(Bi(us,t)),e.ksuid=t=>e.check(Vi(ds,t)),e.ipv4=t=>e.check(Hi(fs,t)),e.ipv6=t=>e.check(Ui(ps,t)),e.cidrv4=t=>e.check(Wi(ms,t)),e.cidrv6=t=>e.check(Gi(hs,t)),e.e164=t=>e.check(Ji(vs,t)),e.datetime=t=>e.check(Ao(t)),e.date=t=>e.check(Mo(t)),e.time=t=>e.check(Po(t)),e.duration=t=>e.check(Io(t))});function j(e){return Di($o,e)}const es=O(`ZodStringFormat`,(e,t)=>{sr.init(e,t),Qo.init(e,t)}),ts=O(`ZodEmail`,(e,t)=>{ur.init(e,t),es.init(e,t)}),ns=O(`ZodGUID`,(e,t)=>{cr.init(e,t),es.init(e,t)}),rs=O(`ZodUUID`,(e,t)=>{lr.init(e,t),es.init(e,t)}),is=O(`ZodURL`,(e,t)=>{dr.init(e,t),es.init(e,t)}),as=O(`ZodEmoji`,(e,t)=>{fr.init(e,t),es.init(e,t)}),os=O(`ZodNanoID`,(e,t)=>{pr.init(e,t),es.init(e,t)}),ss=O(`ZodCUID`,(e,t)=>{mr.init(e,t),es.init(e,t)}),cs=O(`ZodCUID2`,(e,t)=>{hr.init(e,t),es.init(e,t)}),ls=O(`ZodULID`,(e,t)=>{gr.init(e,t),es.init(e,t)}),us=O(`ZodXID`,(e,t)=>{_r.init(e,t),es.init(e,t)}),ds=O(`ZodKSUID`,(e,t)=>{vr.init(e,t),es.init(e,t)}),fs=O(`ZodIPv4`,(e,t)=>{Cr.init(e,t),es.init(e,t)}),ps=O(`ZodIPv6`,(e,t)=>{wr.init(e,t),es.init(e,t)}),ms=O(`ZodCIDRv4`,(e,t)=>{Tr.init(e,t),es.init(e,t)}),hs=O(`ZodCIDRv6`,(e,t)=>{Er.init(e,t),es.init(e,t)}),gs=O(`ZodBase64`,(e,t)=>{Or.init(e,t),es.init(e,t)}),_s=O(`ZodBase64URL`,(e,t)=>{Ar.init(e,t),es.init(e,t)}),vs=O(`ZodE164`,(e,t)=>{jr.init(e,t),es.init(e,t)}),ys=O(`ZodJWT`,(e,t)=>{Nr.init(e,t),es.init(e,t)}),bs=O(`ZodNumber`,(e,t)=>{Pr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Ha(e,t,n,r),e.gt=(t,n)=>e.check(ua(t,n)),e.gte=(t,n)=>e.check(da(t,n)),e.min=(t,n)=>e.check(da(t,n)),e.lt=(t,n)=>e.check(ca(t,n)),e.lte=(t,n)=>e.check(la(t,n)),e.max=(t,n)=>e.check(la(t,n)),e.int=t=>e.check(Ss(t)),e.safe=t=>e.check(Ss(t)),e.positive=t=>e.check(ua(0,t)),e.nonnegative=t=>e.check(da(0,t)),e.negative=t=>e.check(ca(0,t)),e.nonpositive=t=>e.check(la(0,t)),e.multipleOf=(t,n)=>e.check(fa(t,n)),e.step=(t,n)=>e.check(fa(t,n)),e.finite=()=>e;let n=e._zod.bag;e.minValue=Math.max(n.minimum??-1/0,n.exclusiveMinimum??-1/0)??null,e.maxValue=Math.min(n.maximum??1/0,n.exclusiveMaximum??1/0)??null,e.isInt=(n.format??``).includes(`int`)||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function M(e){return ea(bs,e)}const xs=O(`ZodNumberFormat`,(e,t)=>{Fr.init(e,t),bs.init(e,t)});function Ss(e){return na(xs,e)}const Cs=O(`ZodBoolean`,(e,t)=>{Ir.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Ua(e,t,n,r)});function N(e){return ra(Cs,e)}const ws=O(`ZodNull`,(e,t)=>{Lr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Ka(e,t,n,r)});function Ts(e){return ia(ws,e)}const Es=O(`ZodAny`,(e,t)=>{Rr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(e,t,n)=>void 0});function Ds(){return aa(Es)}const Os=O(`ZodUnknown`,(e,t)=>{zr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(e,t,n)=>void 0});function P(){return oa(Os)}const ks=O(`ZodNever`,(e,t)=>{Br.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Ya(e,t,n,r)});function F(e){return sa(ks,e)}const As=O(`ZodArray`,(e,t)=>{Hr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>uo(e,t,n,r),e.element=t.element,e.min=(t,n)=>e.check(ma(t,n)),e.nonempty=t=>e.check(ma(1,t)),e.max=(t,n)=>e.check(pa(t,n)),e.length=(t,n)=>e.check(ha(t,n)),e.unwrap=()=>e.element});function I(e,t){return Oa(As,e,t)}const js=O(`ZodObject`,(e,t)=>{qr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>fo(e,t,n,r),k(e,`shape`,()=>t.shape),e.keyof=()=>B(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:P()}),e.loose=()=>e.clone({...e._zod.def,catchall:P()}),e.strict=()=>e.clone({...e._zod.def,catchall:F()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>Nt(e,t),e.safeExtend=t=>Pt(e,t),e.merge=t=>Ft(e,t),e.pick=t=>jt(e,t),e.omit=t=>Mt(e,t),e.partial=(...t)=>It(Ks,e,t[0]),e.required=(...t)=>Lt(nc,e,t[0])});function L(e,t){return new js({type:`object`,shape:e??{},...A(t)})}function Ms(e,t){return new js({type:`object`,shape:e,catchall:F(),...A(t)})}function Ns(e,t){return new js({type:`object`,shape:e,catchall:P(),...A(t)})}const Ps=O(`ZodUnion`,(e,t)=>{Yr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>po(e,t,n,r),e.options=t.options});function R(e,t){return new Ps({type:`union`,options:e,...A(t)})}const Fs=O(`ZodDiscriminatedUnion`,(e,t)=>{Ps.init(e,t),Xr.init(e,t)});function z(e,t,n){return new Fs({type:`union`,options:t,discriminator:e,...A(n)})}const Is=O(`ZodIntersection`,(e,t)=>{Zr.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>mo(e,t,n,r)});function Ls(e,t){return new Is({type:`intersection`,left:e,right:t})}const Rs=O(`ZodTuple`,(e,t)=>{ei.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>ho(e,t,n,r),e.rest=t=>e.clone({...e._zod.def,rest:t})});function zs(e,t,n){let r=t instanceof ar;return new Rs({type:`tuple`,items:e,rest:r?t:null,...A(r?n:t)})}const Bs=O(`ZodRecord`,(e,t)=>{ni.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>go(e,t,n,r),e.keyType=t.keyType,e.valueType=t.valueType});function Vs(e,t,n){return new Bs({type:`record`,keyType:e,valueType:t,...A(n)})}const Hs=O(`ZodEnum`,(e,t)=>{ri.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>$a(e,t,n,r),e.enum=t.entries,e.options=Object.values(t.entries);let n=new Set(Object.keys(t.entries));e.extract=(e,r)=>{let i={};for(let r of e)if(n.has(r))i[r]=t.entries[r];else throw Error(`Key ${r} not found in enum`);return new Hs({...t,checks:[],...A(r),entries:i})},e.exclude=(e,r)=>{let i={...t.entries};for(let t of e)if(n.has(t))delete i[t];else throw Error(`Key ${t} not found in enum`);return new Hs({...t,checks:[],...A(r),entries:i})}});function B(e,t){return new Hs({type:`enum`,entries:Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e,...A(t)})}const Us=O(`ZodLiteral`,(e,t)=>{ii.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>eo(e,t,n,r),e.values=new Set(t.values),Object.defineProperty(e,`value`,{get(){if(t.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function V(e,t){return new Us({type:`literal`,values:Array.isArray(e)?e:[e],...A(t)})}const Ws=O(`ZodTransform`,(e,t)=>{ai.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>so(e,t,n,r),e._zod.parse=(n,r)=>{if(r.direction===`backward`)throw new st(e.constructor.name);n.addIssue=r=>{if(typeof r==`string`)n.issues.push(Ut(r,n.value,t));else{let t=r;t.fatal&&(t.continue=!1),t.code??=`custom`,t.input??=n.value,t.inst??=e,n.issues.push(Ut(t))}};let i=t.transform(n.value,n);return i instanceof Promise?i.then(e=>(n.value=e,n)):(n.value=i,n)}});function Gs(e){return new Ws({type:`transform`,transform:e})}const Ks=O(`ZodOptional`,(e,t)=>{si.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>To(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function qs(e){return new Ks({type:`optional`,innerType:e})}const Js=O(`ZodExactOptional`,(e,t)=>{ci.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>To(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function Ys(e){return new Js({type:`optional`,innerType:e})}const Xs=O(`ZodNullable`,(e,t)=>{li.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>_o(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function Zs(e){return new Xs({type:`nullable`,innerType:e})}const Qs=O(`ZodDefault`,(e,t)=>{ui.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>yo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function $s(e,t){return new Qs({type:`default`,innerType:e,get defaultValue(){return typeof t==`function`?t():Tt(t)}})}const ec=O(`ZodPrefault`,(e,t)=>{fi.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>bo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function tc(e,t){return new ec({type:`prefault`,innerType:e,get defaultValue(){return typeof t==`function`?t():Tt(t)}})}const nc=O(`ZodNonOptional`,(e,t)=>{pi.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>vo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function rc(e,t){return new nc({type:`nonoptional`,innerType:e,...A(t)})}const ic=O(`ZodCatch`,(e,t)=>{hi.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>xo(e,t,n,r),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function ac(e,t){return new ic({type:`catch`,innerType:e,catchValue:typeof t==`function`?t:()=>t})}const oc=O(`ZodPipe`,(e,t)=>{gi.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>So(e,t,n,r),e.in=t.in,e.out=t.out});function sc(e,t){return new oc({type:`pipe`,in:e,out:t})}const cc=O(`ZodReadonly`,(e,t)=>{vi.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Co(e,t,n,r),e.unwrap=()=>e._zod.def.innerType});function lc(e){return new cc({type:`readonly`,innerType:e})}const uc=O(`ZodLazy`,(e,t)=>{bi.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>Eo(e,t,n,r),e.unwrap=()=>e._zod.def.getter()});function dc(e){return new uc({type:`lazy`,getter:e})}const fc=O(`ZodCustom`,(e,t)=>{xi.init(e,t),Zo.init(e,t),e._zod.processJSONSchema=(t,n,r)=>ao(e,t,n,r)});function pc(e,t){return ka(fc,e??(()=>!0),t)}function mc(e,t={}){return Aa(fc,e,t)}function hc(e){return ja(e)}function gc(e,t={}){let n=new fc({type:`custom`,check:`custom`,fn:t=>t instanceof e,abort:!0,...A(t)});return n._zod.bag.Class=e,n._zod.check=t=>{t.value instanceof e||t.issues.push({code:`invalid_type`,expected:e.name,input:t.value,inst:n,path:[...n._zod.def.path??[]]})},n}function _c(e){return ta(bs,e)}var H;(function(e){e.assertEqual=e=>{};function t(e){}e.assertIs=t;function n(e){throw Error()}e.assertNever=n,e.arrayToEnum=e=>{let t={};for(let n of e)t[n]=n;return t},e.getValidEnumValues=t=>{let n=e.objectKeys(t).filter(e=>typeof t[t[e]]!=`number`),r={};for(let e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys=typeof Object.keys==`function`?e=>Object.keys(e):e=>{let t=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(let n of e)if(t(n))return n},e.isInteger=typeof Number.isInteger==`function`?e=>Number.isInteger(e):e=>typeof e==`number`&&Number.isFinite(e)&&Math.floor(e)===e;function r(e,t=` | `){return e.map(e=>typeof e==`string`?`'${e}'`:e).join(t)}e.joinValues=r,e.jsonStringifyReplacer=(e,t)=>typeof t==`bigint`?t.toString():t})(H||={});var vc;(function(e){e.mergeShapes=(e,t)=>({...e,...t})})(vc||={});const U=H.arrayToEnum([`string`,`nan`,`number`,`integer`,`float`,`boolean`,`date`,`bigint`,`symbol`,`function`,`undefined`,`null`,`array`,`object`,`unknown`,`promise`,`void`,`never`,`map`,`set`]),yc=e=>{switch(typeof e){case`undefined`:return U.undefined;case`string`:return U.string;case`number`:return Number.isNaN(e)?U.nan:U.number;case`boolean`:return U.boolean;case`function`:return U.function;case`bigint`:return U.bigint;case`symbol`:return U.symbol;case`object`:return Array.isArray(e)?U.array:e===null?U.null:e.then&&typeof e.then==`function`&&e.catch&&typeof e.catch==`function`?U.promise:typeof Map<`u`&&e instanceof Map?U.map:typeof Set<`u`&&e instanceof Set?U.set:typeof Date<`u`&&e instanceof Date?U.date:U.object;default:return U.unknown}},W=H.arrayToEnum([`invalid_type`,`invalid_literal`,`custom`,`invalid_union`,`invalid_union_discriminator`,`invalid_enum_value`,`unrecognized_keys`,`invalid_arguments`,`invalid_return_type`,`invalid_date`,`invalid_string`,`too_small`,`too_big`,`invalid_intersection_types`,`not_multiple_of`,`not_finite`]);var bc=class e extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name=`ZodError`,this.issues=e}format(e){let t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(let i of e.issues)if(i.code===`invalid_union`)i.unionErrors.map(r);else if(i.code===`invalid_return_type`)r(i.returnTypeError);else if(i.code===`invalid_arguments`)r(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){let n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(t){if(!(t instanceof e))throw Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,H.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=e=>e.message){let t=Object.create(null),n=[];for(let r of this.issues)if(r.path.length>0){let n=r.path[0];t[n]=t[n]||[],t[n].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};bc.create=e=>new bc(e);var xc=(e,t)=>{let n;switch(e.code){case W.invalid_type:n=e.received===U.undefined?`Required`:`Expected ${e.expected}, received ${e.received}`;break;case W.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,H.jsonStringifyReplacer)}`;break;case W.unrecognized_keys:n=`Unrecognized key(s) in object: ${H.joinValues(e.keys,`, `)}`;break;case W.invalid_union:n=`Invalid input`;break;case W.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${H.joinValues(e.options)}`;break;case W.invalid_enum_value:n=`Invalid enum value. Expected ${H.joinValues(e.options)}, received '${e.received}'`;break;case W.invalid_arguments:n=`Invalid function arguments`;break;case W.invalid_return_type:n=`Invalid function return type`;break;case W.invalid_date:n=`Invalid date`;break;case W.invalid_string:typeof e.validation==`object`?`includes`in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position==`number`&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):`startsWith`in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:`endsWith`in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:H.assertNever(e.validation):n=e.validation===`regex`?`Invalid`:`Invalid ${e.validation}`;break;case W.too_small:n=e.type===`array`?`Array must contain ${e.exact?`exactly`:e.inclusive?`at least`:`more than`} ${e.minimum} element(s)`:e.type===`string`?`String must contain ${e.exact?`exactly`:e.inclusive?`at least`:`over`} ${e.minimum} character(s)`:e.type===`number`||e.type===`bigint`?`Number must be ${e.exact?`exactly equal to `:e.inclusive?`greater than or equal to `:`greater than `}${e.minimum}`:e.type===`date`?`Date must be ${e.exact?`exactly equal to `:e.inclusive?`greater than or equal to `:`greater than `}${new Date(Number(e.minimum))}`:`Invalid input`;break;case W.too_big:n=e.type===`array`?`Array must contain ${e.exact?`exactly`:e.inclusive?`at most`:`less than`} ${e.maximum} element(s)`:e.type===`string`?`String must contain ${e.exact?`exactly`:e.inclusive?`at most`:`under`} ${e.maximum} character(s)`:e.type===`number`?`Number must be ${e.exact?`exactly`:e.inclusive?`less than or equal to`:`less than`} ${e.maximum}`:e.type===`bigint`?`BigInt must be ${e.exact?`exactly`:e.inclusive?`less than or equal to`:`less than`} ${e.maximum}`:e.type===`date`?`Date must be ${e.exact?`exactly`:e.inclusive?`smaller than or equal to`:`smaller than`} ${new Date(Number(e.maximum))}`:`Invalid input`;break;case W.custom:n=`Invalid input`;break;case W.invalid_intersection_types:n=`Intersection results could not be merged`;break;case W.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case W.not_finite:n=`Number must be finite`;break;default:n=t.defaultError,H.assertNever(e)}return{message:n}};let Sc=xc;function Cc(){return Sc}const wc=e=>{let{data:t,path:n,errorMaps:r,issueData:i}=e,a=[...n,...i.path||[]],o={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let s=``,c=r.filter(e=>!!e).slice().reverse();for(let e of c)s=e(o,{data:t,defaultError:s}).message;return{...i,path:a,message:s}};function G(e,t){let n=Cc(),r=wc({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===xc?void 0:xc].filter(e=>!!e)});e.common.issues.push(r)}var Tc=class e{constructor(){this.value=`valid`}dirty(){this.value===`valid`&&(this.value=`dirty`)}abort(){this.value!==`aborted`&&(this.value=`aborted`)}static mergeArray(e,t){let n=[];for(let r of t){if(r.status===`aborted`)return K;r.status===`dirty`&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(t,n){let r=[];for(let e of n){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return e.mergeObjectSync(t,r)}static mergeObjectSync(e,t){let n={};for(let r of t){let{key:t,value:i}=r;if(t.status===`aborted`||i.status===`aborted`)return K;t.status===`dirty`&&e.dirty(),i.status===`dirty`&&e.dirty(),t.value!==`__proto__`&&(i.value!==void 0||r.alwaysSet)&&(n[t.value]=i.value)}return{status:e.value,value:n}}};const K=Object.freeze({status:`aborted`}),Ec=e=>({status:`dirty`,value:e}),Dc=e=>({status:`valid`,value:e}),Oc=e=>e.status===`aborted`,kc=e=>e.status===`dirty`,Ac=e=>e.status===`valid`,jc=e=>typeof Promise<`u`&&e instanceof Promise;var q;(function(e){e.errToObj=e=>typeof e==`string`?{message:e}:e||{},e.toString=e=>typeof e==`string`?e:e?.message})(q||={});var Mc=class{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const Nc=(e,t)=>{if(Ac(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error(`Validation failed but no issues detected.`);return{success:!1,get error(){return this._error||=new bc(e.common.issues),this._error}}};function J(e){if(!e)return{};let{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{let{message:a}=e;return t.code===`invalid_enum_value`?{message:a??i.defaultError}:i.data===void 0?{message:a??r??i.defaultError}:t.code===`invalid_type`?{message:a??n??i.defaultError}:{message:i.defaultError}},description:i}}var Y=class{get description(){return this._def.description}_getType(e){return yc(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:yc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Tc,ctx:{common:e.parent.common,data:e.data,parsedType:yc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(jc(t))throw Error(`Synchronous parse encountered promise.`);return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yc(e)};return Nc(n,this._parseSync({data:e,path:n.path,parent:n}))}"~validate"(e){let t={common:{issues:[],async:!!this[`~standard`].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yc(e)};if(!this[`~standard`].async)try{let n=this._parseSync({data:e,path:[],parent:t});return Ac(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes(`encountered`)&&(this[`~standard`].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>Ac(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yc(e)},r=this._parse({data:e,path:n.path,parent:n});return Nc(n,await(jc(r)?r:Promise.resolve(r)))}refine(e,t){let n=e=>typeof t==`string`||t===void 0?{message:t}:typeof t==`function`?t(e):t;return this._refinement((t,r)=>{let i=e(t),a=()=>r.addIssue({code:W.custom,...n(t)});return typeof Promise<`u`&&i instanceof Promise?i.then(e=>e?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,r)=>e(n)?!0:(r.addIssue(typeof t==`function`?t(n,r):t),!1))}_refinement(e){return new Fl({schema:this,typeName:X.ZodEffects,effect:{type:`refinement`,refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this[`~standard`]={version:1,vendor:`zod`,validate:e=>this[`~validate`](e)}}optional(){return Il.create(this,this._def)}nullable(){return Ll.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return gl.create(this)}promise(){return Pl.create(this,this._def)}or(e){return yl.create([this,e],this._def)}and(e){return Cl.create(this,e,this._def)}transform(e){return new Fl({...J(this._def),schema:this,typeName:X.ZodEffects,effect:{type:`transform`,transform:e}})}default(e){let t=typeof e==`function`?e:()=>e;return new Rl({...J(this._def),innerType:this,defaultValue:t,typeName:X.ZodDefault})}brand(){return new Vl({typeName:X.ZodBranded,type:this,...J(this._def)})}catch(e){let t=typeof e==`function`?e:()=>e;return new zl({...J(this._def),innerType:this,catchValue:t,typeName:X.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Hl.create(this,e)}readonly(){return Ul.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const Pc=/^c[^\s-]{8,}$/i,Fc=/^[0-9a-z]+$/,Ic=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Lc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Rc=/^[a-z0-9_-]{21}$/i,zc=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Bc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Vc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Hc;const Uc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Wc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Gc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Kc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,qc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Jc=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Yc=`((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))`,Xc=RegExp(`^${Yc}$`);function Zc(e){let t=`[0-5]\\d`;e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision??(t=`${t}(\\.\\d+)?`);let n=e.precision?`+`:`?`;return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function Qc(e){return RegExp(`^${Zc(e)}$`)}function $c(e){let t=`${Yc}T${Zc(e)}`,n=[];return n.push(e.local?`Z?`:`Z`),e.offset&&n.push(`([+-]\\d{2}:?\\d{2})`),t=`${t}(${n.join(`|`)})`,RegExp(`^${t}$`)}function el(e,t){return!!((t===`v4`||!t)&&Uc.test(e)||(t===`v6`||!t)&&Gc.test(e))}function tl(e,t){if(!zc.test(e))return!1;try{let[n]=e.split(`.`);if(!n)return!1;let r=n.replace(/-/g,`+`).replace(/_/g,`/`).padEnd(n.length+(4-n.length%4)%4,`=`),i=JSON.parse(atob(r));return!(typeof i!=`object`||!i||`typ`in i&&i?.typ!==`JWT`||!i.alg||t&&i.alg!==t)}catch{return!1}}function nl(e,t){return!!((t===`v4`||!t)&&Wc.test(e)||(t===`v6`||!t)&&Kc.test(e))}var rl=class e extends Y{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==U.string){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.string,received:t.parsedType}),K}let t=new Tc,n;for(let r of this._def.checks)if(r.kind===`min`)e.data.length<r.value&&(n=this._getOrReturnCtx(e,n),G(n,{code:W.too_small,minimum:r.value,type:`string`,inclusive:!0,exact:!1,message:r.message}),t.dirty());else if(r.kind===`max`)e.data.length>r.value&&(n=this._getOrReturnCtx(e,n),G(n,{code:W.too_big,maximum:r.value,type:`string`,inclusive:!0,exact:!1,message:r.message}),t.dirty());else if(r.kind===`length`){let i=e.data.length>r.value,a=e.data.length<r.value;(i||a)&&(n=this._getOrReturnCtx(e,n),i?G(n,{code:W.too_big,maximum:r.value,type:`string`,inclusive:!0,exact:!0,message:r.message}):a&&G(n,{code:W.too_small,minimum:r.value,type:`string`,inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if(r.kind===`email`)Vc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`email`,code:W.invalid_string,message:r.message}),t.dirty());else if(r.kind===`emoji`)Hc||=RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`),Hc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`emoji`,code:W.invalid_string,message:r.message}),t.dirty());else if(r.kind===`uuid`)Lc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`uuid`,code:W.invalid_string,message:r.message}),t.dirty());else if(r.kind===`nanoid`)Rc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`nanoid`,code:W.invalid_string,message:r.message}),t.dirty());else if(r.kind===`cuid`)Pc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`cuid`,code:W.invalid_string,message:r.message}),t.dirty());else if(r.kind===`cuid2`)Fc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`cuid2`,code:W.invalid_string,message:r.message}),t.dirty());else if(r.kind===`ulid`)Ic.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`ulid`,code:W.invalid_string,message:r.message}),t.dirty());else if(r.kind===`url`)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),G(n,{validation:`url`,code:W.invalid_string,message:r.message}),t.dirty()}else r.kind===`regex`?(r.regex.lastIndex=0,r.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`regex`,code:W.invalid_string,message:r.message}),t.dirty())):r.kind===`trim`?e.data=e.data.trim():r.kind===`includes`?e.data.includes(r.value,r.position)||(n=this._getOrReturnCtx(e,n),G(n,{code:W.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty()):r.kind===`toLowerCase`?e.data=e.data.toLowerCase():r.kind===`toUpperCase`?e.data=e.data.toUpperCase():r.kind===`startsWith`?e.data.startsWith(r.value)||(n=this._getOrReturnCtx(e,n),G(n,{code:W.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty()):r.kind===`endsWith`?e.data.endsWith(r.value)||(n=this._getOrReturnCtx(e,n),G(n,{code:W.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty()):r.kind===`datetime`?$c(r).test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{code:W.invalid_string,validation:`datetime`,message:r.message}),t.dirty()):r.kind===`date`?Xc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{code:W.invalid_string,validation:`date`,message:r.message}),t.dirty()):r.kind===`time`?Qc(r).test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{code:W.invalid_string,validation:`time`,message:r.message}),t.dirty()):r.kind===`duration`?Bc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`duration`,code:W.invalid_string,message:r.message}),t.dirty()):r.kind===`ip`?el(e.data,r.version)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`ip`,code:W.invalid_string,message:r.message}),t.dirty()):r.kind===`jwt`?tl(e.data,r.alg)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`jwt`,code:W.invalid_string,message:r.message}),t.dirty()):r.kind===`cidr`?nl(e.data,r.version)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`cidr`,code:W.invalid_string,message:r.message}),t.dirty()):r.kind===`base64`?qc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`base64`,code:W.invalid_string,message:r.message}),t.dirty()):r.kind===`base64url`?Jc.test(e.data)||(n=this._getOrReturnCtx(e,n),G(n,{validation:`base64url`,code:W.invalid_string,message:r.message}),t.dirty()):H.assertNever(r);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:W.invalid_string,...q.errToObj(n)})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}email(e){return this._addCheck({kind:`email`,...q.errToObj(e)})}url(e){return this._addCheck({kind:`url`,...q.errToObj(e)})}emoji(e){return this._addCheck({kind:`emoji`,...q.errToObj(e)})}uuid(e){return this._addCheck({kind:`uuid`,...q.errToObj(e)})}nanoid(e){return this._addCheck({kind:`nanoid`,...q.errToObj(e)})}cuid(e){return this._addCheck({kind:`cuid`,...q.errToObj(e)})}cuid2(e){return this._addCheck({kind:`cuid2`,...q.errToObj(e)})}ulid(e){return this._addCheck({kind:`ulid`,...q.errToObj(e)})}base64(e){return this._addCheck({kind:`base64`,...q.errToObj(e)})}base64url(e){return this._addCheck({kind:`base64url`,...q.errToObj(e)})}jwt(e){return this._addCheck({kind:`jwt`,...q.errToObj(e)})}ip(e){return this._addCheck({kind:`ip`,...q.errToObj(e)})}cidr(e){return this._addCheck({kind:`cidr`,...q.errToObj(e)})}datetime(e){return typeof e==`string`?this._addCheck({kind:`datetime`,precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:`datetime`,precision:e?.precision===void 0?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...q.errToObj(e?.message)})}date(e){return this._addCheck({kind:`date`,message:e})}time(e){return typeof e==`string`?this._addCheck({kind:`time`,precision:null,message:e}):this._addCheck({kind:`time`,precision:e?.precision===void 0?null:e?.precision,...q.errToObj(e?.message)})}duration(e){return this._addCheck({kind:`duration`,...q.errToObj(e)})}regex(e,t){return this._addCheck({kind:`regex`,regex:e,...q.errToObj(t)})}includes(e,t){return this._addCheck({kind:`includes`,value:e,position:t?.position,...q.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:`startsWith`,value:e,...q.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:`endsWith`,value:e,...q.errToObj(t)})}min(e,t){return this._addCheck({kind:`min`,value:e,...q.errToObj(t)})}max(e,t){return this._addCheck({kind:`max`,value:e,...q.errToObj(t)})}length(e,t){return this._addCheck({kind:`length`,value:e,...q.errToObj(t)})}nonempty(e){return this.min(1,q.errToObj(e))}trim(){return new e({...this._def,checks:[...this._def.checks,{kind:`trim`}]})}toLowerCase(){return new e({...this._def,checks:[...this._def.checks,{kind:`toLowerCase`}]})}toUpperCase(){return new e({...this._def,checks:[...this._def.checks,{kind:`toUpperCase`}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind===`datetime`)}get isDate(){return!!this._def.checks.find(e=>e.kind===`date`)}get isTime(){return!!this._def.checks.find(e=>e.kind===`time`)}get isDuration(){return!!this._def.checks.find(e=>e.kind===`duration`)}get isEmail(){return!!this._def.checks.find(e=>e.kind===`email`)}get isURL(){return!!this._def.checks.find(e=>e.kind===`url`)}get isEmoji(){return!!this._def.checks.find(e=>e.kind===`emoji`)}get isUUID(){return!!this._def.checks.find(e=>e.kind===`uuid`)}get isNANOID(){return!!this._def.checks.find(e=>e.kind===`nanoid`)}get isCUID(){return!!this._def.checks.find(e=>e.kind===`cuid`)}get isCUID2(){return!!this._def.checks.find(e=>e.kind===`cuid2`)}get isULID(){return!!this._def.checks.find(e=>e.kind===`ulid`)}get isIP(){return!!this._def.checks.find(e=>e.kind===`ip`)}get isCIDR(){return!!this._def.checks.find(e=>e.kind===`cidr`)}get isBase64(){return!!this._def.checks.find(e=>e.kind===`base64`)}get isBase64url(){return!!this._def.checks.find(e=>e.kind===`base64url`)}get minLength(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e}};rl.create=e=>new rl({checks:[],typeName:X.ZodString,coerce:e?.coerce??!1,...J(e)});function il(e,t){let n=(e.toString().split(`.`)[1]||``).length,r=(t.toString().split(`.`)[1]||``).length,i=n>r?n:r;return Number.parseInt(e.toFixed(i).replace(`.`,``))%Number.parseInt(t.toFixed(i).replace(`.`,``))/10**i}var al=class e extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==U.number){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.number,received:t.parsedType}),K}let t,n=new Tc;for(let r of this._def.checks)r.kind===`int`?H.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),G(t,{code:W.invalid_type,expected:`integer`,received:`float`,message:r.message}),n.dirty()):r.kind===`min`?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),G(t,{code:W.too_small,minimum:r.value,type:`number`,inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):r.kind===`max`?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),G(t,{code:W.too_big,maximum:r.value,type:`number`,inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):r.kind===`multipleOf`?il(e.data,r.value)!==0&&(t=this._getOrReturnCtx(e,t),G(t,{code:W.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):r.kind===`finite`?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),G(t,{code:W.not_finite,message:r.message}),n.dirty()):H.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit(`min`,e,!0,q.toString(t))}gt(e,t){return this.setLimit(`min`,e,!1,q.toString(t))}lte(e,t){return this.setLimit(`max`,e,!0,q.toString(t))}lt(e,t){return this.setLimit(`max`,e,!1,q.toString(t))}setLimit(t,n,r,i){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:q.toString(i)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}int(e){return this._addCheck({kind:`int`,message:q.toString(e)})}positive(e){return this._addCheck({kind:`min`,value:0,inclusive:!1,message:q.toString(e)})}negative(e){return this._addCheck({kind:`max`,value:0,inclusive:!1,message:q.toString(e)})}nonpositive(e){return this._addCheck({kind:`max`,value:0,inclusive:!0,message:q.toString(e)})}nonnegative(e){return this._addCheck({kind:`min`,value:0,inclusive:!0,message:q.toString(e)})}multipleOf(e,t){return this._addCheck({kind:`multipleOf`,value:e,message:q.toString(t)})}finite(e){return this._addCheck({kind:`finite`,message:q.toString(e)})}safe(e){return this._addCheck({kind:`min`,inclusive:!0,value:-(2**53-1),message:q.toString(e)})._addCheck({kind:`max`,inclusive:!0,value:2**53-1,message:q.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind===`int`||e.kind===`multipleOf`&&H.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks)if(n.kind===`finite`||n.kind===`int`||n.kind===`multipleOf`)return!0;else n.kind===`min`?(t===null||n.value>t)&&(t=n.value):n.kind===`max`&&(e===null||n.value<e)&&(e=n.value);return Number.isFinite(t)&&Number.isFinite(e)}};al.create=e=>new al({checks:[],typeName:X.ZodNumber,coerce:e?.coerce||!1,...J(e)});var ol=class e extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==U.bigint)return this._getInvalidInput(e);let t,n=new Tc;for(let r of this._def.checks)r.kind===`min`?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),G(t,{code:W.too_small,type:`bigint`,minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):r.kind===`max`?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),G(t,{code:W.too_big,type:`bigint`,maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):r.kind===`multipleOf`?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),G(t,{code:W.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):H.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.bigint,received:t.parsedType}),K}gte(e,t){return this.setLimit(`min`,e,!0,q.toString(t))}gt(e,t){return this.setLimit(`min`,e,!1,q.toString(t))}lte(e,t){return this.setLimit(`max`,e,!0,q.toString(t))}lt(e,t){return this.setLimit(`max`,e,!1,q.toString(t))}setLimit(t,n,r,i){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:q.toString(i)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}positive(e){return this._addCheck({kind:`min`,value:BigInt(0),inclusive:!1,message:q.toString(e)})}negative(e){return this._addCheck({kind:`max`,value:BigInt(0),inclusive:!1,message:q.toString(e)})}nonpositive(e){return this._addCheck({kind:`max`,value:BigInt(0),inclusive:!0,message:q.toString(e)})}nonnegative(e){return this._addCheck({kind:`min`,value:BigInt(0),inclusive:!0,message:q.toString(e)})}multipleOf(e,t){return this._addCheck({kind:`multipleOf`,value:e,message:q.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e}};ol.create=e=>new ol({checks:[],typeName:X.ZodBigInt,coerce:e?.coerce??!1,...J(e)});var sl=class extends Y{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==U.boolean){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.boolean,received:t.parsedType}),K}return Dc(e.data)}};sl.create=e=>new sl({typeName:X.ZodBoolean,coerce:e?.coerce||!1,...J(e)});var cl=class e extends Y{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==U.date){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.date,received:t.parsedType}),K}if(Number.isNaN(e.data.getTime()))return G(this._getOrReturnCtx(e),{code:W.invalid_date}),K;let t=new Tc,n;for(let r of this._def.checks)r.kind===`min`?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),G(n,{code:W.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:`date`}),t.dirty()):r.kind===`max`?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),G(n,{code:W.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:`date`}),t.dirty()):H.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}min(e,t){return this._addCheck({kind:`min`,value:e.getTime(),message:q.toString(t)})}max(e,t){return this._addCheck({kind:`max`,value:e.getTime(),message:q.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind===`min`&&(e===null||t.value>e)&&(e=t.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let t of this._def.checks)t.kind===`max`&&(e===null||t.value<e)&&(e=t.value);return e==null?null:new Date(e)}};cl.create=e=>new cl({checks:[],coerce:e?.coerce||!1,typeName:X.ZodDate,...J(e)});var ll=class extends Y{_parse(e){if(this._getType(e)!==U.symbol){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.symbol,received:t.parsedType}),K}return Dc(e.data)}};ll.create=e=>new ll({typeName:X.ZodSymbol,...J(e)});var ul=class extends Y{_parse(e){if(this._getType(e)!==U.undefined){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.undefined,received:t.parsedType}),K}return Dc(e.data)}};ul.create=e=>new ul({typeName:X.ZodUndefined,...J(e)});var dl=class extends Y{_parse(e){if(this._getType(e)!==U.null){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.null,received:t.parsedType}),K}return Dc(e.data)}};dl.create=e=>new dl({typeName:X.ZodNull,...J(e)});var fl=class extends Y{constructor(){super(...arguments),this._any=!0}_parse(e){return Dc(e.data)}};fl.create=e=>new fl({typeName:X.ZodAny,...J(e)});var pl=class extends Y{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Dc(e.data)}};pl.create=e=>new pl({typeName:X.ZodUnknown,...J(e)});var ml=class extends Y{_parse(e){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.never,received:t.parsedType}),K}};ml.create=e=>new ml({typeName:X.ZodNever,...J(e)});var hl=class extends Y{_parse(e){if(this._getType(e)!==U.undefined){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.void,received:t.parsedType}),K}return Dc(e.data)}};hl.create=e=>new hl({typeName:X.ZodVoid,...J(e)});var gl=class e extends Y{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==U.array)return G(t,{code:W.invalid_type,expected:U.array,received:t.parsedType}),K;if(r.exactLength!==null){let e=t.data.length>r.exactLength.value,i=t.data.length<r.exactLength.value;(e||i)&&(G(t,{code:e?W.too_big:W.too_small,minimum:i?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:`array`,inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(G(t,{code:W.too_small,minimum:r.minLength.value,type:`array`,inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(G(t,{code:W.too_big,maximum:r.maxLength.value,type:`array`,inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new Mc(t,e,t.path,n)))).then(e=>Tc.mergeArray(n,e));let i=[...t.data].map((e,n)=>r.type._parseSync(new Mc(t,e,t.path,n)));return Tc.mergeArray(n,i)}get element(){return this._def.type}min(t,n){return new e({...this._def,minLength:{value:t,message:q.toString(n)}})}max(t,n){return new e({...this._def,maxLength:{value:t,message:q.toString(n)}})}length(t,n){return new e({...this._def,exactLength:{value:t,message:q.toString(n)}})}nonempty(e){return this.min(1,e)}};gl.create=(e,t)=>new gl({type:e,minLength:null,maxLength:null,exactLength:null,typeName:X.ZodArray,...J(t)});function _l(e){if(e instanceof vl){let t={};for(let n in e.shape){let r=e.shape[n];t[n]=Il.create(_l(r))}return new vl({...e._def,shape:()=>t})}else if(e instanceof gl)return new gl({...e._def,type:_l(e.element)});else if(e instanceof Il)return Il.create(_l(e.unwrap()));else if(e instanceof Ll)return Ll.create(_l(e.unwrap()));else if(e instanceof wl)return wl.create(e.items.map(e=>_l(e)));else return e}var vl=class e extends Y{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:H.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==U.object){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.object,received:t.parsedType}),K}let{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof ml&&this._def.unknownKeys===`strip`))for(let e in n.data)i.includes(e)||a.push(e);let o=[];for(let e of i){let t=r[e],i=n.data[e];o.push({key:{status:`valid`,value:e},value:t._parse(new Mc(n,i,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof ml){let e=this._def.unknownKeys;if(e===`passthrough`)for(let e of a)o.push({key:{status:`valid`,value:e},value:{status:`valid`,value:n.data[e]}});else if(e===`strict`)a.length>0&&(G(n,{code:W.unrecognized_keys,keys:a}),t.dirty());else if(e!==`strip`)throw Error(`Internal ZodObject error: invalid unknownKeys value.`)}else{let e=this._def.catchall;for(let t of a){let r=n.data[t];o.push({key:{status:`valid`,value:t},value:e._parse(new Mc(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of o){let n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>Tc.mergeObjectSync(t,e)):Tc.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(t){return q.errToObj,new e({...this._def,unknownKeys:`strict`,...t===void 0?{}:{errorMap:(e,n)=>{let r=this._def.errorMap?.(e,n).message??n.defaultError;return e.code===`unrecognized_keys`?{message:q.errToObj(t).message??r}:{message:r}}}})}strip(){return new e({...this._def,unknownKeys:`strip`})}passthrough(){return new e({...this._def,unknownKeys:`passthrough`})}extend(t){return new e({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new e({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:X.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(t){return new e({...this._def,catchall:t})}pick(t){let n={};for(let e of H.objectKeys(t))t[e]&&this.shape[e]&&(n[e]=this.shape[e]);return new e({...this._def,shape:()=>n})}omit(t){let n={};for(let e of H.objectKeys(this.shape))t[e]||(n[e]=this.shape[e]);return new e({...this._def,shape:()=>n})}deepPartial(){return _l(this)}partial(t){let n={};for(let e of H.objectKeys(this.shape)){let r=this.shape[e];t&&!t[e]?n[e]=r:n[e]=r.optional()}return new e({...this._def,shape:()=>n})}required(t){let n={};for(let e of H.objectKeys(this.shape))if(t&&!t[e])n[e]=this.shape[e];else{let t=this.shape[e];for(;t instanceof Il;)t=t._def.innerType;n[e]=t}return new e({...this._def,shape:()=>n})}keyof(){return jl(H.objectKeys(this.shape))}};vl.create=(e,t)=>new vl({shape:()=>e,unknownKeys:`strip`,catchall:ml.create(),typeName:X.ZodObject,...J(t)}),vl.strictCreate=(e,t)=>new vl({shape:()=>e,unknownKeys:`strict`,catchall:ml.create(),typeName:X.ZodObject,...J(t)}),vl.lazycreate=(e,t)=>new vl({shape:e,unknownKeys:`strip`,catchall:ml.create(),typeName:X.ZodObject,...J(t)});var yl=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function r(e){for(let t of e)if(t.result.status===`valid`)return t.result;for(let n of e)if(n.result.status===`dirty`)return t.common.issues.push(...n.ctx.common.issues),n.result;let n=e.map(e=>new bc(e.ctx.common.issues));return G(t,{code:W.invalid_union,unionErrors:n}),K}if(t.common.async)return Promise.all(n.map(async e=>{let n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(r);{let e,r=[];for(let i of n){let n={...t,common:{...t.common,issues:[]},parent:null},a=i._parseSync({data:t.data,path:t.path,parent:n});if(a.status===`valid`)return a;a.status===`dirty`&&!e&&(e={result:a,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=r.map(e=>new bc(e));return G(t,{code:W.invalid_union,unionErrors:i}),K}}get options(){return this._def.options}};yl.create=(e,t)=>new yl({options:e,typeName:X.ZodUnion,...J(t)});const bl=e=>e instanceof kl?bl(e.schema):e instanceof Fl?bl(e.innerType()):e instanceof Al?[e.value]:e instanceof Ml?e.options:e instanceof Nl?H.objectValues(e.enum):e instanceof Rl?bl(e._def.innerType):e instanceof ul?[void 0]:e instanceof dl?[null]:e instanceof Il?[void 0,...bl(e.unwrap())]:e instanceof Ll?[null,...bl(e.unwrap())]:e instanceof Vl||e instanceof Ul?bl(e.unwrap()):e instanceof zl?bl(e._def.innerType):[];var xl=class e extends Y{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==U.object)return G(t,{code:W.invalid_type,expected:U.object,received:t.parsedType}),K;let n=this.discriminator,r=t.data[n],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(G(t,{code:W.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),K)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){let i=new Map;for(let e of n){let n=bl(e.shape[t]);if(!n.length)throw Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let r of n){if(i.has(r))throw Error(`Discriminator property ${String(t)} has duplicate value ${String(r)}`);i.set(r,e)}}return new e({typeName:X.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:i,...J(r)})}};function Sl(e,t){let n=yc(e),r=yc(t);if(e===t)return{valid:!0,data:e};if(n===U.object&&r===U.object){let n=H.objectKeys(t),r=H.objectKeys(e).filter(e=>n.indexOf(e)!==-1),i={...e,...t};for(let n of r){let r=Sl(e[n],t[n]);if(!r.valid)return{valid:!1};i[n]=r.data}return{valid:!0,data:i}}else if(n===U.array&&r===U.array){if(e.length!==t.length)return{valid:!1};let n=[];for(let r=0;r<e.length;r++){let i=e[r],a=t[r],o=Sl(i,a);if(!o.valid)return{valid:!1};n.push(o.data)}return{valid:!0,data:n}}else if(n===U.date&&r===U.date&&+e==+t)return{valid:!0,data:e};else return{valid:!1}}var Cl=class extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(Oc(e)||Oc(r))return K;let i=Sl(e.value,r.value);return i.valid?((kc(e)||kc(r))&&t.dirty(),{status:t.value,value:i.data}):(G(n,{code:W.invalid_intersection_types}),K)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Cl.create=(e,t,n)=>new Cl({left:e,right:t,typeName:X.ZodIntersection,...J(n)});var wl=class e extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==U.array)return G(n,{code:W.invalid_type,expected:U.array,received:n.parsedType}),K;if(n.data.length<this._def.items.length)return G(n,{code:W.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:`array`}),K;!this._def.rest&&n.data.length>this._def.items.length&&(G(n,{code:W.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:`array`}),t.dirty());let r=[...n.data].map((e,t)=>{let r=this._def.items[t]||this._def.rest;return r?r._parse(new Mc(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>Tc.mergeArray(t,e)):Tc.mergeArray(t,r)}get items(){return this._def.items}rest(t){return new e({...this._def,rest:t})}};wl.create=(e,t)=>{if(!Array.isArray(e))throw Error(`You must pass an array of schemas to z.tuple([ ... ])`);return new wl({items:e,typeName:X.ZodTuple,rest:null,...J(t)})};var Tl=class e extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==U.object)return G(n,{code:W.invalid_type,expected:U.object,received:n.parsedType}),K;let r=[],i=this._def.keyType,a=this._def.valueType;for(let e in n.data)r.push({key:i._parse(new Mc(n,e,n.path,e)),value:a._parse(new Mc(n,n.data[e],n.path,e)),alwaysSet:e in n.data});return n.common.async?Tc.mergeObjectAsync(t,r):Tc.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof Y?new e({keyType:t,valueType:n,typeName:X.ZodRecord,...J(r)}):new e({keyType:rl.create(),valueType:t,typeName:X.ZodRecord,...J(n)})}},El=class extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==U.map)return G(n,{code:W.invalid_type,expected:U.map,received:n.parsedType}),K;let r=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([e,t],a)=>({key:r._parse(new Mc(n,e,n.path,[a,`key`])),value:i._parse(new Mc(n,t,n.path,[a,`value`]))}));if(n.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let n of a){let r=await n.key,i=await n.value;if(r.status===`aborted`||i.status===`aborted`)return K;(r.status===`dirty`||i.status===`dirty`)&&t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}})}else{let e=new Map;for(let n of a){let r=n.key,i=n.value;if(r.status===`aborted`||i.status===`aborted`)return K;(r.status===`dirty`||i.status===`dirty`)&&t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}}};El.create=(e,t,n)=>new El({valueType:t,keyType:e,typeName:X.ZodMap,...J(n)});var Dl=class e extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==U.set)return G(n,{code:W.invalid_type,expected:U.set,received:n.parsedType}),K;let r=this._def;r.minSize!==null&&n.data.size<r.minSize.value&&(G(n,{code:W.too_small,minimum:r.minSize.value,type:`set`,inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&n.data.size>r.maxSize.value&&(G(n,{code:W.too_big,maximum:r.maxSize.value,type:`set`,inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());let i=this._def.valueType;function a(e){let n=new Set;for(let r of e){if(r.status===`aborted`)return K;r.status===`dirty`&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}let o=[...n.data.values()].map((e,t)=>i._parse(new Mc(n,e,n.path,t)));return n.common.async?Promise.all(o).then(e=>a(e)):a(o)}min(t,n){return new e({...this._def,minSize:{value:t,message:q.toString(n)}})}max(t,n){return new e({...this._def,maxSize:{value:t,message:q.toString(n)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Dl.create=(e,t)=>new Dl({valueType:e,minSize:null,maxSize:null,typeName:X.ZodSet,...J(t)});var Ol=class e extends Y{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==U.function)return G(t,{code:W.invalid_type,expected:U.function,received:t.parsedType}),K;function n(e,n){return wc({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Cc(),xc].filter(e=>!!e),issueData:{code:W.invalid_arguments,argumentsError:n}})}function r(e,n){return wc({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Cc(),xc].filter(e=>!!e),issueData:{code:W.invalid_return_type,returnTypeError:n}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Pl){let e=this;return Dc(async function(...t){let o=new bc([]),s=await e._def.args.parseAsync(t,i).catch(e=>{throw o.addIssue(n(t,e)),o}),c=await Reflect.apply(a,this,s);return await e._def.returns._def.type.parseAsync(c,i).catch(e=>{throw o.addIssue(r(c,e)),o})})}else{let e=this;return Dc(function(...t){let o=e._def.args.safeParse(t,i);if(!o.success)throw new bc([n(t,o.error)]);let s=Reflect.apply(a,this,o.data),c=e._def.returns.safeParse(s,i);if(!c.success)throw new bc([r(s,c.error)]);return c.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new e({...this._def,args:wl.create(t).rest(pl.create())})}returns(t){return new e({...this._def,returns:t})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(t,n,r){return new e({args:t||wl.create([]).rest(pl.create()),returns:n||pl.create(),typeName:X.ZodFunction,...J(r)})}},kl=class extends Y{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};kl.create=(e,t)=>new kl({getter:e,typeName:X.ZodLazy,...J(t)});var Al=class extends Y{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return G(t,{received:t.data,code:W.invalid_literal,expected:this._def.value}),K}return{status:`valid`,value:e.data}}get value(){return this._def.value}};Al.create=(e,t)=>new Al({value:e,typeName:X.ZodLiteral,...J(t)});function jl(e,t){return new Ml({values:e,typeName:X.ZodEnum,...J(t)})}var Ml=class e extends Y{_parse(e){if(typeof e.data!=`string`){let t=this._getOrReturnCtx(e),n=this._def.values;return G(t,{expected:H.joinValues(n),received:t.parsedType,code:W.invalid_type}),K}if(this._cache||=new Set(this._def.values),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return G(t,{received:t.data,code:W.invalid_enum_value,options:n}),K}return Dc(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(t,n=this._def){return e.create(t,{...this._def,...n})}exclude(t,n=this._def){return e.create(this.options.filter(e=>!t.includes(e)),{...this._def,...n})}};Ml.create=jl;var Nl=class extends Y{_parse(e){let t=H.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==U.string&&n.parsedType!==U.number){let e=H.objectValues(t);return G(n,{expected:H.joinValues(e),received:n.parsedType,code:W.invalid_type}),K}if(this._cache||=new Set(H.getValidEnumValues(this._def.values)),!this._cache.has(e.data)){let e=H.objectValues(t);return G(n,{received:n.data,code:W.invalid_enum_value,options:e}),K}return Dc(e.data)}get enum(){return this._def.values}};Nl.create=(e,t)=>new Nl({values:e,typeName:X.ZodNativeEnum,...J(t)});var Pl=class extends Y{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==U.promise&&t.common.async===!1?(G(t,{code:W.invalid_type,expected:U.promise,received:t.parsedType}),K):Dc((t.parsedType===U.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Pl.create=(e,t)=>new Pl({type:e,typeName:X.ZodPromise,...J(t)});var Fl=class extends Y{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===X.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:e=>{G(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),r.type===`preprocess`){let e=r.transform(n.data,i);if(n.common.async)return Promise.resolve(e).then(async e=>{if(t.value===`aborted`)return K;let r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return r.status===`aborted`?K:r.status===`dirty`||t.value===`dirty`?Ec(r.value):r});{if(t.value===`aborted`)return K;let r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return r.status===`aborted`?K:r.status===`dirty`||t.value===`dirty`?Ec(r.value):r}}if(r.type===`refinement`){let e=e=>{let t=r.refinement(e,i);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error(`Async refinement encountered during synchronous parse operation. Use .parseAsync instead.`);return e};if(n.common.async===!1){let r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return r.status===`aborted`?K:(r.status===`dirty`&&t.dirty(),e(r.value),{status:t.value,value:r.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>n.status===`aborted`?K:(n.status===`dirty`&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if(r.type===`transform`)if(n.common.async===!1){let e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Ac(e))return K;let a=r.transform(e.value,i);if(a instanceof Promise)throw Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>Ac(e)?Promise.resolve(r.transform(e.value,i)).then(e=>({status:t.value,value:e})):K);H.assertNever(r)}};Fl.create=(e,t,n)=>new Fl({schema:e,typeName:X.ZodEffects,effect:t,...J(n)}),Fl.createWithPreprocess=(e,t,n)=>new Fl({schema:t,effect:{type:`preprocess`,transform:e},typeName:X.ZodEffects,...J(n)});var Il=class extends Y{_parse(e){return this._getType(e)===U.undefined?Dc(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Il.create=(e,t)=>new Il({innerType:e,typeName:X.ZodOptional,...J(t)});var Ll=class extends Y{_parse(e){return this._getType(e)===U.null?Dc(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ll.create=(e,t)=>new Ll({innerType:e,typeName:X.ZodNullable,...J(t)});var Rl=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===U.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Rl.create=(e,t)=>new Rl({innerType:e,typeName:X.ZodDefault,defaultValue:typeof t.default==`function`?t.default:()=>t.default,...J(t)});var zl=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return jc(r)?r.then(e=>({status:`valid`,value:e.status===`valid`?e.value:this._def.catchValue({get error(){return new bc(n.common.issues)},input:n.data})})):{status:`valid`,value:r.status===`valid`?r.value:this._def.catchValue({get error(){return new bc(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};zl.create=(e,t)=>new zl({innerType:e,typeName:X.ZodCatch,catchValue:typeof t.catch==`function`?t.catch:()=>t.catch,...J(t)});var Bl=class extends Y{_parse(e){if(this._getType(e)!==U.nan){let t=this._getOrReturnCtx(e);return G(t,{code:W.invalid_type,expected:U.nan,received:t.parsedType}),K}return{status:`valid`,value:e.data}}};Bl.create=e=>new Bl({typeName:X.ZodNaN,...J(e)});var Vl=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Hl=class e extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return e.status===`aborted`?K:e.status===`dirty`?(t.dirty(),Ec(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{let e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return e.status===`aborted`?K:e.status===`dirty`?(t.dirty(),{status:`dirty`,value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(t,n){return new e({in:t,out:n,typeName:X.ZodPipeline})}},Ul=class extends Y{_parse(e){let t=this._def.innerType._parse(e),n=e=>(Ac(e)&&(e.value=Object.freeze(e.value)),e);return jc(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}};Ul.create=(e,t)=>new Ul({innerType:e,typeName:X.ZodReadonly,...J(t)}),vl.lazycreate;var X;(function(e){e.ZodString=`ZodString`,e.ZodNumber=`ZodNumber`,e.ZodNaN=`ZodNaN`,e.ZodBigInt=`ZodBigInt`,e.ZodBoolean=`ZodBoolean`,e.ZodDate=`ZodDate`,e.ZodSymbol=`ZodSymbol`,e.ZodUndefined=`ZodUndefined`,e.ZodNull=`ZodNull`,e.ZodAny=`ZodAny`,e.ZodUnknown=`ZodUnknown`,e.ZodNever=`ZodNever`,e.ZodVoid=`ZodVoid`,e.ZodArray=`ZodArray`,e.ZodObject=`ZodObject`,e.ZodUnion=`ZodUnion`,e.ZodDiscriminatedUnion=`ZodDiscriminatedUnion`,e.ZodIntersection=`ZodIntersection`,e.ZodTuple=`ZodTuple`,e.ZodRecord=`ZodRecord`,e.ZodMap=`ZodMap`,e.ZodSet=`ZodSet`,e.ZodFunction=`ZodFunction`,e.ZodLazy=`ZodLazy`,e.ZodLiteral=`ZodLiteral`,e.ZodEnum=`ZodEnum`,e.ZodEffects=`ZodEffects`,e.ZodNativeEnum=`ZodNativeEnum`,e.ZodOptional=`ZodOptional`,e.ZodNullable=`ZodNullable`,e.ZodDefault=`ZodDefault`,e.ZodCatch=`ZodCatch`,e.ZodPromise=`ZodPromise`,e.ZodBranded=`ZodBranded`,e.ZodPipeline=`ZodPipeline`,e.ZodReadonly=`ZodReadonly`})(X||={}),rl.create,al.create,Bl.create,ol.create,sl.create,cl.create,ll.create,ul.create,dl.create,fl.create,pl.create,ml.create,hl.create,gl.create,vl.create,vl.strictCreate,yl.create,xl.create,Cl.create,wl.create,Tl.create,El.create,Dl.create,Ol.create,kl.create,Al.create,Ml.create,Nl.create,Pl.create,Fl.create,Il.create,Ll.create,Fl.createWithPreprocess,Hl.create;var Wl=class extends Error{constructor(e,t){super(e),this.name=`ParseError`,this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function Gl(e){}function Kl(e){if(typeof e==`function`)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=Gl,onError:n=Gl,onRetry:r=Gl,onComment:i}=e,a=``,o=!0,s,c=``,l=``;function u(e){let t=o?e.replace(/^\xEF\xBB\xBF/,``):e,[n,r]=ql(`${a}${t}`);for(let e of n)d(e);a=r,o=!1}function d(e){if(e===``){p();return}if(e.startsWith(`:`)){i&&i(e.slice(e.startsWith(`: `)?2:1));return}let t=e.indexOf(`:`);if(t!==-1){let n=e.slice(0,t),r=e[t+1]===` `?2:1;f(n,e.slice(t+r),e);return}f(e,``,e)}function f(e,t,i){switch(e){case`event`:l=t;break;case`data`:c=`${c}${t}
`;break;case`id`:s=t.includes(`\0`)?void 0:t;break;case`retry`:/^\d+$/.test(t)?r(parseInt(t,10)):n(new Wl(`Invalid \`retry\` value: "${t}"`,{type:`invalid-retry`,value:t,line:i}));break;default:n(new Wl(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:`unknown-field`,field:e,value:t,line:i}));break}}function p(){c.length>0&&t({id:s,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),s=void 0,c=``,l=``}function m(e={}){a&&e.consume&&d(a),o=!0,s=void 0,c=``,l=``,a=``}return{feed:u,reset:m}}function ql(e){let t=[],n=``,r=0;for(;r<e.length;){let i=e.indexOf(`\r`,r),a=e.indexOf(`
`,r),o=-1;if(i!==-1&&a!==-1?o=Math.min(i,a):i===-1?a!==-1&&(o=a):o=i===e.length-1?-1:i,o===-1){n=e.slice(r);break}else{let n=e.slice(r,o);t.push(n),r=o+1,e[r-1]===`\r`&&e[r]===`
`&&r++}}return[t,n]}var Jl=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:n}={}){let r;super({start(i){r=Kl({onEvent:e=>{i.enqueue(e)},onError(t){e===`terminate`?i.error(t):typeof e==`function`&&e(t)},onRetry:t,onComment:n})},transform(e){r.feed(e)}})}};function Yl(...e){return e.reduce((e,t)=>({...e,...t??{}}),{})}function Xl({tools:e=[],providerToolNames:t}){let n={},r={};for(let i of e)if(i.type===`provider`&&i.id in t){let e=t[i.id];n[i.name]=e,r[e]=i.name}return{toProviderToolName:e=>n[e]??e,toCustomToolName:e=>r[e]??e}}async function Zl(e,t){if(e==null)return Promise.resolve();let n=t?.abortSignal;return new Promise((t,r)=>{if(n?.aborted){r(Ql());return}let i=setTimeout(()=>{a(),t()},e),a=()=>{clearTimeout(i),n?.removeEventListener(`abort`,o)},o=()=>{a(),r(Ql())};n?.addEventListener(`abort`,o)})}function Ql(){return new DOMException(`Delay was aborted`,`AbortError`)}var $l=class{constructor(){this.status={type:`pending`},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||=new Promise((e,t)=>{this.status.type===`resolved`?e(this.status.value):this.status.type===`rejected`&&t(this.status.error),this._resolve=e,this._reject=t}),this._promise}resolve(e){var t;this.status={type:`resolved`,value:e},this._promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:`rejected`,error:e},this._promise&&((t=this._reject)==null||t.call(this,e))}isResolved(){return this.status.type===`resolved`}isRejected(){return this.status.type===`rejected`}isPending(){return this.status.type===`pending`}};function eu(e){return Object.fromEntries([...e.headers])}var{btoa:tu,atob:nu}=globalThis;function ru(e){let t=nu(e.replace(/-/g,`+`).replace(/_/g,`/`));return Uint8Array.from(t,e=>e.codePointAt(0))}function iu(e){let t=``;for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return tu(t)}function au(e){return e instanceof Uint8Array?iu(e):e}function ou(e,t={}){let{useArrayBrackets:n=!0}=t,r=new FormData;for(let[t,i]of Object.entries(e))if(i!=null){if(Array.isArray(i)){if(i.length===1){r.append(t,i[0]);continue}let e=n?`${t}[]`:t;for(let t of i)r.append(e,t);continue}r.append(t,i)}return r}var su=`AI_DownloadError`,cu=`vercel.ai.error.${su}`,lu=Symbol.for(cu),uu,du,fu=class extends (du=a,uu=lu,du){constructor({url:e,statusCode:t,statusText:n,cause:r,message:i=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:su,message:i,cause:r}),this[uu]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return a.hasMarker(e,cu)}};async function pu(e){try{let t=await fetch(e);if(!t.ok)throw new fu({url:e,statusCode:t.status,statusText:t.statusText});return await t.blob()}catch(t){throw fu.isInstance(t)?t:new fu({url:e,cause:t})}}var mu=({prefix:e,size:t=16,alphabet:n=`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`,separator:r=`-`}={})=>{let i=()=>{let e=n.length,r=Array(t);for(let i=0;i<t;i++)r[i]=n[Math.random()*e|0];return r.join(``)};if(e==null)return i;if(n.includes(r))throw new w({argument:`separator`,message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${i()}`},hu=mu();function gu(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}function _u(e){return(e instanceof Error||e instanceof DOMException)&&(e.name===`AbortError`||e.name===`ResponseAborted`||e.name===`TimeoutError`)}var vu=[`fetch failed`,`failed to fetch`];function yu({error:e,url:t,requestBodyValues:n}){if(_u(e))return e;if(e instanceof TypeError&&vu.includes(e.message.toLowerCase())){let r=e.cause;if(r!=null)return new d({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}function bu(e=globalThis){return e.window?`runtime/browser`:e.navigator?.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:e.process?.versions?.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?`runtime/vercel-edge`:`runtime/unknown`}function xu(e){if(e==null)return{};let t={};if(e instanceof Headers)e.forEach((e,n)=>{t[n.toLowerCase()]=e});else{Array.isArray(e)||(e=Object.entries(e));for(let[n,r]of e)r!=null&&(t[n.toLowerCase()]=r)}return t}function Su(e,...t){let n=new Headers(xu(e)),r=n.get(`user-agent`)||``;return n.set(`user-agent`,[r,...t].filter(Boolean).join(` `)),Object.fromEntries(n.entries())}var Cu=`4.0.2`,wu=()=>globalThis.fetch,Tu=async({url:e,headers:t={},successfulResponseHandler:n,failedResponseHandler:r,abortSignal:i,fetch:a=wu()})=>{try{let o=await a(e,{method:`GET`,headers:Su(t,`ai-sdk/provider-utils/${Cu}`,bu()),signal:i}),s=eu(o);if(!o.ok){let t;try{t=await r({response:o,url:e,requestBodyValues:{}})}catch(t){throw _u(t)||d.isInstance(t)?t:new d({message:`Failed to process error response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}throw t.value}try{return await n({response:o,url:e,requestBodyValues:{}})}catch(t){throw t instanceof Error&&(_u(t)||d.isInstance(t))?t:new d({message:`Failed to process successful response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}}catch(t){throw yu({error:t,url:e,requestBodyValues:{}})}},Eu=`JSON schema:`,Du=`You MUST answer with a JSON object that matches the JSON schema above.`,Ou=`You MUST answer with JSON.`;function ku({prompt:e,schema:t,schemaPrefix:n=t==null?void 0:Eu,schemaSuffix:r=t==null?Ou:Du}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?``:void 0,n,t==null?void 0:JSON.stringify(t),r].filter(e=>e!=null).join(`
`)}function Au({messages:e,schema:t,schemaPrefix:n,schemaSuffix:r}){let i=e[0]?.role===`system`?{...e[0]}:{role:`system`,content:``};return i.content=ku({prompt:i.content,schema:t,schemaPrefix:n,schemaSuffix:r}),[i,...e[0]?.role===`system`?e.slice(1):e]}function ju(e){return e!=null}function Mu({mediaType:e,url:t,supportedUrls:n}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(n).map(([e,t])=>{let n=e.toLowerCase();return n===`*`||n===`*/*`?{mediaTypePrefix:``,regexes:t}:{mediaTypePrefix:n.replace(/\*/,``),regexes:t}}).filter(({mediaTypePrefix:t})=>e.startsWith(t)).flatMap(({regexes:e})=>e).some(e=>e.test(t))}function Nu({apiKey:e,environmentVariableName:t,apiKeyParameterName:n=`apiKey`,description:r}){if(typeof e==`string`)return e;if(e!=null)throw new be({message:`${r} API key must be a string.`});if(typeof process>`u`)throw new be({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new be({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!=`string`)throw new be({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function Pu({settingValue:e,environmentVariableName:t}){if(typeof e==`string`||!(e!=null||typeof process>`u`)&&(e=process.env[t],!(e==null||typeof e!=`string`)))return e}function Fu(e){let[t,n=``]=e.toLowerCase().split(`/`);return{mpeg:`mp3`,"x-wav":`wav`,opus:`ogg`,mp4:`m4a`,"x-m4a":`m4a`}[n]??n}var Iu=/"__proto__"\s*:/,Lu=/"constructor"\s*:/;function Ru(e){let t=JSON.parse(e);return typeof t!=`object`||!t||Iu.test(e)===!1&&Lu.test(e)===!1?t:zu(t)}function zu(e){let t=[e];for(;t.length;){let e=t;t=[];for(let n of e){if(Object.prototype.hasOwnProperty.call(n,`__proto__`)||Object.prototype.hasOwnProperty.call(n,`constructor`)&&Object.prototype.hasOwnProperty.call(n.constructor,`prototype`))throw SyntaxError(`Object contains forbidden prototype property`);for(let e in n){let r=n[e];r&&typeof r==`object`&&t.push(r)}}}return e}function Bu(e){let{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return Ru(e)}try{return Ru(e)}finally{Error.stackTraceLimit=t}}function Vu(e){if(e.type===`object`){e.additionalProperties=!1;let t=e.properties;if(t!=null)for(let e in t)t[e]=Vu(t[e])}return e.type===`array`&&e.items!=null&&(Array.isArray(e.items)?e.items=e.items.map(e=>Vu(e)):e.items=Vu(e.items)),e}var Hu=Symbol(`Let zodToJsonSchema decide on which parser to use`),Uu={name:void 0,$refStrategy:`root`,basePath:[`#`],effectStrategy:`input`,pipeStrategy:`all`,dateStrategy:`format:date-time`,mapStrategy:`entries`,removeAdditionalStrategy:`passthrough`,allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:`definitions`,strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:`escape`,applyRegexFlags:!1,emailStrategy:`format:email`,base64Strategy:`contentEncoding:base64`,nameStrategy:`ref`},Wu=e=>typeof e==`string`?{...Uu,name:e}:{...Uu,...e};function Gu(){return{}}function Ku(e,t){let n={type:`array`};return e.type?._def&&e.type?._def?.typeName!==X.ZodAny&&(n.items=Ld(e.type._def,{...t,currentPath:[...t.currentPath,`items`]})),e.minLength&&(n.minItems=e.minLength.value),e.maxLength&&(n.maxItems=e.maxLength.value),e.exactLength&&(n.minItems=e.exactLength.value,n.maxItems=e.exactLength.value),n}function qu(e){let t={type:`integer`,format:`int64`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function Ju(){return{type:`boolean`}}function Yu(e,t){return Ld(e.type._def,t)}var Xu=(e,t)=>Ld(e.innerType._def,t);function Zu(e,t,n){let r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,r)=>Zu(e,t,n))};switch(r){case`string`:case`format:date-time`:return{type:`string`,format:`date-time`};case`format:date`:return{type:`string`,format:`date`};case`integer`:return Qu(e)}}var Qu=e=>{let t={type:`integer`,format:`unix-time`};for(let n of e.checks)switch(n.kind){case`min`:t.minimum=n.value;break;case`max`:t.maximum=n.value;break}return t};function $u(e,t){return{...Ld(e.innerType._def,t),default:e.defaultValue()}}function ed(e,t){return t.effectStrategy===`input`?Ld(e.schema._def,t):Gu()}function td(e){return{type:`string`,enum:Array.from(e.values)}}var nd=e=>`type`in e&&e.type===`string`?!1:`allOf`in e;function rd(e,t){let n=[Ld(e.left._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]}),Ld(e.right._def,{...t,currentPath:[...t.currentPath,`allOf`,`1`]})].filter(e=>!!e),r=[];return n.forEach(e=>{if(nd(e))r.push(...e.allOf);else{let t=e;if(`additionalProperties`in e&&e.additionalProperties===!1){let{additionalProperties:n,...r}=e;t=r}r.push(t)}}),r.length?{allOf:r}:void 0}function id(e){let t=typeof e.value;return t!==`bigint`&&t!==`number`&&t!==`boolean`&&t!==`string`?{type:Array.isArray(e.value)?`array`:`object`}:{type:t===`bigint`?`integer`:t,const:e.value}}var ad=void 0,od={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ad===void 0&&(ad=RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`)),ad),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function sd(e,t){let n={type:`string`};if(e.checks)for(let r of e.checks)switch(r.kind){case`min`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value;break;case`max`:n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`email`:switch(t.emailStrategy){case`format:email`:dd(n,`email`,r.message,t);break;case`format:idn-email`:dd(n,`idn-email`,r.message,t);break;case`pattern:zod`:fd(n,od.email,r.message,t);break}break;case`url`:dd(n,`uri`,r.message,t);break;case`uuid`:dd(n,`uuid`,r.message,t);break;case`regex`:fd(n,r.regex,r.message,t);break;case`cuid`:fd(n,od.cuid,r.message,t);break;case`cuid2`:fd(n,od.cuid2,r.message,t);break;case`startsWith`:fd(n,RegExp(`^${cd(r.value,t)}`),r.message,t);break;case`endsWith`:fd(n,RegExp(`${cd(r.value,t)}$`),r.message,t);break;case`datetime`:dd(n,`date-time`,r.message,t);break;case`date`:dd(n,`date`,r.message,t);break;case`time`:dd(n,`time`,r.message,t);break;case`duration`:dd(n,`duration`,r.message,t);break;case`length`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value,n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`includes`:fd(n,RegExp(cd(r.value,t)),r.message,t);break;case`ip`:r.version!==`v6`&&dd(n,`ipv4`,r.message,t),r.version!==`v4`&&dd(n,`ipv6`,r.message,t);break;case`base64url`:fd(n,od.base64url,r.message,t);break;case`jwt`:fd(n,od.jwt,r.message,t);break;case`cidr`:r.version!==`v6`&&fd(n,od.ipv4Cidr,r.message,t),r.version!==`v4`&&fd(n,od.ipv6Cidr,r.message,t);break;case`emoji`:fd(n,od.emoji(),r.message,t);break;case`ulid`:fd(n,od.ulid,r.message,t);break;case`base64`:switch(t.base64Strategy){case`format:binary`:dd(n,`binary`,r.message,t);break;case`contentEncoding:base64`:n.contentEncoding=`base64`;break;case`pattern:zod`:fd(n,od.base64,r.message,t);break}break;case`nanoid`:fd(n,od.nanoid,r.message,t);case`toLowerCase`:case`toUpperCase`:case`trim`:break;default:}return n}function cd(e,t){return t.patternStrategy===`escape`?ud(e):e}var ld=new Set(`ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789`);function ud(e){let t=``;for(let n=0;n<e.length;n++)ld.has(e[n])||(t+=`\\`),t+=e[n];return t}function dd(e,t,n,r){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||=[],e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function fd(e,t,n,r){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||=[],e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:pd(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=pd(t,r)}function pd(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let n={i:e.flags.includes(`i`),m:e.flags.includes(`m`),s:e.flags.includes(`s`)},r=n.i?e.source.toLowerCase():e.source,i=``,a=!1,o=!1,s=!1;for(let e=0;e<r.length;e++){if(a){i+=r[e],a=!1;continue}if(n.i){if(o){if(r[e].match(/[a-z]/)){s?(i+=r[e],i+=`${r[e-2]}-${r[e]}`.toUpperCase(),s=!1):r[e+1]===`-`&&r[e+2]?.match(/[a-z]/)?(i+=r[e],s=!0):i+=`${r[e]}${r[e].toUpperCase()}`;continue}}else if(r[e].match(/[a-z]/)){i+=`[${r[e]}${r[e].toUpperCase()}]`;continue}}if(n.m){if(r[e]===`^`){i+=`(^|(?<=[\r
]))`;continue}else if(r[e]===`$`){i+=`($|(?=[\r
]))`;continue}}if(n.s&&r[e]===`.`){i+=o?`${r[e]}\r
`:`[${r[e]}\r
]`;continue}i+=r[e],r[e]===`\\`?a=!0:o&&r[e]===`]`?o=!1:!o&&r[e]===`[`&&(o=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join(`/`)} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function md(e,t){let n={type:`object`,additionalProperties:Ld(e.valueType._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]})??t.allowedAdditionalProperties};if(e.keyType?._def.typeName===X.ZodString&&e.keyType._def.checks?.length){let{type:r,...i}=sd(e.keyType._def,t);return{...n,propertyNames:i}}else if(e.keyType?._def.typeName===X.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};else if(e.keyType?._def.typeName===X.ZodBranded&&e.keyType._def.type._def.typeName===X.ZodString&&e.keyType._def.type._def.checks?.length){let{type:r,...i}=Yu(e.keyType._def,t);return{...n,propertyNames:i}}return n}function hd(e,t){return t.mapStrategy===`record`?md(e,t):{type:`array`,maxItems:125,items:{type:`array`,items:[Ld(e.keyType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`0`]})||Gu(),Ld(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`1`]})||Gu()],minItems:2,maxItems:2}}}function gd(e){let t=e.values,n=Object.keys(e.values).filter(e=>typeof t[t[e]]!=`number`).map(e=>t[e]),r=Array.from(new Set(n.map(e=>typeof e)));return{type:r.length===1?r[0]===`string`?`string`:`number`:[`string`,`number`],enum:n}}function _d(){return{not:Gu()}}function vd(){return{type:`null`}}var yd={ZodString:`string`,ZodNumber:`number`,ZodBigInt:`integer`,ZodBoolean:`boolean`,ZodNull:`null`};function bd(e,t){let n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in yd&&(!e._def.checks||!e._def.checks.length))){let e=n.reduce((e,t)=>{let n=yd[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}else if(n.every(e=>e._def.typeName===`ZodLiteral`&&!e.description)){let e=n.reduce((e,t)=>{let n=typeof t._def.value;switch(n){case`string`:case`number`:case`boolean`:return[...e,n];case`bigint`:return[...e,`integer`];case`object`:if(t._def.value===null)return[...e,`null`];case`symbol`:case`undefined`:case`function`:default:return e}},[]);if(e.length===n.length){let t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>e._def.typeName===`ZodEnum`))return{type:`string`,enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return xd(e,t)}var xd=(e,t)=>{let n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>Ld(e._def,{...t,currentPath:[...t.currentPath,`anyOf`,`${n}`]})).filter(e=>!!e&&(!t.strictUnions||typeof e==`object`&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function Sd(e,t){if([`ZodString`,`ZodNumber`,`ZodBigInt`,`ZodBoolean`,`ZodNull`].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[yd[e.innerType._def.typeName],`null`]};let n=Ld(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`0`]});return n&&{anyOf:[n,{type:`null`}]}}function Cd(e){let t={type:`number`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`int`:t.type=`integer`;break;case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function wd(e,t){let n={type:`object`,properties:{}},r=[],i=e.shape();for(let e in i){let a=i[e];if(a===void 0||a._def===void 0)continue;let o=Ed(a),s=Ld(a._def,{...t,currentPath:[...t.currentPath,`properties`,e],propertyPath:[...t.currentPath,`properties`,e]});s!==void 0&&(n.properties[e]=s,o||r.push(e))}r.length&&(n.required=r);let a=Td(e,t);return a!==void 0&&(n.additionalProperties=a),n}function Td(e,t){if(e.catchall._def.typeName!==`ZodNever`)return Ld(e.catchall._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]});switch(e.unknownKeys){case`passthrough`:return t.allowedAdditionalProperties;case`strict`:return t.rejectedAdditionalProperties;case`strip`:return t.removeAdditionalStrategy===`strict`?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Ed(e){try{return e.isOptional()}catch{return!0}}var Dd=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return Ld(e.innerType._def,t);let n=Ld(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`1`]});return n?{anyOf:[{not:Gu()},n]}:Gu()},Od=(e,t)=>{if(t.pipeStrategy===`input`)return Ld(e.in._def,t);if(t.pipeStrategy===`output`)return Ld(e.out._def,t);let n=Ld(e.in._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]});return{allOf:[n,Ld(e.out._def,{...t,currentPath:[...t.currentPath,`allOf`,n?`1`:`0`]})].filter(e=>e!==void 0)}};function kd(e,t){return Ld(e.type._def,t)}function Ad(e,t){let n={type:`array`,uniqueItems:!0,items:Ld(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`]})};return e.minSize&&(n.minItems=e.minSize.value),e.maxSize&&(n.maxItems=e.maxSize.value),n}function jd(e,t){return e.rest?{type:`array`,minItems:e.items.length,items:e.items.map((e,n)=>Ld(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[]),additionalItems:Ld(e.rest._def,{...t,currentPath:[...t.currentPath,`additionalItems`]})}:{type:`array`,minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>Ld(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[])}}function Md(){return{not:Gu()}}function Nd(){return Gu()}var Pd=(e,t)=>Ld(e.innerType._def,t),Fd=(e,t,n)=>{switch(t){case X.ZodString:return sd(e,n);case X.ZodNumber:return Cd(e);case X.ZodObject:return wd(e,n);case X.ZodBigInt:return qu(e);case X.ZodBoolean:return Ju();case X.ZodDate:return Zu(e,n);case X.ZodUndefined:return Md();case X.ZodNull:return vd();case X.ZodArray:return Ku(e,n);case X.ZodUnion:case X.ZodDiscriminatedUnion:return bd(e,n);case X.ZodIntersection:return rd(e,n);case X.ZodTuple:return jd(e,n);case X.ZodRecord:return md(e,n);case X.ZodLiteral:return id(e);case X.ZodEnum:return td(e);case X.ZodNativeEnum:return gd(e);case X.ZodNullable:return Sd(e,n);case X.ZodOptional:return Dd(e,n);case X.ZodMap:return hd(e,n);case X.ZodSet:return Ad(e,n);case X.ZodLazy:return()=>e.getter()._def;case X.ZodPromise:return kd(e,n);case X.ZodNaN:case X.ZodNever:return _d();case X.ZodEffects:return ed(e,n);case X.ZodAny:return Gu();case X.ZodUnknown:return Nd();case X.ZodDefault:return $u(e,n);case X.ZodBranded:return Yu(e,n);case X.ZodReadonly:return Pd(e,n);case X.ZodCatch:return Xu(e,n);case X.ZodPipeline:return Od(e,n);case X.ZodFunction:case X.ZodVoid:case X.ZodSymbol:return;default:return(e=>void 0)(t)}},Id=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join(`/`)};function Ld(e,t,n=!1){let r=t.seen.get(e);if(t.override){let i=t.override?.call(t,e,t,r,n);if(i!==Hu)return i}if(r&&!n){let e=Rd(r,t);if(e!==void 0)return e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let a=Fd(e,e.typeName,t),o=typeof a==`function`?Ld(a(),t):a;if(o&&zd(e,t,o),t.postProcess){let n=t.postProcess(o,e,t);return i.jsonSchema=o,n}return i.jsonSchema=o,o}var Rd=(e,t)=>{switch(t.$refStrategy){case`root`:return{$ref:e.path.join(`/`)};case`relative`:return{$ref:Id(t.currentPath,e.path)};case`none`:case`seen`:return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join(`/`)}! Defaulting to any`),Gu()):t.$refStrategy===`seen`?Gu():void 0}},zd=(e,t,n)=>(e.description&&(n.description=e.description),n),Bd=e=>{let t=Wu(e),n=t.name===void 0?t.basePath:[...t.basePath,t.definitionPath,t.name];return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}},Vd=(e,t)=>{let n=Bd(t),r=typeof t==`object`&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>({...e,[t]:Ld(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??Gu()}),{}):void 0,i=typeof t==`string`?t:t?.nameStrategy===`title`?void 0:t?.name,a=Ld(e._def,i===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,i]},!1)??Gu(),o=typeof t==`object`&&t.name!==void 0&&t.nameStrategy===`title`?t.name:void 0;o!==void 0&&(a.title=o);let s=i===void 0?r?{...a,[n.definitionPath]:r}:a:{$ref:[...n.$refStrategy===`relative`?[]:n.basePath,n.definitionPath,i].join(`/`),[n.definitionPath]:{...r,[i]:a}};return s.$schema=`http://json-schema.org/draft-07/schema#`,s},Hd=Symbol.for(`vercel.ai.schema`);function Z(e){let t;return()=>(t??=e(),t)}function Ud(e,{validate:t}={}){return{[Hd]:!0,_type:void 0,get jsonSchema(){return typeof e==`function`&&(e=e()),e},validate:t}}function Wd(e){return typeof e==`object`&&!!e&&Hd in e&&e[Hd]===!0&&`jsonSchema`in e&&`validate`in e}function Gd(e){return e==null?Ud({properties:{},additionalProperties:!1}):Wd(e)?e:`~standard`in e?e[`~standard`].vendor===`zod`?Q(e):Kd(e):e()}function Kd(e){return Ud(()=>e[`~standard`].jsonSchema.input({target:`draft-07`}),{validate:async t=>{let n=await e[`~standard`].validate(t);return`value`in n?{success:!0,value:n.value}:{success:!1,error:new Xe({value:t,cause:n.issues})}}})}function qd(e,t){let n=t?.useReferences??!1;return Ud(()=>Vd(e,{$refStrategy:n?`root`:`none`}),{validate:async t=>{let n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Jd(e,t){let n=t?.useReferences??!1;return Ud(()=>Vu(Oo(e,{target:`draft-7`,io:`input`,reused:n?`ref`:`inline`})),{validate:async t=>{let n=await Ho(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Yd(e){return`_zod`in e}function Q(e,t){return Yd(e)?Jd(e,t):qd(e,t)}async function Xd({value:e,schema:t}){let n=await Zd({value:e,schema:t});if(!n.success)throw Xe.wrap({value:e,cause:n.error});return n.value}async function Zd({value:e,schema:t}){let n=Gd(t);try{if(n.validate==null)return{success:!0,value:e,rawValue:e};let t=await n.validate(e);return t.success?{success:!0,value:t.value,rawValue:e}:{success:!1,error:Xe.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:Xe.wrap({value:e,cause:t}),rawValue:e}}}async function Qd({text:e,schema:t}){try{let n=Bu(e);return t==null?n:Xd({value:n,schema:t})}catch(t){throw me.isInstance(t)||Xe.isInstance(t)?t:new me({text:e,cause:t})}}async function $d({text:e,schema:t}){try{let n=Bu(e);return t==null?{success:!0,value:n,rawValue:n}:await Zd({value:n,schema:t})}catch(t){return{success:!1,error:me.isInstance(t)?t:new me({text:e,cause:t}),rawValue:void 0}}}function ef(e){try{return Bu(e),!0}catch{return!1}}function tf({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Jl).pipeThrough(new TransformStream({async transform({data:e},n){e!==`[DONE]`&&n.enqueue(await $d({text:e,schema:t}))}}))}async function nf({provider:e,providerOptions:t,schema:n}){if(t?.[e]==null)return;let r=await Zd({value:t[e],schema:n});if(!r.success)throw new w({argument:`providerOptions`,message:`invalid ${e} provider options`,cause:r.error});return r.value}var rf=()=>globalThis.fetch,af=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>sf({url:e,headers:{"Content-Type":`application/json`,...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),of=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>sf({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),sf=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:a,fetch:o=rf()})=>{try{let s=await o(e,{method:`POST`,headers:Su(t,`ai-sdk/provider-utils/${Cu}`,bu()),body:n.content,signal:a}),c=eu(s);if(!s.ok){let t;try{t=await i({response:s,url:e,requestBodyValues:n.values})}catch(t){throw _u(t)||d.isInstance(t)?t:new d({message:`Failed to process error response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}throw t.value}try{return await r({response:s,url:e,requestBodyValues:n.values})}catch(t){throw t instanceof Error&&(_u(t)||d.isInstance(t))?t:new d({message:`Failed to process successful response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}}catch(t){throw yu({error:t,url:e,requestBodyValues:n.values})}};function cf(e){return e}function lf(e){return{...e,type:`dynamic`}}function uf({id:e,inputSchema:t}){return({execute:n,outputSchema:r,needsApproval:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c,...l})=>cf({type:`provider`,id:e,args:l,inputSchema:t,outputSchema:r,execute:n,needsApproval:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c})}function df({id:e,inputSchema:t,outputSchema:n,supportsDeferredResults:r}){return({execute:i,needsApproval:a,toModelOutput:o,onInputStart:s,onInputDelta:c,onInputAvailable:l,...u})=>cf({type:`provider`,id:e,args:u,inputSchema:t,outputSchema:n,execute:i,needsApproval:a,toModelOutput:o,onInputStart:s,onInputDelta:c,onInputAvailable:l,supportsDeferredResults:r})}async function ff(e){return typeof e==`function`&&(e=e()),Promise.resolve(e)}var pf=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:i,requestBodyValues:a})=>{let o=await r.text(),s=eu(r);if(o.trim()===``)return{responseHeaders:s,value:new d({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})};try{let c=await Qd({text:o,schema:e});return{responseHeaders:s,value:new d({message:t(c),url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,data:c,isRetryable:n?.(r,c)})}}catch{return{responseHeaders:s,value:new d({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})}}},mf=e=>async({response:t})=>{let n=eu(t);if(t.body==null)throw new _({});return{responseHeaders:n,value:tf({stream:t.body,schema:e})}},hf=e=>async({response:t,url:n,requestBodyValues:r})=>{let i=await t.text(),a=await $d({text:i,schema:e}),o=eu(t);if(!a.success)throw new d({message:`Invalid JSON response`,cause:a.error,statusCode:t.status,responseHeaders:o,responseBody:i,url:n,requestBodyValues:r});return{responseHeaders:o,value:a.value,rawValue:a.rawValue}},gf=()=>async({response:e,url:t,requestBodyValues:n})=>{let r=eu(e);if(!e.body)throw new d({message:`Response body is empty`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{let t=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(t)}}catch(i){throw new d({message:`Failed to read response as array buffer`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:i})}};function _f(e){return e?.replace(/\/$/,``)}function vf(e){return e!=null&&typeof e[Symbol.asyncIterator]==`function`}async function*yf({execute:e,input:t,options:n}){let r=e(t,n);if(vf(r)){let e;for await(let t of r)e=t,yield{type:`preliminary`,output:t};yield{type:`final`,output:e}}else yield{type:`final`,output:await r}}var bf=`3.0.2`,xf=pf({errorSchema:Z(()=>Q(L({type:V(`error`),error:L({type:j(),message:j()})}))),errorToMessage:e=>e.error.message}),Sf=Z(()=>Q(L({type:V(`message`),id:j().nullish(),model:j().nullish(),content:I(z(`type`,[L({type:V(`text`),text:j(),citations:I(z(`type`,[L({type:V(`web_search_result_location`),cited_text:j(),url:j(),title:j(),encrypted_index:j()}),L({type:V(`page_location`),cited_text:j(),document_index:M(),document_title:j().nullable(),start_page_number:M(),end_page_number:M()}),L({type:V(`char_location`),cited_text:j(),document_index:M(),document_title:j().nullable(),start_char_index:M(),end_char_index:M()})])).optional()}),L({type:V(`thinking`),thinking:j(),signature:j()}),L({type:V(`redacted_thinking`),data:j()}),L({type:V(`tool_use`),id:j(),name:j(),input:P(),caller:R([L({type:V(`code_execution_20250825`),tool_id:j()}),L({type:V(`direct`)})]).optional()}),L({type:V(`server_tool_use`),id:j(),name:j(),input:Vs(j(),P()).nullish()}),L({type:V(`mcp_tool_use`),id:j(),name:j(),input:P(),server_name:j()}),L({type:V(`mcp_tool_result`),tool_use_id:j(),is_error:N(),content:I(R([j(),L({type:V(`text`),text:j()})]))}),L({type:V(`web_fetch_tool_result`),tool_use_id:j(),content:R([L({type:V(`web_fetch_result`),url:j(),retrieved_at:j(),content:L({type:V(`document`),title:j().nullable(),citations:L({enabled:N()}).optional(),source:R([L({type:V(`base64`),media_type:V(`application/pdf`),data:j()}),L({type:V(`text`),media_type:V(`text/plain`),data:j()})])})}),L({type:V(`web_fetch_tool_result_error`),error_code:j()})])}),L({type:V(`web_search_tool_result`),tool_use_id:j(),content:R([I(L({type:V(`web_search_result`),url:j(),title:j(),encrypted_content:j(),page_age:j().nullish()})),L({type:V(`web_search_tool_result_error`),error_code:j()})])}),L({type:V(`code_execution_tool_result`),tool_use_id:j(),content:R([L({type:V(`code_execution_result`),stdout:j(),stderr:j(),return_code:M(),content:I(L({type:V(`code_execution_output`),file_id:j()})).optional().default([])}),L({type:V(`code_execution_tool_result_error`),error_code:j()})])}),L({type:V(`bash_code_execution_tool_result`),tool_use_id:j(),content:z(`type`,[L({type:V(`bash_code_execution_result`),content:I(L({type:V(`bash_code_execution_output`),file_id:j()})),stdout:j(),stderr:j(),return_code:M()}),L({type:V(`bash_code_execution_tool_result_error`),error_code:j()})])}),L({type:V(`text_editor_code_execution_tool_result`),tool_use_id:j(),content:z(`type`,[L({type:V(`text_editor_code_execution_tool_result_error`),error_code:j()}),L({type:V(`text_editor_code_execution_view_result`),content:j(),file_type:j(),num_lines:M().nullable(),start_line:M().nullable(),total_lines:M().nullable()}),L({type:V(`text_editor_code_execution_create_result`),is_file_update:N()}),L({type:V(`text_editor_code_execution_str_replace_result`),lines:I(j()).nullable(),new_lines:M().nullable(),new_start:M().nullable(),old_lines:M().nullable(),old_start:M().nullable()})])}),L({type:V(`tool_search_tool_result`),tool_use_id:j(),content:R([L({type:V(`tool_search_tool_search_result`),tool_references:I(L({type:V(`tool_reference`),tool_name:j()}))}),L({type:V(`tool_search_tool_result_error`),error_code:j()})])})])),stop_reason:j().nullish(),stop_sequence:j().nullish(),usage:Ns({input_tokens:M(),output_tokens:M(),cache_creation_input_tokens:M().nullish(),cache_read_input_tokens:M().nullish()}),container:L({expires_at:j(),id:j(),skills:I(L({type:R([V(`anthropic`),V(`custom`)]),skill_id:j(),version:j()})).nullish()}).nullish(),context_management:L({applied_edits:I(R([L({type:V(`clear_tool_uses_20250919`),cleared_tool_uses:M(),cleared_input_tokens:M()}),L({type:V(`clear_thinking_20251015`),cleared_thinking_turns:M(),cleared_input_tokens:M()})]))}).nullish()}))),Cf=Z(()=>Q(z(`type`,[L({type:V(`message_start`),message:L({id:j().nullish(),model:j().nullish(),role:j().nullish(),usage:Ns({input_tokens:M(),cache_creation_input_tokens:M().nullish(),cache_read_input_tokens:M().nullish()}),content:I(z(`type`,[L({type:V(`tool_use`),id:j(),name:j(),input:P(),caller:R([L({type:V(`code_execution_20250825`),tool_id:j()}),L({type:V(`direct`)})]).optional()})])).nullish(),stop_reason:j().nullish(),container:L({expires_at:j(),id:j()}).nullish()})}),L({type:V(`content_block_start`),index:M(),content_block:z(`type`,[L({type:V(`text`),text:j()}),L({type:V(`thinking`),thinking:j()}),L({type:V(`tool_use`),id:j(),name:j(),input:Vs(j(),P()).optional(),caller:R([L({type:V(`code_execution_20250825`),tool_id:j()}),L({type:V(`direct`)})]).optional()}),L({type:V(`redacted_thinking`),data:j()}),L({type:V(`server_tool_use`),id:j(),name:j(),input:Vs(j(),P()).nullish()}),L({type:V(`mcp_tool_use`),id:j(),name:j(),input:P(),server_name:j()}),L({type:V(`mcp_tool_result`),tool_use_id:j(),is_error:N(),content:I(R([j(),L({type:V(`text`),text:j()})]))}),L({type:V(`web_fetch_tool_result`),tool_use_id:j(),content:R([L({type:V(`web_fetch_result`),url:j(),retrieved_at:j(),content:L({type:V(`document`),title:j().nullable(),citations:L({enabled:N()}).optional(),source:R([L({type:V(`base64`),media_type:V(`application/pdf`),data:j()}),L({type:V(`text`),media_type:V(`text/plain`),data:j()})])})}),L({type:V(`web_fetch_tool_result_error`),error_code:j()})])}),L({type:V(`web_search_tool_result`),tool_use_id:j(),content:R([I(L({type:V(`web_search_result`),url:j(),title:j(),encrypted_content:j(),page_age:j().nullish()})),L({type:V(`web_search_tool_result_error`),error_code:j()})])}),L({type:V(`code_execution_tool_result`),tool_use_id:j(),content:R([L({type:V(`code_execution_result`),stdout:j(),stderr:j(),return_code:M(),content:I(L({type:V(`code_execution_output`),file_id:j()})).optional().default([])}),L({type:V(`code_execution_tool_result_error`),error_code:j()})])}),L({type:V(`bash_code_execution_tool_result`),tool_use_id:j(),content:z(`type`,[L({type:V(`bash_code_execution_result`),content:I(L({type:V(`bash_code_execution_output`),file_id:j()})),stdout:j(),stderr:j(),return_code:M()}),L({type:V(`bash_code_execution_tool_result_error`),error_code:j()})])}),L({type:V(`text_editor_code_execution_tool_result`),tool_use_id:j(),content:z(`type`,[L({type:V(`text_editor_code_execution_tool_result_error`),error_code:j()}),L({type:V(`text_editor_code_execution_view_result`),content:j(),file_type:j(),num_lines:M().nullable(),start_line:M().nullable(),total_lines:M().nullable()}),L({type:V(`text_editor_code_execution_create_result`),is_file_update:N()}),L({type:V(`text_editor_code_execution_str_replace_result`),lines:I(j()).nullable(),new_lines:M().nullable(),new_start:M().nullable(),old_lines:M().nullable(),old_start:M().nullable()})])}),L({type:V(`tool_search_tool_result`),tool_use_id:j(),content:R([L({type:V(`tool_search_tool_search_result`),tool_references:I(L({type:V(`tool_reference`),tool_name:j()}))}),L({type:V(`tool_search_tool_result_error`),error_code:j()})])})])}),L({type:V(`content_block_delta`),index:M(),delta:z(`type`,[L({type:V(`input_json_delta`),partial_json:j()}),L({type:V(`text_delta`),text:j()}),L({type:V(`thinking_delta`),thinking:j()}),L({type:V(`signature_delta`),signature:j()}),L({type:V(`citations_delta`),citation:z(`type`,[L({type:V(`web_search_result_location`),cited_text:j(),url:j(),title:j(),encrypted_index:j()}),L({type:V(`page_location`),cited_text:j(),document_index:M(),document_title:j().nullable(),start_page_number:M(),end_page_number:M()}),L({type:V(`char_location`),cited_text:j(),document_index:M(),document_title:j().nullable(),start_char_index:M(),end_char_index:M()})])})])}),L({type:V(`content_block_stop`),index:M()}),L({type:V(`error`),error:L({type:j(),message:j()})}),L({type:V(`message_delta`),delta:L({stop_reason:j().nullish(),stop_sequence:j().nullish(),container:L({expires_at:j(),id:j(),skills:I(L({type:R([V(`anthropic`),V(`custom`)]),skill_id:j(),version:j()})).nullish()}).nullish(),context_management:L({applied_edits:I(R([L({type:V(`clear_tool_uses_20250919`),cleared_tool_uses:M(),cleared_input_tokens:M()}),L({type:V(`clear_thinking_20251015`),cleared_thinking_turns:M(),cleared_input_tokens:M()})]))}).nullish()}),usage:Ns({output_tokens:M(),cache_creation_input_tokens:M().nullish()})}),L({type:V(`message_stop`)}),L({type:V(`ping`)})]))),wf=Z(()=>Q(L({signature:j().optional(),redactedData:j().optional()}))),Tf=L({citations:L({enabled:N()}).optional(),title:j().optional(),context:j().optional()}),Ef=L({sendReasoning:N().optional(),structuredOutputMode:B([`outputFormat`,`jsonTool`,`auto`]).optional(),thinking:L({type:R([V(`enabled`),V(`disabled`)]),budgetTokens:M().optional()}).optional(),disableParallelToolUse:N().optional(),cacheControl:L({type:V(`ephemeral`),ttl:R([V(`5m`),V(`1h`)]).optional()}).optional(),mcpServers:I(L({type:V(`url`),name:j(),url:j(),authorizationToken:j().nullish(),toolConfiguration:L({enabled:N().nullish(),allowedTools:I(j()).nullish()}).nullish()})).optional(),container:L({id:j().optional(),skills:I(L({type:R([V(`anthropic`),V(`custom`)]),skillId:j(),version:j().optional()})).optional()}).optional(),toolStreaming:N().optional(),effort:B([`low`,`medium`,`high`]).optional(),contextManagement:L({edits:I(z(`type`,[L({type:V(`clear_tool_uses_20250919`),trigger:z(`type`,[L({type:V(`input_tokens`),value:M()}),L({type:V(`tool_uses`),value:M()})]).optional(),keep:L({type:V(`tool_uses`),value:M()}).optional(),clearAtLeast:L({type:V(`input_tokens`),value:M()}).optional(),clearToolInputs:N().optional(),excludeTools:I(j()).optional()}),L({type:V(`clear_thinking_20251015`),keep:R([V(`all`),L({type:V(`thinking_turns`),value:M()})]).optional()})]))}).optional()}),Df=4;function Of(e){let t=e?.anthropic;return t?.cacheControl??t?.cache_control}var kf=class{constructor(){this.breakpointCount=0,this.warnings=[]}getCacheControl(e,t){let n=Of(e);if(n){if(!t.canCache){this.warnings.push({type:`unsupported`,feature:`cache_control on non-cacheable context`,details:`cache_control cannot be set on ${t.type}. It will be ignored.`});return}if(this.breakpointCount++,this.breakpointCount>Df){this.warnings.push({type:`unsupported`,feature:`cacheControl breakpoint limit`,details:`Maximum ${Df} cache breakpoints exceeded (found ${this.breakpointCount}). This breakpoint will be ignored.`});return}return n}}getWarnings(){return this.warnings}},Af=Z(()=>Q(L({maxCharacters:M().optional()}))),jf=uf({id:`anthropic.text_editor_20250728`,inputSchema:Z(()=>Q(L({command:B([`view`,`create`,`str_replace`,`insert`]),path:j(),file_text:j().optional(),insert_line:M().int().optional(),new_str:j().optional(),old_str:j().optional(),view_range:I(M().int()).optional()})))}),Mf=(e={})=>jf(e),Nf=Z(()=>Q(L({maxUses:M().optional(),allowedDomains:I(j()).optional(),blockedDomains:I(j()).optional(),userLocation:L({type:V(`approximate`),city:j().optional(),region:j().optional(),country:j().optional(),timezone:j().optional()}).optional()}))),Pf=Z(()=>Q(I(L({url:j(),title:j().nullable(),pageAge:j().nullable(),encryptedContent:j(),type:V(`web_search_result`)})))),Ff=df({id:`anthropic.web_search_20250305`,inputSchema:Z(()=>Q(L({query:j()}))),outputSchema:Pf}),If=(e={})=>Ff(e),Lf=Z(()=>Q(L({maxUses:M().optional(),allowedDomains:I(j()).optional(),blockedDomains:I(j()).optional(),citations:L({enabled:N()}).optional(),maxContentTokens:M().optional()}))),Rf=Z(()=>Q(L({type:V(`web_fetch_result`),url:j(),content:L({type:V(`document`),title:j().nullable(),citations:L({enabled:N()}).optional(),source:R([L({type:V(`base64`),mediaType:V(`application/pdf`),data:j()}),L({type:V(`text`),mediaType:V(`text/plain`),data:j()})])}),retrievedAt:j().nullable()}))),zf=df({id:`anthropic.web_fetch_20250910`,inputSchema:Z(()=>Q(L({url:j()}))),outputSchema:Rf}),Bf=(e={})=>zf(e);async function Vf({tools:e,toolChoice:t,disableParallelToolUse:n,cacheControlValidator:r,supportsStructuredOutput:i}){e=e?.length?e:void 0;let a=[],o=new Set,s=r||new kf;if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:a,betas:o};let c=[];for(let t of e)switch(t.type){case`function`:{let e=s.getCacheControl(t.providerOptions,{type:`tool definition`,canCache:!0}),n=t.providerOptions?.anthropic,r=n?.deferLoading,a=n?.allowedCallers;c.push({name:t.name,description:t.description,input_schema:t.inputSchema,cache_control:e,...i===!0&&t.strict!=null?{strict:t.strict}:{},...r==null?{}:{defer_loading:r},...a==null?{}:{allowed_callers:a},...t.inputExamples==null?{}:{input_examples:t.inputExamples.map(e=>e.input)}}),i===!0&&o.add(`structured-outputs-2025-11-13`),(t.inputExamples!=null||a!=null)&&o.add(`advanced-tool-use-2025-11-20`);break}case`provider`:switch(t.id){case`anthropic.code_execution_20250522`:o.add(`code-execution-2025-05-22`),c.push({type:`code_execution_20250522`,name:`code_execution`,cache_control:void 0});break;case`anthropic.code_execution_20250825`:o.add(`code-execution-2025-08-25`),c.push({type:`code_execution_20250825`,name:`code_execution`});break;case`anthropic.computer_20250124`:o.add(`computer-use-2025-01-24`),c.push({name:`computer`,type:`computer_20250124`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber,cache_control:void 0});break;case`anthropic.computer_20241022`:o.add(`computer-use-2024-10-22`),c.push({name:`computer`,type:`computer_20241022`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber,cache_control:void 0});break;case`anthropic.text_editor_20250124`:o.add(`computer-use-2025-01-24`),c.push({name:`str_replace_editor`,type:`text_editor_20250124`,cache_control:void 0});break;case`anthropic.text_editor_20241022`:o.add(`computer-use-2024-10-22`),c.push({name:`str_replace_editor`,type:`text_editor_20241022`,cache_control:void 0});break;case`anthropic.text_editor_20250429`:o.add(`computer-use-2025-01-24`),c.push({name:`str_replace_based_edit_tool`,type:`text_editor_20250429`,cache_control:void 0});break;case`anthropic.text_editor_20250728`:{let e=await Xd({value:t.args,schema:Af});c.push({name:`str_replace_based_edit_tool`,type:`text_editor_20250728`,max_characters:e.maxCharacters,cache_control:void 0});break}case`anthropic.bash_20250124`:o.add(`computer-use-2025-01-24`),c.push({name:`bash`,type:`bash_20250124`,cache_control:void 0});break;case`anthropic.bash_20241022`:o.add(`computer-use-2024-10-22`),c.push({name:`bash`,type:`bash_20241022`,cache_control:void 0});break;case`anthropic.memory_20250818`:o.add(`context-management-2025-06-27`),c.push({name:`memory`,type:`memory_20250818`});break;case`anthropic.web_fetch_20250910`:{o.add(`web-fetch-2025-09-10`);let e=await Xd({value:t.args,schema:Lf});c.push({type:`web_fetch_20250910`,name:`web_fetch`,max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,citations:e.citations,max_content_tokens:e.maxContentTokens,cache_control:void 0});break}case`anthropic.web_search_20250305`:{let e=await Xd({value:t.args,schema:Nf});c.push({type:`web_search_20250305`,name:`web_search`,max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,user_location:e.userLocation,cache_control:void 0});break}case`anthropic.tool_search_regex_20251119`:o.add(`advanced-tool-use-2025-11-20`),c.push({type:`tool_search_tool_regex_20251119`,name:`tool_search_tool_regex`});break;case`anthropic.tool_search_bm25_20251119`:o.add(`advanced-tool-use-2025-11-20`),c.push({type:`tool_search_tool_bm25_20251119`,name:`tool_search_tool_bm25`});break;default:a.push({type:`unsupported`,feature:`provider-defined tool ${t.id}`});break}break;default:a.push({type:`unsupported`,feature:`tool ${t}`});break}if(t==null)return{tools:c,toolChoice:n?{type:`auto`,disable_parallel_tool_use:n}:void 0,toolWarnings:a,betas:o};let l=t.type;switch(l){case`auto`:return{tools:c,toolChoice:{type:`auto`,disable_parallel_tool_use:n},toolWarnings:a,betas:o};case`required`:return{tools:c,toolChoice:{type:`any`,disable_parallel_tool_use:n},toolWarnings:a,betas:o};case`none`:return{tools:void 0,toolChoice:void 0,toolWarnings:a,betas:o};case`tool`:return{tools:c,toolChoice:{type:`tool`,name:t.toolName,disable_parallel_tool_use:n},toolWarnings:a,betas:o};default:throw new nt({functionality:`tool choice type: ${l}`})}}function Hf(e){let t=e.input_tokens,n=e.output_tokens,r=e.cache_creation_input_tokens??0,i=e.cache_read_input_tokens??0;return{inputTokens:{total:t+r+i,noCache:t,cacheRead:i,cacheWrite:r},outputTokens:{total:n,text:void 0,reasoning:void 0},raw:e}}var Uf=Z(()=>Q(L({type:V(`code_execution_result`),stdout:j(),stderr:j(),return_code:M(),content:I(L({type:V(`code_execution_output`),file_id:j()})).optional().default([])}))),Wf=df({id:`anthropic.code_execution_20250522`,inputSchema:Z(()=>Q(L({code:j()}))),outputSchema:Uf}),Gf=(e={})=>Wf(e),Kf=Z(()=>Q(z(`type`,[L({type:V(`code_execution_result`),stdout:j(),stderr:j(),return_code:M(),content:I(L({type:V(`code_execution_output`),file_id:j()})).optional().default([])}),L({type:V(`bash_code_execution_result`),content:I(L({type:V(`bash_code_execution_output`),file_id:j()})),stdout:j(),stderr:j(),return_code:M()}),L({type:V(`bash_code_execution_tool_result_error`),error_code:j()}),L({type:V(`text_editor_code_execution_tool_result_error`),error_code:j()}),L({type:V(`text_editor_code_execution_view_result`),content:j(),file_type:j(),num_lines:M().nullable(),start_line:M().nullable(),total_lines:M().nullable()}),L({type:V(`text_editor_code_execution_create_result`),is_file_update:N()}),L({type:V(`text_editor_code_execution_str_replace_result`),lines:I(j()).nullable(),new_lines:M().nullable(),new_start:M().nullable(),old_lines:M().nullable(),old_start:M().nullable()})]))),qf=df({id:`anthropic.code_execution_20250825`,inputSchema:Z(()=>Q(z(`type`,[L({type:V(`programmatic-tool-call`),code:j()}),L({type:V(`bash_code_execution`),command:j()}),z(`command`,[L({type:V(`text_editor_code_execution`),command:V(`view`),path:j()}),L({type:V(`text_editor_code_execution`),command:V(`create`),path:j(),file_text:j().nullish()}),L({type:V(`text_editor_code_execution`),command:V(`str_replace`),path:j(),old_str:j(),new_str:j()})])]))),outputSchema:Kf,supportsDeferredResults:!0}),Jf=(e={})=>qf(e),Yf=Z(()=>Q(I(L({type:V(`tool_reference`),toolName:j()})))),Xf=df({id:`anthropic.tool_search_regex_20251119`,inputSchema:Z(()=>Q(L({pattern:j(),limit:M().optional()}))),outputSchema:Yf}),Zf=(e={})=>Xf(e);function Qf(e){if(typeof e==`string`)return Buffer.from(e,`base64`).toString(`utf-8`);if(e instanceof Uint8Array)return new TextDecoder().decode(e);throw e instanceof URL?new nt({functionality:`URL-based text documents are not supported for citations`}):new nt({functionality:`unsupported data type for text documents: ${typeof e}`})}async function $f({prompt:e,sendReasoning:t,warnings:n,cacheControlValidator:r,toolNameMapping:i}){let a=new Set,o=ep(e),s=r||new kf,c,l=[];async function u(e){return(await nf({provider:`anthropic`,providerOptions:e,schema:Tf}))?.citations?.enabled??!1}async function d(e){let t=await nf({provider:`anthropic`,providerOptions:e,schema:Tf});return{title:t?.title,context:t?.context}}for(let e=0;e<o.length;e++){let r=o[e],f=e===o.length-1,p=r.type;switch(p){case`system`:if(c!=null)throw new nt({functionality:`Multiple system messages that are separated by user/assistant messages`});c=r.messages.map(({content:e,providerOptions:t})=>({type:`text`,text:e,cache_control:s.getCacheControl(t,{type:`system message`,canCache:!0})}));break;case`user`:{let e=[];for(let t of r.messages){let{role:r,content:i}=t;switch(r){case`user`:for(let n=0;n<i.length;n++){let r=i[n],o=n===i.length-1,c=s.getCacheControl(r.providerOptions,{type:`user message part`,canCache:!0})??(o?s.getCacheControl(t.providerOptions,{type:`user message`,canCache:!0}):void 0);switch(r.type){case`text`:e.push({type:`text`,text:r.text,cache_control:c});break;case`file`:if(r.mediaType.startsWith(`image/`))e.push({type:`image`,source:r.data instanceof URL?{type:`url`,url:r.data.toString()}:{type:`base64`,media_type:r.mediaType===`image/*`?`image/jpeg`:r.mediaType,data:au(r.data)},cache_control:c});else if(r.mediaType===`application/pdf`){a.add(`pdfs-2024-09-25`);let t=await u(r.providerOptions),n=await d(r.providerOptions);e.push({type:`document`,source:r.data instanceof URL?{type:`url`,url:r.data.toString()}:{type:`base64`,media_type:`application/pdf`,data:au(r.data)},title:n.title??r.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:c})}else if(r.mediaType===`text/plain`){let t=await u(r.providerOptions),n=await d(r.providerOptions);e.push({type:`document`,source:r.data instanceof URL?{type:`url`,url:r.data.toString()}:{type:`text`,media_type:`text/plain`,data:Qf(r.data)},title:n.title??r.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:c})}else throw new nt({functionality:`media type: ${r.mediaType}`});break}}break;case`tool`:for(let r=0;r<i.length;r++){let o=i[r];if(o.type===`tool-approval-response`)continue;let c=r===i.length-1,l=s.getCacheControl(o.providerOptions,{type:`tool result part`,canCache:!0})??(c?s.getCacheControl(t.providerOptions,{type:`tool result message`,canCache:!0}):void 0),u=o.output,d;switch(u.type){case`content`:d=u.value.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`image-data`:return{type:`image`,source:{type:`base64`,media_type:e.mediaType,data:e.data}};case`image-url`:return{type:`image`,source:{type:`url`,url:e.url}};case`file-url`:return{type:`document`,source:{type:`url`,url:e.url}};case`file-data`:if(e.mediaType===`application/pdf`)return a.add(`pdfs-2024-09-25`),{type:`document`,source:{type:`base64`,media_type:e.mediaType,data:e.data}};n.push({type:`other`,message:`unsupported tool content part type: ${e.type} with media type: ${e.mediaType}`});return;default:n.push({type:`other`,message:`unsupported tool content part type: ${e.type}`});return}}).filter(ju);break;case`text`:case`error-text`:d=u.value;break;case`execution-denied`:d=u.reason??`Tool execution denied.`;break;case`json`:case`error-json`:default:d=JSON.stringify(u.value);break}e.push({type:`tool_result`,tool_use_id:o.toolCallId,content:d,is_error:u.type===`error-text`||u.type===`error-json`?!0:void 0,cache_control:l})}break;default:{let e=r;throw Error(`Unsupported role: ${e}`)}}}l.push({role:`user`,content:e});break}case`assistant`:{let e=[],a=new Set;for(let o=0;o<r.messages.length;o++){let c=r.messages[o],l=o===r.messages.length-1,{content:u}=c;for(let r=0;r<u.length;r++){let o=u[r],d=r===u.length-1,p=s.getCacheControl(o.providerOptions,{type:`assistant message part`,canCache:!0})??(d?s.getCacheControl(c.providerOptions,{type:`assistant message`,canCache:!0}):void 0);switch(o.type){case`text`:e.push({type:`text`,text:f&&l&&d?o.text.trim():o.text,cache_control:p});break;case`reasoning`:if(t){let t=await nf({provider:`anthropic`,providerOptions:o.providerOptions,schema:wf});t==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):t.signature==null?t.redactedData==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):(s.getCacheControl(o.providerOptions,{type:`redacted thinking block`,canCache:!1}),e.push({type:`redacted_thinking`,data:t.redactedData})):(s.getCacheControl(o.providerOptions,{type:`thinking block`,canCache:!1}),e.push({type:`thinking`,thinking:o.text,signature:t.signature}))}else n.push({type:`other`,message:`sending reasoning content is disabled for this model`});break;case`tool-call`:{if(o.providerExecuted){let t=i.toProviderToolName(o.toolName);if(o.providerOptions?.anthropic?.type===`mcp-tool-use`){a.add(o.toolCallId);let t=o.providerOptions?.anthropic?.serverName;if(t==null||typeof t!=`string`){n.push({type:`other`,message:`mcp tool use server name is required and must be a string`});break}e.push({type:`mcp_tool_use`,id:o.toolCallId,name:o.toolName,input:o.input,server_name:t,cache_control:p})}else if(t===`code_execution`&&o.input!=null&&typeof o.input==`object`&&`type`in o.input&&typeof o.input.type==`string`&&(o.input.type===`bash_code_execution`||o.input.type===`text_editor_code_execution`))e.push({type:`server_tool_use`,id:o.toolCallId,name:o.input.type,input:o.input,cache_control:p});else if(t===`code_execution`&&o.input!=null&&typeof o.input==`object`&&`type`in o.input&&o.input.type===`programmatic-tool-call`){let{type:t,...n}=o.input;e.push({type:`server_tool_use`,id:o.toolCallId,name:`code_execution`,input:n,cache_control:p})}else t===`code_execution`||t===`web_fetch`||t===`web_search`||t===`tool_search_tool_regex`||t===`tool_search_tool_bm25`?e.push({type:`server_tool_use`,id:o.toolCallId,name:t,input:o.input,cache_control:p}):n.push({type:`other`,message:`provider executed tool call for tool ${o.toolName} is not supported`});break}let t=o.providerOptions?.anthropic,r=t?.caller?t.caller.type===`code_execution_20250825`&&t.caller.toolId?{type:`code_execution_20250825`,tool_id:t.caller.toolId}:t.caller.type===`direct`?{type:`direct`}:void 0:void 0;e.push({type:`tool_use`,id:o.toolCallId,name:o.toolName,input:o.input,...r&&{caller:r},cache_control:p});break}case`tool-result`:{let t=i.toProviderToolName(o.toolName);if(a.has(o.toolCallId)){let t=o.output;if(t.type!==`json`&&t.type!==`error-json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}e.push({type:`mcp_tool_result`,tool_use_id:o.toolCallId,is_error:t.type===`error-json`,content:t.value,cache_control:p})}else if(t===`code_execution`){let t=o.output;if(t.type===`error-text`||t.type===`error-json`){let n={};try{typeof t.value==`string`?n=JSON.parse(t.value):typeof t.value==`object`&&t.value!==null&&(n=t.value)}catch{}n.type===`code_execution_tool_result_error`?e.push({type:`code_execution_tool_result`,tool_use_id:o.toolCallId,content:{type:`code_execution_tool_result_error`,error_code:n.errorCode??`unknown`},cache_control:p}):e.push({type:`bash_code_execution_tool_result`,tool_use_id:o.toolCallId,cache_control:p,content:{type:`bash_code_execution_tool_result_error`,error_code:n.errorCode??`unknown`}});break}if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}if(t.value==null||typeof t.value!=`object`||!(`type`in t.value)||typeof t.value.type!=`string`){n.push({type:`other`,message:`provider executed tool result output value is not a valid code execution result for tool ${o.toolName}`});break}if(t.value.type===`code_execution_result`){let n=await Xd({value:t.value,schema:Uf});e.push({type:`code_execution_tool_result`,tool_use_id:o.toolCallId,content:{type:n.type,stdout:n.stdout,stderr:n.stderr,return_code:n.return_code,content:n.content??[]},cache_control:p})}else{let n=await Xd({value:t.value,schema:Kf});n.type===`code_execution_result`?e.push({type:`code_execution_tool_result`,tool_use_id:o.toolCallId,content:{type:n.type,stdout:n.stdout,stderr:n.stderr,return_code:n.return_code,content:n.content??[]},cache_control:p}):n.type===`bash_code_execution_result`||n.type===`bash_code_execution_tool_result_error`?e.push({type:`bash_code_execution_tool_result`,tool_use_id:o.toolCallId,cache_control:p,content:n}):e.push({type:`text_editor_code_execution_tool_result`,tool_use_id:o.toolCallId,cache_control:p,content:n})}break}if(t===`web_fetch`){let t=o.output;if(t.type===`error-json`){let n=JSON.parse(t.value);e.push({type:`web_fetch_tool_result`,tool_use_id:o.toolCallId,content:{type:`web_fetch_tool_result_error`,error_code:n.errorCode},cache_control:p});break}if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}let r=await Xd({value:t.value,schema:Rf});e.push({type:`web_fetch_tool_result`,tool_use_id:o.toolCallId,content:{type:`web_fetch_result`,url:r.url,retrieved_at:r.retrievedAt,content:{type:`document`,title:r.content.title,citations:r.content.citations,source:{type:r.content.source.type,media_type:r.content.source.mediaType,data:r.content.source.data}}},cache_control:p});break}if(t===`web_search`){let t=o.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}let r=await Xd({value:t.value,schema:Pf});e.push({type:`web_search_tool_result`,tool_use_id:o.toolCallId,content:r.map(e=>({url:e.url,title:e.title,page_age:e.pageAge,encrypted_content:e.encryptedContent,type:e.type})),cache_control:p});break}if(t===`tool_search_tool_regex`||t===`tool_search_tool_bm25`){let t=o.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${o.toolName} is not supported`});break}let r=(await Xd({value:t.value,schema:Yf})).map(e=>({type:`tool_reference`,tool_name:e.toolName}));e.push({type:`tool_search_tool_result`,tool_use_id:o.toolCallId,content:{type:`tool_search_tool_search_result`,tool_references:r},cache_control:p});break}n.push({type:`other`,message:`provider executed tool result for tool ${o.toolName} is not supported`});break}}}}l.push({role:`assistant`,content:e});break}default:{let e=p;throw Error(`content type: ${e}`)}}}return{prompt:{system:c,messages:l},betas:a}}function ep(e){let t=[],n;for(let r of e){let{role:e}=r;switch(e){case`system`:n?.type!==`system`&&(n={type:`system`,messages:[]},t.push(n)),n.messages.push(r);break;case`assistant`:n?.type!==`assistant`&&(n={type:`assistant`,messages:[]},t.push(n)),n.messages.push(r);break;case`user`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;case`tool`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;default:{let t=e;throw Error(`Unsupported role: ${t}`)}}}return t}function tp({finishReason:e,isJsonResponseFromTool:t}){switch(e){case`pause_turn`:case`end_turn`:case`stop_sequence`:return`stop`;case`refusal`:return`content-filter`;case`tool_use`:return t?`stop`:`tool-calls`;case`max_tokens`:case`model_context_window_exceeded`:return`length`;default:return`other`}}function np(e,t,n){if(e.type!==`page_location`&&e.type!==`char_location`)return;let r=t[e.document_index];if(r)return{type:`source`,sourceType:`document`,id:n(),mediaType:r.mediaType,title:e.document_title??r.title,filename:r.filename,providerMetadata:{anthropic:e.type===`page_location`?{citedText:e.cited_text,startPageNumber:e.start_page_number,endPageNumber:e.end_page_number}:{citedText:e.cited_text,startCharIndex:e.start_char_index,endCharIndex:e.end_char_index}}}}var rp=class{constructor(e,t){this.specificationVersion=`v3`,this.modelId=e,this.config=t,this.generateId=t.generateId??hu}supportsUrl(e){return e.protocol===`https:`}get provider(){return this.config.provider}get supportedUrls(){var e;return(e=this.config).supportedUrls?.call(e)??{}}async getArgs({userSuppliedBetas:e,prompt:t,maxOutputTokens:n,temperature:r,topP:i,topK:a,frequencyPenalty:o,presencePenalty:s,stopSequences:c,responseFormat:l,seed:u,tools:d,toolChoice:f,providerOptions:p,stream:m}){let h=[];o!=null&&h.push({type:`unsupported`,feature:`frequencyPenalty`}),s!=null&&h.push({type:`unsupported`,feature:`presencePenalty`}),u!=null&&h.push({type:`unsupported`,feature:`seed`}),r!=null&&r>1?(h.push({type:`unsupported`,feature:`temperature`,details:`${r} exceeds anthropic maximum of 1.0. clamped to 1.0`}),r=1):r!=null&&r<0&&(h.push({type:`unsupported`,feature:`temperature`,details:`${r} is below anthropic minimum of 0. clamped to 0`}),r=0),l?.type===`json`&&(l.schema??h.push({type:`unsupported`,feature:`responseFormat`,details:`JSON response format requires a schema. The response format is ignored.`}));let g=await nf({provider:`anthropic`,providerOptions:p,schema:Ef}),{maxOutputTokens:_,supportsStructuredOutput:v,isKnownModel:y}=ip(this.modelId),b=(this.config.supportsNativeStructuredOutput??!0)&&v,x=g?.structuredOutputMode??`auto`,S=x===`outputFormat`||x===`auto`&&b,C=l?.type===`json`&&l.schema!=null&&!S?{type:`function`,name:`json`,description:`Respond with a JSON object.`,inputSchema:l.schema}:void 0,w=g?.contextManagement,T=new kf,ee=Xl({tools:d,providerToolNames:{"anthropic.code_execution_20250522":`code_execution`,"anthropic.code_execution_20250825":`code_execution`,"anthropic.computer_20241022":`computer`,"anthropic.computer_20250124":`computer`,"anthropic.text_editor_20241022":`str_replace_editor`,"anthropic.text_editor_20250124":`str_replace_editor`,"anthropic.text_editor_20250429":`str_replace_based_edit_tool`,"anthropic.text_editor_20250728":`str_replace_based_edit_tool`,"anthropic.bash_20241022":`bash`,"anthropic.bash_20250124":`bash`,"anthropic.memory_20250818":`memory`,"anthropic.web_search_20250305":`web_search`,"anthropic.web_fetch_20250910":`web_fetch`,"anthropic.tool_search_regex_20251119":`tool_search_tool_regex`,"anthropic.tool_search_bm25_20251119":`tool_search_tool_bm25`}}),{prompt:te,betas:ne}=await $f({prompt:t,sendReasoning:g?.sendReasoning??!0,warnings:h,cacheControlValidator:T,toolNameMapping:ee}),re=g?.thinking?.type===`enabled`,E=g?.thinking?.budgetTokens,ie=n??_,ae={model:this.modelId,max_tokens:ie,temperature:r,top_k:a,top_p:i,stop_sequences:c,...re&&{thinking:{type:`enabled`,budget_tokens:E}},...g?.effort&&{output_config:{effort:g.effort}},...S&&l?.type===`json`&&l.schema!=null&&{output_format:{type:`json_schema`,schema:l.schema}},...g?.mcpServers&&g.mcpServers.length>0&&{mcp_servers:g.mcpServers.map(e=>({type:e.type,name:e.name,url:e.url,authorization_token:e.authorizationToken,tool_configuration:e.toolConfiguration?{allowed_tools:e.toolConfiguration.allowedTools,enabled:e.toolConfiguration.enabled}:void 0}))},...g?.container&&{container:g.container.skills&&g.container.skills.length>0?{id:g.container.id,skills:g.container.skills.map(e=>({type:e.type,skill_id:e.skillId,version:e.version}))}:g.container.id},system:te.system,messages:te.messages,...w&&{context_management:{edits:w.edits.map(e=>{let t=e.type;switch(t){case`clear_tool_uses_20250919`:return{type:e.type,...e.trigger!==void 0&&{trigger:e.trigger},...e.keep!==void 0&&{keep:e.keep},...e.clearAtLeast!==void 0&&{clear_at_least:e.clearAtLeast},...e.clearToolInputs!==void 0&&{clear_tool_inputs:e.clearToolInputs},...e.excludeTools!==void 0&&{exclude_tools:e.excludeTools}};case`clear_thinking_20251015`:return{type:e.type,...e.keep!==void 0&&{keep:e.keep}};default:h.push({type:`other`,message:`Unknown context management strategy: ${t}`});return}}).filter(e=>e!==void 0)}}};re&&(E??=(h.push({type:`compatibility`,feature:`extended thinking`,details:`thinking budget is required when thinking is enabled. using default budget of 1024 tokens.`}),ae.thinking={type:`enabled`,budget_tokens:1024},1024),ae.temperature!=null&&(ae.temperature=void 0,h.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported when thinking is enabled`})),a!=null&&(ae.top_k=void 0,h.push({type:`unsupported`,feature:`topK`,details:`topK is not supported when thinking is enabled`})),i!=null&&(ae.top_p=void 0,h.push({type:`unsupported`,feature:`topP`,details:`topP is not supported when thinking is enabled`})),ae.max_tokens=ie+(E??0)),y&&ae.max_tokens>_&&(n!=null&&h.push({type:`unsupported`,feature:`maxOutputTokens`,details:`${ae.max_tokens} (maxOutputTokens + thinkingBudget) is greater than ${this.modelId} ${_} max output tokens. The max output tokens have been limited to ${_}.`}),ae.max_tokens=_),g?.mcpServers&&g.mcpServers.length>0&&ne.add(`mcp-client-2025-04-04`),w&&ne.add(`context-management-2025-06-27`),g?.container&&g.container.skills&&g.container.skills.length>0&&(ne.add(`code-execution-2025-08-25`),ne.add(`skills-2025-10-02`),ne.add(`files-api-2025-04-14`),d?.some(e=>e.type===`provider`&&e.id===`anthropic.code_execution_20250825`)||h.push({type:`other`,message:`code execution tool is required when using skills`})),g?.effort&&ne.add(`effort-2025-11-24`),m&&(g?.toolStreaming??!0)&&ne.add(`fine-grained-tool-streaming-2025-05-14`),S&&l?.type===`json`&&l.schema!=null&&ne.add(`structured-outputs-2025-11-13`);let{tools:oe,toolChoice:se,toolWarnings:ce,betas:le}=await Vf(C==null?{tools:d??[],toolChoice:f,disableParallelToolUse:g?.disableParallelToolUse,cacheControlValidator:T,supportsStructuredOutput:b}:{tools:[...d??[],C],toolChoice:{type:`required`},disableParallelToolUse:!0,cacheControlValidator:T,supportsStructuredOutput:b}),D=T.getWarnings();return{args:{...ae,tools:oe,tool_choice:se,stream:m===!0?!0:void 0},warnings:[...h,...ce,...D],betas:new Set([...ne,...le,...e]),usesJsonResponseTool:C!=null,toolNameMapping:ee}}async getHeaders({betas:e,headers:t}){return Yl(await ff(this.config.headers),t,e.size>0?{"anthropic-beta":Array.from(e).join(`,`)}:{})}async getBetasFromHeaders(e){let t=(await ff(this.config.headers))[`anthropic-beta`]??``,n=e?.[`anthropic-beta`]??``;return new Set([...t.toLowerCase().split(`,`),...n.toLowerCase().split(`,`)].map(e=>e.trim()).filter(e=>e!==``))}buildRequestUrl(e){var t;return(t=this.config).buildRequestUrl?.call(t,this.config.baseURL,e)??`${this.config.baseURL}/messages`}transformRequestBody(e){var t;return(t=this.config).transformRequestBody?.call(t,e)??e}extractCitationDocuments(e){return e.filter(e=>e.role===`user`).flatMap(e=>e.content).filter(e=>e.type!==`file`||e.mediaType!==`application/pdf`&&e.mediaType!==`text/plain`?!1:e.providerOptions?.anthropic?.citations?.enabled??!1).map(e=>{let t=e;return{title:t.filename??`Untitled Document`,filename:t.filename,mediaType:t.mediaType}})}async doGenerate(e){let{args:t,warnings:n,betas:r,usesJsonResponseTool:i,toolNameMapping:a}=await this.getArgs({...e,stream:!1,userSuppliedBetas:await this.getBetasFromHeaders(e.headers)}),o=this.extractCitationDocuments(e.prompt),{responseHeaders:s,value:c,rawValue:l}=await af({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(t),failedResponseHandler:xf,successfulResponseHandler:hf(Sf),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=[],d={},f=!1;for(let e of c.content)switch(e.type){case`text`:if(!i&&(u.push({type:`text`,text:e.text}),e.citations))for(let t of e.citations){let e=np(t,o,this.generateId);e&&u.push(e)}break;case`thinking`:u.push({type:`reasoning`,text:e.thinking,providerMetadata:{anthropic:{signature:e.signature}}});break;case`redacted_thinking`:u.push({type:`reasoning`,text:``,providerMetadata:{anthropic:{redactedData:e.data}}});break;case`tool_use`:if(i&&e.name===`json`)f=!0,u.push({type:`text`,text:JSON.stringify(e.input)});else{let t=e.caller,n=t?{type:t.type,toolId:`tool_id`in t?t.tool_id:void 0}:void 0;u.push({type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),...n&&{providerMetadata:{anthropic:{caller:n}}}})}break;case`server_tool_use`:if(e.name===`text_editor_code_execution`||e.name===`bash_code_execution`)u.push({type:`tool-call`,toolCallId:e.id,toolName:a.toCustomToolName(`code_execution`),input:JSON.stringify({type:e.name,...e.input}),providerExecuted:!0});else if(e.name===`web_search`||e.name===`code_execution`||e.name===`web_fetch`){let t=e.name===`code_execution`&&e.input!=null&&typeof e.input==`object`&&`code`in e.input&&!(`type`in e.input)?{type:`programmatic-tool-call`,...e.input}:e.input;u.push({type:`tool-call`,toolCallId:e.id,toolName:a.toCustomToolName(e.name),input:JSON.stringify(t),providerExecuted:!0})}else (e.name===`tool_search_tool_regex`||e.name===`tool_search_tool_bm25`)&&u.push({type:`tool-call`,toolCallId:e.id,toolName:a.toCustomToolName(e.name),input:JSON.stringify(e.input),providerExecuted:!0});break;case`mcp_tool_use`:d[e.id]={type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),providerExecuted:!0,dynamic:!0,providerMetadata:{anthropic:{type:`mcp-tool-use`,serverName:e.server_name}}},u.push(d[e.id]);break;case`mcp_tool_result`:u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:d[e.tool_use_id].toolName,isError:e.is_error,result:e.content,dynamic:!0,providerMetadata:d[e.tool_use_id].providerMetadata});break;case`web_fetch_tool_result`:e.content.type===`web_fetch_result`?u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),result:{type:`web_fetch_result`,url:e.content.url,retrievedAt:e.content.retrieved_at,content:{type:e.content.content.type,title:e.content.content.title,citations:e.content.content.citations,source:{type:e.content.content.source.type,mediaType:e.content.content.source.media_type,data:e.content.content.source.data}}}}):e.content.type===`web_fetch_tool_result_error`&&u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),isError:!0,result:{type:`web_fetch_tool_result_error`,errorCode:e.content.error_code}});break;case`web_search_tool_result`:if(Array.isArray(e.content)){u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),result:e.content.map(e=>({url:e.url,title:e.title,pageAge:e.page_age??null,encryptedContent:e.encrypted_content,type:e.type}))});for(let t of e.content)u.push({type:`source`,sourceType:`url`,id:this.generateId(),url:t.url,title:t.title,providerMetadata:{anthropic:{pageAge:t.page_age??null}}})}else u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code}});break;case`code_execution_tool_result`:e.content.type===`code_execution_result`?u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code,content:e.content.content??[]}}):e.content.type===`code_execution_tool_result_error`&&u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code}});break;case`bash_code_execution_tool_result`:case`text_editor_code_execution_tool_result`:u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:e.content});break;case`tool_search_tool_result`:e.content.type===`tool_search_tool_search_result`?u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`tool_search`),result:e.content.tool_references.map(e=>({type:e.type,toolName:e.tool_name}))}):u.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`tool_search`),isError:!0,result:{type:`tool_search_tool_result_error`,errorCode:e.content.error_code}});break}return{content:u,finishReason:{unified:tp({finishReason:c.stop_reason,isJsonResponseFromTool:f}),raw:c.stop_reason??void 0},usage:Hf(c.usage),request:{body:t},response:{id:c.id??void 0,modelId:c.model??void 0,headers:s,body:l},warnings:n,providerMetadata:{anthropic:{usage:c.usage,cacheCreationInputTokens:c.usage.cache_creation_input_tokens??null,stopSequence:c.stop_sequence??null,container:c.container?{expiresAt:c.container.expires_at,id:c.container.id,skills:c.container.skills?.map(e=>({type:e.type,skillId:e.skill_id,version:e.version}))??null}:null,contextManagement:ap(c.context_management)??null}}}}async doStream(e){let{args:t,warnings:n,betas:r,usesJsonResponseTool:i,toolNameMapping:a}=await this.getArgs({...e,stream:!0,userSuppliedBetas:await this.getBetasFromHeaders(e.headers)}),o=this.extractCitationDocuments(e.prompt),s=this.buildRequestUrl(!0),{responseHeaders:c,value:l}=await af({url:s,headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(t),failedResponseHandler:xf,successfulResponseHandler:mf(Cf),abortSignal:e.abortSignal,fetch:this.config.fetch}),u={unified:`other`,raw:void 0},f={input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0},p={},m={},h=null,g,_=null,v=null,y=null,b=!1,x,S=this.generateId,[C,w]=l.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let r=t.value;switch(r.type){case`ping`:return;case`content_block_start`:{let e=r.content_block,t=e.type;switch(x=t,t){case`text`:if(i)return;p[r.index]={type:`text`},n.enqueue({type:`text-start`,id:String(r.index)});return;case`thinking`:p[r.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(r.index)});return;case`redacted_thinking`:p[r.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(r.index),providerMetadata:{anthropic:{redactedData:e.data}}});return;case`tool_use`:if(i&&e.name===`json`)b=!0,p[r.index]={type:`text`},n.enqueue({type:`text-start`,id:String(r.index)});else{let t=e.caller,i=t?{type:t.type,toolId:`tool_id`in t?t.tool_id:void 0}:void 0,a=e.input&&Object.keys(e.input).length>0?JSON.stringify(e.input):``;p[r.index]={type:`tool-call`,toolCallId:e.id,toolName:e.name,input:a,firstDelta:a.length===0,...i&&{caller:i}},n.enqueue({type:`tool-input-start`,id:e.id,toolName:e.name})}return;case`server_tool_use`:if([`web_fetch`,`web_search`,`code_execution`,`text_editor_code_execution`,`bash_code_execution`].includes(e.name)){let t=e.name===`text_editor_code_execution`||e.name===`bash_code_execution`?`code_execution`:e.name,i=a.toCustomToolName(t);p[r.index]={type:`tool-call`,toolCallId:e.id,toolName:i,input:``,providerExecuted:!0,firstDelta:!0,providerToolName:e.name},n.enqueue({type:`tool-input-start`,id:e.id,toolName:i,providerExecuted:!0})}else if(e.name===`tool_search_tool_regex`||e.name===`tool_search_tool_bm25`){let t=a.toCustomToolName(e.name);p[r.index]={type:`tool-call`,toolCallId:e.id,toolName:t,input:``,providerExecuted:!0,firstDelta:!0,providerToolName:e.name},n.enqueue({type:`tool-input-start`,id:e.id,toolName:t,providerExecuted:!0})}return;case`web_fetch_tool_result`:e.content.type===`web_fetch_result`?n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),result:{type:`web_fetch_result`,url:e.content.url,retrievedAt:e.content.retrieved_at,content:{type:e.content.content.type,title:e.content.content.title,citations:e.content.content.citations,source:{type:e.content.content.source.type,mediaType:e.content.content.source.media_type,data:e.content.content.source.data}}}}):e.content.type===`web_fetch_tool_result_error`&&n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_fetch`),isError:!0,result:{type:`web_fetch_tool_result_error`,errorCode:e.content.error_code}});return;case`web_search_tool_result`:if(Array.isArray(e.content)){n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),result:e.content.map(e=>({url:e.url,title:e.title,pageAge:e.page_age??null,encryptedContent:e.encrypted_content,type:e.type}))});for(let t of e.content)n.enqueue({type:`source`,sourceType:`url`,id:S(),url:t.url,title:t.title,providerMetadata:{anthropic:{pageAge:t.page_age??null}}})}else n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`web_search`),isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code}});return;case`code_execution_tool_result`:e.content.type===`code_execution_result`?n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code,content:e.content.content??[]}}):e.content.type===`code_execution_tool_result_error`&&n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code}});return;case`bash_code_execution_tool_result`:case`text_editor_code_execution_tool_result`:n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`code_execution`),result:e.content});return;case`tool_search_tool_result`:e.content.type===`tool_search_tool_search_result`?n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`tool_search`),result:e.content.tool_references.map(e=>({type:e.type,toolName:e.tool_name}))}):n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:a.toCustomToolName(`tool_search`),isError:!0,result:{type:`tool_search_tool_result_error`,errorCode:e.content.error_code}});return;case`mcp_tool_use`:m[e.id]={type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),providerExecuted:!0,dynamic:!0,providerMetadata:{anthropic:{type:`mcp-tool-use`,serverName:e.server_name}}},n.enqueue(m[e.id]);return;case`mcp_tool_result`:n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:m[e.tool_use_id].toolName,isError:e.is_error,result:e.content,dynamic:!0,providerMetadata:m[e.tool_use_id].providerMetadata});return;default:{let e=t;throw Error(`Unsupported content block type: ${e}`)}}}case`content_block_stop`:if(p[r.index]!=null){let e=p[r.index];switch(e.type){case`text`:n.enqueue({type:`text-end`,id:String(r.index)});break;case`reasoning`:n.enqueue({type:`reasoning-end`,id:String(r.index)});break;case`tool-call`:if(!(i&&e.toolName===`json`)){n.enqueue({type:`tool-input-end`,id:e.toolCallId});let t=e.input===``?`{}`:e.input;if(e.providerToolName===`code_execution`)try{let e=JSON.parse(t);typeof e==`object`&&e&&`code`in e&&!(`type`in e)&&(t=JSON.stringify({type:`programmatic-tool-call`,...e}))}catch{}n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:t,providerExecuted:e.providerExecuted,...e.caller&&{providerMetadata:{anthropic:{caller:e.caller}}}})}break}delete p[r.index]}x=void 0;return;case`content_block_delta`:{let e=r.delta.type;switch(e){case`text_delta`:if(i)return;n.enqueue({type:`text-delta`,id:String(r.index),delta:r.delta.text});return;case`thinking_delta`:n.enqueue({type:`reasoning-delta`,id:String(r.index),delta:r.delta.thinking});return;case`signature_delta`:x===`thinking`&&n.enqueue({type:`reasoning-delta`,id:String(r.index),delta:``,providerMetadata:{anthropic:{signature:r.delta.signature}}});return;case`input_json_delta`:{let e=p[r.index],t=r.delta.partial_json;if(t.length===0)return;if(b){if(e?.type!==`text`)return;n.enqueue({type:`text-delta`,id:String(r.index),delta:t})}else{if(e?.type!==`tool-call`)return;e.firstDelta&&(e.providerToolName===`bash_code_execution`||e.providerToolName===`text_editor_code_execution`)&&(t=`{"type": "${e.providerToolName}",${t.substring(1)}`),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:t}),e.input+=t,e.firstDelta=!1}return}case`citations_delta`:{let e=r.delta.citation,t=np(e,o,S);t&&n.enqueue(t);return}default:{let t=e;throw Error(`Unsupported delta type: ${t}`)}}}case`message_start`:if(f.input_tokens=r.message.usage.input_tokens,f.cache_read_input_tokens=r.message.usage.cache_read_input_tokens??0,f.cache_creation_input_tokens=r.message.usage.cache_creation_input_tokens??0,g={...r.message.usage},_=r.message.usage.cache_creation_input_tokens??null,r.message.container!=null&&(y={expiresAt:r.message.container.expires_at,id:r.message.container.id,skills:null}),r.message.stop_reason!=null&&(u={unified:tp({finishReason:r.message.stop_reason,isJsonResponseFromTool:b}),raw:r.message.stop_reason}),n.enqueue({type:`response-metadata`,id:r.message.id??void 0,modelId:r.message.model??void 0}),r.message.content!=null)for(let e=0;e<r.message.content.length;e++){let t=r.message.content[e];if(t.type===`tool_use`){let e=t.caller,r=e?{type:e.type,toolId:`tool_id`in e?e.tool_id:void 0}:void 0;n.enqueue({type:`tool-input-start`,id:t.id,toolName:t.name});let i=JSON.stringify(t.input??{});n.enqueue({type:`tool-input-delta`,id:t.id,delta:i}),n.enqueue({type:`tool-input-end`,id:t.id}),n.enqueue({type:`tool-call`,toolCallId:t.id,toolName:t.name,input:i,...r&&{providerMetadata:{anthropic:{caller:r}}}})}}return;case`message_delta`:f.output_tokens=r.usage.output_tokens,u={unified:tp({finishReason:r.delta.stop_reason,isJsonResponseFromTool:b}),raw:r.delta.stop_reason??void 0},v=r.delta.stop_sequence??null,y=r.delta.container==null?null:{expiresAt:r.delta.container.expires_at,id:r.delta.container.id,skills:r.delta.container.skills?.map(e=>({type:e.type,skillId:e.skill_id,version:e.version}))??null},r.delta.context_management&&(h=ap(r.delta.context_management)),g={...g,...r.usage};return;case`message_stop`:n.enqueue({type:`finish`,finishReason:u,usage:Hf(f),providerMetadata:{anthropic:{usage:g??null,cacheCreationInputTokens:_,stopSequence:v,container:y,contextManagement:h}}});return;case`error`:n.enqueue({type:`error`,error:r.error});return;default:{let e=r;throw Error(`Unsupported chunk type: ${e}`)}}}})).tee(),T=C.getReader();try{await T.read();let e=await T.read();if(e.value?.type===`raw`&&(e=await T.read()),e.value?.type===`error`){let n=e.value.error;throw new d({message:n.message,url:s,requestBodyValues:t,statusCode:n.type===`overloaded_error`?529:500,responseHeaders:c,responseBody:JSON.stringify(n),isRetryable:n.type===`overloaded_error`})}}finally{T.cancel().catch(()=>{}),T.releaseLock()}return{stream:w,request:{body:t},response:{headers:c}}}};function ip(e){return e.includes(`claude-sonnet-4-5`)||e.includes(`claude-opus-4-5`)?{maxOutputTokens:64e3,supportsStructuredOutput:!0,isKnownModel:!0}:e.includes(`claude-opus-4-1`)?{maxOutputTokens:32e3,supportsStructuredOutput:!0,isKnownModel:!0}:e.includes(`claude-sonnet-4-`)||e.includes(`claude-3-7-sonnet`)||e.includes(`claude-haiku-4-5`)?{maxOutputTokens:64e3,supportsStructuredOutput:!1,isKnownModel:!0}:e.includes(`claude-opus-4-`)?{maxOutputTokens:32e3,supportsStructuredOutput:!1,isKnownModel:!0}:e.includes(`claude-3-5-haiku`)?{maxOutputTokens:8192,supportsStructuredOutput:!1,isKnownModel:!0}:e.includes(`claude-3-haiku`)?{maxOutputTokens:4096,supportsStructuredOutput:!1,isKnownModel:!0}:{maxOutputTokens:4096,supportsStructuredOutput:!1,isKnownModel:!1}}function ap(e){return e?{appliedEdits:e.applied_edits.map(e=>{switch(e.type){case`clear_tool_uses_20250919`:return{type:e.type,clearedToolUses:e.cleared_tool_uses,clearedInputTokens:e.cleared_input_tokens};case`clear_thinking_20251015`:return{type:e.type,clearedThinkingTurns:e.cleared_thinking_turns,clearedInputTokens:e.cleared_input_tokens}}}).filter(e=>e!==void 0)}:null}var op=uf({id:`anthropic.bash_20241022`,inputSchema:Z(()=>Q(L({command:j(),restart:N().optional()})))}),sp=uf({id:`anthropic.bash_20250124`,inputSchema:Z(()=>Q(L({command:j(),restart:N().optional()})))}),cp=uf({id:`anthropic.computer_20241022`,inputSchema:Z(()=>Q(L({action:B([`key`,`type`,`mouse_move`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`screenshot`,`cursor_position`]),coordinate:I(M().int()).optional(),text:j().optional()})))}),lp=uf({id:`anthropic.computer_20250124`,inputSchema:Z(()=>Q(L({action:B([`key`,`hold_key`,`type`,`cursor_position`,`mouse_move`,`left_mouse_down`,`left_mouse_up`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`triple_click`,`scroll`,`wait`,`screenshot`]),coordinate:zs([M().int(),M().int()]).optional(),duration:M().optional(),scroll_amount:M().optional(),scroll_direction:B([`up`,`down`,`left`,`right`]).optional(),start_coordinate:zs([M().int(),M().int()]).optional(),text:j().optional()})))}),up=uf({id:`anthropic.memory_20250818`,inputSchema:Z(()=>Q(z(`command`,[L({command:V(`view`),path:j(),view_range:zs([M(),M()]).optional()}),L({command:V(`create`),path:j(),file_text:j()}),L({command:V(`str_replace`),path:j(),old_str:j(),new_str:j()}),L({command:V(`insert`),path:j(),insert_line:M(),insert_text:j()}),L({command:V(`delete`),path:j()}),L({command:V(`rename`),old_path:j(),new_path:j()})])))}),dp=uf({id:`anthropic.text_editor_20241022`,inputSchema:Z(()=>Q(L({command:B([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:j(),file_text:j().optional(),insert_line:M().int().optional(),new_str:j().optional(),old_str:j().optional(),view_range:I(M().int()).optional()})))}),fp=uf({id:`anthropic.text_editor_20250124`,inputSchema:Z(()=>Q(L({command:B([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:j(),file_text:j().optional(),insert_line:M().int().optional(),new_str:j().optional(),old_str:j().optional(),view_range:I(M().int()).optional()})))}),pp=uf({id:`anthropic.text_editor_20250429`,inputSchema:Z(()=>Q(L({command:B([`view`,`create`,`str_replace`,`insert`]),path:j(),file_text:j().optional(),insert_line:M().int().optional(),new_str:j().optional(),old_str:j().optional(),view_range:I(M().int()).optional()})))}),mp=Z(()=>Q(I(L({type:V(`tool_reference`),toolName:j()})))),hp=df({id:`anthropic.tool_search_bm25_20251119`,inputSchema:Z(()=>Q(L({query:j(),limit:M().optional()}))),outputSchema:mp}),gp={bash_20241022:op,bash_20250124:sp,codeExecution_20250522:Gf,codeExecution_20250825:Jf,computer_20241022:cp,computer_20250124:lp,memory_20250818:up,textEditor_20241022:dp,textEditor_20250124:fp,textEditor_20250429:pp,textEditor_20250728:Mf,webFetch_20250910:Bf,webSearch_20250305:If,toolSearchRegex_20251119:Zf,toolSearchBm25_20251119:(e={})=>hp(e)};function _p(e={}){let t=_f(Pu({settingValue:e.baseURL,environmentVariableName:`ANTHROPIC_BASE_URL`}))??`https://api.anthropic.com/v1`,n=e.name??`anthropic.messages`,r=()=>Su({"anthropic-version":`2023-06-01`,"x-api-key":Nu({apiKey:e.apiKey,environmentVariableName:`ANTHROPIC_API_KEY`,description:`Anthropic`}),...e.headers},`ai-sdk/anthropic/${bf}`),i=i=>new rp(i,{provider:n,baseURL:t,headers:r,fetch:e.fetch,generateId:e.generateId??hu,supportedUrls:()=>({"image/*":[/^https?:\/\/.*$/]})}),a=function(e){if(new.target)throw Error(`The Anthropic model function cannot be called with the new keyword.`);return i(e)};return a.specificationVersion=`v3`,a.languageModel=i,a.chat=i,a.messages=i,a.embeddingModel=e=>{throw new Re({modelId:e,modelType:`embeddingModel`})},a.textEmbeddingModel=a.embeddingModel,a.imageModel=e=>{throw new Re({modelId:e,modelType:`imageModel`})},a.tools=gp,a}_p();var vp=`3.0.2`,yp=pf({errorSchema:Z(()=>Q(L({error:L({code:M().nullable(),message:j(),status:j()})}))),errorToMessage:e=>e.error.message}),bp=Z(()=>Q(L({outputDimensionality:M().optional(),taskType:B([`SEMANTIC_SIMILARITY`,`CLASSIFICATION`,`CLUSTERING`,`RETRIEVAL_DOCUMENT`,`RETRIEVAL_QUERY`,`QUESTION_ANSWERING`,`FACT_VERIFICATION`,`CODE_RETRIEVAL_QUERY`]).optional()}))),xp=class{constructor(e,t){this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){let i=await nf({provider:`google`,providerOptions:r,schema:bp});if(e.length>this.maxEmbeddingsPerCall)throw new We({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=Yl(await ff(this.config.headers),t);if(e.length===1){let{responseHeaders:t,value:r,rawValue:o}=await af({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:a,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType},failedResponseHandler:yp,successfulResponseHandler:hf(Cp),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:[r.embedding.values],usage:void 0,response:{headers:t,body:o}}}let{responseHeaders:o,value:s,rawValue:c}=await af({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:a,body:{requests:e.map(e=>({model:`models/${this.modelId}`,content:{role:`user`,parts:[{text:e}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType}))},failedResponseHandler:yp,successfulResponseHandler:hf(Sp),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:s.embeddings.map(e=>e.values),usage:void 0,response:{headers:o,body:c}}}},Sp=Z(()=>Q(L({embeddings:I(L({values:I(M())}))}))),Cp=Z(()=>Q(L({embedding:L({values:I(M())})})));function wp(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.promptTokenCount??0,n=e.candidatesTokenCount??0,r=e.cachedContentTokenCount??0,i=e.thoughtsTokenCount??0;return{inputTokens:{total:t,noCache:t-r,cacheRead:r,cacheWrite:void 0},outputTokens:{total:n+i,text:n,reasoning:i},raw:e}}function Tp(e,t=!0){if(e==null)return;if(Ep(e))return t?void 0:typeof e==`object`&&e.description?{type:`object`,description:e.description}:{type:`object`};if(typeof e==`boolean`)return{type:`boolean`,properties:{}};let{type:n,description:r,required:i,properties:a,items:o,allOf:s,anyOf:c,oneOf:l,format:u,const:d,minLength:f,enum:p}=e,m={};if(r&&(m.description=r),i&&(m.required=i),u&&(m.format=u),d!==void 0&&(m.enum=[d]),n)if(Array.isArray(n)){let e=n.includes(`null`),t=n.filter(e=>e!==`null`);t.length===0?m.type=`null`:(m.anyOf=t.map(e=>({type:e})),e&&(m.nullable=!0))}else m.type=n;if(p!==void 0&&(m.enum=p),a!=null&&(m.properties=Object.entries(a).reduce((e,[t,n])=>(e[t]=Tp(n,!1),e),{})),o&&(m.items=Array.isArray(o)?o.map(e=>Tp(e,!1)):Tp(o,!1)),s&&(m.allOf=s.map(e=>Tp(e,!1))),c)if(c.some(e=>typeof e==`object`&&e?.type===`null`)){let e=c.filter(e=>!(typeof e==`object`&&e?.type===`null`));if(e.length===1){let t=Tp(e[0],!1);typeof t==`object`&&(m.nullable=!0,Object.assign(m,t))}else m.anyOf=e.map(e=>Tp(e,!1)),m.nullable=!0}else m.anyOf=c.map(e=>Tp(e,!1));return l&&(m.oneOf=l.map(e=>Tp(e,!1))),f!==void 0&&(m.minLength=f),m}function Ep(e){return typeof e==`object`&&!!e&&e.type===`object`&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function Dp(e,t){let n=[],r=[],i=!0,a=t?.isGemmaModel??!1,o=t?.providerOptionsName??`google`;for(let{role:t,content:a}of e)switch(t){case`system`:if(!i)throw new nt({functionality:`system messages are only supported at the beginning of the conversation`});n.push({text:a});break;case`user`:{i=!1;let e=[];for(let t of a)switch(t.type){case`text`:e.push({text:t.text});break;case`file`:{let n=t.mediaType===`image/*`?`image/jpeg`:t.mediaType;e.push(t.data instanceof URL?{fileData:{mimeType:n,fileUri:t.data.toString()}}:{inlineData:{mimeType:n,data:au(t.data)}});break}}r.push({role:`user`,parts:e});break}case`assistant`:i=!1,r.push({role:`model`,parts:a.map(e=>{let t=e.providerOptions?.[o],n=t?.thoughtSignature==null?void 0:String(t.thoughtSignature);switch(e.type){case`text`:return e.text.length===0?void 0:{text:e.text,thoughtSignature:n};case`reasoning`:return e.text.length===0?void 0:{text:e.text,thought:!0,thoughtSignature:n};case`file`:if(e.data instanceof URL)throw new nt({functionality:`File data URLs in assistant messages are not supported`});return{inlineData:{mimeType:e.mediaType,data:au(e.data)},thoughtSignature:n};case`tool-call`:return{functionCall:{name:e.toolName,args:e.input},thoughtSignature:n}}}).filter(e=>e!==void 0)});break;case`tool`:{i=!1;let e=[];for(let t of a){if(t.type===`tool-approval-response`)continue;let n=t.output;if(n.type===`content`)for(let r of n.value)switch(r.type){case`text`:e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:r.text}}});break;case`image-data`:e.push({inlineData:{mimeType:r.mediaType,data:r.data}},{text:`Tool executed successfully and returned this image as a response`});break;default:e.push({text:JSON.stringify(r)});break}else e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:n.type===`execution-denied`?n.reason??`Tool execution denied.`:n.value}}})}r.push({role:`user`,parts:e});break}}if(a&&n.length>0&&r.length>0&&r[0].role===`user`){let e=n.map(e=>e.text).join(`

`);r[0].parts.unshift({text:e+`

`})}return{systemInstruction:n.length>0&&!a?{parts:n}:void 0,contents:r}}function Op(e){return e.includes(`/`)?e:`models/${e}`}var kp=Z(()=>Q(L({responseModalities:I(B([`TEXT`,`IMAGE`])).optional(),thinkingConfig:L({thinkingBudget:M().optional(),includeThoughts:N().optional(),thinkingLevel:B([`minimal`,`low`,`medium`,`high`]).optional()}).optional(),cachedContent:j().optional(),structuredOutputs:N().optional(),safetySettings:I(L({category:B([`HARM_CATEGORY_UNSPECIFIED`,`HARM_CATEGORY_HATE_SPEECH`,`HARM_CATEGORY_DANGEROUS_CONTENT`,`HARM_CATEGORY_HARASSMENT`,`HARM_CATEGORY_SEXUALLY_EXPLICIT`,`HARM_CATEGORY_CIVIC_INTEGRITY`]),threshold:B([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`])})).optional(),threshold:B([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`]).optional(),audioTimestamp:N().optional(),labels:Vs(j(),j()).optional(),mediaResolution:B([`MEDIA_RESOLUTION_UNSPECIFIED`,`MEDIA_RESOLUTION_LOW`,`MEDIA_RESOLUTION_MEDIUM`,`MEDIA_RESOLUTION_HIGH`]).optional(),imageConfig:L({aspectRatio:B([`1:1`,`2:3`,`3:2`,`3:4`,`4:3`,`4:5`,`5:4`,`9:16`,`16:9`,`21:9`]).optional(),imageSize:B([`1K`,`2K`,`4K`]).optional()}).optional(),retrievalConfig:L({latLng:L({latitude:M(),longitude:M()}).optional()}).optional()})));function Ap({tools:e,toolChoice:t,modelId:n}){e=e?.length?e:void 0;let r=[],i=[`gemini-flash-latest`,`gemini-flash-lite-latest`,`gemini-pro-latest`].some(e=>e===n),a=n.includes(`gemini-2`)||n.includes(`gemini-3`)||i,o=n.includes(`gemini-1.5-flash`)&&!n.includes(`-8b`),s=n.includes(`gemini-2.5`);if(e==null)return{tools:void 0,toolConfig:void 0,toolWarnings:r};let c=e.some(e=>e.type===`function`),l=e.some(e=>e.type===`provider`);if(c&&l&&r.push({type:`unsupported`,feature:`combination of function and provider-defined tools`}),l){let t=[];return e.filter(e=>e.type===`provider`).forEach(e=>{switch(e.id){case`google.google_search`:a?t.push({googleSearch:{}}):o?t.push({googleSearchRetrieval:{dynamicRetrievalConfig:{mode:e.args.mode,dynamicThreshold:e.args.dynamicThreshold}}}):t.push({googleSearchRetrieval:{}});break;case`google.enterprise_web_search`:a?t.push({enterpriseWebSearch:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`Enterprise Web Search requires Gemini 2.0 or newer.`});break;case`google.url_context`:a?t.push({urlContext:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The URL context tool is not supported with other Gemini models than Gemini 2.`});break;case`google.code_execution`:a?t.push({codeExecution:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The code execution tools is not supported with other Gemini models than Gemini 2.`});break;case`google.file_search`:s?t.push({fileSearch:{...e.args}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The file search tool is only supported with Gemini 2.5 models.`});break;case`google.vertex_rag_store`:a?t.push({retrieval:{vertex_rag_store:{rag_resources:{rag_corpus:e.args.ragCorpus},similarity_top_k:e.args.topK}}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The RAG store tool is not supported with other Gemini models than Gemini 2.`});break;case`google.google_maps`:a?t.push({googleMaps:{}}):r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`,details:`The Google Maps grounding tool is not supported with Gemini models other than Gemini 2 or newer.`});break;default:r.push({type:`unsupported`,feature:`provider-defined tool ${e.id}`});break}}),{tools:t.length>0?t:void 0,toolConfig:void 0,toolWarnings:r}}let u=[];for(let t of e)switch(t.type){case`function`:u.push({name:t.name,description:t.description??``,parameters:Tp(t.inputSchema)});break;default:r.push({type:`unsupported`,feature:`function tool ${t.name}`});break}if(t==null)return{tools:[{functionDeclarations:u}],toolConfig:void 0,toolWarnings:r};let d=t.type;switch(d){case`auto`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`AUTO`}},toolWarnings:r};case`none`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`NONE`}},toolWarnings:r};case`required`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`ANY`}},toolWarnings:r};case`tool`:return{tools:[{functionDeclarations:u}],toolConfig:{functionCallingConfig:{mode:`ANY`,allowedFunctionNames:[t.toolName]}},toolWarnings:r};default:throw new nt({functionality:`tool choice type: ${d}`})}}function jp({finishReason:e,hasToolCalls:t}){switch(e){case`STOP`:return t?`tool-calls`:`stop`;case`MAX_TOKENS`:return`length`;case`IMAGE_SAFETY`:case`RECITATION`:case`SAFETY`:case`BLOCKLIST`:case`PROHIBITED_CONTENT`:case`SPII`:return`content-filter`;case`MALFORMED_FUNCTION_CALL`:return`error`;case`FINISH_REASON_UNSPECIFIED`:case`OTHER`:default:return`other`}}var Mp=class{constructor(e,t){this.specificationVersion=`v3`,this.modelId=e,this.config=t,this.generateId=t.generateId??hu}get provider(){return this.config.provider}get supportedUrls(){var e;return(e=this.config).supportedUrls?.call(e)??{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){let p=[],m=this.config.provider.includes(`vertex`)?`vertex`:`google`,h=await nf({provider:m,providerOptions:f,schema:kp});h==null&&m!==`google`&&(h=await nf({provider:`google`,providerOptions:f,schema:kp})),u?.some(e=>e.type===`provider`&&e.id===`google.vertex_rag_store`)&&!this.config.provider.startsWith(`google.vertex.`)&&p.push({type:`other`,message:`The 'vertex_rag_store' tool is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let g=this.modelId.toLowerCase().startsWith(`gemma-`),{contents:_,systemInstruction:v}=Dp(e,{isGemmaModel:g,providerOptionsName:m}),{tools:y,toolConfig:b,toolWarnings:x}=Ap({tools:u,toolChoice:d,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:t,temperature:n,topK:i,topP:r,frequencyPenalty:a,presencePenalty:o,stopSequences:s,seed:l,responseMimeType:c?.type===`json`?`application/json`:void 0,responseSchema:c?.type===`json`&&c.schema!=null&&(h?.structuredOutputs??!0)?Tp(c.schema):void 0,...h?.audioTimestamp&&{audioTimestamp:h.audioTimestamp},responseModalities:h?.responseModalities,thinkingConfig:h?.thinkingConfig,...h?.mediaResolution&&{mediaResolution:h.mediaResolution},...h?.imageConfig&&{imageConfig:h.imageConfig}},contents:_,systemInstruction:g?void 0:v,safetySettings:h?.safetySettings,tools:y,toolConfig:h?.retrievalConfig?{...b,retrievalConfig:h.retrievalConfig}:b,cachedContent:h?.cachedContent,labels:h?.labels},warnings:[...p,...x],providerOptionsName:m}}async doGenerate(e){let{args:t,warnings:n,providerOptionsName:r}=await this.getArgs(e),i=Yl(await ff(this.config.headers),e.headers),{responseHeaders:a,value:o,rawValue:s}=await af({url:`${this.config.baseURL}/${Op(this.modelId)}:generateContent`,headers:i,body:t,failedResponseHandler:yp,successfulResponseHandler:hf(Bp),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=o.candidates[0],l=[],u=c.content?.parts??[],d=o.usageMetadata,f;for(let e of u)if(`executableCode`in e&&e.executableCode?.code){let t=this.config.generateId();f=t,l.push({type:`tool-call`,toolCallId:t,toolName:`code_execution`,input:JSON.stringify(e.executableCode),providerExecuted:!0})}else `codeExecutionResult`in e&&e.codeExecutionResult?(l.push({type:`tool-result`,toolCallId:f,toolName:`code_execution`,result:{outcome:e.codeExecutionResult.outcome,output:e.codeExecutionResult.output}}),f=void 0):`text`in e&&e.text!=null&&e.text.length>0?l.push({type:e.thought===!0?`reasoning`:`text`,text:e.text,providerMetadata:e.thoughtSignature?{[r]:{thoughtSignature:e.thoughtSignature}}:void 0}):`functionCall`in e?l.push({type:`tool-call`,toolCallId:this.config.generateId(),toolName:e.functionCall.name,input:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{[r]:{thoughtSignature:e.thoughtSignature}}:void 0}):`inlineData`in e&&l.push({type:`file`,data:e.inlineData.data,mediaType:e.inlineData.mimeType,providerMetadata:e.thoughtSignature?{[r]:{thoughtSignature:e.thoughtSignature}}:void 0});let p=Pp({groundingMetadata:c.groundingMetadata,generateId:this.config.generateId})??[];for(let e of p)l.push(e);return{content:l,finishReason:{unified:jp({finishReason:c.finishReason,hasToolCalls:l.some(e=>e.type===`tool-call`)}),raw:c.finishReason??void 0},usage:wp(d),warnings:n,providerMetadata:{[r]:{promptFeedback:o.promptFeedback??null,groundingMetadata:c.groundingMetadata??null,urlContextMetadata:c.urlContextMetadata??null,safetyRatings:c.safetyRatings??null,usageMetadata:d??null}},request:{body:t},response:{headers:a,body:s}}}async doStream(e){let{args:t,warnings:n,providerOptionsName:r}=await this.getArgs(e),i=Yl(await ff(this.config.headers),e.headers),{responseHeaders:a,value:o}=await af({url:`${this.config.baseURL}/${Op(this.modelId)}:streamGenerateContent?alt=sse`,headers:i,body:t,failedResponseHandler:yp,successfulResponseHandler:mf(Vp),abortSignal:e.abortSignal,fetch:this.config.fetch}),s={unified:`other`,raw:void 0},c,l,u=this.config.generateId,d=!1,f=null,p=null,m=0,h=new Set,g;return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let i=t.value,a=i.usageMetadata;a!=null&&(c=a);let o=i.candidates?.[0];if(o==null)return;let _=o.content,v=Pp({groundingMetadata:o.groundingMetadata,generateId:u});if(v!=null)for(let e of v)e.sourceType===`url`&&!h.has(e.url)&&(h.add(e.url),n.enqueue(e));if(_!=null){let e=_.parts??[];for(let t of e)if(`executableCode`in t&&t.executableCode?.code){let e=u();g=e,n.enqueue({type:`tool-call`,toolCallId:e,toolName:`code_execution`,input:JSON.stringify(t.executableCode),providerExecuted:!0}),d=!0}else if(`codeExecutionResult`in t&&t.codeExecutionResult){let e=g;e&&(n.enqueue({type:`tool-result`,toolCallId:e,toolName:`code_execution`,result:{outcome:t.codeExecutionResult.outcome,output:t.codeExecutionResult.output}}),g=void 0)}else `text`in t&&t.text!=null&&t.text.length>0?t.thought===!0?(f!==null&&(n.enqueue({type:`text-end`,id:f}),f=null),p===null&&(p=String(m++),n.enqueue({type:`reasoning-start`,id:p,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`reasoning-delta`,id:p,delta:t.text,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})):(p!==null&&(n.enqueue({type:`reasoning-end`,id:p}),p=null),f===null&&(f=String(m++),n.enqueue({type:`text-start`,id:f,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`text-delta`,id:f,delta:t.text,providerMetadata:t.thoughtSignature?{[r]:{thoughtSignature:t.thoughtSignature}}:void 0})):`inlineData`in t&&n.enqueue({type:`file`,mediaType:t.inlineData.mimeType,data:t.inlineData.data});let t=Np({parts:_.parts,generateId:u,providerOptionsName:r});if(t!=null)for(let e of t)n.enqueue({type:`tool-input-start`,id:e.toolCallId,toolName:e.toolName,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:e.args,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-end`,id:e.toolCallId,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.args,providerMetadata:e.providerMetadata}),d=!0}o.finishReason!=null&&(s={unified:jp({finishReason:o.finishReason,hasToolCalls:d}),raw:o.finishReason},l={[r]:{promptFeedback:i.promptFeedback??null,groundingMetadata:o.groundingMetadata??null,urlContextMetadata:o.urlContextMetadata??null,safetyRatings:o.safetyRatings??null}},a!=null&&(l[r].usageMetadata=a))},flush(e){f!==null&&e.enqueue({type:`text-end`,id:f}),p!==null&&e.enqueue({type:`reasoning-end`,id:p}),e.enqueue({type:`finish`,finishReason:s,usage:wp(c),providerMetadata:l})}})),response:{headers:a},request:{body:t}}}};function Np({parts:e,generateId:t,providerOptionsName:n}){let r=e?.filter(e=>`functionCall`in e);return r==null||r.length===0?void 0:r.map(e=>({type:`tool-call`,toolCallId:t(),toolName:e.functionCall.name,args:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{[n]:{thoughtSignature:e.thoughtSignature}}:void 0}))}function Pp({groundingMetadata:e,generateId:t}){if(!e?.groundingChunks)return;let n=[];for(let r of e.groundingChunks)if(r.web!=null)n.push({type:`source`,sourceType:`url`,id:t(),url:r.web.uri,title:r.web.title??void 0});else if(r.retrievedContext!=null){let e=r.retrievedContext.uri,i=r.retrievedContext.fileSearchStore;if(e&&(e.startsWith(`http://`)||e.startsWith(`https://`)))n.push({type:`source`,sourceType:`url`,id:t(),url:e,title:r.retrievedContext.title??void 0});else if(e){let i=r.retrievedContext.title??`Unknown Document`,a=`application/octet-stream`,o;e.endsWith(`.pdf`)?(a=`application/pdf`,o=e.split(`/`).pop()):e.endsWith(`.txt`)?(a=`text/plain`,o=e.split(`/`).pop()):e.endsWith(`.docx`)?(a=`application/vnd.openxmlformats-officedocument.wordprocessingml.document`,o=e.split(`/`).pop()):e.endsWith(`.doc`)?(a=`application/msword`,o=e.split(`/`).pop()):(e.match(/\.(md|markdown)$/)&&(a=`text/markdown`),o=e.split(`/`).pop()),n.push({type:`source`,sourceType:`document`,id:t(),mediaType:a,title:i,filename:o})}else if(i){let e=r.retrievedContext.title??`Unknown Document`;n.push({type:`source`,sourceType:`document`,id:t(),mediaType:`application/octet-stream`,title:e,filename:i.split(`/`).pop()})}}else r.maps!=null&&r.maps.uri&&n.push({type:`source`,sourceType:`url`,id:t(),url:r.maps.uri,title:r.maps.title??void 0});return n.length>0?n:void 0}var Fp=()=>L({webSearchQueries:I(j()).nullish(),retrievalQueries:I(j()).nullish(),searchEntryPoint:L({renderedContent:j()}).nullish(),groundingChunks:I(L({web:L({uri:j(),title:j().nullish()}).nullish(),retrievedContext:L({uri:j().nullish(),title:j().nullish(),text:j().nullish(),fileSearchStore:j().nullish()}).nullish(),maps:L({uri:j().nullish(),title:j().nullish(),text:j().nullish(),placeId:j().nullish()}).nullish()})).nullish(),groundingSupports:I(L({segment:L({startIndex:M().nullish(),endIndex:M().nullish(),text:j().nullish()}),segment_text:j().nullish(),groundingChunkIndices:I(M()).nullish(),supportChunkIndices:I(M()).nullish(),confidenceScores:I(M()).nullish(),confidenceScore:I(M()).nullish()})).nullish(),retrievalMetadata:R([L({webDynamicRetrievalScore:M()}),L({})]).nullish()}),Ip=()=>L({parts:I(R([L({functionCall:L({name:j(),args:P()}),thoughtSignature:j().nullish()}),L({inlineData:L({mimeType:j(),data:j()}),thoughtSignature:j().nullish()}),L({executableCode:L({language:j(),code:j()}).nullish(),codeExecutionResult:L({outcome:j(),output:j()}).nullish(),text:j().nullish(),thought:N().nullish(),thoughtSignature:j().nullish()})])).nullish()}),Lp=()=>L({category:j().nullish(),probability:j().nullish(),probabilityScore:M().nullish(),severity:j().nullish(),severityScore:M().nullish(),blocked:N().nullish()}),Rp=L({cachedContentTokenCount:M().nullish(),thoughtsTokenCount:M().nullish(),promptTokenCount:M().nullish(),candidatesTokenCount:M().nullish(),totalTokenCount:M().nullish(),trafficType:j().nullish()}),zp=()=>L({urlMetadata:I(L({retrievedUrl:j(),urlRetrievalStatus:j()}))}),Bp=Z(()=>Q(L({candidates:I(L({content:Ip().nullish().or(L({}).strict()),finishReason:j().nullish(),safetyRatings:I(Lp()).nullish(),groundingMetadata:Fp().nullish(),urlContextMetadata:zp().nullish()})),usageMetadata:Rp.nullish(),promptFeedback:L({blockReason:j().nullish(),safetyRatings:I(Lp()).nullish()}).nullish()}))),Vp=Z(()=>Q(L({candidates:I(L({content:Ip().nullish(),finishReason:j().nullish(),safetyRatings:I(Lp()).nullish(),groundingMetadata:Fp().nullish(),urlContextMetadata:zp().nullish()})).nullish(),usageMetadata:Rp.nullish(),promptFeedback:L({blockReason:j().nullish(),safetyRatings:I(Lp()).nullish()}).nullish()}))),Hp=df({id:`google.code_execution`,inputSchema:L({language:j().describe(`The programming language of the code.`),code:j().describe(`The code to be executed.`)}),outputSchema:L({outcome:j().describe(`The outcome of the execution (e.g., "OUTCOME_OK").`),output:j().describe(`The output from the code execution.`)})}),Up=uf({id:`google.enterprise_web_search`,inputSchema:Z(()=>Q(L({})))}),Wp=L({fileSearchStoreNames:I(j()).describe("The names of the file_search_stores to retrieve from. Example: `fileSearchStores/my-file-search-store-123`"),topK:M().int().positive().describe(`The number of file search retrieval chunks to retrieve.`).optional(),metadataFilter:j().describe(`Metadata filter to apply to the file search retrieval documents. See https://google.aip.dev/160 for the syntax of the filter expression.`).optional()}).passthrough(),Gp=uf({id:`google.file_search`,inputSchema:Z(()=>Q(Wp))}),Kp=uf({id:`google.google_maps`,inputSchema:Z(()=>Q(L({})))}),qp={googleSearch:uf({id:`google.google_search`,inputSchema:Z(()=>Q(L({mode:B([`MODE_DYNAMIC`,`MODE_UNSPECIFIED`]).default(`MODE_UNSPECIFIED`),dynamicThreshold:M().default(1)})))}),enterpriseWebSearch:Up,googleMaps:Kp,urlContext:uf({id:`google.url_context`,inputSchema:Z(()=>Q(L({})))}),fileSearch:Gp,codeExecution:Hp,vertexRagStore:uf({id:`google.vertex_rag_store`,inputSchema:L({ragCorpus:j(),topK:M().optional()})})},Jp=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion=`v3`}get maxImagesPerCall(){return this.settings.maxImagesPerCall??4}get provider(){return this.config.provider}async doGenerate(e){var t;let{prompt:n,n:r=1,size:i,aspectRatio:a=`1:1`,seed:o,providerOptions:s,headers:c,abortSignal:l,files:u,mask:d}=e,f=[];if(u!=null&&u.length>0)throw Error(`Google Generative AI does not support image editing. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.`);if(d!=null)throw Error(`Google Generative AI does not support image editing with masks. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.`);i!=null&&f.push({type:`unsupported`,feature:`size`,details:"This model does not support the `size` option. Use `aspectRatio` instead."}),o!=null&&f.push({type:`unsupported`,feature:`seed`,details:"This model does not support the `seed` option through this provider."});let p=await nf({provider:`google`,providerOptions:s,schema:Xp}),m=((t=this.config._internal)?.currentDate)?.call(t)??new Date,h={sampleCount:r};a!=null&&(h.aspectRatio=a),p&&Object.assign(h,p);let g={instances:[{prompt:n}],parameters:h},{responseHeaders:_,value:v}=await af({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:Yl(await ff(this.config.headers),c),body:g,failedResponseHandler:yp,successfulResponseHandler:hf(Yp),abortSignal:l,fetch:this.config.fetch});return{images:v.predictions.map(e=>e.bytesBase64Encoded),warnings:f??[],providerMetadata:{google:{images:v.predictions.map(e=>({}))}},response:{timestamp:m,modelId:this.modelId,headers:_}}}},Yp=Z(()=>Q(L({predictions:I(L({bytesBase64Encoded:j()})).default([])}))),Xp=Z(()=>Q(L({personGeneration:B([`dont_allow`,`allow_adult`,`allow_all`]).nullish(),aspectRatio:B([`1:1`,`3:4`,`4:3`,`9:16`,`16:9`]).nullish()})));function Zp(e={}){let t=_f(e.baseURL)??`https://generativelanguage.googleapis.com/v1beta`,n=e.name??`google.generative-ai`,r=()=>Su({"x-goog-api-key":Nu({apiKey:e.apiKey,environmentVariableName:`GOOGLE_GENERATIVE_AI_API_KEY`,description:`Google Generative AI`}),...e.headers},`ai-sdk/google/${vp}`),i=i=>new Mp(i,{provider:n,baseURL:t,headers:r,generateId:e.generateId??hu,supportedUrls:()=>({"*":[RegExp(`^${t}/files/.*$`),RegExp(`^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$`),RegExp(`^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$`)]}),fetch:e.fetch}),a=i=>new xp(i,{provider:n,baseURL:t,headers:r,fetch:e.fetch}),o=(i,a={})=>new Jp(i,a,{provider:n,baseURL:t,headers:r,fetch:e.fetch}),s=function(e){if(new.target)throw Error(`The Google Generative AI model function cannot be called with the new keyword.`);return i(e)};return s.specificationVersion=`v3`,s.languageModel=i,s.chat=i,s.generativeAI=i,s.embedding=a,s.embeddingModel=a,s.textEmbedding=a,s.textEmbeddingModel=a,s.image=o,s.imageModel=o,s.tools=qp,s}Zp();function Qp(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.prompt_tokens,n=e.completion_tokens;return{inputTokens:{total:t,noCache:t,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:n,text:n,reasoning:void 0},raw:e}}function $p({data:e,mediaType:t}){return e instanceof URL?e.toString():`data:${t};base64,${au(e)}`}function em(e){let t=[];for(let n=0;n<e.length;n++){let{role:r,content:i}=e[n],a=n===e.length-1;switch(r){case`system`:t.push({role:`system`,content:i});break;case`user`:t.push({role:`user`,content:i.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:$p({data:e.data,mediaType:t})}}else if(e.mediaType===`application/pdf`)return{type:`document_url`,document_url:$p({data:e.data,mediaType:`application/pdf`})};else throw new nt({functionality:`Only images and PDF file parts are supported`})}})});break;case`assistant`:{let e=``,n=[];for(let t of i)switch(t.type){case`text`:e+=t.text;break;case`tool-call`:n.push({id:t.toolCallId,type:`function`,function:{name:t.toolName,arguments:JSON.stringify(t.input)}});break;case`reasoning`:e+=t.text;break;default:throw Error(`Unsupported content type in assistant message: ${t.type}`)}t.push({role:`assistant`,content:e,prefix:a?!0:void 0,tool_calls:n.length>0?n:void 0});break}case`tool`:for(let e of i){if(e.type===`tool-approval-response`)continue;let n=e.output,r;switch(n.type){case`text`:case`error-text`:r=n.value;break;case`execution-denied`:r=n.reason??`Tool execution denied.`;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(n.value);break}t.push({role:`tool`,name:e.toolName,tool_call_id:e.toolCallId,content:r})}break;default:{let e=r;throw Error(`Unsupported role: ${e}`)}}}return t}function tm({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function nm(e){switch(e){case`stop`:return`stop`;case`length`:case`model_length`:return`length`;case`tool_calls`:return`tool-calls`;default:return`other`}}var rm=L({safePrompt:N().optional(),documentImageLimit:M().optional(),documentPageLimit:M().optional(),structuredOutputs:N().optional(),strictJsonSchema:N().optional(),parallelToolCalls:N().optional()}),im=pf({errorSchema:L({object:V(`error`),message:j(),type:j(),param:j().nullable(),code:j().nullable()}),errorToMessage:e=>e.message});function am({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)t.type===`provider`?n.push({type:`unsupported`,feature:`provider-defined tool ${t.id}`}):r.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema,...t.strict==null?{}:{strict:t.strict}}});if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:return{tools:r,toolChoice:i,toolWarnings:n};case`required`:return{tools:r,toolChoice:`any`,toolWarnings:n};case`tool`:return{tools:r.filter(e=>e.function.name===t.toolName),toolChoice:`any`,toolWarnings:n};default:throw new nt({functionality:`tool choice type: ${i}`})}}var om=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={"application/pdf":[/^https:\/\/.*$/]},this.modelId=e,this.config=t,this.generateId=t.generateId??hu}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,providerOptions:u,tools:d,toolChoice:f}){let p=[],m=await nf({provider:`mistral`,providerOptions:u,schema:rm})??{};i!=null&&p.push({type:`unsupported`,feature:`topK`}),a!=null&&p.push({type:`unsupported`,feature:`frequencyPenalty`}),o!=null&&p.push({type:`unsupported`,feature:`presencePenalty`}),s!=null&&p.push({type:`unsupported`,feature:`stopSequences`});let h=m.structuredOutputs??!0,g=m.strictJsonSchema??!1;c?.type===`json`&&!c?.schema&&(e=Au({messages:e,schema:c.schema}));let _={model:this.modelId,safe_prompt:m.safePrompt,max_tokens:t,temperature:n,top_p:r,random_seed:l,response_format:c?.type===`json`?h&&c?.schema!=null?{type:`json_schema`,json_schema:{schema:c.schema,strict:g,name:c.name??`response`,description:c.description}}:{type:`json_object`}:void 0,document_image_limit:m.documentImageLimit,document_page_limit:m.documentPageLimit,messages:em(e)},{tools:v,toolChoice:y,toolWarnings:b}=am({tools:d,toolChoice:f});return{args:{..._,tools:v,tool_choice:y,...v!=null&&m.parallelToolCalls!==void 0?{parallel_tool_calls:m.parallelToolCalls}:{}},warnings:[...p,...b]}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:r,value:i,rawValue:a}=await af({url:`${this.config.baseURL}/chat/completions`,headers:Yl(this.config.headers(),e.headers),body:t,failedResponseHandler:im,successfulResponseHandler:hf(dm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=i.choices[0],s=[];if(o.message.content!=null&&Array.isArray(o.message.content))for(let e of o.message.content)if(e.type===`thinking`){let t=sm(e.thinking);t.length>0&&s.push({type:`reasoning`,text:t})}else e.type===`text`&&e.text.length>0&&s.push({type:`text`,text:e.text});else{let e=cm(o.message.content);e!=null&&e.length>0&&s.push({type:`text`,text:e})}if(o.message.tool_calls!=null)for(let e of o.message.tool_calls)s.push({type:`tool-call`,toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});return{content:s,finishReason:{unified:nm(o.finish_reason),raw:o.finish_reason??void 0},usage:Qp(i.usage),request:{body:t},response:{...tm(i),headers:r,body:a},warnings:n}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0},{responseHeaders:i,value:a}=await af({url:`${this.config.baseURL}/chat/completions`,headers:Yl(this.config.headers(),e.headers),body:r,failedResponseHandler:im,successfulResponseHandler:mf(fm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o={unified:`other`,raw:void 0},s,c=!0,l=!1,u=null,d=this.generateId;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let r=t.value;c&&(c=!1,n.enqueue({type:`response-metadata`,...tm(r)})),r.usage!=null&&(s=r.usage);let i=r.choices[0],a=i.delta,f=cm(a.content);if(a.content!=null&&Array.isArray(a.content)){for(let e of a.content)if(e.type===`thinking`){let t=sm(e.thinking);t.length>0&&(u??(l&&=(n.enqueue({type:`text-end`,id:`0`}),!1),u=d(),n.enqueue({type:`reasoning-start`,id:u})),n.enqueue({type:`reasoning-delta`,id:u,delta:t}))}}if(f!=null&&f.length>0&&(l||=(u!=null&&(n.enqueue({type:`reasoning-end`,id:u}),u=null),n.enqueue({type:`text-start`,id:`0`}),!0),n.enqueue({type:`text-delta`,id:`0`,delta:f})),a?.tool_calls!=null)for(let e of a.tool_calls){let t=e.id,r=e.function.name,i=e.function.arguments;n.enqueue({type:`tool-input-start`,id:t,toolName:r}),n.enqueue({type:`tool-input-delta`,id:t,delta:i}),n.enqueue({type:`tool-input-end`,id:t}),n.enqueue({type:`tool-call`,toolCallId:t,toolName:r,input:i})}i.finish_reason!=null&&(o={unified:nm(i.finish_reason),raw:i.finish_reason})},flush(e){u!=null&&e.enqueue({type:`reasoning-end`,id:u}),l&&e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:o,usage:Qp(s)})}})),request:{body:r},response:{headers:i}}}};function sm(e){return e.filter(e=>e.type===`text`).map(e=>e.text).join(``)}function cm(e){if(typeof e==`string`)return e;if(e==null)return;let t=[];for(let n of e){let{type:e}=n;switch(e){case`text`:t.push(n.text);break;case`thinking`:case`image_url`:case`reference`:break;default:{let t=e;throw Error(`Unsupported type: ${t}`)}}}return t.length?t.join(``):void 0}var lm=R([j(),I(z(`type`,[L({type:V(`text`),text:j()}),L({type:V(`image_url`),image_url:R([j(),L({url:j(),detail:j().nullable()})])}),L({type:V(`reference`),reference_ids:I(M())}),L({type:V(`thinking`),thinking:I(L({type:V(`text`),text:j()}))})]))]).nullish(),um=L({prompt_tokens:M(),completion_tokens:M(),total_tokens:M()}),dm=L({id:j().nullish(),created:M().nullish(),model:j().nullish(),choices:I(L({message:L({role:V(`assistant`),content:lm,tool_calls:I(L({id:j(),function:L({name:j(),arguments:j()})})).nullish()}),index:M(),finish_reason:j().nullish()})),object:V(`chat.completion`),usage:um}),fm=L({id:j().nullish(),created:M().nullish(),model:j().nullish(),choices:I(L({delta:L({role:B([`assistant`]).optional(),content:lm,tool_calls:I(L({id:j(),function:L({name:j(),arguments:j()})})).nullish()}),finish_reason:j().nullish(),index:M()})),usage:um.nullish()}),pm=class{constructor(e,t){this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=32,this.supportsParallelCalls=!1,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,abortSignal:t,headers:n}){if(e.length>this.maxEmbeddingsPerCall)throw new We({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:r,value:i,rawValue:a}=await af({url:`${this.config.baseURL}/embeddings`,headers:Yl(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:`float`},failedResponseHandler:im,successfulResponseHandler:hf(mm),abortSignal:t,fetch:this.config.fetch});return{warnings:[],embeddings:i.data.map(e=>e.embedding),usage:i.usage?{tokens:i.usage.prompt_tokens}:void 0,response:{headers:r,body:a}}}},mm=L({data:I(L({embedding:I(M())})),usage:L({prompt_tokens:M()}).nullish()}),hm=`3.0.2`;function gm(e={}){let t=_f(e.baseURL)??`https://api.mistral.ai/v1`,n=()=>Su({Authorization:`Bearer ${Nu({apiKey:e.apiKey,environmentVariableName:`MISTRAL_API_KEY`,description:`Mistral`})}`,...e.headers},`ai-sdk/mistral/${hm}`),r=r=>new om(r,{provider:`mistral.chat`,baseURL:t,headers:n,fetch:e.fetch,generateId:e.generateId}),i=r=>new pm(r,{provider:`mistral.embedding`,baseURL:t,headers:n,fetch:e.fetch}),a=function(e){if(new.target)throw Error(`The Mistral model function cannot be called with the new keyword.`);return r(e)};return a.specificationVersion=`v3`,a.languageModel=r,a.chat=r,a.embedding=i,a.embeddingModel=i,a.textEmbedding=i,a.textEmbeddingModel=i,a.imageModel=e=>{throw new Re({modelId:e,modelType:`imageModel`})},a}gm();var _m=L({error:L({message:j(),type:j().nullish(),param:Ds().nullish(),code:R([j(),M()]).nullish()})}),vm=pf({errorSchema:_m,errorToMessage:e=>e.error.message});function ym(e){let t=e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`),n=e.startsWith(`gpt-4`)||e.startsWith(`gpt-5-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-nano`)&&!e.startsWith(`gpt-5-chat`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`),r=e.startsWith(`o1`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`codex-mini`)||e.startsWith(`computer-use-preview`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`),i=e.startsWith(`gpt-5.1`)||e.startsWith(`gpt-5.2`);return{supportsFlexProcessing:t,supportsPriorityProcessing:n,isReasoningModel:r,systemMessageMode:r?`developer`:`system`,supportsNonReasoningParameters:i}}function bm(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.prompt_tokens??0,n=e.completion_tokens??0,r=e.prompt_tokens_details?.cached_tokens??0,i=e.completion_tokens_details?.reasoning_tokens??0;return{inputTokens:{total:t,noCache:t-r,cacheRead:r,cacheWrite:void 0},outputTokens:{total:n,text:n-i,reasoning:i},raw:e}}function xm({prompt:e,systemMessageMode:t=`system`}){let n=[],r=[];for(let{role:i,content:a}of e)switch(i){case`system`:switch(t){case`system`:n.push({role:`system`,content:a});break;case`developer`:n.push({role:`developer`,content:a});break;case`remove`:r.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=t;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:if(a.length===1&&a[0].type===`text`){n.push({role:`user`,content:a[0].text});break}n.push({role:`user`,content:a.map((e,t)=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${au(e.data)}`,detail:e.providerOptions?.openai?.imageDetail}}}else if(e.mediaType.startsWith(`audio/`)){if(e.data instanceof URL)throw new nt({functionality:`audio file parts with URLs`});switch(e.mediaType){case`audio/wav`:return{type:`input_audio`,input_audio:{data:au(e.data),format:`wav`}};case`audio/mp3`:case`audio/mpeg`:return{type:`input_audio`,input_audio:{data:au(e.data),format:`mp3`}};default:throw new nt({functionality:`audio content parts with media type ${e.mediaType}`})}}else if(e.mediaType===`application/pdf`){if(e.data instanceof URL)throw new nt({functionality:`PDF file parts with URLs`});return{type:`file`,file:typeof e.data==`string`&&e.data.startsWith(`file-`)?{file_id:e.data}:{filename:e.filename??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${au(e.data)}`}}}else throw new nt({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e=``,t=[];for(let n of a)switch(n.type){case`text`:e+=n.text;break;case`tool-call`:t.push({id:n.toolCallId,type:`function`,function:{name:n.toolName,arguments:JSON.stringify(n.input)}});break}n.push({role:`assistant`,content:e,tool_calls:t.length>0?t:void 0});break}case`tool`:for(let e of a){if(e.type===`tool-approval-response`)continue;let t=e.output,r;switch(t.type){case`text`:case`error-text`:r=t.value;break;case`execution-denied`:r=t.reason??`Tool execution denied.`;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(t.value);break}n.push({role:`tool`,tool_call_id:e.toolCallId,content:r})}break;default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return{messages:n,warnings:r}}function Sm({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n?new Date(n*1e3):void 0}}function Cm(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`other`}}var wm=Z(()=>Q(L({id:j().nullish(),created:M().nullish(),model:j().nullish(),choices:I(L({message:L({role:V(`assistant`).nullish(),content:j().nullish(),tool_calls:I(L({id:j().nullish(),type:V(`function`),function:L({name:j(),arguments:j()})})).nullish(),annotations:I(L({type:V(`url_citation`),url_citation:L({start_index:M(),end_index:M(),url:j(),title:j()})})).nullish()}),index:M(),logprobs:L({content:I(L({token:j(),logprob:M(),top_logprobs:I(L({token:j(),logprob:M()}))})).nullish()}).nullish(),finish_reason:j().nullish()})),usage:L({prompt_tokens:M().nullish(),completion_tokens:M().nullish(),total_tokens:M().nullish(),prompt_tokens_details:L({cached_tokens:M().nullish()}).nullish(),completion_tokens_details:L({reasoning_tokens:M().nullish(),accepted_prediction_tokens:M().nullish(),rejected_prediction_tokens:M().nullish()}).nullish()}).nullish()}))),Tm=Z(()=>Q(R([L({id:j().nullish(),created:M().nullish(),model:j().nullish(),choices:I(L({delta:L({role:B([`assistant`]).nullish(),content:j().nullish(),tool_calls:I(L({index:M(),id:j().nullish(),type:V(`function`).nullish(),function:L({name:j().nullish(),arguments:j().nullish()})})).nullish(),annotations:I(L({type:V(`url_citation`),url_citation:L({start_index:M(),end_index:M(),url:j(),title:j()})})).nullish()}).nullish(),logprobs:L({content:I(L({token:j(),logprob:M(),top_logprobs:I(L({token:j(),logprob:M()}))})).nullish()}).nullish(),finish_reason:j().nullish(),index:M()})),usage:L({prompt_tokens:M().nullish(),completion_tokens:M().nullish(),total_tokens:M().nullish(),prompt_tokens_details:L({cached_tokens:M().nullish()}).nullish(),completion_tokens_details:L({reasoning_tokens:M().nullish(),accepted_prediction_tokens:M().nullish(),rejected_prediction_tokens:M().nullish()}).nullish()}).nullish()}),_m]))),Em=Z(()=>Q(L({logitBias:Vs(_c(),M()).optional(),logprobs:R([N(),M()]).optional(),parallelToolCalls:N().optional(),user:j().optional(),reasoningEffort:B([`none`,`minimal`,`low`,`medium`,`high`,`xhigh`]).optional(),maxCompletionTokens:M().optional(),store:N().optional(),metadata:Vs(j().max(64),j().max(512)).optional(),prediction:Vs(j(),Ds()).optional(),serviceTier:B([`auto`,`flex`,`priority`,`default`]).optional(),strictJsonSchema:N().optional(),textVerbosity:B([`low`,`medium`,`high`]).optional(),promptCacheKey:j().optional(),promptCacheRetention:B([`in_memory`,`24h`]).optional(),safetyIdentifier:j().optional(),systemMessageMode:B([`system`,`developer`,`remove`]).optional(),forceReasoning:N().optional()})));function Dm({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)switch(t.type){case`function`:r.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema,...t.strict==null?{}:{strict:t.strict}}});break;default:n.push({type:`unsupported`,feature:`tool type: ${t.type}`});break}if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:case`required`:return{tools:r,toolChoice:i,toolWarnings:n};case`tool`:return{tools:r,toolChoice:{type:`function`,function:{name:t.toolName}},toolWarnings:n};default:throw new nt({functionality:`tool choice type: ${i}`})}}var Om=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){let p=[],m=await nf({provider:`openai`,providerOptions:f,schema:Em})??{},h=ym(this.modelId),g=m.forceReasoning??h.isReasoningModel;i!=null&&p.push({type:`unsupported`,feature:`topK`});let{messages:_,warnings:v}=xm({prompt:e,systemMessageMode:m.systemMessageMode??(g?`developer`:h.systemMessageMode)});p.push(...v);let y=m.strictJsonSchema??!0,b={model:this.modelId,logit_bias:m.logitBias,logprobs:m.logprobs===!0||typeof m.logprobs==`number`?!0:void 0,top_logprobs:typeof m.logprobs==`number`?m.logprobs:typeof m.logprobs==`boolean`&&m.logprobs?0:void 0,user:m.user,parallel_tool_calls:m.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,response_format:c?.type===`json`?c.schema==null?{type:`json_object`}:{type:`json_schema`,json_schema:{schema:c.schema,strict:y,name:c.name??`response`,description:c.description}}:void 0,stop:s,seed:l,verbosity:m.textVerbosity,max_completion_tokens:m.maxCompletionTokens,store:m.store,metadata:m.metadata,prediction:m.prediction,reasoning_effort:m.reasoningEffort,service_tier:m.serviceTier,prompt_cache_key:m.promptCacheKey,prompt_cache_retention:m.promptCacheRetention,safety_identifier:m.safetyIdentifier,messages:_};g?((m.reasoningEffort!==`none`||!h.supportsNonReasoningParameters)&&(b.temperature!=null&&(b.temperature=void 0,p.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported for reasoning models`})),b.top_p!=null&&(b.top_p=void 0,p.push({type:`unsupported`,feature:`topP`,details:`topP is not supported for reasoning models`})),b.logprobs!=null&&(b.logprobs=void 0,p.push({type:`other`,message:`logprobs is not supported for reasoning models`}))),b.frequency_penalty!=null&&(b.frequency_penalty=void 0,p.push({type:`unsupported`,feature:`frequencyPenalty`,details:`frequencyPenalty is not supported for reasoning models`})),b.presence_penalty!=null&&(b.presence_penalty=void 0,p.push({type:`unsupported`,feature:`presencePenalty`,details:`presencePenalty is not supported for reasoning models`})),b.logit_bias!=null&&(b.logit_bias=void 0,p.push({type:`other`,message:`logitBias is not supported for reasoning models`})),b.top_logprobs!=null&&(b.top_logprobs=void 0,p.push({type:`other`,message:`topLogprobs is not supported for reasoning models`})),b.max_tokens!=null&&(b.max_completion_tokens??=b.max_tokens,b.max_tokens=void 0)):(this.modelId.startsWith(`gpt-4o-search-preview`)||this.modelId.startsWith(`gpt-4o-mini-search-preview`))&&b.temperature!=null&&(b.temperature=void 0,p.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported for the search preview models and has been removed.`})),m.serviceTier===`flex`&&!h.supportsFlexProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),b.service_tier=void 0),m.serviceTier===`priority`&&!h.supportsPriorityProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),b.service_tier=void 0);let{tools:x,toolChoice:S,toolWarnings:C}=Dm({tools:u,toolChoice:d});return{args:{...b,tools:x,tool_choice:S},warnings:[...p,...C]}}async doGenerate(e){var t;let{args:n,warnings:r}=await this.getArgs(e),{responseHeaders:i,value:a,rawValue:o}=await af({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:Yl(this.config.headers(),e.headers),body:n,failedResponseHandler:vm,successfulResponseHandler:hf(wm),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=a.choices[0],c=[],l=s.message.content;l!=null&&l.length>0&&c.push({type:`text`,text:l});for(let e of s.message.tool_calls??[])c.push({type:`tool-call`,toolCallId:e.id??hu(),toolName:e.function.name,input:e.function.arguments});for(let e of s.message.annotations??[])c.push({type:`source`,sourceType:`url`,id:hu(),url:e.url_citation.url,title:e.url_citation.title});let u=a.usage?.completion_tokens_details;(t=a.usage)==null||t.prompt_tokens_details;let d={openai:{}};return u?.accepted_prediction_tokens!=null&&(d.openai.acceptedPredictionTokens=u?.accepted_prediction_tokens),u?.rejected_prediction_tokens!=null&&(d.openai.rejectedPredictionTokens=u?.rejected_prediction_tokens),s.logprobs?.content!=null&&(d.openai.logprobs=s.logprobs.content),{content:c,finishReason:{unified:Cm(s.finish_reason),raw:s.finish_reason??void 0},usage:bm(a.usage),request:{body:n},response:{...Sm(a),headers:i,body:o},warnings:r,providerMetadata:d}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await af({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:Yl(this.config.headers(),e.headers),body:r,failedResponseHandler:vm,successfulResponseHandler:mf(Tm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=[],s={unified:`other`,raw:void 0},c,l=!1,u=!1,d={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){s={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:t.error});return}let r=t.value;if(`error`in r){s={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:r.error});return}if(!l){let e=Sm(r);Object.values(e).some(Boolean)&&(l=!0,n.enqueue({type:`response-metadata`,...Sm(r)}))}r.usage!=null&&(c=r.usage,r.usage.completion_tokens_details?.accepted_prediction_tokens!=null&&(d.openai.acceptedPredictionTokens=r.usage.completion_tokens_details?.accepted_prediction_tokens),r.usage.completion_tokens_details?.rejected_prediction_tokens!=null&&(d.openai.rejectedPredictionTokens=r.usage.completion_tokens_details?.rejected_prediction_tokens));let i=r.choices[0];if(i?.finish_reason!=null&&(s={unified:Cm(i.finish_reason),raw:i.finish_reason}),i?.logprobs?.content!=null&&(d.openai.logprobs=i.logprobs.content),i?.delta==null)return;let a=i.delta;if(a.content!=null&&(u||=(n.enqueue({type:`text-start`,id:`0`}),!0),n.enqueue({type:`text-delta`,id:`0`,delta:a.content})),a.tool_calls!=null)for(let e of a.tool_calls){let t=e.index;if(o[t]==null){if(e.type!==`function`)throw new le({data:e,message:`Expected 'function' type.`});if(e.id==null)throw new le({data:e,message:`Expected 'id' to be a string.`});if(e.function?.name==null)throw new le({data:e,message:`Expected 'function.name' to be a string.`});n.enqueue({type:`tool-input-start`,id:e.id,toolName:e.function.name}),o[t]={id:e.id,type:`function`,function:{name:e.function.name,arguments:e.function.arguments??``},hasFinished:!1};let r=o[t];r.function?.name!=null&&r.function?.arguments!=null&&(r.function.arguments.length>0&&n.enqueue({type:`tool-input-delta`,id:r.id,delta:r.function.arguments}),ef(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:r.id??hu(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}let r=o[t];r.hasFinished||(e.function?.arguments!=null&&(r.function.arguments+=e.function?.arguments??``),n.enqueue({type:`tool-input-delta`,id:r.id,delta:e.function.arguments??``}),r.function?.name!=null&&r.function?.arguments!=null&&ef(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:r.id??hu(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0))}if(a.annotations!=null)for(let e of a.annotations)n.enqueue({type:`source`,sourceType:`url`,id:hu(),url:e.url_citation.url,title:e.url_citation.title})},flush(e){u&&e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:s,usage:bm(c),...d==null?{}:{providerMetadata:d}})}})),request:{body:r},response:{headers:i}}}};function km(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.prompt_tokens??0,n=e.completion_tokens??0;return{inputTokens:{total:e.prompt_tokens??void 0,noCache:t,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:e.completion_tokens??void 0,text:n,reasoning:void 0},raw:e}}function Am({prompt:e,user:t=`user`,assistant:n=`assistant`}){let r=``;e[0].role===`system`&&(r+=`${e[0].content}

`,e=e.slice(1));for(let{role:i,content:a}of e)switch(i){case`system`:throw new E({message:"Unexpected system message in prompt: ${content}",prompt:e});case`user`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text}}).filter(Boolean).join(``);r+=`${t}:
${e}

`;break}case`assistant`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text;case`tool-call`:throw new nt({functionality:`tool-call messages`})}}).join(``);r+=`${n}:
${e}

`;break}case`tool`:throw new nt({functionality:`tool messages`});default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${t}:`]}}function jm({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function Mm(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`other`}}var Nm=Z(()=>Q(L({id:j().nullish(),created:M().nullish(),model:j().nullish(),choices:I(L({text:j(),finish_reason:j(),logprobs:L({tokens:I(j()),token_logprobs:I(M()),top_logprobs:I(Vs(j(),M())).nullish()}).nullish()})),usage:L({prompt_tokens:M(),completion_tokens:M(),total_tokens:M()}).nullish()}))),Pm=Z(()=>Q(R([L({id:j().nullish(),created:M().nullish(),model:j().nullish(),choices:I(L({text:j(),finish_reason:j().nullish(),index:M(),logprobs:L({tokens:I(j()),token_logprobs:I(M()),top_logprobs:I(Vs(j(),M())).nullish()}).nullish()})),usage:L({prompt_tokens:M(),completion_tokens:M(),total_tokens:M()}).nullish()}),_m]))),Fm=Z(()=>Q(L({echo:N().optional(),logitBias:Vs(j(),M()).optional(),suffix:j().optional(),user:j().optional(),logprobs:R([N(),M()]).optional()}))),Im=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(`.`)[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,tools:l,toolChoice:u,seed:d,providerOptions:f}){let p=[],m={...await nf({provider:`openai`,providerOptions:f,schema:Fm}),...await nf({provider:this.providerOptionsName,providerOptions:f,schema:Fm})};i!=null&&p.push({type:`unsupported`,feature:`topK`}),l?.length&&p.push({type:`unsupported`,feature:`tools`}),u!=null&&p.push({type:`unsupported`,feature:`toolChoice`}),c!=null&&c.type!==`text`&&p.push({type:`unsupported`,feature:`responseFormat`,details:`JSON response format is not supported.`});let{prompt:h,stopSequences:g}=Am({prompt:e}),_=[...g??[],...s??[]];return{args:{model:this.modelId,echo:m.echo,logit_bias:m.logitBias,logprobs:m?.logprobs===!0?0:m?.logprobs===!1?void 0:m?.logprobs,suffix:m.suffix,user:m.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,seed:d,prompt:h,stop:_.length>0?_:void 0},warnings:p}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:r,value:i,rawValue:a}=await af({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:Yl(this.config.headers(),e.headers),body:t,failedResponseHandler:vm,successfulResponseHandler:hf(Nm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=i.choices[0],s={openai:{}};return o.logprobs!=null&&(s.openai.logprobs=o.logprobs),{content:[{type:`text`,text:o.text}],usage:km(i.usage),finishReason:{unified:Mm(o.finish_reason),raw:o.finish_reason??void 0},request:{body:t},response:{...jm(i),headers:r,body:a},providerMetadata:s,warnings:n}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await af({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:Yl(this.config.headers(),e.headers),body:r,failedResponseHandler:vm,successfulResponseHandler:mf(Pm),abortSignal:e.abortSignal,fetch:this.config.fetch}),o={unified:`other`,raw:void 0},s={openai:{}},c,l=!0;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){o={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:t.error});return}let r=t.value;if(`error`in r){o={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:r.error});return}l&&(l=!1,n.enqueue({type:`response-metadata`,...jm(r)}),n.enqueue({type:`text-start`,id:`0`})),r.usage!=null&&(c=r.usage);let i=r.choices[0];i?.finish_reason!=null&&(o={unified:Mm(i.finish_reason),raw:i.finish_reason}),i?.logprobs!=null&&(s.openai.logprobs=i.logprobs),i?.text!=null&&i.text.length>0&&n.enqueue({type:`text-delta`,id:`0`,delta:i.text})},flush(e){l||e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:o,providerMetadata:s,usage:km(c)})}})),request:{body:r},response:{headers:i}}}},Lm=Z(()=>Q(L({dimensions:M().optional(),user:j().optional()}))),Rm=Z(()=>Q(L({data:I(L({embedding:I(M())})),usage:L({prompt_tokens:M()}).nullish()}))),zm=class{constructor(e,t){this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){if(e.length>this.maxEmbeddingsPerCall)throw new We({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let i=await nf({provider:`openai`,providerOptions:r,schema:Lm})??{},{responseHeaders:a,value:o,rawValue:s}=await af({url:this.config.url({path:`/embeddings`,modelId:this.modelId}),headers:Yl(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:`float`,dimensions:i.dimensions,user:i.user},failedResponseHandler:vm,successfulResponseHandler:hf(Rm),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:o.data.map(e=>e.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,response:{headers:a,body:s}}}},Bm=Z(()=>Q(L({created:M().nullish(),data:I(L({b64_json:j(),revised_prompt:j().nullish()})),background:j().nullish(),output_format:j().nullish(),size:j().nullish(),quality:j().nullish(),usage:L({input_tokens:M().nullish(),output_tokens:M().nullish(),total_tokens:M().nullish(),input_tokens_details:L({image_tokens:M().nullish(),text_tokens:M().nullish()}).nullish()}).nullish()}))),Vm={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},Hm=new Set([`gpt-image-1`,`gpt-image-1-mini`,`gpt-image-1.5`]),Um=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`}get maxImagesPerCall(){return Vm[this.modelId]??1}get provider(){return this.config.provider}async doGenerate({prompt:e,files:t,mask:n,n:r,size:i,aspectRatio:a,seed:o,providerOptions:s,headers:c,abortSignal:l}){var u;let d=[];a!=null&&d.push({type:`unsupported`,feature:`aspectRatio`,details:"This model does not support aspect ratio. Use `size` instead."}),o!=null&&d.push({type:`unsupported`,feature:`seed`});let f=((u=this.config._internal)?.currentDate)?.call(u)??new Date;if(t!=null){let{value:a,responseHeaders:o}=await of({url:this.config.url({path:`/images/edits`,modelId:this.modelId}),headers:Yl(this.config.headers(),c),formData:ou({model:this.modelId,prompt:e,image:await Promise.all(t.map(e=>e.type===`file`?new Blob([e.data instanceof Uint8Array?new Blob([e.data],{type:e.mediaType}):new Blob([ru(e.data)],{type:e.mediaType})],{type:e.mediaType}):pu(e.url))),mask:n==null?void 0:await Wm(n),n:r,size:i,...s.openai??{}}),failedResponseHandler:vm,successfulResponseHandler:hf(Bm),abortSignal:l,fetch:this.config.fetch});return{images:a.data.map(e=>e.b64_json),warnings:d,usage:a.usage==null?void 0:{inputTokens:a.usage.input_tokens??void 0,outputTokens:a.usage.output_tokens??void 0,totalTokens:a.usage.total_tokens??void 0},response:{timestamp:f,modelId:this.modelId,headers:o},providerMetadata:{openai:{images:a.data.map(e=>({...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},created:a.created??void 0,size:a.size??void 0,quality:a.quality??void 0,background:a.background??void 0,outputFormat:a.output_format??void 0}))}}}}let{value:p,responseHeaders:m}=await af({url:this.config.url({path:`/images/generations`,modelId:this.modelId}),headers:Yl(this.config.headers(),c),body:{model:this.modelId,prompt:e,n:r,size:i,...s.openai??{},...Hm.has(this.modelId)?{}:{response_format:`b64_json`}},failedResponseHandler:vm,successfulResponseHandler:hf(Bm),abortSignal:l,fetch:this.config.fetch});return{images:p.data.map(e=>e.b64_json),warnings:d,usage:p.usage==null?void 0:{inputTokens:p.usage.input_tokens??void 0,outputTokens:p.usage.output_tokens??void 0,totalTokens:p.usage.total_tokens??void 0},response:{timestamp:f,modelId:this.modelId,headers:m},providerMetadata:{openai:{images:p.data.map(e=>({...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},created:p.created??void 0,size:p.size??void 0,quality:p.quality??void 0,background:p.background??void 0,outputFormat:p.output_format??void 0}))}}}}};async function Wm(e){if(!e)return;if(e.type===`url`)return pu(e.url);let t=e.data instanceof Uint8Array?e.data:ru(e.data);return new Blob([t],{type:e.mediaType})}var Gm=Z(()=>Q(L({callId:j(),operation:z(`type`,[L({type:V(`create_file`),path:j(),diff:j()}),L({type:V(`delete_file`),path:j()}),L({type:V(`update_file`),path:j(),diff:j()})])}))),Km=Z(()=>Q(L({status:B([`completed`,`failed`]),output:j().optional()}))),qm=df({id:`openai.apply_patch`,inputSchema:Gm,outputSchema:Km}),Jm=Z(()=>Q(L({code:j().nullish(),containerId:j()}))),Ym=Z(()=>Q(L({outputs:I(z(`type`,[L({type:V(`logs`),logs:j()}),L({type:V(`image`),url:j()})])).nullish()}))),Xm=Z(()=>Q(L({container:R([j(),L({fileIds:I(j()).optional()})]).optional()}))),Zm=df({id:`openai.code_interpreter`,inputSchema:Jm,outputSchema:Ym}),Qm=(e={})=>Zm(e),$m=L({key:j(),type:B([`eq`,`ne`,`gt`,`gte`,`lt`,`lte`,`in`,`nin`]),value:R([j(),M(),N(),I(j())])}),eh=L({type:B([`and`,`or`]),filters:I(R([$m,dc(()=>eh)]))}),th=Z(()=>Q(L({vectorStoreIds:I(j()),maxNumResults:M().optional(),ranking:L({ranker:j().optional(),scoreThreshold:M().optional()}).optional(),filters:R([$m,eh]).optional()}))),nh=Z(()=>Q(L({queries:I(j()),results:I(L({attributes:Vs(j(),P()),fileId:j(),filename:j(),score:M(),text:j()})).nullable()}))),rh=df({id:`openai.file_search`,inputSchema:L({}),outputSchema:nh}),ih=Z(()=>Q(L({background:B([`auto`,`opaque`,`transparent`]).optional(),inputFidelity:B([`low`,`high`]).optional(),inputImageMask:L({fileId:j().optional(),imageUrl:j().optional()}).optional(),model:j().optional(),moderation:B([`auto`]).optional(),outputCompression:M().int().min(0).max(100).optional(),outputFormat:B([`png`,`jpeg`,`webp`]).optional(),partialImages:M().int().min(0).max(3).optional(),quality:B([`auto`,`low`,`medium`,`high`]).optional(),size:B([`1024x1024`,`1024x1536`,`1536x1024`,`auto`]).optional()}).strict())),ah=df({id:`openai.image_generation`,inputSchema:Z(()=>Q(L({}))),outputSchema:Z(()=>Q(L({result:j()})))}),oh=(e={})=>ah(e),sh=Z(()=>Q(L({action:L({type:V(`exec`),command:I(j()),timeoutMs:M().optional(),user:j().optional(),workingDirectory:j().optional(),env:Vs(j(),j()).optional()})}))),ch=Z(()=>Q(L({output:j()}))),lh=df({id:`openai.local_shell`,inputSchema:sh,outputSchema:ch}),uh=Z(()=>Q(L({action:L({commands:I(j()),timeoutMs:M().optional(),maxOutputLength:M().optional()})}))),dh=Z(()=>Q(L({output:I(L({stdout:j(),stderr:j(),outcome:z(`type`,[L({type:V(`timeout`)}),L({type:V(`exit`),exitCode:M()})])}))}))),fh=df({id:`openai.shell`,inputSchema:uh,outputSchema:dh}),ph=Z(()=>Q(L({externalWebAccess:N().optional(),filters:L({allowedDomains:I(j()).optional()}).optional(),searchContextSize:B([`low`,`medium`,`high`]).optional(),userLocation:L({type:V(`approximate`),country:j().optional(),city:j().optional(),region:j().optional(),timezone:j().optional()}).optional()}))),mh=df({id:`openai.web_search`,inputSchema:Z(()=>Q(L({}))),outputSchema:Z(()=>Q(L({action:z(`type`,[L({type:V(`search`),query:j().optional()}),L({type:V(`openPage`),url:j().nullish()}),L({type:V(`findInPage`),url:j().nullish(),pattern:j().nullish()})]),sources:I(z(`type`,[L({type:V(`url`),url:j()}),L({type:V(`api`),name:j()})])).optional()})))}),hh=(e={})=>mh(e),gh=Z(()=>Q(L({searchContextSize:B([`low`,`medium`,`high`]).optional(),userLocation:L({type:V(`approximate`),country:j().optional(),city:j().optional(),region:j().optional(),timezone:j().optional()}).optional()}))),_h=df({id:`openai.web_search_preview`,inputSchema:Z(()=>Q(L({}))),outputSchema:Z(()=>Q(L({action:z(`type`,[L({type:V(`search`),query:j().optional()}),L({type:V(`openPage`),url:j().nullish()}),L({type:V(`findInPage`),url:j().nullish(),pattern:j().nullish()})])})))}),vh=dc(()=>R([j(),M(),N(),Ts(),I(vh),Vs(j(),vh)])),yh=Z(()=>Q(L({serverLabel:j(),allowedTools:R([I(j()),L({readOnly:N().optional(),toolNames:I(j()).optional()})]).optional(),authorization:j().optional(),connectorId:j().optional(),headers:Vs(j(),j()).optional(),requireApproval:R([B([`always`,`never`]),L({never:L({toolNames:I(j()).optional()}).optional()})]).optional(),serverDescription:j().optional(),serverUrl:j().optional()}).refine(e=>e.serverUrl!=null||e.connectorId!=null,`One of serverUrl or connectorId must be provided.`))),bh=df({id:`openai.mcp`,inputSchema:Z(()=>Q(L({}))),outputSchema:Z(()=>Q(L({type:V(`call`),serverLabel:j(),name:j(),arguments:j(),output:j().nullish(),error:R([j(),vh]).optional()})))}),xh={applyPatch:qm,codeInterpreter:Qm,fileSearch:rh,imageGeneration:oh,localShell:lh,shell:fh,webSearchPreview:_h,webSearch:hh,mcp:e=>bh(e)};function Sh(e){if(e==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let t=e.input_tokens,n=e.output_tokens,r=e.input_tokens_details?.cached_tokens??0,i=e.output_tokens_details?.reasoning_tokens??0;return{inputTokens:{total:t,noCache:t-r,cacheRead:r,cacheWrite:void 0},outputTokens:{total:n,text:n-i,reasoning:i},raw:e}}function Ch(e,t){return t?t.some(t=>e.startsWith(t)):!1}async function wh({prompt:e,toolNameMapping:t,systemMessageMode:n,fileIdPrefixes:r,store:i,hasLocalShellTool:a=!1,hasShellTool:o=!1,hasApplyPatchTool:s=!1}){let c=[],l=[],u=new Set;for(let{role:d,content:f}of e)switch(d){case`system`:switch(n){case`system`:c.push({role:`system`,content:f});break;case`developer`:c.push({role:`developer`,content:f});break;case`remove`:l.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=n;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:c.push({role:`user`,content:f.map((e,t)=>{switch(e.type){case`text`:return{type:`input_text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`input_image`,...e.data instanceof URL?{image_url:e.data.toString()}:typeof e.data==`string`&&Ch(e.data,r)?{file_id:e.data}:{image_url:`data:${t};base64,${au(e.data)}`},detail:e.providerOptions?.openai?.imageDetail}}else if(e.mediaType===`application/pdf`)return e.data instanceof URL?{type:`input_file`,file_url:e.data.toString()}:{type:`input_file`,...typeof e.data==`string`&&Ch(e.data,r)?{file_id:e.data}:{filename:e.filename??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${au(e.data)}`}};else throw new nt({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e={};for(let n of f)switch(n.type){case`text`:{let e=n.providerOptions?.openai?.itemId;if(i&&e!=null){c.push({type:`item_reference`,id:e});break}c.push({role:`assistant`,content:[{type:`output_text`,text:n.text}],id:e});break}case`tool-call`:{let e=n.providerOptions?.openai?.itemId??n.providerMetadata?.openai?.itemId;if(n.providerExecuted){i&&e!=null&&c.push({type:`item_reference`,id:e});break}if(i&&e!=null){c.push({type:`item_reference`,id:e});break}let r=t.toProviderToolName(n.toolName);if(a&&r===`local_shell`){let t=await Xd({value:n.input,schema:sh});c.push({type:`local_shell_call`,call_id:n.toolCallId,id:e,action:{type:`exec`,command:t.action.command,timeout_ms:t.action.timeoutMs,user:t.action.user,working_directory:t.action.workingDirectory,env:t.action.env}});break}if(o&&r===`shell`){let t=await Xd({value:n.input,schema:uh});c.push({type:`shell_call`,call_id:n.toolCallId,id:e,status:`completed`,action:{commands:t.action.commands,timeout_ms:t.action.timeoutMs,max_output_length:t.action.maxOutputLength}});break}c.push({type:`function_call`,call_id:n.toolCallId,name:r,arguments:JSON.stringify(n.input),id:e});break}case`tool-result`:if(n.output.type===`execution-denied`||n.output.type===`json`&&typeof n.output.value==`object`&&n.output.value!=null&&`type`in n.output.value&&n.output.value.type===`execution-denied`)break;if(i){let e=n.providerMetadata?.openai?.itemId??n.toolCallId;c.push({type:`item_reference`,id:e})}else l.push({type:`other`,message:`Results for OpenAI tool ${n.toolName} are not sent to the API when store is false`});break;case`reasoning`:{let t=await nf({provider:`openai`,providerOptions:n.providerOptions,schema:Th}),r=t?.itemId;if(r!=null){let a=e[r];if(i)a===void 0&&(c.push({type:`item_reference`,id:r}),e[r]={type:`reasoning`,id:r,summary:[]});else{let i=[];n.text.length>0?i.push({type:`summary_text`,text:n.text}):a!==void 0&&l.push({type:`other`,message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(n)}.`}),a===void 0?(e[r]={type:`reasoning`,id:r,encrypted_content:t?.reasoningEncryptedContent,summary:i},c.push(e[r])):(a.summary.push(...i),t?.reasoningEncryptedContent!=null&&(a.encrypted_content=t.reasoningEncryptedContent))}}else l.push({type:`other`,message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(n)}.`});break}}break}case`tool`:for(let e of f){if(e.type===`tool-approval-response`){let t=e;if(u.has(t.approvalId))continue;u.add(t.approvalId),i&&c.push({type:`item_reference`,id:t.approvalId}),c.push({type:`mcp_approval_response`,approval_request_id:t.approvalId,approve:t.approved});continue}let n=e.output;if(n.type===`execution-denied`&&n.providerOptions?.openai?.approvalId)continue;let r=t.toProviderToolName(e.toolName);if(a&&r===`local_shell`&&n.type===`json`){let t=await Xd({value:n.value,schema:ch});c.push({type:`local_shell_call_output`,call_id:e.toolCallId,output:t.output});continue}if(o&&r===`shell`&&n.type===`json`){let t=await Xd({value:n.value,schema:dh});c.push({type:`shell_call_output`,call_id:e.toolCallId,output:t.output.map(e=>({stdout:e.stdout,stderr:e.stderr,outcome:e.outcome.type===`timeout`?{type:`timeout`}:{type:`exit`,exit_code:e.outcome.exitCode}}))});continue}if(s&&e.toolName===`apply_patch`&&n.type===`json`){let t=await Xd({value:n.value,schema:Km});c.push({type:`apply_patch_call_output`,call_id:e.toolCallId,status:t.status,output:t.output});continue}let d;switch(n.type){case`text`:case`error-text`:d=n.value;break;case`execution-denied`:d=n.reason??`Tool execution denied.`;break;case`json`:case`error-json`:d=JSON.stringify(n.value);break;case`content`:d=n.value.map(e=>{switch(e.type){case`text`:return{type:`input_text`,text:e.text};case`image-data`:return{type:`input_image`,image_url:`data:${e.mediaType};base64,${e.data}`};case`file-data`:return{type:`input_file`,filename:e.filename??`data`,file_data:`data:${e.mediaType};base64,${e.data}`};default:l.push({type:`other`,message:`unsupported tool content part type: ${e.type}`});return}}).filter(ju);break}c.push({type:`function_call_output`,call_id:e.toolCallId,output:d})}break;default:{let e=d;throw Error(`Unsupported role: ${e}`)}}return{input:c,warnings:l}}var Th=L({itemId:j().nullish(),reasoningEncryptedContent:j().nullish()});function Eh({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?`tool-calls`:`stop`;case`max_output_tokens`:return`length`;case`content_filter`:return`content-filter`;default:return t?`tool-calls`:`other`}}var Dh=Z(()=>Q(R([L({type:V(`response.output_text.delta`),item_id:j(),delta:j(),logprobs:I(L({token:j(),logprob:M(),top_logprobs:I(L({token:j(),logprob:M()}))})).nullish()}),L({type:B([`response.completed`,`response.incomplete`]),response:L({incomplete_details:L({reason:j()}).nullish(),usage:L({input_tokens:M(),input_tokens_details:L({cached_tokens:M().nullish()}).nullish(),output_tokens:M(),output_tokens_details:L({reasoning_tokens:M().nullish()}).nullish()}),service_tier:j().nullish()})}),L({type:V(`response.created`),response:L({id:j(),created_at:M(),model:j(),service_tier:j().nullish()})}),L({type:V(`response.output_item.added`),output_index:M(),item:z(`type`,[L({type:V(`message`),id:j()}),L({type:V(`reasoning`),id:j(),encrypted_content:j().nullish()}),L({type:V(`function_call`),id:j(),call_id:j(),name:j(),arguments:j()}),L({type:V(`web_search_call`),id:j(),status:j()}),L({type:V(`computer_call`),id:j(),status:j()}),L({type:V(`file_search_call`),id:j()}),L({type:V(`image_generation_call`),id:j()}),L({type:V(`code_interpreter_call`),id:j(),container_id:j(),code:j().nullable(),outputs:I(z(`type`,[L({type:V(`logs`),logs:j()}),L({type:V(`image`),url:j()})])).nullable(),status:j()}),L({type:V(`mcp_call`),id:j(),status:j(),approval_request_id:j().nullish()}),L({type:V(`mcp_list_tools`),id:j()}),L({type:V(`mcp_approval_request`),id:j()}),L({type:V(`apply_patch_call`),id:j(),call_id:j(),status:B([`in_progress`,`completed`]),operation:z(`type`,[L({type:V(`create_file`),path:j(),diff:j()}),L({type:V(`delete_file`),path:j()}),L({type:V(`update_file`),path:j(),diff:j()})])}),L({type:V(`shell_call`),id:j(),call_id:j(),status:B([`in_progress`,`completed`,`incomplete`]),action:L({commands:I(j())})})])}),L({type:V(`response.output_item.done`),output_index:M(),item:z(`type`,[L({type:V(`message`),id:j()}),L({type:V(`reasoning`),id:j(),encrypted_content:j().nullish()}),L({type:V(`function_call`),id:j(),call_id:j(),name:j(),arguments:j(),status:V(`completed`)}),L({type:V(`code_interpreter_call`),id:j(),code:j().nullable(),container_id:j(),outputs:I(z(`type`,[L({type:V(`logs`),logs:j()}),L({type:V(`image`),url:j()})])).nullable()}),L({type:V(`image_generation_call`),id:j(),result:j()}),L({type:V(`web_search_call`),id:j(),status:j(),action:z(`type`,[L({type:V(`search`),query:j().nullish(),sources:I(z(`type`,[L({type:V(`url`),url:j()}),L({type:V(`api`),name:j()})])).nullish()}),L({type:V(`open_page`),url:j().nullish()}),L({type:V(`find_in_page`),url:j().nullish(),pattern:j().nullish()})])}),L({type:V(`file_search_call`),id:j(),queries:I(j()),results:I(L({attributes:Vs(j(),R([j(),M(),N()])),file_id:j(),filename:j(),score:M(),text:j()})).nullish()}),L({type:V(`local_shell_call`),id:j(),call_id:j(),action:L({type:V(`exec`),command:I(j()),timeout_ms:M().optional(),user:j().optional(),working_directory:j().optional(),env:Vs(j(),j()).optional()})}),L({type:V(`computer_call`),id:j(),status:V(`completed`)}),L({type:V(`mcp_call`),id:j(),status:j(),arguments:j(),name:j(),server_label:j(),output:j().nullish(),error:R([j(),L({type:j().optional(),code:R([M(),j()]).optional(),message:j().optional()}).loose()]).nullish(),approval_request_id:j().nullish()}),L({type:V(`mcp_list_tools`),id:j(),server_label:j(),tools:I(L({name:j(),description:j().optional(),input_schema:Ds(),annotations:Vs(j(),P()).optional()})),error:R([j(),L({type:j().optional(),code:R([M(),j()]).optional(),message:j().optional()}).loose()]).optional()}),L({type:V(`mcp_approval_request`),id:j(),server_label:j(),name:j(),arguments:j(),approval_request_id:j().optional()}),L({type:V(`apply_patch_call`),id:j(),call_id:j(),status:B([`in_progress`,`completed`]),operation:z(`type`,[L({type:V(`create_file`),path:j(),diff:j()}),L({type:V(`delete_file`),path:j()}),L({type:V(`update_file`),path:j(),diff:j()})])}),L({type:V(`shell_call`),id:j(),call_id:j(),status:B([`in_progress`,`completed`,`incomplete`]),action:L({commands:I(j())})})])}),L({type:V(`response.function_call_arguments.delta`),item_id:j(),output_index:M(),delta:j()}),L({type:V(`response.image_generation_call.partial_image`),item_id:j(),output_index:M(),partial_image_b64:j()}),L({type:V(`response.code_interpreter_call_code.delta`),item_id:j(),output_index:M(),delta:j()}),L({type:V(`response.code_interpreter_call_code.done`),item_id:j(),output_index:M(),code:j()}),L({type:V(`response.output_text.annotation.added`),annotation:z(`type`,[L({type:V(`url_citation`),start_index:M(),end_index:M(),url:j(),title:j()}),L({type:V(`file_citation`),file_id:j(),filename:j().nullish(),index:M().nullish(),start_index:M().nullish(),end_index:M().nullish(),quote:j().nullish()}),L({type:V(`container_file_citation`),container_id:j(),file_id:j(),filename:j().nullish(),start_index:M().nullish(),end_index:M().nullish(),index:M().nullish()}),L({type:V(`file_path`),file_id:j(),index:M().nullish()})])}),L({type:V(`response.reasoning_summary_part.added`),item_id:j(),summary_index:M()}),L({type:V(`response.reasoning_summary_text.delta`),item_id:j(),summary_index:M(),delta:j()}),L({type:V(`response.reasoning_summary_part.done`),item_id:j(),summary_index:M()}),L({type:V(`response.apply_patch_call_operation_diff.delta`),item_id:j(),output_index:M(),delta:j(),obfuscation:j().nullish()}),L({type:V(`response.apply_patch_call_operation_diff.done`),item_id:j(),output_index:M(),diff:j()}),L({type:V(`error`),sequence_number:M(),error:L({type:j(),code:j(),message:j(),param:j().nullish()})}),L({type:j()}).loose().transform(e=>({type:`unknown_chunk`,message:e.type}))]))),Oh=Z(()=>Q(L({id:j().optional(),created_at:M().optional(),error:L({message:j(),type:j(),param:j().nullish(),code:j()}).nullish(),model:j().optional(),output:I(z(`type`,[L({type:V(`message`),role:V(`assistant`),id:j(),content:I(L({type:V(`output_text`),text:j(),logprobs:I(L({token:j(),logprob:M(),top_logprobs:I(L({token:j(),logprob:M()}))})).nullish(),annotations:I(z(`type`,[L({type:V(`url_citation`),start_index:M(),end_index:M(),url:j(),title:j()}),L({type:V(`file_citation`),file_id:j(),filename:j().nullish(),index:M().nullish(),start_index:M().nullish(),end_index:M().nullish(),quote:j().nullish()}),L({type:V(`container_file_citation`),container_id:j(),file_id:j(),filename:j().nullish(),start_index:M().nullish(),end_index:M().nullish(),index:M().nullish()}),L({type:V(`file_path`),file_id:j(),index:M().nullish()})]))}))}),L({type:V(`web_search_call`),id:j(),status:j(),action:z(`type`,[L({type:V(`search`),query:j().nullish(),sources:I(z(`type`,[L({type:V(`url`),url:j()}),L({type:V(`api`),name:j()})])).nullish()}),L({type:V(`open_page`),url:j().nullish()}),L({type:V(`find_in_page`),url:j().nullish(),pattern:j().nullish()})])}),L({type:V(`file_search_call`),id:j(),queries:I(j()),results:I(L({attributes:Vs(j(),R([j(),M(),N()])),file_id:j(),filename:j(),score:M(),text:j()})).nullish()}),L({type:V(`code_interpreter_call`),id:j(),code:j().nullable(),container_id:j(),outputs:I(z(`type`,[L({type:V(`logs`),logs:j()}),L({type:V(`image`),url:j()})])).nullable()}),L({type:V(`image_generation_call`),id:j(),result:j()}),L({type:V(`local_shell_call`),id:j(),call_id:j(),action:L({type:V(`exec`),command:I(j()),timeout_ms:M().optional(),user:j().optional(),working_directory:j().optional(),env:Vs(j(),j()).optional()})}),L({type:V(`function_call`),call_id:j(),name:j(),arguments:j(),id:j()}),L({type:V(`computer_call`),id:j(),status:j().optional()}),L({type:V(`reasoning`),id:j(),encrypted_content:j().nullish(),summary:I(L({type:V(`summary_text`),text:j()}))}),L({type:V(`mcp_call`),id:j(),status:j(),arguments:j(),name:j(),server_label:j(),output:j().nullish(),error:R([j(),L({type:j().optional(),code:R([M(),j()]).optional(),message:j().optional()}).loose()]).nullish(),approval_request_id:j().nullish()}),L({type:V(`mcp_list_tools`),id:j(),server_label:j(),tools:I(L({name:j(),description:j().optional(),input_schema:Ds(),annotations:Vs(j(),P()).optional()})),error:R([j(),L({type:j().optional(),code:R([M(),j()]).optional(),message:j().optional()}).loose()]).optional()}),L({type:V(`mcp_approval_request`),id:j(),server_label:j(),name:j(),arguments:j(),approval_request_id:j().optional()}),L({type:V(`apply_patch_call`),id:j(),call_id:j(),status:B([`in_progress`,`completed`]),operation:z(`type`,[L({type:V(`create_file`),path:j(),diff:j()}),L({type:V(`delete_file`),path:j()}),L({type:V(`update_file`),path:j(),diff:j()})])}),L({type:V(`shell_call`),id:j(),call_id:j(),status:B([`in_progress`,`completed`,`incomplete`]),action:L({commands:I(j())})})])).optional(),service_tier:j().nullish(),incomplete_details:L({reason:j()}).nullish(),usage:L({input_tokens:M(),input_tokens_details:L({cached_tokens:M().nullish()}).nullish(),output_tokens:M(),output_tokens_details:L({reasoning_tokens:M().nullish()}).nullish()}).optional()}))),kh=20,Ah=Z(()=>Q(L({conversation:j().nullish(),include:I(B([`reasoning.encrypted_content`,`file_search_call.results`,`message.output_text.logprobs`])).nullish(),instructions:j().nullish(),logprobs:R([N(),M().min(1).max(kh)]).optional(),maxToolCalls:M().nullish(),metadata:Ds().nullish(),parallelToolCalls:N().nullish(),previousResponseId:j().nullish(),promptCacheKey:j().nullish(),promptCacheRetention:B([`in_memory`,`24h`]).nullish(),reasoningEffort:j().nullish(),reasoningSummary:j().nullish(),safetyIdentifier:j().nullish(),serviceTier:B([`auto`,`flex`,`priority`,`default`]).nullish(),store:N().nullish(),strictJsonSchema:N().nullish(),textVerbosity:B([`low`,`medium`,`high`]).nullish(),truncation:B([`auto`,`disabled`]).nullish(),user:j().nullish(),systemMessageMode:B([`system`,`developer`,`remove`]).optional(),forceReasoning:N().optional()})));async function jh({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)switch(t.type){case`function`:r.push({type:`function`,name:t.name,description:t.description,parameters:t.inputSchema,...t.strict==null?{}:{strict:t.strict}});break;case`provider`:switch(t.id){case`openai.file_search`:{let e=await Xd({value:t.args,schema:th});r.push({type:`file_search`,vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker,score_threshold:e.ranking.scoreThreshold}:void 0,filters:e.filters});break}case`openai.local_shell`:r.push({type:`local_shell`});break;case`openai.shell`:r.push({type:`shell`});break;case`openai.apply_patch`:r.push({type:`apply_patch`});break;case`openai.web_search_preview`:{let e=await Xd({value:t.args,schema:gh});r.push({type:`web_search_preview`,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.web_search`:{let e=await Xd({value:t.args,schema:ph});r.push({type:`web_search`,filters:e.filters==null?void 0:{allowed_domains:e.filters.allowedDomains},external_web_access:e.externalWebAccess,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.code_interpreter`:{let e=await Xd({value:t.args,schema:Xm});r.push({type:`code_interpreter`,container:e.container==null?{type:`auto`,file_ids:void 0}:typeof e.container==`string`?e.container:{type:`auto`,file_ids:e.container.fileIds}});break}case`openai.image_generation`:{let e=await Xd({value:t.args,schema:ih});r.push({type:`image_generation`,background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask?{file_id:e.inputImageMask.fileId,image_url:e.inputImageMask.imageUrl}:void 0,model:e.model,moderation:e.moderation,partial_images:e.partialImages,quality:e.quality,output_compression:e.outputCompression,output_format:e.outputFormat,size:e.size});break}case`openai.mcp`:{let e=await Xd({value:t.args,schema:yh}),n=e=>({tool_names:e.toolNames}),i=e.requireApproval,a=i==null?void 0:typeof i==`string`?i:i.never==null?void 0:{never:n(i.never)};r.push({type:`mcp`,server_label:e.serverLabel,allowed_tools:Array.isArray(e.allowedTools)?e.allowedTools:e.allowedTools?{read_only:e.allowedTools.readOnly,tool_names:e.allowedTools.toolNames}:void 0,authorization:e.authorization,connector_id:e.connectorId,headers:e.headers,require_approval:a??`never`,server_description:e.serverDescription,server_url:e.serverUrl});break}}break;default:n.push({type:`unsupported`,feature:`function tool ${t}`});break}if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:case`required`:return{tools:r,toolChoice:i,toolWarnings:n};case`tool`:return{tools:r,toolChoice:t.toolName===`code_interpreter`||t.toolName===`file_search`||t.toolName===`image_generation`||t.toolName===`web_search_preview`||t.toolName===`web_search`||t.toolName===`mcp`||t.toolName===`apply_patch`?{type:t.toolName}:{type:`function`,name:t.toolName},toolWarnings:n};default:throw new nt({functionality:`tool choice type: ${i}`})}}function Mh(e){let t={};for(let n of e)if(n.role===`assistant`)for(let e of n.content){if(e.type!==`tool-call`)continue;let n=e.providerOptions?.openai?.approvalRequestId;n!=null&&(t[n]=e.toolCallId)}return t}var Nh=class{constructor(e,t){this.specificationVersion=`v3`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:r,topK:i,presencePenalty:a,frequencyPenalty:o,seed:s,prompt:c,providerOptions:l,tools:u,toolChoice:d,responseFormat:f}){let p=[],m=ym(this.modelId);i!=null&&p.push({type:`unsupported`,feature:`topK`}),s!=null&&p.push({type:`unsupported`,feature:`seed`}),a!=null&&p.push({type:`unsupported`,feature:`presencePenalty`}),o!=null&&p.push({type:`unsupported`,feature:`frequencyPenalty`}),n!=null&&p.push({type:`unsupported`,feature:`stopSequences`});let h=await nf({provider:`openai`,providerOptions:l,schema:Ah}),g=h?.forceReasoning??m.isReasoningModel;h?.conversation&&h?.previousResponseId&&p.push({type:`unsupported`,feature:`conversation`,details:`conversation and previousResponseId cannot be used together`});let _=Xl({tools:u,providerToolNames:{"openai.code_interpreter":`code_interpreter`,"openai.file_search":`file_search`,"openai.image_generation":`image_generation`,"openai.local_shell":`local_shell`,"openai.shell":`shell`,"openai.web_search":`web_search`,"openai.web_search_preview":`web_search_preview`,"openai.mcp":`mcp`,"openai.apply_patch":`apply_patch`}}),{input:v,warnings:y}=await wh({prompt:c,toolNameMapping:_,systemMessageMode:h?.systemMessageMode??(g?`developer`:m.systemMessageMode),fileIdPrefixes:this.config.fileIdPrefixes,store:h?.store??!0,hasLocalShellTool:C(`openai.local_shell`),hasShellTool:C(`openai.shell`),hasApplyPatchTool:C(`openai.apply_patch`)});p.push(...y);let b=h?.strictJsonSchema??!0,x=h?.include;function S(e){x==null?x=[e]:x.includes(e)||(x=[...x,e])}function C(e){return u?.find(t=>t.type===`provider`&&t.id===e)!=null}let w=typeof h?.logprobs==`number`?h?.logprobs:h?.logprobs===!0?kh:void 0;w&&S(`message.output_text.logprobs`);let T=u?.find(e=>e.type===`provider`&&(e.id===`openai.web_search`||e.id===`openai.web_search_preview`))?.name;T&&S(`web_search_call.action.sources`),C(`openai.code_interpreter`)&&S(`code_interpreter_call.outputs`);let ee=h?.store;ee===!1&&g&&S(`reasoning.encrypted_content`);let te={model:this.modelId,input:v,temperature:t,top_p:r,max_output_tokens:e,...(f?.type===`json`||h?.textVerbosity)&&{text:{...f?.type===`json`&&{format:f.schema==null?{type:`json_object`}:{type:`json_schema`,strict:b,name:f.name??`response`,description:f.description,schema:f.schema}},...h?.textVerbosity&&{verbosity:h.textVerbosity}}},conversation:h?.conversation,max_tool_calls:h?.maxToolCalls,metadata:h?.metadata,parallel_tool_calls:h?.parallelToolCalls,previous_response_id:h?.previousResponseId,store:ee,user:h?.user,instructions:h?.instructions,service_tier:h?.serviceTier,include:x,prompt_cache_key:h?.promptCacheKey,prompt_cache_retention:h?.promptCacheRetention,safety_identifier:h?.safetyIdentifier,top_logprobs:w,truncation:h?.truncation,...g&&(h?.reasoningEffort!=null||h?.reasoningSummary!=null)&&{reasoning:{...h?.reasoningEffort!=null&&{effort:h.reasoningEffort},...h?.reasoningSummary!=null&&{summary:h.reasoningSummary}}}};g?h?.reasoningEffort===`none`&&m.supportsNonReasoningParameters||(te.temperature!=null&&(te.temperature=void 0,p.push({type:`unsupported`,feature:`temperature`,details:`temperature is not supported for reasoning models`})),te.top_p!=null&&(te.top_p=void 0,p.push({type:`unsupported`,feature:`topP`,details:`topP is not supported for reasoning models`}))):(h?.reasoningEffort!=null&&p.push({type:`unsupported`,feature:`reasoningEffort`,details:`reasoningEffort is not supported for non-reasoning models`}),h?.reasoningSummary!=null&&p.push({type:`unsupported`,feature:`reasoningSummary`,details:`reasoningSummary is not supported for non-reasoning models`})),h?.serviceTier===`flex`&&!m.supportsFlexProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),delete te.service_tier),h?.serviceTier===`priority`&&!m.supportsPriorityProcessing&&(p.push({type:`unsupported`,feature:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),delete te.service_tier);let{tools:ne,toolChoice:re,toolWarnings:E}=await jh({tools:u,toolChoice:d});return{webSearchToolName:T,args:{...te,tools:ne,tool_choice:re},warnings:[...p,...E],store:ee,toolNameMapping:_}}async doGenerate(e){var t,n,r,i,a;let{args:o,warnings:s,webSearchToolName:c,toolNameMapping:l}=await this.getArgs(e),u=this.config.url({path:`/responses`,modelId:this.modelId}),f=this.config.provider.replace(`.responses`,``),p=Mh(e.prompt),{responseHeaders:m,value:h,rawValue:g}=await af({url:u,headers:Yl(this.config.headers(),e.headers),body:o,failedResponseHandler:vm,successfulResponseHandler:hf(Oh),abortSignal:e.abortSignal,fetch:this.config.fetch});if(h.error)throw new d({message:h.error.message,url:u,requestBodyValues:o,statusCode:400,responseHeaders:m,responseBody:g,isRetryable:!1});let _=[],v=[],y=!1;for(let o of h.output)switch(o.type){case`reasoning`:o.summary.length===0&&o.summary.push({type:`summary_text`,text:``});for(let e of o.summary)_.push({type:`reasoning`,text:e.text,providerMetadata:{[f]:{itemId:o.id,reasoningEncryptedContent:o.encrypted_content??null}}});break;case`image_generation_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`image_generation`),input:`{}`,providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`image_generation`),result:{result:o.result}});break;case`local_shell_call`:_.push({type:`tool-call`,toolCallId:o.call_id,toolName:l.toCustomToolName(`local_shell`),input:JSON.stringify({action:o.action}),providerMetadata:{[f]:{itemId:o.id}}});break;case`shell_call`:_.push({type:`tool-call`,toolCallId:o.call_id,toolName:l.toCustomToolName(`shell`),input:JSON.stringify({action:{commands:o.action.commands}}),providerMetadata:{[f]:{itemId:o.id}}});break;case`message`:for(let a of o.content){e.providerOptions?.openai?.logprobs&&a.logprobs&&v.push(a.logprobs);let s={itemId:o.id,...a.annotations.length>0&&{annotations:a.annotations}};_.push({type:`text`,text:a.text,providerMetadata:{[f]:s}});for(let e of a.annotations)e.type===`url_citation`?_.push({type:`source`,sourceType:`url`,id:(t=this.config).generateId?.call(t)??hu(),url:e.url,title:e.title}):e.type===`file_citation`?_.push({type:`source`,sourceType:`document`,id:(n=this.config).generateId?.call(n)??hu(),mediaType:`text/plain`,title:e.quote??e.filename??`Document`,filename:e.filename??e.file_id,...e.file_id?{providerMetadata:{[f]:{fileId:e.file_id}}}:{}}):e.type===`container_file_citation`?_.push({type:`source`,sourceType:`document`,id:(r=this.config).generateId?.call(r)??hu(),mediaType:`text/plain`,title:e.filename??e.file_id??`Document`,filename:e.filename??e.file_id,providerMetadata:{[f]:{fileId:e.file_id,containerId:e.container_id,...e.index==null?{}:{index:e.index}}}}):e.type===`file_path`&&_.push({type:`source`,sourceType:`document`,id:(i=this.config).generateId?.call(i)??hu(),mediaType:`application/octet-stream`,title:e.file_id,filename:e.file_id,providerMetadata:{[f]:{fileId:e.file_id,...e.index==null?{}:{index:e.index}}}})}break;case`function_call`:y=!0,_.push({type:`tool-call`,toolCallId:o.call_id,toolName:o.name,input:o.arguments,providerMetadata:{[f]:{itemId:o.id}}});break;case`web_search_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(c??`web_search`),input:JSON.stringify({}),providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(c??`web_search`),result:qh(o.action)});break;case`mcp_call`:{let e=o.approval_request_id==null?o.id:p[o.approval_request_id]??o.id,t=`mcp.${o.name}`;_.push({type:`tool-call`,toolCallId:e,toolName:t,input:o.arguments,providerExecuted:!0,dynamic:!0}),_.push({type:`tool-result`,toolCallId:e,toolName:t,result:{type:`call`,serverLabel:o.server_label,name:o.name,arguments:o.arguments,...o.output==null?{}:{output:o.output},...o.error==null?{}:{error:o.error}},providerMetadata:{[f]:{itemId:o.id}}});break}case`mcp_list_tools`:break;case`mcp_approval_request`:{let e=o.approval_request_id??o.id,t=(a=this.config).generateId?.call(a)??hu(),n=`mcp.${o.name}`;_.push({type:`tool-call`,toolCallId:t,toolName:n,input:o.arguments,providerExecuted:!0,dynamic:!0}),_.push({type:`tool-approval-request`,approvalId:e,toolCallId:t});break}case`computer_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`computer_use`),input:``,providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`computer_use`),result:{type:`computer_use_tool_result`,status:o.status||`completed`}});break;case`file_search_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`file_search`),input:`{}`,providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`file_search`),result:{queries:o.queries,results:o.results?.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text}))??null}});break;case`code_interpreter_call`:_.push({type:`tool-call`,toolCallId:o.id,toolName:l.toCustomToolName(`code_interpreter`),input:JSON.stringify({code:o.code,containerId:o.container_id}),providerExecuted:!0}),_.push({type:`tool-result`,toolCallId:o.id,toolName:l.toCustomToolName(`code_interpreter`),result:{outputs:o.outputs}});break;case`apply_patch_call`:_.push({type:`tool-call`,toolCallId:o.call_id,toolName:l.toCustomToolName(`apply_patch`),input:JSON.stringify({callId:o.call_id,operation:o.operation}),providerMetadata:{[f]:{itemId:o.id}}});break}let b={[f]:{responseId:h.id}};v.length>0&&(b[f].logprobs=v),typeof h.service_tier==`string`&&(b[f].serviceTier=h.service_tier);let x=h.usage;return{content:_,finishReason:{unified:Eh({finishReason:h.incomplete_details?.reason,hasFunctionCall:y}),raw:h.incomplete_details?.reason??void 0},usage:Sh(x),request:{body:o},response:{id:h.id,timestamp:new Date(h.created_at*1e3),modelId:h.model,headers:m,body:g},providerMetadata:b,warnings:s}}async doStream(e){let{args:t,warnings:n,webSearchToolName:r,toolNameMapping:i,store:a}=await this.getArgs(e),{responseHeaders:o,value:s}=await af({url:this.config.url({path:`/responses`,modelId:this.modelId}),headers:Yl(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:vm,successfulResponseHandler:mf(Dh),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=this,l=this.config.provider.replace(`.responses`,``),u=Mh(e.prompt),d=new Map,f={unified:`other`,raw:void 0},p,m=[],h=null,g={},_=[],v=!1,y={},b;return{stream:s.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var o,s,x,S,C;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){f={unified:`error`,raw:void 0},n.enqueue({type:`error`,error:t.error});return}let w=t.value;if(Wh(w)){if(w.item.type===`function_call`)g[w.output_index]={toolName:w.item.name,toolCallId:w.item.call_id},n.enqueue({type:`tool-input-start`,id:w.item.call_id,toolName:w.item.name});else if(w.item.type===`web_search_call`)g[w.output_index]={toolName:i.toCustomToolName(r??`web_search`),toolCallId:w.item.id},n.enqueue({type:`tool-input-start`,id:w.item.id,toolName:i.toCustomToolName(r??`web_search`),providerExecuted:!0}),n.enqueue({type:`tool-input-end`,id:w.item.id}),n.enqueue({type:`tool-call`,toolCallId:w.item.id,toolName:i.toCustomToolName(r??`web_search`),input:JSON.stringify({}),providerExecuted:!0});else if(w.item.type===`computer_call`)g[w.output_index]={toolName:i.toCustomToolName(`computer_use`),toolCallId:w.item.id},n.enqueue({type:`tool-input-start`,id:w.item.id,toolName:i.toCustomToolName(`computer_use`),providerExecuted:!0});else if(w.item.type===`code_interpreter_call`)g[w.output_index]={toolName:i.toCustomToolName(`code_interpreter`),toolCallId:w.item.id,codeInterpreter:{containerId:w.item.container_id}},n.enqueue({type:`tool-input-start`,id:w.item.id,toolName:i.toCustomToolName(`code_interpreter`),providerExecuted:!0}),n.enqueue({type:`tool-input-delta`,id:w.item.id,delta:`{"containerId":"${w.item.container_id}","code":"`});else if(w.item.type===`file_search_call`)n.enqueue({type:`tool-call`,toolCallId:w.item.id,toolName:i.toCustomToolName(`file_search`),input:`{}`,providerExecuted:!0});else if(w.item.type===`image_generation_call`)n.enqueue({type:`tool-call`,toolCallId:w.item.id,toolName:i.toCustomToolName(`image_generation`),input:`{}`,providerExecuted:!0});else if(!(w.item.type===`mcp_call`||w.item.type===`mcp_list_tools`||w.item.type===`mcp_approval_request`))if(w.item.type===`apply_patch_call`){let{call_id:e,operation:t}=w.item;if(g[w.output_index]={toolName:i.toCustomToolName(`apply_patch`),toolCallId:e,applyPatch:{hasDiff:t.type===`delete_file`,endEmitted:t.type===`delete_file`}},n.enqueue({type:`tool-input-start`,id:e,toolName:i.toCustomToolName(`apply_patch`)}),t.type===`delete_file`){let r=JSON.stringify({callId:e,operation:t});n.enqueue({type:`tool-input-delta`,id:e,delta:r}),n.enqueue({type:`tool-input-end`,id:e})}else n.enqueue({type:`tool-input-delta`,id:e,delta:`{"callId":"${Jh(e)}","operation":{"type":"${Jh(t.type)}","path":"${Jh(t.path)}","diff":"`})}else w.item.type===`shell_call`?g[w.output_index]={toolName:i.toCustomToolName(`shell`),toolCallId:w.item.call_id}:w.item.type===`message`?(_.splice(0,_.length),n.enqueue({type:`text-start`,id:w.item.id,providerMetadata:{[l]:{itemId:w.item.id}}})):Wh(w)&&w.item.type===`reasoning`&&(y[w.item.id]={encryptedContent:w.item.encrypted_content,summaryParts:{0:`active`}},n.enqueue({type:`reasoning-start`,id:`${w.item.id}:0`,providerMetadata:{[l]:{itemId:w.item.id,reasoningEncryptedContent:w.item.encrypted_content??null}}}))}else if(Fh(w)){if(w.item.type===`message`)n.enqueue({type:`text-end`,id:w.item.id,providerMetadata:{[l]:{itemId:w.item.id,..._.length>0&&{annotations:_}}}});else if(w.item.type===`function_call`)g[w.output_index]=void 0,v=!0,n.enqueue({type:`tool-input-end`,id:w.item.call_id}),n.enqueue({type:`tool-call`,toolCallId:w.item.call_id,toolName:w.item.name,input:w.item.arguments,providerMetadata:{[l]:{itemId:w.item.id}}});else if(w.item.type===`web_search_call`)g[w.output_index]=void 0,n.enqueue({type:`tool-result`,toolCallId:w.item.id,toolName:i.toCustomToolName(r??`web_search`),result:qh(w.item.action)});else if(w.item.type===`computer_call`)g[w.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:w.item.id}),n.enqueue({type:`tool-call`,toolCallId:w.item.id,toolName:i.toCustomToolName(`computer_use`),input:``,providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:w.item.id,toolName:i.toCustomToolName(`computer_use`),result:{type:`computer_use_tool_result`,status:w.item.status||`completed`}});else if(w.item.type===`file_search_call`)g[w.output_index]=void 0,n.enqueue({type:`tool-result`,toolCallId:w.item.id,toolName:i.toCustomToolName(`file_search`),result:{queries:w.item.queries,results:w.item.results?.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text}))??null}});else if(w.item.type===`code_interpreter_call`)g[w.output_index]=void 0,n.enqueue({type:`tool-result`,toolCallId:w.item.id,toolName:i.toCustomToolName(`code_interpreter`),result:{outputs:w.item.outputs}});else if(w.item.type===`image_generation_call`)n.enqueue({type:`tool-result`,toolCallId:w.item.id,toolName:i.toCustomToolName(`image_generation`),result:{result:w.item.result}});else if(w.item.type===`mcp_call`){g[w.output_index]=void 0;let e=w.item.approval_request_id??void 0,t=e==null?w.item.id:d.get(e)??u[e]??w.item.id,r=`mcp.${w.item.name}`;n.enqueue({type:`tool-call`,toolCallId:t,toolName:r,input:w.item.arguments,providerExecuted:!0,dynamic:!0}),n.enqueue({type:`tool-result`,toolCallId:t,toolName:r,result:{type:`call`,serverLabel:w.item.server_label,name:w.item.name,arguments:w.item.arguments,...w.item.output==null?{}:{output:w.item.output},...w.item.error==null?{}:{error:w.item.error}},providerMetadata:{[l]:{itemId:w.item.id}}})}else if(w.item.type===`mcp_list_tools`)g[w.output_index]=void 0;else if(w.item.type===`apply_patch_call`){let e=g[w.output_index];e?.applyPatch&&!e.applyPatch.endEmitted&&w.item.operation.type!==`delete_file`&&(e.applyPatch.hasDiff||n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:Jh(w.item.operation.diff)}),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:`"}}`}),n.enqueue({type:`tool-input-end`,id:e.toolCallId}),e.applyPatch.endEmitted=!0),e&&w.item.status===`completed`&&n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:i.toCustomToolName(`apply_patch`),input:JSON.stringify({callId:w.item.call_id,operation:w.item.operation}),providerMetadata:{[l]:{itemId:w.item.id}}}),g[w.output_index]=void 0}else if(w.item.type===`mcp_approval_request`){g[w.output_index]=void 0;let e=(o=c.config).generateId?.call(o)??hu(),t=w.item.approval_request_id??w.item.id;d.set(t,e);let r=`mcp.${w.item.name}`;n.enqueue({type:`tool-call`,toolCallId:e,toolName:r,input:w.item.arguments,providerExecuted:!0,dynamic:!0}),n.enqueue({type:`tool-approval-request`,approvalId:t,toolCallId:e})}else if(w.item.type===`local_shell_call`)g[w.output_index]=void 0,n.enqueue({type:`tool-call`,toolCallId:w.item.call_id,toolName:i.toCustomToolName(`local_shell`),input:JSON.stringify({action:{type:`exec`,command:w.item.action.command,timeoutMs:w.item.action.timeout_ms,user:w.item.action.user,workingDirectory:w.item.action.working_directory,env:w.item.action.env}}),providerMetadata:{[l]:{itemId:w.item.id}}});else if(w.item.type===`shell_call`)g[w.output_index]=void 0,n.enqueue({type:`tool-call`,toolCallId:w.item.call_id,toolName:i.toCustomToolName(`shell`),input:JSON.stringify({action:{commands:w.item.action.commands}}),providerMetadata:{[l]:{itemId:w.item.id}}});else if(w.item.type===`reasoning`){let e=y[w.item.id],t=Object.entries(e.summaryParts).filter(([e,t])=>t===`active`||t===`can-conclude`).map(([e])=>e);for(let e of t)n.enqueue({type:`reasoning-end`,id:`${w.item.id}:${e}`,providerMetadata:{[l]:{itemId:w.item.id,reasoningEncryptedContent:w.item.encrypted_content??null}}});delete y[w.item.id]}}else if(Rh(w)){let e=g[w.output_index];e!=null&&n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:w.delta})}else if(Hh(w)){let e=g[w.output_index];e?.applyPatch&&(n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:Jh(w.delta)}),e.applyPatch.hasDiff=!0)}else if(Uh(w)){let e=g[w.output_index];e?.applyPatch&&!e.applyPatch.endEmitted&&(e.applyPatch.hasDiff||(n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:Jh(w.diff)}),e.applyPatch.hasDiff=!0),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:`"}}`}),n.enqueue({type:`tool-input-end`,id:e.toolCallId}),e.applyPatch.endEmitted=!0)}else if(zh(w))n.enqueue({type:`tool-result`,toolCallId:w.item_id,toolName:i.toCustomToolName(`image_generation`),result:{result:w.partial_image_b64},preliminary:!0});else if(Bh(w)){let e=g[w.output_index];e!=null&&n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:Jh(w.delta)})}else if(Vh(w)){let e=g[w.output_index];e!=null&&(n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:`"}`}),n.enqueue({type:`tool-input-end`,id:e.toolCallId}),n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:i.toCustomToolName(`code_interpreter`),input:JSON.stringify({code:w.code,containerId:e.codeInterpreter.containerId}),providerExecuted:!0}))}else if(Lh(w))h=w.response.id,n.enqueue({type:`response-metadata`,id:w.response.id,timestamp:new Date(w.response.created_at*1e3),modelId:w.response.model});else if(Ph(w))n.enqueue({type:`text-delta`,id:w.item_id,delta:w.delta}),e.providerOptions?.openai?.logprobs&&w.logprobs&&m.push(w.logprobs);else if(w.type===`response.reasoning_summary_part.added`){if(w.summary_index>0){let e=y[w.item_id];e.summaryParts[w.summary_index]=`active`;for(let t of Object.keys(e.summaryParts))e.summaryParts[t]===`can-conclude`&&(n.enqueue({type:`reasoning-end`,id:`${w.item_id}:${t}`,providerMetadata:{[l]:{itemId:w.item_id}}}),e.summaryParts[t]=`concluded`);n.enqueue({type:`reasoning-start`,id:`${w.item_id}:${w.summary_index}`,providerMetadata:{[l]:{itemId:w.item_id,reasoningEncryptedContent:y[w.item_id]?.encryptedContent??null}}})}}else w.type===`response.reasoning_summary_text.delta`?n.enqueue({type:`reasoning-delta`,id:`${w.item_id}:${w.summary_index}`,delta:w.delta,providerMetadata:{[l]:{itemId:w.item_id}}}):w.type===`response.reasoning_summary_part.done`?a?(n.enqueue({type:`reasoning-end`,id:`${w.item_id}:${w.summary_index}`,providerMetadata:{[l]:{itemId:w.item_id}}}),y[w.item_id].summaryParts[w.summary_index]=`concluded`):y[w.item_id].summaryParts[w.summary_index]=`can-conclude`:Ih(w)?(f={unified:Eh({finishReason:w.response.incomplete_details?.reason,hasFunctionCall:v}),raw:w.response.incomplete_details?.reason??void 0},p=w.response.usage,typeof w.response.service_tier==`string`&&(b=w.response.service_tier)):Gh(w)?(_.push(w.annotation),w.annotation.type===`url_citation`?n.enqueue({type:`source`,sourceType:`url`,id:(s=c.config).generateId?.call(s)??hu(),url:w.annotation.url,title:w.annotation.title}):w.annotation.type===`file_citation`?n.enqueue({type:`source`,sourceType:`document`,id:(x=c.config).generateId?.call(x)??hu(),mediaType:`text/plain`,title:w.annotation.quote??w.annotation.filename??`Document`,filename:w.annotation.filename??w.annotation.file_id,...w.annotation.file_id?{providerMetadata:{[l]:{fileId:w.annotation.file_id}}}:{}}):w.annotation.type===`container_file_citation`?n.enqueue({type:`source`,sourceType:`document`,id:(S=c.config).generateId?.call(S)??hu(),mediaType:`text/plain`,title:w.annotation.filename??w.annotation.file_id??`Document`,filename:w.annotation.filename??w.annotation.file_id,providerMetadata:{[l]:{fileId:w.annotation.file_id,containerId:w.annotation.container_id,...w.annotation.index==null?{}:{index:w.annotation.index}}}}):w.annotation.type===`file_path`&&n.enqueue({type:`source`,sourceType:`document`,id:(C=c.config).generateId?.call(C)??hu(),mediaType:`application/octet-stream`,title:w.annotation.file_id,filename:w.annotation.file_id,providerMetadata:{[l]:{fileId:w.annotation.file_id,...w.annotation.index==null?{}:{index:w.annotation.index}}}})):Kh(w)&&n.enqueue({type:`error`,error:w})},flush(e){let t={[l]:{responseId:h}};m.length>0&&(t[l].logprobs=m),b!==void 0&&(t[l].serviceTier=b),e.enqueue({type:`finish`,finishReason:f,usage:Sh(p),providerMetadata:t})}})),request:{body:t},response:{headers:o}}}};function Ph(e){return e.type===`response.output_text.delta`}function Fh(e){return e.type===`response.output_item.done`}function Ih(e){return e.type===`response.completed`||e.type===`response.incomplete`}function Lh(e){return e.type===`response.created`}function Rh(e){return e.type===`response.function_call_arguments.delta`}function zh(e){return e.type===`response.image_generation_call.partial_image`}function Bh(e){return e.type===`response.code_interpreter_call_code.delta`}function Vh(e){return e.type===`response.code_interpreter_call_code.done`}function Hh(e){return e.type===`response.apply_patch_call_operation_diff.delta`}function Uh(e){return e.type===`response.apply_patch_call_operation_diff.done`}function Wh(e){return e.type===`response.output_item.added`}function Gh(e){return e.type===`response.output_text.annotation.added`}function Kh(e){return e.type===`error`}function qh(e){switch(e.type){case`search`:return{action:{type:`search`,query:e.query??void 0},...e.sources!=null&&{sources:e.sources}};case`open_page`:return{action:{type:`openPage`,url:e.url}};case`find_in_page`:return{action:{type:`findInPage`,url:e.url,pattern:e.pattern}}}}function Jh(e){return JSON.stringify(e).slice(1,-1)}var Yh=Z(()=>Q(L({instructions:j().nullish(),speed:M().min(.25).max(4).default(1).nullish()}))),Xh=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`}get provider(){return this.config.provider}async getArgs({text:e,voice:t=`alloy`,outputFormat:n=`mp3`,speed:r,instructions:i,language:a,providerOptions:o}){let s=[],c=await nf({provider:`openai`,providerOptions:o,schema:Yh}),l={model:this.modelId,input:e,voice:t,response_format:`mp3`,speed:r,instructions:i};if(n&&([`mp3`,`opus`,`aac`,`flac`,`wav`,`pcm`].includes(n)?l.response_format=n:s.push({type:`unsupported`,feature:`outputFormat`,details:`Unsupported output format: ${n}. Using mp3 instead.`})),c){let e={};for(let t in e){let n=e[t];n!==void 0&&(l[t]=n)}}return a&&s.push({type:`unsupported`,feature:`language`,details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:l,warnings:s}}async doGenerate(e){var t;let n=((t=this.config._internal)?.currentDate)?.call(t)??new Date,{requestBody:r,warnings:i}=await this.getArgs(e),{value:a,responseHeaders:o,rawValue:s}=await af({url:this.config.url({path:`/audio/speech`,modelId:this.modelId}),headers:Yl(this.config.headers(),e.headers),body:r,failedResponseHandler:vm,successfulResponseHandler:gf(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:a,warnings:i,request:{body:JSON.stringify(r)},response:{timestamp:n,modelId:this.modelId,headers:o,body:s}}}},Zh=Z(()=>Q(L({text:j(),language:j().nullish(),duration:M().nullish(),words:I(L({word:j(),start:M(),end:M()})).nullish(),segments:I(L({id:M(),seek:M(),start:M(),end:M(),text:j(),tokens:I(M()),temperature:M(),avg_logprob:M(),compression_ratio:M(),no_speech_prob:M()})).nullish()}))),Qh=Z(()=>Q(L({include:I(j()).optional(),language:j().optional(),prompt:j().optional(),temperature:M().min(0).max(1).default(0).optional(),timestampGranularities:I(B([`word`,`segment`])).default([`segment`]).optional()}))),$h={afrikaans:`af`,arabic:`ar`,armenian:`hy`,azerbaijani:`az`,belarusian:`be`,bosnian:`bs`,bulgarian:`bg`,catalan:`ca`,chinese:`zh`,croatian:`hr`,czech:`cs`,danish:`da`,dutch:`nl`,english:`en`,estonian:`et`,finnish:`fi`,french:`fr`,galician:`gl`,german:`de`,greek:`el`,hebrew:`he`,hindi:`hi`,hungarian:`hu`,icelandic:`is`,indonesian:`id`,italian:`it`,japanese:`ja`,kannada:`kn`,kazakh:`kk`,korean:`ko`,latvian:`lv`,lithuanian:`lt`,macedonian:`mk`,malay:`ms`,marathi:`mr`,maori:`mi`,nepali:`ne`,norwegian:`no`,persian:`fa`,polish:`pl`,portuguese:`pt`,romanian:`ro`,russian:`ru`,serbian:`sr`,slovak:`sk`,slovenian:`sl`,spanish:`es`,swahili:`sw`,swedish:`sv`,tagalog:`tl`,tamil:`ta`,thai:`th`,turkish:`tr`,ukrainian:`uk`,urdu:`ur`,vietnamese:`vi`,welsh:`cy`},eg=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let r=[],i=await nf({provider:`openai`,providerOptions:n,schema:Qh}),a=new FormData,o=e instanceof Uint8Array?new Blob([e]):new Blob([ru(e)]);a.append(`model`,this.modelId);let s=Fu(t);if(a.append(`file`,new File([o],`audio`,{type:t}),`audio.${s}`),i){let e={include:i.include,language:i.language,prompt:i.prompt,response_format:[`gpt-4o-transcribe`,`gpt-4o-mini-transcribe`].includes(this.modelId)?`json`:`verbose_json`,temperature:i.temperature,timestamp_granularities:i.timestampGranularities};for(let[t,n]of Object.entries(e))if(n!=null)if(Array.isArray(n))for(let e of n)a.append(`${t}[]`,String(e));else a.append(t,String(n))}return{formData:a,warnings:r}}async doGenerate(e){var t;let n=((t=this.config._internal)?.currentDate)?.call(t)??new Date,{formData:r,warnings:i}=await this.getArgs(e),{value:a,responseHeaders:o,rawValue:s}=await of({url:this.config.url({path:`/audio/transcriptions`,modelId:this.modelId}),headers:Yl(this.config.headers(),e.headers),formData:r,failedResponseHandler:vm,successfulResponseHandler:hf(Zh),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=a.language!=null&&a.language in $h?$h[a.language]:void 0;return{text:a.text,segments:a.segments?.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end}))??a.words?.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end}))??[],language:c,durationInSeconds:a.duration??void 0,warnings:i,response:{timestamp:n,modelId:this.modelId,headers:o,body:s}}}},tg=`3.0.2`;function ng(e={}){let t=_f(Pu({settingValue:e.baseURL,environmentVariableName:`OPENAI_BASE_URL`}))??`https://api.openai.com/v1`,n=e.name??`openai`,r=()=>Su({Authorization:`Bearer ${Nu({apiKey:e.apiKey,environmentVariableName:`OPENAI_API_KEY`,description:`OpenAI`})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},`ai-sdk/openai/${tg}`),i=i=>new Om(i,{provider:`${n}.chat`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),a=i=>new Im(i,{provider:`${n}.completion`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),o=i=>new zm(i,{provider:`${n}.embedding`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),s=i=>new Um(i,{provider:`${n}.image`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),c=i=>new eg(i,{provider:`${n}.transcription`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),l=i=>new Xh(i,{provider:`${n}.speech`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch}),u=e=>{if(new.target)throw Error(`The OpenAI model function cannot be called with the new keyword.`);return d(e)},d=i=>new Nh(i,{provider:`${n}.responses`,url:({path:e})=>`${t}${e}`,headers:r,fetch:e.fetch,fileIdPrefixes:[`file-`]}),f=function(e){return u(e)};return f.specificationVersion=`v3`,f.languageModel=u,f.chat=i,f.completion=a,f.responses=d,f.embedding=o,f.embeddingModel=o,f.textEmbedding=o,f.textEmbeddingModel=o,f.image=s,f.imageModel=s,f.transcription=c,f.transcriptionModel=c,f.speech=l,f.speechModel=l,f.tools=xh,f}ng();var rg=e(((e,t)=>{var n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o=(e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})},s=(e,t,o,s)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let c of i(t))!a.call(e,c)&&c!==o&&n(e,c,{get:()=>t[c],enumerable:!(s=r(t,c))||s.enumerable});return e},c=e=>s(n({},`__esModule`,{value:!0}),e),l={};o(l,{SYMBOL_FOR_REQ_CONTEXT:()=>u,getContext:()=>d}),t.exports=c(l);let u=Symbol.for(`@vercel/request-context`);function d(){return globalThis[u]?.get?.()??{}}})),ig=e(((e,t)=>{var n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o=(e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})},s=(e,t,o,s)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let c of i(t))!a.call(e,c)&&c!==o&&n(e,c,{get:()=>t[c],enumerable:!(s=r(t,c))||s.enumerable});return e},c=e=>s(n({},`__esModule`,{value:!0}),e),l={};o(l,{getContext:()=>u.getContext,getVercelOidcToken:()=>d,getVercelOidcTokenSync:()=>f}),t.exports=c(l);var u=rg();async function d(){return``}function f(){return``}}))(),ag=Symbol.for(`vercel.ai.gateway.error`),og,sg,cg=class e extends (sg=Error,og=ag,sg){constructor({message:e,statusCode:t=500,cause:n}){super(e),this[og]=!0,this.statusCode=t,this.cause=n}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return typeof e==`object`&&!!e&&ag in e&&e[ag]===!0}},lg=`GatewayAuthenticationError`,ug=`vercel.ai.gateway.error.${lg}`,dg=Symbol.for(ug),fg,pg,mg=class e extends (pg=cg,fg=dg,pg){constructor({message:e=`Authentication failed`,statusCode:t=401,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[fg]=!0,this.name=lg,this.type=`authentication_error`}static isInstance(e){return cg.hasMarker(e)&&dg in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:n,message:r=`Authentication failed`,statusCode:i=401,cause:a}){let o;return o=t?`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:n?`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new e({message:o,statusCode:i,cause:a})}},hg=`GatewayInvalidRequestError`,gg=`vercel.ai.gateway.error.${hg}`,_g=Symbol.for(gg),vg,yg,bg=class extends (yg=cg,vg=_g,yg){constructor({message:e=`Invalid request`,statusCode:t=400,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[vg]=!0,this.name=hg,this.type=`invalid_request_error`}static isInstance(e){return cg.hasMarker(e)&&_g in e}},xg=`GatewayRateLimitError`,Sg=`vercel.ai.gateway.error.${xg}`,Cg=Symbol.for(Sg),wg,Tg,Eg=class extends (Tg=cg,wg=Cg,Tg){constructor({message:e=`Rate limit exceeded`,statusCode:t=429,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[wg]=!0,this.name=xg,this.type=`rate_limit_exceeded`}static isInstance(e){return cg.hasMarker(e)&&Cg in e}},Dg=`GatewayModelNotFoundError`,Og=`vercel.ai.gateway.error.${Dg}`,kg=Symbol.for(Og),Ag=Z(()=>Q(L({modelId:j()}))),jg,Mg,Ng=class extends (Mg=cg,jg=kg,Mg){constructor({message:e=`Model not found`,statusCode:t=404,modelId:n,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[jg]=!0,this.name=Dg,this.type=`model_not_found`,this.modelId=n}static isInstance(e){return cg.hasMarker(e)&&kg in e}},Pg=`GatewayInternalServerError`,Fg=`vercel.ai.gateway.error.${Pg}`,Ig=Symbol.for(Fg),Lg,Rg,zg=class extends (Rg=cg,Lg=Ig,Rg){constructor({message:e=`Internal server error`,statusCode:t=500,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Lg]=!0,this.name=Pg,this.type=`internal_server_error`}static isInstance(e){return cg.hasMarker(e)&&Ig in e}},Bg=`GatewayResponseError`,Vg=`vercel.ai.gateway.error.${Bg}`,Hg=Symbol.for(Vg),Ug,Wg,Gg=class extends (Wg=cg,Ug=Hg,Wg){constructor({message:e=`Invalid response from Gateway`,statusCode:t=502,response:n,validationError:r,cause:i}={}){super({message:e,statusCode:t,cause:i}),this[Ug]=!0,this.name=Bg,this.type=`response_error`,this.response=n,this.validationError=r}static isInstance(e){return cg.hasMarker(e)&&Hg in e}};async function Kg({response:e,statusCode:t,defaultMessage:n=`Gateway request failed`,cause:r,authMethod:i}){let a=await Zd({value:e,schema:qg});if(!a.success)return new Gg({message:`Invalid error response format: ${n}`,statusCode:t,response:e,validationError:a.error,cause:r});let o=a.value,s=o.error.type,c=o.error.message;switch(s){case`authentication_error`:return mg.createContextualError({apiKeyProvided:i===`api-key`,oidcTokenProvided:i===`oidc`,statusCode:t,cause:r});case`invalid_request_error`:return new bg({message:c,statusCode:t,cause:r});case`rate_limit_exceeded`:return new Eg({message:c,statusCode:t,cause:r});case`model_not_found`:{let e=await Zd({value:o.error.param,schema:Ag});return new Ng({message:c,statusCode:t,modelId:e.success?e.value.modelId:void 0,cause:r})}case`internal_server_error`:return new zg({message:c,statusCode:t,cause:r});default:return new zg({message:c,statusCode:t,cause:r})}}var qg=Z(()=>Q(L({error:L({message:j(),type:j().nullish(),param:P().nullish(),code:R([j(),M()]).nullish()})})));function Jg(e,t){return cg.isInstance(e)?e:d.isInstance(e)?Kg({response:Yg(e),statusCode:e.statusCode??500,defaultMessage:`Gateway request failed`,cause:e,authMethod:t}):Kg({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:`Unknown Gateway error`,cause:e,authMethod:t})}function Yg(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var Xg=`ai-gateway-auth-method`;async function Zg(e){let t=await Zd({value:e[Xg],schema:Qg});return t.success?t.value:void 0}var Qg=Z(()=>Q(R([V(`api-key`),V(`oidc`)]))),$g=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await Tu({url:`${this.config.baseURL}/config`,headers:await ff(this.config.headers()),successfulResponseHandler:hf(e_),failedResponseHandler:pf({errorSchema:Ds(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw await Jg(e)}}async getCredits(){try{let{value:e}=await Tu({url:`${new URL(this.config.baseURL).origin}/v1/credits`,headers:await ff(this.config.headers()),successfulResponseHandler:hf(t_),failedResponseHandler:pf({errorSchema:Ds(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw await Jg(e)}}},e_=Z(()=>Q(L({models:I(L({id:j(),name:j(),description:j().nullish(),pricing:L({input:j(),output:j(),input_cache_read:j().nullish(),input_cache_write:j().nullish()}).transform(({input:e,output:t,input_cache_read:n,input_cache_write:r})=>({input:e,output:t,...n?{cachedInputTokens:n}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:L({specificationVersion:V(`v3`),provider:j(),modelId:j()}),modelType:B([`language`,`embedding`,`image`]).nullish()}))}))),t_=Z(()=>Q(L({balance:j(),total_used:j()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),n_=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`,this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...n}=e;return{args:this.maybeEncodeFileParts(n),warnings:[]}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:r}=e,i=await ff(this.config.headers());try{let{responseHeaders:a,value:o,rawValue:s}=await af({url:this.getUrl(),headers:Yl(i,e.headers,this.getModelConfigHeaders(this.modelId,!1),await ff(this.config.o11yHeaders)),body:t,successfulResponseHandler:hf(Ds()),failedResponseHandler:pf({errorSchema:Ds(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...o,request:{body:t},response:{headers:a,body:s},warnings:n}}catch(e){throw await Jg(e,await Zg(i))}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:r}=e,i=await ff(this.config.headers());try{let{value:a,responseHeaders:o}=await af({url:this.getUrl(),headers:Yl(i,e.headers,this.getModelConfigHeaders(this.modelId,!0),await ff(this.config.o11yHeaders)),body:t,successfulResponseHandler:mf(Ds()),failedResponseHandler:pf({errorSchema:Ds(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:a.pipeThrough(new TransformStream({start(e){n.length>0&&e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(t.success){let r=t.value;if(r.type===`raw`&&!e.includeRawChunks)return;r.type===`response-metadata`&&r.timestamp&&typeof r.timestamp==`string`&&(r.timestamp=new Date(r.timestamp)),n.enqueue(r)}else n.error(t.error)}})),request:{body:t},response:{headers:o}}}catch(e){throw await Jg(e,await Zg(i))}}isFilePart(e){return e&&typeof e==`object`&&`type`in e&&e.type===`file`}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)){let t=e;if(t.data instanceof Uint8Array){let e=Uint8Array.from(t.data),n=Buffer.from(e).toString(`base64`);t.data=new URL(`data:${t.mediaType||`application/octet-stream`};base64,${n}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":`2`,"ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},r_=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){let i=await ff(this.config.headers());try{let{responseHeaders:a,value:o,rawValue:s}=await af({url:this.getUrl(),headers:Yl(i,t??{},this.getModelConfigHeaders(),await ff(this.config.o11yHeaders)),body:{values:e,...r?{providerOptions:r}:{}},successfulResponseHandler:hf(i_),failedResponseHandler:pf({errorSchema:Ds(),errorToMessage:e=>e}),...n&&{abortSignal:n},fetch:this.config.fetch});return{embeddings:o.embeddings,usage:o.usage??void 0,providerMetadata:o.providerMetadata,response:{headers:a,body:s},warnings:[]}}catch(e){throw await Jg(e,await Zg(i))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":`2`,"ai-model-id":this.modelId}}},i_=Z(()=>Q(L({embeddings:I(I(M())),usage:L({tokens:M()}).nullish(),providerMetadata:Vs(j(),Vs(j(),P())).optional()}))),a_=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v3`,this.maxImagesPerCall=2**53-1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:i,providerOptions:a,headers:o,abortSignal:s}){let c=await ff(this.config.headers());try{let{responseHeaders:l,value:u,rawValue:d}=await af({url:this.getUrl(),headers:Yl(c,o??{},this.getModelConfigHeaders(),await ff(this.config.o11yHeaders)),body:{prompt:e,n:t,...n&&{size:n},...r&&{aspectRatio:r},...i&&{seed:i},...a&&{providerOptions:a}},successfulResponseHandler:hf(s_),failedResponseHandler:pf({errorSchema:Ds(),errorToMessage:e=>e}),...s&&{abortSignal:s},fetch:this.config.fetch});return{images:u.images,warnings:u.warnings??[],providerMetadata:u.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:l}}}catch(e){throw Jg(e,await Zg(c))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":`2`,"ai-model-id":this.modelId}}},o_=L({images:I(P()).optional()}).catchall(P()),s_=L({images:I(j()),warnings:I(L({type:V(`other`),message:j()})).optional(),providerMetadata:Vs(j(),o_).optional()});async function c_(){return(0,ig.getContext)().headers?.[`x-vercel-id`]}var l_=`3.0.4`,u_=`0.0.1`;function d_(e={}){let t=null,n=null,r=e.metadataCacheRefreshMillis??1e3*60*5,i=0,a=_f(e.baseURL)??`https://ai-gateway.vercel.sh/v3/ai`,o=async()=>{try{let t=await p_(e);return Su({Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":u_,[Xg]:t.authMethod,...e.headers},`ai-sdk/gateway/${l_}`)}catch(e){throw mg.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401,cause:e})}},s=()=>{let e=Pu({settingValue:void 0,environmentVariableName:`VERCEL_DEPLOYMENT_ID`}),t=Pu({settingValue:void 0,environmentVariableName:`VERCEL_ENV`}),n=Pu({settingValue:void 0,environmentVariableName:`VERCEL_REGION`});return async()=>{let r=await c_();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...n&&{"ai-o11y-region":n},...r&&{"ai-o11y-request-id":r}}}},c=t=>new n_(t,{provider:`gateway`,baseURL:a,headers:o,fetch:e.fetch,o11yHeaders:s()}),l=async()=>{var s;let c=((s=e._internal)?.currentDate)?.call(s).getTime()??Date.now();return(!t||c-i>r)&&(i=c,t=new $g({baseURL:a,headers:o,fetch:e.fetch}).getAvailableModels().then(e=>(n=e,e)).catch(async e=>{throw await Jg(e,await Zg(await o()))})),n?Promise.resolve(n):t},u=async()=>new $g({baseURL:a,headers:o,fetch:e.fetch}).getCredits().catch(async e=>{throw await Jg(e,await Zg(await o()))}),d=function(e){if(new.target)throw Error(`The Gateway Provider model function cannot be called with the new keyword.`);return c(e)};d.specificationVersion=`v3`,d.getAvailableModels=l,d.getCredits=u,d.imageModel=t=>new a_(t,{provider:`gateway`,baseURL:a,headers:o,fetch:e.fetch,o11yHeaders:s()}),d.languageModel=c;let f=t=>new r_(t,{provider:`gateway`,baseURL:a,headers:o,fetch:e.fetch,o11yHeaders:s()});return d.embeddingModel=f,d.textEmbeddingModel=f,d}var f_=d_();async function p_(e){let t=Pu({settingValue:e.apiKey,environmentVariableName:`AI_GATEWAY_API_KEY`});return t?{token:t,authMethod:`api-key`}:{token:await(0,ig.getVercelOidcToken)(),authMethod:`oidc`}}var m_=typeof globalThis==`object`?globalThis:typeof self==`object`?self:typeof window==`object`?window:typeof global==`object`?global:{},h_=`1.9.0`,g_=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function __(e){var t=new Set([e]),n=new Set,r=e.match(g_);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(t){return t===e};function a(e){return n.add(e),!1}function o(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(g_);if(!r)return a(e);var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};return s.prerelease!=null||i.major!==s.major?a(e):i.major===0?i.minor===s.minor&&i.patch<=s.patch?o(e):a(e):i.minor<=s.minor?o(e):a(e)}}var v_=__(h_),y_=h_.split(`.`)[0],b_=Symbol.for(`opentelemetry.js.api.`+y_),x_=m_;function S_(e,t,n,r){r===void 0&&(r=!1);var i=x_[b_]=x_[b_]??{version:h_};if(!r&&i[e]){var a=Error(`@opentelemetry/api: Attempted duplicate registration of API: `+e);return n.error(a.stack||a.message),!1}if(i.version!==h_){var a=Error(`@opentelemetry/api: Registration of version v`+i.version+` for `+e+` does not match previously registered API v`+h_);return n.error(a.stack||a.message),!1}return i[e]=t,n.debug(`@opentelemetry/api: Registered a global for `+e+` v`+h_+`.`),!0}function C_(e){var t=x_[b_]?.version;if(!(!t||!v_(t)))return x_[b_]?.[e]}function w_(e,t){t.debug(`@opentelemetry/api: Unregistering a global for `+e+` v`+h_+`.`);var n=x_[b_];n&&delete n[e]}var T_=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},E_=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},D_=function(){function e(e){this._namespace=e.namespace||`DiagComponentLogger`}return e.prototype.debug=function(){var e=[...arguments];return O_(`debug`,this._namespace,e)},e.prototype.error=function(){var e=[...arguments];return O_(`error`,this._namespace,e)},e.prototype.info=function(){var e=[...arguments];return O_(`info`,this._namespace,e)},e.prototype.warn=function(){var e=[...arguments];return O_(`warn`,this._namespace,e)},e.prototype.verbose=function(){var e=[...arguments];return O_(`verbose`,this._namespace,e)},e}();function O_(e,t,n){var r=C_(`diag`);if(r)return n.unshift(t),r[e].apply(r,E_([],T_(n),!1))}var k_;(function(e){e[e.NONE=0]=`NONE`,e[e.ERROR=30]=`ERROR`,e[e.WARN=50]=`WARN`,e[e.INFO=60]=`INFO`,e[e.DEBUG=70]=`DEBUG`,e[e.VERBOSE=80]=`VERBOSE`,e[e.ALL=9999]=`ALL`})(k_||={});function A_(e,t){e<k_.NONE?e=k_.NONE:e>k_.ALL&&(e=k_.ALL),t||={};function n(n,r){var i=t[n];return typeof i==`function`&&e>=r?i.bind(t):function(){}}return{error:n(`error`,k_.ERROR),warn:n(`warn`,k_.WARN),info:n(`info`,k_.INFO),debug:n(`debug`,k_.DEBUG),verbose:n(`verbose`,k_.VERBOSE)}}var j_=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},M_=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},N_=`diag`,P_=function(){function e(){function e(e){return function(){var t=[...arguments],n=C_(`diag`);if(n)return n[e].apply(n,M_([],j_(t),!1))}}var t=this;t.setLogger=function(e,n){if(n===void 0&&(n={logLevel:k_.INFO}),e===t){var r=Error(`Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation`);return t.error(r.stack??r.message),!1}typeof n==`number`&&(n={logLevel:n});var i=C_(`diag`),a=A_(n.logLevel??k_.INFO,e);if(i&&!n.suppressOverrideMessage){var o=Error().stack??`<failed to generate stacktrace>`;i.warn(`Current logger will be overwritten from `+o),a.warn(`Current logger will overwrite one already registered from `+o)}return S_(`diag`,a,t,!0)},t.disable=function(){w_(N_,t)},t.createComponentLogger=function(e){return new D_(e)},t.verbose=e(`verbose`),t.debug=e(`debug`),t.info=e(`info`),t.warn=e(`warn`),t.error=e(`error`)}return e.instance=function(){return this._instance||=new e,this._instance},e}();function F_(e){return Symbol.for(e)}var I_=new(function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var i=new e(n._currentContext);return i._currentContext.set(t,r),i},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}}return e}()),L_=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},R_=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},z_=function(){function e(){}return e.prototype.active=function(){return I_},e.prototype.with=function(e,t,n){var r=[...arguments].slice(3);return t.call.apply(t,R_([n],L_(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),B_=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},V_=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},H_=`context`,U_=new z_,W_=function(){function e(){}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalContextManager=function(e){return S_(H_,e,P_.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,i=[],a=3;a<arguments.length;a++)i[a-3]=arguments[a];return(r=this._getContextManager()).with.apply(r,V_([e,t,n],B_(i),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return C_(H_)||U_},e.prototype.disable=function(){this._getContextManager().disable(),w_(H_,P_.instance())},e}(),G_;(function(e){e[e.NONE=0]=`NONE`,e[e.SAMPLED=1]=`SAMPLED`})(G_||={});var K_=`0000000000000000`,q_=`00000000000000000000000000000000`,J_={traceId:q_,spanId:K_,traceFlags:G_.NONE},Y_=function(){function e(e){e===void 0&&(e=J_),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),X_=F_(`OpenTelemetry Context Key SPAN`);function Z_(e){return e.getValue(X_)||void 0}function Q_(){return Z_(W_.getInstance().active())}function $_(e,t){return e.setValue(X_,t)}function ev(e){return e.deleteValue(X_)}function tv(e,t){return $_(e,new Y_(t))}function nv(e){return Z_(e)?.spanContext()}var rv=/^([0-9a-f]{32})$/i,iv=/^[0-9a-f]{16}$/i;function av(e){return rv.test(e)&&e!==q_}function ov(e){return iv.test(e)&&e!==K_}function sv(e){return av(e.traceId)&&ov(e.spanId)}function cv(e){return new Y_(e)}var lv=W_.getInstance(),uv=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(n===void 0&&(n=lv.active()),t?.root)return new Y_;var r=n&&nv(n);return dv(r)&&sv(r)?new Y_(r):new Y_},e.prototype.startActiveSpan=function(e,t,n,r){var i,a,o;if(!(arguments.length<2)){arguments.length===2?o=t:arguments.length===3?(i=t,o=n):(i=t,a=n,o=r);var s=a??lv.active(),c=this.startSpan(e,i,s),l=$_(s,c);return lv.with(l,o,void 0,c)}},e}();function dv(e){return typeof e==`object`&&typeof e.spanId==`string`&&typeof e.traceId==`string`&&typeof e.traceFlags==`number`}var fv=new uv,pv=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):fv},e}(),mv=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new uv},e}()),hv=function(){function e(){}return e.prototype.getTracer=function(e,t,n){return this.getDelegateTracer(e,t,n)??new pv(this,e,t,n)},e.prototype.getDelegate=function(){return this._delegate??mv},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){return this._delegate?.getTracer(e,t,n)},e}(),gv;(function(e){e[e.UNSET=0]=`UNSET`,e[e.OK=1]=`OK`,e[e.ERROR=2]=`ERROR`})(gv||={});var _v=`trace`,vv=function(){function e(){this._proxyTracerProvider=new hv,this.wrapSpanContext=cv,this.isSpanContextValid=sv,this.deleteSpan=ev,this.getSpan=Z_,this.getActiveSpan=Q_,this.getSpanContext=nv,this.setSpan=$_,this.setSpanContext=tv}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=S_(_v,this._proxyTracerProvider,P_.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return C_(_v)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){w_(_v,P_.instance()),this._proxyTracerProvider=new hv},e}().getInstance(),yv=Object.defineProperty,bv=(e,t)=>{for(var n in t)yv(e,n,{get:t[n],enumerable:!0})},xv=`AI_InvalidArgumentError`,Sv=`vercel.ai.error.${xv}`,Cv=Symbol.for(Sv),wv,Tv=class extends a{constructor({parameter:e,value:t,message:n}){super({name:xv,message:`Invalid argument for parameter ${e}: ${n}`}),this[wv]=!0,this.parameter=e,this.value=t}static isInstance(e){return a.hasMarker(e,Sv)}};wv=Cv;var Ev=`AI_InvalidStreamPartError`,Dv=`vercel.ai.error.${Ev}`,Ov=Symbol.for(Dv),kv,Av=class extends a{constructor({chunk:e,message:t}){super({name:Ev,message:t}),this[kv]=!0,this.chunk=e}static isInstance(e){return a.hasMarker(e,Dv)}};kv=Ov;var jv=`AI_InvalidToolApprovalError`,Mv=`vercel.ai.error.${jv}`,Nv=Symbol.for(Mv),Pv,Fv=class extends a{constructor({approvalId:e}){super({name:jv,message:`Tool approval response references unknown approvalId: "${e}". No matching tool-approval-request found in message history.`}),this[Pv]=!0,this.approvalId=e}static isInstance(e){return a.hasMarker(e,Mv)}};Pv=Nv;var Iv=`AI_InvalidToolInputError`,Lv=`vercel.ai.error.${Iv}`,Rv=Symbol.for(Lv),zv,Bv=class extends a{constructor({toolInput:e,toolName:t,cause:n,message:r=`Invalid input for tool ${t}: ${v(n)}`}){super({name:Iv,message:r,cause:n}),this[zv]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return a.hasMarker(e,Lv)}};zv=Rv;var Vv=`AI_ToolCallNotFoundForApprovalError`,Hv=`vercel.ai.error.${Vv}`,Uv=Symbol.for(Hv),Wv,Gv=class extends a{constructor({toolCallId:e,approvalId:t}){super({name:Vv,message:`Tool call "${e}" not found for approval request "${t}".`}),this[Wv]=!0,this.toolCallId=e,this.approvalId=t}static isInstance(e){return a.hasMarker(e,Hv)}};Wv=Uv;var Kv=`AI_NoImageGeneratedError`,qv=`vercel.ai.error.${Kv}`,Jv=Symbol.for(qv),Yv,Xv=class extends a{constructor({message:e=`No image generated.`,cause:t,responses:n}){super({name:Kv,message:e,cause:t}),this[Yv]=!0,this.responses=n}static isInstance(e){return a.hasMarker(e,qv)}};Yv=Jv;var Zv=`AI_NoObjectGeneratedError`,Qv=`vercel.ai.error.${Zv}`,$v=Symbol.for(Qv),ey,ty=class extends a{constructor({message:e=`No object generated.`,cause:t,text:n,response:r,usage:i,finishReason:a}){super({name:Zv,message:e,cause:t}),this[ey]=!0,this.text=n,this.response=r,this.usage=i,this.finishReason=a}static isInstance(e){return a.hasMarker(e,Qv)}};ey=$v;var ny=`AI_NoOutputGeneratedError`,ry=`vercel.ai.error.${ny}`,iy=Symbol.for(ry),ay,oy=class extends a{constructor({message:e=`No output generated.`,cause:t}={}){super({name:ny,message:e,cause:t}),this[ay]=!0}static isInstance(e){return a.hasMarker(e,ry)}};ay=iy;var sy=class extends a{constructor(e){super({name:`AI_NoSpeechGeneratedError`,message:`No speech audio generated.`}),this.responses=e.responses}},cy=`AI_NoSuchToolError`,ly=`vercel.ai.error.${cy}`,uy=Symbol.for(ly),dy,fy=class extends a{constructor({toolName:e,availableTools:t=void 0,message:n=`Model tried to call unavailable tool '${e}'. ${t===void 0?`No tools are available.`:`Available tools: ${t.join(`, `)}.`}`}){super({name:cy,message:n}),this[dy]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return a.hasMarker(e,ly)}};dy=uy;var py=`AI_ToolCallRepairError`,my=`vercel.ai.error.${py}`,hy=Symbol.for(my),gy,_y=class extends a{constructor({cause:e,originalError:t,message:n=`Error repairing tool call: ${v(e)}`}){super({name:py,message:n,cause:e}),this[gy]=!0,this.originalError=t}static isInstance(e){return a.hasMarker(e,my)}};gy=hy;var vy=class extends a{constructor(e){super({name:`AI_UnsupportedModelVersionError`,message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},yy=`AI_InvalidDataContentError`,by=`vercel.ai.error.${yy}`,xy=Symbol.for(by),Sy,Cy=class extends a{constructor({content:e,cause:t,message:n=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:yy,message:n,cause:t}),this[Sy]=!0,this.content=e}static isInstance(e){return a.hasMarker(e,by)}};Sy=xy;var wy=`AI_InvalidMessageRoleError`,Ty=`vercel.ai.error.${wy}`,Ey=Symbol.for(Ty),Dy,Oy=class extends a{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:wy,message:t}),this[Dy]=!0,this.role=e}static isInstance(e){return a.hasMarker(e,Ty)}};Dy=Ey;var ky=`AI_MessageConversionError`,Ay=`vercel.ai.error.${ky}`,jy=Symbol.for(Ay),My,Ny=class extends a{constructor({originalMessage:e,message:t}){super({name:ky,message:t}),this[My]=!0,this.originalMessage=e}static isInstance(e){return a.hasMarker(e,Ay)}};My=jy;var Py=`AI_RetryError`,Fy=`vercel.ai.error.${Py}`,Iy=Symbol.for(Fy),Ly,Ry=class extends a{constructor({message:e,reason:t,errors:n}){super({name:Py,message:e}),this[Ly]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return a.hasMarker(e,Fy)}};Ly=Iy;function zy({warning:e,provider:t,model:n}){let r=`AI SDK Warning (${t} / ${n}):`;switch(e.type){case`unsupported`:{let t=`${r} The feature "${e.feature}" is not supported.`;return e.details&&(t+=` ${e.details}`),t}case`compatibility`:{let t=`${r} The feature "${e.feature}" is used in a compatibility mode.`;return e.details&&(t+=` ${e.details}`),t}case`other`:return`${r} ${e.message}`;default:return`${r} ${JSON.stringify(e,null,2)}`}}var By=`AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.`,Vy=!1,Hy=e=>{if(e.warnings.length===0)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t==`function`){t(e);return}Vy||(Vy=!0,console.info(By));for(let t of e.warnings)console.warn(zy({warning:t,provider:e.provider,model:e.model}))}};function Uy({provider:e,modelId:t}){Hy({warnings:[{type:`compatibility`,feature:`specificationVersion`,details:`Using v2 specification compatibility mode. Some features may not be available.`}],provider:e,model:t})}function Wy(e){return e.specificationVersion===`v3`?e:(Uy({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function Gy(e){return e.specificationVersion===`v3`?e:(Uy({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function Ky(e){return e.specificationVersion===`v3`?e:(Uy({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){switch(t){case`specificationVersion`:return`v3`;case`doGenerate`:return async(...t)=>{let n=await e.doGenerate(...t);return{...n,finishReason:Jy(n.finishReason),usage:Yy(n.usage)}};case`doStream`:return async(...t)=>{let n=await e.doStream(...t);return{...n,stream:qy(n.stream)}};default:return e[t]}}}))}function qy(e){return e.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case`finish`:t.enqueue({...e,finishReason:Jy(e.finishReason),usage:Yy(e.usage)});break;default:t.enqueue(e);break}}}))}function Jy(e){return{unified:e===`unknown`?`other`:e,raw:void 0}}function Yy(e){return{inputTokens:{total:e.inputTokens,noCache:void 0,cacheRead:e.cachedInputTokens,cacheWrite:void 0},outputTokens:{total:e.outputTokens,text:void 0,reasoning:e.reasoningTokens}}}function Xy(e){return e.specificationVersion===`v3`?e:(Uy({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function Zy(e){return e.specificationVersion===`v3`?e:(Uy({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){return t===`specificationVersion`?`v3`:e[t]}}))}function Qy(e){if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new vy({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return Ky(e)}return rb().languageModel(e)}function $y(e){if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new vy({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return Wy(e)}return rb().embeddingModel(e)}function eb(e){var t;if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new vy({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return Zy(e)}return(t=rb()).transcriptionModel?.call(t,e)}function tb(e){var t;if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new vy({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return Xy(e)}return(t=rb()).speechModel?.call(t,e)}function nb(e){if(typeof e!=`string`){if(e.specificationVersion!==`v3`&&e.specificationVersion!==`v2`){let t=e;throw new vy({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return Gy(e)}return rb().imageModel(e)}function rb(){return globalThis.AI_SDK_DEFAULT_PROVIDER??f_}var ib=[{mediaType:`image/gif`,bytesPrefix:[71,73,70]},{mediaType:`image/png`,bytesPrefix:[137,80,78,71]},{mediaType:`image/jpeg`,bytesPrefix:[255,216]},{mediaType:`image/webp`,bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:`image/bmp`,bytesPrefix:[66,77]},{mediaType:`image/tiff`,bytesPrefix:[73,73,42,0]},{mediaType:`image/tiff`,bytesPrefix:[77,77,0,42]},{mediaType:`image/avif`,bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:`image/heic`,bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],ab=[{mediaType:`audio/mpeg`,bytesPrefix:[255,251]},{mediaType:`audio/mpeg`,bytesPrefix:[255,250]},{mediaType:`audio/mpeg`,bytesPrefix:[255,243]},{mediaType:`audio/mpeg`,bytesPrefix:[255,242]},{mediaType:`audio/mpeg`,bytesPrefix:[255,227]},{mediaType:`audio/mpeg`,bytesPrefix:[255,226]},{mediaType:`audio/wav`,bytesPrefix:[82,73,70,70,null,null,null,null,87,65,86,69]},{mediaType:`audio/ogg`,bytesPrefix:[79,103,103,83]},{mediaType:`audio/flac`,bytesPrefix:[102,76,97,67]},{mediaType:`audio/aac`,bytesPrefix:[64,21,0,0]},{mediaType:`audio/mp4`,bytesPrefix:[102,116,121,112]},{mediaType:`audio/webm`,bytesPrefix:[26,69,223,163]}],ob=e=>{let t=typeof e==`string`?ru(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)};function sb(e){return typeof e==`string`&&e.startsWith(`SUQz`)||typeof e!=`string`&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?ob(e):e}function cb({data:e,signatures:t}){let n=sb(e),r=typeof n==`string`?ru(n.substring(0,Math.min(n.length,24))):n;for(let e of t)if(r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>e===null||r[t]===e))return e.mediaType}var lb=`6.0.5`,ub=async({url:e})=>{let t=e.toString();try{let e=await fetch(t,{headers:Su({},`ai-sdk/${lb}`,bu())});if(!e.ok)throw new fu({url:t,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:e.headers.get(`content-type`)??void 0}}catch(e){throw fu.isInstance(e)?e:new fu({url:t,cause:e})}},db=(e=ub)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t)));function fb(e){try{let[t,n]=e.split(`,`);return{mediaType:t.split(`;`)[0].split(`:`)[1],base64Content:n}}catch{return{mediaType:void 0,base64Content:void 0}}}var pb=R([j(),gc(Uint8Array),gc(ArrayBuffer),pc(e=>globalThis.Buffer?.isBuffer(e)??!1,{message:`Must be a Buffer`})]);function mb(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e==`string`)try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol===`data:`){let{mediaType:t,base64Content:n}=fb(e.toString());if(t==null||n==null)throw new a({name:`InvalidDataContentError`,message:`Invalid data URL format in content ${e.toString()}`});return{data:n,mediaType:t}}return{data:e,mediaType:void 0}}function hb(e){return typeof e==`string`?e:e instanceof ArrayBuffer?iu(new Uint8Array(e)):iu(e)}function gb(e){if(e instanceof Uint8Array)return e;if(typeof e==`string`)try{return ru(e)}catch(t){throw new Cy({message:`Invalid data content. Content string is not a base64-encoded media.`,content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Cy({content:e})}function _b(e){return e===void 0?[]:Array.isArray(e)?e:[e]}async function vb({prompt:e,supportedUrls:t,download:n=db()}){let r=await bb(e.messages,n,t),i=[...e.system==null?[]:typeof e.system==`string`?[{role:`system`,content:e.system}]:_b(e.system).map(e=>({role:`system`,content:e.content,providerOptions:e.providerOptions})),...e.messages.map(e=>yb({message:e,downloadedAssets:r}))],a=[];for(let e of i){if(e.role!==`tool`){a.push(e);continue}let t=a.at(-1);t?.role===`tool`?t.content.push(...e.content):a.push(e)}return a}function yb({message:e,downloadedAssets:t}){let n=e.role;switch(n){case`system`:return{role:`system`,content:e.content,providerOptions:e.providerOptions};case`user`:return typeof e.content==`string`?{role:`user`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`user`,content:e.content.map(e=>xb(e,t)).filter(e=>e.type!==`text`||e.text!==``),providerOptions:e.providerOptions};case`assistant`:return typeof e.content==`string`?{role:`assistant`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`assistant`,content:e.content.filter(e=>e.type!==`text`||e.text!==``||e.providerOptions!=null).filter(e=>e.type!==`tool-approval-request`).map(e=>{let t=e.providerOptions;switch(e.type){case`file`:{let{data:n,mediaType:r}=mb(e.data);return{type:`file`,data:n,filename:e.filename,mediaType:r??e.mediaType,providerOptions:t}}case`reasoning`:return{type:`reasoning`,text:e.text,providerOptions:t};case`text`:return{type:`text`,text:e.text,providerOptions:t};case`tool-call`:return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:Sb(e.output),providerOptions:t}}}),providerOptions:e.providerOptions};case`tool`:return{role:`tool`,content:e.content.filter(e=>e.type!==`tool-approval-response`||e.providerExecuted).map(e=>{switch(e.type){case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:Sb(e.output),providerOptions:e.providerOptions};case`tool-approval-response`:return{type:`tool-approval-response`,approvalId:e.approvalId,approved:e.approved,reason:e.reason}}}),providerOptions:e.providerOptions};default:throw new Oy({role:n})}}async function bb(e,t,n){let r=e.filter(e=>e.role===`user`).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>e.type===`image`||e.type===`file`).map(e=>{let t=e.mediaType??(e.type===`image`?`image/*`:void 0),n=e.type===`image`?e.image:e.data;if(typeof n==`string`)try{n=new URL(n)}catch{}return{mediaType:t,data:n}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:e.mediaType!=null&&Mu({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:n})})),i=await t(r);return Object.fromEntries(i.map((e,t)=>e==null?null:[r[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>e!=null))}function xb(e,t){if(e.type===`text`)return{type:`text`,text:e.text,providerOptions:e.providerOptions};let n,r=e.type;switch(r){case`image`:n=e.image;break;case`file`:n=e.data;break;default:throw Error(`Unsupported part type: ${r}`)}let{data:i,mediaType:a}=mb(n),o=a??e.mediaType,s=i;if(s instanceof URL){let e=t[s.toString()];e&&(s=e.data,o??=e.mediaType)}switch(r){case`image`:return(s instanceof Uint8Array||typeof s==`string`)&&(o=cb({data:s,signatures:ib})??o),{type:`file`,mediaType:o??`image/*`,filename:void 0,data:s,providerOptions:e.providerOptions};case`file`:if(o==null)throw Error(`Media type is missing for file part`);return{type:`file`,mediaType:o,filename:e.filename,data:s,providerOptions:e.providerOptions}}}function Sb(e){return e.type===`content`?{type:`content`,value:e.value.map(e=>e.type===`media`?e.mediaType.startsWith(`image/`)?{type:`image-data`,data:e.data,mediaType:e.mediaType}:{type:`file-data`,data:e.data,mediaType:e.mediaType}:e)}:e}async function Cb({toolCallId:e,input:t,output:n,tool:r,errorMode:i}){return i===`text`?{type:`error-text`,value:v(n)}:i===`json`?{type:`error-json`,value:wb(n)}:r?.toModelOutput?await r.toModelOutput({toolCallId:e,input:t,output:n}):typeof n==`string`?{type:`text`,value:n}:{type:`json`,value:wb(n)}}function wb(e){return e===void 0?null:e}function Tb({maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,seed:o,stopSequences:s}){if(e!=null){if(!Number.isInteger(e))throw new Tv({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be an integer`});if(e<1)throw new Tv({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be >= 1`})}if(t!=null&&typeof t!=`number`)throw new Tv({parameter:`temperature`,value:t,message:`temperature must be a number`});if(n!=null&&typeof n!=`number`)throw new Tv({parameter:`topP`,value:n,message:`topP must be a number`});if(r!=null&&typeof r!=`number`)throw new Tv({parameter:`topK`,value:r,message:`topK must be a number`});if(i!=null&&typeof i!=`number`)throw new Tv({parameter:`presencePenalty`,value:i,message:`presencePenalty must be a number`});if(a!=null&&typeof a!=`number`)throw new Tv({parameter:`frequencyPenalty`,value:a,message:`frequencyPenalty must be a number`});if(o!=null&&!Number.isInteger(o))throw new Tv({parameter:`seed`,value:o,message:`seed must be an integer`});return{maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,stopSequences:s,seed:o}}function Eb(e){return e!=null&&Object.keys(e).length>0}async function Db({tools:e,toolChoice:t,activeTools:n}){if(!Eb(e))return{tools:void 0,toolChoice:void 0};let r=n==null?Object.entries(e):Object.entries(e).filter(([e])=>n.includes(e)),i=[];for(let[e,t]of r){let n=t.type;switch(n){case void 0:case`dynamic`:case`function`:i.push({type:`function`,name:e,description:t.description,inputSchema:await Gd(t.inputSchema).jsonSchema,...t.inputExamples==null?{}:{inputExamples:t.inputExamples},providerOptions:t.providerOptions,...t.strict==null?{}:{strict:t.strict}});break;case`provider`:i.push({type:`provider`,name:e,id:t.id,args:t.args});break;default:{let e=n;throw Error(`Unsupported tool type: ${e}`)}}}return{tools:i,toolChoice:t==null?{type:`auto`}:typeof t==`string`?{type:t}:{type:`tool`,toolName:t.toolName}}}var Ob=dc(()=>R([Ts(),j(),M(),N(),Vs(j(),Ob.optional()),I(Ob)])),$=Vs(j(),Vs(j(),Ob.optional())),kb=L({type:V(`text`),text:j(),providerOptions:$.optional()}),Ab=L({type:V(`image`),image:R([pb,gc(URL)]),mediaType:j().optional(),providerOptions:$.optional()}),jb=L({type:V(`file`),data:R([pb,gc(URL)]),filename:j().optional(),mediaType:j(),providerOptions:$.optional()}),Mb=L({type:V(`reasoning`),text:j(),providerOptions:$.optional()}),Nb=L({type:V(`tool-call`),toolCallId:j(),toolName:j(),input:P(),providerOptions:$.optional(),providerExecuted:N().optional()}),Pb=z(`type`,[L({type:V(`text`),value:j(),providerOptions:$.optional()}),L({type:V(`json`),value:Ob,providerOptions:$.optional()}),L({type:V(`execution-denied`),reason:j().optional(),providerOptions:$.optional()}),L({type:V(`error-text`),value:j(),providerOptions:$.optional()}),L({type:V(`error-json`),value:Ob,providerOptions:$.optional()}),L({type:V(`content`),value:I(R([L({type:V(`text`),text:j(),providerOptions:$.optional()}),L({type:V(`media`),data:j(),mediaType:j()}),L({type:V(`file-data`),data:j(),mediaType:j(),filename:j().optional(),providerOptions:$.optional()}),L({type:V(`file-url`),url:j(),providerOptions:$.optional()}),L({type:V(`file-id`),fileId:R([j(),Vs(j(),j())]),providerOptions:$.optional()}),L({type:V(`image-data`),data:j(),mediaType:j(),providerOptions:$.optional()}),L({type:V(`image-url`),url:j(),providerOptions:$.optional()}),L({type:V(`image-file-id`),fileId:R([j(),Vs(j(),j())]),providerOptions:$.optional()}),L({type:V(`custom`),providerOptions:$.optional()})]))})]),Fb=L({type:V(`tool-result`),toolCallId:j(),toolName:j(),output:Pb,providerOptions:$.optional()}),Ib=L({type:V(`tool-approval-request`),approvalId:j(),toolCallId:j()}),Lb=L({type:V(`tool-approval-response`),approvalId:j(),approved:N(),reason:j().optional()}),Rb=L({role:V(`system`),content:j(),providerOptions:$.optional()}),zb=L({role:V(`user`),content:R([j(),I(R([kb,Ab,jb]))]),providerOptions:$.optional()}),Bb=L({role:V(`assistant`),content:R([j(),I(R([kb,jb,Mb,Nb,Fb,Ib]))]),providerOptions:$.optional()}),Vb=L({role:V(`tool`),content:I(R([Fb,Lb])),providerOptions:$.optional()}),Hb=R([Rb,zb,Bb,Vb]);async function Ub(e){if(e.prompt==null&&e.messages==null)throw new E({prompt:e,message:`prompt or messages must be defined`});if(e.prompt!=null&&e.messages!=null)throw new E({prompt:e,message:`prompt and messages cannot be defined at the same time`});if(e.system!=null&&typeof e.system!=`string`&&!_b(e.system).every(e=>typeof e==`object`&&!!e&&`role`in e&&e.role===`system`))throw new E({prompt:e,message:`system must be a string, SystemModelMessage, or array of SystemModelMessage`});let t;if(e.prompt!=null&&typeof e.prompt==`string`)t=[{role:`user`,content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new E({prompt:e,message:`prompt or messages must be defined`});if(t.length===0)throw new E({prompt:e,message:`messages must not be empty`});let n=await Zd({value:t,schema:I(Hb)});if(!n.success)throw new E({prompt:e,message:`The messages do not match the ModelMessage[] schema.`,cause:n.error});return{messages:t,system:e.system}}function Wb(e){if(!mg.isInstance(e))return e;let t=(process==null?void 0:`production`)===`production`,n=`https://ai-sdk.dev/unauthenticated-ai-gateway`;return t?new a({name:`GatewayError`,message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${n}`}):Object.assign(Error(`\x1B[1m\x1B[31mUnauthenticated request to AI Gateway.\x1B[0m

To authenticate, set the \x1B[33mAI_GATEWAY_API_KEY\x1B[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1B[34m${n}\x1B[0m

`),{name:`GatewayAuthenticationError`})}function Gb({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId==null?``:` ${t.functionId}`}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function Kb({model:e,settings:t,telemetry:n,headers:r}){return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,n])=>(e[`ai.settings.${t}`]=n,e),{}),...Object.entries(n?.metadata??{}).reduce((e,[t,n])=>(e[`ai.telemetry.metadata.${t}`]=n,e),{}),...Object.entries(r??{}).reduce((e,[t,n])=>(n!==void 0&&(e[`ai.request.headers.${t}`]=n),e),{})}}var qb={startSpan(){return Jb},startActiveSpan(e,t,n,r){if(typeof t==`function`)return t(Jb);if(typeof n==`function`)return n(Jb);if(typeof r==`function`)return r(Jb)}},Jb={spanContext(){return Yb},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Yb={traceId:``,spanId:``,traceFlags:0};function Xb({isEnabled:e=!1,tracer:t}={}){return e?t||vv.getTracer(`ai`):qb}async function Zb({name:e,tracer:t,attributes:n,fn:r,endWhenDone:i=!0}){return t.startActiveSpan(e,{attributes:await n},async e=>{try{let t=await r(e);return i&&e.end(),t}catch(t){try{Qb(e,t)}finally{e.end()}throw t}})}function Qb(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:gv.ERROR,message:t.message})):e.setStatus({code:gv.ERROR})}async function $b({telemetry:e,attributes:t}){if(e?.isEnabled!==!0)return{};let n={};for(let[r,i]of Object.entries(t))if(i!=null){if(typeof i==`object`&&`input`in i&&typeof i.input==`function`){if(e?.recordInputs===!1)continue;let t=await i.input();t!=null&&(n[r]=t);continue}if(typeof i==`object`&&`output`in i&&typeof i.output==`function`){if(e?.recordOutputs===!1)continue;let t=await i.output();t!=null&&(n[r]=t);continue}n[r]=i}return n}function ex(e){return JSON.stringify(e.map(e=>({...e,content:typeof e.content==`string`?e.content:e.content.map(e=>e.type===`file`?{...e,data:e.data instanceof Uint8Array?hb(e.data):e.data}:e)})))}function tx(e){return{inputTokens:e.inputTokens.total,inputTokenDetails:{noCacheTokens:e.inputTokens.noCache,cacheReadTokens:e.inputTokens.cacheRead,cacheWriteTokens:e.inputTokens.cacheWrite},outputTokens:e.outputTokens.total,outputTokenDetails:{textTokens:e.outputTokens.text,reasoningTokens:e.outputTokens.reasoning},totalTokens:ix(e.inputTokens.total,e.outputTokens.total),raw:e.raw,reasoningTokens:e.outputTokens.reasoning,cachedInputTokens:e.inputTokens.cacheRead}}function nx(){return{inputTokens:void 0,inputTokenDetails:{noCacheTokens:void 0,cacheReadTokens:void 0,cacheWriteTokens:void 0},outputTokens:void 0,outputTokenDetails:{textTokens:void 0,reasoningTokens:void 0},totalTokens:void 0,raw:void 0}}function rx(e,t){return{inputTokens:ix(e.inputTokens,t.inputTokens),inputTokenDetails:{noCacheTokens:ix(e.inputTokenDetails?.noCacheTokens,t.inputTokenDetails?.noCacheTokens),cacheReadTokens:ix(e.inputTokenDetails?.cacheReadTokens,t.inputTokenDetails?.cacheReadTokens),cacheWriteTokens:ix(e.inputTokenDetails?.cacheWriteTokens,t.inputTokenDetails?.cacheWriteTokens)},outputTokens:ix(e.outputTokens,t.outputTokens),outputTokenDetails:{textTokens:ix(e.outputTokenDetails?.textTokens,t.outputTokenDetails?.textTokens),reasoningTokens:ix(e.outputTokenDetails?.reasoningTokens,t.outputTokenDetails?.reasoningTokens)},totalTokens:ix(e.totalTokens,t.totalTokens),reasoningTokens:ix(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:ix(e.cachedInputTokens,t.cachedInputTokens)}}function ix(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function ax(e,t){return{inputTokens:ix(e.inputTokens,t.inputTokens),outputTokens:ix(e.outputTokens,t.outputTokens),totalTokens:ix(e.totalTokens,t.totalTokens)}}function ox(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;let n={...e};for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let i=t[r];if(i===void 0)continue;let a=r in e?e[r]:void 0,o=typeof i==`object`&&!!i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp),s=typeof a==`object`&&!!a&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp);o&&s?n[r]=ox(a,i):n[r]=i}return n}function sx({error:e,exponentialBackoffDelay:t}){let n=e.responseHeaders;if(!n)return t;let r,i=n[`retry-after-ms`];if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n[`retry-after`];if(a&&r===void 0){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():e*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<t)?r:t}var cx=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2,abortSignal:r}={})=>async i=>lx(i,{maxRetries:e,delayInMs:t,backoffFactor:n,abortSignal:r});async function lx(e,{maxRetries:t,delayInMs:n,backoffFactor:r,abortSignal:i},a=[]){try{return await e()}catch(o){if(_u(o)||t===0)throw o;let s=gu(o),c=[...a,o],l=c.length;if(l>t)throw new Ry({message:`Failed after ${l} attempts. Last error: ${s}`,reason:`maxRetriesExceeded`,errors:c});if(o instanceof Error&&d.isInstance(o)&&o.isRetryable===!0&&l<=t)return await Zl(sx({error:o,exponentialBackoffDelay:n}),{abortSignal:i}),lx(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r,abortSignal:i},c);throw l===1?o:new Ry({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:`errorNotRetryable`,errors:c})}}function ux({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new Tv({parameter:`maxRetries`,value:e,message:`maxRetries must be an integer`});if(e<0)throw new Tv({parameter:`maxRetries`,value:e,message:`maxRetries must be >= 0`})}let n=e??2;return{maxRetries:n,retry:cx({maxRetries:n,abortSignal:t})}}function dx({messages:e}){let t=e.at(-1);if(t?.role!=`tool`)return{approvedToolApprovals:[],deniedToolApprovals:[]};let n={};for(let t of e)if(t.role===`assistant`&&typeof t.content!=`string`){let e=t.content;for(let t of e)t.type===`tool-call`&&(n[t.toolCallId]=t)}let r={};for(let t of e)if(t.role===`assistant`&&typeof t.content!=`string`){let e=t.content;for(let t of e)t.type===`tool-approval-request`&&(r[t.approvalId]=t)}let i={};for(let e of t.content)e.type===`tool-result`&&(i[e.toolCallId]=e);let a=[],o=[],s=t.content.filter(e=>e.type===`tool-approval-response`);for(let e of s){let t=r[e.approvalId];if(t==null)throw new Fv({approvalId:e.approvalId});if(i[t.toolCallId]!=null)continue;let s=n[t.toolCallId];if(s==null)throw new Gv({toolCallId:t.toolCallId,approvalId:t.approvalId});let c={approvalRequest:t,approvalResponse:e,toolCall:s};e.approved?a.push(c):o.push(c)}return{approvedToolApprovals:a,deniedToolApprovals:o}}async function fx({toolCall:e,tools:t,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:o,onPreliminaryToolResult:s}){let{toolName:c,toolCallId:l,input:u}=e,d=t?.[c];if(d?.execute!=null)return Zb({name:`ai.toolCall`,attributes:$b({telemetry:r,attributes:{...Gb({operationId:`ai.toolCall`,telemetry:r}),"ai.toolCall.name":c,"ai.toolCall.id":l,"ai.toolCall.args":{output:()=>JSON.stringify(u)}}}),tracer:n,fn:async t=>{let n;try{let t=yf({execute:d.execute.bind(d),input:u,options:{toolCallId:l,messages:i,abortSignal:a,experimental_context:o}});for await(let r of t)r.type===`preliminary`?s?.({...e,type:`tool-result`,output:r.output,preliminary:!0}):n=r.output}catch(n){return Qb(t,n),{type:`tool-error`,toolCallId:l,toolName:c,input:u,error:n,dynamic:d.type===`dynamic`,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}}try{t.setAttributes(await $b({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(n)}}}))}catch{}return{type:`tool-result`,toolCallId:l,toolName:c,input:u,output:n,dynamic:d.type===`dynamic`,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}}})}function px(e){let t=e.filter(e=>e.type===`text`);if(t.length!==0)return t.map(e=>e.text).join(``)}var mx=class{constructor({data:e,mediaType:t}){let n=e instanceof Uint8Array;this.base64Data=n?void 0:e,this.uint8ArrayData=n?e:void 0,this.mediaType=t}get base64(){return this.base64Data??=iu(this.uint8ArrayData),this.base64Data}get uint8Array(){return this.uint8ArrayData??=ru(this.base64Data),this.uint8ArrayData}},hx=class extends mx{constructor(e){super(e),this.type=`file`}};async function gx({tool:e,toolCall:t,messages:n,experimental_context:r}){return e.needsApproval==null?!1:typeof e.needsApproval==`boolean`?e.needsApproval:await e.needsApproval(t.input,{toolCallId:t.toolCallId,messages:n,experimental_context:r})}var _x={};bv(_x,{array:()=>Sx,choice:()=>Cx,json:()=>wx,object:()=>xx,text:()=>bx});function vx(e){let t=[`ROOT`],n=-1,r=null;function i(e,i,a){switch(e){case`"`:n=i,t.pop(),t.push(a),t.push(`INSIDE_STRING`);break;case`f`:case`t`:case`n`:n=i,r=i,t.pop(),t.push(a),t.push(`INSIDE_LITERAL`);break;case`-`:t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=i,t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`{`:n=i,t.pop(),t.push(a),t.push(`INSIDE_OBJECT_START`);break;case`[`:n=i,t.pop(),t.push(a),t.push(`INSIDE_ARRAY_START`);break}}function a(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_COMMA`);break;case`}`:n=r,t.pop();break}}function o(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=r,t.pop();break}}for(let s=0;s<e.length;s++){let c=e[s];switch(t[t.length-1]){case`ROOT`:i(c,s,`FINISH`);break;case`INSIDE_OBJECT_START`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break;case`}`:n=s,t.pop();break}break;case`INSIDE_OBJECT_AFTER_COMMA`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break}break;case`INSIDE_OBJECT_KEY`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_KEY`);break}break;case`INSIDE_OBJECT_AFTER_KEY`:switch(c){case`:`:t.pop(),t.push(`INSIDE_OBJECT_BEFORE_VALUE`);break}break;case`INSIDE_OBJECT_BEFORE_VALUE`:i(c,s,`INSIDE_OBJECT_AFTER_VALUE`);break;case`INSIDE_OBJECT_AFTER_VALUE`:a(c,s);break;case`INSIDE_STRING`:switch(c){case`"`:t.pop(),n=s;break;case`\\`:t.push(`INSIDE_STRING_ESCAPE`);break;default:n=s}break;case`INSIDE_ARRAY_START`:switch(c){case`]`:n=s,t.pop();break;default:n=s,i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break}break;case`INSIDE_ARRAY_AFTER_VALUE`:switch(c){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=s,t.pop();break;default:n=s;break}break;case`INSIDE_ARRAY_AFTER_COMMA`:i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break;case`INSIDE_STRING_ESCAPE`:t.pop(),n=s;break;case`INSIDE_NUMBER`:switch(c){case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=s;break;case`e`:case`E`:case`-`:case`.`:break;case`,`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`}`:t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`]`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s);break;default:t.pop();break}break;case`INSIDE_LITERAL`:{let i=e.substring(r,s+1);!`false`.startsWith(i)&&!`true`.startsWith(i)&&!`null`.startsWith(i)?(t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`?a(c,s):t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s)):n=s;break}}}let s=e.slice(0,n+1);for(let n=t.length-1;n>=0;n--)switch(t[n]){case`INSIDE_STRING`:s+=`"`;break;case`INSIDE_OBJECT_KEY`:case`INSIDE_OBJECT_AFTER_KEY`:case`INSIDE_OBJECT_AFTER_COMMA`:case`INSIDE_OBJECT_START`:case`INSIDE_OBJECT_BEFORE_VALUE`:case`INSIDE_OBJECT_AFTER_VALUE`:s+=`}`;break;case`INSIDE_ARRAY_START`:case`INSIDE_ARRAY_AFTER_COMMA`:case`INSIDE_ARRAY_AFTER_VALUE`:s+=`]`;break;case`INSIDE_LITERAL`:{let t=e.substring(r,e.length);`true`.startsWith(t)?s+=`true`.slice(t.length):`false`.startsWith(t)?s+=`false`.slice(t.length):`null`.startsWith(t)&&(s+=`null`.slice(t.length))}}return s}async function yx(e){if(e===void 0)return{value:void 0,state:`undefined-input`};let t=await $d({text:e});return t.success?{value:t.value,state:`successful-parse`}:(t=await $d({text:vx(e)}),t.success?{value:t.value,state:`repaired-parse`}:{value:void 0,state:`failed-parse`})}var bx=()=>({responseFormat:Promise.resolve({type:`text`}),async parseCompleteOutput({text:e}){return e},async parsePartialOutput({text:e}){return{partial:e}}}),xx=({schema:e,name:t,description:n})=>{let r=Gd(e);return{responseFormat:ff(r.jsonSchema).then(e=>({type:`json`,schema:e,...t!=null&&{name:t},...n!=null&&{description:n}})),async parseCompleteOutput({text:e},t){let n=await $d({text:e});if(!n.success)throw new ty({message:`No object generated: could not parse the response.`,cause:n.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let i=await Zd({value:n.value,schema:r});if(!i.success)throw new ty({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return i.value},async parsePartialOutput({text:e}){let t=await yx(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:return{partial:t.value}}}}},Sx=({element:e,name:t,description:n})=>{let r=Gd(e);return{responseFormat:ff(r.jsonSchema).then(e=>{let{$schema:r,...i}=e;return{type:`json`,schema:{$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{elements:{type:`array`,items:i}},required:[`elements`],additionalProperties:!1},...t!=null&&{name:t},...n!=null&&{description:n}}}),async parseCompleteOutput({text:e},t){let n=await $d({text:e});if(!n.success)throw new ty({message:`No object generated: could not parse the response.`,cause:n.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let i=n.value;if(typeof i!=`object`||!i||!(`elements`in i)||!Array.isArray(i.elements))throw new ty({message:`No object generated: response did not match schema.`,cause:new Xe({value:i,cause:`response must be an object with an elements array`}),text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});for(let n of i.elements){let i=await Zd({value:n,schema:r});if(!i.success)throw new ty({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason})}return i.elements},async parsePartialOutput({text:e}){let t=await yx(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:{let e=t.value;if(typeof e!=`object`||!e||!(`elements`in e)||!Array.isArray(e.elements))return;let n=t.state===`repaired-parse`&&e.elements.length>0?e.elements.slice(0,-1):e.elements,i=[];for(let e of n){let t=await Zd({value:e,schema:r});t.success&&i.push(t.value)}return{partial:i}}}}}},Cx=({options:e,name:t,description:n})=>({responseFormat:Promise.resolve({type:`json`,schema:{$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{result:{type:`string`,enum:e}},required:[`result`],additionalProperties:!1},...t!=null&&{name:t},...n!=null&&{description:n}}),async parseCompleteOutput({text:t},n){let r=await $d({text:t});if(!r.success)throw new ty({message:`No object generated: could not parse the response.`,cause:r.error,text:t,response:n.response,usage:n.usage,finishReason:n.finishReason});let i=r.value;if(typeof i!=`object`||!i||!(`result`in i)||typeof i.result!=`string`||!e.includes(i.result))throw new ty({message:`No object generated: response did not match schema.`,cause:new Xe({value:i,cause:`response must be an object that contains a choice value.`}),text:t,response:n.response,usage:n.usage,finishReason:n.finishReason});return i.result},async parsePartialOutput({text:t}){let n=await yx(t);switch(n.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:{let t=n.value;if(typeof t!=`object`||!t||!(`result`in t)||typeof t.result!=`string`)return;let r=e.filter(e=>e.startsWith(t.result));return n.state===`successful-parse`?r.includes(t.result)?{partial:t.result}:void 0:r.length===1?{partial:r[0]}:void 0}}}}),wx=({name:e,description:t}={})=>({responseFormat:Promise.resolve({type:`json`,...e!=null&&{name:e},...t!=null&&{description:t}}),async parseCompleteOutput({text:e},t){let n=await $d({text:e});if(!n.success)throw new ty({message:`No object generated: could not parse the response.`,cause:n.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return n.value},async parsePartialOutput({text:e}){let t=await yx(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:return t.value===void 0?void 0:{partial:t.value}}}});async function Tx({toolCall:e,tools:t,repairToolCall:n,system:r,messages:i}){try{if(t==null){if(e.providerExecuted&&e.dynamic)return await Ex(e);throw new fy({toolName:e.toolName})}try{return await Dx({toolCall:e,tools:t})}catch(a){if(n==null||!(fy.isInstance(a)||Bv.isInstance(a)))throw a;let o=null;try{o=await n({toolCall:e,tools:t,inputSchema:async({toolName:e})=>{let{inputSchema:n}=t[e];return await Gd(n).jsonSchema},system:r,messages:i,error:a})}catch(e){throw new _y({cause:e,originalError:a})}if(o==null)throw a;return await Dx({toolCall:o,tools:t})}}catch(n){let r=await $d({text:e.input}),i=r.success?r.value:e.input;return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:i,dynamic:!0,invalid:!0,error:n,title:t?.[e.toolName]?.title,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}}async function Ex(e){let t=e.input.trim()===``?{success:!0,value:{}}:await $d({text:e.input});if(t.success===!1)throw new Bv({toolName:e.toolName,toolInput:e.input,cause:t.error});return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:t.value,providerExecuted:!0,dynamic:!0,providerMetadata:e.providerMetadata}}async function Dx({toolCall:e,tools:t}){let n=e.toolName,r=t[n];if(r==null){if(e.providerExecuted&&e.dynamic)return await Ex(e);throw new fy({toolName:e.toolName,availableTools:Object.keys(t)})}let i=Gd(r.inputSchema),a=e.input.trim()===``?await Zd({value:{},schema:i}):await $d({text:e.input,schema:i});if(a.success===!1)throw new Bv({toolName:n,toolInput:e.input,cause:a.error});return r.type===`dynamic`?{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0,title:r.title}:{type:`tool-call`,toolCallId:e.toolCallId,toolName:n,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:r.title}}var Ox=class{constructor({content:e,finishReason:t,rawFinishReason:n,usage:r,warnings:i,request:a,response:o,providerMetadata:s}){this.content=e,this.finishReason=t,this.rawFinishReason=n,this.usage=r,this.warnings=i,this.request=a,this.response=o,this.providerMetadata=s}get text(){return this.content.filter(e=>e.type===`text`).map(e=>e.text).join(``)}get reasoning(){return this.content.filter(e=>e.type===`reasoning`)}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join(``)}get files(){return this.content.filter(e=>e.type===`file`).map(e=>e.file)}get sources(){return this.content.filter(e=>e.type===`source`)}get toolCalls(){return this.content.filter(e=>e.type===`tool-call`)}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type===`tool-result`)}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function kx(e){return({steps:t})=>t.length===e}function Ax(e){return({steps:t})=>(t[t.length-1]?.toolCalls)?.some(t=>t.toolName===e)??!1}async function jx({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}async function Mx({content:e,tools:t}){let n=[],r=[];for(let n of e)if(n.type!==`source`&&!((n.type===`tool-result`||n.type===`tool-error`)&&!n.providerExecuted)&&!(n.type===`text`&&n.text.length===0))switch(n.type){case`text`:r.push({type:`text`,text:n.text,providerOptions:n.providerMetadata});break;case`reasoning`:r.push({type:`reasoning`,text:n.text,providerOptions:n.providerMetadata});break;case`file`:r.push({type:`file`,data:n.file.base64,mediaType:n.file.mediaType,providerOptions:n.providerMetadata});break;case`tool-call`:r.push({type:`tool-call`,toolCallId:n.toolCallId,toolName:n.toolName,input:n.input,providerExecuted:n.providerExecuted,providerOptions:n.providerMetadata});break;case`tool-result`:{let e=await Cb({toolCallId:n.toolCallId,input:n.input,tool:t?.[n.toolName],output:n.output,errorMode:`none`});r.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,output:e,providerOptions:n.providerMetadata});break}case`tool-error`:{let e=await Cb({toolCallId:n.toolCallId,input:n.input,tool:t?.[n.toolName],output:n.error,errorMode:`json`});r.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,output:e,providerOptions:n.providerMetadata});break}case`tool-approval-request`:r.push({type:`tool-approval-request`,approvalId:n.approvalId,toolCallId:n.toolCall.toolCallId});break}r.length>0&&n.push({role:`assistant`,content:r});let i=[];for(let n of e){if(!(n.type===`tool-result`||n.type===`tool-error`)||n.providerExecuted)continue;let e=await Cb({toolCallId:n.toolCallId,input:n.input,tool:t?.[n.toolName],output:n.type===`tool-result`?n.output:n.error,errorMode:n.type===`tool-error`?`text`:`none`});i.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,output:e,...n.providerMetadata==null?{}:{providerOptions:n.providerMetadata}})}return i.length>0&&n.push({role:`tool`,content:i}),n}var Nx=mu({prefix:`aitxt`,size:24});async function Px({model:e,tools:t,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,stopWhen:l=kx(1),experimental_output:u,output:d=u,experimental_telemetry:f,providerOptions:p,experimental_activeTools:m,activeTools:h=m,experimental_prepareStep:g,prepareStep:_=g,experimental_repairToolCall:v,experimental_download:y,experimental_context:b,_internal:{generateId:x=Nx,currentDate:S=()=>new Date}={},onStepFinish:C,onFinish:w,...T}){let ee=Qy(e),te=_b(l),{maxRetries:ne,retry:re}=ux({maxRetries:o,abortSignal:s}),E=Tb(T),ie=Su(c??{},`ai/${lb}`),ae=Kb({model:ee,telemetry:f,headers:ie,settings:{...E,maxRetries:ne}}),oe=await Ub({system:r,prompt:i,messages:a}),se=Xb(f);try{return await Zb({name:`ai.generateText`,attributes:$b({telemetry:f,attributes:{...Gb({operationId:`ai.generateText`,telemetry:f}),...ae,"ai.model.provider":ee.provider,"ai.model.id":ee.modelId,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:i,messages:a})}}}),tracer:se,fn:async e=>{let i=oe.messages,a=[],{approvedToolApprovals:o,deniedToolApprovals:c}=dx({messages:i}),l=o.filter(e=>!e.toolCall.providerExecuted);if(c.length>0||l.length>0){let e=await Fx({toolCalls:l.map(e=>e.toolCall),tools:t,tracer:se,telemetry:f,messages:i,abortSignal:s,experimental_context:b}),n=[];for(let r of e){let e=await Cb({toolCallId:r.toolCallId,input:r.input,tool:t?.[r.toolName],output:r.type===`tool-result`?r.output:r.error,errorMode:r.type===`tool-error`?`json`:`none`});n.push({type:`tool-result`,toolCallId:r.toolCallId,toolName:r.toolName,output:e})}for(let e of c)n.push({type:`tool-result`,toolCallId:e.toolCall.toolCallId,toolName:e.toolCall.toolName,output:{type:`execution-denied`,reason:e.approvalResponse.reason,...e.toolCall.providerExecuted&&{providerOptions:{openai:{approvalId:e.approvalResponse.approvalId}}}}});a.push({role:`tool`,content:n})}let u=[...o,...c].filter(e=>e.toolCall.providerExecuted);u.length>0&&a.push({role:`tool`,content:u.map(e=>({type:`tool-approval-response`,approvalId:e.approvalResponse.approvalId,approved:e.approvalResponse.approved,reason:e.approvalResponse.reason,providerExecuted:!0}))});let m=Tb(T),g,ne=[],E=[],ce=[],le=new Map;do{let e=[...i,...a],o=await _?.({model:ee,steps:ce,stepNumber:ce.length,messages:e,experimental_context:b}),c=Qy(o?.model??ee),l=await vb({prompt:{system:o?.system??oe.system,messages:o?.messages??e},supportedUrls:await c.supportedUrls,download:y});b=o?.experimental_context??b;let{toolChoice:u,tools:w}=await Db({tools:t,toolChoice:o?.toolChoice??n,activeTools:o?.activeTools??h});g=await re(()=>Zb({name:`ai.generateText.doGenerate`,attributes:$b({telemetry:f,attributes:{...Gb({operationId:`ai.generateText.doGenerate`,telemetry:f}),...ae,"ai.model.provider":c.provider,"ai.model.id":c.modelId,"ai.prompt.messages":{input:()=>ex(l)},"ai.prompt.tools":{input:()=>w?.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>u==null?void 0:JSON.stringify(u)},"gen_ai.system":c.provider,"gen_ai.request.model":c.modelId,"gen_ai.request.frequency_penalty":T.frequencyPenalty,"gen_ai.request.max_tokens":T.maxOutputTokens,"gen_ai.request.presence_penalty":T.presencePenalty,"gen_ai.request.stop_sequences":T.stopSequences,"gen_ai.request.temperature":T.temperature??void 0,"gen_ai.request.top_k":T.topK,"gen_ai.request.top_p":T.topP}}),tracer:se,fn:async e=>{let t=ox(p,o?.providerOptions),n=await c.doGenerate({...m,tools:w,toolChoice:u,responseFormat:await d?.responseFormat,prompt:l,providerOptions:t,abortSignal:s,headers:ie}),r={id:n.response?.id??x(),timestamp:n.response?.timestamp??S(),modelId:n.response?.modelId??c.modelId,headers:n.response?.headers,body:n.response?.body};return e.setAttributes(await $b({telemetry:f,attributes:{"ai.response.finishReason":n.finishReason.unified,"ai.response.text":{output:()=>px(n.content)},"ai.response.toolCalls":{output:()=>{let e=Lx(n.content);return e==null?void 0:JSON.stringify(e)}},"ai.response.id":r.id,"ai.response.model":r.modelId,"ai.response.timestamp":r.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(n.providerMetadata),"ai.usage.promptTokens":n.usage.inputTokens.total,"ai.usage.completionTokens":n.usage.outputTokens.total,"gen_ai.response.finish_reasons":[n.finishReason.unified],"gen_ai.response.id":r.id,"gen_ai.response.model":r.modelId,"gen_ai.usage.input_tokens":n.usage.inputTokens.total,"gen_ai.usage.output_tokens":n.usage.outputTokens.total}})),{...n,response:r}}}));let te=await Promise.all(g.content.filter(e=>e.type===`tool-call`).map(n=>Tx({toolCall:n,tools:t,repairToolCall:v,system:r,messages:e}))),D={};for(let n of te){if(n.invalid)continue;let r=t?.[n.toolName];r!=null&&(r?.onInputAvailable!=null&&await r.onInputAvailable({input:n.input,toolCallId:n.toolCallId,messages:e,abortSignal:s,experimental_context:b}),await gx({tool:r,toolCall:n,messages:e,experimental_context:b})&&(D[n.toolCallId]={type:`tool-approval-request`,approvalId:x(),toolCall:n}))}let ue=te.filter(e=>e.invalid&&e.dynamic);E=[];for(let e of ue)E.push({type:`tool-error`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,error:gu(e.error),dynamic:!0});ne=te.filter(e=>!e.providerExecuted),t!=null&&E.push(...await Fx({toolCalls:ne.filter(e=>!e.invalid&&D[e.toolCallId]==null),tools:t,tracer:se,telemetry:f,messages:e,abortSignal:s,experimental_context:b}));for(let e of te){if(!e.providerExecuted)continue;let n=t?.[e.toolName];n?.type===`provider`&&n.supportsDeferredResults&&(g.content.some(t=>t.type===`tool-result`&&t.toolCallId===e.toolCallId)||le.set(e.toolCallId,{toolName:e.toolName}))}for(let e of g.content)e.type===`tool-result`&&le.delete(e.toolCallId);let de=Rx({content:g.content,toolCalls:te,toolOutputs:E,toolApprovalRequests:Object.values(D),tools:t});a.push(...await Mx({content:de,tools:t}));let fe=new Ox({content:de,finishReason:g.finishReason.unified,rawFinishReason:g.finishReason.raw,usage:tx(g.usage),warnings:g.warnings,providerMetadata:g.providerMetadata,request:g.request??{},response:{...g.response,messages:structuredClone(a)}});Hy({warnings:g.warnings??[],provider:c.provider,model:c.modelId}),ce.push(fe),await C?.(fe)}while((ne.length>0&&E.length===ne.length||le.size>0)&&!await jx({stopConditions:te,steps:ce}));e.setAttributes(await $b({telemetry:f,attributes:{"ai.response.finishReason":g.finishReason.unified,"ai.response.text":{output:()=>px(g.content)},"ai.response.toolCalls":{output:()=>{let e=Lx(g.content);return e==null?void 0:JSON.stringify(e)}},"ai.response.providerMetadata":JSON.stringify(g.providerMetadata),"ai.usage.promptTokens":g.usage.inputTokens.total,"ai.usage.completionTokens":g.usage.outputTokens.total}}));let D=ce[ce.length-1],ue=ce.reduce((e,t)=>rx(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0});await w?.({finishReason:D.finishReason,rawFinishReason:D.rawFinishReason,usage:D.usage,content:D.content,text:D.text,reasoningText:D.reasoningText,reasoning:D.reasoning,files:D.files,sources:D.sources,toolCalls:D.toolCalls,staticToolCalls:D.staticToolCalls,dynamicToolCalls:D.dynamicToolCalls,toolResults:D.toolResults,staticToolResults:D.staticToolResults,dynamicToolResults:D.dynamicToolResults,request:D.request,response:D.response,warnings:D.warnings,providerMetadata:D.providerMetadata,steps:ce,totalUsage:ue,experimental_context:b});let de;return D.finishReason===`stop`&&(de=await(d??bx()).parseCompleteOutput({text:D.text},{response:D.response,usage:D.usage,finishReason:D.finishReason})),new Ix({steps:ce,totalUsage:ue,output:de})}})}catch(e){throw Wb(e)}}async function Fx({toolCalls:e,tools:t,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:o}){return(await Promise.all(e.map(async e=>fx({toolCall:e,tools:t,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:o})))).filter(e=>e!=null)}var Ix=class{constructor(e){this.steps=e.steps,this._output=e.output,this.totalUsage=e.totalUsage}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get rawFinishReason(){return this.finalStep.rawFinishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get experimental_output(){return this.output}get output(){if(this._output==null)throw new oy;return this._output}};function Lx(e){let t=e.filter(e=>e.type===`tool-call`);if(t.length!==0)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function Rx({content:e,toolCalls:t,toolOutputs:n,toolApprovalRequests:r,tools:i}){let a=[];for(let n of e)switch(n.type){case`text`:case`reasoning`:case`source`:a.push(n);break;case`file`:a.push({type:`file`,file:new mx(n),...n.providerMetadata==null?{}:{providerMetadata:n.providerMetadata}});break;case`tool-call`:a.push(t.find(e=>e.toolCallId===n.toolCallId));break;case`tool-result`:{let e=t.find(e=>e.toolCallId===n.toolCallId);if(e==null){let e=i?.[n.toolName];if(!(e?.type===`provider`&&e.supportsDeferredResults))throw Error(`Tool call ${n.toolCallId} not found.`);n.isError?a.push({type:`tool-error`,toolCallId:n.toolCallId,toolName:n.toolName,input:void 0,error:n.result,providerExecuted:!0,dynamic:n.dynamic}):a.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,input:void 0,output:n.result,providerExecuted:!0,dynamic:n.dynamic});break}n.isError?a.push({type:`tool-error`,toolCallId:n.toolCallId,toolName:n.toolName,input:e.input,error:n.result,providerExecuted:!0,dynamic:e.dynamic}):a.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:n.toolName,input:e.input,output:n.result,providerExecuted:!0,dynamic:e.dynamic});break}case`tool-approval-request`:{let e=t.find(e=>e.toolCallId===n.toolCallId);if(e==null)throw new Gv({toolCallId:n.toolCallId,approvalId:n.approvalId});a.push({type:`tool-approval-request`,approvalId:n.approvalId,toolCall:e});break}}return[...a,...n,...r]}function zx(e,t){let n=new Headers(e??{});for(let[e,r]of Object.entries(t))n.has(e)||n.set(e,r);return n}function Bx({status:e,statusText:t,headers:n,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:zx(n,{"content-type":`text/plain; charset=utf-8`})})}function Vx({response:e,status:t,statusText:n,headers:r,stream:i}){let a=t??200;n===void 0?e.writeHead(a,r):e.writeHead(a,n,r);let o=i.getReader();(async()=>{try{for(;;){let{done:t,value:n}=await o.read();if(t)break;e.write(n)||await new Promise(t=>{e.once(`drain`,t)})}}catch(e){throw e}finally{e.end()}})()}function Hx({response:e,status:t,statusText:n,headers:r,textStream:i}){Vx({response:e,status:t,statusText:n,headers:Object.fromEntries(zx(r,{"content-type":`text/plain; charset=utf-8`}).entries()),stream:i.pipeThrough(new TextEncoderStream)})}var Ux=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},Wx={"content-type":`text/event-stream`,"cache-control":`no-cache`,connection:`keep-alive`,"x-vercel-ai-ui-message-stream":`v1`,"x-accel-buffering":`no`};function Gx({status:e,statusText:t,headers:n,stream:r,consumeSseStream:i}){let a=r.pipeThrough(new Ux);if(i){let[e,t]=a.tee();a=e,i({stream:t})}return new Response(a.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:zx(n,Wx)})}function Kx({originalMessages:e,responseMessageId:t}){if(e==null)return;let n=e[e.length-1];return n?.role===`assistant`?n.id:typeof t==`function`?t():t}var qx=Z(()=>Q(R([Ms({type:V(`text-start`),id:j(),providerMetadata:$.optional()}),Ms({type:V(`text-delta`),id:j(),delta:j(),providerMetadata:$.optional()}),Ms({type:V(`text-end`),id:j(),providerMetadata:$.optional()}),Ms({type:V(`error`),errorText:j()}),Ms({type:V(`tool-input-start`),toolCallId:j(),toolName:j(),providerExecuted:N().optional(),dynamic:N().optional(),title:j().optional()}),Ms({type:V(`tool-input-delta`),toolCallId:j(),inputTextDelta:j()}),Ms({type:V(`tool-input-available`),toolCallId:j(),toolName:j(),input:P(),providerExecuted:N().optional(),providerMetadata:$.optional(),dynamic:N().optional(),title:j().optional()}),Ms({type:V(`tool-input-error`),toolCallId:j(),toolName:j(),input:P(),providerExecuted:N().optional(),providerMetadata:$.optional(),dynamic:N().optional(),errorText:j(),title:j().optional()}),Ms({type:V(`tool-approval-request`),approvalId:j(),toolCallId:j()}),Ms({type:V(`tool-output-available`),toolCallId:j(),output:P(),providerExecuted:N().optional(),dynamic:N().optional(),preliminary:N().optional()}),Ms({type:V(`tool-output-error`),toolCallId:j(),errorText:j(),providerExecuted:N().optional(),dynamic:N().optional()}),Ms({type:V(`tool-output-denied`),toolCallId:j()}),Ms({type:V(`reasoning-start`),id:j(),providerMetadata:$.optional()}),Ms({type:V(`reasoning-delta`),id:j(),delta:j(),providerMetadata:$.optional()}),Ms({type:V(`reasoning-end`),id:j(),providerMetadata:$.optional()}),Ms({type:V(`source-url`),sourceId:j(),url:j(),title:j().optional(),providerMetadata:$.optional()}),Ms({type:V(`source-document`),sourceId:j(),mediaType:j(),title:j(),filename:j().optional(),providerMetadata:$.optional()}),Ms({type:V(`file`),url:j(),mediaType:j(),providerMetadata:$.optional()}),Ms({type:pc(e=>typeof e==`string`&&e.startsWith(`data-`),{message:`Type must start with "data-"`}),id:j().optional(),data:P(),transient:N().optional()}),Ms({type:V(`start-step`)}),Ms({type:V(`finish-step`)}),Ms({type:V(`start`),messageId:j().optional(),messageMetadata:P().optional()}),Ms({type:V(`finish`),finishReason:B([`stop`,`length`,`content-filter`,`tool-calls`,`error`,`other`]).optional(),messageMetadata:P().optional()}),Ms({type:V(`abort`)}),Ms({type:V(`message-metadata`),messageMetadata:P()})])));function Jx(e){return e.type.startsWith(`data-`)}function Yx(e){return e.type.startsWith(`data-`)}function Xx(e){return e.type===`text`}function Zx(e){return e.type===`file`}function Qx(e){return e.type===`reasoning`}function $x(e){return e.type.startsWith(`tool-`)}function eS(e){return e.type===`dynamic-tool`}function tS(e){return $x(e)||eS(e)}var nS=tS;function rS(e){return e.type.split(`-`).slice(1).join(`-`)}function iS(e){return eS(e)?e.toolName:rS(e)}var aS=iS;function oS({lastMessage:e,messageId:t}){return{message:e?.role===`assistant`?e:{id:t,metadata:void 0,role:`assistant`,parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function sS({stream:e,messageMetadataSchema:t,dataPartSchemas:n,runUpdateMessageJob:r,onError:i,onToolCall:a,onData:o}){return e.pipeThrough(new TransformStream({async transform(e,s){await r(async({state:r,write:c})=>{function l(e){let t=r.message.parts.filter(tS).find(t=>t.toolCallId===e);if(t==null)throw Error(`no tool invocation found for tool call ${e}`);return t}function u(e){let t=r.message.parts.find(t=>$x(t)&&t.toolCallId===e.toolCallId),n=e,i=t;t==null?r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,title:e.title,input:n.input,output:n.output,rawInput:n.rawInput,errorText:n.errorText,providerExecuted:n.providerExecuted,preliminary:n.preliminary,...n.providerMetadata==null?{}:{callProviderMetadata:n.providerMetadata}}):(t.state=e.state,i.input=n.input,i.output=n.output,i.errorText=n.errorText,i.rawInput=n.rawInput,i.preliminary=n.preliminary,e.title!==void 0&&(i.title=e.title),i.providerExecuted=n.providerExecuted??t.providerExecuted,n.providerMetadata!=null&&t.state===`input-available`&&(t.callProviderMetadata=n.providerMetadata))}function d(e){let t=r.message.parts.find(t=>t.type===`dynamic-tool`&&t.toolCallId===e.toolCallId),n=e,i=t;t==null?r.message.parts.push({type:`dynamic-tool`,toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:n.input,output:n.output,errorText:n.errorText,preliminary:n.preliminary,providerExecuted:n.providerExecuted,title:e.title,...n.providerMetadata==null?{}:{callProviderMetadata:n.providerMetadata}}):(t.state=e.state,i.toolName=e.toolName,i.input=n.input,i.output=n.output,i.errorText=n.errorText,i.rawInput=n.rawInput??i.rawInput,i.preliminary=n.preliminary,e.title!==void 0&&(i.title=e.title),i.providerExecuted=n.providerExecuted??t.providerExecuted,n.providerMetadata!=null&&t.state===`input-available`&&(t.callProviderMetadata=n.providerMetadata))}async function f(e){if(e!=null){let n=r.message.metadata==null?e:ox(r.message.metadata,e);t!=null&&await Xd({value:n,schema:t}),r.message.metadata=n}}switch(e.type){case`text-start`:{let t={type:`text`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeTextParts[e.id]=t,r.message.parts.push(t),c();break}case`text-delta`:{let t=r.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=e.providerMetadata??t.providerMetadata,c();break}case`text-end`:{let t=r.activeTextParts[e.id];t.state=`done`,t.providerMetadata=e.providerMetadata??t.providerMetadata,delete r.activeTextParts[e.id],c();break}case`reasoning-start`:{let t={type:`reasoning`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),c();break}case`reasoning-delta`:{let t=r.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=e.providerMetadata??t.providerMetadata,c();break}case`reasoning-end`:{let t=r.activeReasoningParts[e.id];t.providerMetadata=e.providerMetadata??t.providerMetadata,t.state=`done`,delete r.activeReasoningParts[e.id],c();break}case`file`:r.message.parts.push({type:`file`,mediaType:e.mediaType,url:e.url}),c();break;case`source-url`:r.message.parts.push({type:`source-url`,sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),c();break;case`source-document`:r.message.parts.push({type:`source-document`,sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),c();break;case`tool-input-start`:{let t=r.message.parts.filter($x);r.partialToolCalls[e.toolCallId]={text:``,toolName:e.toolName,index:t.length,dynamic:e.dynamic,title:e.title},e.dynamic?d({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0,providerExecuted:e.providerExecuted,title:e.title}):u({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0,providerExecuted:e.providerExecuted,title:e.title}),c();break}case`tool-input-delta`:{let t=r.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:n}=await yx(t.text);t.dynamic?d({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n,title:t.title}):u({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n,title:t.title}),c();break}case`tool-input-available`:e.dynamic?d({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}):u({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}),c(),a&&!e.providerExecuted&&await a({toolCall:e});break;case`tool-input-error`:e.dynamic?d({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):u({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),c();break;case`tool-approval-request`:{let t=l(e.toolCallId);t.state=`approval-requested`,t.approval={id:e.approvalId},c();break}case`tool-output-denied`:{let t=l(e.toolCallId);t.state=`output-denied`,c();break}case`tool-output-available`:{let t=l(e.toolCallId);t.type===`dynamic-tool`?d({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-available`,input:t.input,output:e.output,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:t.title}):u({toolCallId:e.toolCallId,toolName:rS(t),state:`output-available`,input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary,title:t.title}),c();break}case`tool-output-error`:{let t=l(e.toolCallId);t.type===`dynamic-tool`?d({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-error`,input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}):u({toolCallId:e.toolCallId,toolName:rS(t),state:`output-error`,input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}),c();break}case`start-step`:r.message.parts.push({type:`step-start`});break;case`finish-step`:r.activeTextParts={},r.activeReasoningParts={};break;case`start`:e.messageId!=null&&(r.message.id=e.messageId),await f(e.messageMetadata),(e.messageId!=null||e.messageMetadata!=null)&&c();break;case`finish`:e.finishReason!=null&&(r.finishReason=e.finishReason),await f(e.messageMetadata),e.messageMetadata!=null&&c();break;case`message-metadata`:await f(e.messageMetadata),e.messageMetadata!=null&&c();break;case`error`:i?.(Error(e.errorText));break;default:if(Jx(e)){n?.[e.type]!=null&&await Xd({value:e.data,schema:n[e.type]});let t=e;if(t.transient){o?.(t);break}let i=t.id==null?void 0:r.message.parts.find(e=>t.type===e.type&&t.id===e.id);i==null?r.message.parts.push(t):i.data=t.data,o?.(t),c()}}s.enqueue(e)})}}))}function cS({messageId:e,originalMessages:t=[],onFinish:n,onError:r,stream:i}){let a=t?.[t.length-1];a?.role===`assistant`?e=a.id:a=void 0;let o=!1,s=i.pipeThrough(new TransformStream({transform(t,n){if(t.type===`start`){let n=t;n.messageId==null&&e!=null&&(n.messageId=e)}t.type===`abort`&&(o=!0),n.enqueue(t)}}));if(n==null)return s;let c=oS({lastMessage:a?structuredClone(a):void 0,messageId:e??``}),l=async e=>{await e({state:c,write:()=>{}})},u=!1,d=async()=>{if(u||!n)return;u=!0;let e=c.message.id===a?.id;await n({isAborted:o,isContinuation:e,responseMessage:c.message,messages:[...e?t.slice(0,-1):t,c.message],finishReason:c.finishReason})};return sS({stream:s,runUpdateMessageJob:l,onError:r}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await d()},async flush(){await d()}}))}function lS({response:e,status:t,statusText:n,headers:r,stream:i,consumeSseStream:a}){let o=i.pipeThrough(new Ux);if(a){let[e,t]=o.tee();o=e,a({stream:t})}Vx({response:e,status:t,statusText:n,headers:Object.fromEntries(zx(r,Wx).entries()),stream:o.pipeThrough(new TextEncoderStream)})}function uS(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function n(n){t=!0;try{n&&await e.cancel?.call(e)}finally{try{e.releaseLock()}catch{}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:r,value:i}=await e.read();return r?(await n(!0),{done:!0,value:void 0}):{done:!1,value:i}},async return(){return await n(!0),{done:!0,value:void 0}},async throw(e){throw await n(!0),e}}},t}async function dS({stream:e,onError:t}){let n=e.getReader();try{for(;;){let{done:e}=await n.read();if(e)break}}catch(e){t?.(e)}finally{n.releaseLock()}}function fS(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}function pS(){let e=[],t=null,n=!1,r=fS(),i=()=>{n=!0,r.resolve(),e.forEach(e=>e.cancel()),e=[],t?.close()},a=async()=>{if(n&&e.length===0){t?.close();return}if(e.length===0)return r=fS(),await r.promise,a();try{let{value:r,done:i}=await e[0].read();i?(e.shift(),e.length===0&&n?t?.close():await a()):t?.enqueue(r)}catch(n){t?.error(n),e.shift(),i()}};return{stream:new ReadableStream({start(e){t=e},pull:a,async cancel(){for(let t of e)await t.cancel();e=[],n=!0}}),addStream:t=>{if(n)throw Error(`Cannot add inner stream: outer stream is closed`);e.push(t.getReader()),r.resolve()},close:()=>{n=!0,r.resolve(),e.length===0&&t?.close()},terminate:i}}function mS(){return(globalThis==null?void 0:globalThis.performance)?.now()??Date.now()}function hS({tools:e,generatorStream:t,tracer:n,telemetry:r,system:i,messages:a,abortSignal:o,repairToolCall:s,experimental_context:c,generateId:l}){let u=null,d=new ReadableStream({start(e){u=e}}),f=new Set,p=new Map,m=new Map,h=!1,g;function _(){h&&f.size===0&&(g!=null&&u.enqueue(g),u.close())}let v=new TransformStream({async transform(t,d){let h=t.type;switch(h){case`stream-start`:case`text-start`:case`text-delta`:case`text-end`:case`reasoning-start`:case`reasoning-delta`:case`reasoning-end`:case`tool-input-start`:case`tool-input-delta`:case`tool-input-end`:case`source`:case`response-metadata`:case`error`:case`raw`:d.enqueue(t);break;case`file`:d.enqueue({type:`file`,file:new hx({data:t.data,mediaType:t.mediaType})});break;case`finish`:g={type:`finish`,finishReason:t.finishReason.unified,rawFinishReason:t.finishReason.raw,usage:tx(t.usage),providerMetadata:t.providerMetadata};break;case`tool-approval-request`:{let e=m.get(t.toolCallId);if(e==null){u.enqueue({type:`error`,error:new Gv({toolCallId:t.toolCallId,approvalId:t.approvalId})});break}d.enqueue({type:`tool-approval-request`,approvalId:t.approvalId,toolCall:e});break}case`tool-call`:try{let h=await Tx({toolCall:t,tools:e,repairToolCall:s,system:i,messages:a});if(m.set(h.toolCallId,h),d.enqueue(h),h.invalid){u.enqueue({type:`tool-error`,toolCallId:h.toolCallId,toolName:h.toolName,input:h.input,error:gu(h.error),dynamic:!0,title:h.title});break}let g=e?.[h.toolName];if(g==null)break;if(g.onInputAvailable!=null&&await g.onInputAvailable({input:h.input,toolCallId:h.toolCallId,messages:a,abortSignal:o,experimental_context:c}),await gx({tool:g,toolCall:h,messages:a,experimental_context:c})){u.enqueue({type:`tool-approval-request`,approvalId:l(),toolCall:h});break}if(p.set(h.toolCallId,h.input),g.execute!=null&&h.providerExecuted!==!0){let t=l();f.add(t),fx({toolCall:h,tools:e,tracer:n,telemetry:r,messages:a,abortSignal:o,experimental_context:c,onPreliminaryToolResult:e=>{u.enqueue(e)}}).then(e=>{u.enqueue(e),f.delete(t),_()})}}catch(e){u.enqueue({type:`error`,error:e})}break;case`tool-result`:{let e=t.toolName;t.isError?u.enqueue({type:`tool-error`,toolCallId:t.toolCallId,toolName:e,input:p.get(t.toolCallId),providerExecuted:!0,error:t.result,dynamic:t.dynamic}):d.enqueue({type:`tool-result`,toolCallId:t.toolCallId,toolName:e,input:p.get(t.toolCallId),output:t.result,providerExecuted:!0,dynamic:t.dynamic});break}default:{let e=h;throw Error(`Unhandled chunk type: ${e}`)}}},flush(){h=!0,_()}});return new ReadableStream({async start(e){return Promise.all([t.pipeThrough(v).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])}})}var gS=mu({prefix:`aitxt`,size:24});function _S({model:e,tools:t,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,stopWhen:l=kx(1),experimental_output:u,output:d=u,experimental_telemetry:f,prepareStep:p,providerOptions:m,experimental_activeTools:h,activeTools:g=h,experimental_repairToolCall:_,experimental_transform:v,experimental_download:y,includeRawChunks:b=!1,onChunk:x,onError:S=({error:e})=>{console.error(e)},onFinish:C,onAbort:w,onStepFinish:T,experimental_context:ee,_internal:{now:te=mS,generateId:ne=gS,currentDate:re=()=>new Date}={},...E}){return new yS({model:Qy(e),telemetry:f,headers:c,settings:E,maxRetries:o,abortSignal:s,system:r,prompt:i,messages:a,tools:t,toolChoice:n,transforms:_b(v),activeTools:g,repairToolCall:_,stopConditions:_b(l),output:d,providerOptions:m,prepareStep:p,includeRawChunks:b,onChunk:x,onError:S,onFinish:C,onAbort:w,onStepFinish:T,now:te,currentDate:re,generateId:ne,experimental_context:ee,download:y})}function vS(e){let t,n=``,r=``,i,a=``;function o({controller:e,partialOutput:n=void 0}){e.enqueue({part:{type:`text-delta`,id:t,text:r,providerMetadata:i},partialOutput:n}),r=``}return new TransformStream({async transform(s,c){if(s.type===`finish-step`&&r.length>0&&o({controller:c}),s.type!==`text-delta`&&s.type!==`text-start`&&s.type!==`text-end`){c.enqueue({part:s,partialOutput:void 0});return}if(t==null)t=s.id;else if(s.id!==t){c.enqueue({part:s,partialOutput:void 0});return}if(s.type===`text-start`){c.enqueue({part:s,partialOutput:void 0});return}if(s.type===`text-end`){r.length>0&&o({controller:c}),c.enqueue({part:s,partialOutput:void 0});return}n+=s.text,r+=s.text,i=s.providerMetadata??i;let l=await e.parsePartialOutput({text:n});if(l!==void 0){let e=JSON.stringify(l.partial);e!==a&&(o({controller:c,partialOutput:l.partial}),a=e)}}})}var yS=class{constructor({model:e,telemetry:t,headers:n,settings:r,maxRetries:i,abortSignal:a,system:o,prompt:s,messages:c,tools:l,toolChoice:u,transforms:d,activeTools:f,repairToolCall:p,stopConditions:m,output:h,providerOptions:g,prepareStep:_,includeRawChunks:v,now:y,currentDate:b,generateId:x,onChunk:S,onError:C,onFinish:w,onAbort:T,onStepFinish:ee,experimental_context:te,download:ne}){this._totalUsage=new $l,this._finishReason=new $l,this._rawFinishReason=new $l,this._steps=new $l,this.outputSpecification=h,this.includeRawChunks=v,this.tools=l;let re,E=[],ie=[],ae,oe,se,ce={},le=[],D=[],ue=new Map,de,fe={},pe={},me=new TransformStream({async transform(t,n){n.enqueue(t);let{part:r}=t;if((r.type===`text-delta`||r.type===`reasoning-delta`||r.type===`source`||r.type===`tool-call`||r.type===`tool-result`||r.type===`tool-input-start`||r.type===`tool-input-delta`||r.type===`raw`)&&await S?.({chunk:r}),r.type===`error`&&await C({error:Wb(r.error)}),r.type===`text-start`&&(fe[r.id]={type:`text`,text:``,providerMetadata:r.providerMetadata},E.push(fe[r.id])),r.type===`text-delta`){let e=fe[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`text part ${r.id} not found`},partialOutput:void 0});return}e.text+=r.text,e.providerMetadata=r.providerMetadata??e.providerMetadata}if(r.type===`text-end`){let e=fe[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`text part ${r.id} not found`},partialOutput:void 0});return}e.providerMetadata=r.providerMetadata??e.providerMetadata,delete fe[r.id]}if(r.type===`reasoning-start`&&(pe[r.id]={type:`reasoning`,text:``,providerMetadata:r.providerMetadata},E.push(pe[r.id])),r.type===`reasoning-delta`){let e=pe[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`reasoning part ${r.id} not found`},partialOutput:void 0});return}e.text+=r.text,e.providerMetadata=r.providerMetadata??e.providerMetadata}if(r.type===`reasoning-end`){let e=pe[r.id];if(e==null){n.enqueue({part:{type:`error`,error:`reasoning part ${r.id} not found`},partialOutput:void 0});return}e.providerMetadata=r.providerMetadata??e.providerMetadata,delete pe[r.id]}if(r.type===`file`&&E.push({type:`file`,file:r.file}),r.type===`source`&&E.push(r),r.type===`tool-call`&&E.push(r),r.type===`tool-result`&&!r.preliminary&&E.push(r),r.type===`tool-approval-request`&&E.push(r),r.type===`tool-error`&&E.push(r),r.type===`start-step`&&(E=[],pe={},fe={},ce=r.request,le=r.warnings),r.type===`finish-step`){let t=await Mx({content:E,tools:l}),n=new Ox({content:E,finishReason:r.finishReason,rawFinishReason:r.rawFinishReason,usage:r.usage,warnings:le,request:ce,response:{...r.response,messages:[...ie,...t]},providerMetadata:r.providerMetadata});await ee?.(n),Hy({warnings:le,provider:e.provider,model:e.modelId}),D.push(n),ie.push(...t),re.resolve()}r.type===`finish`&&(se=r.totalUsage,ae=r.finishReason,oe=r.rawFinishReason)},async flush(e){try{if(D.length===0){let e=new oy({message:`No output generated. Check the stream for errors.`});Ce._finishReason.reject(e),Ce._rawFinishReason.reject(e),Ce._totalUsage.reject(e),Ce._steps.reject(e);return}let e=ae??`other`,n=se??nx();Ce._finishReason.resolve(e),Ce._rawFinishReason.resolve(oe),Ce._totalUsage.resolve(n),Ce._steps.resolve(D);let r=D[D.length-1];await w?.({finishReason:r.finishReason,rawFinishReason:r.rawFinishReason,totalUsage:n,usage:r.usage,content:r.content,text:r.text,reasoningText:r.reasoningText,reasoning:r.reasoning,files:r.files,sources:r.sources,toolCalls:r.toolCalls,staticToolCalls:r.staticToolCalls,dynamicToolCalls:r.dynamicToolCalls,toolResults:r.toolResults,staticToolResults:r.staticToolResults,dynamicToolResults:r.dynamicToolResults,request:r.request,response:r.response,warnings:r.warnings,providerMetadata:r.providerMetadata,steps:D,experimental_context:te}),de.setAttributes(await $b({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>r.text},"ai.response.toolCalls":{output:()=>r.toolCalls?.length?JSON.stringify(r.toolCalls):void 0},"ai.response.providerMetadata":JSON.stringify(r.providerMetadata),"ai.usage.inputTokens":n.inputTokens,"ai.usage.outputTokens":n.outputTokens,"ai.usage.totalTokens":n.totalTokens,"ai.usage.reasoningTokens":n.reasoningTokens,"ai.usage.cachedInputTokens":n.cachedInputTokens}}))}catch(t){e.error(t)}finally{de.end()}}}),he=pS();this.addStream=he.addStream,this.closeStream=he.close;let ge=he.stream.getReader(),_e=new ReadableStream({async start(e){e.enqueue({type:`start`})},async pull(e){function t(){T?.({steps:D}),e.enqueue({type:`abort`}),e.close()}try{let{done:n,value:r}=await ge.read();if(n){e.close();return}if(a?.aborted){t();return}e.enqueue(r)}catch(n){_u(n)&&a?.aborted?t():e.error(n)}},cancel(e){return he.stream.cancel(e)}});for(let e of d)_e=_e.pipeThrough(e({tools:l,stopStream(){he.terminate()}}));this.baseStream=_e.pipeThrough(vS(h??bx())).pipeThrough(me);let{maxRetries:ve,retry:ye}=ux({maxRetries:i,abortSignal:a}),be=Xb(t),xe=Tb(r),Se=Kb({model:e,telemetry:t,headers:n,settings:{...xe,maxRetries:ve}}),Ce=this;Zb({name:`ai.streamText`,attributes:$b({telemetry:t,attributes:{...Gb({operationId:`ai.streamText`,telemetry:t}),...Se,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:s,messages:c})}}}),tracer:be,endWhenDone:!1,fn:async r=>{de=r;let i=await Ub({system:o,prompt:s,messages:c}),d=i.messages,v=[],{approvedToolApprovals:S,deniedToolApprovals:C}=dx({messages:d});if(C.length>0||S.length>0){let e=[...S,...C].filter(e=>e.toolCall.providerExecuted),n=S.filter(e=>!e.toolCall.providerExecuted),r=C.filter(e=>!e.toolCall.providerExecuted),i=C.filter(e=>e.toolCall.providerExecuted),o,s=new ReadableStream({start(e){o=e}});Ce.addStream(s);try{for(let e of[...r,...i])o?.enqueue({type:`tool-output-denied`,toolCallId:e.toolCall.toolCallId,toolName:e.toolCall.toolName});let s=[];if(await Promise.all(n.map(async e=>{let n=await fx({toolCall:e.toolCall,tools:l,tracer:be,telemetry:t,messages:d,abortSignal:a,experimental_context:te,onPreliminaryToolResult:e=>{o?.enqueue(e)}});n!=null&&(o?.enqueue(n),s.push(n))})),e.length>0&&v.push({role:`tool`,content:e.map(e=>({type:`tool-approval-response`,approvalId:e.approvalResponse.approvalId,approved:e.approvalResponse.approved,reason:e.approvalResponse.reason,providerExecuted:!0}))}),s.length>0||r.length>0){let e=[];for(let t of s)e.push({type:`tool-result`,toolCallId:t.toolCallId,toolName:t.toolName,output:await Cb({toolCallId:t.toolCallId,input:t.input,tool:l?.[t.toolName],output:t.type===`tool-result`?t.output:t.error,errorMode:t.type===`tool-error`?`json`:`none`})});for(let t of r)e.push({type:`tool-result`,toolCallId:t.toolCall.toolCallId,toolName:t.toolCall.toolName,output:{type:`execution-denied`,reason:t.approvalResponse.reason}});v.push({role:`tool`,content:e})}}finally{o?.close()}}ie.push(...v);async function w({currentStep:r,responseMessages:s,usage:c}){let v=Ce.includeRawChunks;re=new $l;let S=[...d,...s],C=await _?.({model:e,steps:D,stepNumber:D.length,messages:S,experimental_context:te}),T=Qy(C?.model??e),ee=await vb({prompt:{system:C?.system??i.system,messages:C?.messages??S},supportedUrls:await T.supportedUrls,download:ne}),{toolChoice:E,tools:ie}=await Db({tools:l,toolChoice:C?.toolChoice??u,activeTools:C?.activeTools??f});te=C?.experimental_context??te;let ae=ox(g,C?.providerOptions),{result:{stream:oe,response:se,request:ce},doStreamSpan:le,startTimestampMs:de}=await ye(()=>Zb({name:`ai.streamText.doStream`,attributes:$b({telemetry:t,attributes:{...Gb({operationId:`ai.streamText.doStream`,telemetry:t}),...Se,"ai.model.provider":T.provider,"ai.model.id":T.modelId,"ai.prompt.messages":{input:()=>ex(ee)},"ai.prompt.tools":{input:()=>ie?.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>E==null?void 0:JSON.stringify(E)},"gen_ai.system":T.provider,"gen_ai.request.model":T.modelId,"gen_ai.request.frequency_penalty":xe.frequencyPenalty,"gen_ai.request.max_tokens":xe.maxOutputTokens,"gen_ai.request.presence_penalty":xe.presencePenalty,"gen_ai.request.stop_sequences":xe.stopSequences,"gen_ai.request.temperature":xe.temperature,"gen_ai.request.top_k":xe.topK,"gen_ai.request.top_p":xe.topP}}),tracer:be,endWhenDone:!1,fn:async e=>({startTimestampMs:y(),doStreamSpan:e,result:await T.doStream({...xe,tools:ie,toolChoice:E,responseFormat:await h?.responseFormat,prompt:ee,providerOptions:ae,abortSignal:a,headers:n,includeRawChunks:v})})})),fe=hS({tools:l,generatorStream:oe,tracer:be,telemetry:t,system:o,messages:S,repairToolCall:p,abortSignal:a,experimental_context:te,generateId:x}),pe=ce??{},me=[],he=[],ge,_e={},ve=`other`,we,Te=nx(),Ee,De=!0,Oe={id:x(),timestamp:b(),modelId:e.modelId},ke=``;Ce.addStream(fe.pipeThrough(new TransformStream({async transform(e,t){if(e.type===`stream-start`){ge=e.warnings;return}if(De){let e=y()-de;De=!1,le.addEvent(`ai.stream.firstChunk`,{"ai.response.msToFirstChunk":e}),le.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:`start-step`,request:pe,warnings:ge??[]})}let n=e.type;switch(n){case`tool-approval-request`:case`text-start`:case`text-end`:t.enqueue(e);break;case`text-delta`:e.delta.length>0&&(t.enqueue({type:`text-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),ke+=e.delta);break;case`reasoning-start`:case`reasoning-end`:t.enqueue(e);break;case`reasoning-delta`:t.enqueue({type:`reasoning-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case`tool-call`:t.enqueue(e),me.push(e);break;case`tool-result`:t.enqueue(e),e.preliminary||he.push(e);break;case`tool-error`:t.enqueue(e),he.push(e);break;case`response-metadata`:Oe={id:e.id??Oe.id,timestamp:e.timestamp??Oe.timestamp,modelId:e.modelId??Oe.modelId};break;case`finish`:{Te=e.usage,ve=e.finishReason,we=e.rawFinishReason,Ee=e.providerMetadata;let t=y()-de;le.addEvent(`ai.stream.finish`),le.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*(Te.outputTokens??0)/t});break}case`file`:t.enqueue(e);break;case`source`:t.enqueue(e);break;case`tool-input-start`:{_e[e.id]=e.toolName;let n=l?.[e.toolName];n?.onInputStart!=null&&await n.onInputStart({toolCallId:e.id,messages:S,abortSignal:a,experimental_context:te}),t.enqueue({...e,dynamic:e.dynamic??n?.type===`dynamic`,title:n?.title});break}case`tool-input-end`:delete _e[e.id],t.enqueue(e);break;case`tool-input-delta`:{let n=_e[e.id],r=l?.[n];r?.onInputDelta!=null&&await r.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:S,abortSignal:a,experimental_context:te}),t.enqueue(e);break}case`error`:t.enqueue(e),ve=`error`;break;case`raw`:v&&t.enqueue(e);break;default:{let e=n;throw Error(`Unknown chunk type: ${e}`)}}},async flush(e){let n=me.length>0?JSON.stringify(me):void 0;try{le.setAttributes(await $b({telemetry:t,attributes:{"ai.response.finishReason":ve,"ai.response.text":{output:()=>ke},"ai.response.toolCalls":{output:()=>n},"ai.response.id":Oe.id,"ai.response.model":Oe.modelId,"ai.response.timestamp":Oe.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Ee),"ai.usage.inputTokens":Te.inputTokens,"ai.usage.outputTokens":Te.outputTokens,"ai.usage.totalTokens":Te.totalTokens,"ai.usage.reasoningTokens":Te.reasoningTokens,"ai.usage.cachedInputTokens":Te.cachedInputTokens,"gen_ai.response.finish_reasons":[ve],"gen_ai.response.id":Oe.id,"gen_ai.response.model":Oe.modelId,"gen_ai.usage.input_tokens":Te.inputTokens,"gen_ai.usage.output_tokens":Te.outputTokens}}))}catch{}finally{le.end()}e.enqueue({type:`finish-step`,finishReason:ve,rawFinishReason:we,usage:Te,providerMetadata:Ee,response:{...Oe,headers:se?.headers}});let i=rx(c,Te);await re.promise;let a=me.filter(e=>e.providerExecuted!==!0),o=he.filter(e=>e.providerExecuted!==!0);for(let e of me){if(e.providerExecuted!==!0)continue;let t=l?.[e.toolName];t?.type===`provider`&&t.supportsDeferredResults&&(he.some(t=>t.type===`tool-result`&&t.toolCallId===e.toolCallId)||ue.set(e.toolCallId,{toolName:e.toolName}))}for(let e of he)e.type===`tool-result`&&ue.delete(e.toolCallId);if((a.length>0&&o.length===a.length||ue.size>0)&&!await jx({stopConditions:m,steps:D})){s.push(...await Mx({content:D[D.length-1].content,tools:l}));try{await w({currentStep:r+1,responseMessages:s,usage:i})}catch(t){e.enqueue({type:`error`,error:t}),Ce.closeStream()}}else e.enqueue({type:`finish`,finishReason:ve,rawFinishReason:we,totalUsage:i}),Ce.closeStream()}})))}await w({currentStep:0,responseMessages:v,usage:nx()})}}).catch(e=>{Ce.addStream(new ReadableStream({start(t){t.enqueue({type:`error`,error:e}),t.close()}})),Ce.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}get rawFinishReason(){return this.consumeStream(),this._rawFinishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return uS(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type===`text-delta`&&t.enqueue(e.text)}})))}get fullStream(){return uS(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await dS({stream:this.fullStream,onError:e?.onError})}catch(n){(t=e?.onError)==null||t.call(e,n)}}get experimental_partialOutputStream(){return this.partialOutputStream}get partialOutputStream(){return uS(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}get output(){return this.finalStep.then(e=>(this.outputSpecification??bx()).parseCompleteOutput({text:e.text},{response:e.response,usage:e.usage,finishReason:e.finishReason}))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i=!0,sendSources:a=!1,sendStart:o=!0,sendFinish:s=!0,onError:c=v}={}){let l=t==null?void 0:Kx({originalMessages:e,responseMessageId:t}),u=e=>{let t=this.tools?.[e.toolName];return t==null?e.dynamic:t?.type===`dynamic`?!0:void 0};return uS(cS({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let n=r?.({part:e}),d=e.type;switch(d){case`text-start`:t.enqueue({type:`text-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-delta`:t.enqueue({type:`text-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-end`:t.enqueue({type:`text-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-start`:t.enqueue({type:`reasoning-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-delta`:i&&t.enqueue({type:`reasoning-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-end`:t.enqueue({type:`reasoning-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`file`:t.enqueue({type:`file`,mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case`source`:a&&e.sourceType===`url`&&t.enqueue({type:`source-url`,sourceId:e.id,url:e.url,title:e.title,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}),a&&e.sourceType===`document`&&t.enqueue({type:`source-document`,sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`tool-input-start`:{let n=u(e);t.enqueue({type:`tool-input-start`,toolCallId:e.id,toolName:e.toolName,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...n==null?{}:{dynamic:n},...e.title==null?{}:{title:e.title}});break}case`tool-input-delta`:t.enqueue({type:`tool-input-delta`,toolCallId:e.id,inputTextDelta:e.delta});break;case`tool-call`:{let n=u(e);e.invalid?t.enqueue({type:`tool-input-error`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n},errorText:c(e.error),...e.title==null?{}:{title:e.title}}):t.enqueue({type:`tool-input-available`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n},...e.title==null?{}:{title:e.title}});break}case`tool-approval-request`:t.enqueue({type:`tool-approval-request`,approvalId:e.approvalId,toolCallId:e.toolCall.toolCallId});break;case`tool-result`:{let n=u(e);t.enqueue({type:`tool-output-available`,toolCallId:e.toolCallId,output:e.output,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.preliminary==null?{}:{preliminary:e.preliminary},...n==null?{}:{dynamic:n}});break}case`tool-error`:{let n=u(e);t.enqueue({type:`tool-output-error`,toolCallId:e.toolCallId,errorText:c(e.error),...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...n==null?{}:{dynamic:n}});break}case`tool-output-denied`:t.enqueue({type:`tool-output-denied`,toolCallId:e.toolCallId});break;case`error`:t.enqueue({type:`error`,errorText:c(e.error)});break;case`start-step`:t.enqueue({type:`start-step`});break;case`finish-step`:t.enqueue({type:`finish-step`});break;case`start`:o&&t.enqueue({type:`start`,...n==null?{}:{messageMetadata:n},...l==null?{}:{messageId:l}});break;case`finish`:s&&t.enqueue({type:`finish`,finishReason:e.finishReason,...n==null?{}:{messageMetadata:n}});break;case`abort`:t.enqueue(e);break;case`tool-input-end`:break;case`raw`:break;default:{let e=d;throw Error(`Unknown chunk type: ${e}`)}}n!=null&&d!==`start`&&d!==`finish`&&t.enqueue({type:`message-metadata`,messageMetadata:n})}})),messageId:l??t?.(),originalMessages:e,onFinish:n,onError:c}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l,...u}={}){lS({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l}),...u})}pipeTextStreamToResponse(e,t){Hx({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c,...l}={}){return Gx({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c}),...l})}toTextStreamResponse(e){return Bx({textStream:this.textStream,...e})}},bS=class{constructor(e){this.version=`agent-v1`,this.settings=e}get id(){return this.settings.id}get tools(){return this.settings.tools}async prepareCall(e){var t;let n={...this.settings,stopWhen:this.settings.stopWhen??kx(20),...e},{instructions:r,messages:i,prompt:a,...o}=await(t=this.settings).prepareCall?.call(t,n)??n;return{...o,system:r,messages:i,prompt:a}}async generate({abortSignal:e,...t}){return Px({...await this.prepareCall(t),abortSignal:e})}async stream({abortSignal:e,experimental_transform:t,...n}){return _S({...await this.prepareCall(n),abortSignal:e,experimental_transform:t})}};function xS({execute:e,onError:t=gu,originalMessages:n,onFinish:r,generateId:i=hu}){let a,o=[],s=new ReadableStream({start(e){a=e}});function c(e){try{a.enqueue(e)}catch{}}try{let n=e({writer:{write(e){c(e)},merge(e){o.push((async()=>{let t=e.getReader();for(;;){let{done:e,value:n}=await t.read();if(e)break;c(n)}})().catch(e=>{c({type:`error`,errorText:t(e)})}))},onError:t}});n&&o.push(n.catch(e=>{c({type:`error`,errorText:t(e)})}))}catch(e){c({type:`error`,errorText:t(e)})}return new Promise(async e=>{for(;o.length>0;)await o.shift();e()}).finally(()=>{try{a.close()}catch{}}),cS({stream:s,messageId:i(),originalMessages:n,onFinish:r,onError:t})}function SS({message:e,stream:t,onError:n,terminateOnError:r=!1}){let i,a=!1,o=new ReadableStream({start(e){i=e}}),s=oS({messageId:e?.id??``,lastMessage:e}),c=e=>{n?.(e),!a&&r&&(a=!0,i?.error(e))};return dS({stream:sS({stream:t,runUpdateMessageJob(e){return e({state:s,write:()=>{i?.enqueue(structuredClone(s.message))}})},onError:c}),onError:c}).finally(()=>{a||i?.close()}),uS(o)}async function CS(e,t){let n=[];t?.ignoreIncompleteToolCalls&&(e=e.map(e=>({...e,parts:e.parts.filter(e=>!tS(e)||e.state!==`input-streaming`&&e.state!==`input-available`)})));for(let r of e)switch(r.role){case`system`:{let e=r.parts.filter(e=>e.type===`text`),t=e.reduce((e,t)=>t.providerMetadata==null?e:{...e,...t.providerMetadata},{});n.push({role:`system`,content:e.map(e=>e.text).join(``),...Object.keys(t).length>0?{providerOptions:t}:{}});break}case`user`:n.push({role:`user`,content:r.parts.map(e=>{if(Xx(e))return{type:`text`,text:e.text,...e.providerMetadata==null?{}:{providerOptions:e.providerMetadata}};if(Zx(e))return{type:`file`,mediaType:e.mediaType,filename:e.filename,data:e.url,...e.providerMetadata==null?{}:{providerOptions:e.providerMetadata}};if(Yx(e))return(t?.convertDataPart)?.call(t,e)}).filter(ju)});break;case`assistant`:if(r.parts!=null){let e=[];async function i(){if(e.length===0)return;let r=[];for(let n of e)if(Xx(n))r.push({type:`text`,text:n.text,...n.providerMetadata==null?{}:{providerOptions:n.providerMetadata}});else if(Zx(n))r.push({type:`file`,mediaType:n.mediaType,filename:n.filename,data:n.url});else if(Qx(n))r.push({type:`reasoning`,text:n.text,providerOptions:n.providerMetadata});else if(tS(n)){let e=iS(n);n.state!==`input-streaming`&&(r.push({type:`tool-call`,toolCallId:n.toolCallId,toolName:e,input:n.state===`output-error`?n.input??(`rawInput`in n?n.rawInput:void 0):n.input,providerExecuted:n.providerExecuted,...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}}),n.approval!=null&&r.push({type:`tool-approval-request`,approvalId:n.approval.id,toolCallId:n.toolCallId}),n.providerExecuted===!0&&n.state!==`approval-responded`&&(n.state===`output-available`||n.state===`output-error`)&&r.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:e,output:await Cb({toolCallId:n.toolCallId,input:n.input,output:n.state===`output-error`?n.errorText:n.output,tool:t?.tools?.[e],errorMode:n.state===`output-error`?`json`:`none`}),...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}}))}else if(Yx(n)){let e=(t?.convertDataPart)?.call(t,n);e!=null&&r.push(e)}else{let e=n;throw Error(`Unsupported part: ${e}`)}n.push({role:`assistant`,content:r});let i=e.filter(e=>tS(e)&&(e.providerExecuted!==!0||e.approval?.approved!=null));if(i.length>0){let e=[];for(let n of i)if(n.approval?.approved!=null&&e.push({type:`tool-approval-response`,approvalId:n.approval.id,approved:n.approval.approved,reason:n.approval.reason,providerExecuted:n.providerExecuted}),n.providerExecuted!==!0)switch(n.state){case`output-denied`:e.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:iS(n),output:{type:`error-text`,value:n.approval.reason??`Tool execution denied.`},...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}});break;case`output-error`:case`output-available`:{let r=iS(n);e.push({type:`tool-result`,toolCallId:n.toolCallId,toolName:r,output:await Cb({toolCallId:n.toolCallId,input:n.input,output:n.state===`output-error`?n.errorText:n.output,tool:t?.tools?.[r],errorMode:n.state===`output-error`?`text`:`none`}),...n.callProviderMetadata==null?{}:{providerOptions:n.callProviderMetadata}});break}}e.length>0&&n.push({role:`tool`,content:e})}e=[]}for(let t of r.parts)Xx(t)||Qx(t)||Zx(t)||tS(t)||Yx(t)?e.push(t):t.type===`step-start`&&await i();await i();break}break;default:{let e=r.role;throw new Ny({originalMessage:r,message:`Unsupported role: ${e}`})}}return n}var wS=Z(()=>Q(I(L({id:j(),role:B([`system`,`user`,`assistant`]),metadata:P().optional(),parts:I(R([L({type:V(`text`),text:j(),state:B([`streaming`,`done`]).optional(),providerMetadata:$.optional()}),L({type:V(`reasoning`),text:j(),state:B([`streaming`,`done`]).optional(),providerMetadata:$.optional()}),L({type:V(`source-url`),sourceId:j(),url:j(),title:j().optional(),providerMetadata:$.optional()}),L({type:V(`source-document`),sourceId:j(),mediaType:j(),title:j(),filename:j().optional(),providerMetadata:$.optional()}),L({type:V(`file`),mediaType:j(),filename:j().optional(),url:j(),providerMetadata:$.optional()}),L({type:V(`step-start`)}),L({type:j().startsWith(`data-`),id:j().optional(),data:P()}),L({type:V(`dynamic-tool`),toolName:j(),toolCallId:j(),state:V(`input-streaming`),input:P().optional(),providerExecuted:N().optional(),output:F().optional(),errorText:F().optional(),approval:F().optional()}),L({type:V(`dynamic-tool`),toolName:j(),toolCallId:j(),state:V(`input-available`),input:P(),providerExecuted:N().optional(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:F().optional()}),L({type:V(`dynamic-tool`),toolName:j(),toolCallId:j(),state:V(`approval-requested`),input:P(),providerExecuted:N().optional(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:F().optional(),reason:F().optional()})}),L({type:V(`dynamic-tool`),toolName:j(),toolCallId:j(),state:V(`approval-responded`),input:P(),providerExecuted:N().optional(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:N(),reason:j().optional()})}),L({type:V(`dynamic-tool`),toolName:j(),toolCallId:j(),state:V(`output-available`),input:P(),providerExecuted:N().optional(),output:P(),errorText:F().optional(),callProviderMetadata:$.optional(),preliminary:N().optional(),approval:L({id:j(),approved:V(!0),reason:j().optional()}).optional()}),L({type:V(`dynamic-tool`),toolName:j(),toolCallId:j(),state:V(`output-error`),input:P(),providerExecuted:N().optional(),output:F().optional(),errorText:j(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:V(!0),reason:j().optional()}).optional()}),L({type:V(`dynamic-tool`),toolName:j(),toolCallId:j(),state:V(`output-denied`),input:P(),providerExecuted:N().optional(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:V(!1),reason:j().optional()})}),L({type:j().startsWith(`tool-`),toolCallId:j(),state:V(`input-streaming`),providerExecuted:N().optional(),input:P().optional(),output:F().optional(),errorText:F().optional(),approval:F().optional()}),L({type:j().startsWith(`tool-`),toolCallId:j(),state:V(`input-available`),providerExecuted:N().optional(),input:P(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:F().optional()}),L({type:j().startsWith(`tool-`),toolCallId:j(),state:V(`approval-requested`),input:P(),providerExecuted:N().optional(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:F().optional(),reason:F().optional()})}),L({type:j().startsWith(`tool-`),toolCallId:j(),state:V(`approval-responded`),input:P(),providerExecuted:N().optional(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:N(),reason:j().optional()})}),L({type:j().startsWith(`tool-`),toolCallId:j(),state:V(`output-available`),providerExecuted:N().optional(),input:P(),output:P(),errorText:F().optional(),callProviderMetadata:$.optional(),preliminary:N().optional(),approval:L({id:j(),approved:V(!0),reason:j().optional()}).optional()}),L({type:j().startsWith(`tool-`),toolCallId:j(),state:V(`output-error`),providerExecuted:N().optional(),input:P(),output:F().optional(),errorText:j(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:V(!0),reason:j().optional()}).optional()}),L({type:j().startsWith(`tool-`),toolCallId:j(),state:V(`output-denied`),providerExecuted:N().optional(),input:P(),output:F().optional(),errorText:F().optional(),callProviderMetadata:$.optional(),approval:L({id:j(),approved:V(!1),reason:j().optional()})})])).nonempty(`Message must contain at least one part`)})).nonempty(`Messages array must not be empty`)));async function TS({messages:e,metadataSchema:t,dataSchemas:n,tools:r}){try{if(e==null)return{success:!1,error:new Tv({parameter:`messages`,value:e,message:`messages parameter must be provided`})};let i=await Xd({value:e,schema:wS});if(t)for(let e of i)await Xd({value:e.metadata,schema:t});if(n)for(let e of i){let t=e.parts.filter(e=>e.type.startsWith(`data-`));for(let e of t){let t=e.type.slice(5),r=n[t];if(!r)return{success:!1,error:new Xe({value:e.data,cause:`No data schema found for data part ${t}`})};await Xd({value:e.data,schema:r})}}if(r)for(let e of i){let t=e.parts.filter(e=>e.type.startsWith(`tool-`));for(let e of t){let t=e.type.slice(5),n=r[t];if(!n)return{success:!1,error:new Xe({value:e.input,cause:`No tool schema found for tool part ${t}`})};(e.state===`input-available`||e.state===`output-available`||e.state===`output-error`&&e.input!==void 0)&&await Xd({value:e.input,schema:n.inputSchema}),e.state===`output-available`&&n.outputSchema&&await Xd({value:e.output,schema:n.outputSchema})}}return{success:!0,data:i}}catch(e){return{success:!1,error:e}}}async function ES({messages:e,metadataSchema:t,dataSchemas:n,tools:r}){let i=await TS({messages:e,metadataSchema:t,dataSchemas:n,tools:r});if(!i.success)throw i.error;return i.data}async function DS({agent:e,uiMessages:t,options:n,abortSignal:r,experimental_transform:i,...a}){let o=await CS(await ES({messages:t,tools:e.tools}),{tools:e.tools});return(await e.stream({prompt:o,options:n,abortSignal:r,experimental_transform:i})).toUIMessageStream(a)}async function OS({headers:e,status:t,statusText:n,consumeSseStream:r,...i}){return Gx({headers:e,status:t,statusText:n,consumeSseStream:r,stream:await DS(i)})}async function kS({response:e,headers:t,status:n,statusText:r,consumeSseStream:i,...a}){lS({response:e,headers:t,status:n,statusText:r,consumeSseStream:i,stream:await DS(a)})}async function AS({model:e,value:t,providerOptions:n,maxRetries:r,abortSignal:i,headers:a,experimental_telemetry:o}){let s=$y(e),{maxRetries:c,retry:l}=ux({maxRetries:r,abortSignal:i}),u=Su(a??{},`ai/${lb}`),d=Kb({model:s,telemetry:o,headers:u,settings:{maxRetries:c}}),f=Xb(o);return Zb({name:`ai.embed`,attributes:$b({telemetry:o,attributes:{...Gb({operationId:`ai.embed`,telemetry:o}),...d,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:f,fn:async e=>{let{embedding:r,usage:a,warnings:c,response:p,providerMetadata:m}=await l(()=>Zb({name:`ai.embed.doEmbed`,attributes:$b({telemetry:o,attributes:{...Gb({operationId:`ai.embed.doEmbed`,telemetry:o}),...d,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:f,fn:async e=>{let r=await s.doEmbed({values:[t],abortSignal:i,headers:u,providerOptions:n}),a=r.embeddings[0],c=r.usage??{tokens:NaN};return e.setAttributes(await $b({telemetry:o,attributes:{"ai.embeddings":{output:()=>r.embeddings.map(e=>JSON.stringify(e))},"ai.usage.tokens":c.tokens}})),{embedding:a,usage:c,warnings:r.warnings,providerMetadata:r.providerMetadata,response:r.response}}}));return e.setAttributes(await $b({telemetry:o,attributes:{"ai.embedding":{output:()=>JSON.stringify(r)},"ai.usage.tokens":a.tokens}})),Hy({warnings:c,provider:s.provider,model:s.modelId}),new jS({value:t,embedding:r,usage:a,warnings:c,providerMetadata:m,response:p})}})}var jS=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response}};function MS(e,t){if(t<=0)throw Error(`chunkSize must be greater than 0`);let n=[];for(let r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}async function NS({model:e,values:t,maxParallelCalls:n=1/0,maxRetries:r,abortSignal:i,headers:a,providerOptions:o,experimental_telemetry:s}){let c=$y(e),{maxRetries:l,retry:u}=ux({maxRetries:r,abortSignal:i}),d=Su(a??{},`ai/${lb}`),f=Kb({model:c,telemetry:s,headers:d,settings:{maxRetries:l}}),p=Xb(s);return Zb({name:`ai.embedMany`,attributes:$b({telemetry:s,attributes:{...Gb({operationId:`ai.embedMany`,telemetry:s}),...f,"ai.values":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async e=>{let[r,a]=await Promise.all([c.maxEmbeddingsPerCall,c.supportsParallelCalls]);if(r==null||r===1/0){let{embeddings:n,usage:r,warnings:a,response:l,providerMetadata:m}=await u(()=>Zb({name:`ai.embedMany.doEmbed`,attributes:$b({telemetry:s,attributes:{...Gb({operationId:`ai.embedMany.doEmbed`,telemetry:s}),...f,"ai.values":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async e=>{let n=await c.doEmbed({values:t,abortSignal:i,headers:d,providerOptions:o}),r=n.embeddings,a=n.usage??{tokens:NaN};return e.setAttributes(await $b({telemetry:s,attributes:{"ai.embeddings":{output:()=>r.map(e=>JSON.stringify(e))},"ai.usage.tokens":a.tokens}})),{embeddings:r,usage:a,warnings:n.warnings,providerMetadata:n.providerMetadata,response:n.response}}}));return e.setAttributes(await $b({telemetry:s,attributes:{"ai.embeddings":{output:()=>n.map(e=>JSON.stringify(e))},"ai.usage.tokens":r.tokens}})),Hy({warnings:a,provider:c.provider,model:c.modelId}),new PS({values:t,embeddings:n,usage:r,warnings:a,providerMetadata:m,responses:[l]})}let l=MS(t,r),m=[],h=[],g=[],_=0,v,y=MS(l,a?n:1);for(let e of y){let t=await Promise.all(e.map(e=>u(()=>Zb({name:`ai.embedMany.doEmbed`,attributes:$b({telemetry:s,attributes:{...Gb({operationId:`ai.embedMany.doEmbed`,telemetry:s}),...f,"ai.values":{input:()=>e.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async t=>{let n=await c.doEmbed({values:e,abortSignal:i,headers:d,providerOptions:o}),r=n.embeddings,a=n.usage??{tokens:NaN};return t.setAttributes(await $b({telemetry:s,attributes:{"ai.embeddings":{output:()=>r.map(e=>JSON.stringify(e))},"ai.usage.tokens":a.tokens}})),{embeddings:r,usage:a,warnings:n.warnings,providerMetadata:n.providerMetadata,response:n.response}}}))));for(let e of t)if(m.push(...e.embeddings),h.push(...e.warnings),g.push(e.response),_+=e.usage.tokens,e.providerMetadata)if(!v)v={...e.providerMetadata};else for(let[t,n]of Object.entries(e.providerMetadata))v[t]={...v[t]??{},...n}}return e.setAttributes(await $b({telemetry:s,attributes:{"ai.embeddings":{output:()=>m.map(e=>JSON.stringify(e))},"ai.usage.tokens":_}})),Hy({warnings:h,provider:c.provider,model:c.modelId}),new PS({values:t,embeddings:m,usage:{tokens:_},warnings:h,providerMetadata:v,responses:g})}})}var PS=class{constructor(e){this.values=e.values,this.embeddings=e.embeddings,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.responses=e.responses}};async function FS({model:e,prompt:t,n=1,maxImagesPerCall:r,size:i,aspectRatio:a,seed:o,providerOptions:s,maxRetries:c,abortSignal:l,headers:u}){let d=nb(e),f=Su(u??{},`ai/${lb}`),{retry:p}=ux({maxRetries:c,abortSignal:l}),m=r??await LS(d)??1,h=Math.ceil(n/m),g=Array.from({length:h},(e,t)=>{if(t<h-1)return m;let r=n%m;return r===0?m:r}),_=await Promise.all(g.map(async e=>p(()=>{let{prompt:n,files:r,mask:c}=RS(t);return d.doGenerate({prompt:n,files:r,mask:c,n:e,abortSignal:l,headers:f,size:i,aspectRatio:a,seed:o,providerOptions:s??{}})}))),v=[],y=[],b=[],x={},S={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};for(let e of _){if(v.push(...e.images.map(e=>new mx({data:e,mediaType:cb({data:e,signatures:ib})??`image/png`}))),y.push(...e.warnings),e.usage!=null&&(S=ax(S,e.usage)),e.providerMetadata)for(let[t,n]of Object.entries(e.providerMetadata))if(t===`gateway`){let e=x[t];typeof e==`object`&&e?x[t]={...e,...n}:x[t]=n;let r=x[t].images;Array.isArray(r)&&r.length===0&&delete x[t].images}else x[t]??(x[t]={images:[]}),x[t].images.push(...e.providerMetadata[t].images);b.push(e.response)}if(Hy({warnings:y,provider:d.provider,model:d.modelId}),!v.length)throw new Xv({responses:b});return new IS({images:v,warnings:y,responses:b,providerMetadata:x,usage:S})}var IS=class{constructor(e){this.images=e.images,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata,this.usage=e.usage}get image(){return this.images[0]}};async function LS(e){return e.maxImagesPerCall instanceof Function?e.maxImagesPerCall({modelId:e.modelId}):e.maxImagesPerCall}function RS(e){return typeof e==`string`?{prompt:e,files:void 0,mask:void 0}:{prompt:e.text,files:e.images.map(zS),mask:e.mask?zS(e.mask):void 0}}function zS(e){if(typeof e==`string`&&e.startsWith(`http`))return{type:`url`,url:e};if(typeof e==`string`&&e.startsWith(`data:`)){let{mediaType:t,base64Content:n}=fb(e);if(n!=null){let e=ru(n);return{type:`file`,data:e,mediaType:t||cb({data:e,signatures:ib})||`image/png`}}}let t=gb(e);return{type:`file`,data:t,mediaType:cb({data:t,signatures:ib})||`image/png`}}var BS=FS;function VS(e){let t=e.filter(e=>e.type===`reasoning`);return t.length===0?void 0:t.map(e=>e.text).join(`
`)}var HS={type:`no-schema`,jsonSchema:async()=>void 0,async validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},async validateFinalResult(e,t){return e===void 0?{success:!1,error:new ty({message:`No object generated: response did not match schema.`,text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e}},createElementStream(){throw new nt({functionality:`element streams in no-schema mode`})}},US=e=>({type:`object`,jsonSchema:async()=>await e.jsonSchema,async validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},async validateFinalResult(t){return Zd({value:t,schema:e})},createElementStream(){throw new nt({functionality:`element streams in object mode`})}}),WS=e=>({type:`array`,jsonSchema:async()=>{let{$schema:t,...n}=await e.jsonSchema;return{$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{elements:{type:`array`,items:n}},required:[`elements`],additionalProperties:!1}},async validatePartialResult({value:t,latestObject:n,isFirstDelta:r,isFinalDelta:i}){if(!at(t)||!it(t.elements))return{success:!1,error:new Xe({value:t,cause:`value must be an object that contains an array of elements`})};let a=t.elements,o=[];for(let t=0;t<a.length;t++){let n=a[t],r=await Zd({value:n,schema:e});if(!(t===a.length-1&&!i)){if(!r.success)return r;o.push(r.value)}}let s=n?.length??0,c=``;return r&&(c+=`[`),s>0&&(c+=`,`),c+=o.slice(s).map(e=>JSON.stringify(e)).join(`,`),i&&(c+=`]`),{success:!0,value:{partial:o,textDelta:c}}},async validateFinalResult(t){if(!at(t)||!it(t.elements))return{success:!1,error:new Xe({value:t,cause:`value must be an object that contains an array of elements`})};let n=t.elements;for(let t of n){let n=await Zd({value:t,schema:e});if(!n.success)return n}return{success:!0,value:n}},createElementStream(e){let t=0;return uS(e.pipeThrough(new TransformStream({transform(e,n){switch(e.type){case`object`:{let r=e.object;for(;t<r.length;t++)n.enqueue(r[t]);break}case`text-delta`:case`finish`:case`error`:break;default:{let t=e;throw Error(`Unsupported chunk type: ${t}`)}}}})))}}),GS=e=>({type:`enum`,jsonSchema:async()=>({$schema:`http://json-schema.org/draft-07/schema#`,type:`object`,properties:{result:{type:`string`,enum:e}},required:[`result`],additionalProperties:!1}),async validateFinalResult(t){if(!at(t)||typeof t.result!=`string`)return{success:!1,error:new Xe({value:t,cause:`value must be an object that contains a string in the "result" property.`})};let n=t.result;return e.includes(n)?{success:!0,value:n}:{success:!1,error:new Xe({value:t,cause:`value must be a string in the enum`})}},async validatePartialResult({value:t,textDelta:n}){if(!at(t)||typeof t.result!=`string`)return{success:!1,error:new Xe({value:t,cause:`value must be an object that contains a string in the "result" property.`})};let r=t.result,i=e.filter(e=>e.startsWith(r));return t.result.length===0||i.length===0?{success:!1,error:new Xe({value:t,cause:`value must be a string in the enum`})}:{success:!0,value:{partial:i.length>1?r:i[0],textDelta:n}}},createElementStream(){throw new nt({functionality:`element streams in enum mode`})}});function KS({output:e,schema:t,enumValues:n}){switch(e){case`object`:return US(Gd(t));case`array`:return WS(Gd(t));case`enum`:return GS(n);case`no-schema`:return HS;default:{let t=e;throw Error(`Unsupported output: ${t}`)}}}async function qS(e,t,n){let r=await $d({text:e});if(!r.success)throw new ty({message:`No object generated: could not parse the response.`,cause:r.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});let i=await t.validateFinalResult(r.value,{text:e,response:n.response,usage:n.usage});if(!i.success)throw new ty({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});return i.value}async function JS(e,t,n,r){try{return await qS(e,t,r)}catch(i){if(n!=null&&ty.isInstance(i)&&(me.isInstance(i.cause)||Xe.isInstance(i.cause))){let a=await n({text:e,error:i.cause});if(a===null)throw i;return await qS(a,t,r)}throw i}}function YS({output:e,schema:t,schemaName:n,schemaDescription:r,enumValues:i}){if(e!=null&&e!==`object`&&e!==`array`&&e!==`enum`&&e!==`no-schema`)throw new Tv({parameter:`output`,value:e,message:`Invalid output type.`});if(e===`no-schema`){if(t!=null)throw new Tv({parameter:`schema`,value:t,message:`Schema is not supported for no-schema output.`});if(r!=null)throw new Tv({parameter:`schemaDescription`,value:r,message:`Schema description is not supported for no-schema output.`});if(n!=null)throw new Tv({parameter:`schemaName`,value:n,message:`Schema name is not supported for no-schema output.`});if(i!=null)throw new Tv({parameter:`enumValues`,value:i,message:`Enum values are not supported for no-schema output.`})}if(e===`object`){if(t==null)throw new Tv({parameter:`schema`,value:t,message:`Schema is required for object output.`});if(i!=null)throw new Tv({parameter:`enumValues`,value:i,message:`Enum values are not supported for object output.`})}if(e===`array`){if(t==null)throw new Tv({parameter:`schema`,value:t,message:`Element schema is required for array output.`});if(i!=null)throw new Tv({parameter:`enumValues`,value:i,message:`Enum values are not supported for array output.`})}if(e===`enum`){if(t!=null)throw new Tv({parameter:`schema`,value:t,message:`Schema is not supported for enum output.`});if(r!=null)throw new Tv({parameter:`schemaDescription`,value:r,message:`Schema description is not supported for enum output.`});if(n!=null)throw new Tv({parameter:`schemaName`,value:n,message:`Schema name is not supported for enum output.`});if(i==null)throw new Tv({parameter:`enumValues`,value:i,message:`Enum values are required for enum output.`});for(let e of i)if(typeof e!=`string`)throw new Tv({parameter:`enumValues`,value:e,message:`Enum values must be strings.`})}}var XS=mu({prefix:`aiobj`,size:24});async function ZS(e){let{model:t,output:n=`object`,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,experimental_repairText:l,experimental_telemetry:u,experimental_download:d,providerOptions:f,_internal:{generateId:p=XS,currentDate:m=()=>new Date}={},...h}=e,g=Qy(t),_=`enum`in e?e.enum:void 0,{schema:v,schemaDescription:y,schemaName:b}=`schema`in e?e:{};YS({output:n,schema:v,schemaName:b,schemaDescription:y,enumValues:_});let{maxRetries:x,retry:S}=ux({maxRetries:o,abortSignal:s}),C=KS({output:n,schema:v,enumValues:_}),w=Tb(h),T=Su(c??{},`ai/${lb}`),ee=Kb({model:g,telemetry:u,headers:T,settings:{...w,maxRetries:x}}),te=Xb(u),ne=await C.jsonSchema();try{return await Zb({name:`ai.generateObject`,attributes:$b({telemetry:u,attributes:{...Gb({operationId:`ai.generateObject`,telemetry:u}),...ee,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:i,messages:a})},"ai.schema":ne==null?void 0:{input:()=>JSON.stringify(ne)},"ai.schema.name":b,"ai.schema.description":y,"ai.settings.output":C.type}}),tracer:te,fn:async e=>{let t,n,o,c,_,v,x,re,E=await vb({prompt:await Ub({system:r,prompt:i,messages:a}),supportedUrls:await g.supportedUrls,download:d}),ie=await S(()=>Zb({name:`ai.generateObject.doGenerate`,attributes:$b({telemetry:u,attributes:{...Gb({operationId:`ai.generateObject.doGenerate`,telemetry:u}),...ee,"ai.prompt.messages":{input:()=>ex(E)},"gen_ai.system":g.provider,"gen_ai.request.model":g.modelId,"gen_ai.request.frequency_penalty":w.frequencyPenalty,"gen_ai.request.max_tokens":w.maxOutputTokens,"gen_ai.request.presence_penalty":w.presencePenalty,"gen_ai.request.temperature":w.temperature,"gen_ai.request.top_k":w.topK,"gen_ai.request.top_p":w.topP}}),tracer:te,fn:async e=>{let t=await g.doGenerate({responseFormat:{type:`json`,schema:ne,name:b,description:y},...Tb(h),prompt:E,providerOptions:f,abortSignal:s,headers:T}),n={id:t.response?.id??p(),timestamp:t.response?.timestamp??m(),modelId:t.response?.modelId??g.modelId,headers:t.response?.headers,body:t.response?.body},r=px(t.content),i=VS(t.content);if(r===void 0)throw new ty({message:`No object generated: the model did not return a response.`,response:n,usage:tx(t.usage),finishReason:t.finishReason.unified});return e.setAttributes(await $b({telemetry:u,attributes:{"ai.response.finishReason":t.finishReason.unified,"ai.response.object":{output:()=>r},"ai.response.id":n.id,"ai.response.model":n.modelId,"ai.response.timestamp":n.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(t.providerMetadata),"ai.usage.promptTokens":t.usage.inputTokens.total,"ai.usage.completionTokens":t.usage.outputTokens.total,"gen_ai.response.finish_reasons":[t.finishReason.unified],"gen_ai.response.id":n.id,"gen_ai.response.model":n.modelId,"gen_ai.usage.input_tokens":t.usage.inputTokens.total,"gen_ai.usage.output_tokens":t.usage.outputTokens.total}})),{...t,objectText:r,reasoning:i,responseData:n}}}));t=ie.objectText,n=ie.finishReason.unified,o=tx(ie.usage),c=ie.warnings,x=ie.providerMetadata,v=ie.request??{},_=ie.responseData,re=ie.reasoning,Hy({warnings:c,provider:g.provider,model:g.modelId});let ae=await JS(t,C,l,{response:_,usage:o,finishReason:n});return e.setAttributes(await $b({telemetry:u,attributes:{"ai.response.finishReason":n,"ai.response.object":{output:()=>JSON.stringify(ae)},"ai.response.providerMetadata":JSON.stringify(x),"ai.usage.promptTokens":o.inputTokens,"ai.usage.completionTokens":o.outputTokens}})),new QS({object:ae,reasoning:re,finishReason:n,usage:o,warnings:c,request:v,response:_,providerMetadata:x})}})}catch(e){throw Wb(e)}}var QS=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.reasoning=e.reasoning}toJsonResponse(e){return new Response(JSON.stringify(this.object),{status:e?.status??200,headers:zx(e?.headers,{"content-type":`application/json; charset=utf-8`})})}};function $S(e,t){if(e.length!==t.length)throw new Tv({parameter:`vector1,vector2`,value:{vector1Length:e.length,vector2Length:t.length},message:`Vectors must have the same length`});let n=e.length;if(n===0)return 0;let r=0,i=0,a=0;for(let o=0;o<n;o++){let n=e[o],s=t[o];r+=n*n,i+=s*s,a+=n*s}return r===0||i===0?0:a/(Math.sqrt(r)*Math.sqrt(i))}function eC(e){let[t,n]=e.split(`,`);if(t.split(`;`)[0].split(`:`)[1]==null||n==null)throw Error(`Invalid data URL format`);try{return window.atob(n)}catch{throw Error(`Error decoding data URL`)}}function tC(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!=`object`&&typeof t!=`object`)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!tC(e[n],t[n]))return!1;return!0}let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let i of n)if(!r.includes(i)||!tC(e[i],t[i]))return!1;return!0}var nC=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,n)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){n(e)}}),this.processQueue()})}};function rC({chunks:e,initialDelayInMs:t=0,chunkDelayInMs:n=0,_internal:r}){let i=r?.delay??Zl,a=0;return new ReadableStream({async pull(r){a<e.length?(await i(a===0?t:n),r.enqueue(e[a++])):r.close()}})}var iC=mu({prefix:`aiobj`,size:24});function aC(e){let{model:t,output:n=`object`,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,experimental_repairText:l,experimental_telemetry:u,experimental_download:d,providerOptions:f,onError:p=({error:e})=>{console.error(e)},onFinish:m,_internal:{generateId:h=iC,currentDate:g=()=>new Date,now:_=mS}={},...v}=e,y=`enum`in e&&e.enum?e.enum:void 0,{schema:b,schemaDescription:x,schemaName:S}=`schema`in e?e:{};return YS({output:n,schema:b,schemaName:S,schemaDescription:x,enumValues:y}),new oC({model:t,telemetry:u,headers:c,settings:v,maxRetries:o,abortSignal:s,outputStrategy:KS({output:n,schema:b,enumValues:y}),system:r,prompt:i,messages:a,schemaName:S,schemaDescription:x,providerOptions:f,repairText:l,onError:p,onFinish:m,download:d,generateId:h,currentDate:g,now:_})}var oC=class{constructor({model:e,headers:t,telemetry:n,settings:r,maxRetries:i,abortSignal:a,outputStrategy:o,system:s,prompt:c,messages:l,schemaName:u,schemaDescription:d,providerOptions:f,repairText:p,onError:m,onFinish:h,download:g,generateId:_,currentDate:v,now:y}){this._object=new $l,this._usage=new $l,this._providerMetadata=new $l,this._warnings=new $l,this._request=new $l,this._response=new $l,this._finishReason=new $l;let b=Qy(e),{maxRetries:x,retry:S}=ux({maxRetries:i,abortSignal:a}),C=Tb(r),w=Kb({model:b,telemetry:n,headers:t,settings:{...C,maxRetries:x}}),T=Xb(n),ee=this,te=pS(),ne=new TransformStream({transform(e,t){t.enqueue(e),e.type===`error`&&m({error:Wb(e.error)})}});this.baseStream=te.stream.pipeThrough(ne),Zb({name:`ai.streamObject`,attributes:$b({telemetry:n,attributes:{...Gb({operationId:`ai.streamObject`,telemetry:n}),...w,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:c,messages:l})},"ai.schema":{input:async()=>JSON.stringify(await o.jsonSchema())},"ai.schema.name":u,"ai.schema.description":d,"ai.settings.output":o.type}}),tracer:T,endWhenDone:!1,fn:async e=>{let i=await Ub({system:s,prompt:c,messages:l}),m={responseFormat:{type:`json`,schema:await o.jsonSchema(),name:u,description:d},...Tb(r),prompt:await vb({prompt:i,supportedUrls:await b.supportedUrls,download:g}),providerOptions:f,abortSignal:a,headers:t,includeRawChunks:!1},x={transform:(e,t)=>{switch(e.type){case`text-delta`:t.enqueue(e.delta);break;case`response-metadata`:case`finish`:case`error`:case`stream-start`:t.enqueue(e);break}}},{result:{stream:ne,response:re,request:E},doStreamSpan:ie,startTimestampMs:ae}=await S(()=>Zb({name:`ai.streamObject.doStream`,attributes:$b({telemetry:n,attributes:{...Gb({operationId:`ai.streamObject.doStream`,telemetry:n}),...w,"ai.prompt.messages":{input:()=>ex(m.prompt)},"gen_ai.system":b.provider,"gen_ai.request.model":b.modelId,"gen_ai.request.frequency_penalty":C.frequencyPenalty,"gen_ai.request.max_tokens":C.maxOutputTokens,"gen_ai.request.presence_penalty":C.presencePenalty,"gen_ai.request.temperature":C.temperature,"gen_ai.request.top_k":C.topK,"gen_ai.request.top_p":C.topP}}),tracer:T,endWhenDone:!1,fn:async e=>({startTimestampMs:y(),doStreamSpan:e,result:await b.doStream(m)})}));ee._request.resolve(E??{});let oe,se=nx(),ce,le,D,ue,de=``,fe=``,pe={id:_(),timestamp:v(),modelId:b.modelId},me,he,ge=!0,_e=!0,ve=ne.pipeThrough(new TransformStream(x)).pipeThrough(new TransformStream({async transform(e,t){if(typeof e==`object`&&e.type===`stream-start`){oe=e.warnings;return}if(ge){let e=y()-ae;ge=!1,ie.addEvent(`ai.stream.firstChunk`,{"ai.stream.msToFirstChunk":e}),ie.setAttributes({"ai.stream.msToFirstChunk":e})}if(typeof e==`string`){de+=e,fe+=e;let{value:n,state:r}=await yx(de);if(n!==void 0&&!tC(me,n)){let e=await o.validatePartialResult({value:n,textDelta:fe,latestObject:he,isFirstDelta:_e,isFinalDelta:r===`successful-parse`});e.success&&!tC(he,e.value.partial)&&(me=n,he=e.value.partial,t.enqueue({type:`object`,object:he}),t.enqueue({type:`text-delta`,textDelta:e.value.textDelta}),fe=``,_e=!1)}return}switch(e.type){case`response-metadata`:pe={id:e.id??pe.id,timestamp:e.timestamp??pe.timestamp,modelId:e.modelId??pe.modelId};break;case`finish`:fe!==``&&t.enqueue({type:`text-delta`,textDelta:fe}),ce=e.finishReason.unified,se=tx(e.usage),le=e.providerMetadata,t.enqueue({...e,finishReason:e.finishReason.unified,usage:se,response:pe}),Hy({warnings:oe??[],provider:b.provider,model:b.modelId}),ee._usage.resolve(se),ee._providerMetadata.resolve(le),ee._warnings.resolve(oe),ee._response.resolve({...pe,headers:re?.headers}),ee._finishReason.resolve(ce??`other`);try{D=await JS(de,o,p,{response:pe,usage:se,finishReason:ce}),ee._object.resolve(D)}catch(e){ue=e,ee._object.reject(e)}break;default:t.enqueue(e);break}},async flush(t){try{let t=se??{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};ie.setAttributes(await $b({telemetry:n,attributes:{"ai.response.finishReason":ce,"ai.response.object":{output:()=>JSON.stringify(D)},"ai.response.id":pe.id,"ai.response.model":pe.modelId,"ai.response.timestamp":pe.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(le),"ai.usage.inputTokens":t.inputTokens,"ai.usage.outputTokens":t.outputTokens,"ai.usage.totalTokens":t.totalTokens,"ai.usage.reasoningTokens":t.reasoningTokens,"ai.usage.cachedInputTokens":t.cachedInputTokens,"gen_ai.response.finish_reasons":[ce],"gen_ai.response.id":pe.id,"gen_ai.response.model":pe.modelId,"gen_ai.usage.input_tokens":t.inputTokens,"gen_ai.usage.output_tokens":t.outputTokens}})),ie.end(),e.setAttributes(await $b({telemetry:n,attributes:{"ai.usage.inputTokens":t.inputTokens,"ai.usage.outputTokens":t.outputTokens,"ai.usage.totalTokens":t.totalTokens,"ai.usage.reasoningTokens":t.reasoningTokens,"ai.usage.cachedInputTokens":t.cachedInputTokens,"ai.response.object":{output:()=>JSON.stringify(D)},"ai.response.providerMetadata":JSON.stringify(le)}})),await h?.({usage:t,object:D,error:ue,response:{...pe,headers:re?.headers},warnings:oe,providerMetadata:le})}catch(e){t.enqueue({type:`error`,error:e})}finally{e.end()}}}));te.addStream(ve)}}).catch(e=>{te.addStream(new ReadableStream({start(t){t.enqueue({type:`error`,error:e}),t.close()}}))}).finally(()=>{te.close()}),this.outputStrategy=o}get object(){return this._object.promise}get usage(){return this._usage.promise}get providerMetadata(){return this._providerMetadata.promise}get warnings(){return this._warnings.promise}get request(){return this._request.promise}get response(){return this._response.promise}get finishReason(){return this._finishReason.promise}get partialObjectStream(){return uS(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case`object`:t.enqueue(e.object);break;case`text-delta`:case`finish`:case`error`:break;default:{let t=e;throw Error(`Unsupported chunk type: ${t}`)}}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return uS(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case`text-delta`:t.enqueue(e.textDelta);break;case`object`:case`finish`:case`error`:break;default:{let t=e;throw Error(`Unsupported chunk type: ${t}`)}}}})))}get fullStream(){return uS(this.baseStream)}pipeTextStreamToResponse(e,t){Hx({response:e,textStream:this.textStream,...t})}toTextStreamResponse(e){return Bx({textStream:this.textStream,...e})}},sC=class extends mx{constructor({data:e,mediaType:t}){super({data:e,mediaType:t});let n=`mp3`;if(t){let e=t.split(`/`);e.length===2&&t!==`audio/mpeg`&&(n=e[1])}if(!n)throw Error(`Audio format must be provided or determinable from media type`);this.format=n}};async function cC({model:e,text:t,voice:n,outputFormat:r,instructions:i,speed:a,language:o,providerOptions:s={},maxRetries:c,abortSignal:l,headers:u}){let d=tb(e);if(!d)throw Error(`Model could not be resolved`);let f=Su(u??{},`ai/${lb}`),{retry:p}=ux({maxRetries:c,abortSignal:l}),m=await p(()=>d.doGenerate({text:t,voice:n,outputFormat:r,instructions:i,speed:a,language:o,abortSignal:l,headers:f,providerOptions:s}));if(!m.audio||m.audio.length===0)throw new sy({responses:[m.response]});return Hy({warnings:m.warnings,provider:d.provider,model:d.modelId}),new lC({audio:new sC({data:m.audio,mediaType:cb({data:m.audio,signatures:ab})??`audio/mp3`}),warnings:m.warnings,responses:[m.response],providerMetadata:m.providerMetadata})}var lC=class{constructor(e){this.audio=e.audio,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata??{}}};function uC({messages:e,reasoning:t=`none`,toolCalls:n=[],emptyMessages:r=`remove`}){(t===`all`||t===`before-last-message`)&&(e=e.map((n,r)=>n.role!==`assistant`||typeof n.content==`string`||t===`before-last-message`&&r===e.length-1?n:{...n,content:n.content.filter(e=>e.type!==`reasoning`)})),n===`none`?n=[]:n===`all`?n=[{type:`all`}]:n===`before-last-message`?n=[{type:`before-last-message`}]:typeof n==`string`&&(n=[{type:n}]);for(let t of n){let n=t.type===`all`?void 0:t.type===`before-last-message`?1:Number(t.type.slice(12).slice(0,-9)),r=new Set,i=new Set;if(n!=null){for(let t of e.slice(-n))if((t.role===`assistant`||t.role===`tool`)&&typeof t.content!=`string`)for(let e of t.content)e.type===`tool-call`||e.type===`tool-result`?r.add(e.toolCallId):(e.type===`tool-approval-request`||e.type===`tool-approval-response`)&&i.add(e.approvalId)}e=e.map((a,o)=>{if(a.role!==`assistant`&&a.role!==`tool`||typeof a.content==`string`||n&&o>=e.length-n)return a;let s={},c={};return{...a,content:a.content.filter(e=>e.type!==`tool-call`&&e.type!==`tool-result`&&e.type!==`tool-approval-request`&&e.type!==`tool-approval-response`||(e.type===`tool-call`?s[e.toolCallId]=e.toolName:e.type===`tool-approval-request`&&(c[e.approvalId]=s[e.toolCallId]),(e.type===`tool-call`||e.type===`tool-result`)&&r.has(e.toolCallId)||(e.type===`tool-approval-request`||e.type===`tool-approval-response`)&&i.has(e.approvalId))?!0:t.tools!=null&&!t.tools.includes(e.type===`tool-call`||e.type===`tool-result`?e.toolName:c[e.approvalId]))}})}return r===`remove`&&(e=e.filter(e=>e.content.length>0)),e}var dC={word:/\S+\s+/m,line:/\n+/m};function fC({delayInMs:e=10,chunking:t=`word`,_internal:{delay:n=Zl}={}}={}){let r;if(typeof t==`function`)r=e=>{let n=t(e);if(n==null)return null;if(!n.length)throw Error(`Chunking function must return a non-empty string.`);if(!e.startsWith(n))throw Error(`Chunking function must return a match that is a prefix of the buffer. Received: "${n}" expected to start with "${e}"`);return n};else{let e=typeof t==`string`?dC[t]:t;if(e==null)throw new w({argument:`chunking`,message:`Chunking must be "word" or "line" or a RegExp. Received: ${t}`});r=t=>{let n=e.exec(t);return n?t.slice(0,n.index)+n?.[0]:null}}return()=>{let t=``,i=``;return new TransformStream({async transform(a,o){if(a.type!==`text-delta`){t.length>0&&(o.enqueue({type:`text-delta`,text:t,id:i}),t=``),o.enqueue(a);return}a.id!==i&&t.length>0&&(o.enqueue({type:`text-delta`,text:t,id:i}),t=``),t+=a.text,i=a.id;let s;for(;(s=r(t))!=null;)o.enqueue({type:`text-delta`,text:s,id:i}),t=t.slice(s.length),await n(e)}})}}function pC({settings:e}){return{specificationVersion:`v3`,transformParams:async({params:t})=>ox(e,t)}}function mC({settings:e}){return{specificationVersion:`v3`,transformParams:async({params:t})=>ox(e,t)}}function hC(e,t){if(t.length===0)return null;let n=e.indexOf(t);if(n!==-1)return n;for(let n=e.length-1;n>=0;n--){let r=e.substring(n);if(t.startsWith(r))return n}return null}function gC({tagName:e,separator:t=`
`,startWithReasoning:n=!1}){let r=`<${e}>`,i=`</${e}>`;return{specificationVersion:`v3`,wrapGenerate:async({doGenerate:e})=>{let{content:a,...o}=await e(),s=[];for(let e of a){if(e.type!==`text`){s.push(e);continue}let a=n?r+e.text:e.text,o=RegExp(`${r}(.*?)${i}`,`gs`),c=Array.from(a.matchAll(o));if(!c.length){s.push(e);continue}let l=c.map(e=>e[1]).join(t),u=a;for(let e=c.length-1;e>=0;e--){let n=c[e],r=u.slice(0,n.index),i=u.slice(n.index+n[0].length);u=r+(r.length>0&&i.length>0?t:``)+i}s.push({type:`reasoning`,text:l}),s.push({type:`text`,text:u})}return{content:s,...o}},wrapStream:async({doStream:e})=>{let{stream:a,...o}=await e(),s={},c;return{stream:a.pipeThrough(new TransformStream({transform:(e,a)=>{if(e.type===`text-start`){c=e;return}if(e.type===`text-end`&&c&&(a.enqueue(c),c=void 0),e.type!==`text-delta`){a.enqueue(e);return}s[e.id]??(s[e.id]={isFirstReasoning:!0,isFirstText:!0,afterSwitch:!1,isReasoning:n,buffer:``,idCounter:0,textId:e.id});let o=s[e.id];o.buffer+=e.delta;function l(e){if(e.length>0){let n=o.afterSwitch&&(o.isReasoning?!o.isFirstReasoning:!o.isFirstText)?t:``;o.isReasoning&&(o.afterSwitch||o.isFirstReasoning)&&a.enqueue({type:`reasoning-start`,id:`reasoning-${o.idCounter}`}),o.isReasoning?a.enqueue({type:`reasoning-delta`,delta:n+e,id:`reasoning-${o.idCounter}`}):(c&&=(a.enqueue(c),void 0),a.enqueue({type:`text-delta`,delta:n+e,id:o.textId})),o.afterSwitch=!1,o.isReasoning?o.isFirstReasoning=!1:o.isFirstText=!1}}do{let e=o.isReasoning?i:r,t=hC(o.buffer,e);if(t==null){l(o.buffer),o.buffer=``;break}if(l(o.buffer.slice(0,t)),t+e.length<=o.buffer.length)o.buffer=o.buffer.slice(t+e.length),o.isReasoning&&a.enqueue({type:`reasoning-end`,id:`reasoning-${o.idCounter++}`}),o.isReasoning=!o.isReasoning,o.afterSwitch=!0;else{o.buffer=o.buffer.slice(t);break}}while(!0)}})),...o}}}}function _C(){return{specificationVersion:`v3`,wrapStream:async({doGenerate:e})=>{let t=await e(),n=0;return{stream:new ReadableStream({start(e){e.enqueue({type:`stream-start`,warnings:t.warnings}),e.enqueue({type:`response-metadata`,...t.response});for(let r of t.content)switch(r.type){case`text`:r.text.length>0&&(e.enqueue({type:`text-start`,id:String(n)}),e.enqueue({type:`text-delta`,id:String(n),delta:r.text}),e.enqueue({type:`text-end`,id:String(n)}),n++);break;case`reasoning`:e.enqueue({type:`reasoning-start`,id:String(n),providerMetadata:r.providerMetadata}),e.enqueue({type:`reasoning-delta`,id:String(n),delta:r.text}),e.enqueue({type:`reasoning-end`,id:String(n)}),n++;break;default:e.enqueue(r);break}e.enqueue({type:`finish`,finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata}),e.close()}}),request:t.request,response:t.response}}}}function vC(e){return JSON.stringify(e.input)}function yC({prefix:e=`Input Examples:`,format:t=vC,remove:n=!0}={}){return{specificationVersion:`v3`,transformParams:async({params:r})=>{if(!r.tools?.length)return r;let i=r.tools.map(r=>{if(r.type!==`function`||!r.inputExamples?.length)return r;let i=`${e}
${r.inputExamples.map((e,n)=>t(e,n)).join(`
`)}`,a=r.description?`${r.description}

${i}`:i;return{...r,description:a,inputExamples:n?void 0:r.inputExamples}});return{...r,tools:i}}}}var bC=({model:e,middleware:t,modelId:n,providerId:r})=>[..._b(t)].reverse().reduce((e,t)=>xC({model:e,middleware:t,modelId:n,providerId:r}),e),xC=({model:e,middleware:{transformParams:t,wrapGenerate:n,wrapStream:r,overrideProvider:i,overrideModelId:a,overrideSupportedUrls:o},modelId:s,providerId:c})=>{async function l({params:n,type:r}){return t?await t({params:n,type:r,model:e}):n}return{specificationVersion:`v3`,provider:c??i?.({model:e})??e.provider,modelId:s??a?.({model:e})??e.modelId,supportedUrls:o?.({model:e})??e.supportedUrls,async doGenerate(t){let r=await l({params:t,type:`generate`}),i=async()=>e.doGenerate(r);return n?n({doGenerate:i,doStream:async()=>e.doStream(r),params:r,model:e}):i()},async doStream(t){let n=await l({params:t,type:`stream`}),i=async()=>e.doGenerate(n),a=async()=>e.doStream(n);return r?r({doGenerate:i,doStream:a,params:n,model:e}):a()}}},SC=({model:e,middleware:t,modelId:n,providerId:r})=>[..._b(t)].reverse().reduce((e,t)=>CC({model:e,middleware:t,modelId:n,providerId:r}),e),CC=({model:e,middleware:{transformParams:t,wrapEmbed:n,overrideProvider:r,overrideModelId:i,overrideMaxEmbeddingsPerCall:a,overrideSupportsParallelCalls:o},modelId:s,providerId:c})=>{async function l({params:n}){return t?await t({params:n,model:e}):n}return{specificationVersion:`v3`,provider:c??r?.({model:e})??e.provider,modelId:s??i?.({model:e})??e.modelId,maxEmbeddingsPerCall:a?.({model:e})??e.maxEmbeddingsPerCall,supportsParallelCalls:o?.({model:e})??e.supportsParallelCalls,async doEmbed(t){let r=await l({params:t}),i=async()=>e.doEmbed(r);return n?n({doEmbed:i,params:r,model:e}):i()}}};function wC(e){if(`specificationVersion`in e&&e.specificationVersion===`v3`)return e;let t=e;return{specificationVersion:`v3`,languageModel:e=>Ky(t.languageModel(e)),embeddingModel:e=>Wy(t.textEmbeddingModel(e)),imageModel:e=>Gy(t.imageModel(e)),transcriptionModel:t.transcriptionModel?e=>Zy(t.transcriptionModel(e)):void 0,speechModel:t.speechModel?e=>Xy(t.speechModel(e)):void 0,rerankingModel:void 0}}function TC({provider:e,languageModelMiddleware:t}){let n=wC(e);return{specificationVersion:`v3`,languageModel:e=>bC({model:n.languageModel(e),middleware:t}),embeddingModel:n.embeddingModel,imageModel:n.imageModel,transcriptionModel:n.transcriptionModel,speechModel:n.speechModel,rerankingModel:n.rerankingModel}}function EC({languageModels:e,embeddingModels:t,imageModels:n,transcriptionModels:r,speechModels:i,rerankingModels:a,fallbackProvider:o}){let s=o?wC(o):void 0;return{specificationVersion:`v3`,languageModel(t){if(e!=null&&t in e)return e[t];if(s)return s.languageModel(t);throw new Re({modelId:t,modelType:`languageModel`})},embeddingModel(e){if(t!=null&&e in t)return t[e];if(s)return s.embeddingModel(e);throw new Re({modelId:e,modelType:`embeddingModel`})},imageModel(e){if(n!=null&&e in n)return n[e];if(s?.imageModel)return s.imageModel(e);throw new Re({modelId:e,modelType:`imageModel`})},transcriptionModel(e){if(r!=null&&e in r)return r[e];if(s?.transcriptionModel)return s.transcriptionModel(e);throw new Re({modelId:e,modelType:`transcriptionModel`})},speechModel(e){if(i!=null&&e in i)return i[e];if(s?.speechModel)return s.speechModel(e);throw new Re({modelId:e,modelType:`speechModel`})},rerankingModel(e){if(a!=null&&e in a)return a[e];if(s?.rerankingModel)return s.rerankingModel(e);throw new Re({modelId:e,modelType:`rerankingModel`})}}}var DC=EC,OC=`AI_NoSuchProviderError`,kC=`vercel.ai.error.${OC}`,AC=Symbol.for(kC),jC,MC=class extends Re{constructor({modelId:e,modelType:t,providerId:n,availableProviders:r,message:i=`No such provider: ${n} (available providers: ${r.join()})`}){super({errorName:OC,modelId:e,modelType:t,message:i}),this[jC]=!0,this.providerId=n,this.availableProviders=r}static isInstance(e){return a.hasMarker(e,kC)}};jC=AC;function NC(e,{separator:t=`:`,languageModelMiddleware:n}={}){let r=new FC({separator:t,languageModelMiddleware:n});for(let[t,n]of Object.entries(e))r.registerProvider({id:t,provider:n});return r}var PC=NC,FC=class{constructor({separator:e,languageModelMiddleware:t}){this.providers={},this.separator=e,this.languageModelMiddleware=t}registerProvider({id:e,provider:t}){this.providers[e]=t}getProvider(e,t){let n=this.providers[e];if(n==null)throw new MC({modelId:e,modelType:t,providerId:e,availableProviders:Object.keys(this.providers)});return n}splitId(e,t){let n=e.indexOf(this.separator);if(n===-1)throw new Re({modelId:e,modelType:t,message:`Invalid ${t} id for registry: ${e} (must be in the format "providerId${this.separator}modelId")`});return[e.slice(0,n),e.slice(n+this.separator.length)]}languageModel(e){var t;let[n,r]=this.splitId(e,`languageModel`),i=(t=this.getProvider(n,`languageModel`)).languageModel?.call(t,r);if(i==null)throw new Re({modelId:e,modelType:`languageModel`});return this.languageModelMiddleware!=null&&(i=bC({model:i,middleware:this.languageModelMiddleware})),i}embeddingModel(e){let[t,n]=this.splitId(e,`embeddingModel`),r=this.getProvider(t,`embeddingModel`),i=r.embeddingModel?.call(r,n);if(i==null)throw new Re({modelId:e,modelType:`embeddingModel`});return i}imageModel(e){let[t,n]=this.splitId(e,`imageModel`),r=this.getProvider(t,`imageModel`),i=r.imageModel?.call(r,n);if(i==null)throw new Re({modelId:e,modelType:`imageModel`});return i}transcriptionModel(e){let[t,n]=this.splitId(e,`transcriptionModel`),r=this.getProvider(t,`transcriptionModel`),i=r.transcriptionModel?.call(r,n);if(i==null)throw new Re({modelId:e,modelType:`transcriptionModel`});return i}speechModel(e){let[t,n]=this.splitId(e,`speechModel`),r=this.getProvider(t,`speechModel`),i=r.speechModel?.call(r,n);if(i==null)throw new Re({modelId:e,modelType:`speechModel`});return i}rerankingModel(e){let[t,n]=this.splitId(e,`rerankingModel`),r=this.getProvider(t,`rerankingModel`),i=r.rerankingModel?.call(r,n);if(i==null)throw new Re({modelId:e,modelType:`rerankingModel`});return i}};async function IC({model:e,documents:t,query:n,topN:r,maxRetries:i,abortSignal:a,headers:o,providerOptions:s,experimental_telemetry:c}){if(t.length===0)return new LC({originalDocuments:[],ranking:[],providerMetadata:void 0,response:{timestamp:new Date,modelId:e.modelId}});let{maxRetries:l,retry:u}=ux({maxRetries:i,abortSignal:a}),d=typeof t[0]==`string`?{type:`text`,values:t}:{type:`object`,values:t},f=Kb({model:e,telemetry:c,headers:o,settings:{maxRetries:l}}),p=Xb(c);return Zb({name:`ai.rerank`,attributes:$b({telemetry:c,attributes:{...Gb({operationId:`ai.rerank`,telemetry:c}),...f,"ai.documents":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async()=>{let{ranking:i,response:l,providerMetadata:m,warnings:h}=await u(()=>Zb({name:`ai.rerank.doRerank`,attributes:$b({telemetry:c,attributes:{...Gb({operationId:`ai.rerank.doRerank`,telemetry:c}),...f,"ai.documents":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:p,fn:async t=>{let i=await e.doRerank({documents:d,query:n,topN:r,providerOptions:s,abortSignal:a,headers:o}),l=i.ranking;return t.setAttributes(await $b({telemetry:c,attributes:{"ai.ranking.type":d.type,"ai.ranking":{output:()=>l.map(e=>JSON.stringify(e))}}})),{ranking:l,providerMetadata:i.providerMetadata,response:i.response,warnings:i.warnings}}}));return Hy({warnings:h??[],provider:e.provider,model:e.modelId}),new LC({originalDocuments:t,ranking:i.map(e=>({originalIndex:e.index,score:e.relevanceScore,document:t[e.index]})),providerMetadata:m,response:{id:l?.id,timestamp:l?.timestamp??new Date,modelId:l?.modelId??e.modelId,headers:l?.headers,body:l?.body}})}})}var LC=class{constructor(e){this.originalDocuments=e.originalDocuments,this.ranking=e.ranking,this.response=e.response,this.providerMetadata=e.providerMetadata}get rerankedDocuments(){return this.ranking.map(e=>e.document)}},RC=class extends a{constructor(e){super({name:`AI_NoTranscriptGeneratedError`,message:`No transcript generated.`}),this.responses=e.responses}};async function zC({model:e,audio:t,providerOptions:n={},maxRetries:r,abortSignal:i,headers:a}){let o=eb(e);if(!o)throw Error(`Model could not be resolved`);let{retry:s}=ux({maxRetries:r,abortSignal:i}),c=Su(a??{},`ai/${lb}`),l=t instanceof URL?(await ub({url:t})).data:gb(t),u=await s(()=>o.doGenerate({audio:l,abortSignal:i,headers:c,providerOptions:n,mediaType:cb({data:l,signatures:ab})??`audio/wav`}));if(Hy({warnings:u.warnings,provider:o.provider,model:o.modelId}),!u.text)throw new RC({responses:[u.response]});return new BC({text:u.text,segments:u.segments,language:u.language,durationInSeconds:u.durationInSeconds,warnings:u.warnings,responses:[u.response],providerMetadata:u.providerMetadata})}var BC=class{constructor(e){this.text=e.text,this.segments=e.segments,this.language=e.language,this.durationInSeconds=e.durationInSeconds,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=e.providerMetadata??{}}};async function VC({stream:e,onTextPart:t}){let n=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:e,value:r}=await n.read();if(e)break;await t(r)}}var HC=()=>fetch;async function UC({api:e,prompt:t,credentials:n,headers:r,body:i,streamProtocol:a=`data`,setCompletion:o,setLoading:s,setError:c,setAbortController:l,onFinish:u,onError:d,fetch:f=HC()}){try{s(!0),c(void 0);let d=new AbortController;l(d),o(``);let p=await f(e,{method:`POST`,body:JSON.stringify({prompt:t,...i}),credentials:n,headers:Su({"Content-Type":`application/json`,...r},`ai-sdk/${lb}`,bu()),signal:d.signal}).catch(e=>{throw e});if(!p.ok)throw Error(await p.text()??`Failed to fetch the chat response.`);if(!p.body)throw Error(`The response body is empty.`);let m=``;switch(a){case`text`:await VC({stream:p.body,onTextPart:e=>{m+=e,o(m)}});break;case`data`:await dS({stream:tf({stream:p.body,schema:qx}).pipeThrough(new TransformStream({async transform(e){if(!e.success)throw e.error;let t=e.value;if(t.type===`text-delta`)m+=t.delta,o(m);else if(t.type===`error`)throw Error(t.errorText)}})),onError:e=>{throw e}});break;default:{let e=a;throw Error(`Unknown stream protocol: ${e}`)}}return u&&u(t,m),l(null),m}catch(e){if(e.name===`AbortError`)return l(null),null;e instanceof Error&&d&&d(e),c(e)}finally{s(!1)}}async function WC(e){if(e==null)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error(`FileList is not supported in the current environment`);return Promise.all(Array.from(e).map(async e=>{let{name:t,type:n}=e;return{type:`file`,mediaType:n,filename:t,url:await new Promise((t,n)=>{let r=new FileReader;r.onload=e=>{t(e.target?.result)},r.onerror=e=>n(e),r.readAsDataURL(e)})}}))}var GC=class{constructor({api:e=`/api/chat`,credentials:t,headers:n,body:r,fetch:i,prepareSendMessagesRequest:a,prepareReconnectToStreamRequest:o}){this.api=e,this.credentials=t,this.headers=n,this.body=r,this.fetch=i,this.prepareSendMessagesRequest=a,this.prepareReconnectToStreamRequest=o}async sendMessages({abortSignal:e,...t}){let n=await ff(this.body),r=await ff(this.headers),i=await ff(this.credentials),a={...xu(r),...xu(t.headers)},o=await this.prepareSendMessagesRequest?.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...n,...t.body},headers:a,credentials:i,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId}),s=o?.api??this.api,c=o?.headers===void 0?a:xu(o.headers),l=o?.body===void 0?{...n,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId}:o.body,u=o?.credentials??i,d=await(this.fetch??globalThis.fetch)(s,{method:`POST`,headers:Su({"Content-Type":`application/json`,...c},`ai-sdk/${lb}`,bu()),body:JSON.stringify(l),credentials:u,signal:e});if(!d.ok)throw Error(await d.text()??`Failed to fetch the chat response.`);if(!d.body)throw Error(`The response body is empty.`);return this.processResponseStream(d.body)}async reconnectToStream(e){let t=await ff(this.body),n=await ff(this.headers),r=await ff(this.credentials),i={...xu(n),...xu(e.headers)},a=await this.prepareReconnectToStreamRequest?.call(this,{api:this.api,id:e.chatId,body:{...t,...e.body},headers:i,credentials:r,requestMetadata:e.metadata}),o=a?.api??`${this.api}/${e.chatId}/stream`,s=a?.headers===void 0?i:xu(a.headers),c=a?.credentials??r,l=await(this.fetch??globalThis.fetch)(o,{method:`GET`,headers:Su(s,`ai-sdk/${lb}`,bu()),credentials:c});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??`Failed to fetch the chat response.`);if(!l.body)throw Error(`The response body is empty.`);return this.processResponseStream(l.body)}},KC=class extends GC{constructor(e={}){super(e)}processResponseStream(e){return tf({stream:e,schema:qx}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},qC=class{constructor({generateId:e=hu,id:t=e(),transport:n=new KC,messageMetadataSchema:r,dataPartSchemas:i,state:a,onError:o,onToolCall:s,onFinish:c,onData:l,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new nC,this.sendMessage=async(e,t)=>{if(e==null){await this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id,...t});return}let n;if(n=`text`in e||`files`in e?{parts:[...Array.isArray(e.files)?e.files:await WC(e.files),...`text`in e&&e.text!=null?[{type:`text`,text:e.text}]:[]]}:e,e.messageId!=null){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(t===-1)throw Error(`message with id ${e.messageId} not found`);if(this.state.messages[t].role!==`user`)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...n,id:e.messageId,role:n.role??`user`,metadata:e.metadata})}else this.state.pushMessage({...n,id:n.id??this.generateId(),role:n.role??`user`,metadata:e.metadata});await this.makeRequest({trigger:`submit-message`,messageId:e.messageId,...t})},this.regenerate=async({messageId:e,...t}={})=>{let n=e==null?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(n===-1)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,this.messages[n].role===`assistant`?n:n+1),await this.makeRequest({trigger:`regenerate-message`,messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:`resume-stream`,...e})},this.clearError=()=>{this.status===`error`&&(this.state.error=void 0,this.setStatus({status:`ready`}))},this.addToolApprovalResponse=async({id:e,approved:t,reason:n})=>this.jobExecutor.run(async()=>{let r=this.state.messages,i=r[r.length-1],a=r=>tS(r)&&r.state===`approval-requested`&&r.approval.id===e?{...r,state:`approval-responded`,approval:{id:e,approved:t,reason:n}}:r;this.state.replaceMessage(r.length-1,{...i,parts:i.parts.map(a)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(a)),this.status!==`streaming`&&this.status!==`submitted`&&this.sendAutomaticallyWhen?.call(this,{messages:this.state.messages})&&this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id})}),this.addToolOutput=async({state:e=`output-available`,tool:t,toolCallId:n,output:r,errorText:i})=>this.jobExecutor.run(async()=>{let t=this.state.messages,a=t[t.length-1],o=t=>tS(t)&&t.toolCallId===n?{...t,state:e,output:r,errorText:i}:t;this.state.replaceMessage(t.length-1,{...a,parts:a.parts.map(o)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(o)),this.status!==`streaming`&&this.status!==`submitted`&&this.sendAutomaticallyWhen?.call(this,{messages:this.state.messages})&&this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{this.status!==`streaming`&&this.status!==`submitted`||this.activeResponse?.abortController&&this.activeResponse.abortController.abort()},this.id=t,this.transport=n,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=i,this.state=a,this.onError=o,this.onToolCall=s,this.onFinish=c,this.onData=l,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:n,body:r,messageId:i}){var a;this.setStatus({status:`submitted`,error:void 0});let o=this.lastMessage,s=!1,c=!1,l=!1;try{let a={state:oS({lastMessage:this.state.snapshot(o),messageId:this.generateId()}),abortController:new AbortController};a.abortController.signal.addEventListener(`abort`,()=>{s=!0}),this.activeResponse=a;let c;if(e===`resume-stream`){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:n,body:r});if(e==null){this.setStatus({status:`ready`});return}c=e}else c=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:a.abortController.signal,metadata:t,headers:n,body:r,trigger:e,messageId:i});await dS({stream:sS({stream:c,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:e=>this.jobExecutor.run(()=>e({state:a.state,write:()=>{this.setStatus({status:`streaming`}),a.state.message.id===this.lastMessage?.id?this.state.replaceMessage(this.state.messages.length-1,a.state.message):this.state.pushMessage(a.state.message)}})),onError:e=>{throw e}}),onError:e=>{throw e}}),this.setStatus({status:`ready`})}catch(e){if(s||e.name===`AbortError`)return s=!0,this.setStatus({status:`ready`}),null;l=!0,e instanceof TypeError&&(e.message.toLowerCase().includes(`fetch`)||e.message.toLowerCase().includes(`network`))&&(c=!0),this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:`error`,error:e})}finally{try{(a=this.onFinish)==null||a.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:s,isDisconnect:c,isError:l,finishReason:this.activeResponse?.state.finishReason})}catch(e){console.error(e)}this.activeResponse=void 0}this.sendAutomaticallyWhen?.call(this,{messages:this.state.messages})&&!l&&await this.makeRequest({trigger:`submit-message`,messageId:this.lastMessage?.id,metadata:t,headers:n,body:r})}};function JC({messages:e}){let t=e[e.length-1];if(!t||t.role!==`assistant`)return!1;let n=t.parts.reduce((e,t,n)=>t.type===`step-start`?n:e,-1),r=t.parts.slice(n+1).filter(tS).filter(e=>!e.providerExecuted);return r.filter(e=>e.state===`approval-responded`).length>0&&r.every(e=>e.state===`output-available`||e.state===`output-error`||e.state===`approval-responded`)}function YC({messages:e}){let t=e[e.length-1];if(!t||t.role!==`assistant`)return!1;let n=t.parts.reduce((e,t,n)=>t.type===`step-start`?n:e,-1),r=t.parts.slice(n+1).filter(tS).filter(e=>!e.providerExecuted);return r.length>0&&r.every(e=>e.state===`output-available`||e.state===`output-error`)}function XC({stream:e}){return e.pipeThrough(new TransformStream({start(e){e.enqueue({type:`start`}),e.enqueue({type:`start-step`}),e.enqueue({type:`text-start`,id:`text-1`})},async transform(e,t){t.enqueue({type:`text-delta`,id:`text-1`,delta:e})},async flush(e){e.enqueue({type:`text-end`,id:`text-1`}),e.enqueue({type:`finish-step`}),e.enqueue({type:`finish`})}}))}var ZC=class extends GC{constructor(e={}){super(e)}processResponseStream(e){return XC({stream:e.pipeThrough(new TextDecoderStream)})}};export{a as AISDKError,d as APICallError,qC as AbstractChat,KC as DefaultChatTransport,fu as DownloadError,_ as EmptyResponseBodyError,bS as Experimental_Agent,bS as ToolLoopAgent,GC as HttpChatTransport,Tv as InvalidArgumentError,Cy as InvalidDataContentError,Oy as InvalidMessageRoleError,E as InvalidPromptError,le as InvalidResponseDataError,Av as InvalidStreamPartError,Fv as InvalidToolApprovalError,Bv as InvalidToolInputError,me as JSONParseError,Ux as JsonToSseTransformStream,be as LoadAPIKeyError,Ee as LoadSettingError,Ny as MessageConversionError,Me as NoContentGeneratedError,Xv as NoImageGeneratedError,ty as NoObjectGeneratedError,oy as NoOutputGeneratedError,sy as NoSpeechGeneratedError,Re as NoSuchModelError,MC as NoSuchProviderError,fy as NoSuchToolError,_x as Output,Ry as RetryError,nC as SerialJobExecutor,ZC as TextStreamChatTransport,We as TooManyEmbeddingValuesForCallError,Gv as ToolCallNotFoundForApprovalError,_y as ToolCallRepairError,Xe as TypeValidationError,Wx as UI_MESSAGE_STREAM_HEADERS,nt as UnsupportedFunctionalityError,vy as UnsupportedModelVersionError,yC as addToolInputExamplesMiddleware,Gd as asSchema,Bb as assistantModelMessageSchema,UC as callCompletionApi,dS as consumeStream,WC as convertFileListToFileUIParts,CS as convertToModelMessages,$S as cosineSimilarity,DS as createAgentUIStream,OS as createAgentUIStreamResponse,_p as createAnthropic,d_ as createGateway,Zp as createGoogleGenerativeAI,mu as createIdGenerator,gm as createMistral,ng as createOpenAI,NC as createProviderRegistry,Bx as createTextStreamResponse,xS as createUIMessageStream,Gx as createUIMessageStreamResponse,EC as customProvider,pC as defaultEmbeddingSettingsMiddleware,mC as defaultSettingsMiddleware,lf as dynamicTool,AS as embed,NS as embedMany,PC as experimental_createProviderRegistry,DC as experimental_customProvider,BS as experimental_generateImage,cC as experimental_generateSpeech,zC as experimental_transcribe,gC as extractReasoningMiddleware,f_ as gateway,hu as generateId,FS as generateImage,ZS as generateObject,Px as generateText,rS as getStaticToolName,eC as getTextFromDataUrl,iS as getToolName,aS as getToolOrDynamicToolName,Ax as hasToolCall,Yx as isDataUIPart,tC as isDeepEqualData,Zx as isFileUIPart,Qx as isReasoningUIPart,$x as isStaticToolUIPart,Xx as isTextUIPart,nS as isToolOrDynamicToolUIPart,tS as isToolUIPart,Ud as jsonSchema,JC as lastAssistantMessageIsCompleteWithApprovalResponses,YC as lastAssistantMessageIsCompleteWithToolCalls,Hb as modelMessageSchema,tf as parseJsonEventStream,yx as parsePartialJson,kS as pipeAgentUIStreamToResponse,Hx as pipeTextStreamToResponse,lS as pipeUIMessageStreamToResponse,uC as pruneMessages,SS as readUIMessageStream,IC as rerank,TS as safeValidateUIMessages,rC as simulateReadableStream,_C as simulateStreamingMiddleware,fC as smoothStream,kx as stepCountIs,aC as streamObject,_S as streamText,Rb as systemModelMessageSchema,cf as tool,Vb as toolModelMessageSchema,qx as uiMessageChunkSchema,zb as userModelMessageSchema,ES as validateUIMessages,SC as wrapEmbeddingModel,bC as wrapLanguageModel,TC as wrapProvider,Q as zodSchema};
var Lc=Object.defineProperty;var Ln=p=>{throw TypeError(p)};var Dc=(p,k,T)=>k in p?Lc(p,k,{enumerable:!0,configurable:!0,writable:!0,value:T}):p[k]=T;var V=(p,k,T)=>Dc(p,typeof k!="symbol"?k+"":k,T),Rc=(p,k,T)=>k.has(p)||Ln("Cannot "+T);var Se=(p,k,T)=>(Rc(p,k,"read from private field"),T?T.call(p):k.get(p)),Dn=(p,k,T)=>k.has(p)?Ln("Cannot add the same private member more than once"):k instanceof WeakSet?k.add(p):k.set(p,T);(function(){"use strict";const p=window.Vue;function k(){return window.panel}function T(){return k().api}const me=()=>window.panel.plugins.viewButtons!==void 0;function Un(){return me()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):k().app.$store}function Be(){const e=k(),t=Un(),n=me();if(n&&!("diff"in e.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const o=q(n?()=>e.content.version("changes"):()=>t.getters["content/values"]()),r=q(n?()=>e.content.diff():()=>t.getters["content/changes"]()),i=q(n?()=>e.content.hasDiff():()=>t.getters["content/hasChanges"]()),s=n?e.content:new Proxy({},{get(){return()=>{}}});return{content:s,currentContent:o,contentChanges:r,hasChanges:i,update:async(c,u=!0)=>{if(!n&&c)for(const[h,m]of Object.entries(c))t.dispatch("content/update",[h,m]);const d=s.merge(c);u&&await s.save(d)}}}function Mn(){const e=k();function t(n){return!n||typeof n=="string"?n:n[e.translation.code]??Object.values(n)[0]}return{t}}function Fn(){const e=T();return{load:({parent:n,name:o})=>e.get(`${n}/sections/${o}`)}}const Bn={error:0,warn:1,log:2,info:3,success:3};function Nn(e){const t=new Kn;return new Proxy({},{get(n,o){return(...r)=>{t.log({level:Bn[o],type:o,tag:e,args:r})}}})}class Kn{constructor(){V(this,"defaultColor","#7f8c8d");V(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});V(this,"typeColorMap",{success:"#2ecc71"})}log(t){const n=Gn(t.level),o=t.type==="log"?"":t.type,r=t.tag||"",s=`
background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),a=`%c${[r,o].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?n(`${a}%c ${t.args[0]}`,s,"",...t.args.slice(1)):n(a,s,...t.args)}}function Gn(e){return e<1?console.error:console.log}const xe=[],Ne=new Map;async function Vn(e){if(!Array.isArray(e))throw new TypeError(`Expected an array, got ${typeof e}`);for(const t of e)xe.some(n=>n.filename===t.filename)||xe.push(t)}function gt(e){if(xe.length===0)throw new Error("Plugin assets not registered");const t=xe.find(n=>n.filename===e);if(!t)throw new Error(`Plugin asset "${e}" not found`);return t}async function te(e){if(e.endsWith(".js")||(e+=".js"),Ne.has(e))return Ne.get(e);const n=await import(gt(e).url);return Ne.set(e,n),n}const q=p.computed;p.customRef,p.defineAsyncComponent,p.defineComponent,p.effectScope,p.getCurrentInstance;const Wn=p.getCurrentScope;p.h,p.inject,p.isProxy,p.isReactive,p.isReadonly,p.isRef,p.isShallow,p.markRaw;const Yn=p.nextTick;p.onActivated,p.onBeforeMount;const Hn=p.onBeforeUnmount;p.onBeforeUpdate,p.onDeactivated,p.onErrorCaptured;const vt=p.onMounted;p.onRenderTracked,p.onRenderTriggered;const qn=p.onScopeDispose;p.onServerPrefetch,p.onUnmounted,p.onUpdated,p.provide,p.proxyRefs,p.reactive,p.readonly;const _=p.ref;p.shallowReactive,p.shallowReadonly,p.shallowRef,p.toRaw,p.toRef,p.toRefs,p.triggerRef;const Ke=p.unref;p.useAttrs,p.useCssModule,p.useCssVars,p.useListeners,p.useSlots;const Ge=p.watch;p.watchEffect,p.watchPostEffect,p.watchSyncEffect;const Ve={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible":"License key invalid for this plugin version","modal.error.upgradeable":"License key invalid for this plugin version. Upgrade now on https://hub.kirby.tools.","modal.error.activated":"License key already activated",activate:"Activate",activated:"Plugin activated",buy:"Buy a license",upgrade:"Upgrade"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.upgradeable":"Lizenzschlüssel ungültig für diese Plugin-Version. Aktualisiere jetzt auf https://hub.kirby.tools.","modal.error.activated":"Lizenzschlüssel bereits aktiviert",activate:"Aktivieren",activated:"Plugin aktiviert",buy:"Lizenz kaufen",upgrade:"Upgrade"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible":"Clé de licence invalide pour cette version du plugin","modal.error.upgradeable":"Clé de licence invalide pour cette version du plugin. Mettez à niveau maintenant sur https://hub.kirby.tools.","modal.error.activated":"Clé de licence déjà activée",activate:"Activer",activated:"Plugin activé",buy:"Acheter une licence",upgrade:"Upgrade"},nl:{"modal.info":"Bedankt voor het kopen van {label}! Voer je e-mailadres en bestelnummer in om je licentie te activeren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Vind je bestelnummer</a> op Lemon Squeezy of <a href="mailto:hello@kirby.tools">neem contact met ons op</a> als je het niet kunt vinden.',"modal.error.required.fields":"E-mailadres en bestelnummer zijn verplicht","modal.error.invalid.unauthorized":"E-mailadres of bestelnummer is onjuist","modal.error.invalid.licenseKey":"Licentiesleutel ongeldig voor dit plug-in","modal.error.incompatible":"Licentiesleutel ongeldig voor deze plug-inversie","modal.error.upgradeable":"Licentiesleutel ongeldig voor deze plug-inversie. Upgrade nu op https://hub.kirby.tools.","modal.error.activated":"Licentiesleutel al geactiveerd",activate:"Activeren",activated:"Plugin geactiveerd",buy:"Koop een licentie",upgrade:"Upgrade"}},Jn=["localhost","127.0.0.1","[::1]"],Xn=["local","test","ddev.site"];function ne(e="",t){var r;const n=window.panel.translation.code,o=((r=Ve==null?void 0:Ve[n])==null?void 0:r[e])??e;return t?Qn(o,t):o}function Qn(e,t,n){return e.replace(/\{(\w+)\}/g,(o,r)=>t[r]||r)}function eo(){const{hostname:e}=window.location,t=Jn.includes(e),n=Xn.some(o=>e.endsWith(`.${o}`));return t||n}const _t={Unauthorized:"modal.error.invalid.unauthorized","License key not valid for this plugin":"modal.error.invalid.licenseKey","License key not valid for this plugin version":"modal.error.incompatible","License key not valid for this plugin version, please upgrade your license":"modal.error.upgradeable","License key already activated":"modal.error.activated"};function to(e){const t=k();return{isLocalhost:eo(),assertActivationIntegrity:async({component:i,licenseStatus:s})=>{if(Ke(s)==="active")return;const a=Ke(i);if(!(a!=null&&a.$el)||window.getComputedStyle(a.$el).display==="none"||window.getComputedStyle(a.$el).visibility==="hidden"||window.getComputedStyle(a.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let i=!1;const{label:s}=e,a={info:{type:"info",text:ne("modal.info",{label:s})},email:{label:t.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:ne("modal.fields.orderId.help",{label:s})}};return new Promise(c=>{t.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:ne("activate",{label:s})},fields:a},on:{close:()=>{c({isLicenseActive:i})},submit:async u=>{i=await no(u,e),i&&(t.dialog.close(),t.notification.success(ne("activated")))}}})})}}}async function no(e,t){const n=k(),{email:o,orderId:r}=e;if(!o||!r)return n.notification.error(ne("modal.error.required.fields")),!1;try{const i=await n.api.post(`${t.apiNamespace}/activate`,{email:o,orderId:Number(r)});if((i==null?void 0:i.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(i){const s=i.message;return n.notification.error(_t[s]?ne(_t[s]):s),!1}}const oo=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(e){const t=e,{openLicenseModal:n,assertActivationIntegrity:o}=to({label:t.label,apiNamespace:t.apiNamespace}),r=_(t.licenseStatus),i=_();vt(()=>{o({component:i,licenseStatus:t.licenseStatus})});async function s(){const{isLicenseActive:a}=await n();a&&window.location.reload()}return{__sfc:!0,props:t,openLicenseModal:n,assertActivationIntegrity:o,currentLicenseStatus:r,licenseButtonGroup:i,handleRegistration:s,t:ne}}});function ge(e,t,n,o,r,i,s,a){var c=typeof e=="function"?e.options:e;return t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c._scopeId="data-v-"+i),{exports:e,options:c}}var ro=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return o.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:o.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":t.pricingUrl,target:"_blank",text:o.currentLicenseStatus==="upgradeable"?o.t("upgrade"):o.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:o.t("activate")},on:{click:function(r){return o.handleRegistration()}}})],1):t._e()},io=[],so=ge(oo,ro,io,!1,null,null);const bt=so.exports,ao="__copilot__/context",co="__copilot__/model-fields",uo="__copilot__/fieldsets",yt=["anthropic","google","mistral","openai"],We=["image/png","image/jpeg","image/webp","image/gif"],lo=["error","warn","info","debug"],po="kirby$copilot$",fo={list:"HTML",markdown:"markdown",textarea:"markdown",writer:"HTML"},Ye=`
You are an AI assistant integrated into the Kirby CMS Panel. Your primary task is to help users generate content for various field types within the CMS. You must provide relevant and helpful content based on the user's question and the specified field type, while considering any provided context.

Consider the user context if provided:
- If selected_text is provided, use it as context for the user's question.
- If pdf_documents are provided, incorporate the information from these documents into your response as applicable.

Format your response according to the specified response_format if provided:
1. If response_format is "text", provide your response in plain text without any Markdown or HTML syntax.
2. If response_format is "HTML", format your response using HTML syntax. Only include the content that would go inside the <body> element. Use appropriate HTML tags to structure your response, including <h2> or <h3> tags for section headings.
3. If response_format is "markdown", format your response using Markdown syntax. Do not use backticks or any other wrapping characters around your response.
`;class ve extends Error{}let _e;async function ho(e){const t=await go(),n=await e.arrayBuffer(),o=await t.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:o.numPages},(i,s)=>mo(o,s+1)))).map(i=>i.replace(/\s+/g," ")).join(`
`)}async function mo(e,t){return(await(await e.getPage(t)).getTextContent()).items.filter(r=>r.str!=null).map(r=>r.str).join(" ")}async function go(){if(_e)return _e;_e=await te("pdfjs");const e=gt("pdfjs.worker.js");return _e.GlobalWorkerOptions.workerSrc=e.url,_e}function vo(e,t,n){return e.replace(/\{(\w+)\}/g,(o,r)=>t[r.toLowerCase()]||r)}async function _o({accept:e="*",multiple:t=!0}={}){const n=document.createElement("input");return n.type="file",n.classList.add("sr-only"),n.value=null,n.accept=e,n.multiple=t,n.click(),new Promise(o=>{n.addEventListener("change",r=>{var i;o([...((i=r.target)==null?void 0:i.files)??[]]),n.remove()},{once:!0})})}async function bo(e,t){const n=await yo(e);return await wo(n,e.type,t)}async function yo(e,t={}){if(!e.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${e.type}`);const n=new Image,o=URL.createObjectURL(e);t.crossOrigin&&(n.crossOrigin=t.crossOrigin);try{return await new Promise((i,s)=>{n.addEventListener("load",()=>{i(n)}),n.addEventListener("error",s),n.src=o})}finally{URL.revokeObjectURL(o)}}async function wo(e,t,n){if(!e.complete||!e.naturalWidth)throw new Error("Image has not been properly loaded");if(!t.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${t}`);const o=document.createElement("canvas"),r=o.getContext("2d"),i=Math.min(1,n/Math.max(e.width,e.height)),s=Math.round(e.width*i),a=Math.round(e.height*i);o.width=s,o.height=a,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(e,0,0,s,a);const c=await new Promise(u=>{o.toBlob(u,t)});if(!c)throw new Error("Failed to convert canvas to Blob");return c}function ko(){const{currentContent:e}=Be(),t={...e.value,title:window.panel.view.title};return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,Array.isArray(o)||typeof o=="object"&&o!==null?JSON.stringify(o):o]))}let $o;function wt(){return $o??($o=Nn("copilot"))}let Ie,be;function W(){return Ie||be||(be=window.panel.api.get(ao).then(e=>(Vn(e.assets),Ie=e,be=void 0,Ie)),be)}async function kt({userPrompt:e,systemPrompt:t,files:n=[],logLevel:o=1,abortSignal:r}){const i=wt(),{config:s}=await W(),a=await zt(),{AISDKError:c,APICallError:u,streamText:d,smoothStream:h}=await te("ai"),{userPromptWithContext:m,imageByteArrays:f}=await St({userPrompt:e,files:n});return o>1&&(i.info("System prompt:",t),i.info("User prompt with context:",m)),d({model:a,temperature:s.temperature,system:t||void 0,...f.length>0?{messages:[{role:"user",content:[{type:"text",text:m},...f.map(v=>({type:"image",image:v}))]}]}:{prompt:m},experimental_transform:h({chunking:"line"}),abortSignal:r,onError({error:v}){if(c.isInstance(v)||u.isInstance(v))throw v}})}async function $t({userPrompt:e,systemPrompt:t,schema:n,output:o="object",files:r=[],logLevel:i=1,abortSignal:s}){const a=wt(),{config:c}=await W(),u=await zt(),{AISDKError:d,APICallError:h,streamObject:m}=await te("ai"),{userPromptWithContext:f,imageByteArrays:v}=await St({userPrompt:e,files:r});return i>1&&(a.info("System prompt:",t),a.info("User prompt with context:",f)),m({model:u,temperature:c.temperature,schema:n,output:o,...v.length>0?{messages:[{role:"user",content:[{type:"text",text:f},...v.map(y=>({type:"image",image:y}))]}]}:{prompt:f},abortSignal:s,onError({error:y}){if(d.isInstance(y)||h.isInstance(y))throw y}})}async function zt(){var u,d;let{config:e}=await W();if(!e.provider||!yt.includes(e.provider))throw new ve(`Unsupported provider "${e.provider}" in the "johannschopplich.copilot.provider" global configuration.`);for(const h of["apiKey","model"])if(!((d=(u=e.providers)==null?void 0:u[e.provider])!=null&&d[h]))throw new ve(`Missing "${h}" property in the "johannschopplich.copilot.providers.${e.provider}" global configuration.`);const{createAnthropic:t,createGoogleGenerativeAI:n,createMistral:o,createOpenAI:r}=await te("ai"),i=e.provider,s=e.providers[i],a={anthropic:t,google:n,mistral:o,openai:r}[i];return a({baseUrl:s.baseUrl||void 0,apiKey:s.apiKey}).languageModel(s.model)}async function St({userPrompt:e,files:t=[]}){const n=ko();let o=vo(e,n);const r=t.filter(a=>a.type.startsWith("image/")),i=t.filter(a=>a.type==="application/pdf");if(i.length>0){const a=await Promise.all(i.map(ho));o+=`

${a.map((c,u)=>`<pdf_document_${u+1}>
${c}
</pdf_document_${u+1}>`).join(`

`)}`}const s=await Promise.all(r.map(async a=>{const u=await(await bo(a,2048)).arrayBuffer();return new Uint8Array(u)}));return{userPromptWithContext:o,imageByteArrays:s}}function l(e,t,n){function o(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(e),t(a,c);for(const d in s.prototype)d in a||Object.defineProperty(a,d,{value:s.prototype[d].bind(a)});a._zod.constr=s,a._zod.def=c}const r=(n==null?void 0:n.Parent)??Object;class i extends r{}Object.defineProperty(i,"name",{value:e});function s(a){var c;const u=n!=null&&n.Parent?new i:this;o(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(s,"init",{value:o}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>{var c,u;return n!=null&&n.Parent&&a instanceof n.Parent?!0:(u=(c=a==null?void 0:a._zod)==null?void 0:c.traits)==null?void 0:u.has(e)}}),Object.defineProperty(s,"name",{value:e}),s}class se extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class xt extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const It={};function J(e){return It}function zo(e){const t=Object.values(e).filter(o=>typeof o=="number");return Object.entries(e).filter(([o,r])=>t.indexOf(+o)===-1).map(([o,r])=>r)}function He(e,t){return typeof t=="bigint"?t.toString():t}function qe(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Je(e){return e==null}function Xe(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function So(e,t){const n=(e.toString().split(".")[1]||"").length,o=t.toString();let r=(o.split(".")[1]||"").length;if(r===0&&/\d?e-\d?/.test(o)){const c=o.match(/\d?e-(\d?)/);c!=null&&c[1]&&(r=Number.parseInt(c[1]))}const i=n>r?n:r,s=Number.parseInt(e.toFixed(i).replace(".","")),a=Number.parseInt(t.toFixed(i).replace(".",""));return s%a/10**i}const Zt=Symbol("evaluating");function $(e,t,n){let o;Object.defineProperty(e,t,{get(){if(o!==Zt)return o===void 0&&(o=Zt,o=n()),o},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function xo(e){return Object.create(Object.getPrototypeOf(e),Object.getOwnPropertyDescriptors(e))}function X(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function ae(...e){const t={};for(const n of e){const o=Object.getOwnPropertyDescriptors(n);Object.assign(t,o)}return Object.defineProperties({},t)}function Et(e){return JSON.stringify(e)}const Pt="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Ze(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Io=qe(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function ce(e){if(Ze(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(Ze(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function At(e){return ce(e)?{...e}:e}const Zo=new Set(["string","number","symbol"]);function ue(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Q(e,t,n){const o=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(o._zod.parent=e),o}function g(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Eo(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Po={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Ao(e,t){const n=e._zod.def,o=ae(e._zod.def,{get shape(){const r={};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(r[i]=n.shape[i])}return X(this,"shape",r),r},checks:[]});return Q(e,o)}function jo(e,t){const n=e._zod.def,o=ae(e._zod.def,{get shape(){const r={...e._zod.def.shape};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete r[i]}return X(this,"shape",r),r},checks:[]});return Q(e,o)}function Co(e,t){if(!ce(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const r=ae(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return X(this,"shape",i),i},checks:[]});return Q(e,r)}function Oo(e,t){if(!ce(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...e._zod.def,get shape(){const o={...e._zod.def.shape,...t};return X(this,"shape",o),o},checks:e._zod.def.checks};return Q(e,n)}function To(e,t){const n=ae(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t._zod.def.shape};return X(this,"shape",o),o},get catchall(){return t._zod.def.catchall},checks:[]});return Q(e,n)}function Lo(e,t,n){const o=ae(t._zod.def,{get shape(){const r=t._zod.def.shape,i={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)i[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return X(this,"shape",i),i},checks:[]});return Q(t,o)}function Do(e,t,n){const o=ae(t._zod.def,{get shape(){const r=t._zod.def.shape,i={...r};if(n)for(const s in n){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)i[s]=new e({type:"nonoptional",innerType:r[s]});return X(this,"shape",i),i},checks:[]});return Q(t,o)}function le(e,t=0){var n;if(e.aborted===!0)return!0;for(let o=t;o<e.issues.length;o++)if(((n=e.issues[o])==null?void 0:n.continue)!==!0)return!0;return!1}function de(e,t){return t.map(n=>{var o;return(o=n).path??(o.path=[]),n.path.unshift(e),n})}function Ee(e){return typeof e=="string"?e:e==null?void 0:e.message}function ee(e,t,n){var r,i,s,a,c,u;const o={...e,path:e.path??[]};if(!e.message){const d=Ee((s=(i=(r=e.inst)==null?void 0:r._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,e))??Ee((a=t==null?void 0:t.error)==null?void 0:a.call(t,e))??Ee((c=n.customError)==null?void 0:c.call(n,e))??Ee((u=n.localeError)==null?void 0:u.call(n,e))??"Invalid input";o.message=d}return delete o.inst,delete o.continue,t!=null&&t.reportInput||delete o.input,o}function Qe(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function ye(...e){const[t,n,o]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:o}:{...t}}const jt=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,He,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Ct=l("$ZodError",jt),Ot=l("$ZodError",jt,{Parent:Error});function Ro(e,t=n=>n.message){const n={},o=[];for(const r of e.issues)r.path.length>0?(n[r.path[0]]=n[r.path[0]]||[],n[r.path[0]].push(t(r))):o.push(t(r));return{formErrors:o,fieldErrors:n}}function Uo(e,t){const n=t||function(i){return i.message},o={_errors:[]},r=i=>{for(const s of i.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(a=>r({issues:a}));else if(s.code==="invalid_key")r({issues:s.issues});else if(s.code==="invalid_element")r({issues:s.issues});else if(s.path.length===0)o._errors.push(n(s));else{let a=o,c=0;for(;c<s.path.length;){const u=s.path[c];c===s.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(n(s))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return r(e),o}const et=e=>(t,n,o,r)=>{const i=o?Object.assign(o,{async:!1}):{async:!1},s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise)throw new se;if(s.issues.length){const a=new((r==null?void 0:r.Err)??e)(s.issues.map(c=>ee(c,i,J())));throw Pt(a,r==null?void 0:r.callee),a}return s.value},tt=e=>async(t,n,o,r)=>{const i=o?Object.assign(o,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new((r==null?void 0:r.Err)??e)(s.issues.map(c=>ee(c,i,J())));throw Pt(a,r==null?void 0:r.callee),a}return s.value},Pe=e=>(t,n,o)=>{const r=o?{...o,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},r);if(i instanceof Promise)throw new se;return i.issues.length?{success:!1,error:new(e??Ct)(i.issues.map(s=>ee(s,r,J())))}:{success:!0,data:i.value}},Mo=Pe(Ot),Ae=e=>async(t,n,o)=>{const r=o?Object.assign(o,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},r);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(s=>ee(s,r,J())))}:{success:!0,data:i.value}},Fo=Ae(Ot),Bo=e=>(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return et(e)(t,n,r)},No=e=>(t,n,o)=>et(e)(t,n,o),Ko=e=>async(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return tt(e)(t,n,r)},Go=e=>async(t,n,o)=>tt(e)(t,n,o),Vo=e=>(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Pe(e)(t,n,r)},Wo=e=>(t,n,o)=>Pe(e)(t,n,o),Yo=e=>async(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Ae(e)(t,n,r)},Ho=e=>async(t,n,o)=>Ae(e)(t,n,o),qo=/^[cC][^\s-]{8,}$/,Jo=/^[0-9a-z]+$/,Xo=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Qo=/^[0-9a-vA-V]{20}$/,er=/^[A-Za-z0-9]{27}$/,tr=/^[a-zA-Z0-9_-]{21}$/,nr=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,or=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Tt=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,rr=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ir="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function sr(){return new RegExp(ir,"u")}const ar=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,cr=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,ur=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,lr=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,dr=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Lt=/^[A-Za-z0-9_-]*$/,pr=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,fr=/^\+(?:[0-9]){6,14}[0-9]$/,Dt="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",hr=new RegExp(`^${Dt}$`);function Rt(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function mr(e){return new RegExp(`^${Rt(e)}$`)}function gr(e){const t=Rt({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const o=`${t}(?:${n.join("|")})`;return new RegExp(`^${Dt}T(?:${o})$`)}const vr=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},_r=/^\d+$/,br=/^-?\d+(?:\.\d+)?/i,yr=/true|false/i,wr=/^[^A-Z]*$/,kr=/^[^a-z]*$/,O=l("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Ut={number:"number",bigint:"bigint",object:"date"},Mt=l("$ZodCheckLessThan",(e,t)=>{O.init(e,t);const n=Ut[typeof t.value];e._zod.onattach.push(o=>{const r=o._zod.bag,i=(t.inclusive?r.maximum:r.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value<=t.value:o.value<t.value)||o.issues.push({origin:n,code:"too_big",maximum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ft=l("$ZodCheckGreaterThan",(e,t)=>{O.init(e,t);const n=Ut[typeof t.value];e._zod.onattach.push(o=>{const r=o._zod.bag,i=(t.inclusive?r.minimum:r.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value>=t.value:o.value>t.value)||o.issues.push({origin:n,code:"too_small",minimum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),$r=l("$ZodCheckMultipleOf",(e,t)=>{O.init(e,t),e._zod.onattach.push(n=>{var o;(o=n._zod.bag).multipleOf??(o.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):So(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),zr=l("$ZodCheckNumberFormat",(e,t)=>{var s;O.init(e,t),t.format=t.format||"float64";const n=(s=t.format)==null?void 0:s.includes("int"),o=n?"int":"number",[r,i]=Po[t.format];e._zod.onattach.push(a=>{const c=a._zod.bag;c.format=t.format,c.minimum=r,c.maximum=i,n&&(c.pattern=_r)}),e._zod.check=a=>{const c=a.value;if(n){if(!Number.isInteger(c)){a.issues.push({expected:o,format:t.format,code:"invalid_type",continue:!1,input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?a.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,continue:!t.abort}):a.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,continue:!t.abort});return}}c<r&&a.issues.push({origin:"number",input:c,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),c>i&&a.issues.push({origin:"number",input:c,code:"too_big",maximum:i,inst:e})}}),Sr=l("$ZodCheckMaxLength",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!Je(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(o._zod.bag.maximum=t.maximum)}),e._zod.check=o=>{const r=o.value;if(r.length<=t.maximum)return;const s=Qe(r);o.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),xr=l("$ZodCheckMinLength",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!Je(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(o._zod.bag.minimum=t.minimum)}),e._zod.check=o=>{const r=o.value;if(r.length>=t.minimum)return;const s=Qe(r);o.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Ir=l("$ZodCheckLengthEquals",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!Je(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=o=>{const r=o.value,i=r.length;if(i===t.length)return;const s=Qe(r),a=i>t.length;o.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:o.value,inst:e,continue:!t.abort})}}),je=l("$ZodCheckStringFormat",(e,t)=>{var n,o;O.init(e,t),e._zod.onattach.push(r=>{const i=r._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(o=e._zod).check??(o.check=()=>{})}),Zr=l("$ZodCheckRegex",(e,t)=>{je.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Er=l("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=wr),je.init(e,t)}),Pr=l("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=kr),je.init(e,t)}),Ar=l("$ZodCheckIncludes",(e,t)=>{O.init(e,t);const n=ue(t.includes),o=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=o,e._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(o)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),jr=l("$ZodCheckStartsWith",(e,t)=>{O.init(e,t);const n=new RegExp(`^${ue(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const r=o._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(n)}),e._zod.check=o=>{o.value.startsWith(t.prefix)||o.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:o.value,inst:e,continue:!t.abort})}}),Cr=l("$ZodCheckEndsWith",(e,t)=>{O.init(e,t);const n=new RegExp(`.*${ue(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const r=o._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(n)}),e._zod.check=o=>{o.value.endsWith(t.suffix)||o.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:o.value,inst:e,continue:!t.abort})}}),Or=l("$ZodCheckOverwrite",(e,t)=>{O.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Tr{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const o=t.split(`
`).filter(s=>s),r=Math.min(...o.map(s=>s.length-s.trimStart().length)),i=o.map(s=>s.slice(r)).map(s=>" ".repeat(this.indent*2)+s);for(const s of i)this.content.push(s)}compile(){const t=Function,n=this==null?void 0:this.args,r=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new t(...n,r.join(`
`))}}const Lr={major:4,minor:1,patch:1},I=l("$ZodType",(e,t)=>{var r;var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Lr;const o=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&o.unshift(e);for(const i of o)for(const s of i._zod.onattach)s(e);if(o.length===0)(n=e._zod).deferred??(n.deferred=[]),(r=e._zod.deferred)==null||r.push(()=>{e._zod.run=e._zod.parse});else{const i=(a,c,u)=>{let d=le(a),h;for(const m of c){if(m._zod.def.when){if(!m._zod.def.when(a))continue}else if(d)continue;const f=a.issues.length,v=m._zod.check(a);if(v instanceof Promise&&(u==null?void 0:u.async)===!1)throw new se;if(h||v instanceof Promise)h=(h??Promise.resolve()).then(async()=>{await v,a.issues.length!==f&&(d||(d=le(a,f)))});else{if(a.issues.length===f)continue;d||(d=le(a,f))}}return h?h.then(()=>a):a},s=(a,c,u)=>{if(le(a))return a.aborted=!0,a;const d=i(c,o,u);if(d instanceof Promise){if(u.async===!1)throw new se;return d.then(h=>e._zod.parse(h,u))}return e._zod.parse(d,u)};e._zod.run=(a,c)=>{if(c.skipChecks)return e._zod.parse(a,c);if(c.direction==="backward"){const d=e._zod.parse({value:a.value,issues:[]},{...c,skipChecks:!0});return d instanceof Promise?d.then(h=>s(h,a,c)):s(d,a,c)}const u=e._zod.parse(a,c);if(u instanceof Promise){if(c.async===!1)throw new se;return u.then(d=>i(d,o,c))}return i(u,o,c)}}e["~standard"]={validate:i=>{var s;try{const a=Mo(e,i);return a.success?{value:a.data}:{issues:(s=a.error)==null?void 0:s.issues}}catch{return Fo(e,i).then(c=>{var u;return c.success?{value:c.data}:{issues:(u=c.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),nt=l("$ZodString",(e,t)=>{var n;I.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??vr(e._zod.bag),e._zod.parse=(o,r)=>{if(t.coerce)try{o.value=String(o.value)}catch{}return typeof o.value=="string"||o.issues.push({expected:"string",code:"invalid_type",input:o.value,inst:e}),o}}),S=l("$ZodStringFormat",(e,t)=>{je.init(e,t),nt.init(e,t)}),Dr=l("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=or),S.init(e,t)}),Rr=l("$ZodUUID",(e,t)=>{if(t.version){const o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(o===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Tt(o))}else t.pattern??(t.pattern=Tt());S.init(e,t)}),Ur=l("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=rr),S.init(e,t)}),Mr=l("$ZodURL",(e,t)=>{S.init(e,t),e._zod.check=n=>{try{const o=n.value.trim(),r=new URL(o);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:pr.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=r.href:n.value=o;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Fr=l("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=sr()),S.init(e,t)}),Br=l("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=tr),S.init(e,t)}),Nr=l("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=qo),S.init(e,t)}),Kr=l("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Jo),S.init(e,t)}),Gr=l("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Xo),S.init(e,t)}),Vr=l("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Qo),S.init(e,t)}),Wr=l("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=er),S.init(e,t)}),Yr=l("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=gr(t)),S.init(e,t)}),Hr=l("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=hr),S.init(e,t)}),qr=l("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=mr(t)),S.init(e,t)}),Jr=l("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=nr),S.init(e,t)}),Xr=l("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=ar),S.init(e,t),e._zod.onattach.push(n=>{const o=n._zod.bag;o.format="ipv4"})}),Qr=l("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=cr),S.init(e,t),e._zod.onattach.push(n=>{const o=n._zod.bag;o.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),ei=l("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=ur),S.init(e,t)}),ti=l("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=lr),S.init(e,t),e._zod.check=n=>{const[o,r]=n.value.split("/");try{if(!r)throw new Error;const i=Number(r);if(`${i}`!==r)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${o}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Bt(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const ni=l("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=dr),S.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Bt(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function oi(e){if(!Lt.test(e))return!1;const t=e.replace(/[-_]/g,o=>o==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Bt(n)}const ri=l("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Lt),S.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{oi(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),ii=l("$ZodE164",(e,t)=>{t.pattern??(t.pattern=fr),S.init(e,t)});function si(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[o]=n;if(!o)return!1;const r=JSON.parse(atob(o));return!("typ"in r&&(r==null?void 0:r.typ)!=="JWT"||!r.alg||t&&(!("alg"in r)||r.alg!==t))}catch{return!1}}const ai=l("$ZodJWT",(e,t)=>{S.init(e,t),e._zod.check=n=>{si(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Nt=l("$ZodNumber",(e,t)=>{I.init(e,t),e._zod.pattern=e._zod.bag.pattern??br,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const r=n.value;if(typeof r=="number"&&!Number.isNaN(r)&&Number.isFinite(r))return n;const i=typeof r=="number"?Number.isNaN(r)?"NaN":Number.isFinite(r)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:r,inst:e,...i?{received:i}:{}}),n}}),ci=l("$ZodNumber",(e,t)=>{zr.init(e,t),Nt.init(e,t)}),ui=l("$ZodBoolean",(e,t)=>{I.init(e,t),e._zod.pattern=yr,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=!!n.value}catch{}const r=n.value;return typeof r=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:r,inst:e}),n}}),li=l("$ZodUnknown",(e,t)=>{I.init(e,t),e._zod.parse=n=>n}),di=l("$ZodNever",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function Kt(e,t,n){e.issues.length&&t.issues.push(...de(n,e.issues)),t.value[n]=e.value}const pi=l("$ZodArray",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!Array.isArray(r))return n.issues.push({expected:"array",code:"invalid_type",input:r,inst:e}),n;n.value=Array(r.length);const i=[];for(let s=0;s<r.length;s++){const a=r[s],c=t.element._zod.run({value:a,issues:[]},o);c instanceof Promise?i.push(c.then(u=>Kt(u,n,s))):Kt(c,n,s)}return i.length?Promise.all(i).then(()=>n):n}});function Ce(e,t,n,o){e.issues.length&&t.issues.push(...de(n,e.issues)),e.value===void 0?n in o&&(t.value[n]=void 0):t.value[n]=e.value}function Gt(e){const t=Object.keys(e.shape);for(const o of t)if(!e.shape[o]._zod.traits.has("$ZodType"))throw new Error(`Invalid element at key "${o}": expected a Zod schema`);const n=Eo(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function Vt(e,t,n,o,r,i){const s=[],a=r.keySet,c=r.catchall._zod,u=c.def.type;for(const d of Object.keys(t)){if(a.has(d))continue;if(u==="never"){s.push(d);continue}const h=c.run({value:t[d],issues:[]},o);h instanceof Promise?e.push(h.then(m=>Ce(m,n,d,t))):Ce(h,n,d,t)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:i}),e.length?Promise.all(e).then(()=>n):n}const fi=l("$ZodObject",(e,t)=>{I.init(e,t);const n=qe(()=>Gt(t));$(e._zod,"propValues",()=>{const s=t.shape,a={};for(const c in s){const u=s[c]._zod;if(u.values){a[c]??(a[c]=new Set);for(const d of u.values)a[c].add(d)}}return a});const o=Ze,r=t.catchall;let i;e._zod.parse=(s,a)=>{i??(i=n.value);const c=s.value;if(!o(c))return s.issues.push({expected:"object",code:"invalid_type",input:c,inst:e}),s;s.value={};const u=[],d=i.shape;for(const h of i.keys){const f=d[h]._zod.run({value:c[h],issues:[]},a);f instanceof Promise?u.push(f.then(v=>Ce(v,s,h,c))):Ce(f,s,h,c)}return r?Vt(u,c,s,a,n.value,e):u.length?Promise.all(u).then(()=>s):s}}),hi=l("$ZodObjectJIT",(e,t)=>{fi.init(e,t);const n=e._zod.parse,o=qe(()=>Gt(t)),r=m=>{const f=new Tr(["shape","payload","ctx"]),v=o.value,y=z=>{const P=Et(z);return`shape[${P}]._zod.run({ value: input[${P}], issues: [] }, ctx)`};f.write("const input = payload.value;");const x=Object.create(null);let b=0;for(const z of v.keys)x[z]=`key_${b++}`;f.write("const newResult = {}");for(const z of v.keys){const P=x[z],C=Et(z);f.write(`const ${P} = ${y(z)};`),f.write(`
        if (${P}.issues.length) {
          payload.issues = payload.issues.concat(${P}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${C}, ...iss.path] : [${C}]
          })));
        }
        
        if (${P}.value === undefined) {
          if (${C} in input) {
            newResult[${C}] = undefined;
          }
        } else {
          newResult[${C}] = ${P}.value;
        }
      `)}f.write("payload.value = newResult;"),f.write("return payload;");const j=f.compile();return(z,P)=>j(m,z,P)};let i;const s=Ze,a=!It.jitless,u=a&&Io.value,d=t.catchall;let h;e._zod.parse=(m,f)=>{h??(h=o.value);const v=m.value;return s(v)?a&&u&&(f==null?void 0:f.async)===!1&&f.jitless!==!0?(i||(i=r(t.shape)),m=i(m,f),d?Vt([],v,m,f,h,e):m):n(m,f):(m.issues.push({expected:"object",code:"invalid_type",input:v,inst:e}),m)}});function Wt(e,t,n,o){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const r=e.filter(i=>!le(i));return r.length===1?(t.value=r[0].value,r[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(i=>i.issues.map(s=>ee(s,o,J())))}),t)}const mi=l("$ZodUnion",(e,t)=>{I.init(e,t),$(e._zod,"optin",()=>t.options.some(r=>r._zod.optin==="optional")?"optional":void 0),$(e._zod,"optout",()=>t.options.some(r=>r._zod.optout==="optional")?"optional":void 0),$(e._zod,"values",()=>{if(t.options.every(r=>r._zod.values))return new Set(t.options.flatMap(r=>Array.from(r._zod.values)))}),$(e._zod,"pattern",()=>{if(t.options.every(r=>r._zod.pattern)){const r=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${r.map(i=>Xe(i.source)).join("|")})$`)}});const n=t.options.length===1,o=t.options[0]._zod.run;e._zod.parse=(r,i)=>{if(n)return o(r,i);let s=!1;const a=[];for(const c of t.options){const u=c._zod.run({value:r.value,issues:[]},i);if(u instanceof Promise)a.push(u),s=!0;else{if(u.issues.length===0)return u;a.push(u)}}return s?Promise.all(a).then(c=>Wt(c,r,e,i)):Wt(a,r,e,i)}}),gi=l("$ZodIntersection",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{const r=n.value,i=t.left._zod.run({value:r,issues:[]},o),s=t.right._zod.run({value:r,issues:[]},o);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,u])=>Yt(n,c,u)):Yt(n,i,s)}});function ot(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(ce(e)&&ce(t)){const n=Object.keys(t),o=Object.keys(e).filter(i=>n.indexOf(i)!==-1),r={...e,...t};for(const i of o){const s=ot(e[i],t[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};r[i]=s.data}return{valid:!0,data:r}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let o=0;o<e.length;o++){const r=e[o],i=t[o],s=ot(r,i);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Yt(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),le(e))return e;const o=ot(t.value,n.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const vi=l("$ZodRecord",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!ce(r))return n.issues.push({expected:"record",code:"invalid_type",input:r,inst:e}),n;const i=[];if(t.keyType._zod.values){const s=t.keyType._zod.values;n.value={};for(const c of s)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const u=t.valueType._zod.run({value:r[c],issues:[]},o);u instanceof Promise?i.push(u.then(d=>{d.issues.length&&n.issues.push(...de(c,d.issues)),n.value[c]=d.value})):(u.issues.length&&n.issues.push(...de(c,u.issues)),n.value[c]=u.value)}let a;for(const c in r)s.has(c)||(a=a??[],a.push(c));a&&a.length>0&&n.issues.push({code:"unrecognized_keys",input:r,inst:e,keys:a})}else{n.value={};for(const s of Reflect.ownKeys(r)){if(s==="__proto__")continue;const a=t.keyType._zod.run({value:s,issues:[]},o);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){n.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(u=>ee(u,o,J())),input:s,path:[s],inst:e}),n.value[a.value]=a.value;continue}const c=t.valueType._zod.run({value:r[s],issues:[]},o);c instanceof Promise?i.push(c.then(u=>{u.issues.length&&n.issues.push(...de(s,u.issues)),n.value[a.value]=u.value})):(c.issues.length&&n.issues.push(...de(s,c.issues)),n.value[a.value]=c.value)}}return i.length?Promise.all(i).then(()=>n):n}}),_i=l("$ZodEnum",(e,t)=>{I.init(e,t);const n=zo(t.entries),o=new Set(n);e._zod.values=o,e._zod.pattern=new RegExp(`^(${n.filter(r=>Zo.has(typeof r)).map(r=>typeof r=="string"?ue(r):r.toString()).join("|")})$`),e._zod.parse=(r,i)=>{const s=r.value;return o.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),bi=l("$ZodLiteral",(e,t)=>{if(I.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?ue(n):n?ue(n.toString()):String(n)).join("|")})$`),e._zod.parse=(n,o)=>{const r=n.value;return e._zod.values.has(r)||n.issues.push({code:"invalid_value",values:t.values,input:r,inst:e}),n}}),yi=l("$ZodTransform",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new xt(e.constructor.name);const r=t.transform(n.value,n);if(o.async)return(r instanceof Promise?r:Promise.resolve(r)).then(s=>(n.value=s,n));if(r instanceof Promise)throw new se;return n.value=r,n}});function Ht(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const wi=l("$ZodOptional",(e,t)=>{I.init(e,t),e._zod.optin="optional",e._zod.optout="optional",$(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),$(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Xe(n.source)})?$`):void 0}),e._zod.parse=(n,o)=>{if(t.innerType._zod.optin==="optional"){const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>Ht(i,n.value)):Ht(r,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,o)}}),ki=l("$ZodNullable",(e,t)=>{I.init(e,t),$(e._zod,"optin",()=>t.innerType._zod.optin),$(e._zod,"optout",()=>t.innerType._zod.optout),$(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Xe(n.source)}|null)$`):void 0}),$(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,o)=>n.value===null?n:t.innerType._zod.run(n,o)}),$i=l("$ZodDefault",(e,t)=>{I.init(e,t),e._zod.optin="optional",$(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);if(n.value===void 0)return n.value=t.defaultValue,n;const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>qt(i,t)):qt(r,t)}});function qt(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const zi=l("$ZodPrefault",(e,t)=>{I.init(e,t),e._zod.optin="optional",$(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>(o.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,o))}),Si=l("$ZodNonOptional",(e,t)=>{I.init(e,t),$(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(o=>o!==void 0)):void 0}),e._zod.parse=(n,o)=>{const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>Jt(i,e)):Jt(r,e)}});function Jt(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const xi=l("$ZodCatch",(e,t)=>{I.init(e,t),$(e._zod,"optin",()=>t.innerType._zod.optin),$(e._zod,"optout",()=>t.innerType._zod.optout),$(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(s=>ee(s,o,J()))},input:n.value}),n.issues=[]),n)):(n.value=r.value,r.issues.length&&(n.value=t.catchValue({...n,error:{issues:r.issues.map(i=>ee(i,o,J()))},input:n.value}),n.issues=[]),n)}}),Ii=l("$ZodPipe",(e,t)=>{I.init(e,t),$(e._zod,"values",()=>t.in._zod.values),$(e._zod,"optin",()=>t.in._zod.optin),$(e._zod,"optout",()=>t.out._zod.optout),$(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,o)=>{if(o.direction==="backward"){const i=t.out._zod.run(n,o);return i instanceof Promise?i.then(s=>Oe(s,t.in,o)):Oe(i,t.in,o)}const r=t.in._zod.run(n,o);return r instanceof Promise?r.then(i=>Oe(i,t.out,o)):Oe(r,t.out,o)}});function Oe(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const Zi=l("$ZodReadonly",(e,t)=>{I.init(e,t),$(e._zod,"propValues",()=>t.innerType._zod.propValues),$(e._zod,"values",()=>t.innerType._zod.values),$(e._zod,"optin",()=>t.innerType._zod.optin),$(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(Xt):Xt(r)}});function Xt(e){return e.value=Object.freeze(e.value),e}const Ei=l("$ZodCustom",(e,t)=>{O.init(e,t),I.init(e,t),e._zod.parse=(n,o)=>n,e._zod.check=n=>{const o=n.value,r=t.fn(o);if(r instanceof Promise)return r.then(i=>Qt(i,n,o,e));Qt(r,n,o,e)}});function Qt(e,t,n,o){if(!e){const r={code:"custom",input:n,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(r.params=o._zod.def.params),t.issues.push(ye(r))}}class Pi{constructor(){this._map=new Map,this._idmap=new Map}add(t,...n){const o=n[0];if(this._map.set(t,o),o&&typeof o=="object"&&"id"in o){if(this._idmap.has(o.id))throw new Error(`ID ${o.id} already exists in the registry`);this._idmap.set(o.id,t)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const o={...this.get(n)??{}};delete o.id;const r={...o,...this._map.get(t)};return Object.keys(r).length?r:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Ai(){return new Pi}const Te=Ai();function ji(e,t){return new e({type:"string",...g(t)})}function Ci(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...g(t)})}function en(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...g(t)})}function Oi(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...g(t)})}function Ti(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...g(t)})}function Li(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...g(t)})}function Di(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...g(t)})}function Ri(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...g(t)})}function Ui(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...g(t)})}function Mi(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...g(t)})}function Fi(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...g(t)})}function Bi(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...g(t)})}function Ni(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...g(t)})}function Ki(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...g(t)})}function Gi(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...g(t)})}function Vi(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...g(t)})}function Wi(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...g(t)})}function Yi(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...g(t)})}function Hi(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...g(t)})}function qi(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...g(t)})}function Ji(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...g(t)})}function Xi(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...g(t)})}function Qi(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...g(t)})}function es(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...g(t)})}function ts(e,t){return new e({type:"string",format:"date",check:"string_format",...g(t)})}function ns(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...g(t)})}function os(e,t){return new e({type:"string",format:"duration",check:"string_format",...g(t)})}function rs(e,t){return new e({type:"number",checks:[],...g(t)})}function is(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...g(t)})}function ss(e,t){return new e({type:"boolean",...g(t)})}function as(e){return new e({type:"unknown"})}function cs(e,t){return new e({type:"never",...g(t)})}function tn(e,t){return new Mt({check:"less_than",...g(t),value:e,inclusive:!1})}function rt(e,t){return new Mt({check:"less_than",...g(t),value:e,inclusive:!0})}function nn(e,t){return new Ft({check:"greater_than",...g(t),value:e,inclusive:!1})}function it(e,t){return new Ft({check:"greater_than",...g(t),value:e,inclusive:!0})}function on(e,t){return new $r({check:"multiple_of",...g(t),value:e})}function rn(e,t){return new Sr({check:"max_length",...g(t),maximum:e})}function Le(e,t){return new xr({check:"min_length",...g(t),minimum:e})}function sn(e,t){return new Ir({check:"length_equals",...g(t),length:e})}function us(e,t){return new Zr({check:"string_format",format:"regex",...g(t),pattern:e})}function ls(e){return new Er({check:"string_format",format:"lowercase",...g(e)})}function ds(e){return new Pr({check:"string_format",format:"uppercase",...g(e)})}function ps(e,t){return new Ar({check:"string_format",format:"includes",...g(t),includes:e})}function fs(e,t){return new jr({check:"string_format",format:"starts_with",...g(t),prefix:e})}function hs(e,t){return new Cr({check:"string_format",format:"ends_with",...g(t),suffix:e})}function we(e){return new Or({check:"overwrite",tx:e})}function ms(e){return we(t=>t.normalize(e))}function gs(){return we(e=>e.trim())}function vs(){return we(e=>e.toLowerCase())}function _s(){return we(e=>e.toUpperCase())}function bs(e,t,n){return new e({type:"array",element:t,...g(n)})}function ys(e,t,n){return new e({type:"custom",check:"custom",fn:t,...g(n)})}function ws(e){const t=ks(n=>(n.addIssue=o=>{if(typeof o=="string")n.issues.push(ye(o,n.value,t._zod.def));else{const r=o;r.fatal&&(r.continue=!1),r.code??(r.code="custom"),r.input??(r.input=n.value),r.inst??(r.inst=t),r.continue??(r.continue=!t._zod.def.abort),n.issues.push(ye(r))}},e(n.value,n)));return t}function ks(e,t){const n=new O({check:"custom",...g(t)});return n._zod.check=e,n}const $s=l("ZodISODateTime",(e,t)=>{Yr.init(e,t),Z.init(e,t)});function zs(e){return es($s,e)}const Ss=l("ZodISODate",(e,t)=>{Hr.init(e,t),Z.init(e,t)});function xs(e){return ts(Ss,e)}const Is=l("ZodISOTime",(e,t)=>{qr.init(e,t),Z.init(e,t)});function Zs(e){return ns(Is,e)}const Es=l("ZodISODuration",(e,t)=>{Jr.init(e,t),Z.init(e,t)});function Ps(e){return os(Es,e)}const R=l("ZodError",(e,t)=>{Ct.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Uo(e,n)},flatten:{value:n=>Ro(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,He,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,He,2)}},isEmpty:{get(){return e.issues.length===0}}})},{Parent:Error}),As=et(R),js=tt(R),Cs=Pe(R),Os=Ae(R),Ts=Bo(R),Ls=No(R),Ds=Ko(R),Rs=Go(R),Us=Vo(R),Ms=Wo(R),Fs=Yo(R),Bs=Ho(R),E=l("ZodType",(e,t)=>(I.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(o=>typeof o=="function"?{_zod:{check:o,def:{check:"custom"},onattach:[]}}:o)]}),e.clone=(n,o)=>Q(e,n,o),e.brand=()=>e,e.register=(n,o)=>(n.add(e,o),e),e.parse=(n,o)=>As(e,n,o,{callee:e.parse}),e.safeParse=(n,o)=>Cs(e,n,o),e.parseAsync=async(n,o)=>js(e,n,o,{callee:e.parseAsync}),e.safeParseAsync=async(n,o)=>Os(e,n,o),e.spa=e.safeParseAsync,e.encode=(n,o)=>Ts(e,n,o),e.decode=(n,o)=>Ls(e,n,o),e.encodeAsync=async(n,o)=>Ds(e,n,o),e.decodeAsync=async(n,o)=>Rs(e,n,o),e.safeEncode=(n,o)=>Us(e,n,o),e.safeDecode=(n,o)=>Ms(e,n,o),e.safeEncodeAsync=async(n,o)=>Fs(e,n,o),e.safeDecodeAsync=async(n,o)=>Bs(e,n,o),e.refine=(n,o)=>e.check(La(n,o)),e.superRefine=n=>e.check(Da(n)),e.overwrite=n=>e.check(we(n)),e.optional=()=>hn(e),e.nullable=()=>mn(e),e.nullish=()=>hn(mn(e)),e.nonoptional=n=>Ea(e,n),e.array=()=>N(e),e.or=n=>st([e,n]),e.and=n=>_a(e,n),e.transform=n=>vn(e,$a(n)),e.default=n=>xa(e,n),e.prefault=n=>Za(e,n),e.catch=n=>Aa(e,n),e.pipe=n=>vn(e,n),e.readonly=()=>Oa(e),e.describe=n=>{const o=e.clone();return Te.add(o,{description:n}),o},Object.defineProperty(e,"description",{get(){var n;return(n=Te.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Te.get(e);const o=e.clone();return Te.add(o,n[0]),o},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),an=l("_ZodString",(e,t)=>{nt.init(e,t),E.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...o)=>e.check(us(...o)),e.includes=(...o)=>e.check(ps(...o)),e.startsWith=(...o)=>e.check(fs(...o)),e.endsWith=(...o)=>e.check(hs(...o)),e.min=(...o)=>e.check(Le(...o)),e.max=(...o)=>e.check(rn(...o)),e.length=(...o)=>e.check(sn(...o)),e.nonempty=(...o)=>e.check(Le(1,...o)),e.lowercase=o=>e.check(ls(o)),e.uppercase=o=>e.check(ds(o)),e.trim=()=>e.check(gs()),e.normalize=(...o)=>e.check(ms(...o)),e.toLowerCase=()=>e.check(vs()),e.toUpperCase=()=>e.check(_s())}),Ns=l("ZodString",(e,t)=>{nt.init(e,t),an.init(e,t),e.email=n=>e.check(Ci(Ks,n)),e.url=n=>e.check(Ri(Gs,n)),e.jwt=n=>e.check(Qi(sa,n)),e.emoji=n=>e.check(Ui(Vs,n)),e.guid=n=>e.check(en(cn,n)),e.uuid=n=>e.check(Oi(De,n)),e.uuidv4=n=>e.check(Ti(De,n)),e.uuidv6=n=>e.check(Li(De,n)),e.uuidv7=n=>e.check(Di(De,n)),e.nanoid=n=>e.check(Mi(Ws,n)),e.guid=n=>e.check(en(cn,n)),e.cuid=n=>e.check(Fi(Ys,n)),e.cuid2=n=>e.check(Bi(Hs,n)),e.ulid=n=>e.check(Ni(qs,n)),e.base64=n=>e.check(qi(oa,n)),e.base64url=n=>e.check(Ji(ra,n)),e.xid=n=>e.check(Ki(Js,n)),e.ksuid=n=>e.check(Gi(Xs,n)),e.ipv4=n=>e.check(Vi(Qs,n)),e.ipv6=n=>e.check(Wi(ea,n)),e.cidrv4=n=>e.check(Yi(ta,n)),e.cidrv6=n=>e.check(Hi(na,n)),e.e164=n=>e.check(Xi(ia,n)),e.datetime=n=>e.check(zs(n)),e.date=n=>e.check(xs(n)),e.time=n=>e.check(Zs(n)),e.duration=n=>e.check(Ps(n))});function B(e){return ji(Ns,e)}const Z=l("ZodStringFormat",(e,t)=>{S.init(e,t),an.init(e,t)}),Ks=l("ZodEmail",(e,t)=>{Ur.init(e,t),Z.init(e,t)}),cn=l("ZodGUID",(e,t)=>{Dr.init(e,t),Z.init(e,t)}),De=l("ZodUUID",(e,t)=>{Rr.init(e,t),Z.init(e,t)}),Gs=l("ZodURL",(e,t)=>{Mr.init(e,t),Z.init(e,t)}),Vs=l("ZodEmoji",(e,t)=>{Fr.init(e,t),Z.init(e,t)}),Ws=l("ZodNanoID",(e,t)=>{Br.init(e,t),Z.init(e,t)}),Ys=l("ZodCUID",(e,t)=>{Nr.init(e,t),Z.init(e,t)}),Hs=l("ZodCUID2",(e,t)=>{Kr.init(e,t),Z.init(e,t)}),qs=l("ZodULID",(e,t)=>{Gr.init(e,t),Z.init(e,t)}),Js=l("ZodXID",(e,t)=>{Vr.init(e,t),Z.init(e,t)}),Xs=l("ZodKSUID",(e,t)=>{Wr.init(e,t),Z.init(e,t)}),Qs=l("ZodIPv4",(e,t)=>{Xr.init(e,t),Z.init(e,t)}),ea=l("ZodIPv6",(e,t)=>{Qr.init(e,t),Z.init(e,t)}),ta=l("ZodCIDRv4",(e,t)=>{ei.init(e,t),Z.init(e,t)}),na=l("ZodCIDRv6",(e,t)=>{ti.init(e,t),Z.init(e,t)}),oa=l("ZodBase64",(e,t)=>{ni.init(e,t),Z.init(e,t)}),ra=l("ZodBase64URL",(e,t)=>{ri.init(e,t),Z.init(e,t)}),ia=l("ZodE164",(e,t)=>{ii.init(e,t),Z.init(e,t)}),sa=l("ZodJWT",(e,t)=>{ai.init(e,t),Z.init(e,t)}),un=l("ZodNumber",(e,t)=>{Nt.init(e,t),E.init(e,t),e.gt=(o,r)=>e.check(nn(o,r)),e.gte=(o,r)=>e.check(it(o,r)),e.min=(o,r)=>e.check(it(o,r)),e.lt=(o,r)=>e.check(tn(o,r)),e.lte=(o,r)=>e.check(rt(o,r)),e.max=(o,r)=>e.check(rt(o,r)),e.int=o=>e.check(ln(o)),e.safe=o=>e.check(ln(o)),e.positive=o=>e.check(nn(0,o)),e.nonnegative=o=>e.check(it(0,o)),e.negative=o=>e.check(tn(0,o)),e.nonpositive=o=>e.check(rt(0,o)),e.multipleOf=(o,r)=>e.check(on(o,r)),e.step=(o,r)=>e.check(on(o,r)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function aa(e){return rs(un,e)}const ca=l("ZodNumberFormat",(e,t)=>{ci.init(e,t),un.init(e,t)});function ln(e){return is(ca,e)}const ua=l("ZodBoolean",(e,t)=>{ui.init(e,t),E.init(e,t)});function la(e){return ss(ua,e)}const da=l("ZodUnknown",(e,t)=>{li.init(e,t),E.init(e,t)});function dn(){return as(da)}const pa=l("ZodNever",(e,t)=>{di.init(e,t),E.init(e,t)});function fa(e){return cs(pa,e)}const ha=l("ZodArray",(e,t)=>{pi.init(e,t),E.init(e,t),e.element=t.element,e.min=(n,o)=>e.check(Le(n,o)),e.nonempty=n=>e.check(Le(1,n)),e.max=(n,o)=>e.check(rn(n,o)),e.length=(n,o)=>e.check(sn(n,o)),e.unwrap=()=>e.element});function N(e,t){return bs(ha,e,t)}const ma=l("ZodObject",(e,t)=>{hi.init(e,t),E.init(e,t),$(e,"shape",()=>t.shape),e.keyof=()=>Re(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:dn()}),e.loose=()=>e.clone({...e._zod.def,catchall:dn()}),e.strict=()=>e.clone({...e._zod.def,catchall:fa()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>Co(e,n),e.safeExtend=n=>Oo(e,n),e.merge=n=>To(e,n),e.pick=n=>Ao(e,n),e.omit=n=>jo(e,n),e.partial=(...n)=>Lo(fn,e,n[0]),e.required=(...n)=>Do(gn,e,n[0])});function pe(e,t){const n={type:"object",get shape(){return X(this,"shape",e?xo(e):{}),this.shape},...g(t)};return new ma(n)}const ga=l("ZodUnion",(e,t)=>{mi.init(e,t),E.init(e,t),e.options=t.options});function st(e,t){return new ga({type:"union",options:e,...g(t)})}const va=l("ZodIntersection",(e,t)=>{gi.init(e,t),E.init(e,t)});function _a(e,t){return new va({type:"intersection",left:e,right:t})}const ba=l("ZodRecord",(e,t)=>{vi.init(e,t),E.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function pn(e,t,n){return new ba({type:"record",keyType:e,valueType:t,...g(n)})}const at=l("ZodEnum",(e,t)=>{_i.init(e,t),E.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(o,r)=>{const i={};for(const s of o)if(n.has(s))i[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new at({...t,checks:[],...g(r),entries:i})},e.exclude=(o,r)=>{const i={...t.entries};for(const s of o)if(n.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new at({...t,checks:[],...g(r),entries:i})}});function Re(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,o])):e;return new at({type:"enum",entries:n,...g(t)})}const ya=l("ZodLiteral",(e,t)=>{bi.init(e,t),E.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function wa(e,t){return new ya({type:"literal",values:Array.isArray(e)?e:[e],...g(t)})}const ka=l("ZodTransform",(e,t)=>{yi.init(e,t),E.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new xt(e.constructor.name);n.addIssue=i=>{if(typeof i=="string")n.issues.push(ye(i,n.value,t));else{const s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),n.issues.push(ye(s))}};const r=t.transform(n.value,n);return r instanceof Promise?r.then(i=>(n.value=i,n)):(n.value=r,n)}});function $a(e){return new ka({type:"transform",transform:e})}const fn=l("ZodOptional",(e,t)=>{wi.init(e,t),E.init(e,t),e.unwrap=()=>e._zod.def.innerType});function hn(e){return new fn({type:"optional",innerType:e})}const za=l("ZodNullable",(e,t)=>{ki.init(e,t),E.init(e,t),e.unwrap=()=>e._zod.def.innerType});function mn(e){return new za({type:"nullable",innerType:e})}const Sa=l("ZodDefault",(e,t)=>{$i.init(e,t),E.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function xa(e,t){return new Sa({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():At(t)}})}const Ia=l("ZodPrefault",(e,t)=>{zi.init(e,t),E.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Za(e,t){return new Ia({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():At(t)}})}const gn=l("ZodNonOptional",(e,t)=>{Si.init(e,t),E.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ea(e,t){return new gn({type:"nonoptional",innerType:e,...g(t)})}const Pa=l("ZodCatch",(e,t)=>{xi.init(e,t),E.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Aa(e,t){return new Pa({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const ja=l("ZodPipe",(e,t)=>{Ii.init(e,t),E.init(e,t),e.in=t.in,e.out=t.out});function vn(e,t){return new ja({type:"pipe",in:e,out:t})}const Ca=l("ZodReadonly",(e,t)=>{Zi.init(e,t),E.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Oa(e){return new Ca({type:"readonly",innerType:e})}const Ta=l("ZodCustom",(e,t)=>{Ei.init(e,t),E.init(e,t)});function La(e,t={}){return ys(Ta,e,t)}function Da(e){return ws(e)}const ct=new Set(["files","gap","headline","hidden","info","line","pages","users"]),_n={text:e=>Y(e,`"${e.label}", single-line plain text without line breaks or formatting`),textarea:e=>Y(e,`"${e.label}", multi-line text with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),markdown:e=>Y(e,`"${e.label}", multi-line text with Markdown formatting`),slug:e=>Y(e,`"${e.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`),url:e=>Y(e,`"${e.label}", a valid URL starting with http:// or https://`),email:e=>Y(e,`"${e.label}", a valid email address`),password:e=>Y(e,`"${e.label}", a secure password (not for actual use)`),tel:e=>Y(e,`"${e.label}", a telephone number in appropriate format for the context`),writer:e=>Y(e,`"${e.label}" (WYSIWYG), ${e.inline===!0?"text with inline formatting only (bold, italic, underline, code, links, email, sub, sup). NO wrapping paragraph <p> tags allowed.":"text wrapped in paragraph <p> tags (can contain one or multiple paragraphs). Inline formatting (bold, italic, underline, code, links, email, sub, sup) is allowed."}`),list:e=>B().describe(`"${e.label}" (WYSIWYG), HTML list wrapped in <ul> or <ol>. Use <li> for items with inline formatting (bold, italic, underline, code, links, email, sub, sup).`),number:e=>yn(e),range:e=>yn(e),toggle:e=>la().describe(`"${e.label}", a boolean`),select:e=>lt(e),radio:e=>lt(e),toggles:e=>lt(e),checkboxes:e=>dt(e),multiselect:e=>dt(e),tags:e=>dt(e),date:e=>B().describe(`"${e.label}", a date ${e.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:e=>B().describe(`"${e.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),color:e=>B().describe(`"${e.label}", a color value in hex, rgb or hsl format`),link:e=>B().describe(`"${e.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),structure:e=>{const t=bn(e);return t?N(t).describe(`"${e.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`):N(pn(B())).describe(`"${e.label}", repeatable structured data based on expected content structure`)},object:e=>{const t=bn(e);return t?t.describe(`"${e.label}", structured data containing the defined sub-fields with appropriate content`):pn(B()).describe(`"${e.label}", object data based on expected content structure`)},entries:e=>{const{field:t}=e.field,n={...t,name:"entry",label:e.label||"Entry"},o=_n[t.type],r=o(n);let i=N(r);return e.min!=null&&(i=i.min(e.min)),e.max!=null&&(i=i.max(e.max)),i.describe(`"${e.label}", multiple entries of ${t.type} values${e.min!=null||e.max!=null?" within the defined count range":""}`)}};function ut(e){var o;const t=_n[e.type];let n=t(e);return e.required===!0&&(n._def.typeName==="ZodString"?((o=n._def.checks)==null?void 0:o.some(r=>r.kind==="min"))!==!0&&(n=n.min(1)):n._def.typeName==="ZodArray"&&n._def.minLength==null&&(n=n.min(1))),n}function bn(e){if(typeof e.fields!="object"||e.fields===null)return;const t={};for(const[n,o]of Object.entries(e.fields))o.disabled||o.hidden||ct.has(o.type)||(t[n]=ut({...o,name:n}));return pe(t)}function Y(e,t){let n=B();return e.minlength!=null&&(n=n.min(e.minlength)),e.maxlength!=null&&(n=n.max(e.maxlength)),n.describe(t)}function yn(e){let t=aa();return e.min!=null&&(t=t.min(e.min)),e.max!=null&&(t=t.max(e.max)),t.describe(`"${e.label}", a numeric value${e.min!=null||e.max!=null?" within the defined range":""}`)}function lt(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?Re(t).describe(`"${e.label}", single selection value based on the predefined options`):B().describe(`"${e.label}", single selection value`)}function dt(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?N(Re(t)).describe(`"${e.label}", one ore many values based on the predefined options`):N(B()).describe(`"${e.label}", multiple selection values`)}function wn(e){const{name:t,type:n,fields:o}=e;if(!o||Object.keys(o).length===0)return;const r={};for(const i of Object.values(o)){if(i.disabled||i.hidden||ct.has(i.type))continue;const s=ut(i);r[i.name]=s}return pe({type:wa(n),content:pe(r)}).describe(`Kirby block: ${t}`)}function Ra(e){if(!Array.isArray(e)||e.length===0)throw new Error("Invalid fieldsets configuration");const t=e.map(wn).filter(Boolean);return st(t).describe("Union of all Kirby block types")}let Ue,ke;function Me(){async function e(){return Ue||ke||(ke=window.panel.api.get(uo).then(o=>(Ue=o,ke=void 0,Ue)),ke)}async function t(o){let r=await e();const{config:i}=await W();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(r=r.filter(s=>!i.excludedBlocks.includes(s.type))),o.fieldsets){const s=Array.isArray(o.fieldsets)?o.fieldsets:Object.keys(o.fieldsets);r=r.filter(a=>s.includes(a.type))}return Ra(r)}function n(o){return o.isHidden??(o.isHidden=!1),o.id??(o.id=crypto.randomUUID()),o}return{getFieldsets:e,getZodSchema:t,normalizeBlock:n}}function Ua(e,t,n,o){let r;const i=()=>{r==null||r(),r=void 0},s=(u,d,h,m)=>(u.addEventListener(d,h,m),()=>u.removeEventListener(d,h,m)),a=Ge(()=>Ma(e),u=>{i(),u&&(r=s(u,t,n,o))},{immediate:!0,flush:"post"}),c=()=>{a(),i()};return Wn()&&qn(c),c}function Ma(e){const t=Ke(e);return(t==null?void 0:t.$el)??t}function kn(){return _o({accept:[...We,"application/pdf"].join(",")})}function Fa(e){const t=new Set;for(const n of e)for(const o of n)typeof o=="string"&&o.trim()&&t.add(o);return[...t]}function Ba(e,t){const n=e.map(wn).filter(Boolean),o=n.length>1?st(n):n[0];return pe({width:Re(t).describe('Column width fraction to use, e.g. "1/2"'),blocks:N(o).describe("Array of blocks contained in this column")})}function Na(e,t){const n=Ba(e,t);return pe({columns:N(n).min(1).describe("Array of columns in this layout")})}function Ka(e,t={}){if(!e||e.length===0)throw new Error("No fieldsets available for layout schema generation");const n=t.layouts??[["1/1"]],o=Fa(n),r=Na(e,o),i=n.map(s=>`"${s}"`).join(", ");return r.describe(`Kirby layout with columns and blocks. Available layout combinations: ${i}. Use these exact column width combinations when creating layouts.`)}function pt(){const{getFieldsets:e}=Me();async function t(o){let r=await e();const{config:i}=await W();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(r=r.filter(s=>!i.excludedBlocks.includes(s.type))),o.fieldsets){const s=Array.isArray(o.fieldsets)?o.fieldsets:Object.keys(o.fieldsets);r=r.filter(a=>s.includes(a.type))}return Ka(r,o)}function n(o){return o.id??(o.id=crypto.randomUUID()),o.attrs??(o.attrs=[]),o.columns=(o.columns??[]).map(r=>(r.id??(r.id=crypto.randomUUID()),r.width??(r.width="1/1"),r.blocks=(r.blocks??[]).map(i=>(i.isHidden??(i.isHidden=!1),i.id??(i.id=crypto.randomUUID()),i)),r)),o}return{getZodSchema:t,normalizeLayout:n}}function Ga(e){return typeof e=="string"?`'${e}'`:new Va().serialize(e)}const Va=function(){var t;class e{constructor(){Dn(this,t,new Map)}compare(o,r){const i=typeof o,s=typeof r;return i==="string"&&s==="string"?o.localeCompare(r):i==="number"&&s==="number"?o-r:String.prototype.localeCompare.call(this.serialize(o,!0),this.serialize(r,!0))}serialize(o,r){if(o===null)return"null";switch(typeof o){case"string":return r?o:`'${o}'`;case"bigint":return`${o}n`;case"object":return this.$object(o);case"function":return this.$function(o)}return String(o)}serializeObject(o){const r=Object.prototype.toString.call(o);if(r!=="[object Object]")return this.serializeBuiltInType(r.length<10?`unknown:${r}`:r.slice(8,-1),o);const i=o.constructor,s=i===Object||i===void 0?"":i.name;if(s!==""&&globalThis[s]===i)return this.serializeBuiltInType(s,o);if(typeof o.toJSON=="function"){const a=o.toJSON();return s+(a!==null&&typeof a=="object"?this.$object(a):`(${this.serialize(a)})`)}return this.serializeObjectEntries(s,Object.entries(o))}serializeBuiltInType(o,r){const i=this["$"+o];if(i)return i.call(this,r);if(typeof(r==null?void 0:r.entries)=="function")return this.serializeObjectEntries(o,r.entries());throw new Error(`Cannot serialize ${o}`)}serializeObjectEntries(o,r){const i=Array.from(r).sort((a,c)=>this.compare(a[0],c[0]));let s=`${o}{`;for(let a=0;a<i.length;a++){const[c,u]=i[a];s+=`${this.serialize(c,!0)}:${this.serialize(u)}`,a<i.length-1&&(s+=",")}return s+"}"}$object(o){let r=Se(this,t).get(o);return r===void 0&&(Se(this,t).set(o,`#${Se(this,t).size}`),r=this.serializeObject(o),Se(this,t).set(o,r)),r}$function(o){const r=Function.prototype.toString.call(o);return r.slice(-15)==="[native code] }"?`${o.name||""}()[native]`:`${o.name}(${o.length})${r.replace(/\s*\n\s*/g,"")}`}$Array(o){let r="[";for(let i=0;i<o.length;i++)r+=this.serialize(o[i]),i<o.length-1&&(r+=",");return r+"]"}$Date(o){try{return`Date(${o.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(o){return`ArrayBuffer[${new Uint8Array(o).join(",")}]`}$Set(o){return`Set${this.$Array(Array.from(o).sort((r,i)=>this.compare(r,i)))}`}$Map(o){return this.serializeObjectEntries("Map",o.entries())}}t=new WeakMap;for(const n of["Error","RegExp","URL"])e.prototype["$"+n]=function(o){return`${n}(${o})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])e.prototype["$"+n]=function(o){return`${n}[${o.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])e.prototype["$"+n]=function(o){return`${n}[${o.join("n,")}${o.length>0?"n":""}]`};return e}(),Wa=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Ya=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Ha="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",oe=[];class qa{constructor(){V(this,"_data",new fe);V(this,"_hash",new fe([...Wa]));V(this,"_nDataBytes",0);V(this,"_minBufferSize",0)}finalize(t){t&&this._append(t);const n=this._nDataBytes*8,o=this._data.sigBytes*8;return this._data.words[o>>>5]|=128<<24-o%32,this._data.words[(o+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(o+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,n){const o=this._hash.words;let r=o[0],i=o[1],s=o[2],a=o[3],c=o[4],u=o[5],d=o[6],h=o[7];for(let m=0;m<64;m++){if(m<16)oe[m]=t[n+m]|0;else{const z=oe[m-15],P=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,C=oe[m-2],K=(C<<15|C>>>17)^(C<<13|C>>>19)^C>>>10;oe[m]=P+oe[m-7]+K+oe[m-16]}const f=c&u^~c&d,v=r&i^r&s^i&s,y=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),x=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),b=h+x+f+Ya[m]+oe[m],j=y+v;h=d,d=u,u=c,c=a+b|0,a=s,s=i,i=r,r=b+j|0}o[0]=o[0]+r|0,o[1]=o[1]+i|0,o[2]=o[2]+s|0,o[3]=o[3]+a|0,o[4]=o[4]+c|0,o[5]=o[5]+u|0,o[6]=o[6]+d|0,o[7]=o[7]+h|0}_append(t){typeof t=="string"&&(t=fe.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let n,o=this._data.sigBytes/64;t?o=Math.ceil(o):o=Math.max((o|0)-this._minBufferSize,0);const r=o*16,i=Math.min(r*4,this._data.sigBytes);if(r){for(let s=0;s<r;s+=16)this._doProcessBlock(this._data.words,s);n=this._data.words.splice(0,r),this._data.sigBytes-=i}return new fe(n,i)}}class fe{constructor(t,n){V(this,"words");V(this,"sigBytes");t=this.words=t||[],this.sigBytes=n===void 0?t.length*4:n}static fromUtf8(t){const n=unescape(encodeURIComponent(t)),o=n.length,r=[];for(let i=0;i<o;i++)r[i>>>2]|=(n.charCodeAt(i)&255)<<24-i%4*8;return new fe(r,o)}toBase64(){const t=[];for(let n=0;n<this.sigBytes;n+=3){const o=this.words[n>>>2]>>>24-n%4*8&255,r=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,i=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,s=o<<16|r<<8|i;for(let a=0;a<4&&n*8+a*6<this.sigBytes*8;a++)t.push(Ha.charAt(s>>>6*(3-a)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<t.sigBytes;n++){const o=t.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=o<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<t.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=t.words[n>>>2];this.sigBytes+=t.sigBytes}}function Ja(e){return new qa().finalize(e).toBase64()}function Xa(e){return Ja(Ga(e))}function $n(...e){return`${po}${Xa([...e])}`}const zn=50;function Qa(){const e=$n("history",window.location.hostname),t=_(JSON.parse(localStorage.getItem(e)||"[]")),n=_(""),o=_(-1);function r(s){if(!s||typeof s!="string"||!s.trim())return;const a=s.trim(),c=t.value.indexOf(a);c!==-1&&t.value.splice(c,1),t.value.unshift(a),t.value.length>zn&&(t.value=t.value.slice(0,zn)),localStorage.setItem(e,JSON.stringify(t.value)),o.value=-1}function i(s){if(t.value.length!==0){if(s==="up"){if(o.value+1<t.value.length)return o.value++,t.value[o.value]}else if(s==="down"){if(o.value>0)return o.value--,t.value[o.value];if(o.value===0)return o.value=-1,n.value}}}return{lastPrompt:n,currentIndex:o,addToHistory:r,navigateHistory:i}}const ec=Object.assign({inheritAttrs:!1},{__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String,default:void 0}},emits:["input","mounted"],setup(e,{emit:t}){const n=e,o=_(),r=q({get(){return n.value},set(i){t("input",i)}});return vt(()=>{t("mounted",o.value)}),{__sfc:!0,props:n,emit:t,textarea:o,text:r}}});var tc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",t._b({directives:[{name:"model",rawName:"v-model",value:o.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:t.sharedClass,domProps:{value:o.text},on:{input:function(r){r.target.composing||(o.text=r.target.value)}}},"textarea",t.$attrs,!1)),t._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:t.sharedClass,domProps:{textContent:t._s(`${t.value} `)}})])},nc=[],oc=ge(ec,tc,nc,!1,null,"a814ce2d");const rc=oc.exports,ic={__name:"Prompt",props:{fields:{type:Array,default:()=>[]},selection:{type:String,default:""}},emits:["cancel","close","input","submit","success"],setup(e,{emit:t}){const n=me(),o=k(),{lastPrompt:r,currentIndex:i,addToHistory:s,navigateHistory:a}=Qa(),c=_(),u=_(),d=_([]),h=_([]),m=_("append"),f=_(""),v=_();Ua(c,"keydown",b=>{if((b.metaKey||b.ctrlKey)&&b.key==="Enter"&&y(),b.key==="ArrowUp"&&b.target.selectionStart===0||b.key==="ArrowDown"&&b.target.selectionStart===b.target.value.length){b.preventDefault(),b.key==="ArrowUp"&&i.value===-1&&(r.value=f.value);const j=a(b.key==="ArrowUp"?"up":"down");j!==void 0&&(f.value=j)}}),(async()=>{const b=await W();v.value=b.licenseStatus})();function y(){s(f.value),t("submit",{prompt:f.value,files:d.value,fields:h.value,append:m.value==="append"})}async function x(){const b=await kn();d.value=[...d.value,...b]}return{__sfc:!0,emit:t,_isKirby5:n,panel:o,lastPrompt:r,currentIndex:i,addToHistory:s,navigateHistory:a,textarea:c,picklist:u,files:d,selectedFields:h,insertOption:m,prompt:f,licenseStatus:v,submit:y,pickFiles:x,LicensingButtonGroup:bt,AutoGrowTextarea:rc}}};var sc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(r){return o.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] focus-within:kai-outline focus-within:kai-outline-[2px] focus-within:kai-outline-[var(--color-focus,currentColor)]"},[n(o.AutoGrowTextarea,{attrs:{value:o.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:o.panel.t("johannschopplich.copilot.prompt.placeholder")+(t.selection?` (${o.panel.t("johannschopplich.copilot.prompt.selectionContext")})`:""),rows:"3"},on:{input:function(r){o.prompt=r},mounted:function(r){o.textarea=r}}}),n("div",{staticClass:"kai-flex kai-items-center kai-justify-between kai-px-2 kai-pb-2"},[n("k-button-group",{staticClass:"kai-gap-1"},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{theme:"empty",icon:"attachment",badge:o._isKirby5&&o.files.length>0?{theme:"notice",text:o.files.length}:void 0},on:{click:function(r){return o.pickFiles()}}}),o.files.length>0?n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(r){o.files=[]}}}):t._e()],1),n("div",{staticClass:"kai-flex kai-gap-2"},[t.fields.length>0?[n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.fields"),variant:"filled",badge:o.selectedFields.length>0?{theme:"info",text:o.selectedFields.length}:void 0,dropdown:""},on:{click:function(r){return o.picklist.toggle()}}}),n("k-picklist-dropdown",{ref:"picklist",attrs:{options:t.fields.map(r=>({value:r.name,text:r.label||r.name})),empty:!1,value:o.selectedFields},on:{input:function(r){o.selectedFields=r}}})]:t.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:[{value:"append",text:o.panel.t("johannschopplich.copilot.append")},{value:"replace",text:o.panel.t("johannschopplich.copilot.replace")}],empty:!1,value:o.insertOption},on:{input:function(r){o.insertOption=r}}}):t._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling",disabled:!o.prompt.trim()||t.fields.length>0&&o.selectedFields.length===0},on:{click:function(r){return o.submit()}}},[t._v(" "+t._s(o.panel.t("johannschopplich.copilot.generate"))+" ")])],2)],1),o.licenseStatus!==void 0?n(o.LicensingButtonGroup,{staticClass:"kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":o.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):t._e()],1)])},ac=[],cc=ge(ic,sc,ac,!1,null,null);const uc=cc.exports,lc={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};var Sn="vercel.ai.error",dc=Symbol.for(Sn),xn,pc=class Rn extends Error{constructor({name:t,message:n,cause:o}){super(n),this[xn]=!0,this.name=t,this.cause=o}static isInstance(t){return Rn.hasMarker(t,Sn)}static hasMarker(t,n){const o=Symbol.for(n);return t!=null&&typeof t=="object"&&o in t&&typeof t[o]=="boolean"&&t[o]===!0}};xn=dc;var In=pc,Zn="AI_InvalidArgumentError",En=`vercel.ai.error.${Zn}`,fc=Symbol.for(En),Pn,hc=class extends In{constructor({message:e,cause:t,argument:n}){super({name:Zn,message:e,cause:t}),this[Pn]=!0,this.argument=n}static isInstance(e){return In.hasMarker(e,En)}};Pn=fc,new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var mc=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{const r=()=>{const i=n.length,s=new Array(t);for(let a=0;a<t;a++)s[a]=n[Math.random()*i|0];return s.join("")};if(e==null)return r;if(n.includes(o))throw new hc({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return()=>`${e}${o}${r()}`};mc();function ft(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}const An={...lc},gc=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:An,setup(e){const t=e,n=me(),o=k(),{t:r}=Mn(),{currentContent:i,update:s}=Be(),a=_(),c=_(),u=_(),d=_(),h=_(),m=_(),f=_(),v=_(),y=_(),x=_(),b=_(),j=_(!1),z=_(!1),P=_(!1),C=_(),K=_(),U=_(),w=_([]),M=_([]),Fe=_();let G,F;const $e=q(()=>!z.value&&U.value!==void 0);Ge(K,L=>{j.value&&h.value&&(L&&L!==u.value?localStorage.setItem(`${G}$prompt`,L):(!L||L===u.value)&&localStorage.removeItem(`${G}$prompt`))}),Ge(P,L=>{j.value&&h.value&&(L?localStorage.setItem(`${G}$open`,"true"):localStorage.removeItem(`${G}$open`))}),(async()=>{var ze;const{load:L}=Fn(),[re,A]=await Promise.all([W(),L({parent:t.parent,name:t.name})]);if(a.value=r(A.label)||o.t("johannschopplich.copilot.label"),c.value=A.field??void 0,u.value=A.userPrompt??void 0,d.value=A.systemPrompt||re.config.systemPrompt||Ye,h.value=A.storage,A.editable===!0&&w.value.push("edit"),A.files===!0&&w.value.push("files"),m.value=A.theme||"notice-icon",f.value=A.size||"md",v.value=lo.indexOf(re.config.logLevel??A.logLevel),x.value=A.help?r(A.help):void 0,b.value=re.config,Fe.value=re.licenseStatus,A.files==="auto"&&A.modelFile){y.value=A.modelFile;const{mime:D,url:he}=A.modelFile;We.includes(D)&&fetch(he).then(H=>H.blob()).then(H=>{M.value=[H]})}h.value&&((ze=c.value)!=null&&ze.name)&&(G=$n(o.view.path,c.value.name.toLowerCase()),K.value=localStorage.getItem(`${G}$prompt`)||u.value||"",P.value=localStorage.getItem(`${G}$open`)==="true"||A.open,Yn(()=>{C.value&&P.value&&(C.value.open=!0)})),o.events.on("view.save",ht),j.value=!0})(),Hn(()=>{o.events.off("view.save",ht)});async function Ac(){if(!K.value){o.notification.error(o.t("johannschopplich.copilot.prompt.empty"));return}o.isLoading=!0,z.value=!0,U.value=i.value[c.value.name.toLowerCase()],F=new AbortController;const{getZodSchema:L,normalizeBlock:re}=Me(),{getZodSchema:A,normalizeLayout:ze}=pt();try{let D="",he=[];if(c.value.type==="layout"||c.value.type==="blocks"){const H=await(c.value.type==="layout"?A:L)(c.value),{partialObjectStream:ie,object:Tc}=await $t({userPrompt:K.value,systemPrompt:d.value,schema:H,output:"array",files:M.value,logLevel:v.value,abortSignal:F.signal});for await(const mt of ie)!mt||!Array.isArray(mt)||await s({[c.value.name.toLowerCase()]:[...U.value,...mt.map(c.value.type==="layout"?ze:re)]},!1);he=await Tc}else{const{textStream:H}=await kt({userPrompt:[`<response_format>
${fo[c.value.type]||"text"}
</response_format>`,K.value].join(`

`),systemPrompt:d.value,files:M.value,logLevel:v.value,abortSignal:F.signal});for await(const ie of H)D+=ie,await s({[c.value.name.toLowerCase()]:U.value+D},!1)}await s({[c.value.name.toLowerCase()]:c.value.type==="layout"||c.value.type==="blocks"?[...U.value,...(he??[]).map(c.value.type==="layout"?ze:re)]:U.value+D}),o.notification.success({icon:"sparkling",message:o.t("johannschopplich.copilot.generator.success")})}catch(D){if(ft(D))return;const{AISDKError:he,APICallError:H}=await te("ai");if(D instanceof ve||he.isInstance(D)||H.isInstance(D)){let ie=D.message;ie.includes("levels of nesting exceeds limit")&&(ie=`The ${c.value.type} generation for the "${c.value.name}" field exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas.`),console.error(D),o.notification.error(ie);return}console.error(D),o.notification.error(o.t("johannschopplich.copilot.generator.error"))}finally{F=void 0,o.isLoading=!1,z.value=!1}}function jc(){F==null||F.abort(),F=void 0,o.isLoading=!1,z.value=!1}function Cc(){s({[c.value.name.toLowerCase()]:U.value}),U.value=void 0}async function Oc(){const L=await kn();M.value=[...M.value,...L]}function ht(){$e.value&&(U.value=void 0)}return{__sfc:!0,propsDefinition:An,props:t,_isKirby5:n,panel:o,t:r,currentContent:i,updateContent:s,label:a,field:c,userPrompt:u,systemPrompt:d,storage:h,theme:m,size:f,logLevel:v,modelFile:y,help:x,config:b,isInitialized:j,isGenerating:z,isDetailsOpen:P,detailsElement:C,currentPrompt:K,currentFieldContent:U,permissions:w,files:M,licenseStatus:Fe,storageKey:G,abortController:F,canUndo:$e,generate:Ac,abort:jc,undo:Cc,pickFiles:Oc,onModelSave:ht,LicensingButtonGroup:bt,SUPPORTED_IMAGE_MIME_TYPES:We,SUPPORTED_PROVIDERS:yt}}});var vc=function(){var r,i,s,a,c,u;var t=this,n=t._self._c,o=t._self._setupProxy;return o.isInitialized?n("k-section",{attrs:{label:o.label}},[o.licenseStatus!==void 0?n("template",{slot:"options"},[n(o.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":o.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):t._e(),!o.config.provider||!o.SUPPORTED_PROVIDERS.includes(o.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Unsupported provider "),n("code",[t._v(t._s(o.config.provider))]),t._v(" in the "),n("code",[t._v("johannschopplich.copilot.provider")]),t._v(" global configuration. ")])],1):(i=(r=o.config.providers)==null?void 0:r[o.config.provider])!=null&&i.apiKey?(a=(s=o.config.providers)==null?void 0:s[o.config.provider])!=null&&a.model?!o.field||typeof o.field=="string"||typeof o.field=="object"&&!(((c=o.field)==null?void 0:c.name.toLowerCase())in o.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" The "),n("code",[t._v(t._s(((u=o.field)==null?void 0:u.name)??o.field))]),t._v(" field does not exist in the current model. ")])],1):!o.permissions.includes("edit")&&!o.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" If the user prompt cannot be edited by the user, a default "),n("code",[t._v("userPrompt")]),t._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:o.isGenerating?"loader":"sparkling",text:o.panel.t("johannschopplich.copilot.generate"),theme:o.theme,variant:"filled",size:o.size,disabled:o.isGenerating},on:{click:function(d){return o.generate()}}}),o.isGenerating?n("k-button",{attrs:{icon:"cancel",text:o.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:o.size},on:{click:function(d){return o.abort()}}}):t._e(),o.canUndo?n("k-button",{attrs:{icon:"undo",text:o.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:o.size},on:{click:function(d){return o.undo()}}}):t._e()],1),o.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(d){o.isDetailsOpen=d.target.open}}},[n("summary",[t._v(" "+t._s([...o.permissions.includes("edit")?[o.panel.t("johannschopplich.copilot.prompt.label")]:[],...o.permissions.includes("files")?[o.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[o.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:o.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:o.currentPrompt,placeholder:o.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(d){o.currentPrompt=d}}})],1):t._e(),o.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:o.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:o._isKirby5&&o.files.length>0?{theme:"notice",text:o.files.length}:void 0,size:"sm"},on:{click:function(d){return o.pickFiles()}}}),o.files.length>0?n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(d){o.files=[]}}}):t._e(),o.permissions.includes("edit")&&o.userPrompt&&o.currentPrompt!==o.userPrompt?n("k-button",{staticClass:"kai-ml-auto",attrs:{icon:"undo",text:o.panel.t("johannschopplich.copilot.reset"),variant:"dimmed",size:"xs"},on:{click:function(d){o.currentPrompt=o.userPrompt}}}):t._e()],1):o.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[t._v(" "+t._s(o.panel.t(`johannschopplich.copilot.context.file.${o.SUPPORTED_IMAGE_MIME_TYPES.includes(o.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):t._e()],1)]):t._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("model")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${o.config.provider}`))]),t._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("apiKey")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${o.config.provider}`))]),t._v(" global configuration. ")])],1),o.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:o.help}})],1):t._e()],2):t._e()},_c=[],bc=ge(gc,vc,_c,!1,null,null);const yc=bc.exports;async function jn(e,{appendText:t,replaceText:n,responseFormat:o="text"}){const r=k(),i=new AbortController,s=f=>{f.key==="Escape"&&i.abort()},a=await Cn({selection:e});if(!a)return;const{prompt:c,files:u}=a;if(!c)return;r.isLoading=!0,document.addEventListener("keydown",s);const{config:d}=await W(),{AISDKError:h,APICallError:m}=await te("ai");try{const{textStream:f}=await kt({userPrompt:[`<response_format>
${o}
</response_format>`,e&&`<selected_text>
${e}
</selected_text>`,c].filter(Boolean).join(`

`),systemPrompt:d.systemPrompt||Ye,files:u,abortSignal:i.signal});let v=!0;for await(let y of f)a.append?(v&&(y=e?` ${y}`:y,v=!1),t(y)):n(y);r.notification.success({icon:"sparkling",message:r.t("johannschopplich.copilot.generator.success")})}catch(f){if(ft(f))return;if(f instanceof ve||h.isInstance(f)||m.isInstance(f)){console.error(f),r.notification.error(f.message);return}console.error(f),r.notification.error(r.t("johannschopplich.copilot.generator.error"))}finally{r.isLoading=!1,document.removeEventListener("keydown",s)}}async function Cn(e={}){return new Promise(t=>{const n=k();let o;n.dialog.open({component:"k-copilot-prompt-dialog",props:e,on:{close:()=>{setTimeout(()=>{t(o)},25)},submit:r=>{o=r,n.dialog.close()}}})})}const wc={__name:"CopilotButton",setup(e){const t=k(),{currentContent:n,update:o}=Be(),r=_(!1),i=_(!1);let s;async function a(){s=new AbortController;const d=w=>{w.key==="Escape"&&c()};let h=await t.api.get(co,{id:t.view.path},void 0,!0);if(h=Object.values(h).filter(w=>!ct.has(w.type)&&!w.disabled&&!w.hidden),h.length===0){t.notification.error(t.t("johannschopplich.copilot.generator.noFields"));return}const m=await Cn({fields:h});if(!m)return;const{prompt:f,files:v,fields:y}=m,x=h.filter(w=>y.includes(w.name));if(!f||x.length===0)return;const{getZodSchema:b}=Me(),{getZodSchema:j}=pt(),z={};for(const w of x)w.type==="layout"?z[w.name]=N(await j(w)):w.type==="blocks"?z[w.name]=N(await b(w)):z[w.name]=ut(w);t.isLoading=!0,r.value=!0,document.addEventListener("keydown",d);const P={...n.value},{config:C}=await W(),{AISDKError:K,APICallError:U}=await te("ai");try{const{partialObjectStream:w,object:M}=await $t({userPrompt:f,systemPrompt:C.systemPrompt||Ye,schema:pe(z),output:"object",files:v,abortSignal:s.signal});for await(const F of w){if(!F)continue;const $e=u({object:F,selectedFields:x,currentContent:P});Object.keys($e).length>0&&await o($e,!1)}const Fe=await M,G=u({object:Fe,selectedFields:x,currentContent:P});await o(G),t.notification.success({icon:"sparkling",message:t.t("johannschopplich.copilot.generator.success")})}catch(w){if(ft(w))return;if(w instanceof ve||K.isInstance(w)||U.isInstance(w)){let M=w.message;M.includes("levels of nesting exceeds limit")&&(M="The fields generation exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas."),console.error(w),t.notification.error(M);return}console.error(w),t.notification.error(t.t("johannschopplich.copilot.generator.error"))}finally{s=void 0,t.isLoading=!1,r.value=!1,document.removeEventListener("keydown",d)}}function c(){s==null||s.abort(),s=void 0,r.value=!1,t.isLoading=!1}function u({object:d,selectedFields:h,currentContent:m}){const{normalizeBlock:f}=Me(),{normalizeLayout:v}=pt(),y={};for(const x of h){const b=d[x.name];if(b==null)continue;const j=m[x.name];x.type==="layout"||x.type==="blocks"?Array.isArray(b)&&(y[x.name]=[...j,...b.map(x.type==="layout"?v:f)]):y[x.name]=b}return y}return{__sfc:!0,panel:t,currentContent:n,updateContent:o,isGenerating:r,isHovering:i,abortController:s,initPromptDialog:a,abort:c,processFieldValues:u}}};var kc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("k-button",{attrs:{icon:o.isHovering&&o.isGenerating?"cancel":o.isGenerating?"loader":"sparkling",text:o.panel.t("johannschopplich.copilot.label"),theme:o.isHovering&&o.isGenerating?"notice":"notice-icon",variant:"filled",size:"sm",responsive:""},on:{click:function(r){o.isHovering&&o.isGenerating?o.abort():o.initPromptDialog()}},nativeOn:{mouseenter:function(r){o.isHovering=!0},mouseleave:function(r){o.isHovering=!1}}})},$c=[],zc=ge(wc,kc,$c,!1,null,null);const On=zc.exports,Sc={},xc={copilot:{icon:"sparkling",label:"Copilot Prompt",click(){let e="";this.command("insert",(r,i)=>(e=i,i));let t=!0;jn(e,{responseFormat:"markdown",appendText:r=>{this.command("insert",(i,s)=>t?(t=!1,s+r):r)},replaceText:r=>{this.command("insert",()=>r)}})},shortcut:"."}},Tn={"***":["bold","italic"],"**":["bold"],"*":["italic"],"`":["code"]},Ic={copilot:{get button(){return{icon:"sparkling",label:"Copilot Prompt"}},commands(e){return()=>this._openPromptDialog(e)},keys(e){return{"Mod-.":()=>this._openPromptDialog(e)}},get name(){return"copilot"},_insertText(e,t,n,o,r){let i=n;const s=t.split(/(\n\n?|\*{1,3}|`{1,3})/);for(const a of s)if(a===`

`)e=e.replaceWith(i,i,this.editor.options.inline?[r.schema.nodes.hardBreak.create(),r.schema.nodes.hardBreak.create()]:r.schema.nodes.paragraph.create()),i+=2;else if(a===`
`)e=e.replaceWith(i,i,r.schema.nodes.hardBreak.create()),i+=1;else if(a.length>0){if(a in Tn&&!o.lastSegment.includes(a)||[...o.activeMarks].some(c=>c.type.name===a)){for(const c of Tn[a])e=Zc(e,c,o,r);o.lastSegment=a;continue}e=e.insertText(a,i),i+=a.length,o.lastSegment=a}return{tr:e,newPosition:i}},_openPromptDialog(e){const{state:t}=this.editor,{from:n,to:o}=t.selection,r=t.doc.textBetween(n,o),i={activeMarks:new Set,lastSegment:""};let s,a=!1;jn(r,{responseFormat:"text",replaceText:d=>{const{state:h,view:m}=this.editor;let f=h.tr;if(!a){const x=Ec(h),{from:b,to:j}=h.selection;f=f.deleteRange(b,j),s=x?1:b,a=!0}const{tr:v,newPosition:y}=this._insertText(f,d,s,i,e);s=y,m.dispatch(v)},appendText:d=>{const{state:h,view:m}=this.editor;s=h.selection.to;const{tr:f,newPosition:v}=this._insertText(h.tr,d,s,i,e);s=v,m.dispatch(f)}})}}};function Zc(e,t,n,{schema:o}){if([...n.activeMarks].some(r=>r.type.name===t)){n.activeMarks.delete(t);const r=[...n.activeMarks].filter(i=>i.type.name!==t);return e.setStoredMarks(r)}else{const r=o.marks[t].create();return n.activeMarks.add(r),e.addStoredMark(r)}}function Ec(e){const t=e.doc.content.size,{from:n,to:o}=e.selection;return n===0&&o===t}function Pc(e){if(me())return;let t;e.mixin({mounted(){if(this.$options.name!=="k-header")return;const n=this.$children.find(r=>r.$options.name==="k-button-group");if(!n)return;const o=e.extend(On);t=new o({parent:this}),t.$mount(),n.$el.before(t.$el)},beforeDestroy(){this.$options.name==="k-header"&&t&&(t.$destroy(),t=void 0)}})}window.panel.plugin("johannschopplich/copilot",{viewButtons:{copilot:On},components:{"k-copilot-prompt-dialog":uc},sections:{copilot:yc},fields:{},textareaButtons:xc,writerMarks:Ic,icons:Sc,use:[Pc]})})();

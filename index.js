var Uc=Object.defineProperty;var Un=f=>{throw TypeError(f)};var Bc=(f,k,T)=>k in f?Uc(f,k,{enumerable:!0,configurable:!0,writable:!0,value:T}):f[k]=T;var G=(f,k,T)=>Bc(f,typeof k!="symbol"?k+"":k,T),Nc=(f,k,T)=>k.has(f)||Un("Cannot "+T);var Ie=(f,k,T)=>(Nc(f,k,"read from private field"),T?T.call(f):k.get(f)),Bn=(f,k,T)=>k.has(f)?Un("Cannot add the same private member more than once"):k instanceof WeakSet?k.add(f):k.set(f,T);(function(){"use strict";const f=window.Vue;function k(){return window.panel}function T(){return k().api}const _e=()=>window.panel.plugins.viewButtons!==void 0;function Kn(){return _e()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):k().app.$store}function Ge(){const e=k(),t=Kn(),n=_e();if(n&&!("diff"in e.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const r=Y(n?()=>e.content.version("changes"):()=>t.getters["content/values"]()),o=Y(n?()=>e.content.diff():()=>t.getters["content/changes"]()),i=Y(n?()=>e.content.hasDiff():()=>t.getters["content/hasChanges"]()),s=n?e.content:new Proxy({},{get(){return()=>{}}});return{content:s,currentContent:r,contentChanges:o,hasChanges:i,update:async(c,u=!0)=>{if(!n&&c)for(const[h,p]of Object.entries(c))t.dispatch("content/update",[h,p]);const d=s.merge(c);u&&await s.save(d)}}}function Gn(){const e=k();function t(n){return!n||typeof n=="string"?n:n[e.translation.code]??Object.values(n)[0]}return{t}}function Vn(){const e=T();return{load:({parent:n,name:r})=>e.get(`${n}/sections/${r}`)}}const Wn={error:0,warn:1,log:2,info:3,success:3};function Hn(e){const t=new qn;return new Proxy({},{get(n,r){return(...o)=>{t.log({level:Wn[r],type:r,tag:e,args:o})}}})}var qn=class{constructor(){G(this,"defaultColor","#7f8c8d");G(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});G(this,"typeColorMap",{success:"#2ecc71"})}log(e){const t=Yn(e.level),n=e.type==="log"?"":e.type,r=e.tag||"",o=`
background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),i=`%c${[r,n].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?t(`${i}%c ${e.args[0]}`,o,"",...e.args.slice(1)):t(i,o,...e.args)}};function Yn(e){return e<1?console.error:console.log}const Ze=[],Ve=new Map;async function Jn(e){if(!Array.isArray(e))throw new TypeError(`Expected an array, got ${typeof e}`);for(const t of e)Ze.some(n=>n.filename===t.filename)||Ze.push(t)}function bt(e){if(Ze.length===0)throw new Error("Plugin assets not registered");const t=Ze.find(n=>n.filename===e);if(!t)throw new Error(`Plugin asset "${e}" not found`);return t}async function ne(e){if(e.endsWith(".js")||(e+=".js"),Ve.has(e))return Ve.get(e);const t=await import(bt(e).url);return Ve.set(e,t),t}const Y=f.computed;f.customRef,f.defineAsyncComponent,f.defineComponent,f.effectScope,f.getCurrentInstance;const Xn=f.getCurrentScope;f.h,f.inject,f.isProxy,f.isReactive,f.isReadonly,f.isRef,f.isShallow,f.markRaw;const Qn=f.nextTick;f.onActivated,f.onBeforeMount;const er=f.onBeforeUnmount;f.onBeforeUpdate,f.onDeactivated,f.onErrorCaptured;const wt=f.onMounted;f.onRenderTracked,f.onRenderTriggered;const tr=f.onScopeDispose;f.onServerPrefetch,f.onUnmounted,f.onUpdated,f.provide,f.proxyRefs,f.reactive,f.readonly;const y=f.ref;f.shallowReactive,f.shallowReadonly,f.shallowRef,f.toRaw,f.toRef,f.toRefs,f.triggerRef;const We=f.unref;f.useAttrs,f.useCssModule,f.useCssVars,f.useListeners,f.useSlots;const He=f.watch;f.watchEffect,f.watchPostEffect,f.watchSyncEffect;const qe={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible":"License key invalid for this plugin version","modal.error.upgradeable":"License key invalid for this plugin version. Upgrade now on https://hub.kirby.tools.","modal.error.activated":"License key already activated",activate:"Activate",activated:"Plugin activated",buy:"Buy a license",upgrade:"Upgrade"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.upgradeable":"Lizenzschlüssel ungültig für diese Plugin-Version. Aktualisiere jetzt auf https://hub.kirby.tools.","modal.error.activated":"Lizenzschlüssel bereits aktiviert",activate:"Aktivieren",activated:"Plugin aktiviert",buy:"Lizenz kaufen",upgrade:"Upgrade"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible":"Clé de licence invalide pour cette version du plugin","modal.error.upgradeable":"Clé de licence invalide pour cette version du plugin. Mettez à niveau maintenant sur https://hub.kirby.tools.","modal.error.activated":"Clé de licence déjà activée",activate:"Activer",activated:"Plugin activé",buy:"Acheter une licence",upgrade:"Upgrade"},nl:{"modal.info":"Bedankt voor het kopen van {label}! Voer je e-mailadres en bestelnummer in om je licentie te activeren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Vind je bestelnummer</a> op Lemon Squeezy of <a href="mailto:hello@kirby.tools">neem contact met ons op</a> als je het niet kunt vinden.',"modal.error.required.fields":"E-mailadres en bestelnummer zijn verplicht","modal.error.invalid.unauthorized":"E-mailadres of bestelnummer is onjuist","modal.error.invalid.licenseKey":"Licentiesleutel ongeldig voor dit plug-in","modal.error.incompatible":"Licentiesleutel ongeldig voor deze plug-inversie","modal.error.upgradeable":"Licentiesleutel ongeldig voor deze plug-inversie. Upgrade nu op https://hub.kirby.tools.","modal.error.activated":"Licentiesleutel al geactiveerd",activate:"Activeren",activated:"Plugin geactiveerd",buy:"Koop een licentie",upgrade:"Upgrade"}},nr=["localhost","127.0.0.1","[::1]"],rr=["local","test","ddev.site"];function re(e="",t){var o;const n=window.panel.translation.code,r=((o=qe==null?void 0:qe[n])==null?void 0:o[e])??e;return t?or(r,t):r}function or(e,t,n){return e.replace(/\{(\w+)\}/g,(r,o)=>t[o]||o)}function ir(){const{hostname:e}=window.location,t=nr.includes(e),n=rr.some(r=>e.endsWith(`.${r}`));return t||n}const kt={Unauthorized:"modal.error.invalid.unauthorized","License key not valid for this plugin":"modal.error.invalid.licenseKey","License key not valid for this plugin version":"modal.error.incompatible","License key not valid for this plugin version, please upgrade your license":"modal.error.upgradeable","License key already activated":"modal.error.activated"};function sr(e){const t=k();return{isLocalhost:ir(),assertActivationIntegrity:async({component:i,licenseStatus:s})=>{if(We(s)==="active")return;const a=We(i);if(!(a!=null&&a.$el)||window.getComputedStyle(a.$el).display==="none"||window.getComputedStyle(a.$el).visibility==="hidden"||window.getComputedStyle(a.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let i=!1;const{label:s}=e,a={info:{type:"info",text:re("modal.info",{label:s})},email:{label:t.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:re("modal.fields.orderId.help",{label:s})}};return new Promise(c=>{t.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:re("activate",{label:s})},fields:a},on:{close:()=>{c({isLicenseActive:i})},submit:async u=>{i=await ar(u,e),i&&(t.dialog.close(),t.notification.success(re("activated")))}}})})}}}async function ar(e,t){const n=k(),{email:r,orderId:o}=e;if(!r||!o)return n.notification.error(re("modal.error.required.fields")),!1;try{const i=await n.api.post(`${t.apiNamespace}/activate`,{email:r,orderId:Number(o)});if((i==null?void 0:i.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(i){const s=i.message;return n.notification.error(kt[s]?re(kt[s]):s),!1}}const cr=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(e){const t=e,{openLicenseModal:n,assertActivationIntegrity:r}=sr({label:t.label,apiNamespace:t.apiNamespace}),o=y(t.licenseStatus),i=y();wt(()=>{r({component:i,licenseStatus:t.licenseStatus})});async function s(){const{isLicenseActive:a}=await n();a&&window.location.reload()}return{__sfc:!0,props:t,openLicenseModal:n,assertActivationIntegrity:r,currentLicenseStatus:o,licenseButtonGroup:i,handleRegistration:s,t:re}}});function ye(e,t,n,r,o,i,s,a){var c=typeof e=="function"?e.options:e;return t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c._scopeId="data-v-"+i),{exports:e,options:c}}var ur=function(){var t=this,n=t._self._c,r=t._self._setupProxy;return r.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:r.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":t.pricingUrl,target:"_blank",text:r.currentLicenseStatus==="upgradeable"?r.t("upgrade"):r.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:r.t("activate")},on:{click:function(o){return r.handleRegistration()}}})],1):t._e()},lr=[],dr=ye(cr,ur,lr,!1,null,null);const $t=dr.exports,pr="__copilot__/context",fr="__copilot__/model-fields",hr="__copilot__/fieldsets",zt=["anthropic","google","mistral","openai"],Ye=["image/gif","image/jpeg","image/png","image/webp"],ce=["error","warn","info","debug"],St="warn",mr="kirby$copilot$",gr={list:"HTML",markdown:"markdown",textarea:"markdown",writer:"HTML"},Je=`
You are an AI assistant integrated into the Kirby CMS Panel. Your primary task is to help users generate content for various field types within the CMS. You must provide relevant and helpful content based on the user's question and the specified field type, while considering any provided context.

Consider the user context if provided:
- If selected_text is provided, use it as context for the user's question.
- If pdf_documents are provided, incorporate the information from these documents into your response as applicable.

Format your response according to the specified response_format if provided:
1. If response_format is "text", provide your response in plain text without any Markdown or HTML syntax.
2. If response_format is "HTML", format your response using HTML syntax. Only include the content that would go inside the <body> element. Use appropriate HTML tags to structure your response, including <h2> or <h3> tags for section headings.
3. If response_format is "markdown", format your response using Markdown syntax. Do not use backticks or any other wrapping characters around your response.
`;class be extends Error{}let we;async function vr(e){const t=await yr(),n=await e.arrayBuffer(),r=await t.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:r.numPages},(i,s)=>_r(r,s+1)))).map(i=>i.replace(/\s+/g," ")).join(`
`)}async function _r(e,t){return(await(await e.getPage(t)).getTextContent()).items.filter(o=>o.str!=null).map(o=>o.str).join(" ")}async function yr(){if(we)return we;we=await ne("pdfjs");const e=bt("pdfjs.worker.js");return we.GlobalWorkerOptions.workerSrc=e.url,we}function br(e,t,n){return e.replace(/\{(\w+)\}/g,(r,o)=>t[o.toLowerCase()]||o)}async function wr({accept:e="*",multiple:t=!0}={}){const n=document.createElement("input");return n.type="file",n.classList.add("sr-only"),n.value=null,n.accept=e,n.multiple=t,n.click(),new Promise(r=>{n.addEventListener("change",o=>{var i;r([...((i=o.target)==null?void 0:i.files)??[]]),n.remove()},{once:!0})})}async function kr(e,t){const n=await $r(e);return await zr(n,e.type,t)}async function $r(e,t={}){if(!e.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${e.type}`);const n=new Image,r=URL.createObjectURL(e);t.crossOrigin&&(n.crossOrigin=t.crossOrigin);try{return await new Promise((i,s)=>{n.addEventListener("load",()=>{i(n)}),n.addEventListener("error",s),n.src=r})}finally{URL.revokeObjectURL(r)}}async function zr(e,t,n){if(!e.complete||!e.naturalWidth)throw new Error("Image has not been properly loaded");if(!t.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${t}`);const r=document.createElement("canvas"),o=r.getContext("2d"),i=Math.min(1,n/Math.max(e.width,e.height)),s=Math.round(e.width*i),a=Math.round(e.height*i);r.width=s,r.height=a,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(e,0,0,s,a);const c=await new Promise(u=>{r.toBlob(u,t)});if(!c)throw new Error("Failed to convert canvas to Blob");return c}function Sr(){const{currentContent:e}=Ge(),t={...e.value,title:window.panel.view.title};return Object.fromEntries(Object.entries(t).map(([n,r])=>[n,Array.isArray(r)||typeof r=="object"&&r!==null?JSON.stringify(r):r]))}let xr;function xt(){return xr??(xr=Hn("copilot"))}let Pe,ke;function V(){return Pe||ke||(ke=window.panel.api.get(pr).then(e=>(Jn(e.assets),Pe=e,ke=void 0,Pe)),ke)}async function Et({userPrompt:e,systemPrompt:t,files:n=[],logLevel:r=1,abortSignal:o}){const i=xt(),{config:s}=await V(),{model:a,providerOptions:c}=await Zt(),{AISDKError:u,APICallError:d,streamText:h,smoothStream:p}=await ne("ai"),{userPromptWithContext:m,imageByteArrays:v}=await Pt({userPrompt:e,files:n});return r>1&&(i.info("System prompt:",t),i.info("User prompt with context:",m)),h({model:a,providerOptions:c,temperature:s.temperature??void 0,system:t||void 0,...v.length>0?{messages:[{role:"user",content:[{type:"text",text:m},...v.map(_=>({type:"image",image:_}))]}]}:{prompt:m},experimental_transform:p({chunking:"line"}),abortSignal:o,onError({error:_}){if(u.isInstance(_)||d.isInstance(_))throw _}})}async function It({userPrompt:e,systemPrompt:t,schema:n,output:r="object",files:o=[],logLevel:i=1,abortSignal:s}){const a=xt(),{config:c}=await V(),{model:u,providerOptions:d}=await Zt(),{AISDKError:h,APICallError:p,streamObject:m}=await ne("ai"),{userPromptWithContext:v,imageByteArrays:_}=await Pt({userPrompt:e,files:o});return i>1&&(a.info("System prompt:",t),a.info("User prompt with context:",v)),m({model:u,providerOptions:d,temperature:c.temperature??void 0,schema:n,output:r,..._.length>0?{messages:[{role:"user",content:[{type:"text",text:v},..._.map(x=>({type:"image",image:x}))]}]}:{prompt:v},abortSignal:s,onError({error:x}){if(h.isInstance(x)||p.isInstance(x))throw x}})}async function Zt(){var h,p;let{config:e}=await V();if(!e.provider||!zt.includes(e.provider))throw new be(`Unsupported provider "${e.provider}" in the "johannschopplich.copilot.provider" global configuration.`);for(const m of["apiKey","model"])if(!((p=(h=e.providers)==null?void 0:h[e.provider])!=null&&p[m]))throw new be(`Missing "${m}" property in the "johannschopplich.copilot.providers.${e.provider}" global configuration.`);const{createAnthropic:t,createGoogleGenerativeAI:n,createMistral:r,createOpenAI:o}=await ne("ai"),i=e.provider,s=e.providers[i],a={anthropic:t,google:n,mistral:r,openai:o}[i],u=a({baseUrl:s.baseUrl||void 0,apiKey:s.apiKey,...i==="anthropic"?{headers:{"anthropic-dangerous-direct-browser-access":"true"}}:void 0}).languageModel(s.model),d=typeof s.options=="object"&&s.options!==null?{[i]:s.options}:void 0;return{model:u,providerOptions:d}}async function Pt({userPrompt:e,files:t=[]}){const n=Sr();let r=br(e,n);const o=t.filter(a=>a.type.startsWith("image/")),i=t.filter(a=>a.type==="application/pdf");if(i.length>0){const a=await Promise.all(i.map(vr));r+=`

${a.map((c,u)=>`<pdf_document_${u+1}>
${c}
</pdf_document_${u+1}>`).join(`

`)}`}const s=await Promise.all(o.map(async a=>{const u=await(await kr(a,2048)).arrayBuffer();return new Uint8Array(u)}));return{userPromptWithContext:r,imageByteArrays:s}}function l(e,t,n){function r(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(e))return;a._zod.traits.add(e),t(a,c);const u=s.prototype,d=Object.keys(u);for(let h=0;h<d.length;h++){const p=d[h];p in a||(a[p]=u[p].bind(a))}}const o=(n==null?void 0:n.Parent)??Object;class i extends o{}Object.defineProperty(i,"name",{value:e});function s(a){var c;const u=n!=null&&n.Parent?new i:this;r(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>{var c,u;return n!=null&&n.Parent&&a instanceof n.Parent?!0:(u=(c=a==null?void 0:a._zod)==null?void 0:c.traits)==null?void 0:u.has(e)}}),Object.defineProperty(s,"name",{value:e}),s}class ue extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class At extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Ct={};function J(e){return Ct}function Er(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function Xe(e,t){return typeof t=="bigint"?t.toString():t}function Qe(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function et(e){return e==null}function tt(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Ir(e,t){const n=(e.toString().split(".")[1]||"").length,r=t.toString();let o=(r.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(r)){const c=r.match(/\d?e-(\d?)/);c!=null&&c[1]&&(o=Number.parseInt(c[1]))}const i=n>o?n:o,s=Number.parseInt(e.toFixed(i).replace(".","")),a=Number.parseInt(t.toFixed(i).replace(".",""));return s%a/10**i}const jt=Symbol("evaluating");function z(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==jt)return r===void 0&&(r=jt,r=n()),r},set(o){Object.defineProperty(e,t,{value:o})},configurable:!0})}function oe(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function ie(...e){const t={};for(const n of e){const r=Object.getOwnPropertyDescriptors(n);Object.assign(t,r)}return Object.defineProperties({},t)}function Ot(e){return JSON.stringify(e)}function Zr(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const Tt="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Ae(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Pr=Qe(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function le(e){if(Ae(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(Ae(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function Lt(e){return le(e)?{...e}:Array.isArray(e)?[...e]:e}const Ar=new Set(["string","number","symbol"]);function de(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function X(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function g(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Cr(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const jr={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Or(e,t){const n=e._zod.def,r=ie(e._zod.def,{get shape(){const o={};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(o[i]=n.shape[i])}return oe(this,"shape",o),o},checks:[]});return X(e,r)}function Tr(e,t){const n=e._zod.def,r=ie(e._zod.def,{get shape(){const o={...e._zod.def.shape};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete o[i]}return oe(this,"shape",o),o},checks:[]});return X(e,r)}function Lr(e,t){if(!le(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const o=ie(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return oe(this,"shape",i),i},checks:[]});return X(e,o)}function Dr(e,t){if(!le(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return oe(this,"shape",r),r},checks:e._zod.def.checks};return X(e,n)}function Fr(e,t){const n=ie(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return oe(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return X(e,n)}function Rr(e,t,n){const r=ie(t._zod.def,{get shape(){const o=t._zod.def.shape,i={...o};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=e?new e({type:"optional",innerType:o[s]}):o[s])}else for(const s in o)i[s]=e?new e({type:"optional",innerType:o[s]}):o[s];return oe(this,"shape",i),i},checks:[]});return X(t,r)}function Mr(e,t,n){const r=ie(t._zod.def,{get shape(){const o=t._zod.def.shape,i={...o};if(n)for(const s in n){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=new e({type:"nonoptional",innerType:o[s]}))}else for(const s in o)i[s]=new e({type:"nonoptional",innerType:o[s]});return oe(this,"shape",i),i},checks:[]});return X(t,r)}function pe(e,t=0){var n;if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(((n=e.issues[r])==null?void 0:n.continue)!==!0)return!0;return!1}function fe(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Ce(e){return typeof e=="string"?e:e==null?void 0:e.message}function Q(e,t,n){var o,i,s,a,c,u;const r={...e,path:e.path??[]};if(!e.message){const d=Ce((s=(i=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,e))??Ce((a=t==null?void 0:t.error)==null?void 0:a.call(t,e))??Ce((c=n.customError)==null?void 0:c.call(n,e))??Ce((u=n.localeError)==null?void 0:u.call(n,e))??"Invalid input";r.message=d}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function nt(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function $e(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const Dt=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Xe,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Ft=l("$ZodError",Dt),Rt=l("$ZodError",Dt,{Parent:Error});function Ur(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function Br(e,t=n=>n.message){const n={_errors:[]},r=o=>{for(const i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>r({issues:s}));else if(i.code==="invalid_key")r({issues:i.issues});else if(i.code==="invalid_element")r({issues:i.issues});else if(i.path.length===0)n._errors.push(t(i));else{let s=n,a=0;for(;a<i.path.length;){const c=i.path[a];a===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(t(i))):s[c]=s[c]||{_errors:[]},s=s[c],a++}}};return r(e),n}const rt=e=>(t,n,r,o)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise)throw new ue;if(s.issues.length){const a=new((o==null?void 0:o.Err)??e)(s.issues.map(c=>Q(c,i,J())));throw Tt(a,o==null?void 0:o.callee),a}return s.value},ot=e=>async(t,n,r,o)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new((o==null?void 0:o.Err)??e)(s.issues.map(c=>Q(c,i,J())));throw Tt(a,o==null?void 0:o.callee),a}return s.value},je=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},o);if(i instanceof Promise)throw new ue;return i.issues.length?{success:!1,error:new(e??Ft)(i.issues.map(s=>Q(s,o,J())))}:{success:!0,data:i.value}},Nr=je(Rt),Oe=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(s=>Q(s,o,J())))}:{success:!0,data:i.value}},Kr=Oe(Rt),Gr=e=>(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return rt(e)(t,n,o)},Vr=e=>(t,n,r)=>rt(e)(t,n,r),Wr=e=>async(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return ot(e)(t,n,o)},Hr=e=>async(t,n,r)=>ot(e)(t,n,r),qr=e=>(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return je(e)(t,n,o)},Yr=e=>(t,n,r)=>je(e)(t,n,r),Jr=e=>async(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Oe(e)(t,n,o)},Xr=e=>async(t,n,r)=>Oe(e)(t,n,r),Qr=/^[cC][^\s-]{8,}$/,eo=/^[0-9a-z]+$/,to=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,no=/^[0-9a-vA-V]{20}$/,ro=/^[A-Za-z0-9]{27}$/,oo=/^[a-zA-Z0-9_-]{21}$/,io=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,so=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Mt=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,ao=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,co="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function uo(){return new RegExp(co,"u")}const lo=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,po=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,fo=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,ho=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mo=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Ut=/^[A-Za-z0-9_-]*$/,go=/^\+(?:[0-9]){6,14}[0-9]$/,Bt="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",vo=new RegExp(`^${Bt}$`);function Nt(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function _o(e){return new RegExp(`^${Nt(e)}$`)}function yo(e){const t=Nt({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${Bt}T(?:${r})$`)}const bo=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},wo=/^-?\d+$/,ko=/^-?\d+(?:\.\d+)?/,$o=/^(?:true|false)$/i,zo=/^[^A-Z]*$/,So=/^[^a-z]*$/,O=l("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Kt={number:"number",bigint:"bigint",object:"date"},Gt=l("$ZodCheckLessThan",(e,t)=>{O.init(e,t);const n=Kt[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,i=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Vt=l("$ZodCheckGreaterThan",(e,t)=>{O.init(e,t);const n=Kt[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,i=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),xo=l("$ZodCheckMultipleOf",(e,t)=>{O.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Ir(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Eo=l("$ZodCheckNumberFormat",(e,t)=>{var s;O.init(e,t),t.format=t.format||"float64";const n=(s=t.format)==null?void 0:s.includes("int"),r=n?"int":"number",[o,i]=jr[t.format];e._zod.onattach.push(a=>{const c=a._zod.bag;c.format=t.format,c.minimum=o,c.maximum=i,n&&(c.pattern=wo)}),e._zod.check=a=>{const c=a.value;if(n){if(!Number.isInteger(c)){a.issues.push({expected:r,format:t.format,code:"invalid_type",continue:!1,input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?a.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):a.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}c<o&&a.issues.push({origin:"number",input:c,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),c>i&&a.issues.push({origin:"number",input:c,code:"too_big",maximum:i,inst:e})}}),Io=l("$ZodCheckMaxLength",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!et(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const o=r.value;if(o.length<=t.maximum)return;const s=nt(o);r.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),Zo=l("$ZodCheckMinLength",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!et(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const o=r.value;if(o.length>=t.minimum)return;const s=nt(o);r.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),Po=l("$ZodCheckLengthEquals",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!et(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=r=>{const o=r.value,i=o.length;if(i===t.length)return;const s=nt(o),a=i>t.length;r.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),Te=l("$ZodCheckStringFormat",(e,t)=>{var n,r;O.init(e,t),e._zod.onattach.push(o=>{const i=o._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),Ao=l("$ZodCheckRegex",(e,t)=>{Te.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Co=l("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=zo),Te.init(e,t)}),jo=l("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=So),Te.init(e,t)}),Oo=l("$ZodCheckIncludes",(e,t)=>{O.init(e,t);const n=de(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),To=l("$ZodCheckStartsWith",(e,t)=>{O.init(e,t);const n=new RegExp(`^${de(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),Lo=l("$ZodCheckEndsWith",(e,t)=>{O.init(e,t);const n=new RegExp(`.*${de(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),Do=l("$ZodCheckOverwrite",(e,t)=>{O.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Fo{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(s=>s),o=Math.min(...r.map(s=>s.length-s.trimStart().length)),i=r.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(const s of i)this.content.push(s)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new t(...n,o.join(`
`))}}const Ro={major:4,minor:1,patch:13},I=l("$ZodType",(e,t)=>{var o;var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Ro;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const i of r)for(const s of i._zod.onattach)s(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const i=(a,c,u)=>{let d=pe(a),h;for(const p of c){if(p._zod.def.when){if(!p._zod.def.when(a))continue}else if(d)continue;const m=a.issues.length,v=p._zod.check(a);if(v instanceof Promise&&(u==null?void 0:u.async)===!1)throw new ue;if(h||v instanceof Promise)h=(h??Promise.resolve()).then(async()=>{await v,a.issues.length!==m&&(d||(d=pe(a,m)))});else{if(a.issues.length===m)continue;d||(d=pe(a,m))}}return h?h.then(()=>a):a},s=(a,c,u)=>{if(pe(a))return a.aborted=!0,a;const d=i(c,r,u);if(d instanceof Promise){if(u.async===!1)throw new ue;return d.then(h=>e._zod.parse(h,u))}return e._zod.parse(d,u)};e._zod.run=(a,c)=>{if(c.skipChecks)return e._zod.parse(a,c);if(c.direction==="backward"){const d=e._zod.parse({value:a.value,issues:[]},{...c,skipChecks:!0});return d instanceof Promise?d.then(h=>s(h,a,c)):s(d,a,c)}const u=e._zod.parse(a,c);if(u instanceof Promise){if(c.async===!1)throw new ue;return u.then(d=>i(d,r,c))}return i(u,r,c)}}e["~standard"]={validate:i=>{var s;try{const a=Nr(e,i);return a.success?{value:a.data}:{issues:(s=a.error)==null?void 0:s.issues}}catch{return Kr(e,i).then(c=>{var u;return c.success?{value:c.data}:{issues:(u=c.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),it=l("$ZodString",(e,t)=>{var n;I.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??bo(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),S=l("$ZodStringFormat",(e,t)=>{Te.init(e,t),it.init(e,t)}),Mo=l("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=so),S.init(e,t)}),Uo=l("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Mt(r))}else t.pattern??(t.pattern=Mt());S.init(e,t)}),Bo=l("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=ao),S.init(e,t)}),No=l("$ZodURL",(e,t)=>{S.init(e,t),e._zod.check=n=>{try{const r=n.value.trim(),o=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=o.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Ko=l("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=uo()),S.init(e,t)}),Go=l("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=oo),S.init(e,t)}),Vo=l("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Qr),S.init(e,t)}),Wo=l("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=eo),S.init(e,t)}),Ho=l("$ZodULID",(e,t)=>{t.pattern??(t.pattern=to),S.init(e,t)}),qo=l("$ZodXID",(e,t)=>{t.pattern??(t.pattern=no),S.init(e,t)}),Yo=l("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=ro),S.init(e,t)}),Jo=l("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=yo(t)),S.init(e,t)}),Xo=l("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=vo),S.init(e,t)}),Qo=l("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=_o(t)),S.init(e,t)}),ei=l("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=io),S.init(e,t)}),ti=l("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=lo),S.init(e,t),e._zod.bag.format="ipv4"}),ni=l("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=po),S.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),ri=l("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=fo),S.init(e,t)}),oi=l("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=ho),S.init(e,t),e._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[o,i]=r;if(!i)throw new Error;const s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${o}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Wt(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const ii=l("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=mo),S.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{Wt(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function si(e){if(!Ut.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Wt(n)}const ai=l("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Ut),S.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{si(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),ci=l("$ZodE164",(e,t)=>{t.pattern??(t.pattern=go),S.init(e,t)});function ui(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const li=l("$ZodJWT",(e,t)=>{S.init(e,t),e._zod.check=n=>{ui(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Ht=l("$ZodNumber",(e,t)=>{I.init(e,t),e._zod.pattern=e._zod.bag.pattern??ko,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...i?{received:i}:{}}),n}}),di=l("$ZodNumberFormat",(e,t)=>{Eo.init(e,t),Ht.init(e,t)}),pi=l("$ZodBoolean",(e,t)=>{I.init(e,t),e._zod.pattern=$o,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),fi=l("$ZodUnknown",(e,t)=>{I.init(e,t),e._zod.parse=n=>n}),hi=l("$ZodNever",(e,t)=>{I.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function qt(e,t,n){e.issues.length&&t.issues.push(...fe(n,e.issues)),t.value[n]=e.value}const mi=l("$ZodArray",(e,t)=>{I.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const i=[];for(let s=0;s<o.length;s++){const a=o[s],c=t.element._zod.run({value:a,issues:[]},r);c instanceof Promise?i.push(c.then(u=>qt(u,n,s))):qt(c,n,s)}return i.length?Promise.all(i).then(()=>n):n}});function Le(e,t,n,r){e.issues.length&&t.issues.push(...fe(n,e.issues)),e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function Yt(e){var r,o,i,s;const t=Object.keys(e.shape);for(const a of t)if(!((s=(i=(o=(r=e.shape)==null?void 0:r[a])==null?void 0:o._zod)==null?void 0:i.traits)!=null&&s.has("$ZodType")))throw new Error(`Invalid element at key "${a}": expected a Zod schema`);const n=Cr(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function Jt(e,t,n,r,o,i){const s=[],a=o.keySet,c=o.catchall._zod,u=c.def.type;for(const d in t){if(a.has(d))continue;if(u==="never"){s.push(d);continue}const h=c.run({value:t[d],issues:[]},r);h instanceof Promise?e.push(h.then(p=>Le(p,n,d,t))):Le(h,n,d,t)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:i}),e.length?Promise.all(e).then(()=>n):n}const gi=l("$ZodObject",(e,t)=>{I.init(e,t);const n=Object.getOwnPropertyDescriptor(t,"shape");if(!(n!=null&&n.get)){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const r=Qe(()=>Yt(t));z(e._zod,"propValues",()=>{const a=t.shape,c={};for(const u in a){const d=a[u]._zod;if(d.values){c[u]??(c[u]=new Set);for(const h of d.values)c[u].add(h)}}return c});const o=Ae,i=t.catchall;let s;e._zod.parse=(a,c)=>{s??(s=r.value);const u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),a;a.value={};const d=[],h=s.shape;for(const p of s.keys){const v=h[p]._zod.run({value:u[p],issues:[]},c);v instanceof Promise?d.push(v.then(_=>Le(_,a,p,u))):Le(v,a,p,u)}return i?Jt(d,u,a,c,r.value,e):d.length?Promise.all(d).then(()=>a):a}}),vi=l("$ZodObjectJIT",(e,t)=>{gi.init(e,t);const n=e._zod.parse,r=Qe(()=>Yt(t)),o=p=>{const m=new Fo(["shape","payload","ctx"]),v=r.value,_=$=>{const P=Ot($);return`shape[${P}]._zod.run({ value: input[${P}], issues: [] }, ctx)`};m.write("const input = payload.value;");const x=Object.create(null);let E=0;for(const $ of v.keys)x[$]=`key_${E++}`;m.write("const newResult = {};");for(const $ of v.keys){const P=x[$],j=Ot($);m.write(`const ${P} = ${_($)};`),m.write(`
        if (${P}.issues.length) {
          payload.issues = payload.issues.concat(${P}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${j}, ...iss.path] : [${j}]
          })));
        }
        
        
        if (${P}.value === undefined) {
          if (${j} in input) {
            newResult[${j}] = undefined;
          }
        } else {
          newResult[${j}] = ${P}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");const b=m.compile();return($,P)=>b(p,$,P)};let i;const s=Ae,a=!Ct.jitless,u=a&&Pr.value,d=t.catchall;let h;e._zod.parse=(p,m)=>{h??(h=r.value);const v=p.value;return s(v)?a&&u&&(m==null?void 0:m.async)===!1&&m.jitless!==!0?(i||(i=o(t.shape)),p=i(p,m),d?Jt([],v,p,m,h,e):p):n(p,m):(p.issues.push({expected:"object",code:"invalid_type",input:v,inst:e}),p)}});function Xt(e,t,n,r){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const o=e.filter(i=>!pe(i));return o.length===1?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(i=>i.issues.map(s=>Q(s,r,J())))}),t)}const _i=l("$ZodUnion",(e,t)=>{I.init(e,t),z(e._zod,"optin",()=>t.options.some(o=>o._zod.optin==="optional")?"optional":void 0),z(e._zod,"optout",()=>t.options.some(o=>o._zod.optout==="optional")?"optional":void 0),z(e._zod,"values",()=>{if(t.options.every(o=>o._zod.values))return new Set(t.options.flatMap(o=>Array.from(o._zod.values)))}),z(e._zod,"pattern",()=>{if(t.options.every(o=>o._zod.pattern)){const o=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${o.map(i=>tt(i.source)).join("|")})$`)}});const n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(o,i)=>{if(n)return r(o,i);let s=!1;const a=[];for(const c of t.options){const u=c._zod.run({value:o.value,issues:[]},i);if(u instanceof Promise)a.push(u),s=!0;else{if(u.issues.length===0)return u;a.push(u)}}return s?Promise.all(a).then(c=>Xt(c,o,e,i)):Xt(a,o,e,i)}}),yi=l("$ZodIntersection",(e,t)=>{I.init(e,t),e._zod.parse=(n,r)=>{const o=n.value,i=t.left._zod.run({value:o,issues:[]},r),s=t.right._zod.run({value:o,issues:[]},r);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,u])=>Qt(n,c,u)):Qt(n,i,s)}});function st(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(le(e)&&le(t)){const n=Object.keys(t),r=Object.keys(e).filter(i=>n.indexOf(i)!==-1),o={...e,...t};for(const i of r){const s=st(e[i],t[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],i=t[r],s=st(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Qt(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),pe(e))return e;const r=st(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const bi=l("$ZodRecord",(e,t)=>{I.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!le(o))return n.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),n;const i=[],s=t.keyType._zod.values;if(s){n.value={};const a=new Set;for(const u of s)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){a.add(typeof u=="number"?u.toString():u);const d=t.valueType._zod.run({value:o[u],issues:[]},r);d instanceof Promise?i.push(d.then(h=>{h.issues.length&&n.issues.push(...fe(u,h.issues)),n.value[u]=h.value})):(d.issues.length&&n.issues.push(...fe(u,d.issues)),n.value[u]=d.value)}let c;for(const u in o)a.has(u)||(c=c??[],c.push(u));c&&c.length>0&&n.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:c})}else{n.value={};for(const a of Reflect.ownKeys(o)){if(a==="__proto__")continue;const c=t.keyType._zod.run({value:a,issues:[]},r);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(c.issues.length){n.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(d=>Q(d,r,J())),input:a,path:[a],inst:e}),n.value[c.value]=c.value;continue}const u=t.valueType._zod.run({value:o[a],issues:[]},r);u instanceof Promise?i.push(u.then(d=>{d.issues.length&&n.issues.push(...fe(a,d.issues)),n.value[c.value]=d.value})):(u.issues.length&&n.issues.push(...fe(a,u.issues)),n.value[c.value]=u.value)}}return i.length?Promise.all(i).then(()=>n):n}}),wi=l("$ZodEnum",(e,t)=>{I.init(e,t);const n=Er(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=new RegExp(`^(${n.filter(o=>Ar.has(typeof o)).map(o=>typeof o=="string"?de(o):o.toString()).join("|")})$`),e._zod.parse=(o,i)=>{const s=o.value;return r.has(s)||o.issues.push({code:"invalid_value",values:n,input:s,inst:e}),o}}),ki=l("$ZodLiteral",(e,t)=>{if(I.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(t.values);e._zod.values=n,e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?de(r):r?de(r.toString()):String(r)).join("|")})$`),e._zod.parse=(r,o)=>{const i=r.value;return n.has(i)||r.issues.push({code:"invalid_value",values:t.values,input:i,inst:e}),r}}),$i=l("$ZodTransform",(e,t)=>{I.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new At(e.constructor.name);const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(n.value=s,n));if(o instanceof Promise)throw new ue;return n.value=o,n}});function en(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const zi=l("$ZodOptional",(e,t)=>{I.init(e,t),e._zod.optin="optional",e._zod.optout="optional",z(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),z(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${tt(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>{if(t.innerType._zod.optin==="optional"){const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>en(i,n.value)):en(o,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,r)}}),Si=l("$ZodNullable",(e,t)=>{I.init(e,t),z(e._zod,"optin",()=>t.innerType._zod.optin),z(e._zod,"optout",()=>t.innerType._zod.optout),z(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${tt(n.source)}|null)$`):void 0}),z(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),xi=l("$ZodDefault",(e,t)=>{I.init(e,t),e._zod.optin="optional",z(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>tn(i,t)):tn(o,t)}});function tn(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Ei=l("$ZodPrefault",(e,t)=>{I.init(e,t),e._zod.optin="optional",z(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Ii=l("$ZodNonOptional",(e,t)=>{I.init(e,t),z(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>nn(i,e)):nn(o,e)}});function nn(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Zi=l("$ZodCatch",(e,t)=>{I.init(e,t),z(e._zod,"optin",()=>t.innerType._zod.optin),z(e._zod,"optout",()=>t.innerType._zod.optout),z(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(s=>Q(s,r,J()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(i=>Q(i,r,J()))},input:n.value}),n.issues=[]),n)}}),Pi=l("$ZodPipe",(e,t)=>{I.init(e,t),z(e._zod,"values",()=>t.in._zod.values),z(e._zod,"optin",()=>t.in._zod.optin),z(e._zod,"optout",()=>t.out._zod.optout),z(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,r)=>{if(r.direction==="backward"){const i=t.out._zod.run(n,r);return i instanceof Promise?i.then(s=>De(s,t.in,r)):De(i,t.in,r)}const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(i=>De(i,t.out,r)):De(o,t.out,r)}});function De(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const Ai=l("$ZodReadonly",(e,t)=>{I.init(e,t),z(e._zod,"propValues",()=>t.innerType._zod.propValues),z(e._zod,"values",()=>t.innerType._zod.values),z(e._zod,"optin",()=>{var n,r;return(r=(n=t.innerType)==null?void 0:n._zod)==null?void 0:r.optin}),z(e._zod,"optout",()=>{var n,r;return(r=(n=t.innerType)==null?void 0:n._zod)==null?void 0:r.optout}),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(rn):rn(o)}});function rn(e){return e.value=Object.freeze(e.value),e}const Ci=l("$ZodCustom",(e,t)=>{O.init(e,t),I.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(i=>on(i,n,r,e));on(o,n,r,e)}});function on(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push($e(o))}}var sn;class ji{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const o={...r,...this._map.get(t)};return Object.keys(o).length?o:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Oi(){return new ji}(sn=globalThis).__zod_globalRegistry??(sn.__zod_globalRegistry=Oi());const Fe=globalThis.__zod_globalRegistry;function Ti(e,t){return new e({type:"string",...g(t)})}function Li(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...g(t)})}function an(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...g(t)})}function Di(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...g(t)})}function Fi(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...g(t)})}function Ri(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...g(t)})}function Mi(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...g(t)})}function Ui(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...g(t)})}function Bi(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...g(t)})}function Ni(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...g(t)})}function Ki(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...g(t)})}function Gi(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...g(t)})}function Vi(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...g(t)})}function Wi(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...g(t)})}function Hi(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...g(t)})}function qi(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...g(t)})}function Yi(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...g(t)})}function Ji(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...g(t)})}function Xi(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...g(t)})}function Qi(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...g(t)})}function es(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...g(t)})}function ts(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...g(t)})}function ns(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...g(t)})}function rs(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...g(t)})}function os(e,t){return new e({type:"string",format:"date",check:"string_format",...g(t)})}function is(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...g(t)})}function ss(e,t){return new e({type:"string",format:"duration",check:"string_format",...g(t)})}function as(e,t){return new e({type:"number",checks:[],...g(t)})}function cs(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...g(t)})}function us(e,t){return new e({type:"boolean",...g(t)})}function ls(e){return new e({type:"unknown"})}function ds(e,t){return new e({type:"never",...g(t)})}function cn(e,t){return new Gt({check:"less_than",...g(t),value:e,inclusive:!1})}function at(e,t){return new Gt({check:"less_than",...g(t),value:e,inclusive:!0})}function un(e,t){return new Vt({check:"greater_than",...g(t),value:e,inclusive:!1})}function ct(e,t){return new Vt({check:"greater_than",...g(t),value:e,inclusive:!0})}function ln(e,t){return new xo({check:"multiple_of",...g(t),value:e})}function dn(e,t){return new Io({check:"max_length",...g(t),maximum:e})}function Re(e,t){return new Zo({check:"min_length",...g(t),minimum:e})}function pn(e,t){return new Po({check:"length_equals",...g(t),length:e})}function ps(e,t){return new Ao({check:"string_format",format:"regex",...g(t),pattern:e})}function fs(e){return new Co({check:"string_format",format:"lowercase",...g(e)})}function hs(e){return new jo({check:"string_format",format:"uppercase",...g(e)})}function ms(e,t){return new Oo({check:"string_format",format:"includes",...g(t),includes:e})}function gs(e,t){return new To({check:"string_format",format:"starts_with",...g(t),prefix:e})}function vs(e,t){return new Lo({check:"string_format",format:"ends_with",...g(t),suffix:e})}function he(e){return new Do({check:"overwrite",tx:e})}function _s(e){return he(t=>t.normalize(e))}function ys(){return he(e=>e.trim())}function bs(){return he(e=>e.toLowerCase())}function ws(){return he(e=>e.toUpperCase())}function ks(){return he(e=>Zr(e))}function $s(e,t,n){return new e({type:"array",element:t,...g(n)})}function zs(e,t,n){return new e({type:"custom",check:"custom",fn:t,...g(n)})}function Ss(e){const t=xs(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push($e(r,n.value,t._zod.def));else{const o=r;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),n.issues.push($e(o))}},e(n.value,n)));return t}function xs(e,t){const n=new O({check:"custom",...g(t)});return n._zod.check=e,n}const Es=l("ZodISODateTime",(e,t)=>{Jo.init(e,t),Z.init(e,t)});function Is(e){return rs(Es,e)}const Zs=l("ZodISODate",(e,t)=>{Xo.init(e,t),Z.init(e,t)});function Ps(e){return os(Zs,e)}const As=l("ZodISOTime",(e,t)=>{Qo.init(e,t),Z.init(e,t)});function Cs(e){return is(As,e)}const js=l("ZodISODuration",(e,t)=>{ei.init(e,t),Z.init(e,t)});function Os(e){return ss(js,e)}const F=l("ZodError",(e,t)=>{Ft.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Br(e,n)},flatten:{value:n=>Ur(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,Xe,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,Xe,2)}},isEmpty:{get(){return e.issues.length===0}}})},{Parent:Error}),Ts=rt(F),Ls=ot(F),Ds=je(F),Fs=Oe(F),Rs=Gr(F),Ms=Vr(F),Us=Wr(F),Bs=Hr(F),Ns=qr(F),Ks=Yr(F),Gs=Jr(F),Vs=Xr(F),A=l("ZodType",(e,t)=>(I.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(ie(t,{checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]})),e.clone=(n,r)=>X(e,n,r),e.brand=()=>e,e.register=((n,r)=>(n.add(e,r),e)),e.parse=(n,r)=>Ts(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>Ds(e,n,r),e.parseAsync=async(n,r)=>Ls(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>Fs(e,n,r),e.spa=e.safeParseAsync,e.encode=(n,r)=>Rs(e,n,r),e.decode=(n,r)=>Ms(e,n,r),e.encodeAsync=async(n,r)=>Us(e,n,r),e.decodeAsync=async(n,r)=>Bs(e,n,r),e.safeEncode=(n,r)=>Ns(e,n,r),e.safeDecode=(n,r)=>Ks(e,n,r),e.safeEncodeAsync=async(n,r)=>Gs(e,n,r),e.safeDecodeAsync=async(n,r)=>Vs(e,n,r),e.refine=(n,r)=>e.check(Ma(n,r)),e.superRefine=n=>e.check(Ua(n)),e.overwrite=n=>e.check(he(n)),e.optional=()=>bn(e),e.nullable=()=>wn(e),e.nullish=()=>bn(wn(e)),e.nonoptional=n=>ja(e,n),e.array=()=>B(e),e.or=n=>ut([e,n]),e.and=n=>ka(e,n),e.transform=n=>$n(e,Ea(n)),e.default=n=>Pa(e,n),e.prefault=n=>Ca(e,n),e.catch=n=>Ta(e,n),e.pipe=n=>$n(e,n),e.readonly=()=>Fa(e),e.describe=n=>{const r=e.clone();return Fe.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=Fe.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Fe.get(e);const r=e.clone();return Fe.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),fn=l("_ZodString",(e,t)=>{it.init(e,t),A.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(ps(...r)),e.includes=(...r)=>e.check(ms(...r)),e.startsWith=(...r)=>e.check(gs(...r)),e.endsWith=(...r)=>e.check(vs(...r)),e.min=(...r)=>e.check(Re(...r)),e.max=(...r)=>e.check(dn(...r)),e.length=(...r)=>e.check(pn(...r)),e.nonempty=(...r)=>e.check(Re(1,...r)),e.lowercase=r=>e.check(fs(r)),e.uppercase=r=>e.check(hs(r)),e.trim=()=>e.check(ys()),e.normalize=(...r)=>e.check(_s(...r)),e.toLowerCase=()=>e.check(bs()),e.toUpperCase=()=>e.check(ws()),e.slugify=()=>e.check(ks())}),Ws=l("ZodString",(e,t)=>{it.init(e,t),fn.init(e,t),e.email=n=>e.check(Li(Hs,n)),e.url=n=>e.check(Ui(qs,n)),e.jwt=n=>e.check(ns(la,n)),e.emoji=n=>e.check(Bi(Ys,n)),e.guid=n=>e.check(an(hn,n)),e.uuid=n=>e.check(Di(Me,n)),e.uuidv4=n=>e.check(Fi(Me,n)),e.uuidv6=n=>e.check(Ri(Me,n)),e.uuidv7=n=>e.check(Mi(Me,n)),e.nanoid=n=>e.check(Ni(Js,n)),e.guid=n=>e.check(an(hn,n)),e.cuid=n=>e.check(Ki(Xs,n)),e.cuid2=n=>e.check(Gi(Qs,n)),e.ulid=n=>e.check(Vi(ea,n)),e.base64=n=>e.check(Qi(aa,n)),e.base64url=n=>e.check(es(ca,n)),e.xid=n=>e.check(Wi(ta,n)),e.ksuid=n=>e.check(Hi(na,n)),e.ipv4=n=>e.check(qi(ra,n)),e.ipv6=n=>e.check(Yi(oa,n)),e.cidrv4=n=>e.check(Ji(ia,n)),e.cidrv6=n=>e.check(Xi(sa,n)),e.e164=n=>e.check(ts(ua,n)),e.datetime=n=>e.check(Is(n)),e.date=n=>e.check(Ps(n)),e.time=n=>e.check(Cs(n)),e.duration=n=>e.check(Os(n))});function U(e){return Ti(Ws,e)}const Z=l("ZodStringFormat",(e,t)=>{S.init(e,t),fn.init(e,t)}),Hs=l("ZodEmail",(e,t)=>{Bo.init(e,t),Z.init(e,t)}),hn=l("ZodGUID",(e,t)=>{Mo.init(e,t),Z.init(e,t)}),Me=l("ZodUUID",(e,t)=>{Uo.init(e,t),Z.init(e,t)}),qs=l("ZodURL",(e,t)=>{No.init(e,t),Z.init(e,t)}),Ys=l("ZodEmoji",(e,t)=>{Ko.init(e,t),Z.init(e,t)}),Js=l("ZodNanoID",(e,t)=>{Go.init(e,t),Z.init(e,t)}),Xs=l("ZodCUID",(e,t)=>{Vo.init(e,t),Z.init(e,t)}),Qs=l("ZodCUID2",(e,t)=>{Wo.init(e,t),Z.init(e,t)}),ea=l("ZodULID",(e,t)=>{Ho.init(e,t),Z.init(e,t)}),ta=l("ZodXID",(e,t)=>{qo.init(e,t),Z.init(e,t)}),na=l("ZodKSUID",(e,t)=>{Yo.init(e,t),Z.init(e,t)}),ra=l("ZodIPv4",(e,t)=>{ti.init(e,t),Z.init(e,t)}),oa=l("ZodIPv6",(e,t)=>{ni.init(e,t),Z.init(e,t)}),ia=l("ZodCIDRv4",(e,t)=>{ri.init(e,t),Z.init(e,t)}),sa=l("ZodCIDRv6",(e,t)=>{oi.init(e,t),Z.init(e,t)}),aa=l("ZodBase64",(e,t)=>{ii.init(e,t),Z.init(e,t)}),ca=l("ZodBase64URL",(e,t)=>{ai.init(e,t),Z.init(e,t)}),ua=l("ZodE164",(e,t)=>{ci.init(e,t),Z.init(e,t)}),la=l("ZodJWT",(e,t)=>{li.init(e,t),Z.init(e,t)}),mn=l("ZodNumber",(e,t)=>{Ht.init(e,t),A.init(e,t),e.gt=(r,o)=>e.check(un(r,o)),e.gte=(r,o)=>e.check(ct(r,o)),e.min=(r,o)=>e.check(ct(r,o)),e.lt=(r,o)=>e.check(cn(r,o)),e.lte=(r,o)=>e.check(at(r,o)),e.max=(r,o)=>e.check(at(r,o)),e.int=r=>e.check(gn(r)),e.safe=r=>e.check(gn(r)),e.positive=r=>e.check(un(0,r)),e.nonnegative=r=>e.check(ct(0,r)),e.negative=r=>e.check(cn(0,r)),e.nonpositive=r=>e.check(at(0,r)),e.multipleOf=(r,o)=>e.check(ln(r,o)),e.step=(r,o)=>e.check(ln(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function da(e){return as(mn,e)}const pa=l("ZodNumberFormat",(e,t)=>{di.init(e,t),mn.init(e,t)});function gn(e){return cs(pa,e)}const fa=l("ZodBoolean",(e,t)=>{pi.init(e,t),A.init(e,t)});function ha(e){return us(fa,e)}const ma=l("ZodUnknown",(e,t)=>{fi.init(e,t),A.init(e,t)});function vn(){return ls(ma)}const ga=l("ZodNever",(e,t)=>{hi.init(e,t),A.init(e,t)});function va(e){return ds(ga,e)}const _a=l("ZodArray",(e,t)=>{mi.init(e,t),A.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(Re(n,r)),e.nonempty=n=>e.check(Re(1,n)),e.max=(n,r)=>e.check(dn(n,r)),e.length=(n,r)=>e.check(pn(n,r)),e.unwrap=()=>e.element});function B(e,t){return $s(_a,e,t)}const ya=l("ZodObject",(e,t)=>{vi.init(e,t),A.init(e,t),z(e,"shape",()=>t.shape),e.keyof=()=>Ue(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:vn()}),e.loose=()=>e.clone({...e._zod.def,catchall:vn()}),e.strict=()=>e.clone({...e._zod.def,catchall:va()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>Lr(e,n),e.safeExtend=n=>Dr(e,n),e.merge=n=>Fr(e,n),e.pick=n=>Or(e,n),e.omit=n=>Tr(e,n),e.partial=(...n)=>Rr(yn,e,n[0]),e.required=(...n)=>Mr(kn,e,n[0])});function me(e,t){const n={type:"object",shape:e??{},...g(t)};return new ya(n)}const ba=l("ZodUnion",(e,t)=>{_i.init(e,t),A.init(e,t),e.options=t.options});function ut(e,t){return new ba({type:"union",options:e,...g(t)})}const wa=l("ZodIntersection",(e,t)=>{yi.init(e,t),A.init(e,t)});function ka(e,t){return new wa({type:"intersection",left:e,right:t})}const $a=l("ZodRecord",(e,t)=>{bi.init(e,t),A.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function _n(e,t,n){return new $a({type:"record",keyType:e,valueType:t,...g(n)})}const lt=l("ZodEnum",(e,t)=>{wi.init(e,t),A.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const i={};for(const s of r)if(n.has(s))i[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new lt({...t,checks:[],...g(o),entries:i})},e.exclude=(r,o)=>{const i={...t.entries};for(const s of r)if(n.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new lt({...t,checks:[],...g(o),entries:i})}});function Ue(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new lt({type:"enum",entries:n,...g(t)})}const za=l("ZodLiteral",(e,t)=>{ki.init(e,t),A.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function Sa(e,t){return new za({type:"literal",values:Array.isArray(e)?e:[e],...g(t)})}const xa=l("ZodTransform",(e,t)=>{$i.init(e,t),A.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new At(e.constructor.name);n.addIssue=i=>{if(typeof i=="string")n.issues.push($e(i,n.value,t));else{const s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),n.issues.push($e(s))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(i=>(n.value=i,n)):(n.value=o,n)}});function Ea(e){return new xa({type:"transform",transform:e})}const yn=l("ZodOptional",(e,t)=>{zi.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function bn(e){return new yn({type:"optional",innerType:e})}const Ia=l("ZodNullable",(e,t)=>{Si.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wn(e){return new Ia({type:"nullable",innerType:e})}const Za=l("ZodDefault",(e,t)=>{xi.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Pa(e,t){return new Za({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Lt(t)}})}const Aa=l("ZodPrefault",(e,t)=>{Ei.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ca(e,t){return new Aa({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Lt(t)}})}const kn=l("ZodNonOptional",(e,t)=>{Ii.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ja(e,t){return new kn({type:"nonoptional",innerType:e,...g(t)})}const Oa=l("ZodCatch",(e,t)=>{Zi.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Ta(e,t){return new Oa({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const La=l("ZodPipe",(e,t)=>{Pi.init(e,t),A.init(e,t),e.in=t.in,e.out=t.out});function $n(e,t){return new La({type:"pipe",in:e,out:t})}const Da=l("ZodReadonly",(e,t)=>{Ai.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Fa(e){return new Da({type:"readonly",innerType:e})}const Ra=l("ZodCustom",(e,t)=>{Ci.init(e,t),A.init(e,t)});function Ma(e,t={}){return zs(Ra,e,t)}function Ua(e){return Ss(e)}const dt=new Set(["files","gap","headline","hidden","info","line","pages","users"]),zn={text:e=>W(e,`"${e.label}", single-line plain text without line breaks or formatting`),textarea:e=>W(e,`"${e.label}", multi-line text with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),markdown:e=>W(e,`"${e.label}", multi-line text with Markdown formatting`),slug:e=>W(e,`"${e.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`),url:e=>W(e,`"${e.label}", a valid URL starting with http:// or https://`),email:e=>W(e,`"${e.label}", a valid email address`),password:e=>W(e,`"${e.label}", a secure password (not for actual use)`),tel:e=>W(e,`"${e.label}", a telephone number in appropriate format for the context`),writer:e=>W(e,`"${e.label}" (WYSIWYG), ${e.inline===!0?"text with inline formatting only (bold, italic, underline, code, links, email, sub, sup). NO wrapping paragraph <p> tags allowed.":"text wrapped in paragraph <p> tags (can contain one or multiple paragraphs). Inline formatting (bold, italic, underline, code, links, email, sub, sup) is allowed."}`),list:e=>U().describe(`"${e.label}" (WYSIWYG), HTML list wrapped in <ul> or <ol>. Use <li> for items with inline formatting (bold, italic, underline, code, links, email, sub, sup).`),number:e=>xn(e),range:e=>xn(e),toggle:e=>ha().describe(`"${e.label}", a boolean`),select:e=>ft(e),radio:e=>ft(e),toggles:e=>ft(e),checkboxes:e=>ht(e),multiselect:e=>ht(e),tags:e=>ht(e),date:e=>U().describe(`"${e.label}", a date ${e.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:e=>U().describe(`"${e.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),color:e=>U().describe(`"${e.label}", a color value in hex, rgb or hsl format`),link:e=>U().describe(`"${e.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),structure:e=>{const t=Sn(e);return t?B(t).describe(`"${e.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`):B(_n(U())).describe(`"${e.label}", repeatable structured data based on expected content structure`)},object:e=>{const t=Sn(e);return t?t.describe(`"${e.label}", structured data containing the defined sub-fields with appropriate content`):_n(U()).describe(`"${e.label}", object data based on expected content structure`)},entries:e=>{const{field:t}=e.field,n={...t,name:"entry",label:e.label||"Entry"},r=zn[t.type],o=r(n);let i=B(o);return e.min!=null&&(i=i.min(e.min)),e.max!=null&&(i=i.max(e.max)),i.describe(`"${e.label}", multiple entries of ${t.type} values${e.min!=null||e.max!=null?" within the defined count range":""}`)}};function pt(e){var r;const t=zn[e.type];let n=t(e);return e.required===!0&&(n._def.typeName==="ZodString"?((r=n._def.checks)==null?void 0:r.some(o=>o.kind==="min"))!==!0&&(n=n.min(1)):n._def.typeName==="ZodArray"&&n._def.minLength==null&&(n=n.min(1))),n}function Sn(e){if(typeof e.fields!="object"||e.fields===null)return;const t={};for(const[n,r]of Object.entries(e.fields))r.disabled||r.hidden||dt.has(r.type)||(t[n]=pt({...r,name:n}));return me(t)}function W(e,t){let n=U();return e.minlength!=null&&(n=n.min(e.minlength)),e.maxlength!=null&&(n=n.max(e.maxlength)),n.describe(t)}function xn(e){let t=da();return e.min!=null&&(t=t.min(e.min)),e.max!=null&&(t=t.max(e.max)),t.describe(`"${e.label}", a numeric value${e.min!=null||e.max!=null?" within the defined range":""}`)}function ft(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?Ue(t).describe(`"${e.label}", single selection value based on the predefined options`):U().describe(`"${e.label}", single selection value`)}function ht(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?B(Ue(t)).describe(`"${e.label}", one ore many values based on the predefined options`):B(U()).describe(`"${e.label}", multiple selection values`)}function En(e){const{name:t,type:n,fields:r}=e;if(!r||Object.keys(r).length===0)return;const o={};for(const i of Object.values(r)){if(i.disabled||i.hidden||dt.has(i.type))continue;const s=pt(i);o[i.name]=s}return me({type:Sa(n),content:me(o)}).describe(`Kirby block: ${t}`)}function Ba(e){if(!Array.isArray(e)||e.length===0)throw new Error("Invalid fieldsets configuration");const t=e.map(En).filter(Boolean);return ut(t).describe("Union of all Kirby block types")}let Be,ze;function Ne(){async function e(){return Be||ze||(ze=window.panel.api.get(hr).then(r=>(Be=r,ze=void 0,Be)),ze)}async function t(r){let o=await e();const{config:i}=await V();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(o=o.filter(s=>!i.excludedBlocks.includes(s.type))),r.fieldsets){const s=Array.isArray(r.fieldsets)?r.fieldsets:Object.keys(r.fieldsets);o=o.filter(a=>s.includes(a.type))}return Ba(o)}function n(r){return r.isHidden??(r.isHidden=!1),r.id??(r.id=crypto.randomUUID()),r}return{getFieldsets:e,getZodSchema:t,normalizeBlock:n}}function Na(e,t,n,r){let o;const i=()=>{o==null||o(),o=void 0},s=(u,d,h,p)=>(u.addEventListener(d,h,p),()=>u.removeEventListener(d,h,p)),a=He(()=>Ka(e),u=>{i(),u&&(o=s(u,t,n,r))},{immediate:!0,flush:"post"}),c=()=>{a(),i()};return Xn()&&tr(c),c}function Ka(e){const t=We(e);return(t==null?void 0:t.$el)??t}function In(){return wr({accept:[...Ye,"application/pdf"].join(",")})}function Ga(e){const t=new Set;for(const n of e)for(const r of n)typeof r=="string"&&r.trim()&&t.add(r);return[...t]}function Va(e,t){const n=e.map(En).filter(Boolean),r=n.length>1?ut(n):n[0];return me({width:Ue(t).describe('Column width fraction to use, e.g. "1/2"'),blocks:B(r).describe("Array of blocks contained in this column")})}function Wa(e,t){const n=Va(e,t);return me({columns:B(n).min(1).describe("Array of columns in this layout")})}function Ha(e,t={}){if(!e||e.length===0)throw new Error("No fieldsets available for layout schema generation");const n=t.layouts??[["1/1"]],r=Ga(n),o=Wa(e,r),i=n.map(s=>`"${s}"`).join(", ");return o.describe(`Kirby layout with columns and blocks. Available layout combinations: ${i}. Use these exact column width combinations when creating layouts.`)}function mt(){const{getFieldsets:e}=Ne();async function t(r){let o=await e();const{config:i}=await V();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(o=o.filter(s=>!i.excludedBlocks.includes(s.type))),r.fieldsets){const s=Array.isArray(r.fieldsets)?r.fieldsets:Object.keys(r.fieldsets);o=o.filter(a=>s.includes(a.type))}return Ha(o,r)}function n(r){return r.id??(r.id=crypto.randomUUID()),r.attrs??(r.attrs=[]),r.columns=(r.columns??[]).map(o=>(o.id??(o.id=crypto.randomUUID()),o.width??(o.width="1/1"),o.blocks=(o.blocks??[]).map(i=>(i.isHidden??(i.isHidden=!1),i.id??(i.id=crypto.randomUUID()),i)),o)),r}return{getZodSchema:t,normalizeLayout:n}}function qa(e){return typeof e=="string"?`'${e}'`:new Ya().serialize(e)}const Ya=(function(){var t;class e{constructor(){Bn(this,t,new Map)}compare(r,o){const i=typeof r,s=typeof o;return i==="string"&&s==="string"?r.localeCompare(o):i==="number"&&s==="number"?r-o:String.prototype.localeCompare.call(this.serialize(r,!0),this.serialize(o,!0))}serialize(r,o){if(r===null)return"null";switch(typeof r){case"string":return o?r:`'${r}'`;case"bigint":return`${r}n`;case"object":return this.$object(r);case"function":return this.$function(r)}return String(r)}serializeObject(r){const o=Object.prototype.toString.call(r);if(o!=="[object Object]")return this.serializeBuiltInType(o.length<10?`unknown:${o}`:o.slice(8,-1),r);const i=r.constructor,s=i===Object||i===void 0?"":i.name;if(s!==""&&globalThis[s]===i)return this.serializeBuiltInType(s,r);if(typeof r.toJSON=="function"){const a=r.toJSON();return s+(a!==null&&typeof a=="object"?this.$object(a):`(${this.serialize(a)})`)}return this.serializeObjectEntries(s,Object.entries(r))}serializeBuiltInType(r,o){const i=this["$"+r];if(i)return i.call(this,o);if(typeof(o==null?void 0:o.entries)=="function")return this.serializeObjectEntries(r,o.entries());throw new Error(`Cannot serialize ${r}`)}serializeObjectEntries(r,o){const i=Array.from(o).sort((a,c)=>this.compare(a[0],c[0]));let s=`${r}{`;for(let a=0;a<i.length;a++){const[c,u]=i[a];s+=`${this.serialize(c,!0)}:${this.serialize(u)}`,a<i.length-1&&(s+=",")}return s+"}"}$object(r){let o=Ie(this,t).get(r);return o===void 0&&(Ie(this,t).set(r,`#${Ie(this,t).size}`),o=this.serializeObject(r),Ie(this,t).set(r,o)),o}$function(r){const o=Function.prototype.toString.call(r);return o.slice(-15)==="[native code] }"?`${r.name||""}()[native]`:`${r.name}(${r.length})${o.replace(/\s*\n\s*/g,"")}`}$Array(r){let o="[";for(let i=0;i<r.length;i++)o+=this.serialize(r[i]),i<r.length-1&&(o+=",");return o+"]"}$Date(r){try{return`Date(${r.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(r){return`ArrayBuffer[${new Uint8Array(r).join(",")}]`}$Set(r){return`Set${this.$Array(Array.from(r).sort((o,i)=>this.compare(o,i)))}`}$Map(r){return this.serializeObjectEntries("Map",r.entries())}}t=new WeakMap;for(const n of["Error","RegExp","URL"])e.prototype["$"+n]=function(r){return`${n}(${r})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])e.prototype["$"+n]=function(r){return`${n}[${r.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])e.prototype["$"+n]=function(r){return`${n}[${r.join("n,")}${r.length>0?"n":""}]`};return e})(),Ja=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Xa=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Qa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",se=[];class ec{constructor(){G(this,"_data",new ge);G(this,"_hash",new ge([...Ja]));G(this,"_nDataBytes",0);G(this,"_minBufferSize",0)}finalize(t){t&&this._append(t);const n=this._nDataBytes*8,r=this._data.sigBytes*8;return this._data.words[r>>>5]|=128<<24-r%32,this._data.words[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(r+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,n){const r=this._hash.words;let o=r[0],i=r[1],s=r[2],a=r[3],c=r[4],u=r[5],d=r[6],h=r[7];for(let p=0;p<64;p++){if(p<16)se[p]=t[n+p]|0;else{const $=se[p-15],P=($<<25|$>>>7)^($<<14|$>>>18)^$>>>3,j=se[p-2],N=(j<<15|j>>>17)^(j<<13|j>>>19)^j>>>10;se[p]=P+se[p-7]+N+se[p-16]}const m=c&u^~c&d,v=o&i^o&s^i&s,_=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),x=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),E=h+x+m+Xa[p]+se[p],b=_+v;h=d,d=u,u=c,c=a+E|0,a=s,s=i,i=o,o=E+b|0}r[0]=r[0]+o|0,r[1]=r[1]+i|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+c|0,r[5]=r[5]+u|0,r[6]=r[6]+d|0,r[7]=r[7]+h|0}_append(t){typeof t=="string"&&(t=ge.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let n,r=this._data.sigBytes/64;t?r=Math.ceil(r):r=Math.max((r|0)-this._minBufferSize,0);const o=r*16,i=Math.min(o*4,this._data.sigBytes);if(o){for(let s=0;s<o;s+=16)this._doProcessBlock(this._data.words,s);n=this._data.words.splice(0,o),this._data.sigBytes-=i}return new ge(n,i)}}class ge{constructor(t,n){G(this,"words");G(this,"sigBytes");t=this.words=t||[],this.sigBytes=n===void 0?t.length*4:n}static fromUtf8(t){const n=unescape(encodeURIComponent(t)),r=n.length,o=[];for(let i=0;i<r;i++)o[i>>>2]|=(n.charCodeAt(i)&255)<<24-i%4*8;return new ge(o,r)}toBase64(){const t=[];for(let n=0;n<this.sigBytes;n+=3){const r=this.words[n>>>2]>>>24-n%4*8&255,o=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,i=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,s=r<<16|o<<8|i;for(let a=0;a<4&&n*8+a*6<this.sigBytes*8;a++)t.push(Qa.charAt(s>>>6*(3-a)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<t.sigBytes;n++){const r=t.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=r<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<t.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=t.words[n>>>2];this.sigBytes+=t.sigBytes}}function tc(e){return new ec().finalize(e).toBase64()}function nc(e){return tc(qa(e))}function Zn(...e){return`${mr}${nc([...e])}`}const Pn=50;function rc(){const e=Zn("history",window.location.hostname),t=y(JSON.parse(localStorage.getItem(e)||"[]")),n=y(""),r=y(-1);function o(s){if(!s||typeof s!="string"||!s.trim())return;const a=s.trim(),c=t.value.indexOf(a);c!==-1&&t.value.splice(c,1),t.value.unshift(a),t.value.length>Pn&&(t.value=t.value.slice(0,Pn)),localStorage.setItem(e,JSON.stringify(t.value)),r.value=-1}function i(s){if(t.value.length!==0){if(s==="up"){if(r.value+1<t.value.length)return r.value++,t.value[r.value]}else if(s==="down"){if(r.value>0)return r.value--,t.value[r.value];if(r.value===0)return r.value=-1,n.value}}}return{lastPrompt:n,currentIndex:r,addToHistory:o,navigateHistory:i}}const oc=Object.assign({inheritAttrs:!1},{__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String,default:void 0}},emits:["input","mounted"],setup(e,{emit:t}){const n=e,r=y(),o=Y({get(){return n.value},set(i){t("input",i)}});return wt(()=>{t("mounted",r.value)}),{__sfc:!0,props:n,emit:t,textarea:r,text:o}}});var ic=function(){var t=this,n=t._self._c,r=t._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",t._b({directives:[{name:"model",rawName:"v-model",value:r.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:t.sharedClass,domProps:{value:r.text},on:{input:function(o){o.target.composing||(r.text=o.target.value)}}},"textarea",t.$attrs,!1)),t._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:t.sharedClass,domProps:{textContent:t._s(`${t.value} `)}})])},sc=[],ac=ye(oc,ic,sc,!1,null,"a814ce2d");const cc=ac.exports,uc={__name:"Prompt",props:{fields:{type:Array,default:()=>[]},selection:{type:String,default:""},userPrompt:{type:String,default:""}},emits:["cancel","close","input","submit","success"],setup(e,{emit:t}){const n=e,r=_e(),o=k(),{lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:c}=rc(),u=y(),d=y(),h=y([]),p=y([]),m=y("append"),v=y(n.userPrompt||""),_=y();Na(u,"keydown",b=>{if((b.metaKey||b.ctrlKey)&&b.key==="Enter"){if(b.preventDefault(),!v.value.trim()||n.fields.length>0&&p.value.length===0)return;x()}if(b.key==="ArrowUp"&&b.target.selectionStart===0||b.key==="ArrowDown"&&b.target.selectionStart===b.target.value.length){b.preventDefault(),b.key==="ArrowUp"&&s.value===-1&&(i.value=v.value);const $=c(b.key==="ArrowUp"?"up":"down");$!==void 0&&(v.value=$)}}),(async()=>{const b=await V();_.value=b.licenseStatus})();function x(){a(v.value),t("submit",{prompt:v.value,files:h.value,fields:p.value,append:m.value==="append"})}async function E(){const b=await In();h.value=[...h.value,...b]}return{__sfc:!0,props:n,emit:t,_isKirby5:r,panel:o,lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:c,textarea:u,picklist:d,files:h,selectedFields:p,insertOption:m,prompt:v,licenseStatus:_,submit:x,pickFiles:E,LicensingButtonGroup:$t,AutoGrowTextarea:cc}}};var lc=function(){var t=this,n=t._self._c,r=t._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(o){return r.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] focus-within:kai-outline focus-within:kai-outline-[2px] focus-within:kai-outline-[var(--color-focus,currentColor)]"},[n(r.AutoGrowTextarea,{attrs:{value:r.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:r.panel.t("johannschopplich.copilot.prompt.placeholder")+(t.selection?` (${r.panel.t("johannschopplich.copilot.prompt.selectionContext")})`:""),rows:"3"},on:{input:function(o){r.prompt=o},mounted:function(o){r.textarea=o}}}),n("div",{staticClass:"kai-flex kai-items-center kai-justify-between kai-px-2 kai-pb-2"},[n("k-button-group",{staticClass:"kai-gap-1"},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{theme:"empty",icon:"attachment",badge:r._isKirby5&&r.files.length>0?{theme:"notice",text:r.files.length}:void 0},on:{click:function(o){return r.pickFiles()}}}),r.files.length>0?n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(o){r.files=[]}}}):t._e()],1),n("div",{staticClass:"kai-flex kai-gap-2"},[t.fields.length>0?[n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.fields"),variant:"filled",badge:r.selectedFields.length>0?{theme:"info",text:r.selectedFields.length}:void 0,dropdown:""},on:{click:function(o){return r.picklist.toggle()}}}),n("k-picklist-dropdown",{ref:"picklist",attrs:{options:t.fields.map(o=>({value:o.name,text:o.label||o.name})),empty:!1,value:r.selectedFields},on:{input:function(o){r.selectedFields=o}}})]:t.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:[{value:"append",text:r.panel.t("johannschopplich.copilot.append")},{value:"replace",text:r.panel.t("johannschopplich.copilot.replace")}],empty:!1,value:r.insertOption},on:{input:function(o){r.insertOption=o}}}):t._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling",disabled:!r.prompt.trim()||t.fields.length>0&&r.selectedFields.length===0},on:{click:function(o){return r.submit()}}},[t._v(" "+t._s(r.panel.t("johannschopplich.copilot.generate"))+" ")])],2)],1),r.licenseStatus!==void 0?n(r.LicensingButtonGroup,{staticClass:"kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":r.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):t._e()],1)])},dc=[],pc=ye(uc,lc,dc,!1,null,null);const fc=pc.exports,hc={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};var An="vercel.ai.error",mc=Symbol.for(An),Cn,gc=class Nn extends Error{constructor({name:t,message:n,cause:r}){super(n),this[Cn]=!0,this.name=t,this.cause=r}static isInstance(t){return Nn.hasMarker(t,An)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};Cn=mc;var jn=gc,On="AI_InvalidArgumentError",Tn=`vercel.ai.error.${On}`,vc=Symbol.for(Tn),Ln,_c=class extends jn{constructor({message:e,cause:t,argument:n}){super({name:On,message:e,cause:t}),this[Ln]=!0,this.argument=n}static isInstance(e){return jn.hasMarker(e,Tn)}};Ln=vc;var yc=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const o=()=>{const i=n.length,s=new Array(t);for(let a=0;a<t;a++)s[a]=n[Math.random()*i|0];return s.join("")};if(e==null)return o;if(n.includes(r))throw new _c({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${o()}`};yc();function gt(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");const Dn={...hc},bc=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:Dn,setup(e){const t=e,n=_e(),r=k(),{t:o}=Gn(),{currentContent:i,update:s}=Ge(),a=y(),c=y(),u=y(),d=y(),h=y(),p=y(),m=y(),v=y(),_=y(),x=y(),E=y(),b=y(),$=y(!1),P=y(!1),j=y(!1),N=y(),ee=y(),R=y(),Se=y([]),w=y([]),te=y();let K,M;const xe=Y(()=>!P.value&&R.value!==void 0);He(ee,L=>{$.value&&h.value&&(L&&L!==u.value?localStorage.setItem(`${K}$prompt`,L):(!L||L===u.value)&&localStorage.removeItem(`${K}$prompt`))}),He(j,L=>{$.value&&h.value&&(L?localStorage.setItem(`${K}$open`,"true"):localStorage.removeItem(`${K}$open`))}),(async()=>{var Ee;const{load:L}=Vn(),[H,C]=await Promise.all([V(),L({parent:t.parent,name:t.name})]);if(a.value=o(C.label)||r.t("johannschopplich.copilot.label"),c.value=C.field??void 0,u.value=C.userPrompt??void 0,d.value=C.systemPrompt||H.config.systemPrompt||Je,h.value=C.storage,C.editable===!0&&Se.value.push("edit"),C.files===!0&&Se.value.push("files"),p.value=C.icon||"sparkling",m.value=C.theme||"notice-icon",v.value=C.size||"md",_.value=ce.indexOf(C.logLevel&&ce.includes(C.logLevel)?C.logLevel:H.config.logLevel&&ce.includes(H.config.logLevel)?H.config.logLevel:St),E.value=C.help?o(C.help):void 0,b.value=H.config,te.value=H.licenseStatus,C.files==="auto"&&C.modelFile){x.value=C.modelFile;const{mime:D,url:ve}=C.modelFile;Ye.includes(D)&&fetch(ve).then(q=>q.blob()).then(q=>{w.value=[q]})}h.value&&((Ee=c.value)!=null&&Ee.name)&&(K=Zn(r.view.path,c.value.name.toLowerCase()),ee.value=localStorage.getItem(`${K}$prompt`)||u.value||"",j.value=localStorage.getItem(`${K}$open`)==="true"||C.open,Qn(()=>{N.value&&j.value&&(N.value.open=!0)})),r.events.on("view.save",_t),$.value=!0})(),er(()=>{r.events.off("view.save",_t)});async function Ke(){if(!ee.value){r.notification.error(r.t("johannschopplich.copilot.prompt.empty"));return}r.isLoading=!0,P.value=!0,R.value=i.value[c.value.name.toLowerCase()],M=new AbortController;const{getZodSchema:L,normalizeBlock:H}=Ne(),{getZodSchema:C,normalizeLayout:Ee}=mt();try{let D="",ve=[];if(c.value.type==="layout"||c.value.type==="blocks"){const q=await(c.value.type==="layout"?C:L)(c.value),{partialObjectStream:ae,object:Mc}=await It({userPrompt:ee.value,systemPrompt:d.value,schema:q,output:"array",files:w.value,logLevel:_.value,abortSignal:M.signal});for await(const yt of ae)!yt||!Array.isArray(yt)||await s({[c.value.name.toLowerCase()]:[...R.value,...yt.map(c.value.type==="layout"?Ee:H)]},!1);ve=await Mc}else{const{textStream:q}=await Et({userPrompt:[`<response_format>
${gr[c.value.type]||"text"}
</response_format>`,ee.value].join(`

`),systemPrompt:d.value,files:w.value,logLevel:_.value,abortSignal:M.signal});for await(const ae of q)D+=ae,await s({[c.value.name.toLowerCase()]:R.value+D},!1)}await s({[c.value.name.toLowerCase()]:c.value.type==="layout"||c.value.type==="blocks"?[...R.value,...(ve??[]).map(c.value.type==="layout"?Ee:H)]:R.value+D}),r.notification.success({icon:"sparkling",message:r.t("johannschopplich.copilot.generator.success")})}catch(D){if(gt(D))return;const{AISDKError:ve,APICallError:q}=await ne("ai");if(D instanceof be||ve.isInstance(D)||q.isInstance(D)){let ae=D.message;ae.includes("levels of nesting exceeds limit")&&(ae=`The ${c.value.type} generation for the "${c.value.name}" field exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas.`),console.error(D),r.notification.error(ae);return}console.error(D),r.notification.error(r.t("johannschopplich.copilot.generator.error"))}finally{M=void 0,r.isLoading=!1,P.value=!1}}function Dc(){M==null||M.abort(),M=void 0,r.isLoading=!1,P.value=!1}function Fc(){s({[c.value.name.toLowerCase()]:R.value}),R.value=void 0}async function Rc(){const L=await In();w.value=[...w.value,...L]}function _t(){xe.value&&(R.value=void 0)}return{__sfc:!0,propsDefinition:Dn,props:t,_isKirby5:n,panel:r,t:o,currentContent:i,updateContent:s,label:a,field:c,userPrompt:u,systemPrompt:d,storage:h,icon:p,theme:m,size:v,logLevel:_,modelFile:x,help:E,config:b,isInitialized:$,isGenerating:P,isDetailsOpen:j,detailsElement:N,currentPrompt:ee,currentFieldContent:R,permissions:Se,files:w,licenseStatus:te,storageKey:K,abortController:M,canUndo:xe,generate:Ke,abort:Dc,undo:Fc,pickFiles:Rc,onModelSave:_t,LicensingButtonGroup:$t,SUPPORTED_IMAGE_MIME_TYPES:Ye,SUPPORTED_PROVIDERS:zt}}});var wc=function(){var o,i,s,a,c,u;var t=this,n=t._self._c,r=t._self._setupProxy;return r.isInitialized?n("k-section",{attrs:{label:r.label}},[r.licenseStatus!==void 0?n("template",{slot:"options"},[n(r.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":r.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):t._e(),!r.config.provider||!r.SUPPORTED_PROVIDERS.includes(r.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Unsupported provider "),n("code",[t._v(t._s(r.config.provider))]),t._v(" in the "),n("code",[t._v("johannschopplich.copilot.provider")]),t._v(" global configuration. ")])],1):(i=(o=r.config.providers)==null?void 0:o[r.config.provider])!=null&&i.apiKey?(a=(s=r.config.providers)==null?void 0:s[r.config.provider])!=null&&a.model?!r.field||typeof r.field=="string"||typeof r.field=="object"&&!(((c=r.field)==null?void 0:c.name.toLowerCase())in r.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" The "),n("code",[t._v(t._s(((u=r.field)==null?void 0:u.name)??r.field))]),t._v(" field does not exist in the current model. ")])],1):!r.permissions.includes("edit")&&!r.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" If the user prompt cannot be edited by the user, a default "),n("code",[t._v("userPrompt")]),t._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:r.isGenerating?"loader":r.icon,text:r.panel.t("johannschopplich.copilot.generate"),theme:r.theme,variant:"filled",size:r.size,disabled:r.isGenerating},on:{click:function(d){return r.generate()}}}),r.isGenerating?n("k-button",{attrs:{icon:"cancel",text:r.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:r.size},on:{click:function(d){return r.abort()}}}):t._e(),r.canUndo?n("k-button",{attrs:{icon:"undo",text:r.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:r.size},on:{click:function(d){return r.undo()}}}):t._e()],1),r.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(d){r.isDetailsOpen=d.target.open}}},[n("summary",[t._v(" "+t._s([...r.permissions.includes("edit")?[r.panel.t("johannschopplich.copilot.prompt.label")]:[],...r.permissions.includes("files")?[r.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[r.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:r.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:r.currentPrompt,placeholder:r.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(d){r.currentPrompt=d}}})],1):t._e(),r.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:r.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:r._isKirby5&&r.files.length>0?{theme:"notice",text:r.files.length}:void 0,size:"sm"},on:{click:function(d){return r.pickFiles()}}}),r.files.length>0?n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(d){r.files=[]}}}):t._e(),r.permissions.includes("edit")&&r.userPrompt&&r.currentPrompt!==r.userPrompt?n("k-button",{staticClass:"kai-ml-auto",attrs:{icon:"undo",text:r.panel.t("johannschopplich.copilot.reset"),variant:"dimmed",size:"xs"},on:{click:function(d){r.currentPrompt=r.userPrompt}}}):t._e()],1):r.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[t._v(" "+t._s(r.panel.t(`johannschopplich.copilot.context.file.${r.SUPPORTED_IMAGE_MIME_TYPES.includes(r.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):t._e()],1)]):t._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("model")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${r.config.provider}`))]),t._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("apiKey")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${r.config.provider}`))]),t._v(" global configuration. ")])],1),r.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:r.help}})],1):t._e()],2):t._e()},kc=[],$c=ye(bc,wc,kc,!1,null,null);const zc=$c.exports;async function Fn(e,{appendText:t,replaceText:n,responseFormat:r="text"}){const o=k(),i=new AbortController,s=m=>{m.key==="Escape"&&i.abort()},a=await Rn({selection:e});if(!a)return;const{prompt:c,files:u}=a;if(!c)return;o.isLoading=!0,document.addEventListener("keydown",s);const{config:d}=await V(),{AISDKError:h,APICallError:p}=await ne("ai");try{const{textStream:m}=await Et({userPrompt:[`<response_format>
${r}
</response_format>`,e&&`<selected_text>
${e}
</selected_text>`,c].filter(Boolean).join(`

`),systemPrompt:d.systemPrompt||Je,files:u,abortSignal:i.signal});let v=!0;for await(let _ of m)a.append?(v&&(_=e?` ${_}`:_,v=!1),t(_)):n(_);o.notification.success({icon:"sparkling",message:o.t("johannschopplich.copilot.generator.success")})}catch(m){if(gt(m))return;if(m instanceof be||h.isInstance(m)||p.isInstance(m)){console.error(m),o.notification.error(m.message);return}console.error(m),o.notification.error(o.t("johannschopplich.copilot.generator.error"))}finally{o.isLoading=!1,document.removeEventListener("keydown",s)}}async function Rn(e={}){return new Promise(t=>{const n=k();let r;n.dialog.open({component:"k-copilot-prompt-dialog",props:e,on:{close:()=>{setTimeout(()=>{t(r)},25)},submit:o=>{r=o,n.dialog.close()}}})})}const Sc={__name:"CopilotButton",props:{label:{type:String,required:!1},userPrompt:{type:String,required:!1},systemPrompt:{type:String,required:!1},logLevel:{type:String,default:""},icon:{type:String,default:"sparkling"},theme:{type:String,default:"notice-icon"}},setup(e){const t=e,n=k(),{currentContent:r,update:o}=Ge(),i=y(!1),s=y(!1);let a;async function c(){a=new AbortController;const h=w=>{w.key==="Escape"&&u()};let p=await n.api.get(fr,{id:n.view.path},void 0,!0);if(p=Object.values(p).filter(w=>!dt.has(w.type)&&!w.disabled&&!w.hidden),p.length===0){n.notification.error(n.t("johannschopplich.copilot.generator.noFields"));return}const m=await Rn({fields:p,userPrompt:t.userPrompt});if(!m)return;const{prompt:v,files:_,fields:x}=m,E=p.filter(w=>x.includes(w.name));if(!v||E.length===0)return;const{getZodSchema:b}=Ne(),{getZodSchema:$}=mt(),P={};for(const w of E)w.type==="layout"?P[w.name]=B(await $(w)):w.type==="blocks"?P[w.name]=B(await b(w)):P[w.name]=pt(w);n.isLoading=!0,i.value=!0,document.addEventListener("keydown",h);const j={...r.value},{config:N}=await V(),{AISDKError:ee,APICallError:R}=await ne("ai"),Se=t.systemPrompt||N.systemPrompt||Je;try{const{partialObjectStream:w,object:te}=await It({userPrompt:v,systemPrompt:Se,schema:me(P),output:"object",files:_,logLevel:ce.indexOf(t.logLevel&&ce.includes(t.logLevel)?t.logLevel:N.logLevel&&ce.includes(N.logLevel)?N.logLevel:St),abortSignal:a.signal});for await(const xe of w){if(!xe)continue;const Ke=d({object:xe,selectedFields:E,currentContent:j});Object.keys(Ke).length>0&&await o(Ke,!1)}const K=await te,M=d({object:K,selectedFields:E,currentContent:j});await o(M),n.notification.success({icon:"sparkling",message:n.t("johannschopplich.copilot.generator.success")})}catch(w){if(gt(w))return;if(w instanceof be||ee.isInstance(w)||R.isInstance(w)){let te=w.message;te.includes("levels of nesting exceeds limit")&&(te="The fields generation exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas."),console.error(w),n.notification.error(te);return}console.error(w),n.notification.error(n.t("johannschopplich.copilot.generator.error"))}finally{a=void 0,n.isLoading=!1,i.value=!1,document.removeEventListener("keydown",h)}}function u(){a==null||a.abort(),a=void 0,i.value=!1,n.isLoading=!1}function d({object:h,selectedFields:p,currentContent:m}){const{normalizeBlock:v}=Ne(),{normalizeLayout:_}=mt(),x={};for(const E of p){const b=h[E.name];if(b==null)continue;const $=m[E.name];E.type==="layout"||E.type==="blocks"?Array.isArray(b)&&(x[E.name]=[...$,...b.map(E.type==="layout"?_:v)]):x[E.name]=b}return x}return{__sfc:!0,props:t,panel:n,currentContent:r,updateContent:o,isGenerating:i,isHovering:s,abortController:a,initPromptDialog:c,abort:u,processFieldValues:d}}};var xc=function(){var t=this,n=t._self._c,r=t._self._setupProxy;return n("k-button",{attrs:{icon:r.isHovering&&r.isGenerating?"cancel":r.isGenerating?"loader":t.icon,text:t.label||r.panel.t("johannschopplich.copilot.label"),theme:r.isHovering&&r.isGenerating?"notice":t.theme,variant:"filled",size:"sm",responsive:""},on:{click:function(o){r.isHovering&&r.isGenerating?r.abort():r.initPromptDialog()}},nativeOn:{mouseenter:function(o){r.isHovering=!0},mouseleave:function(o){r.isHovering=!1}}})},Ec=[],Ic=ye(Sc,xc,Ec,!1,null,null);const Mn=Ic.exports,Zc={"copilot-ai-generate":'<path fill="currentColor" d="m20.467 8.694l.246-.566a4.36 4.36 0 0 1 2.22-2.25l.759-.339a.53.53 0 0 0 0-.963l-.717-.319a4.37 4.37 0 0 1-2.251-2.326l-.253-.611a.506.506 0 0 0-.942 0l-.253.61a4.37 4.37 0 0 1-2.25 2.327l-.718.32a.53.53 0 0 0 0 .962l.76.338a4.36 4.36 0 0 1 2.219 2.251l.246.566c.18.414.753.414.934 0M5.8 16h2.154l.6-1.5h2.892l.6 1.5H14.2L11 8H9zm4.2-5.115l.646 1.615H9.354zM15 16V8h2v8zM3 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-9h-2v8H4V5h10V3z" />'},Pc={copilot:{icon:"sparkling",label:"Copilot Prompt",click(){let e="";this.command("insert",(o,i)=>(e=i,i));let t=!0;Fn(e,{responseFormat:"markdown",appendText:o=>{this.command("insert",(i,s)=>t?(t=!1,s+o):o)},replaceText:o=>{this.command("insert",()=>o)}})},shortcut:"."}},vt={"***":["bold","italic"],"**":["bold"],"*":["italic"],"`":["code"]},Ac={copilot:{get button(){return{icon:"sparkling",label:"Copilot Prompt"}},commands(e){return()=>this._openPromptDialog(e)},keys(e){return{"Mod-.":()=>this._openPromptDialog(e)}},get name(){return"copilot"},_insertText(e,t,n,r,o){let i=n;const s=t.split(/(\n\n?|\*{1,3}|`{1,3})/);for(let a=0;a<s.length;a++){const c=s[a];if(c){if(c===`

`){const u=this.editor.options.inline?[o.schema.nodes.hardBreak.create(),o.schema.nodes.hardBreak.create()]:o.schema.nodes.paragraph.create();e=e.replaceWith(i,i,u),i+=2,r.lastSegment=c}else if(c===`
`)e=e.replaceWith(i,i,o.schema.nodes.hardBreak.create()),i+=1,r.lastSegment=c;else if(c.length>0){if(c in vt){const d=a<s.length-1?s[a+1]:"";if((Oc(c,r.activeMarks)||Tc(c,d))&&!r.lastSegment.includes(c)){for(const m of vt[c])e=jc(e,m,r,o);r.lastSegment=c;continue}}e=e.insertText(c,i),i+=c.length,r.lastSegment=c}}}return{tr:e,newPosition:i}},_openPromptDialog(e){const{state:t}=this.editor,{from:n,to:r}=t.selection,o=t.doc.textBetween(n,r),i={activeMarks:new Set,lastSegment:""};let s,a=!1,c=!0;Fn(o,{responseFormat:"text",replaceText:h=>{const{state:p,view:m}=this.editor;let v=p.tr;if(!a){const E=Cc(p),{from:b,to:$}=p.selection;v=v.deleteRange(b,$),s=E?1:b,a=!0}const{tr:_,newPosition:x}=this._insertText(v,h,s,i,e);s=x,m.dispatch(_)},appendText:h=>{const{state:p,view:m}=this.editor;c&&(s=p.selection.to,c=!1);const{tr:v,newPosition:_}=this._insertText(p.tr,h,s,i,e);s=_,m.dispatch(v)}})}}};function Cc(e){const t=e.doc.content.size,{from:n,to:r}=e.selection;return n===0&&r===t}function jc(e,t,n,{schema:r}){const o=r.marks[t];if(!o)return e;const i=[...n.activeMarks].find(s=>s.type.name===t);if(i){n.activeMarks.delete(i);const s=[...n.activeMarks];return e.setStoredMarks(s)}else{const s=o.create();return n.activeMarks.add(s),e.addStoredMark(s)}}function Oc(e,t){return[...t].some(n=>{for(const[r,o]of Object.entries(vt))if(r===e&&o.includes(n.type.name))return!0;return!1})}function Tc(e,t){return e.startsWith("*")?t.length>0&&/^\S/.test(t):!0}function Lc(e){if(_e())return;let t;e.mixin({mounted(){if(this.$options.name!=="k-header")return;const n=this.$children.find(o=>o.$options.name==="k-button-group");if(!n)return;const r=e.extend(Mn);t=new r({parent:this}),t.$mount(),n.$el.before(t.$el)},beforeDestroy(){this.$options.name==="k-header"&&t&&(t.$destroy(),t=void 0)}})}window.panel.plugin("johannschopplich/copilot",{viewButtons:{copilot:Mn},components:{"k-copilot-prompt-dialog":fc},sections:{copilot:zc},fields:{},textareaButtons:Pc,writerMarks:Ac,icons:Zc,use:[Lc]})})();

var Lc=Object.defineProperty;var Un=p=>{throw TypeError(p)};var Dc=(p,w,L)=>w in p?Lc(p,w,{enumerable:!0,configurable:!0,writable:!0,value:L}):p[w]=L;var G=(p,w,L)=>Dc(p,typeof w!="symbol"?w+"":w,L),Fc=(p,w,L)=>w.has(p)||Un("Cannot "+L);var xe=(p,w,L)=>(Fc(p,w,"read from private field"),L?L.call(p):w.get(p)),Mn=(p,w,L)=>w.has(p)?Un("Cannot add the same private member more than once"):w instanceof WeakSet?w.add(p):w.set(p,L);(function(){"use strict";const p=window.Vue;function w(){return window.panel}function L(){return w().api}const ge=()=>window.panel.plugins.viewButtons!==void 0;function Nn(){return ge()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):w().app.$store}function Ge(){const e=w(),t=Nn(),n=ge();if(n&&!("diff"in e.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const o=H(n?()=>e.content.version("changes"):()=>t.getters["content/values"]()),r=H(n?()=>e.content.diff():()=>t.getters["content/changes"]()),i=H(n?()=>e.content.hasDiff():()=>t.getters["content/hasChanges"]()),s=n?e.content:new Proxy({},{get(){return()=>{}}});return{content:s,currentContent:o,contentChanges:r,hasChanges:i,update:async(c,u=!0)=>{if(!n&&c)for(const[h,f]of Object.entries(c))t.dispatch("content/update",[h,f]);const d=s.merge(c);u&&await s.save(d)}}}function Kn(){const e=w();function t(n){return!n||typeof n=="string"?n:n[e.translation.code]??Object.values(n)[0]}return{t}}function Gn(){const e=L();return{load:({parent:n,name:o})=>e.get(`${n}/sections/${o}`)}}const Vn={error:0,warn:1,log:2,info:3,success:3};function Wn(e){const t=new qn;return new Proxy({},{get(n,o){return(...r)=>{t.log({level:Vn[o],type:o,tag:e,args:r})}}})}class qn{constructor(){G(this,"defaultColor","#7f8c8d");G(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});G(this,"typeColorMap",{success:"#2ecc71"})}log(t){const n=Yn(t.level),o=t.type==="log"?"":t.type,r=t.tag||"",s=`
background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),a=`%c${[r,o].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?n(`${a}%c ${t.args[0]}`,s,"",...t.args.slice(1)):n(a,s,...t.args)}}function Yn(e){return e<1?console.error:console.log}const Ee=[],Ve=new Map;async function Hn(e){if(!Array.isArray(e))throw new TypeError(`Expected an array, got ${typeof e}`);for(const t of e)Ee.some(n=>n.filename===t.filename)||Ee.push(t)}function yt(e){if(Ee.length===0)throw new Error("Plugin assets not registered");const t=Ee.find(n=>n.filename===e);if(!t)throw new Error(`Plugin asset "${e}" not found`);return t}async function te(e){if(e.endsWith(".js")||(e+=".js"),Ve.has(e))return Ve.get(e);const n=await import(yt(e).url);return Ve.set(e,n),n}const H=p.computed;p.customRef,p.defineAsyncComponent,p.defineComponent,p.effectScope,p.getCurrentInstance;const Jn=p.getCurrentScope;p.h,p.inject,p.isProxy,p.isReactive,p.isReadonly,p.isRef,p.isShallow,p.markRaw;const Xn=p.nextTick;p.onActivated,p.onBeforeMount;const Qn=p.onBeforeUnmount;p.onBeforeUpdate,p.onDeactivated,p.onErrorCaptured;const bt=p.onMounted;p.onRenderTracked,p.onRenderTriggered;const eo=p.onScopeDispose;p.onServerPrefetch,p.onUnmounted,p.onUpdated,p.provide,p.proxyRefs,p.reactive,p.readonly;const _=p.ref;p.shallowReactive,p.shallowReadonly,p.shallowRef,p.toRaw,p.toRef,p.toRefs,p.triggerRef;const We=p.unref;p.useAttrs,p.useCssModule,p.useCssVars,p.useListeners,p.useSlots;const qe=p.watch;p.watchEffect,p.watchPostEffect,p.watchSyncEffect;const Ye={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible":"License key invalid for this plugin version","modal.error.upgradeable":"License key invalid for this plugin version. Upgrade now on https://hub.kirby.tools.","modal.error.activated":"License key already activated",activate:"Activate",activated:"Plugin activated",buy:"Buy a license",upgrade:"Upgrade"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.upgradeable":"Lizenzschlüssel ungültig für diese Plugin-Version. Aktualisiere jetzt auf https://hub.kirby.tools.","modal.error.activated":"Lizenzschlüssel bereits aktiviert",activate:"Aktivieren",activated:"Plugin aktiviert",buy:"Lizenz kaufen",upgrade:"Upgrade"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible":"Clé de licence invalide pour cette version du plugin","modal.error.upgradeable":"Clé de licence invalide pour cette version du plugin. Mettez à niveau maintenant sur https://hub.kirby.tools.","modal.error.activated":"Clé de licence déjà activée",activate:"Activer",activated:"Plugin activé",buy:"Acheter une licence",upgrade:"Upgrade"},nl:{"modal.info":"Bedankt voor het kopen van {label}! Voer je e-mailadres en bestelnummer in om je licentie te activeren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Vind je bestelnummer</a> op Lemon Squeezy of <a href="mailto:hello@kirby.tools">neem contact met ons op</a> als je het niet kunt vinden.',"modal.error.required.fields":"E-mailadres en bestelnummer zijn verplicht","modal.error.invalid.unauthorized":"E-mailadres of bestelnummer is onjuist","modal.error.invalid.licenseKey":"Licentiesleutel ongeldig voor dit plug-in","modal.error.incompatible":"Licentiesleutel ongeldig voor deze plug-inversie","modal.error.upgradeable":"Licentiesleutel ongeldig voor deze plug-inversie. Upgrade nu op https://hub.kirby.tools.","modal.error.activated":"Licentiesleutel al geactiveerd",activate:"Activeren",activated:"Plugin geactiveerd",buy:"Koop een licentie",upgrade:"Upgrade"}},to=["localhost","127.0.0.1","[::1]"],no=["local","test","ddev.site"];function ne(e="",t){var r;const n=window.panel.translation.code,o=((r=Ye==null?void 0:Ye[n])==null?void 0:r[e])??e;return t?oo(o,t):o}function oo(e,t,n){return e.replace(/\{(\w+)\}/g,(o,r)=>t[r]||r)}function ro(){const{hostname:e}=window.location,t=to.includes(e),n=no.some(o=>e.endsWith(`.${o}`));return t||n}const wt={Unauthorized:"modal.error.invalid.unauthorized","License key not valid for this plugin":"modal.error.invalid.licenseKey","License key not valid for this plugin version":"modal.error.incompatible","License key not valid for this plugin version, please upgrade your license":"modal.error.upgradeable","License key already activated":"modal.error.activated"};function io(e){const t=w();return{isLocalhost:ro(),assertActivationIntegrity:async({component:i,licenseStatus:s})=>{if(We(s)==="active")return;const a=We(i);if(!(a!=null&&a.$el)||window.getComputedStyle(a.$el).display==="none"||window.getComputedStyle(a.$el).visibility==="hidden"||window.getComputedStyle(a.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let i=!1;const{label:s}=e,a={info:{type:"info",text:ne("modal.info",{label:s})},email:{label:t.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:ne("modal.fields.orderId.help",{label:s})}};return new Promise(c=>{t.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:ne("activate",{label:s})},fields:a},on:{close:()=>{c({isLicenseActive:i})},submit:async u=>{i=await so(u,e),i&&(t.dialog.close(),t.notification.success(ne("activated")))}}})})}}}async function so(e,t){const n=w(),{email:o,orderId:r}=e;if(!o||!r)return n.notification.error(ne("modal.error.required.fields")),!1;try{const i=await n.api.post(`${t.apiNamespace}/activate`,{email:o,orderId:Number(r)});if((i==null?void 0:i.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(i){const s=i.message;return n.notification.error(wt[s]?ne(wt[s]):s),!1}}const ao=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(e){const t=e,{openLicenseModal:n,assertActivationIntegrity:o}=io({label:t.label,apiNamespace:t.apiNamespace}),r=_(t.licenseStatus),i=_();bt(()=>{o({component:i,licenseStatus:t.licenseStatus})});async function s(){const{isLicenseActive:a}=await n();a&&window.location.reload()}return{__sfc:!0,props:t,openLicenseModal:n,assertActivationIntegrity:o,currentLicenseStatus:r,licenseButtonGroup:i,handleRegistration:s,t:ne}}});function ve(e,t,n,o,r,i,s,a){var c=typeof e=="function"?e.options:e;return t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c._scopeId="data-v-"+i),{exports:e,options:c}}var co=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return o.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:o.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":t.pricingUrl,target:"_blank",text:o.currentLicenseStatus==="upgradeable"?o.t("upgrade"):o.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:o.t("activate")},on:{click:function(r){return o.handleRegistration()}}})],1):t._e()},uo=[],lo=ve(ao,co,uo,!1,null,null);const kt=lo.exports,po="__copilot__/context",fo="__copilot__/model-fields",ho="__copilot__/fieldsets",$t=["anthropic","google","mistral","openai"],He=["image/gif","image/jpeg","image/png","image/webp"],ae=["error","warn","info","debug"],zt="warn",mo="kirby$copilot$",go={list:"HTML",markdown:"markdown",textarea:"markdown",writer:"HTML"},Je=`
You are an AI assistant integrated into the Kirby CMS Panel. Your primary task is to help users generate content for various field types within the CMS. You must provide relevant and helpful content based on the user's question and the specified field type, while considering any provided context.

Consider the user context if provided:
- If selected_text is provided, use it as context for the user's question.
- If pdf_documents are provided, incorporate the information from these documents into your response as applicable.

Format your response according to the specified response_format if provided:
1. If response_format is "text", provide your response in plain text without any Markdown or HTML syntax.
2. If response_format is "HTML", format your response using HTML syntax. Only include the content that would go inside the <body> element. Use appropriate HTML tags to structure your response, including <h2> or <h3> tags for section headings.
3. If response_format is "markdown", format your response using Markdown syntax. Do not use backticks or any other wrapping characters around your response.
`;class _e extends Error{}let ye;async function vo(e){const t=await yo(),n=await e.arrayBuffer(),o=await t.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:o.numPages},(i,s)=>_o(o,s+1)))).map(i=>i.replace(/\s+/g," ")).join(`
`)}async function _o(e,t){return(await(await e.getPage(t)).getTextContent()).items.filter(r=>r.str!=null).map(r=>r.str).join(" ")}async function yo(){if(ye)return ye;ye=await te("pdfjs");const e=yt("pdfjs.worker.js");return ye.GlobalWorkerOptions.workerSrc=e.url,ye}function bo(e,t,n){return e.replace(/\{(\w+)\}/g,(o,r)=>t[r.toLowerCase()]||r)}async function wo({accept:e="*",multiple:t=!0}={}){const n=document.createElement("input");return n.type="file",n.classList.add("sr-only"),n.value=null,n.accept=e,n.multiple=t,n.click(),new Promise(o=>{n.addEventListener("change",r=>{var i;o([...((i=r.target)==null?void 0:i.files)??[]]),n.remove()},{once:!0})})}async function ko(e,t){const n=await $o(e);return await zo(n,e.type,t)}async function $o(e,t={}){if(!e.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${e.type}`);const n=new Image,o=URL.createObjectURL(e);t.crossOrigin&&(n.crossOrigin=t.crossOrigin);try{return await new Promise((i,s)=>{n.addEventListener("load",()=>{i(n)}),n.addEventListener("error",s),n.src=o})}finally{URL.revokeObjectURL(o)}}async function zo(e,t,n){if(!e.complete||!e.naturalWidth)throw new Error("Image has not been properly loaded");if(!t.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${t}`);const o=document.createElement("canvas"),r=o.getContext("2d"),i=Math.min(1,n/Math.max(e.width,e.height)),s=Math.round(e.width*i),a=Math.round(e.height*i);o.width=s,o.height=a,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(e,0,0,s,a);const c=await new Promise(u=>{o.toBlob(u,t)});if(!c)throw new Error("Failed to convert canvas to Blob");return c}function So(){const{currentContent:e}=Ge(),t={...e.value,title:window.panel.view.title};return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,Array.isArray(o)||typeof o=="object"&&o!==null?JSON.stringify(o):o]))}let xo;function St(){return xo??(xo=Wn("copilot"))}let Ie,be;function V(){return Ie||be||(be=window.panel.api.get(po).then(e=>(Hn(e.assets),Ie=e,be=void 0,Ie)),be)}async function xt({userPrompt:e,systemPrompt:t,files:n=[],logLevel:o=1,abortSignal:r}){const i=St(),{config:s}=await V(),{model:a,providerOptions:c}=await It(),{AISDKError:u,APICallError:d,streamText:h,smoothStream:f}=await te("ai"),{userPromptWithContext:m,imageByteArrays:v}=await Zt({userPrompt:e,files:n});return o>1&&(i.info("System prompt:",t),i.info("User prompt with context:",m)),h({model:a,providerOptions:c,temperature:s.temperature,system:t||void 0,...v.length>0?{messages:[{role:"user",content:[{type:"text",text:m},...v.map(y=>({type:"image",image:y}))]}]}:{prompt:m},experimental_transform:f({chunking:"line"}),abortSignal:r,onError({error:y}){if(u.isInstance(y)||d.isInstance(y))throw y}})}async function Et({userPrompt:e,systemPrompt:t,schema:n,output:o="object",files:r=[],logLevel:i=1,abortSignal:s}){const a=St(),{config:c}=await V(),{model:u,providerOptions:d}=await It(),{AISDKError:h,APICallError:f,streamObject:m}=await te("ai"),{userPromptWithContext:v,imageByteArrays:y}=await Zt({userPrompt:e,files:r});return i>1&&(a.info("System prompt:",t),a.info("User prompt with context:",v)),m({model:u,providerOptions:d,temperature:c.temperature,schema:n,output:o,...y.length>0?{messages:[{role:"user",content:[{type:"text",text:v},...y.map(E=>({type:"image",image:E}))]}]}:{prompt:v},abortSignal:s,onError({error:E}){if(h.isInstance(E)||f.isInstance(E))throw E}})}async function It(){var h,f;let{config:e}=await V();if(!e.provider||!$t.includes(e.provider))throw new _e(`Unsupported provider "${e.provider}" in the "johannschopplich.copilot.provider" global configuration.`);for(const m of["apiKey","model"])if(!((f=(h=e.providers)==null?void 0:h[e.provider])!=null&&f[m]))throw new _e(`Missing "${m}" property in the "johannschopplich.copilot.providers.${e.provider}" global configuration.`);const{createAnthropic:t,createGoogleGenerativeAI:n,createMistral:o,createOpenAI:r}=await te("ai"),i=e.provider,s=e.providers[i],a={anthropic:t,google:n,mistral:o,openai:r}[i],u=a({baseUrl:s.baseUrl||void 0,apiKey:s.apiKey,...i==="anthropic"?{headers:{"anthropic-dangerous-direct-browser-access":"true"}}:void 0}).languageModel(s.model),d=typeof s.options=="object"&&s.options!==null?{[i]:s.options}:void 0;return{model:u,providerOptions:d}}async function Zt({userPrompt:e,files:t=[]}){const n=So();let o=bo(e,n);const r=t.filter(a=>a.type.startsWith("image/")),i=t.filter(a=>a.type==="application/pdf");if(i.length>0){const a=await Promise.all(i.map(vo));o+=`

${a.map((c,u)=>`<pdf_document_${u+1}>
${c}
</pdf_document_${u+1}>`).join(`

`)}`}const s=await Promise.all(r.map(async a=>{const u=await(await ko(a,2048)).arrayBuffer();return new Uint8Array(u)}));return{userPromptWithContext:o,imageByteArrays:s}}function l(e,t,n){function o(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(e),t(a,c);for(const d in s.prototype)d in a||Object.defineProperty(a,d,{value:s.prototype[d].bind(a)});a._zod.constr=s,a._zod.def=c}const r=(n==null?void 0:n.Parent)??Object;class i extends r{}Object.defineProperty(i,"name",{value:e});function s(a){var c;const u=n!=null&&n.Parent?new i:this;o(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(s,"init",{value:o}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>{var c,u;return n!=null&&n.Parent&&a instanceof n.Parent?!0:(u=(c=a==null?void 0:a._zod)==null?void 0:c.traits)==null?void 0:u.has(e)}}),Object.defineProperty(s,"name",{value:e}),s}class ce extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class At extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Pt={};function J(e){return Pt}function Eo(e){const t=Object.values(e).filter(o=>typeof o=="number");return Object.entries(e).filter(([o,r])=>t.indexOf(+o)===-1).map(([o,r])=>r)}function Xe(e,t){return typeof t=="bigint"?t.toString():t}function Qe(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function et(e){return e==null}function tt(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Io(e,t){const n=(e.toString().split(".")[1]||"").length,o=t.toString();let r=(o.split(".")[1]||"").length;if(r===0&&/\d?e-\d?/.test(o)){const c=o.match(/\d?e-(\d?)/);c!=null&&c[1]&&(r=Number.parseInt(c[1]))}const i=n>r?n:r,s=Number.parseInt(e.toFixed(i).replace(".","")),a=Number.parseInt(t.toFixed(i).replace(".",""));return s%a/10**i}const jt=Symbol("evaluating");function z(e,t,n){let o;Object.defineProperty(e,t,{get(){if(o!==jt)return o===void 0&&(o=jt,o=n()),o},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function oe(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function re(...e){const t={};for(const n of e){const o=Object.getOwnPropertyDescriptors(n);Object.assign(t,o)}return Object.defineProperties({},t)}function Ct(e){return JSON.stringify(e)}const Ot="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Ze(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Zo=Qe(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function ue(e){if(Ze(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(Ze(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function Tt(e){return ue(e)?{...e}:Array.isArray(e)?[...e]:e}const Ao=new Set(["string","number","symbol"]);function le(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function X(e,t,n){const o=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(o._zod.parent=e),o}function g(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Po(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const jo={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Co(e,t){const n=e._zod.def,o=re(e._zod.def,{get shape(){const r={};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(r[i]=n.shape[i])}return oe(this,"shape",r),r},checks:[]});return X(e,o)}function Oo(e,t){const n=e._zod.def,o=re(e._zod.def,{get shape(){const r={...e._zod.def.shape};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete r[i]}return oe(this,"shape",r),r},checks:[]});return X(e,o)}function To(e,t){if(!ue(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const r=re(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return oe(this,"shape",i),i},checks:[]});return X(e,r)}function Lo(e,t){if(!ue(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...e._zod.def,get shape(){const o={...e._zod.def.shape,...t};return oe(this,"shape",o),o},checks:e._zod.def.checks};return X(e,n)}function Do(e,t){const n=re(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t._zod.def.shape};return oe(this,"shape",o),o},get catchall(){return t._zod.def.catchall},checks:[]});return X(e,n)}function Fo(e,t,n){const o=re(t._zod.def,{get shape(){const r=t._zod.def.shape,i={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)i[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return oe(this,"shape",i),i},checks:[]});return X(t,o)}function Ro(e,t,n){const o=re(t._zod.def,{get shape(){const r=t._zod.def.shape,i={...r};if(n)for(const s in n){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)i[s]=new e({type:"nonoptional",innerType:r[s]});return oe(this,"shape",i),i},checks:[]});return X(t,o)}function de(e,t=0){var n;if(e.aborted===!0)return!0;for(let o=t;o<e.issues.length;o++)if(((n=e.issues[o])==null?void 0:n.continue)!==!0)return!0;return!1}function pe(e,t){return t.map(n=>{var o;return(o=n).path??(o.path=[]),n.path.unshift(e),n})}function Ae(e){return typeof e=="string"?e:e==null?void 0:e.message}function Q(e,t,n){var r,i,s,a,c,u;const o={...e,path:e.path??[]};if(!e.message){const d=Ae((s=(i=(r=e.inst)==null?void 0:r._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,e))??Ae((a=t==null?void 0:t.error)==null?void 0:a.call(t,e))??Ae((c=n.customError)==null?void 0:c.call(n,e))??Ae((u=n.localeError)==null?void 0:u.call(n,e))??"Invalid input";o.message=d}return delete o.inst,delete o.continue,t!=null&&t.reportInput||delete o.input,o}function nt(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function we(...e){const[t,n,o]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:o}:{...t}}const Lt=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Xe,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Dt=l("$ZodError",Lt),Ft=l("$ZodError",Lt,{Parent:Error});function Uo(e,t=n=>n.message){const n={},o=[];for(const r of e.issues)r.path.length>0?(n[r.path[0]]=n[r.path[0]]||[],n[r.path[0]].push(t(r))):o.push(t(r));return{formErrors:o,fieldErrors:n}}function Mo(e,t){const n=t||function(i){return i.message},o={_errors:[]},r=i=>{for(const s of i.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(a=>r({issues:a}));else if(s.code==="invalid_key")r({issues:s.issues});else if(s.code==="invalid_element")r({issues:s.issues});else if(s.path.length===0)o._errors.push(n(s));else{let a=o,c=0;for(;c<s.path.length;){const u=s.path[c];c===s.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(n(s))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return r(e),o}const ot=e=>(t,n,o,r)=>{const i=o?Object.assign(o,{async:!1}):{async:!1},s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise)throw new ce;if(s.issues.length){const a=new((r==null?void 0:r.Err)??e)(s.issues.map(c=>Q(c,i,J())));throw Ot(a,r==null?void 0:r.callee),a}return s.value},rt=e=>async(t,n,o,r)=>{const i=o?Object.assign(o,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new((r==null?void 0:r.Err)??e)(s.issues.map(c=>Q(c,i,J())));throw Ot(a,r==null?void 0:r.callee),a}return s.value},Pe=e=>(t,n,o)=>{const r=o?{...o,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},r);if(i instanceof Promise)throw new ce;return i.issues.length?{success:!1,error:new(e??Dt)(i.issues.map(s=>Q(s,r,J())))}:{success:!0,data:i.value}},Bo=Pe(Ft),je=e=>async(t,n,o)=>{const r=o?Object.assign(o,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},r);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(s=>Q(s,r,J())))}:{success:!0,data:i.value}},No=je(Ft),Ko=e=>(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return ot(e)(t,n,r)},Go=e=>(t,n,o)=>ot(e)(t,n,o),Vo=e=>async(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return rt(e)(t,n,r)},Wo=e=>async(t,n,o)=>rt(e)(t,n,o),qo=e=>(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Pe(e)(t,n,r)},Yo=e=>(t,n,o)=>Pe(e)(t,n,o),Ho=e=>async(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return je(e)(t,n,r)},Jo=e=>async(t,n,o)=>je(e)(t,n,o),Xo=/^[cC][^\s-]{8,}$/,Qo=/^[0-9a-z]+$/,er=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,tr=/^[0-9a-vA-V]{20}$/,nr=/^[A-Za-z0-9]{27}$/,or=/^[a-zA-Z0-9_-]{21}$/,rr=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ir=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Rt=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,sr=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ar="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function cr(){return new RegExp(ar,"u")}const ur=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,lr=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,dr=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,pr=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,fr=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Ut=/^[A-Za-z0-9_-]*$/,hr=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,mr=/^\+(?:[0-9]){6,14}[0-9]$/,Mt="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",gr=new RegExp(`^${Mt}$`);function Bt(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function vr(e){return new RegExp(`^${Bt(e)}$`)}function _r(e){const t=Bt({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const o=`${t}(?:${n.join("|")})`;return new RegExp(`^${Mt}T(?:${o})$`)}const yr=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},br=/^-?\d+$/,wr=/^-?\d+(?:\.\d+)?/,kr=/^(?:true|false)$/i,$r=/^[^A-Z]*$/,zr=/^[^a-z]*$/,O=l("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Nt={number:"number",bigint:"bigint",object:"date"},Kt=l("$ZodCheckLessThan",(e,t)=>{O.init(e,t);const n=Nt[typeof t.value];e._zod.onattach.push(o=>{const r=o._zod.bag,i=(t.inclusive?r.maximum:r.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value<=t.value:o.value<t.value)||o.issues.push({origin:n,code:"too_big",maximum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Gt=l("$ZodCheckGreaterThan",(e,t)=>{O.init(e,t);const n=Nt[typeof t.value];e._zod.onattach.push(o=>{const r=o._zod.bag,i=(t.inclusive?r.minimum:r.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value>=t.value:o.value>t.value)||o.issues.push({origin:n,code:"too_small",minimum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Sr=l("$ZodCheckMultipleOf",(e,t)=>{O.init(e,t),e._zod.onattach.push(n=>{var o;(o=n._zod.bag).multipleOf??(o.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Io(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),xr=l("$ZodCheckNumberFormat",(e,t)=>{var s;O.init(e,t),t.format=t.format||"float64";const n=(s=t.format)==null?void 0:s.includes("int"),o=n?"int":"number",[r,i]=jo[t.format];e._zod.onattach.push(a=>{const c=a._zod.bag;c.format=t.format,c.minimum=r,c.maximum=i,n&&(c.pattern=br)}),e._zod.check=a=>{const c=a.value;if(n){if(!Number.isInteger(c)){a.issues.push({expected:o,format:t.format,code:"invalid_type",continue:!1,input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?a.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,continue:!t.abort}):a.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,continue:!t.abort});return}}c<r&&a.issues.push({origin:"number",input:c,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),c>i&&a.issues.push({origin:"number",input:c,code:"too_big",maximum:i,inst:e})}}),Er=l("$ZodCheckMaxLength",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!et(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(o._zod.bag.maximum=t.maximum)}),e._zod.check=o=>{const r=o.value;if(r.length<=t.maximum)return;const s=nt(r);o.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Ir=l("$ZodCheckMinLength",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!et(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(o._zod.bag.minimum=t.minimum)}),e._zod.check=o=>{const r=o.value;if(r.length>=t.minimum)return;const s=nt(r);o.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Zr=l("$ZodCheckLengthEquals",(e,t)=>{var n;O.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!et(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=o=>{const r=o.value,i=r.length;if(i===t.length)return;const s=nt(r),a=i>t.length;o.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:o.value,inst:e,continue:!t.abort})}}),Ce=l("$ZodCheckStringFormat",(e,t)=>{var n,o;O.init(e,t),e._zod.onattach.push(r=>{const i=r._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(o=e._zod).check??(o.check=()=>{})}),Ar=l("$ZodCheckRegex",(e,t)=>{Ce.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Pr=l("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=$r),Ce.init(e,t)}),jr=l("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=zr),Ce.init(e,t)}),Cr=l("$ZodCheckIncludes",(e,t)=>{O.init(e,t);const n=le(t.includes),o=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=o,e._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(o)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),Or=l("$ZodCheckStartsWith",(e,t)=>{O.init(e,t);const n=new RegExp(`^${le(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const r=o._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(n)}),e._zod.check=o=>{o.value.startsWith(t.prefix)||o.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:o.value,inst:e,continue:!t.abort})}}),Tr=l("$ZodCheckEndsWith",(e,t)=>{O.init(e,t);const n=new RegExp(`.*${le(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const r=o._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(n)}),e._zod.check=o=>{o.value.endsWith(t.suffix)||o.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:o.value,inst:e,continue:!t.abort})}}),Lr=l("$ZodCheckOverwrite",(e,t)=>{O.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Dr{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const o=t.split(`
`).filter(s=>s),r=Math.min(...o.map(s=>s.length-s.trimStart().length)),i=o.map(s=>s.slice(r)).map(s=>" ".repeat(this.indent*2)+s);for(const s of i)this.content.push(s)}compile(){const t=Function,n=this==null?void 0:this.args,r=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new t(...n,r.join(`
`))}}const Fr={major:4,minor:1,patch:11},I=l("$ZodType",(e,t)=>{var r;var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Fr;const o=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&o.unshift(e);for(const i of o)for(const s of i._zod.onattach)s(e);if(o.length===0)(n=e._zod).deferred??(n.deferred=[]),(r=e._zod.deferred)==null||r.push(()=>{e._zod.run=e._zod.parse});else{const i=(a,c,u)=>{let d=de(a),h;for(const f of c){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(d)continue;const m=a.issues.length,v=f._zod.check(a);if(v instanceof Promise&&(u==null?void 0:u.async)===!1)throw new ce;if(h||v instanceof Promise)h=(h??Promise.resolve()).then(async()=>{await v,a.issues.length!==m&&(d||(d=de(a,m)))});else{if(a.issues.length===m)continue;d||(d=de(a,m))}}return h?h.then(()=>a):a},s=(a,c,u)=>{if(de(a))return a.aborted=!0,a;const d=i(c,o,u);if(d instanceof Promise){if(u.async===!1)throw new ce;return d.then(h=>e._zod.parse(h,u))}return e._zod.parse(d,u)};e._zod.run=(a,c)=>{if(c.skipChecks)return e._zod.parse(a,c);if(c.direction==="backward"){const d=e._zod.parse({value:a.value,issues:[]},{...c,skipChecks:!0});return d instanceof Promise?d.then(h=>s(h,a,c)):s(d,a,c)}const u=e._zod.parse(a,c);if(u instanceof Promise){if(c.async===!1)throw new ce;return u.then(d=>i(d,o,c))}return i(u,o,c)}}e["~standard"]={validate:i=>{var s;try{const a=Bo(e,i);return a.success?{value:a.data}:{issues:(s=a.error)==null?void 0:s.issues}}catch{return No(e,i).then(c=>{var u;return c.success?{value:c.data}:{issues:(u=c.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),it=l("$ZodString",(e,t)=>{var n;I.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??yr(e._zod.bag),e._zod.parse=(o,r)=>{if(t.coerce)try{o.value=String(o.value)}catch{}return typeof o.value=="string"||o.issues.push({expected:"string",code:"invalid_type",input:o.value,inst:e}),o}}),x=l("$ZodStringFormat",(e,t)=>{Ce.init(e,t),it.init(e,t)}),Rr=l("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=ir),x.init(e,t)}),Ur=l("$ZodUUID",(e,t)=>{if(t.version){const o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(o===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Rt(o))}else t.pattern??(t.pattern=Rt());x.init(e,t)}),Mr=l("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=sr),x.init(e,t)}),Br=l("$ZodURL",(e,t)=>{x.init(e,t),e._zod.check=n=>{try{const o=n.value.trim(),r=new URL(o);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:hr.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=r.href:n.value=o;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Nr=l("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=cr()),x.init(e,t)}),Kr=l("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=or),x.init(e,t)}),Gr=l("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Xo),x.init(e,t)}),Vr=l("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Qo),x.init(e,t)}),Wr=l("$ZodULID",(e,t)=>{t.pattern??(t.pattern=er),x.init(e,t)}),qr=l("$ZodXID",(e,t)=>{t.pattern??(t.pattern=tr),x.init(e,t)}),Yr=l("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=nr),x.init(e,t)}),Hr=l("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=_r(t)),x.init(e,t)}),Jr=l("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=gr),x.init(e,t)}),Xr=l("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=vr(t)),x.init(e,t)}),Qr=l("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=rr),x.init(e,t)}),ei=l("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=ur),x.init(e,t),e._zod.onattach.push(n=>{const o=n._zod.bag;o.format="ipv4"})}),ti=l("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=lr),x.init(e,t),e._zod.onattach.push(n=>{const o=n._zod.bag;o.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),ni=l("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=dr),x.init(e,t)}),oi=l("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=pr),x.init(e,t),e._zod.check=n=>{const o=n.value.split("/");try{if(o.length!==2)throw new Error;const[r,i]=o;if(!i)throw new Error;const s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Vt(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const ri=l("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=fr),x.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Vt(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function ii(e){if(!Ut.test(e))return!1;const t=e.replace(/[-_]/g,o=>o==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Vt(n)}const si=l("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Ut),x.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{ii(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),ai=l("$ZodE164",(e,t)=>{t.pattern??(t.pattern=mr),x.init(e,t)});function ci(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[o]=n;if(!o)return!1;const r=JSON.parse(atob(o));return!("typ"in r&&(r==null?void 0:r.typ)!=="JWT"||!r.alg||t&&(!("alg"in r)||r.alg!==t))}catch{return!1}}const ui=l("$ZodJWT",(e,t)=>{x.init(e,t),e._zod.check=n=>{ci(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Wt=l("$ZodNumber",(e,t)=>{I.init(e,t),e._zod.pattern=e._zod.bag.pattern??wr,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const r=n.value;if(typeof r=="number"&&!Number.isNaN(r)&&Number.isFinite(r))return n;const i=typeof r=="number"?Number.isNaN(r)?"NaN":Number.isFinite(r)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:r,inst:e,...i?{received:i}:{}}),n}}),li=l("$ZodNumber",(e,t)=>{xr.init(e,t),Wt.init(e,t)}),di=l("$ZodBoolean",(e,t)=>{I.init(e,t),e._zod.pattern=kr,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=!!n.value}catch{}const r=n.value;return typeof r=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:r,inst:e}),n}}),pi=l("$ZodUnknown",(e,t)=>{I.init(e,t),e._zod.parse=n=>n}),fi=l("$ZodNever",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function qt(e,t,n){e.issues.length&&t.issues.push(...pe(n,e.issues)),t.value[n]=e.value}const hi=l("$ZodArray",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!Array.isArray(r))return n.issues.push({expected:"array",code:"invalid_type",input:r,inst:e}),n;n.value=Array(r.length);const i=[];for(let s=0;s<r.length;s++){const a=r[s],c=t.element._zod.run({value:a,issues:[]},o);c instanceof Promise?i.push(c.then(u=>qt(u,n,s))):qt(c,n,s)}return i.length?Promise.all(i).then(()=>n):n}});function Oe(e,t,n,o){e.issues.length&&t.issues.push(...pe(n,e.issues)),e.value===void 0?n in o&&(t.value[n]=void 0):t.value[n]=e.value}function Yt(e){var o,r,i,s;const t=Object.keys(e.shape);for(const a of t)if(!((s=(i=(r=(o=e.shape)==null?void 0:o[a])==null?void 0:r._zod)==null?void 0:i.traits)!=null&&s.has("$ZodType")))throw new Error(`Invalid element at key "${a}": expected a Zod schema`);const n=Po(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function Ht(e,t,n,o,r,i){const s=[],a=r.keySet,c=r.catchall._zod,u=c.def.type;for(const d of Object.keys(t)){if(a.has(d))continue;if(u==="never"){s.push(d);continue}const h=c.run({value:t[d],issues:[]},o);h instanceof Promise?e.push(h.then(f=>Oe(f,n,d,t))):Oe(h,n,d,t)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:i}),e.length?Promise.all(e).then(()=>n):n}const mi=l("$ZodObject",(e,t)=>{I.init(e,t);const n=Object.getOwnPropertyDescriptor(t,"shape");if(!(n!=null&&n.get)){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const o=Qe(()=>Yt(t));z(e._zod,"propValues",()=>{const a=t.shape,c={};for(const u in a){const d=a[u]._zod;if(d.values){c[u]??(c[u]=new Set);for(const h of d.values)c[u].add(h)}}return c});const r=Ze,i=t.catchall;let s;e._zod.parse=(a,c)=>{s??(s=o.value);const u=a.value;if(!r(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),a;a.value={};const d=[],h=s.shape;for(const f of s.keys){const v=h[f]._zod.run({value:u[f],issues:[]},c);v instanceof Promise?d.push(v.then(y=>Oe(y,a,f,u))):Oe(v,a,f,u)}return i?Ht(d,u,a,c,o.value,e):d.length?Promise.all(d).then(()=>a):a}}),gi=l("$ZodObjectJIT",(e,t)=>{mi.init(e,t);const n=e._zod.parse,o=Qe(()=>Yt(t)),r=f=>{const m=new Dr(["shape","payload","ctx"]),v=o.value,y=$=>{const P=Ct($);return`shape[${P}]._zod.run({ value: input[${P}], issues: [] }, ctx)`};m.write("const input = payload.value;");const E=Object.create(null);let S=0;for(const $ of v.keys)E[$]=`key_${S++}`;m.write("const newResult = {};");for(const $ of v.keys){const P=E[$],C=Ct($);m.write(`const ${P} = ${y($)};`),m.write(`
        if (${P}.issues.length) {
          payload.issues = payload.issues.concat(${P}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${C}, ...iss.path] : [${C}]
          })));
        }
        
        
        if (${P}.value === undefined) {
          if (${C} in input) {
            newResult[${C}] = undefined;
          }
        } else {
          newResult[${C}] = ${P}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");const b=m.compile();return($,P)=>b(f,$,P)};let i;const s=Ze,a=!Pt.jitless,u=a&&Zo.value,d=t.catchall;let h;e._zod.parse=(f,m)=>{h??(h=o.value);const v=f.value;return s(v)?a&&u&&(m==null?void 0:m.async)===!1&&m.jitless!==!0?(i||(i=r(t.shape)),f=i(f,m),d?Ht([],v,f,m,h,e):f):n(f,m):(f.issues.push({expected:"object",code:"invalid_type",input:v,inst:e}),f)}});function Jt(e,t,n,o){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const r=e.filter(i=>!de(i));return r.length===1?(t.value=r[0].value,r[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(i=>i.issues.map(s=>Q(s,o,J())))}),t)}const vi=l("$ZodUnion",(e,t)=>{I.init(e,t),z(e._zod,"optin",()=>t.options.some(r=>r._zod.optin==="optional")?"optional":void 0),z(e._zod,"optout",()=>t.options.some(r=>r._zod.optout==="optional")?"optional":void 0),z(e._zod,"values",()=>{if(t.options.every(r=>r._zod.values))return new Set(t.options.flatMap(r=>Array.from(r._zod.values)))}),z(e._zod,"pattern",()=>{if(t.options.every(r=>r._zod.pattern)){const r=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${r.map(i=>tt(i.source)).join("|")})$`)}});const n=t.options.length===1,o=t.options[0]._zod.run;e._zod.parse=(r,i)=>{if(n)return o(r,i);let s=!1;const a=[];for(const c of t.options){const u=c._zod.run({value:r.value,issues:[]},i);if(u instanceof Promise)a.push(u),s=!0;else{if(u.issues.length===0)return u;a.push(u)}}return s?Promise.all(a).then(c=>Jt(c,r,e,i)):Jt(a,r,e,i)}}),_i=l("$ZodIntersection",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{const r=n.value,i=t.left._zod.run({value:r,issues:[]},o),s=t.right._zod.run({value:r,issues:[]},o);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,u])=>Xt(n,c,u)):Xt(n,i,s)}});function st(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(ue(e)&&ue(t)){const n=Object.keys(t),o=Object.keys(e).filter(i=>n.indexOf(i)!==-1),r={...e,...t};for(const i of o){const s=st(e[i],t[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};r[i]=s.data}return{valid:!0,data:r}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let o=0;o<e.length;o++){const r=e[o],i=t[o],s=st(r,i);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Xt(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),de(e))return e;const o=st(t.value,n.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const yi=l("$ZodRecord",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!ue(r))return n.issues.push({expected:"record",code:"invalid_type",input:r,inst:e}),n;const i=[];if(t.keyType._zod.values){const s=t.keyType._zod.values;n.value={};for(const c of s)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const u=t.valueType._zod.run({value:r[c],issues:[]},o);u instanceof Promise?i.push(u.then(d=>{d.issues.length&&n.issues.push(...pe(c,d.issues)),n.value[c]=d.value})):(u.issues.length&&n.issues.push(...pe(c,u.issues)),n.value[c]=u.value)}let a;for(const c in r)s.has(c)||(a=a??[],a.push(c));a&&a.length>0&&n.issues.push({code:"unrecognized_keys",input:r,inst:e,keys:a})}else{n.value={};for(const s of Reflect.ownKeys(r)){if(s==="__proto__")continue;const a=t.keyType._zod.run({value:s,issues:[]},o);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){n.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(u=>Q(u,o,J())),input:s,path:[s],inst:e}),n.value[a.value]=a.value;continue}const c=t.valueType._zod.run({value:r[s],issues:[]},o);c instanceof Promise?i.push(c.then(u=>{u.issues.length&&n.issues.push(...pe(s,u.issues)),n.value[a.value]=u.value})):(c.issues.length&&n.issues.push(...pe(s,c.issues)),n.value[a.value]=c.value)}}return i.length?Promise.all(i).then(()=>n):n}}),bi=l("$ZodEnum",(e,t)=>{I.init(e,t);const n=Eo(t.entries),o=new Set(n);e._zod.values=o,e._zod.pattern=new RegExp(`^(${n.filter(r=>Ao.has(typeof r)).map(r=>typeof r=="string"?le(r):r.toString()).join("|")})$`),e._zod.parse=(r,i)=>{const s=r.value;return o.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),wi=l("$ZodLiteral",(e,t)=>{if(I.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?le(n):n?le(n.toString()):String(n)).join("|")})$`),e._zod.parse=(n,o)=>{const r=n.value;return e._zod.values.has(r)||n.issues.push({code:"invalid_value",values:t.values,input:r,inst:e}),n}}),ki=l("$ZodTransform",(e,t)=>{I.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new At(e.constructor.name);const r=t.transform(n.value,n);if(o.async)return(r instanceof Promise?r:Promise.resolve(r)).then(s=>(n.value=s,n));if(r instanceof Promise)throw new ce;return n.value=r,n}});function Qt(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const $i=l("$ZodOptional",(e,t)=>{I.init(e,t),e._zod.optin="optional",e._zod.optout="optional",z(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),z(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${tt(n.source)})?$`):void 0}),e._zod.parse=(n,o)=>{if(t.innerType._zod.optin==="optional"){const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>Qt(i,n.value)):Qt(r,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,o)}}),zi=l("$ZodNullable",(e,t)=>{I.init(e,t),z(e._zod,"optin",()=>t.innerType._zod.optin),z(e._zod,"optout",()=>t.innerType._zod.optout),z(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${tt(n.source)}|null)$`):void 0}),z(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,o)=>n.value===null?n:t.innerType._zod.run(n,o)}),Si=l("$ZodDefault",(e,t)=>{I.init(e,t),e._zod.optin="optional",z(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);if(n.value===void 0)return n.value=t.defaultValue,n;const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>en(i,t)):en(r,t)}});function en(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const xi=l("$ZodPrefault",(e,t)=>{I.init(e,t),e._zod.optin="optional",z(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>(o.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,o))}),Ei=l("$ZodNonOptional",(e,t)=>{I.init(e,t),z(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(o=>o!==void 0)):void 0}),e._zod.parse=(n,o)=>{const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>tn(i,e)):tn(r,e)}});function tn(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Ii=l("$ZodCatch",(e,t)=>{I.init(e,t),z(e._zod,"optin",()=>t.innerType._zod.optin),z(e._zod,"optout",()=>t.innerType._zod.optout),z(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(s=>Q(s,o,J()))},input:n.value}),n.issues=[]),n)):(n.value=r.value,r.issues.length&&(n.value=t.catchValue({...n,error:{issues:r.issues.map(i=>Q(i,o,J()))},input:n.value}),n.issues=[]),n)}}),Zi=l("$ZodPipe",(e,t)=>{I.init(e,t),z(e._zod,"values",()=>t.in._zod.values),z(e._zod,"optin",()=>t.in._zod.optin),z(e._zod,"optout",()=>t.out._zod.optout),z(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,o)=>{if(o.direction==="backward"){const i=t.out._zod.run(n,o);return i instanceof Promise?i.then(s=>Te(s,t.in,o)):Te(i,t.in,o)}const r=t.in._zod.run(n,o);return r instanceof Promise?r.then(i=>Te(i,t.out,o)):Te(r,t.out,o)}});function Te(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const Ai=l("$ZodReadonly",(e,t)=>{I.init(e,t),z(e._zod,"propValues",()=>t.innerType._zod.propValues),z(e._zod,"values",()=>t.innerType._zod.values),z(e._zod,"optin",()=>t.innerType._zod.optin),z(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(nn):nn(r)}});function nn(e){return e.value=Object.freeze(e.value),e}const Pi=l("$ZodCustom",(e,t)=>{O.init(e,t),I.init(e,t),e._zod.parse=(n,o)=>n,e._zod.check=n=>{const o=n.value,r=t.fn(o);if(r instanceof Promise)return r.then(i=>on(i,n,o,e));on(r,n,o,e)}});function on(e,t,n,o){if(!e){const r={code:"custom",input:n,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(r.params=o._zod.def.params),t.issues.push(we(r))}}class ji{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const o=n[0];if(this._map.set(t,o),o&&typeof o=="object"&&"id"in o){if(this._idmap.has(o.id))throw new Error(`ID ${o.id} already exists in the registry`);this._idmap.set(o.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const o={...this.get(n)??{}};delete o.id;const r={...o,...this._map.get(t)};return Object.keys(r).length?r:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Ci(){return new ji}const Le=Ci();function Oi(e,t){return new e({type:"string",...g(t)})}function Ti(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...g(t)})}function rn(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...g(t)})}function Li(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...g(t)})}function Di(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...g(t)})}function Fi(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...g(t)})}function Ri(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...g(t)})}function Ui(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...g(t)})}function Mi(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...g(t)})}function Bi(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...g(t)})}function Ni(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...g(t)})}function Ki(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...g(t)})}function Gi(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...g(t)})}function Vi(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...g(t)})}function Wi(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...g(t)})}function qi(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...g(t)})}function Yi(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...g(t)})}function Hi(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...g(t)})}function Ji(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...g(t)})}function Xi(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...g(t)})}function Qi(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...g(t)})}function es(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...g(t)})}function ts(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...g(t)})}function ns(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...g(t)})}function os(e,t){return new e({type:"string",format:"date",check:"string_format",...g(t)})}function rs(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...g(t)})}function is(e,t){return new e({type:"string",format:"duration",check:"string_format",...g(t)})}function ss(e,t){return new e({type:"number",checks:[],...g(t)})}function as(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...g(t)})}function cs(e,t){return new e({type:"boolean",...g(t)})}function us(e){return new e({type:"unknown"})}function ls(e,t){return new e({type:"never",...g(t)})}function sn(e,t){return new Kt({check:"less_than",...g(t),value:e,inclusive:!1})}function at(e,t){return new Kt({check:"less_than",...g(t),value:e,inclusive:!0})}function an(e,t){return new Gt({check:"greater_than",...g(t),value:e,inclusive:!1})}function ct(e,t){return new Gt({check:"greater_than",...g(t),value:e,inclusive:!0})}function cn(e,t){return new Sr({check:"multiple_of",...g(t),value:e})}function un(e,t){return new Er({check:"max_length",...g(t),maximum:e})}function De(e,t){return new Ir({check:"min_length",...g(t),minimum:e})}function ln(e,t){return new Zr({check:"length_equals",...g(t),length:e})}function ds(e,t){return new Ar({check:"string_format",format:"regex",...g(t),pattern:e})}function ps(e){return new Pr({check:"string_format",format:"lowercase",...g(e)})}function fs(e){return new jr({check:"string_format",format:"uppercase",...g(e)})}function hs(e,t){return new Cr({check:"string_format",format:"includes",...g(t),includes:e})}function ms(e,t){return new Or({check:"string_format",format:"starts_with",...g(t),prefix:e})}function gs(e,t){return new Tr({check:"string_format",format:"ends_with",...g(t),suffix:e})}function ke(e){return new Lr({check:"overwrite",tx:e})}function vs(e){return ke(t=>t.normalize(e))}function _s(){return ke(e=>e.trim())}function ys(){return ke(e=>e.toLowerCase())}function bs(){return ke(e=>e.toUpperCase())}function ws(e,t,n){return new e({type:"array",element:t,...g(n)})}function ks(e,t,n){return new e({type:"custom",check:"custom",fn:t,...g(n)})}function $s(e){const t=zs(n=>(n.addIssue=o=>{if(typeof o=="string")n.issues.push(we(o,n.value,t._zod.def));else{const r=o;r.fatal&&(r.continue=!1),r.code??(r.code="custom"),r.input??(r.input=n.value),r.inst??(r.inst=t),r.continue??(r.continue=!t._zod.def.abort),n.issues.push(we(r))}},e(n.value,n)));return t}function zs(e,t){const n=new O({check:"custom",...g(t)});return n._zod.check=e,n}const Ss=l("ZodISODateTime",(e,t)=>{Hr.init(e,t),Z.init(e,t)});function xs(e){return ns(Ss,e)}const Es=l("ZodISODate",(e,t)=>{Jr.init(e,t),Z.init(e,t)});function Is(e){return os(Es,e)}const Zs=l("ZodISOTime",(e,t)=>{Xr.init(e,t),Z.init(e,t)});function As(e){return rs(Zs,e)}const Ps=l("ZodISODuration",(e,t)=>{Qr.init(e,t),Z.init(e,t)});function js(e){return is(Ps,e)}const U=l("ZodError",(e,t)=>{Dt.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Mo(e,n)},flatten:{value:n=>Uo(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,Xe,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,Xe,2)}},isEmpty:{get(){return e.issues.length===0}}})},{Parent:Error}),Cs=ot(U),Os=rt(U),Ts=Pe(U),Ls=je(U),Ds=Ko(U),Fs=Go(U),Rs=Vo(U),Us=Wo(U),Ms=qo(U),Bs=Yo(U),Ns=Ho(U),Ks=Jo(U),A=l("ZodType",(e,t)=>(I.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(re(t,{checks:[...t.checks??[],...n.map(o=>typeof o=="function"?{_zod:{check:o,def:{check:"custom"},onattach:[]}}:o)]})),e.clone=(n,o)=>X(e,n,o),e.brand=()=>e,e.register=((n,o)=>(n.add(e,o),e)),e.parse=(n,o)=>Cs(e,n,o,{callee:e.parse}),e.safeParse=(n,o)=>Ts(e,n,o),e.parseAsync=async(n,o)=>Os(e,n,o,{callee:e.parseAsync}),e.safeParseAsync=async(n,o)=>Ls(e,n,o),e.spa=e.safeParseAsync,e.encode=(n,o)=>Ds(e,n,o),e.decode=(n,o)=>Fs(e,n,o),e.encodeAsync=async(n,o)=>Rs(e,n,o),e.decodeAsync=async(n,o)=>Us(e,n,o),e.safeEncode=(n,o)=>Ms(e,n,o),e.safeDecode=(n,o)=>Bs(e,n,o),e.safeEncodeAsync=async(n,o)=>Ns(e,n,o),e.safeDecodeAsync=async(n,o)=>Ks(e,n,o),e.refine=(n,o)=>e.check(Fa(n,o)),e.superRefine=n=>e.check(Ra(n)),e.overwrite=n=>e.check(ke(n)),e.optional=()=>_n(e),e.nullable=()=>yn(e),e.nullish=()=>_n(yn(e)),e.nonoptional=n=>Pa(e,n),e.array=()=>K(e),e.or=n=>ut([e,n]),e.and=n=>ba(e,n),e.transform=n=>wn(e,Sa(n)),e.default=n=>Ia(e,n),e.prefault=n=>Aa(e,n),e.catch=n=>Ca(e,n),e.pipe=n=>wn(e,n),e.readonly=()=>La(e),e.describe=n=>{const o=e.clone();return Le.add(o,{description:n}),o},Object.defineProperty(e,"description",{get(){var n;return(n=Le.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Le.get(e);const o=e.clone();return Le.add(o,n[0]),o},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),dn=l("_ZodString",(e,t)=>{it.init(e,t),A.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...o)=>e.check(ds(...o)),e.includes=(...o)=>e.check(hs(...o)),e.startsWith=(...o)=>e.check(ms(...o)),e.endsWith=(...o)=>e.check(gs(...o)),e.min=(...o)=>e.check(De(...o)),e.max=(...o)=>e.check(un(...o)),e.length=(...o)=>e.check(ln(...o)),e.nonempty=(...o)=>e.check(De(1,...o)),e.lowercase=o=>e.check(ps(o)),e.uppercase=o=>e.check(fs(o)),e.trim=()=>e.check(_s()),e.normalize=(...o)=>e.check(vs(...o)),e.toLowerCase=()=>e.check(ys()),e.toUpperCase=()=>e.check(bs())}),Gs=l("ZodString",(e,t)=>{it.init(e,t),dn.init(e,t),e.email=n=>e.check(Ti(Vs,n)),e.url=n=>e.check(Ui(Ws,n)),e.jwt=n=>e.check(ts(ca,n)),e.emoji=n=>e.check(Mi(qs,n)),e.guid=n=>e.check(rn(pn,n)),e.uuid=n=>e.check(Li(Fe,n)),e.uuidv4=n=>e.check(Di(Fe,n)),e.uuidv6=n=>e.check(Fi(Fe,n)),e.uuidv7=n=>e.check(Ri(Fe,n)),e.nanoid=n=>e.check(Bi(Ys,n)),e.guid=n=>e.check(rn(pn,n)),e.cuid=n=>e.check(Ni(Hs,n)),e.cuid2=n=>e.check(Ki(Js,n)),e.ulid=n=>e.check(Gi(Xs,n)),e.base64=n=>e.check(Xi(ia,n)),e.base64url=n=>e.check(Qi(sa,n)),e.xid=n=>e.check(Vi(Qs,n)),e.ksuid=n=>e.check(Wi(ea,n)),e.ipv4=n=>e.check(qi(ta,n)),e.ipv6=n=>e.check(Yi(na,n)),e.cidrv4=n=>e.check(Hi(oa,n)),e.cidrv6=n=>e.check(Ji(ra,n)),e.e164=n=>e.check(es(aa,n)),e.datetime=n=>e.check(xs(n)),e.date=n=>e.check(Is(n)),e.time=n=>e.check(As(n)),e.duration=n=>e.check(js(n))});function N(e){return Oi(Gs,e)}const Z=l("ZodStringFormat",(e,t)=>{x.init(e,t),dn.init(e,t)}),Vs=l("ZodEmail",(e,t)=>{Mr.init(e,t),Z.init(e,t)}),pn=l("ZodGUID",(e,t)=>{Rr.init(e,t),Z.init(e,t)}),Fe=l("ZodUUID",(e,t)=>{Ur.init(e,t),Z.init(e,t)}),Ws=l("ZodURL",(e,t)=>{Br.init(e,t),Z.init(e,t)}),qs=l("ZodEmoji",(e,t)=>{Nr.init(e,t),Z.init(e,t)}),Ys=l("ZodNanoID",(e,t)=>{Kr.init(e,t),Z.init(e,t)}),Hs=l("ZodCUID",(e,t)=>{Gr.init(e,t),Z.init(e,t)}),Js=l("ZodCUID2",(e,t)=>{Vr.init(e,t),Z.init(e,t)}),Xs=l("ZodULID",(e,t)=>{Wr.init(e,t),Z.init(e,t)}),Qs=l("ZodXID",(e,t)=>{qr.init(e,t),Z.init(e,t)}),ea=l("ZodKSUID",(e,t)=>{Yr.init(e,t),Z.init(e,t)}),ta=l("ZodIPv4",(e,t)=>{ei.init(e,t),Z.init(e,t)}),na=l("ZodIPv6",(e,t)=>{ti.init(e,t),Z.init(e,t)}),oa=l("ZodCIDRv4",(e,t)=>{ni.init(e,t),Z.init(e,t)}),ra=l("ZodCIDRv6",(e,t)=>{oi.init(e,t),Z.init(e,t)}),ia=l("ZodBase64",(e,t)=>{ri.init(e,t),Z.init(e,t)}),sa=l("ZodBase64URL",(e,t)=>{si.init(e,t),Z.init(e,t)}),aa=l("ZodE164",(e,t)=>{ai.init(e,t),Z.init(e,t)}),ca=l("ZodJWT",(e,t)=>{ui.init(e,t),Z.init(e,t)}),fn=l("ZodNumber",(e,t)=>{Wt.init(e,t),A.init(e,t),e.gt=(o,r)=>e.check(an(o,r)),e.gte=(o,r)=>e.check(ct(o,r)),e.min=(o,r)=>e.check(ct(o,r)),e.lt=(o,r)=>e.check(sn(o,r)),e.lte=(o,r)=>e.check(at(o,r)),e.max=(o,r)=>e.check(at(o,r)),e.int=o=>e.check(hn(o)),e.safe=o=>e.check(hn(o)),e.positive=o=>e.check(an(0,o)),e.nonnegative=o=>e.check(ct(0,o)),e.negative=o=>e.check(sn(0,o)),e.nonpositive=o=>e.check(at(0,o)),e.multipleOf=(o,r)=>e.check(cn(o,r)),e.step=(o,r)=>e.check(cn(o,r)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function ua(e){return ss(fn,e)}const la=l("ZodNumberFormat",(e,t)=>{li.init(e,t),fn.init(e,t)});function hn(e){return as(la,e)}const da=l("ZodBoolean",(e,t)=>{di.init(e,t),A.init(e,t)});function pa(e){return cs(da,e)}const fa=l("ZodUnknown",(e,t)=>{pi.init(e,t),A.init(e,t)});function mn(){return us(fa)}const ha=l("ZodNever",(e,t)=>{fi.init(e,t),A.init(e,t)});function ma(e){return ls(ha,e)}const ga=l("ZodArray",(e,t)=>{hi.init(e,t),A.init(e,t),e.element=t.element,e.min=(n,o)=>e.check(De(n,o)),e.nonempty=n=>e.check(De(1,n)),e.max=(n,o)=>e.check(un(n,o)),e.length=(n,o)=>e.check(ln(n,o)),e.unwrap=()=>e.element});function K(e,t){return ws(ga,e,t)}const va=l("ZodObject",(e,t)=>{gi.init(e,t),A.init(e,t),z(e,"shape",()=>t.shape),e.keyof=()=>Re(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:mn()}),e.loose=()=>e.clone({...e._zod.def,catchall:mn()}),e.strict=()=>e.clone({...e._zod.def,catchall:ma()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>To(e,n),e.safeExtend=n=>Lo(e,n),e.merge=n=>Do(e,n),e.pick=n=>Co(e,n),e.omit=n=>Oo(e,n),e.partial=(...n)=>Fo(vn,e,n[0]),e.required=(...n)=>Ro(bn,e,n[0])});function fe(e,t){const n={type:"object",shape:e??{},...g(t)};return new va(n)}const _a=l("ZodUnion",(e,t)=>{vi.init(e,t),A.init(e,t),e.options=t.options});function ut(e,t){return new _a({type:"union",options:e,...g(t)})}const ya=l("ZodIntersection",(e,t)=>{_i.init(e,t),A.init(e,t)});function ba(e,t){return new ya({type:"intersection",left:e,right:t})}const wa=l("ZodRecord",(e,t)=>{yi.init(e,t),A.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function gn(e,t,n){return new wa({type:"record",keyType:e,valueType:t,...g(n)})}const lt=l("ZodEnum",(e,t)=>{bi.init(e,t),A.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(o,r)=>{const i={};for(const s of o)if(n.has(s))i[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new lt({...t,checks:[],...g(r),entries:i})},e.exclude=(o,r)=>{const i={...t.entries};for(const s of o)if(n.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new lt({...t,checks:[],...g(r),entries:i})}});function Re(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,o])):e;return new lt({type:"enum",entries:n,...g(t)})}const ka=l("ZodLiteral",(e,t)=>{wi.init(e,t),A.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function $a(e,t){return new ka({type:"literal",values:Array.isArray(e)?e:[e],...g(t)})}const za=l("ZodTransform",(e,t)=>{ki.init(e,t),A.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new At(e.constructor.name);n.addIssue=i=>{if(typeof i=="string")n.issues.push(we(i,n.value,t));else{const s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),n.issues.push(we(s))}};const r=t.transform(n.value,n);return r instanceof Promise?r.then(i=>(n.value=i,n)):(n.value=r,n)}});function Sa(e){return new za({type:"transform",transform:e})}const vn=l("ZodOptional",(e,t)=>{$i.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function _n(e){return new vn({type:"optional",innerType:e})}const xa=l("ZodNullable",(e,t)=>{zi.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function yn(e){return new xa({type:"nullable",innerType:e})}const Ea=l("ZodDefault",(e,t)=>{Si.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Ia(e,t){return new Ea({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Tt(t)}})}const Za=l("ZodPrefault",(e,t)=>{xi.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Aa(e,t){return new Za({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Tt(t)}})}const bn=l("ZodNonOptional",(e,t)=>{Ei.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Pa(e,t){return new bn({type:"nonoptional",innerType:e,...g(t)})}const ja=l("ZodCatch",(e,t)=>{Ii.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Ca(e,t){return new ja({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Oa=l("ZodPipe",(e,t)=>{Zi.init(e,t),A.init(e,t),e.in=t.in,e.out=t.out});function wn(e,t){return new Oa({type:"pipe",in:e,out:t})}const Ta=l("ZodReadonly",(e,t)=>{Ai.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function La(e){return new Ta({type:"readonly",innerType:e})}const Da=l("ZodCustom",(e,t)=>{Pi.init(e,t),A.init(e,t)});function Fa(e,t={}){return ks(Da,e,t)}function Ra(e){return $s(e)}const dt=new Set(["files","gap","headline","hidden","info","line","pages","users"]),kn={text:e=>W(e,`"${e.label}", single-line plain text without line breaks or formatting`),textarea:e=>W(e,`"${e.label}", multi-line text with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),markdown:e=>W(e,`"${e.label}", multi-line text with Markdown formatting`),slug:e=>W(e,`"${e.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`),url:e=>W(e,`"${e.label}", a valid URL starting with http:// or https://`),email:e=>W(e,`"${e.label}", a valid email address`),password:e=>W(e,`"${e.label}", a secure password (not for actual use)`),tel:e=>W(e,`"${e.label}", a telephone number in appropriate format for the context`),writer:e=>W(e,`"${e.label}" (WYSIWYG), ${e.inline===!0?"text with inline formatting only (bold, italic, underline, code, links, email, sub, sup). NO wrapping paragraph <p> tags allowed.":"text wrapped in paragraph <p> tags (can contain one or multiple paragraphs). Inline formatting (bold, italic, underline, code, links, email, sub, sup) is allowed."}`),list:e=>N().describe(`"${e.label}" (WYSIWYG), HTML list wrapped in <ul> or <ol>. Use <li> for items with inline formatting (bold, italic, underline, code, links, email, sub, sup).`),number:e=>zn(e),range:e=>zn(e),toggle:e=>pa().describe(`"${e.label}", a boolean`),select:e=>ft(e),radio:e=>ft(e),toggles:e=>ft(e),checkboxes:e=>ht(e),multiselect:e=>ht(e),tags:e=>ht(e),date:e=>N().describe(`"${e.label}", a date ${e.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:e=>N().describe(`"${e.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),color:e=>N().describe(`"${e.label}", a color value in hex, rgb or hsl format`),link:e=>N().describe(`"${e.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),structure:e=>{const t=$n(e);return t?K(t).describe(`"${e.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`):K(gn(N())).describe(`"${e.label}", repeatable structured data based on expected content structure`)},object:e=>{const t=$n(e);return t?t.describe(`"${e.label}", structured data containing the defined sub-fields with appropriate content`):gn(N()).describe(`"${e.label}", object data based on expected content structure`)},entries:e=>{const{field:t}=e.field,n={...t,name:"entry",label:e.label||"Entry"},o=kn[t.type],r=o(n);let i=K(r);return e.min!=null&&(i=i.min(e.min)),e.max!=null&&(i=i.max(e.max)),i.describe(`"${e.label}", multiple entries of ${t.type} values${e.min!=null||e.max!=null?" within the defined count range":""}`)}};function pt(e){var o;const t=kn[e.type];let n=t(e);return e.required===!0&&(n._def.typeName==="ZodString"?((o=n._def.checks)==null?void 0:o.some(r=>r.kind==="min"))!==!0&&(n=n.min(1)):n._def.typeName==="ZodArray"&&n._def.minLength==null&&(n=n.min(1))),n}function $n(e){if(typeof e.fields!="object"||e.fields===null)return;const t={};for(const[n,o]of Object.entries(e.fields))o.disabled||o.hidden||dt.has(o.type)||(t[n]=pt({...o,name:n}));return fe(t)}function W(e,t){let n=N();return e.minlength!=null&&(n=n.min(e.minlength)),e.maxlength!=null&&(n=n.max(e.maxlength)),n.describe(t)}function zn(e){let t=ua();return e.min!=null&&(t=t.min(e.min)),e.max!=null&&(t=t.max(e.max)),t.describe(`"${e.label}", a numeric value${e.min!=null||e.max!=null?" within the defined range":""}`)}function ft(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?Re(t).describe(`"${e.label}", single selection value based on the predefined options`):N().describe(`"${e.label}", single selection value`)}function ht(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?K(Re(t)).describe(`"${e.label}", one ore many values based on the predefined options`):K(N()).describe(`"${e.label}", multiple selection values`)}function Sn(e){const{name:t,type:n,fields:o}=e;if(!o||Object.keys(o).length===0)return;const r={};for(const i of Object.values(o)){if(i.disabled||i.hidden||dt.has(i.type))continue;const s=pt(i);r[i.name]=s}return fe({type:$a(n),content:fe(r)}).describe(`Kirby block: ${t}`)}function Ua(e){if(!Array.isArray(e)||e.length===0)throw new Error("Invalid fieldsets configuration");const t=e.map(Sn).filter(Boolean);return ut(t).describe("Union of all Kirby block types")}let Ue,$e;function Me(){async function e(){return Ue||$e||($e=window.panel.api.get(ho).then(o=>(Ue=o,$e=void 0,Ue)),$e)}async function t(o){let r=await e();const{config:i}=await V();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(r=r.filter(s=>!i.excludedBlocks.includes(s.type))),o.fieldsets){const s=Array.isArray(o.fieldsets)?o.fieldsets:Object.keys(o.fieldsets);r=r.filter(a=>s.includes(a.type))}return Ua(r)}function n(o){return o.isHidden??(o.isHidden=!1),o.id??(o.id=crypto.randomUUID()),o}return{getFieldsets:e,getZodSchema:t,normalizeBlock:n}}function Ma(e,t,n,o){let r;const i=()=>{r==null||r(),r=void 0},s=(u,d,h,f)=>(u.addEventListener(d,h,f),()=>u.removeEventListener(d,h,f)),a=qe(()=>Ba(e),u=>{i(),u&&(r=s(u,t,n,o))},{immediate:!0,flush:"post"}),c=()=>{a(),i()};return Jn()&&eo(c),c}function Ba(e){const t=We(e);return(t==null?void 0:t.$el)??t}function xn(){return wo({accept:[...He,"application/pdf"].join(",")})}function Na(e){const t=new Set;for(const n of e)for(const o of n)typeof o=="string"&&o.trim()&&t.add(o);return[...t]}function Ka(e,t){const n=e.map(Sn).filter(Boolean),o=n.length>1?ut(n):n[0];return fe({width:Re(t).describe('Column width fraction to use, e.g. "1/2"'),blocks:K(o).describe("Array of blocks contained in this column")})}function Ga(e,t){const n=Ka(e,t);return fe({columns:K(n).min(1).describe("Array of columns in this layout")})}function Va(e,t={}){if(!e||e.length===0)throw new Error("No fieldsets available for layout schema generation");const n=t.layouts??[["1/1"]],o=Na(n),r=Ga(e,o),i=n.map(s=>`"${s}"`).join(", ");return r.describe(`Kirby layout with columns and blocks. Available layout combinations: ${i}. Use these exact column width combinations when creating layouts.`)}function mt(){const{getFieldsets:e}=Me();async function t(o){let r=await e();const{config:i}=await V();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(r=r.filter(s=>!i.excludedBlocks.includes(s.type))),o.fieldsets){const s=Array.isArray(o.fieldsets)?o.fieldsets:Object.keys(o.fieldsets);r=r.filter(a=>s.includes(a.type))}return Va(r,o)}function n(o){return o.id??(o.id=crypto.randomUUID()),o.attrs??(o.attrs=[]),o.columns=(o.columns??[]).map(r=>(r.id??(r.id=crypto.randomUUID()),r.width??(r.width="1/1"),r.blocks=(r.blocks??[]).map(i=>(i.isHidden??(i.isHidden=!1),i.id??(i.id=crypto.randomUUID()),i)),r)),o}return{getZodSchema:t,normalizeLayout:n}}function Wa(e){return typeof e=="string"?`'${e}'`:new qa().serialize(e)}const qa=(function(){var t;class e{constructor(){Mn(this,t,new Map)}compare(o,r){const i=typeof o,s=typeof r;return i==="string"&&s==="string"?o.localeCompare(r):i==="number"&&s==="number"?o-r:String.prototype.localeCompare.call(this.serialize(o,!0),this.serialize(r,!0))}serialize(o,r){if(o===null)return"null";switch(typeof o){case"string":return r?o:`'${o}'`;case"bigint":return`${o}n`;case"object":return this.$object(o);case"function":return this.$function(o)}return String(o)}serializeObject(o){const r=Object.prototype.toString.call(o);if(r!=="[object Object]")return this.serializeBuiltInType(r.length<10?`unknown:${r}`:r.slice(8,-1),o);const i=o.constructor,s=i===Object||i===void 0?"":i.name;if(s!==""&&globalThis[s]===i)return this.serializeBuiltInType(s,o);if(typeof o.toJSON=="function"){const a=o.toJSON();return s+(a!==null&&typeof a=="object"?this.$object(a):`(${this.serialize(a)})`)}return this.serializeObjectEntries(s,Object.entries(o))}serializeBuiltInType(o,r){const i=this["$"+o];if(i)return i.call(this,r);if(typeof(r==null?void 0:r.entries)=="function")return this.serializeObjectEntries(o,r.entries());throw new Error(`Cannot serialize ${o}`)}serializeObjectEntries(o,r){const i=Array.from(r).sort((a,c)=>this.compare(a[0],c[0]));let s=`${o}{`;for(let a=0;a<i.length;a++){const[c,u]=i[a];s+=`${this.serialize(c,!0)}:${this.serialize(u)}`,a<i.length-1&&(s+=",")}return s+"}"}$object(o){let r=xe(this,t).get(o);return r===void 0&&(xe(this,t).set(o,`#${xe(this,t).size}`),r=this.serializeObject(o),xe(this,t).set(o,r)),r}$function(o){const r=Function.prototype.toString.call(o);return r.slice(-15)==="[native code] }"?`${o.name||""}()[native]`:`${o.name}(${o.length})${r.replace(/\s*\n\s*/g,"")}`}$Array(o){let r="[";for(let i=0;i<o.length;i++)r+=this.serialize(o[i]),i<o.length-1&&(r+=",");return r+"]"}$Date(o){try{return`Date(${o.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(o){return`ArrayBuffer[${new Uint8Array(o).join(",")}]`}$Set(o){return`Set${this.$Array(Array.from(o).sort((r,i)=>this.compare(r,i)))}`}$Map(o){return this.serializeObjectEntries("Map",o.entries())}}t=new WeakMap;for(const n of["Error","RegExp","URL"])e.prototype["$"+n]=function(o){return`${n}(${o})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])e.prototype["$"+n]=function(o){return`${n}[${o.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])e.prototype["$"+n]=function(o){return`${n}[${o.join("n,")}${o.length>0?"n":""}]`};return e})(),Ya=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Ha=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Ja="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",ie=[];class Xa{constructor(){G(this,"_data",new he);G(this,"_hash",new he([...Ya]));G(this,"_nDataBytes",0);G(this,"_minBufferSize",0)}finalize(t){t&&this._append(t);const n=this._nDataBytes*8,o=this._data.sigBytes*8;return this._data.words[o>>>5]|=128<<24-o%32,this._data.words[(o+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(o+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,n){const o=this._hash.words;let r=o[0],i=o[1],s=o[2],a=o[3],c=o[4],u=o[5],d=o[6],h=o[7];for(let f=0;f<64;f++){if(f<16)ie[f]=t[n+f]|0;else{const $=ie[f-15],P=($<<25|$>>>7)^($<<14|$>>>18)^$>>>3,C=ie[f-2],D=(C<<15|C>>>17)^(C<<13|C>>>19)^C>>>10;ie[f]=P+ie[f-7]+D+ie[f-16]}const m=c&u^~c&d,v=r&i^r&s^i&s,y=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),E=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),S=h+E+m+Ha[f]+ie[f],b=y+v;h=d,d=u,u=c,c=a+S|0,a=s,s=i,i=r,r=S+b|0}o[0]=o[0]+r|0,o[1]=o[1]+i|0,o[2]=o[2]+s|0,o[3]=o[3]+a|0,o[4]=o[4]+c|0,o[5]=o[5]+u|0,o[6]=o[6]+d|0,o[7]=o[7]+h|0}_append(t){typeof t=="string"&&(t=he.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let n,o=this._data.sigBytes/64;t?o=Math.ceil(o):o=Math.max((o|0)-this._minBufferSize,0);const r=o*16,i=Math.min(r*4,this._data.sigBytes);if(r){for(let s=0;s<r;s+=16)this._doProcessBlock(this._data.words,s);n=this._data.words.splice(0,r),this._data.sigBytes-=i}return new he(n,i)}}class he{constructor(t,n){G(this,"words");G(this,"sigBytes");t=this.words=t||[],this.sigBytes=n===void 0?t.length*4:n}static fromUtf8(t){const n=unescape(encodeURIComponent(t)),o=n.length,r=[];for(let i=0;i<o;i++)r[i>>>2]|=(n.charCodeAt(i)&255)<<24-i%4*8;return new he(r,o)}toBase64(){const t=[];for(let n=0;n<this.sigBytes;n+=3){const o=this.words[n>>>2]>>>24-n%4*8&255,r=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,i=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,s=o<<16|r<<8|i;for(let a=0;a<4&&n*8+a*6<this.sigBytes*8;a++)t.push(Ja.charAt(s>>>6*(3-a)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<t.sigBytes;n++){const o=t.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=o<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<t.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=t.words[n>>>2];this.sigBytes+=t.sigBytes}}function Qa(e){return new Xa().finalize(e).toBase64()}function ec(e){return Qa(Wa(e))}function En(...e){return`${mo}${ec([...e])}`}const In=50;function tc(){const e=En("history",window.location.hostname),t=_(JSON.parse(localStorage.getItem(e)||"[]")),n=_(""),o=_(-1);function r(s){if(!s||typeof s!="string"||!s.trim())return;const a=s.trim(),c=t.value.indexOf(a);c!==-1&&t.value.splice(c,1),t.value.unshift(a),t.value.length>In&&(t.value=t.value.slice(0,In)),localStorage.setItem(e,JSON.stringify(t.value)),o.value=-1}function i(s){if(t.value.length!==0){if(s==="up"){if(o.value+1<t.value.length)return o.value++,t.value[o.value]}else if(s==="down"){if(o.value>0)return o.value--,t.value[o.value];if(o.value===0)return o.value=-1,n.value}}}return{lastPrompt:n,currentIndex:o,addToHistory:r,navigateHistory:i}}const nc=Object.assign({inheritAttrs:!1},{__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String,default:void 0}},emits:["input","mounted"],setup(e,{emit:t}){const n=e,o=_(),r=H({get(){return n.value},set(i){t("input",i)}});return bt(()=>{t("mounted",o.value)}),{__sfc:!0,props:n,emit:t,textarea:o,text:r}}});var oc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",t._b({directives:[{name:"model",rawName:"v-model",value:o.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:t.sharedClass,domProps:{value:o.text},on:{input:function(r){r.target.composing||(o.text=r.target.value)}}},"textarea",t.$attrs,!1)),t._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:t.sharedClass,domProps:{textContent:t._s(`${t.value} `)}})])},rc=[],ic=ve(nc,oc,rc,!1,null,"a814ce2d");const sc=ic.exports,ac={__name:"Prompt",props:{fields:{type:Array,default:()=>[]},selection:{type:String,default:""},userPrompt:{type:String,default:""}},emits:["cancel","close","input","submit","success"],setup(e,{emit:t}){const n=e,o=ge(),r=w(),{lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:c}=tc(),u=_(),d=_(),h=_([]),f=_([]),m=_("append"),v=_(n.userPrompt||""),y=_();Ma(u,"keydown",b=>{if((b.metaKey||b.ctrlKey)&&b.key==="Enter"){if(b.preventDefault(),!v.value.trim()||n.fields.length>0&&f.value.length===0)return;E()}if(b.key==="ArrowUp"&&b.target.selectionStart===0||b.key==="ArrowDown"&&b.target.selectionStart===b.target.value.length){b.preventDefault(),b.key==="ArrowUp"&&s.value===-1&&(i.value=v.value);const $=c(b.key==="ArrowUp"?"up":"down");$!==void 0&&(v.value=$)}}),(async()=>{const b=await V();y.value=b.licenseStatus})();function E(){a(v.value),t("submit",{prompt:v.value,files:h.value,fields:f.value,append:m.value==="append"})}async function S(){const b=await xn();h.value=[...h.value,...b]}return{__sfc:!0,props:n,emit:t,_isKirby5:o,panel:r,lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:c,textarea:u,picklist:d,files:h,selectedFields:f,insertOption:m,prompt:v,licenseStatus:y,submit:E,pickFiles:S,LicensingButtonGroup:kt,AutoGrowTextarea:sc}}};var cc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(r){return o.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] focus-within:kai-outline focus-within:kai-outline-[2px] focus-within:kai-outline-[var(--color-focus,currentColor)]"},[n(o.AutoGrowTextarea,{attrs:{value:o.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:o.panel.t("johannschopplich.copilot.prompt.placeholder")+(t.selection?` (${o.panel.t("johannschopplich.copilot.prompt.selectionContext")})`:""),rows:"3"},on:{input:function(r){o.prompt=r},mounted:function(r){o.textarea=r}}}),n("div",{staticClass:"kai-flex kai-items-center kai-justify-between kai-px-2 kai-pb-2"},[n("k-button-group",{staticClass:"kai-gap-1"},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{theme:"empty",icon:"attachment",badge:o._isKirby5&&o.files.length>0?{theme:"notice",text:o.files.length}:void 0},on:{click:function(r){return o.pickFiles()}}}),o.files.length>0?n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(r){o.files=[]}}}):t._e()],1),n("div",{staticClass:"kai-flex kai-gap-2"},[t.fields.length>0?[n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.fields"),variant:"filled",badge:o.selectedFields.length>0?{theme:"info",text:o.selectedFields.length}:void 0,dropdown:""},on:{click:function(r){return o.picklist.toggle()}}}),n("k-picklist-dropdown",{ref:"picklist",attrs:{options:t.fields.map(r=>({value:r.name,text:r.label||r.name})),empty:!1,value:o.selectedFields},on:{input:function(r){o.selectedFields=r}}})]:t.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:[{value:"append",text:o.panel.t("johannschopplich.copilot.append")},{value:"replace",text:o.panel.t("johannschopplich.copilot.replace")}],empty:!1,value:o.insertOption},on:{input:function(r){o.insertOption=r}}}):t._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling",disabled:!o.prompt.trim()||t.fields.length>0&&o.selectedFields.length===0},on:{click:function(r){return o.submit()}}},[t._v(" "+t._s(o.panel.t("johannschopplich.copilot.generate"))+" ")])],2)],1),o.licenseStatus!==void 0?n(o.LicensingButtonGroup,{staticClass:"kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":o.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):t._e()],1)])},uc=[],lc=ve(ac,cc,uc,!1,null,null);const dc=lc.exports,pc={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};var Zn="vercel.ai.error",fc=Symbol.for(Zn),An,hc=class Bn extends Error{constructor({name:t,message:n,cause:o}){super(n),this[An]=!0,this.name=t,this.cause=o}static isInstance(t){return Bn.hasMarker(t,Zn)}static hasMarker(t,n){const o=Symbol.for(n);return t!=null&&typeof t=="object"&&o in t&&typeof t[o]=="boolean"&&t[o]===!0}};An=fc;var Pn=hc,jn="AI_InvalidArgumentError",Cn=`vercel.ai.error.${jn}`,mc=Symbol.for(Cn),On,gc=class extends Pn{constructor({message:e,cause:t,argument:n}){super({name:jn,message:e,cause:t}),this[On]=!0,this.argument=n}static isInstance(e){return Pn.hasMarker(e,Cn)}};On=mc;var vc=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{const r=()=>{const i=n.length,s=new Array(t);for(let a=0;a<t;a++)s[a]=n[Math.random()*i|0];return s.join("")};if(e==null)return r;if(n.includes(o))throw new gc({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return()=>`${e}${o}${r()}`};vc();function gt(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");const Tn={...pc},_c=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:Tn,setup(e){const t=e,n=ge(),o=w(),{t:r}=Kn(),{currentContent:i,update:s}=Ge(),a=_(),c=_(),u=_(),d=_(),h=_(),f=_(),m=_(),v=_(),y=_(),E=_(),S=_(),b=_(!1),$=_(!1),P=_(!1),C=_(),D=_(),M=_(),ze=_([]),ee=_([]),k=_();let T,B;const Be=H(()=>!$.value&&M.value!==void 0);qe(D,F=>{b.value&&h.value&&(F&&F!==u.value?localStorage.setItem(`${T}$prompt`,F):(!F||F===u.value)&&localStorage.removeItem(`${T}$prompt`))}),qe(P,F=>{b.value&&h.value&&(F?localStorage.setItem(`${T}$open`,"true"):localStorage.removeItem(`${T}$open`))}),(async()=>{var Se;const{load:F}=Gn(),[q,j]=await Promise.all([V(),F({parent:t.parent,name:t.name})]);if(a.value=r(j.label)||o.t("johannschopplich.copilot.label"),c.value=j.field??void 0,u.value=j.userPrompt??void 0,d.value=j.systemPrompt||q.config.systemPrompt||Je,h.value=j.storage,j.editable===!0&&ze.value.push("edit"),j.files===!0&&ze.value.push("files"),f.value=j.theme||"notice-icon",m.value=j.size||"md",v.value=ae.indexOf(j.logLevel&&ae.includes(j.logLevel)?j.logLevel:q.config.logLevel&&ae.includes(q.config.logLevel)?q.config.logLevel:zt),E.value=j.help?r(j.help):void 0,S.value=q.config,k.value=q.licenseStatus,j.files==="auto"&&j.modelFile){y.value=j.modelFile;const{mime:R,url:me}=j.modelFile;He.includes(R)&&fetch(me).then(Y=>Y.blob()).then(Y=>{ee.value=[Y]})}h.value&&((Se=c.value)!=null&&Se.name)&&(T=En(o.view.path,c.value.name.toLowerCase()),D.value=localStorage.getItem(`${T}$prompt`)||u.value||"",P.value=localStorage.getItem(`${T}$open`)==="true"||j.open,Xn(()=>{C.value&&P.value&&(C.value.open=!0)})),o.events.on("view.save",vt),b.value=!0})(),Qn(()=>{o.events.off("view.save",vt)});async function Ne(){if(!D.value){o.notification.error(o.t("johannschopplich.copilot.prompt.empty"));return}o.isLoading=!0,$.value=!0,M.value=i.value[c.value.name.toLowerCase()],B=new AbortController;const{getZodSchema:F,normalizeBlock:q}=Me(),{getZodSchema:j,normalizeLayout:Se}=mt();try{let R="",me=[];if(c.value.type==="layout"||c.value.type==="blocks"){const Y=await(c.value.type==="layout"?j:F)(c.value),{partialObjectStream:se,object:Tc}=await Et({userPrompt:D.value,systemPrompt:d.value,schema:Y,output:"array",files:ee.value,logLevel:v.value,abortSignal:B.signal});for await(const _t of se)!_t||!Array.isArray(_t)||await s({[c.value.name.toLowerCase()]:[...M.value,..._t.map(c.value.type==="layout"?Se:q)]},!1);me=await Tc}else{const{textStream:Y}=await xt({userPrompt:[`<response_format>
${go[c.value.type]||"text"}
</response_format>`,D.value].join(`

`),systemPrompt:d.value,files:ee.value,logLevel:v.value,abortSignal:B.signal});for await(const se of Y)R+=se,await s({[c.value.name.toLowerCase()]:M.value+R},!1)}await s({[c.value.name.toLowerCase()]:c.value.type==="layout"||c.value.type==="blocks"?[...M.value,...(me??[]).map(c.value.type==="layout"?Se:q)]:M.value+R}),o.notification.success({icon:"sparkling",message:o.t("johannschopplich.copilot.generator.success")})}catch(R){if(gt(R))return;const{AISDKError:me,APICallError:Y}=await te("ai");if(R instanceof _e||me.isInstance(R)||Y.isInstance(R)){let se=R.message;se.includes("levels of nesting exceeds limit")&&(se=`The ${c.value.type} generation for the "${c.value.name}" field exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas.`),console.error(R),o.notification.error(se);return}console.error(R),o.notification.error(o.t("johannschopplich.copilot.generator.error"))}finally{B=void 0,o.isLoading=!1,$.value=!1}}function Ke(){B==null||B.abort(),B=void 0,o.isLoading=!1,$.value=!1}function Cc(){s({[c.value.name.toLowerCase()]:M.value}),M.value=void 0}async function Oc(){const F=await xn();ee.value=[...ee.value,...F]}function vt(){Be.value&&(M.value=void 0)}return{__sfc:!0,propsDefinition:Tn,props:t,_isKirby5:n,panel:o,t:r,currentContent:i,updateContent:s,label:a,field:c,userPrompt:u,systemPrompt:d,storage:h,theme:f,size:m,logLevel:v,modelFile:y,help:E,config:S,isInitialized:b,isGenerating:$,isDetailsOpen:P,detailsElement:C,currentPrompt:D,currentFieldContent:M,permissions:ze,files:ee,licenseStatus:k,storageKey:T,abortController:B,canUndo:Be,generate:Ne,abort:Ke,undo:Cc,pickFiles:Oc,onModelSave:vt,LicensingButtonGroup:kt,SUPPORTED_IMAGE_MIME_TYPES:He,SUPPORTED_PROVIDERS:$t}}});var yc=function(){var r,i,s,a,c,u;var t=this,n=t._self._c,o=t._self._setupProxy;return o.isInitialized?n("k-section",{attrs:{label:o.label}},[o.licenseStatus!==void 0?n("template",{slot:"options"},[n(o.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":o.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):t._e(),!o.config.provider||!o.SUPPORTED_PROVIDERS.includes(o.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Unsupported provider "),n("code",[t._v(t._s(o.config.provider))]),t._v(" in the "),n("code",[t._v("johannschopplich.copilot.provider")]),t._v(" global configuration. ")])],1):(i=(r=o.config.providers)==null?void 0:r[o.config.provider])!=null&&i.apiKey?(a=(s=o.config.providers)==null?void 0:s[o.config.provider])!=null&&a.model?!o.field||typeof o.field=="string"||typeof o.field=="object"&&!(((c=o.field)==null?void 0:c.name.toLowerCase())in o.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" The "),n("code",[t._v(t._s(((u=o.field)==null?void 0:u.name)??o.field))]),t._v(" field does not exist in the current model. ")])],1):!o.permissions.includes("edit")&&!o.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" If the user prompt cannot be edited by the user, a default "),n("code",[t._v("userPrompt")]),t._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:o.isGenerating?"loader":"sparkling",text:o.panel.t("johannschopplich.copilot.generate"),theme:o.theme,variant:"filled",size:o.size,disabled:o.isGenerating},on:{click:function(d){return o.generate()}}}),o.isGenerating?n("k-button",{attrs:{icon:"cancel",text:o.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:o.size},on:{click:function(d){return o.abort()}}}):t._e(),o.canUndo?n("k-button",{attrs:{icon:"undo",text:o.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:o.size},on:{click:function(d){return o.undo()}}}):t._e()],1),o.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(d){o.isDetailsOpen=d.target.open}}},[n("summary",[t._v(" "+t._s([...o.permissions.includes("edit")?[o.panel.t("johannschopplich.copilot.prompt.label")]:[],...o.permissions.includes("files")?[o.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[o.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:o.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:o.currentPrompt,placeholder:o.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(d){o.currentPrompt=d}}})],1):t._e(),o.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:o.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:o._isKirby5&&o.files.length>0?{theme:"notice",text:o.files.length}:void 0,size:"sm"},on:{click:function(d){return o.pickFiles()}}}),o.files.length>0?n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(d){o.files=[]}}}):t._e(),o.permissions.includes("edit")&&o.userPrompt&&o.currentPrompt!==o.userPrompt?n("k-button",{staticClass:"kai-ml-auto",attrs:{icon:"undo",text:o.panel.t("johannschopplich.copilot.reset"),variant:"dimmed",size:"xs"},on:{click:function(d){o.currentPrompt=o.userPrompt}}}):t._e()],1):o.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[t._v(" "+t._s(o.panel.t(`johannschopplich.copilot.context.file.${o.SUPPORTED_IMAGE_MIME_TYPES.includes(o.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):t._e()],1)]):t._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("model")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${o.config.provider}`))]),t._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("apiKey")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${o.config.provider}`))]),t._v(" global configuration. ")])],1),o.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:o.help}})],1):t._e()],2):t._e()},bc=[],wc=ve(_c,yc,bc,!1,null,null);const kc=wc.exports;async function Ln(e,{appendText:t,replaceText:n,responseFormat:o="text"}){const r=w(),i=new AbortController,s=m=>{m.key==="Escape"&&i.abort()},a=await Dn({selection:e});if(!a)return;const{prompt:c,files:u}=a;if(!c)return;r.isLoading=!0,document.addEventListener("keydown",s);const{config:d}=await V(),{AISDKError:h,APICallError:f}=await te("ai");try{const{textStream:m}=await xt({userPrompt:[`<response_format>
${o}
</response_format>`,e&&`<selected_text>
${e}
</selected_text>`,c].filter(Boolean).join(`

`),systemPrompt:d.systemPrompt||Je,files:u,abortSignal:i.signal});let v=!0;for await(let y of m)a.append?(v&&(y=e?` ${y}`:y,v=!1),t(y)):n(y);r.notification.success({icon:"sparkling",message:r.t("johannschopplich.copilot.generator.success")})}catch(m){if(gt(m))return;if(m instanceof _e||h.isInstance(m)||f.isInstance(m)){console.error(m),r.notification.error(m.message);return}console.error(m),r.notification.error(r.t("johannschopplich.copilot.generator.error"))}finally{r.isLoading=!1,document.removeEventListener("keydown",s)}}async function Dn(e={}){return new Promise(t=>{const n=w();let o;n.dialog.open({component:"k-copilot-prompt-dialog",props:e,on:{close:()=>{setTimeout(()=>{t(o)},25)},submit:r=>{o=r,n.dialog.close()}}})})}const $c={__name:"CopilotButton",props:{label:{type:String,required:!1},userPrompt:{type:String,required:!1},systemPrompt:{type:String,required:!1},logLevel:{type:String,default:""},theme:{type:String,default:"notice-icon"}},setup(e){const t=e,n=w(),{currentContent:o,update:r}=Ge(),i=_(!1),s=_(!1);let a;async function c(){a=new AbortController;const h=k=>{k.key==="Escape"&&u()};let f=await n.api.get(fo,{id:n.view.path},void 0,!0);if(f=Object.values(f).filter(k=>!dt.has(k.type)&&!k.disabled&&!k.hidden),f.length===0){n.notification.error(n.t("johannschopplich.copilot.generator.noFields"));return}const m=await Dn({fields:f,userPrompt:t.userPrompt});if(!m)return;const{prompt:v,files:y,fields:E}=m,S=f.filter(k=>E.includes(k.name));if(!v||S.length===0)return;const{getZodSchema:b}=Me(),{getZodSchema:$}=mt(),P={};for(const k of S)k.type==="layout"?P[k.name]=K(await $(k)):k.type==="blocks"?P[k.name]=K(await b(k)):P[k.name]=pt(k);n.isLoading=!0,i.value=!0,document.addEventListener("keydown",h);const C={...o.value},{config:D}=await V(),{AISDKError:M,APICallError:ze}=await te("ai"),ee=t.systemPrompt||D.systemPrompt||Je;try{const{partialObjectStream:k,object:T}=await Et({userPrompt:v,systemPrompt:ee,schema:fe(P),output:"object",files:y,logLevel:ae.indexOf(t.logLevel&&ae.includes(t.logLevel)?t.logLevel:D.logLevel&&ae.includes(D.logLevel)?D.logLevel:zt),abortSignal:a.signal});for await(const Ne of k){if(!Ne)continue;const Ke=d({object:Ne,selectedFields:S,currentContent:C});Object.keys(Ke).length>0&&await r(Ke,!1)}const B=await T,Be=d({object:B,selectedFields:S,currentContent:C});await r(Be),n.notification.success({icon:"sparkling",message:n.t("johannschopplich.copilot.generator.success")})}catch(k){if(gt(k))return;if(k instanceof _e||M.isInstance(k)||ze.isInstance(k)){let T=k.message;T.includes("levels of nesting exceeds limit")&&(T="The fields generation exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas."),console.error(k),n.notification.error(T);return}console.error(k),n.notification.error(n.t("johannschopplich.copilot.generator.error"))}finally{a=void 0,n.isLoading=!1,i.value=!1,document.removeEventListener("keydown",h)}}function u(){a==null||a.abort(),a=void 0,i.value=!1,n.isLoading=!1}function d({object:h,selectedFields:f,currentContent:m}){const{normalizeBlock:v}=Me(),{normalizeLayout:y}=mt(),E={};for(const S of f){const b=h[S.name];if(b==null)continue;const $=m[S.name];S.type==="layout"||S.type==="blocks"?Array.isArray(b)&&(E[S.name]=[...$,...b.map(S.type==="layout"?y:v)]):E[S.name]=b}return E}return{__sfc:!0,props:t,panel:n,currentContent:o,updateContent:r,isGenerating:i,isHovering:s,abortController:a,initPromptDialog:c,abort:u,processFieldValues:d}}};var zc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("k-button",{attrs:{icon:o.isHovering&&o.isGenerating?"cancel":o.isGenerating?"loader":"sparkling",text:t.label||o.panel.t("johannschopplich.copilot.label"),theme:o.isHovering&&o.isGenerating?"notice":t.theme,variant:"filled",size:"sm",responsive:""},on:{click:function(r){o.isHovering&&o.isGenerating?o.abort():o.initPromptDialog()}},nativeOn:{mouseenter:function(r){o.isHovering=!0},mouseleave:function(r){o.isHovering=!1}}})},Sc=[],xc=ve($c,zc,Sc,!1,null,null);const Fn=xc.exports,Ec={},Ic={copilot:{icon:"sparkling",label:"Copilot Prompt",click(){let e="";this.command("insert",(r,i)=>(e=i,i));let t=!0;Ln(e,{responseFormat:"markdown",appendText:r=>{this.command("insert",(i,s)=>t?(t=!1,s+r):r)},replaceText:r=>{this.command("insert",()=>r)}})},shortcut:"."}},Rn={"***":["bold","italic"],"**":["bold"],"*":["italic"],"`":["code"]},Zc={copilot:{get button(){return{icon:"sparkling",label:"Copilot Prompt"}},commands(e){return()=>this._openPromptDialog(e)},keys(e){return{"Mod-.":()=>this._openPromptDialog(e)}},get name(){return"copilot"},_insertText(e,t,n,o,r){let i=n;const s=t.split(/(\n\n?|\*{1,3}|`{1,3})/);for(const a of s)if(a===`

`)e=e.replaceWith(i,i,this.editor.options.inline?[r.schema.nodes.hardBreak.create(),r.schema.nodes.hardBreak.create()]:r.schema.nodes.paragraph.create()),i+=2;else if(a===`
`)e=e.replaceWith(i,i,r.schema.nodes.hardBreak.create()),i+=1;else if(a.length>0){if(a in Rn&&!o.lastSegment.includes(a)||[...o.activeMarks].some(c=>c.type.name===a)){for(const c of Rn[a])e=Ac(e,c,o,r);o.lastSegment=a;continue}e=e.insertText(a,i),i+=a.length,o.lastSegment=a}return{tr:e,newPosition:i}},_openPromptDialog(e){const{state:t}=this.editor,{from:n,to:o}=t.selection,r=t.doc.textBetween(n,o),i={activeMarks:new Set,lastSegment:""};let s,a=!1;Ln(r,{responseFormat:"text",replaceText:d=>{const{state:h,view:f}=this.editor;let m=h.tr;if(!a){const E=Pc(h),{from:S,to:b}=h.selection;m=m.deleteRange(S,b),s=E?1:S,a=!0}const{tr:v,newPosition:y}=this._insertText(m,d,s,i,e);s=y,f.dispatch(v)},appendText:d=>{const{state:h,view:f}=this.editor;s=h.selection.to;const{tr:m,newPosition:v}=this._insertText(h.tr,d,s,i,e);s=v,f.dispatch(m)}})}}};function Ac(e,t,n,{schema:o}){if([...n.activeMarks].some(r=>r.type.name===t)){n.activeMarks.delete(t);const r=[...n.activeMarks].filter(i=>i.type.name!==t);return e.setStoredMarks(r)}else{const r=o.marks[t].create();return n.activeMarks.add(r),e.addStoredMark(r)}}function Pc(e){const t=e.doc.content.size,{from:n,to:o}=e.selection;return n===0&&o===t}function jc(e){if(ge())return;let t;e.mixin({mounted(){if(this.$options.name!=="k-header")return;const n=this.$children.find(r=>r.$options.name==="k-button-group");if(!n)return;const o=e.extend(Fn);t=new o({parent:this}),t.$mount(),n.$el.before(t.$el)},beforeDestroy(){this.$options.name==="k-header"&&t&&(t.$destroy(),t=void 0)}})}window.panel.plugin("johannschopplich/copilot",{viewButtons:{copilot:Fn},components:{"k-copilot-prompt-dialog":dc},sections:{copilot:kc},fields:{},textareaButtons:Ic,writerMarks:Zc,icons:Ec,use:[jc]})})();

var Ss=Object.defineProperty;var un=p=>{throw TypeError(p)};var Cs=(p,$,M)=>$ in p?Ss(p,$,{enumerable:!0,configurable:!0,writable:!0,value:M}):p[$]=M;var H=(p,$,M)=>Cs(p,typeof $!="symbol"?$+"":$,M),As=(p,$,M)=>$.has(p)||un("Cannot "+M);var Pe=(p,$,M)=>(As(p,$,"read from private field"),M?M.call(p):$.get(p)),dn=(p,$,M)=>$.has(p)?un("Cannot add the same private member more than once"):$ instanceof WeakSet?$.add(p):$.set(p,M);(function(){"use strict";const p=window.Vue;function $(){return window.panel}function M(){return $().api}const xe=()=>window.panel.plugins.viewButtons!==void 0;function pn(){return xe()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):$().app.$store}function Ke(){const r=$(),e=pn(),n=xe();if(n&&!("diff"in r.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const t=re(n?()=>r.content.version("changes"):()=>e.getters["content/values"]()),s=re(n?()=>r.content.diff():()=>e.getters["content/changes"]()),a=re(n?()=>r.content.hasDiff():()=>e.getters["content/hasChanges"]()),i=n?r.content:new Proxy({},{get(){return()=>{}}});return{content:i,currentContent:t,contentChanges:s,hasChanges:a,update:async(c,l=!0)=>{if(!n&&c)for(const[g,_]of Object.entries(c))e.dispatch("content/update",[g,_]);const d=i.merge(c);l&&await i.save(d)}}}function hn(){const r=$();function e(n){return!n||typeof n=="string"?n:n[r.translation.code]??Object.values(n)[0]}return{t:e}}function mn(){const r=M();return{load:({parent:n,name:t})=>r.get(`${n}/sections/${t}`)}}const gn={error:0,warn:1,log:2,info:3,success:3};function yn(r){const e=new vn;return new Proxy({},{get(n,t){return(...s)=>{e.log({level:gn[t],type:t,tag:r,args:s})}}})}class vn{constructor(){H(this,"defaultColor","#7f8c8d");H(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});H(this,"typeColorMap",{success:"#2ecc71"})}log(e){const n=_n(e.level),t=e.type==="log"?"":e.type,s=e.tag||"",i=`
background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),o=`%c${[s,t].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?n(`${o}%c ${e.args[0]}`,i,"",...e.args.slice(1)):n(o,i,...e.args)}}function _n(r){return r<1?console.error:console.log}const Le=[],Ge=new Map;async function bn(r){if(!Array.isArray(r))throw new TypeError(`Expected an array, got ${typeof r}`);for(const e of r)Le.some(n=>n.filename===e.filename)||Le.push(e)}function gt(r){if(Le.length===0)throw new Error("Plugin assets not registered");const e=Le.find(n=>n.filename===r);if(!e)throw new Error(`Plugin asset "${r}" not found`);return e}async function oe(r){if(r.endsWith(".js")||(r+=".js"),Ge.has(r))return Ge.get(r);const n=await import(gt(r).url);return Ge.set(r,n),n}const re=p.computed;p.customRef,p.defineAsyncComponent,p.defineComponent,p.effectScope,p.getCurrentInstance;const kn=p.getCurrentScope;p.h,p.inject,p.isProxy,p.isReactive,p.isReadonly,p.isRef,p.isShallow,p.markRaw;const xn=p.nextTick;p.onActivated,p.onBeforeMount;const wn=p.onBeforeUnmount;p.onBeforeUpdate,p.onDeactivated,p.onErrorCaptured;const yt=p.onMounted;p.onRenderTracked,p.onRenderTriggered;const Sn=p.onScopeDispose;p.onServerPrefetch,p.onUnmounted,p.onUpdated,p.provide,p.proxyRefs,p.reactive,p.readonly;const x=p.ref;p.shallowReactive,p.shallowReadonly,p.shallowRef,p.toRaw,p.toRef,p.toRefs,p.triggerRef;const We=p.unref;p.useAttrs,p.useCssModule,p.useCssVars,p.useListeners,p.useSlots;const qe=p.watch;p.watchEffect,p.watchPostEffect,p.watchSyncEffect;const He={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible":"License key invalid for this plugin version","modal.error.upgradeable":"License key invalid for this plugin version. Upgrade now on https://hub.kirby.tools.","modal.error.activated":"License key already activated",activate:"Activate",activated:"Plugin activated",buy:"Buy a license",upgrade:"Upgrade"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.upgradeable":"Lizenzschlüssel ungültig für diese Plugin-Version. Aktualisiere jetzt auf https://hub.kirby.tools.","modal.error.activated":"Lizenzschlüssel bereits aktiviert",activate:"Aktivieren",activated:"Plugin aktiviert",buy:"Lizenz kaufen",upgrade:"Upgrade"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible":"Clé de licence invalide pour cette version du plugin","modal.error.upgradeable":"Clé de licence invalide pour cette version du plugin. Mettez à niveau maintenant sur https://hub.kirby.tools.","modal.error.activated":"Clé de licence déjà activée",activate:"Activer",activated:"Plugin activé",buy:"Acheter une licence",upgrade:"Upgrade"},nl:{"modal.info":"Bedankt voor het kopen van {label}! Voer je e-mailadres en bestelnummer in om je licentie te activeren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Vind je bestelnummer</a> op Lemon Squeezy of <a href="mailto:hello@kirby.tools">neem contact met ons op</a> als je het niet kunt vinden.',"modal.error.required.fields":"E-mailadres en bestelnummer zijn verplicht","modal.error.invalid.unauthorized":"E-mailadres of bestelnummer is onjuist","modal.error.invalid.licenseKey":"Licentiesleutel ongeldig voor dit plug-in","modal.error.incompatible":"Licentiesleutel ongeldig voor deze plug-inversie","modal.error.upgradeable":"Licentiesleutel ongeldig voor deze plug-inversie. Upgrade nu op https://hub.kirby.tools.","modal.error.activated":"Licentiesleutel al geactiveerd",activate:"Activeren",activated:"Plugin geactiveerd",buy:"Koop een licentie",upgrade:"Upgrade"}},Cn=["localhost","127.0.0.1","[::1]"],An=["local","test","ddev.site"];function ce(r="",e){var s;const n=window.panel.translation.code,t=((s=He==null?void 0:He[n])==null?void 0:s[r])??r;return e?$n(t,e):t}function $n(r,e,n){return r.replace(/\{(\w+)\}/g,(t,s)=>e[s]||s)}function Tn(){const{hostname:r}=window.location,e=Cn.includes(r),n=An.some(t=>r.endsWith(`.${t}`));return e||n}const vt={Unauthorized:"modal.error.invalid.unauthorized","License key not valid for this plugin":"modal.error.invalid.licenseKey","License key not valid for this plugin version":"modal.error.incompatible","License key not valid for this plugin version, please upgrade your license":"modal.error.upgradeable","License key already activated":"modal.error.activated"};function In(r){const e=$();return{isLocalhost:Tn(),assertActivationIntegrity:async({component:a,licenseStatus:i})=>{if(We(i)==="active")return;const o=We(a);if(!(o!=null&&o.$el)||window.getComputedStyle(o.$el).display==="none"||window.getComputedStyle(o.$el).visibility==="hidden"||window.getComputedStyle(o.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let a=!1;const{label:i}=r,o={info:{type:"info",text:ce("modal.info",{label:i})},email:{label:e.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:ce("modal.fields.orderId.help",{label:i})}};return new Promise(c=>{e.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:ce("activate",{label:i})},fields:o},on:{close:()=>{c({isLicenseActive:a})},submit:async l=>{a=await jn(l,r),a&&(e.dialog.close(),e.notification.success(ce("activated")))}}})})}}}async function jn(r,e){const n=$(),{email:t,orderId:s}=r;if(!t||!s)return n.notification.error(ce("modal.error.required.fields")),!1;try{const a=await n.api.post(`${e.apiNamespace}/activate`,{email:t,orderId:Number(s)});if((a==null?void 0:a.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(a){const i=a.message;return n.notification.error(vt[i]?ce(vt[i]):i),!1}}const En=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(r){const e=r,{openLicenseModal:n,assertActivationIntegrity:t}=In({label:e.label,apiNamespace:e.apiNamespace}),s=x(e.licenseStatus),a=x();yt(()=>{t({component:a,licenseStatus:e.licenseStatus})});async function i(){const{isLicenseActive:o}=await n();o&&window.location.reload()}return{__sfc:!0,props:e,openLicenseModal:n,assertActivationIntegrity:t,currentLicenseStatus:s,licenseButtonGroup:a,handleRegistration:i,t:ce}}});function we(r,e,n,t,s,a,i,o){var c=typeof r=="function"?r.options:r;return e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),a&&(c._scopeId="data-v-"+a),{exports:r,options:c}}var On=function(){var e=this,n=e._self._c,t=e._self._setupProxy;return t.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:t.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":e.pricingUrl,target:"_blank",text:t.currentLicenseStatus==="upgradeable"?t.t("upgrade"):t.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:t.t("activate")},on:{click:function(s){return t.handleRegistration()}}})],1):e._e()},Pn=[],Ln=we(En,On,Pn,!1,null,null);const _t=Ln.exports,Rn="__copilot__/context",Mn="__copilot__/model-fields",Nn="__copilot__/fieldsets",bt=["anthropic","google","mistral","openai"],Ye=["image/png","image/jpeg","image/webp","image/gif"],zn=["error","warn","info","debug"],Bn="kirby$copilot$",Zn={list:"HTML",markdown:"markdown",textarea:"markdown",writer:"HTML"},Je=`
You are an AI assistant integrated into the Kirby CMS Panel. Your primary task is to help users generate content for various field types within the CMS. You must provide relevant and helpful content based on the user's question and the specified field type, while considering any provided context.

Consider the user context if provided:
- If selected_text is provided, use it as context for the user's question.
- If pdf_documents are provided, incorporate the information from these documents into your response as applicable.

Format your response according to the specified response_format if provided:
1. If response_format is "text", provide your response in plain text without any Markdown or HTML syntax.
2. If response_format is "HTML", format your response using HTML syntax. Only include the content that would go inside the <body> element. Use appropriate HTML tags to structure your response, including <h2> or <h3> tags for section headings.
3. If response_format is "markdown", format your response using Markdown syntax. Do not use backticks or any other wrapping characters around your response.
`;class Se extends Error{}let Ce;async function Dn(r){const e=await Fn(),n=await r.arrayBuffer(),t=await e.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:t.numPages},(a,i)=>Un(t,i+1)))).map(a=>a.replace(/\s+/g," ")).join(`
`)}async function Un(r,e){return(await(await r.getPage(e)).getTextContent()).items.filter(s=>s.str!=null).map(s=>s.str).join(" ")}async function Fn(){if(Ce)return Ce;Ce=await oe("pdfjs");const r=gt("pdfjs.worker.js");return Ce.GlobalWorkerOptions.workerSrc=r.url,Ce}function Vn(r,e,n){return r.replace(/\{(\w+)\}/g,(t,s)=>e[s.toLowerCase()]||s)}async function Kn({accept:r="*",multiple:e=!0}={}){const n=document.createElement("input");return n.type="file",n.classList.add("sr-only"),n.value=null,n.accept=r,n.multiple=e,n.click(),new Promise(t=>{n.addEventListener("change",s=>{var a;t([...((a=s.target)==null?void 0:a.files)??[]]),n.remove()},{once:!0})})}async function Gn(r,e){const n=await Wn(r);return await qn(n,r.type,e)}async function Wn(r,e={}){if(!r.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${r.type}`);const n=new Image,t=URL.createObjectURL(r);e.crossOrigin&&(n.crossOrigin=e.crossOrigin);try{return await new Promise((a,i)=>{n.addEventListener("load",()=>{a(n)}),n.addEventListener("error",i),n.src=t})}finally{URL.revokeObjectURL(t)}}async function qn(r,e,n){if(!r.complete||!r.naturalWidth)throw new Error("Image has not been properly loaded");if(!e.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${e}`);const t=document.createElement("canvas"),s=t.getContext("2d"),a=Math.min(1,n/Math.max(r.width,r.height)),i=Math.round(r.width*a),o=Math.round(r.height*a);t.width=i,t.height=o,s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(r,0,0,i,o);const c=await new Promise(l=>{t.toBlob(l,e)});if(!c)throw new Error("Failed to convert canvas to Blob");return c}function Hn(){const{currentContent:r}=Ke(),e={...r.value,title:window.panel.view.title};return Object.fromEntries(Object.entries(e).map(([n,t])=>[n,Array.isArray(t)||typeof t=="object"&&t!==null?JSON.stringify(t):t]))}let Yn;function kt(){return Yn??(Yn=yn("copilot"))}let Re,Ae;function Y(){return Re||Ae||(Ae=window.panel.api.get(Rn).then(r=>(bn(r.assets),Re=r,Ae=void 0,Re)),Ae)}async function xt({userPrompt:r,systemPrompt:e,files:n=[],logLevel:t=1,abortSignal:s}){const a=kt(),{config:i}=await Y(),o=await St(),{AISDKError:c,APICallError:l,streamText:d,smoothStream:g}=await oe("ai"),{userPromptWithContext:_,imageByteArrays:k}=await Ct({userPrompt:r,files:n});return t>1&&(a.info("System prompt:",e),a.info("User prompt with context:",_)),d({model:o,temperature:i.temperature,system:e||void 0,...k.length>0?{messages:[{role:"user",content:[{type:"text",text:_},...k.map(T=>({type:"image",image:T}))]}]}:{prompt:_},experimental_transform:g({chunking:"line"}),abortSignal:s,onError({error:T}){if(c.isInstance(T)||l.isInstance(T))throw T}})}async function wt({userPrompt:r,systemPrompt:e,schema:n,output:t="object",files:s=[],logLevel:a=1,abortSignal:i}){const o=kt(),{config:c}=await Y(),l=await St(),{AISDKError:d,APICallError:g,streamObject:_}=await oe("ai"),{userPromptWithContext:k,imageByteArrays:T}=await Ct({userPrompt:r,files:s});return a>1&&(o.info("System prompt:",e),o.info("User prompt with context:",k)),_({model:l,temperature:c.temperature,schema:n,output:t,...T.length>0?{messages:[{role:"user",content:[{type:"text",text:k},...T.map(I=>({type:"image",image:I}))]}]}:{prompt:k},abortSignal:i,onError({error:I}){if(d.isInstance(I)||g.isInstance(I))throw I}})}async function St(){var l,d;let{config:r}=await Y();if(!r.provider||!bt.includes(r.provider))throw new Se(`Unsupported provider "${r.provider}" in the "johannschopplich.copilot.provider" global configuration.`);for(const g of["apiKey","model"])if(!((d=(l=r.providers)==null?void 0:l[r.provider])!=null&&d[g]))throw new Se(`Missing "${g}" property in the "johannschopplich.copilot.providers.${r.provider}" global configuration.`);const{createAnthropic:e,createGoogleGenerativeAI:n,createMistral:t,createOpenAI:s}=await oe("ai"),a=r.provider,i=r.providers[a],o={anthropic:e,google:n,mistral:t,openai:s}[a];return o({baseUrl:i.baseUrl||void 0,apiKey:i.apiKey}).languageModel(i.model)}async function Ct({userPrompt:r,files:e=[]}){const n=Hn();let t=Vn(r,n);const s=e.filter(o=>o.type.startsWith("image/")),a=e.filter(o=>o.type==="application/pdf");if(a.length>0){const o=await Promise.all(a.map(Dn));t+=`

${o.map((c,l)=>`<pdf_document_${l+1}>
${c}
</pdf_document_${l+1}>`).join(`

`)}`}const i=await Promise.all(s.map(async o=>{const l=await(await Gn(o,2048)).arrayBuffer();return new Uint8Array(l)}));return{userPromptWithContext:t,imageByteArrays:i}}var S;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function n(s){throw new Error}r.assertNever=n,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function t(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=t,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(S||(S={}));var At;(function(r){r.mergeShapes=(e,n)=>({...e,...n})})(At||(At={}));const h=S.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),se=r=>{switch(typeof r){case"undefined":return h.undefined;case"string":return h.string;case"number":return Number.isNaN(r)?h.nan:h.number;case"boolean":return h.boolean;case"function":return h.function;case"bigint":return h.bigint;case"symbol":return h.symbol;case"object":return Array.isArray(r)?h.array:r===null?h.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?h.promise:typeof Map<"u"&&r instanceof Map?h.map:typeof Set<"u"&&r instanceof Set?h.set:typeof Date<"u"&&r instanceof Date?h.date:h.object;default:return h.unknown}},u=S.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class J extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=t=>{this.issues=[...this.issues,t]},this.addIssues=(t=[])=>{this.issues=[...this.issues,...t]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},t={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)t._errors.push(n(i));else{let o=t,c=0;for(;c<i.path.length;){const l=i.path[c];c===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(n(i))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return s(this),t}static assert(e){if(!(e instanceof J))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,S.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},t=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):t.push(e(s));return{formErrors:t,fieldErrors:n}}get formErrors(){return this.flatten()}}J.create=r=>new J(r);const Xe=(r,e)=>{let n;switch(r.code){case u.invalid_type:r.received===h.undefined?n="Required":n=`Expected ${r.expected}, received ${r.received}`;break;case u.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(r.expected,S.jsonStringifyReplacer)}`;break;case u.unrecognized_keys:n=`Unrecognized key(s) in object: ${S.joinValues(r.keys,", ")}`;break;case u.invalid_union:n="Invalid input";break;case u.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${S.joinValues(r.options)}`;break;case u.invalid_enum_value:n=`Invalid enum value. Expected ${S.joinValues(r.options)}, received '${r.received}'`;break;case u.invalid_arguments:n="Invalid function arguments";break;case u.invalid_return_type:n="Invalid function return type";break;case u.invalid_date:n="Invalid date";break;case u.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(n=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?n=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?n=`Invalid input: must end with "${r.validation.endsWith}"`:S.assertNever(r.validation):r.validation!=="regex"?n=`Invalid ${r.validation}`:n="Invalid";break;case u.too_small:r.type==="array"?n=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?n=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?n=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?n=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:n="Invalid input";break;case u.too_big:r.type==="array"?n=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?n=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?n=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?n=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?n=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:n="Invalid input";break;case u.custom:n="Invalid input";break;case u.invalid_intersection_types:n="Intersection results could not be merged";break;case u.not_multiple_of:n=`Number must be a multiple of ${r.multipleOf}`;break;case u.not_finite:n="Number must be finite";break;default:n=e.defaultError,S.assertNever(r)}return{message:n}};let Jn=Xe;function Xn(){return Jn}const Qn=r=>{const{data:e,path:n,errorMaps:t,issueData:s}=r,a=[...n,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const c=t.filter(l=>!!l).slice().reverse();for(const l of c)o=l(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}};function f(r,e){const n=Xn(),t=Qn({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,n,n===Xe?void 0:Xe].filter(s=>!!s)});r.common.issues.push(t)}class L{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const t=[];for(const s of n){if(s.status==="aborted")return v;s.status==="dirty"&&e.dirty(),t.push(s.value)}return{status:e.value,value:t}}static async mergeObjectAsync(e,n){const t=[];for(const s of n){const a=await s.key,i=await s.value;t.push({key:a,value:i})}return L.mergeObjectSync(e,t)}static mergeObjectSync(e,n){const t={};for(const s of n){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return v;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(t[a.value]=i.value)}return{status:e.value,value:t}}}const v=Object.freeze({status:"aborted"}),$e=r=>({status:"dirty",value:r}),B=r=>({status:"valid",value:r}),$t=r=>r.status==="aborted",Tt=r=>r.status==="dirty",pe=r=>r.status==="valid",Me=r=>typeof Promise<"u"&&r instanceof Promise;var m;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(m||(m={}));class V{constructor(e,n,t,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=t,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const It=(r,e)=>{if(pe(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new J(r.common.issues);return this._error=n,this._error}}};function b(r){if(!r)return{};const{errorMap:e,invalid_type_error:n,required_error:t,description:s}=r;if(e&&(n||t))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{const{message:c}=r;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??t??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:c??n??o.defaultError}},description:s}}class w{get description(){return this._def.description}_getType(e){return se(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:se(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new L,ctx:{common:e.parent.common,data:e.data,parsedType:se(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Me(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const t=this.safeParse(e,n);if(t.success)return t.data;throw t.error}safeParse(e,n){const t={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:se(e)},s=this._parseSync({data:e,path:t.path,parent:t});return It(t,s)}"~validate"(e){var t,s;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:se(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:n});return pe(a)?{value:a.value}:{issues:n.common.issues}}catch(a){(s=(t=a==null?void 0:a.message)==null?void 0:t.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>pe(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,n){const t=await this.safeParseAsync(e,n);if(t.success)return t.data;throw t.error}async safeParseAsync(e,n){const t={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:se(e)},s=this._parse({data:e,path:t.path,parent:t}),a=await(Me(s)?s:Promise.resolve(s));return It(t,a)}refine(e,n){const t=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:u.custom,...t(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,n){return this._refinement((t,s)=>e(t)?!0:(s.addIssue(typeof n=="function"?n(t,s):n),!1))}_refinement(e){return new ye({schema:this,typeName:y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return ie.create(this,this._def)}nullable(){return ve.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return K.create(this)}promise(){return De.create(this,this._def)}or(e){return ze.create([this,e],this._def)}and(e){return Be.create(this,e,this._def)}transform(e){return new ye({...b(this._def),schema:this,typeName:y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new rt({...b(this._def),innerType:this,defaultValue:n,typeName:y.ZodDefault})}brand(){return new xr({typeName:y.ZodBranded,type:this,...b(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new st({...b(this._def),innerType:this,catchValue:n,typeName:y.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return at.create(this,e)}readonly(){return it.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const er=/^c[^\s-]{8,}$/i,tr=/^[0-9a-z]+$/,nr=/^[0-9A-HJKMNP-TV-Z]{26}$/i,rr=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,sr=/^[a-z0-9_-]{21}$/i,ar=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ir=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,or=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,cr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Qe;const lr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ur=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,dr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,fr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,pr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,hr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,jt="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",mr=new RegExp(`^${jt}$`);function Et(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const n=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function gr(r){return new RegExp(`^${Et(r)}$`)}function yr(r){let e=`${jt}T${Et(r)}`;const n=[];return n.push(r.local?"Z?":"Z"),r.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function vr(r,e){return!!((e==="v4"||!e)&&lr.test(r)||(e==="v6"||!e)&&dr.test(r))}function _r(r,e){if(!ar.test(r))return!1;try{const[n]=r.split("."),t=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(t));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function br(r,e){return!!((e==="v4"||!e)&&ur.test(r)||(e==="v6"||!e)&&fr.test(r))}class X extends w{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==h.string){const a=this._getOrReturnCtx(e);return f(a,{code:u.invalid_type,expected:h.string,received:a.parsedType}),v}const t=new L;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?f(s,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&f(s,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if(a.kind==="email")or.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"email",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="emoji")Qe||(Qe=new RegExp(cr,"u")),Qe.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"emoji",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="uuid")rr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"uuid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="nanoid")sr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"nanoid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="cuid")er.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"cuid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="cuid2")tr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"cuid2",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="ulid")nr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"ulid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),f(s,{validation:"url",code:u.invalid_string,message:a.message}),t.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"regex",code:u.invalid_string,message:a.message}),t.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty()):a.kind==="datetime"?yr(a).test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:"datetime",message:a.message}),t.dirty()):a.kind==="date"?mr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:"date",message:a.message}),t.dirty()):a.kind==="time"?gr(a).test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:"time",message:a.message}),t.dirty()):a.kind==="duration"?ir.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"duration",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="ip"?vr(e.data,a.version)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"ip",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="jwt"?_r(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"jwt",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="cidr"?br(e.data,a.version)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"cidr",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="base64"?pr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"base64",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="base64url"?hr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"base64url",code:u.invalid_string,message:a.message}),t.dirty()):S.assertNever(a);return{status:t.value,value:e.data}}_regex(e,n,t){return this.refinement(s=>e.test(s),{validation:n,code:u.invalid_string,...m.errToObj(t)})}_addCheck(e){return new X({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...m.errToObj(e)})}url(e){return this._addCheck({kind:"url",...m.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...m.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...m.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...m.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...m.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...m.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...m.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...m.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...m.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...m.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...m.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...m.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...m.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...m.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...m.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...m.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...m.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...m.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...m.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...m.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...m.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...m.errToObj(n)})}nonempty(e){return this.min(1,m.errToObj(e))}trim(){return new X({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new X({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new X({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}X.create=r=>new X({checks:[],typeName:y.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...b(r)});function kr(r,e){const n=(r.toString().split(".")[1]||"").length,t=(e.toString().split(".")[1]||"").length,s=n>t?n:t,a=Number.parseInt(r.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}class he extends w{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==h.number){const a=this._getOrReturnCtx(e);return f(a,{code:u.invalid_type,expected:h.number,received:a.parsedType}),v}let t;const s=new L;for(const a of this._def.checks)a.kind==="int"?S.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),f(t,{code:u.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:u.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:u.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?kr(e.data,a.value)!==0&&(t=this._getOrReturnCtx(e,t),f(t,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),f(t,{code:u.not_finite,message:a.message}),s.dirty()):S.assertNever(a);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,m.toString(n))}gt(e,n){return this.setLimit("min",e,!1,m.toString(n))}lte(e,n){return this.setLimit("max",e,!0,m.toString(n))}lt(e,n){return this.setLimit("max",e,!1,m.toString(n))}setLimit(e,n,t,s){return new he({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:t,message:m.toString(s)}]})}_addCheck(e){return new he({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:m.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:m.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:m.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:m.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:m.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:m.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:m.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:m.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:m.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&S.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const t of this._def.checks){if(t.kind==="finite"||t.kind==="int"||t.kind==="multipleOf")return!0;t.kind==="min"?(n===null||t.value>n)&&(n=t.value):t.kind==="max"&&(e===null||t.value<e)&&(e=t.value)}return Number.isFinite(n)&&Number.isFinite(e)}}he.create=r=>new he({checks:[],typeName:y.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...b(r)});class Te extends w{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==h.bigint)return this._getInvalidInput(e);let t;const s=new L;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:u.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:u.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),f(t,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):S.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return f(n,{code:u.invalid_type,expected:h.bigint,received:n.parsedType}),v}gte(e,n){return this.setLimit("min",e,!0,m.toString(n))}gt(e,n){return this.setLimit("min",e,!1,m.toString(n))}lte(e,n){return this.setLimit("max",e,!0,m.toString(n))}lt(e,n){return this.setLimit("max",e,!1,m.toString(n))}setLimit(e,n,t,s){return new Te({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:t,message:m.toString(s)}]})}_addCheck(e){return new Te({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:m.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:m.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:m.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:m.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:m.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Te.create=r=>new Te({checks:[],typeName:y.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...b(r)});class et extends w{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==h.boolean){const t=this._getOrReturnCtx(e);return f(t,{code:u.invalid_type,expected:h.boolean,received:t.parsedType}),v}return B(e.data)}}et.create=r=>new et({typeName:y.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...b(r)});class Ne extends w{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==h.date){const a=this._getOrReturnCtx(e);return f(a,{code:u.invalid_type,expected:h.date,received:a.parsedType}),v}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return f(a,{code:u.invalid_date}),v}const t=new L;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):S.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ne({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:m.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:m.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Ne.create=r=>new Ne({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:y.ZodDate,...b(r)});class Ot extends w{_parse(e){if(this._getType(e)!==h.symbol){const t=this._getOrReturnCtx(e);return f(t,{code:u.invalid_type,expected:h.symbol,received:t.parsedType}),v}return B(e.data)}}Ot.create=r=>new Ot({typeName:y.ZodSymbol,...b(r)});class Pt extends w{_parse(e){if(this._getType(e)!==h.undefined){const t=this._getOrReturnCtx(e);return f(t,{code:u.invalid_type,expected:h.undefined,received:t.parsedType}),v}return B(e.data)}}Pt.create=r=>new Pt({typeName:y.ZodUndefined,...b(r)});class Lt extends w{_parse(e){if(this._getType(e)!==h.null){const t=this._getOrReturnCtx(e);return f(t,{code:u.invalid_type,expected:h.null,received:t.parsedType}),v}return B(e.data)}}Lt.create=r=>new Lt({typeName:y.ZodNull,...b(r)});class Rt extends w{constructor(){super(...arguments),this._any=!0}_parse(e){return B(e.data)}}Rt.create=r=>new Rt({typeName:y.ZodAny,...b(r)});class Mt extends w{constructor(){super(...arguments),this._unknown=!0}_parse(e){return B(e.data)}}Mt.create=r=>new Mt({typeName:y.ZodUnknown,...b(r)});class ae extends w{_parse(e){const n=this._getOrReturnCtx(e);return f(n,{code:u.invalid_type,expected:h.never,received:n.parsedType}),v}}ae.create=r=>new ae({typeName:y.ZodNever,...b(r)});class Nt extends w{_parse(e){if(this._getType(e)!==h.undefined){const t=this._getOrReturnCtx(e);return f(t,{code:u.invalid_type,expected:h.void,received:t.parsedType}),v}return B(e.data)}}Nt.create=r=>new Nt({typeName:y.ZodVoid,...b(r)});class K extends w{_parse(e){const{ctx:n,status:t}=this._processInputParams(e),s=this._def;if(n.parsedType!==h.array)return f(n,{code:u.invalid_type,expected:h.array,received:n.parsedType}),v;if(s.exactLength!==null){const i=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(i||o)&&(f(n,{code:i?u.too_big:u.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),t.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(f(n,{code:u.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),t.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(f(n,{code:u.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),t.dirty()),n.common.async)return Promise.all([...n.data].map((i,o)=>s.type._parseAsync(new V(n,i,n.path,o)))).then(i=>L.mergeArray(t,i));const a=[...n.data].map((i,o)=>s.type._parseSync(new V(n,i,n.path,o)));return L.mergeArray(t,a)}get element(){return this._def.type}min(e,n){return new K({...this._def,minLength:{value:e,message:m.toString(n)}})}max(e,n){return new K({...this._def,maxLength:{value:e,message:m.toString(n)}})}length(e,n){return new K({...this._def,exactLength:{value:e,message:m.toString(n)}})}nonempty(e){return this.min(1,e)}}K.create=(r,e)=>new K({type:r,minLength:null,maxLength:null,exactLength:null,typeName:y.ZodArray,...b(e)});function me(r){if(r instanceof E){const e={};for(const n in r.shape){const t=r.shape[n];e[n]=ie.create(me(t))}return new E({...r._def,shape:()=>e})}else return r instanceof K?new K({...r._def,type:me(r.element)}):r instanceof ie?ie.create(me(r.unwrap())):r instanceof ve?ve.create(me(r.unwrap())):r instanceof le?le.create(r.items.map(e=>me(e))):r}class E extends w{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=S.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==h.object){const l=this._getOrReturnCtx(e);return f(l,{code:u.invalid_type,expected:h.object,received:l.parsedType}),v}const{status:t,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof ae&&this._def.unknownKeys==="strip"))for(const l in s.data)i.includes(l)||o.push(l);const c=[];for(const l of i){const d=a[l],g=s.data[l];c.push({key:{status:"valid",value:l},value:d._parse(new V(s,g,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof ae){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of o)c.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(l==="strict")o.length>0&&(f(s,{code:u.unrecognized_keys,keys:o}),t.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of o){const g=s.data[d];c.push({key:{status:"valid",value:d},value:l._parse(new V(s,g,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of c){const g=await d.key,_=await d.value;l.push({key:g,value:_,alwaysSet:d.alwaysSet})}return l}).then(l=>L.mergeObjectSync(t,l)):L.mergeObjectSync(t,c)}get shape(){return this._def.shape()}strict(e){return m.errToObj,new E({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,t)=>{var a,i;const s=((i=(a=this._def).errorMap)==null?void 0:i.call(a,n,t).message)??t.defaultError;return n.code==="unrecognized_keys"?{message:m.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new E({...this._def,unknownKeys:"strip"})}passthrough(){return new E({...this._def,unknownKeys:"passthrough"})}extend(e){return new E({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new E({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:y.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new E({...this._def,catchall:e})}pick(e){const n={};for(const t of S.objectKeys(e))e[t]&&this.shape[t]&&(n[t]=this.shape[t]);return new E({...this._def,shape:()=>n})}omit(e){const n={};for(const t of S.objectKeys(this.shape))e[t]||(n[t]=this.shape[t]);return new E({...this._def,shape:()=>n})}deepPartial(){return me(this)}partial(e){const n={};for(const t of S.objectKeys(this.shape)){const s=this.shape[t];e&&!e[t]?n[t]=s:n[t]=s.optional()}return new E({...this._def,shape:()=>n})}required(e){const n={};for(const t of S.objectKeys(this.shape))if(e&&!e[t])n[t]=this.shape[t];else{let a=this.shape[t];for(;a instanceof ie;)a=a._def.innerType;n[t]=a}return new E({...this._def,shape:()=>n})}keyof(){return Zt(S.objectKeys(this.shape))}}E.create=(r,e)=>new E({shape:()=>r,unknownKeys:"strip",catchall:ae.create(),typeName:y.ZodObject,...b(e)}),E.strictCreate=(r,e)=>new E({shape:()=>r,unknownKeys:"strict",catchall:ae.create(),typeName:y.ZodObject,...b(e)}),E.lazycreate=(r,e)=>new E({shape:r,unknownKeys:"strip",catchall:ae.create(),typeName:y.ZodObject,...b(e)});class ze extends w{_parse(e){const{ctx:n}=this._processInputParams(e),t=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new J(o.ctx.common.issues));return f(n,{code:u.invalid_union,unionErrors:i}),v}if(n.common.async)return Promise.all(t.map(async a=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const c of t){const l={...n,common:{...n.common,issues:[]},parent:null},d=c._parseSync({data:n.data,path:n.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!a&&(a={result:d,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new J(c));return f(n,{code:u.invalid_union,unionErrors:o}),v}}get options(){return this._def.options}}ze.create=(r,e)=>new ze({options:r,typeName:y.ZodUnion,...b(e)});function tt(r,e){const n=se(r),t=se(e);if(r===e)return{valid:!0,data:r};if(n===h.object&&t===h.object){const s=S.objectKeys(e),a=S.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const c=tt(r[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(n===h.array&&t===h.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],c=tt(i,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return n===h.date&&t===h.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Be extends w{_parse(e){const{status:n,ctx:t}=this._processInputParams(e),s=(a,i)=>{if($t(a)||$t(i))return v;const o=tt(a.value,i.value);return o.valid?((Tt(a)||Tt(i))&&n.dirty(),{status:n.value,value:o.data}):(f(t,{code:u.invalid_intersection_types}),v)};return t.common.async?Promise.all([this._def.left._parseAsync({data:t.data,path:t.path,parent:t}),this._def.right._parseAsync({data:t.data,path:t.path,parent:t})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:t.data,path:t.path,parent:t}),this._def.right._parseSync({data:t.data,path:t.path,parent:t}))}}Be.create=(r,e,n)=>new Be({left:r,right:e,typeName:y.ZodIntersection,...b(n)});class le extends w{_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.array)return f(t,{code:u.invalid_type,expected:h.array,received:t.parsedType}),v;if(t.data.length<this._def.items.length)return f(t,{code:u.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),v;!this._def.rest&&t.data.length>this._def.items.length&&(f(t,{code:u.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...t.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new V(t,i,t.path,o)):null}).filter(i=>!!i);return t.common.async?Promise.all(a).then(i=>L.mergeArray(n,i)):L.mergeArray(n,a)}get items(){return this._def.items}rest(e){return new le({...this._def,rest:e})}}le.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new le({items:r,typeName:y.ZodTuple,rest:null,...b(e)})};class Ze extends w{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.object)return f(t,{code:u.invalid_type,expected:h.object,received:t.parsedType}),v;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in t.data)s.push({key:a._parse(new V(t,o,t.path,o)),value:i._parse(new V(t,t.data[o],t.path,o)),alwaysSet:o in t.data});return t.common.async?L.mergeObjectAsync(n,s):L.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(e,n,t){return n instanceof w?new Ze({keyType:e,valueType:n,typeName:y.ZodRecord,...b(t)}):new Ze({keyType:X.create(),valueType:e,typeName:y.ZodRecord,...b(n)})}}class zt extends w{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.map)return f(t,{code:u.invalid_type,expected:h.map,received:t.parsedType}),v;const s=this._def.keyType,a=this._def.valueType,i=[...t.data.entries()].map(([o,c],l)=>({key:s._parse(new V(t,o,t.path,[l,"key"])),value:a._parse(new V(t,c,t.path,[l,"value"]))}));if(t.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const l=await c.key,d=await c.value;if(l.status==="aborted"||d.status==="aborted")return v;(l.status==="dirty"||d.status==="dirty")&&n.dirty(),o.set(l.value,d.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const c of i){const l=c.key,d=c.value;if(l.status==="aborted"||d.status==="aborted")return v;(l.status==="dirty"||d.status==="dirty")&&n.dirty(),o.set(l.value,d.value)}return{status:n.value,value:o}}}}zt.create=(r,e,n)=>new zt({valueType:e,keyType:r,typeName:y.ZodMap,...b(n)});class Ie extends w{_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.set)return f(t,{code:u.invalid_type,expected:h.set,received:t.parsedType}),v;const s=this._def;s.minSize!==null&&t.data.size<s.minSize.value&&(f(t,{code:u.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&t.data.size>s.maxSize.value&&(f(t,{code:u.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const a=this._def.valueType;function i(c){const l=new Set;for(const d of c){if(d.status==="aborted")return v;d.status==="dirty"&&n.dirty(),l.add(d.value)}return{status:n.value,value:l}}const o=[...t.data.values()].map((c,l)=>a._parse(new V(t,c,t.path,l)));return t.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,n){return new Ie({...this._def,minSize:{value:e,message:m.toString(n)}})}max(e,n){return new Ie({...this._def,maxSize:{value:e,message:m.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Ie.create=(r,e)=>new Ie({valueType:r,minSize:null,maxSize:null,typeName:y.ZodSet,...b(e)});class Bt extends w{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Bt.create=(r,e)=>new Bt({getter:r,typeName:y.ZodLazy,...b(e)});class nt extends w{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return f(n,{received:n.data,code:u.invalid_literal,expected:this._def.value}),v}return{status:"valid",value:e.data}}get value(){return this._def.value}}nt.create=(r,e)=>new nt({value:r,typeName:y.ZodLiteral,...b(e)});function Zt(r,e){return new ge({values:r,typeName:y.ZodEnum,...b(e)})}class ge extends w{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),t=this._def.values;return f(n,{expected:S.joinValues(t),received:n.parsedType,code:u.invalid_type}),v}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),t=this._def.values;return f(n,{received:n.data,code:u.invalid_enum_value,options:t}),v}return B(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return ge.create(e,{...this._def,...n})}exclude(e,n=this._def){return ge.create(this.options.filter(t=>!e.includes(t)),{...this._def,...n})}}ge.create=Zt;class Dt extends w{_parse(e){const n=S.getValidEnumValues(this._def.values),t=this._getOrReturnCtx(e);if(t.parsedType!==h.string&&t.parsedType!==h.number){const s=S.objectValues(n);return f(t,{expected:S.joinValues(s),received:t.parsedType,code:u.invalid_type}),v}if(this._cache||(this._cache=new Set(S.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=S.objectValues(n);return f(t,{received:t.data,code:u.invalid_enum_value,options:s}),v}return B(e.data)}get enum(){return this._def.values}}Dt.create=(r,e)=>new Dt({values:r,typeName:y.ZodNativeEnum,...b(e)});class De extends w{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==h.promise&&n.common.async===!1)return f(n,{code:u.invalid_type,expected:h.promise,received:n.parsedType}),v;const t=n.parsedType===h.promise?n.data:Promise.resolve(n.data);return B(t.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}De.create=(r,e)=>new De({type:r,typeName:y.ZodPromise,...b(e)});class ye extends w{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:t}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{f(t,i),i.fatal?n.abort():n.dirty()},get path(){return t.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(t.data,a);if(t.common.async)return Promise.resolve(i).then(async o=>{if(n.value==="aborted")return v;const c=await this._def.schema._parseAsync({data:o,path:t.path,parent:t});return c.status==="aborted"?v:c.status==="dirty"||n.value==="dirty"?$e(c.value):c});{if(n.value==="aborted")return v;const o=this._def.schema._parseSync({data:i,path:t.path,parent:t});return o.status==="aborted"?v:o.status==="dirty"||n.value==="dirty"?$e(o.value):o}}if(s.type==="refinement"){const i=o=>{const c=s.refinement(o,a);if(t.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(t.common.async===!1){const o=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});return o.status==="aborted"?v:(o.status==="dirty"&&n.dirty(),i(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(o=>o.status==="aborted"?v:(o.status==="dirty"&&n.dirty(),i(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(t.common.async===!1){const i=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});if(!pe(i))return v;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(i=>pe(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:n.value,value:o})):v);S.assertNever(s)}}ye.create=(r,e,n)=>new ye({schema:r,typeName:y.ZodEffects,effect:e,...b(n)}),ye.createWithPreprocess=(r,e,n)=>new ye({schema:e,effect:{type:"preprocess",transform:r},typeName:y.ZodEffects,...b(n)});class ie extends w{_parse(e){return this._getType(e)===h.undefined?B(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ie.create=(r,e)=>new ie({innerType:r,typeName:y.ZodOptional,...b(e)});class ve extends w{_parse(e){return this._getType(e)===h.null?B(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ve.create=(r,e)=>new ve({innerType:r,typeName:y.ZodNullable,...b(e)});class rt extends w{_parse(e){const{ctx:n}=this._processInputParams(e);let t=n.data;return n.parsedType===h.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}rt.create=(r,e)=>new rt({innerType:r,typeName:y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...b(e)});class st extends w{_parse(e){const{ctx:n}=this._processInputParams(e),t={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return Me(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new J(t.common.issues)},input:t.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new J(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}}st.create=(r,e)=>new st({innerType:r,typeName:y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...b(e)});class Ut extends w{_parse(e){if(this._getType(e)!==h.nan){const t=this._getOrReturnCtx(e);return f(t,{code:u.invalid_type,expected:h.nan,received:t.parsedType}),v}return{status:"valid",value:e.data}}}Ut.create=r=>new Ut({typeName:y.ZodNaN,...b(r)});class xr extends w{_parse(e){const{ctx:n}=this._processInputParams(e),t=n.data;return this._def.type._parse({data:t,path:n.path,parent:n})}unwrap(){return this._def.type}}class at extends w{_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:t.data,path:t.path,parent:t});return a.status==="aborted"?v:a.status==="dirty"?(n.dirty(),$e(a.value)):this._def.out._parseAsync({data:a.value,path:t.path,parent:t})})();{const s=this._def.in._parseSync({data:t.data,path:t.path,parent:t});return s.status==="aborted"?v:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:t.path,parent:t})}}static create(e,n){return new at({in:e,out:n,typeName:y.ZodPipeline})}}class it extends w{_parse(e){const n=this._def.innerType._parse(e),t=s=>(pe(s)&&(s.value=Object.freeze(s.value)),s);return Me(n)?n.then(s=>t(s)):t(n)}unwrap(){return this._def.innerType}}it.create=(r,e)=>new it({innerType:r,typeName:y.ZodReadonly,...b(e)});var y;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(y||(y={}));const G=X.create,wr=he.create,Sr=et.create;ae.create;const Q=K.create,_e=E.create,Ft=ze.create;Be.create,le.create;const Vt=Ze.create,Cr=nt.create,ot=ge.create;De.create,ie.create,ve.create;const ct=new Set(["files","gap","headline","hidden","info","line","pages","users"]),Kt={text:r=>ee(r,`"${r.label}", single-line plain text without line breaks or formatting`),textarea:r=>ee(r,`"${r.label}", multi-line text with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),markdown:r=>ee(r,`"${r.label}", multi-line text with Markdown formatting`),slug:r=>ee(r,`"${r.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`),url:r=>ee(r,`"${r.label}", a valid URL starting with http:// or https://`),email:r=>ee(r,`"${r.label}", a valid email address`),password:r=>ee(r,`"${r.label}", a secure password (not for actual use)`),tel:r=>ee(r,`"${r.label}", a telephone number in appropriate format for the context`),writer:r=>ee(r,`"${r.label}" (WYSIWYG), ${r.inline===!0?"text with inline formatting only (bold, italic, underline, code, links, email, sub, sup). NO wrapping paragraph <p> tags allowed.":"text wrapped in paragraph <p> tags (can contain one or multiple paragraphs). Inline formatting (bold, italic, underline, code, links, email, sub, sup) is allowed."}`),list:r=>G().describe(`"${r.label}" (WYSIWYG), HTML list wrapped in <ul> or <ol>. Use <li> for items with inline formatting (bold, italic, underline, code, links, email, sub, sup).`),number:r=>Wt(r),range:r=>Wt(r),toggle:r=>Sr().describe(`"${r.label}", a boolean`),select:r=>ut(r),radio:r=>ut(r),toggles:r=>ut(r),checkboxes:r=>dt(r),multiselect:r=>dt(r),tags:r=>dt(r),date:r=>G().describe(`"${r.label}", a date ${r.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:r=>G().describe(`"${r.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),color:r=>G().describe(`"${r.label}", a color value in hex, rgb or hsl format`),link:r=>G().describe(`"${r.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),structure:r=>{const e=Gt(r);return e?Q(e).describe(`"${r.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`):Q(Vt(G())).describe(`"${r.label}", repeatable structured data based on expected content structure`)},object:r=>{const e=Gt(r);return e?e.describe(`"${r.label}", structured data containing the defined sub-fields with appropriate content`):Vt(G()).describe(`"${r.label}", object data based on expected content structure`)},entries:r=>{const{field:e}=r.field,n={...e,name:"entry",label:r.label||"Entry"},t=Kt[e.type],s=t(n);let a=Q(s);return r.min!=null&&(a=a.min(r.min)),r.max!=null&&(a=a.max(r.max)),a.describe(`"${r.label}", multiple entries of ${e.type} values${r.min!=null||r.max!=null?" within the defined count range":""}`)}};function lt(r){var t;const e=Kt[r.type];let n=e(r);return r.required===!0&&(n._def.typeName==="ZodString"?((t=n._def.checks)==null?void 0:t.some(s=>s.kind==="min"))!==!0&&(n=n.min(1)):n._def.typeName==="ZodArray"&&n._def.minLength==null&&(n=n.min(1))),n}function Gt(r){if(typeof r.fields!="object"||r.fields===null)return;const e={};for(const[n,t]of Object.entries(r.fields))t.disabled||t.hidden||ct.has(t.type)||(e[n]=lt({...t,name:n}));return _e(e)}function ee(r,e){let n=G();return r.minlength!=null&&(n=n.min(r.minlength)),r.maxlength!=null&&(n=n.max(r.maxlength)),n.describe(e)}function Wt(r){let e=wr();return r.min!=null&&(e=e.min(r.min)),r.max!=null&&(e=e.max(r.max)),e.describe(`"${r.label}", a numeric value${r.min!=null||r.max!=null?" within the defined range":""}`)}function ut(r){const e=(r.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return e.length>0?ot(e).describe(`"${r.label}", single selection value based on the predefined options`):G().describe(`"${r.label}", single selection value`)}function dt(r){const e=(r.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return e.length>0?Q(ot(e)).describe(`"${r.label}", one ore many values based on the predefined options`):Q(G()).describe(`"${r.label}", multiple selection values`)}function qt(r){const{name:e,type:n,fields:t}=r;if(!t||Object.keys(t).length===0)return;const s={};for(const a of Object.values(t)){if(a.disabled||a.hidden||ct.has(a.type))continue;const i=lt(a);s[a.name]=i}return _e({type:Cr(n),content:_e(s)}).describe(`Kirby block: ${e}`)}function Ar(r){if(!Array.isArray(r)||r.length===0)throw new Error("Invalid fieldsets configuration");const e=r.map(qt).filter(Boolean);return Ft(e).describe("Union of all Kirby block types")}let Ue,je;function Fe(){async function r(){return Ue||je||(je=window.panel.api.get(Nn).then(t=>(Ue=t,je=void 0,Ue)),je)}async function e(t){let s=await r();const{config:a}=await Y();if(a.excludedBlocks&&Array.isArray(a.excludedBlocks)&&(s=s.filter(i=>!a.excludedBlocks.includes(i.type))),t.fieldsets){const i=Array.isArray(t.fieldsets)?t.fieldsets:Object.keys(t.fieldsets);s=s.filter(o=>i.includes(o.type))}return Ar(s)}function n(t){return t.isHidden??(t.isHidden=!1),t.id??(t.id=crypto.randomUUID()),t}return{getFieldsets:r,getZodSchema:e,normalizeBlock:n}}function $r(r,e,n,t){let s;const a=()=>{s==null||s(),s=void 0},i=(l,d,g,_)=>(l.addEventListener(d,g,_),()=>l.removeEventListener(d,g,_)),o=qe(()=>Tr(r),l=>{a(),l&&(s=i(l,e,n,t))},{immediate:!0,flush:"post"}),c=()=>{o(),a()};return kn()&&Sn(c),c}function Tr(r){const e=We(r);return(e==null?void 0:e.$el)??e}function Ht(){return Kn({accept:[...Ye,"application/pdf"].join(",")})}function Ir(r){const e=new Set;for(const n of r)for(const t of n)typeof t=="string"&&t.trim()&&e.add(t);return[...e]}function jr(r,e){const n=r.map(qt).filter(Boolean),t=n.length>1?Ft(n):n[0];return _e({width:ot(e).describe('Column width fraction to use, e.g. "1/2"'),blocks:Q(t).describe("Array of blocks contained in this column")})}function Er(r,e){const n=jr(r,e);return _e({columns:Q(n).min(1).describe("Array of columns in this layout")})}function Or(r,e={}){if(!r||r.length===0)throw new Error("No fieldsets available for layout schema generation");const n=e.layouts??[["1/1"]],t=Ir(n),s=Er(r,t),a=n.map(i=>`"${i}"`).join(", ");return s.describe(`Kirby layout with columns and blocks. Available layout combinations: ${a}. Use these exact column width combinations when creating layouts.`)}function ft(){const{getFieldsets:r}=Fe();async function e(t){let s=await r();const{config:a}=await Y();if(a.excludedBlocks&&Array.isArray(a.excludedBlocks)&&(s=s.filter(i=>!a.excludedBlocks.includes(i.type))),t.fieldsets){const i=Array.isArray(t.fieldsets)?t.fieldsets:Object.keys(t.fieldsets);s=s.filter(o=>i.includes(o.type))}return Or(s,t)}function n(t){return t.id??(t.id=crypto.randomUUID()),t.attrs??(t.attrs=[]),t.columns=(t.columns??[]).map(s=>(s.id??(s.id=crypto.randomUUID()),s.width??(s.width="1/1"),s.blocks=(s.blocks??[]).map(a=>(a.isHidden??(a.isHidden=!1),a.id??(a.id=crypto.randomUUID()),a)),s)),t}return{getZodSchema:e,normalizeLayout:n}}function Pr(r){return typeof r=="string"?`'${r}'`:new Lr().serialize(r)}const Lr=function(){var e;class r{constructor(){dn(this,e,new Map)}compare(t,s){const a=typeof t,i=typeof s;return a==="string"&&i==="string"?t.localeCompare(s):a==="number"&&i==="number"?t-s:String.prototype.localeCompare.call(this.serialize(t,!0),this.serialize(s,!0))}serialize(t,s){if(t===null)return"null";switch(typeof t){case"string":return s?t:`'${t}'`;case"bigint":return`${t}n`;case"object":return this.$object(t);case"function":return this.$function(t)}return String(t)}serializeObject(t){const s=Object.prototype.toString.call(t);if(s!=="[object Object]")return this.serializeBuiltInType(s.length<10?`unknown:${s}`:s.slice(8,-1),t);const a=t.constructor,i=a===Object||a===void 0?"":a.name;if(i!==""&&globalThis[i]===a)return this.serializeBuiltInType(i,t);if(typeof t.toJSON=="function"){const o=t.toJSON();return i+(o!==null&&typeof o=="object"?this.$object(o):`(${this.serialize(o)})`)}return this.serializeObjectEntries(i,Object.entries(t))}serializeBuiltInType(t,s){const a=this["$"+t];if(a)return a.call(this,s);if(typeof(s==null?void 0:s.entries)=="function")return this.serializeObjectEntries(t,s.entries());throw new Error(`Cannot serialize ${t}`)}serializeObjectEntries(t,s){const a=Array.from(s).sort((o,c)=>this.compare(o[0],c[0]));let i=`${t}{`;for(let o=0;o<a.length;o++){const[c,l]=a[o];i+=`${this.serialize(c,!0)}:${this.serialize(l)}`,o<a.length-1&&(i+=",")}return i+"}"}$object(t){let s=Pe(this,e).get(t);return s===void 0&&(Pe(this,e).set(t,`#${Pe(this,e).size}`),s=this.serializeObject(t),Pe(this,e).set(t,s)),s}$function(t){const s=Function.prototype.toString.call(t);return s.slice(-15)==="[native code] }"?`${t.name||""}()[native]`:`${t.name}(${t.length})${s.replace(/\s*\n\s*/g,"")}`}$Array(t){let s="[";for(let a=0;a<t.length;a++)s+=this.serialize(t[a]),a<t.length-1&&(s+=",");return s+"]"}$Date(t){try{return`Date(${t.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(t){return`ArrayBuffer[${new Uint8Array(t).join(",")}]`}$Set(t){return`Set${this.$Array(Array.from(t).sort((s,a)=>this.compare(s,a)))}`}$Map(t){return this.serializeObjectEntries("Map",t.entries())}}e=new WeakMap;for(const n of["Error","RegExp","URL"])r.prototype["$"+n]=function(t){return`${n}(${t})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])r.prototype["$"+n]=function(t){return`${n}[${t.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])r.prototype["$"+n]=function(t){return`${n}[${t.join("n,")}${t.length>0?"n":""}]`};return r}(),Rr=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Mr=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",ue=[];class zr{constructor(){H(this,"_data",new be);H(this,"_hash",new be([...Rr]));H(this,"_nDataBytes",0);H(this,"_minBufferSize",0)}finalize(e){e&&this._append(e);const n=this._nDataBytes*8,t=this._data.sigBytes*8;return this._data.words[t>>>5]|=128<<24-t%32,this._data.words[(t+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(t+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(e,n){const t=this._hash.words;let s=t[0],a=t[1],i=t[2],o=t[3],c=t[4],l=t[5],d=t[6],g=t[7];for(let _=0;_<64;_++){if(_<16)ue[_]=e[n+_]|0;else{const P=ue[_-15],te=(P<<25|P>>>7)^(P<<14|P>>>18)^P>>>3,F=ue[_-2],W=(F<<15|F>>>17)^(F<<13|F>>>19)^F>>>10;ue[_]=te+ue[_-7]+W+ue[_-16]}const k=c&l^~c&d,T=s&a^s&i^a&i,I=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),j=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),C=g+j+k+Mr[_]+ue[_],R=I+T;g=d,d=l,l=c,c=o+C|0,o=i,i=a,a=s,s=C+R|0}t[0]=t[0]+s|0,t[1]=t[1]+a|0,t[2]=t[2]+i|0,t[3]=t[3]+o|0,t[4]=t[4]+c|0,t[5]=t[5]+l|0,t[6]=t[6]+d|0,t[7]=t[7]+g|0}_append(e){typeof e=="string"&&(e=be.fromUtf8(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_process(e){let n,t=this._data.sigBytes/64;e?t=Math.ceil(t):t=Math.max((t|0)-this._minBufferSize,0);const s=t*16,a=Math.min(s*4,this._data.sigBytes);if(s){for(let i=0;i<s;i+=16)this._doProcessBlock(this._data.words,i);n=this._data.words.splice(0,s),this._data.sigBytes-=a}return new be(n,a)}}class be{constructor(e,n){H(this,"words");H(this,"sigBytes");e=this.words=e||[],this.sigBytes=n===void 0?e.length*4:n}static fromUtf8(e){const n=unescape(encodeURIComponent(e)),t=n.length,s=[];for(let a=0;a<t;a++)s[a>>>2]|=(n.charCodeAt(a)&255)<<24-a%4*8;return new be(s,t)}toBase64(){const e=[];for(let n=0;n<this.sigBytes;n+=3){const t=this.words[n>>>2]>>>24-n%4*8&255,s=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,a=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,i=t<<16|s<<8|a;for(let o=0;o<4&&n*8+o*6<this.sigBytes*8;o++)e.push(Nr.charAt(i>>>6*(3-o)&63))}return e.join("")}concat(e){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<e.sigBytes;n++){const t=e.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=t<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<e.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=e.words[n>>>2];this.sigBytes+=e.sigBytes}}function Br(r){return new zr().finalize(r).toBase64()}function Zr(r){return Br(Pr(r))}function Yt(...r){return`${Bn}${Zr([...r])}`}const Jt=50;function Dr(){const r=Yt("history",window.location.hostname),e=x(JSON.parse(localStorage.getItem(r)||"[]")),n=x(""),t=x(-1);function s(i){if(!i||typeof i!="string"||!i.trim())return;const o=i.trim(),c=e.value.indexOf(o);c!==-1&&e.value.splice(c,1),e.value.unshift(o),e.value.length>Jt&&(e.value=e.value.slice(0,Jt)),localStorage.setItem(r,JSON.stringify(e.value)),t.value=-1}function a(i){if(e.value.length!==0){if(i==="up"){if(t.value+1<e.value.length)return t.value++,e.value[t.value]}else if(i==="down"){if(t.value>0)return t.value--,e.value[t.value];if(t.value===0)return t.value=-1,n.value}}}return{lastPrompt:n,currentIndex:t,addToHistory:s,navigateHistory:a}}const Ur=Object.assign({inheritAttrs:!1},{__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String,default:void 0}},emits:["input","mounted"],setup(r,{emit:e}){const n=r,t=x(),s=re({get(){return n.value},set(a){e("input",a)}});return yt(()=>{e("mounted",t.value)}),{__sfc:!0,props:n,emit:e,textarea:t,text:s}}});var Fr=function(){var e=this,n=e._self._c,t=e._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",e._b({directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:e.sharedClass,domProps:{value:t.text},on:{input:function(s){s.target.composing||(t.text=s.target.value)}}},"textarea",e.$attrs,!1)),e._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:e.sharedClass,domProps:{textContent:e._s(`${e.value} `)}})])},Vr=[],Kr=we(Ur,Fr,Vr,!1,null,"a814ce2d");const Gr=Kr.exports,Wr={__name:"Prompt",props:{fields:{type:Array,default:()=>[]},selection:{type:String,default:""}},emits:["cancel","close","input","submit","success"],setup(r,{emit:e}){const n=xe(),t=$(),{lastPrompt:s,currentIndex:a,addToHistory:i,navigateHistory:o}=Dr(),c=x(),l=x(),d=x([]),g=x([]),_=x("append"),k=x(""),T=x();$r(c,"keydown",C=>{if((C.metaKey||C.ctrlKey)&&C.key==="Enter"&&I(),C.key==="ArrowUp"&&C.target.selectionStart===0||C.key==="ArrowDown"&&C.target.selectionStart===C.target.value.length){C.preventDefault(),C.key==="ArrowUp"&&a.value===-1&&(s.value=k.value);const R=o(C.key==="ArrowUp"?"up":"down");R!==void 0&&(k.value=R)}}),(async()=>{const C=await Y();T.value=C.licenseStatus})();function I(){i(k.value),e("submit",{prompt:k.value,files:d.value,fields:g.value,append:_.value==="append"})}async function j(){const C=await Ht();d.value=[...d.value,...C]}return{__sfc:!0,emit:e,_isKirby5:n,panel:t,lastPrompt:s,currentIndex:a,addToHistory:i,navigateHistory:o,textarea:c,picklist:l,files:d,selectedFields:g,insertOption:_,prompt:k,licenseStatus:T,submit:I,pickFiles:j,LicensingButtonGroup:_t,AutoGrowTextarea:Gr}}};var qr=function(){var e=this,n=e._self._c,t=e._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(s){return t.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] focus-within:kai-outline focus-within:kai-outline-[2px] focus-within:kai-outline-[var(--color-focus,currentColor)]"},[n(t.AutoGrowTextarea,{attrs:{value:t.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:t.panel.t("johannschopplich.copilot.prompt.placeholder")+(e.selection?` (${t.panel.t("johannschopplich.copilot.prompt.selectionContext")})`:""),rows:"3"},on:{input:function(s){t.prompt=s},mounted:function(s){t.textarea=s}}}),n("div",{staticClass:"kai-flex kai-items-center kai-justify-between kai-px-2 kai-pb-2"},[n("k-button-group",{staticClass:"kai-gap-1"},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{theme:"empty",icon:"attachment",badge:t._isKirby5&&t.files.length>0?{theme:"notice",text:t.files.length}:void 0},on:{click:function(s){return t.pickFiles()}}}),t.files.length>0?n("k-button",{attrs:{text:t.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(s){t.files=[]}}}):e._e()],1),n("div",{staticClass:"kai-flex kai-gap-2"},[e.fields.length>0?[n("k-button",{attrs:{text:t.panel.t("johannschopplich.copilot.fields"),variant:"filled",badge:t.selectedFields.length>0?{theme:"info",text:t.selectedFields.length}:void 0,dropdown:""},on:{click:function(s){return t.picklist.toggle()}}}),n("k-picklist-dropdown",{ref:"picklist",attrs:{options:e.fields.map(s=>({value:s.name,text:s.label||s.name})),empty:!1,value:t.selectedFields},on:{input:function(s){t.selectedFields=s}}})]:e.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:[{value:"append",text:t.panel.t("johannschopplich.copilot.append")},{value:"replace",text:t.panel.t("johannschopplich.copilot.replace")}],empty:!1,value:t.insertOption},on:{input:function(s){t.insertOption=s}}}):e._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling",disabled:!t.prompt.trim()||e.fields.length>0&&t.selectedFields.length===0},on:{click:function(s){return t.submit()}}},[e._v(" "+e._s(t.panel.t("johannschopplich.copilot.generate"))+" ")])],2)],1),t.licenseStatus!==void 0?n(t.LicensingButtonGroup,{staticClass:"kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":t.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):e._e()],1)])},Hr=[],Yr=we(Wr,qr,Hr,!1,null,null);const Jr=Yr.exports,Xr={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};var Xt="vercel.ai.error",Qr=Symbol.for(Xt),Qt,es=class fn extends Error{constructor({name:e,message:n,cause:t}){super(n),this[Qt]=!0,this.name=e,this.cause=t}static isInstance(e){return fn.hasMarker(e,Xt)}static hasMarker(e,n){const t=Symbol.for(n);return e!=null&&typeof e=="object"&&t in e&&typeof e[t]=="boolean"&&e[t]===!0}};Qt=Qr;var en=es,tn="AI_InvalidArgumentError",nn=`vercel.ai.error.${tn}`,ts=Symbol.for(nn),rn,ns=class extends en{constructor({message:r,cause:e,argument:n}){super({name:tn,message:r,cause:e}),this[rn]=!0,this.argument=n}static isInstance(r){return en.hasMarker(r,nn)}};rn=ts,new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var rs=({prefix:r,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:t="-"}={})=>{const s=()=>{const a=n.length,i=new Array(e);for(let o=0;o<e;o++)i[o]=n[Math.random()*a|0];return i.join("")};if(r==null)return s;if(n.includes(t))throw new ns({argument:"separator",message:`The separator "${t}" must not be part of the alphabet "${n}".`});return()=>`${r}${t}${s()}`};rs();function pt(r){return r instanceof Error&&(r.name==="AbortError"||r.name==="TimeoutError")}const sn={...Xr},ss=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:sn,setup(r){const e=r,n=xe(),t=$(),{t:s}=hn(),{currentContent:a,update:i}=Ke(),o=x(),c=x(),l=x(),d=x(),g=x(),_=x(),k=x(),T=x(),I=x(),j=x(),C=x(),R=x(!1),P=x(!1),te=x(!1),F=x(),W=x(),Z=x(),A=x([]),D=x([]),Ve=x();let q,U;const Ee=re(()=>!P.value&&Z.value!==void 0);qe(W,N=>{R.value&&g.value&&(N&&N!==l.value?localStorage.setItem(`${q}$prompt`,N):(!N||N===l.value)&&localStorage.removeItem(`${q}$prompt`))}),qe(te,N=>{R.value&&g.value&&(N?localStorage.setItem(`${q}$open`,"true"):localStorage.removeItem(`${q}$open`))}),(async()=>{var Oe;const{load:N}=mn(),[de,O]=await Promise.all([Y(),N({parent:e.parent,name:e.name})]);if(o.value=s(O.label)||t.t("johannschopplich.copilot.label"),c.value=O.field??void 0,l.value=O.userPrompt??void 0,d.value=O.systemPrompt||de.config.systemPrompt||Je,g.value=O.storage,O.editable===!0&&A.value.push("edit"),O.files===!0&&A.value.push("files"),_.value=O.theme||"notice-icon",k.value=O.size||"md",T.value=zn.indexOf(de.config.logLevel??O.logLevel),j.value=O.help?s(O.help):void 0,C.value=de.config,Ve.value=de.licenseStatus,O.files==="auto"&&O.modelFile){I.value=O.modelFile;const{mime:z,url:ke}=O.modelFile;Ye.includes(z)&&fetch(ke).then(ne=>ne.blob()).then(ne=>{D.value=[ne]})}g.value&&((Oe=c.value)!=null&&Oe.name)&&(q=Yt(t.view.path,c.value.name.toLowerCase()),W.value=localStorage.getItem(`${q}$prompt`)||l.value||"",te.value=localStorage.getItem(`${q}$open`)==="true"||O.open,xn(()=>{F.value&&te.value&&(F.value.open=!0)})),t.events.on("view.save",ht),R.value=!0})(),wn(()=>{t.events.off("view.save",ht)});async function _s(){if(!W.value){t.notification.error(t.t("johannschopplich.copilot.prompt.empty"));return}t.isLoading=!0,P.value=!0,Z.value=a.value[c.value.name.toLowerCase()],U=new AbortController;const{getZodSchema:N,normalizeBlock:de}=Fe(),{getZodSchema:O,normalizeLayout:Oe}=ft();try{let z="",ke=[];if(c.value.type==="layout"||c.value.type==="blocks"){const ne=await(c.value.type==="layout"?O:N)(c.value),{partialObjectStream:fe,object:ws}=await wt({userPrompt:W.value,systemPrompt:d.value,schema:ne,output:"array",files:D.value,logLevel:T.value,abortSignal:U.signal});for await(const mt of fe)!mt||!Array.isArray(mt)||await i({[c.value.name.toLowerCase()]:[...Z.value,...mt.map(c.value.type==="layout"?Oe:de)]},!1);ke=await ws}else{const{textStream:ne}=await xt({userPrompt:[`<response_format>
${Zn[c.value.type]||"text"}
</response_format>`,W.value].join(`

`),systemPrompt:d.value,files:D.value,logLevel:T.value,abortSignal:U.signal});for await(const fe of ne)z+=fe,await i({[c.value.name.toLowerCase()]:Z.value+z},!1)}await i({[c.value.name.toLowerCase()]:c.value.type==="layout"||c.value.type==="blocks"?[...Z.value,...(ke??[]).map(c.value.type==="layout"?Oe:de)]:Z.value+z}),t.notification.success({icon:"sparkling",message:t.t("johannschopplich.copilot.generator.success")})}catch(z){if(pt(z))return;const{AISDKError:ke,APICallError:ne}=await oe("ai");if(z instanceof Se||ke.isInstance(z)||ne.isInstance(z)){let fe=z.message;fe.includes("levels of nesting exceeds limit")&&(fe=`The ${c.value.type} generation for the "${c.value.name}" field exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas.`),console.error(z),t.notification.error(fe);return}console.error(z),t.notification.error(t.t("johannschopplich.copilot.generator.error"))}finally{U=void 0,t.isLoading=!1,P.value=!1}}function bs(){U==null||U.abort(),U=void 0,t.isLoading=!1,P.value=!1}function ks(){i({[c.value.name.toLowerCase()]:Z.value}),Z.value=void 0}async function xs(){const N=await Ht();D.value=[...D.value,...N]}function ht(){Ee.value&&(Z.value=void 0)}return{__sfc:!0,propsDefinition:sn,props:e,_isKirby5:n,panel:t,t:s,currentContent:a,updateContent:i,label:o,field:c,userPrompt:l,systemPrompt:d,storage:g,theme:_,size:k,logLevel:T,modelFile:I,help:j,config:C,isInitialized:R,isGenerating:P,isDetailsOpen:te,detailsElement:F,currentPrompt:W,currentFieldContent:Z,permissions:A,files:D,licenseStatus:Ve,storageKey:q,abortController:U,canUndo:Ee,generate:_s,abort:bs,undo:ks,pickFiles:xs,onModelSave:ht,LicensingButtonGroup:_t,SUPPORTED_IMAGE_MIME_TYPES:Ye,SUPPORTED_PROVIDERS:bt}}});var as=function(){var s,a,i,o,c,l;var e=this,n=e._self._c,t=e._self._setupProxy;return t.isInitialized?n("k-section",{attrs:{label:t.label}},[t.licenseStatus!==void 0?n("template",{slot:"options"},[n(t.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":t.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):e._e(),!t.config.provider||!t.SUPPORTED_PROVIDERS.includes(t.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Unsupported provider "),n("code",[e._v(e._s(t.config.provider))]),e._v(" in the "),n("code",[e._v("johannschopplich.copilot.provider")]),e._v(" global configuration. ")])],1):(a=(s=t.config.providers)==null?void 0:s[t.config.provider])!=null&&a.apiKey?(o=(i=t.config.providers)==null?void 0:i[t.config.provider])!=null&&o.model?!t.field||typeof t.field=="string"||typeof t.field=="object"&&!(((c=t.field)==null?void 0:c.name.toLowerCase())in t.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" The "),n("code",[e._v(e._s(((l=t.field)==null?void 0:l.name)??t.field))]),e._v(" field does not exist in the current model. ")])],1):!t.permissions.includes("edit")&&!t.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" If the user prompt cannot be edited by the user, a default "),n("code",[e._v("userPrompt")]),e._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:t.isGenerating?"loader":"sparkling",text:t.panel.t("johannschopplich.copilot.generate"),theme:t.theme,variant:"filled",size:t.size,disabled:t.isGenerating},on:{click:function(d){return t.generate()}}}),t.isGenerating?n("k-button",{attrs:{icon:"cancel",text:t.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:t.size},on:{click:function(d){return t.abort()}}}):e._e(),t.canUndo?n("k-button",{attrs:{icon:"undo",text:t.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:t.size},on:{click:function(d){return t.undo()}}}):e._e()],1),t.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(d){t.isDetailsOpen=d.target.open}}},[n("summary",[e._v(" "+e._s([...t.permissions.includes("edit")?[t.panel.t("johannschopplich.copilot.prompt.label")]:[],...t.permissions.includes("files")?[t.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[t.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:t.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:t.currentPrompt,placeholder:t.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(d){t.currentPrompt=d}}})],1):e._e(),t.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:t.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:t._isKirby5&&t.files.length>0?{theme:"notice",text:t.files.length}:void 0,size:"sm"},on:{click:function(d){return t.pickFiles()}}}),t.files.length>0?n("k-button",{attrs:{text:t.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(d){t.files=[]}}}):e._e(),t.permissions.includes("edit")&&t.userPrompt&&t.currentPrompt!==t.userPrompt?n("k-button",{staticClass:"kai-ml-auto",attrs:{icon:"undo",text:t.panel.t("johannschopplich.copilot.reset"),variant:"dimmed",size:"xs"},on:{click:function(d){t.currentPrompt=t.userPrompt}}}):e._e()],1):t.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[e._v(" "+e._s(t.panel.t(`johannschopplich.copilot.context.file.${t.SUPPORTED_IMAGE_MIME_TYPES.includes(t.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):e._e()],1)]):e._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Missing "),n("code",[e._v("model")]),e._v(" property in the "),n("code",[e._v(e._s(`johannschopplich.copilot.providers.${t.config.provider}`))]),e._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Missing "),n("code",[e._v("apiKey")]),e._v(" property in the "),n("code",[e._v(e._s(`johannschopplich.copilot.providers.${t.config.provider}`))]),e._v(" global configuration. ")])],1),t.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:t.help}})],1):e._e()],2):e._e()},is=[],os=we(ss,as,is,!1,null,null);const cs=os.exports;async function an(r,{appendText:e,replaceText:n,responseFormat:t="text"}){const s=$(),a=new AbortController,i=k=>{k.key==="Escape"&&a.abort()},o=await on({selection:r});if(!o)return;const{prompt:c,files:l}=o;if(!c)return;s.isLoading=!0,document.addEventListener("keydown",i);const{config:d}=await Y(),{AISDKError:g,APICallError:_}=await oe("ai");try{const{textStream:k}=await xt({userPrompt:[`<response_format>
${t}
</response_format>`,r&&`<selected_text>
${r}
</selected_text>`,c].filter(Boolean).join(`

`),systemPrompt:d.systemPrompt||Je,files:l,abortSignal:a.signal});let T=!0;for await(let I of k)o.append?(T&&(I=r?` ${I}`:I,T=!1),e(I)):n(I);s.notification.success({icon:"sparkling",message:s.t("johannschopplich.copilot.generator.success")})}catch(k){if(pt(k))return;if(k instanceof Se||g.isInstance(k)||_.isInstance(k)){console.error(k),s.notification.error(k.message);return}console.error(k),s.notification.error(s.t("johannschopplich.copilot.generator.error"))}finally{s.isLoading=!1,document.removeEventListener("keydown",i)}}async function on(r={}){return new Promise(e=>{const n=$();let t;n.dialog.open({component:"k-copilot-prompt-dialog",props:r,on:{close:()=>{setTimeout(()=>{e(t)},25)},submit:s=>{t=s,n.dialog.close()}}})})}const ls={__name:"CopilotButton",setup(r){const e=$(),{currentContent:n,update:t}=Ke(),s=x(!1),a=x(!1);let i;async function o(){i=new AbortController;const d=A=>{A.key==="Escape"&&c()};let g=await e.api.get(Mn,{id:e.view.path},void 0,!0);if(g=Object.values(g).filter(A=>!ct.has(A.type)&&!A.disabled&&!A.hidden),g.length===0){e.notification.error(e.t("johannschopplich.copilot.generator.noFields"));return}const _=await on({fields:g});if(!_)return;const{prompt:k,files:T,fields:I}=_,j=g.filter(A=>I.includes(A.name));if(!k||j.length===0)return;const{getZodSchema:C}=Fe(),{getZodSchema:R}=ft(),P={};for(const A of j)A.type==="layout"?P[A.name]=Q(await R(A)):A.type==="blocks"?P[A.name]=Q(await C(A)):P[A.name]=lt(A);e.isLoading=!0,s.value=!0,document.addEventListener("keydown",d);const te={...n.value},{config:F}=await Y(),{AISDKError:W,APICallError:Z}=await oe("ai");try{const{partialObjectStream:A,object:D}=await wt({userPrompt:k,systemPrompt:F.systemPrompt||Je,schema:_e(P),output:"object",files:T,abortSignal:i.signal});for await(const U of A){if(!U)continue;const Ee=l({object:U,selectedFields:j,currentContent:te});Object.keys(Ee).length>0&&await t(Ee,!1)}const Ve=await D,q=l({object:Ve,selectedFields:j,currentContent:te});await t(q),e.notification.success({icon:"sparkling",message:e.t("johannschopplich.copilot.generator.success")})}catch(A){if(pt(A))return;if(A instanceof Se||W.isInstance(A)||Z.isInstance(A)){let D=A.message;D.includes("levels of nesting exceeds limit")&&(D="The fields generation exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas."),console.error(A),e.notification.error(D);return}console.error(A),e.notification.error(e.t("johannschopplich.copilot.generator.error"))}finally{i=void 0,e.isLoading=!1,s.value=!1,document.removeEventListener("keydown",d)}}function c(){i==null||i.abort(),i=void 0,s.value=!1,e.isLoading=!1}function l({object:d,selectedFields:g,currentContent:_}){const{normalizeBlock:k}=Fe(),{normalizeLayout:T}=ft(),I={};for(const j of g){const C=d[j.name];if(C==null)continue;const R=_[j.name];j.type==="layout"||j.type==="blocks"?Array.isArray(C)&&(I[j.name]=[...R,...C.map(j.type==="layout"?T:k)]):I[j.name]=C}return I}return{__sfc:!0,panel:e,currentContent:n,updateContent:t,isGenerating:s,isHovering:a,abortController:i,initPromptDialog:o,abort:c,processFieldValues:l}}};var us=function(){var e=this,n=e._self._c,t=e._self._setupProxy;return n("k-button",{attrs:{icon:t.isHovering&&t.isGenerating?"cancel":t.isGenerating?"loader":"sparkling",text:t.panel.t("johannschopplich.copilot.label"),theme:t.isHovering&&t.isGenerating?"notice":"notice-icon",variant:"filled",size:"sm",responsive:""},on:{click:function(s){t.isHovering&&t.isGenerating?t.abort():t.initPromptDialog()}},nativeOn:{mouseenter:function(s){t.isHovering=!0},mouseleave:function(s){t.isHovering=!1}}})},ds=[],fs=we(ls,us,ds,!1,null,null);const cn=fs.exports,ps={},hs={copilot:{icon:"sparkling",label:"Copilot Prompt",click(){let r="";this.command("insert",(s,a)=>(r=a,a));let e=!0;an(r,{responseFormat:"markdown",appendText:s=>{this.command("insert",(a,i)=>e?(e=!1,i+s):s)},replaceText:s=>{this.command("insert",()=>s)}})},shortcut:"."}},ln={"***":["bold","italic"],"**":["bold"],"*":["italic"],"`":["code"]},ms={copilot:{get button(){return{icon:"sparkling",label:"Copilot Prompt"}},commands(r){return()=>this._openPromptDialog(r)},keys(r){return{"Mod-.":()=>this._openPromptDialog(r)}},get name(){return"copilot"},_insertText(r,e,n,t,s){let a=n;const i=e.split(/(\n\n?|\*{1,3}|`{1,3})/);for(const o of i)if(o===`

`)r=r.replaceWith(a,a,this.editor.options.inline?[s.schema.nodes.hardBreak.create(),s.schema.nodes.hardBreak.create()]:s.schema.nodes.paragraph.create()),a+=2;else if(o===`
`)r=r.replaceWith(a,a,s.schema.nodes.hardBreak.create()),a+=1;else if(o.length>0){if(o in ln&&!t.lastSegment.includes(o)||[...t.activeMarks].some(c=>c.type.name===o)){for(const c of ln[o])r=gs(r,c,t,s);t.lastSegment=o;continue}r=r.insertText(o,a),a+=o.length,t.lastSegment=o}return{tr:r,newPosition:a}},_openPromptDialog(r){const{state:e}=this.editor,{from:n,to:t}=e.selection,s=e.doc.textBetween(n,t),a={activeMarks:new Set,lastSegment:""};let i,o=!1;an(s,{responseFormat:"text",replaceText:d=>{const{state:g,view:_}=this.editor;let k=g.tr;if(!o){const j=ys(g),{from:C,to:R}=g.selection;k=k.deleteRange(C,R),i=j?1:C,o=!0}const{tr:T,newPosition:I}=this._insertText(k,d,i,a,r);i=I,_.dispatch(T)},appendText:d=>{const{state:g,view:_}=this.editor;i=g.selection.to;const{tr:k,newPosition:T}=this._insertText(g.tr,d,i,a,r);i=T,_.dispatch(k)}})}}};function gs(r,e,n,{schema:t}){if([...n.activeMarks].some(s=>s.type.name===e)){n.activeMarks.delete(e);const s=[...n.activeMarks].filter(a=>a.type.name!==e);return r.setStoredMarks(s)}else{const s=t.marks[e].create();return n.activeMarks.add(s),r.addStoredMark(s)}}function ys(r){const e=r.doc.content.size,{from:n,to:t}=r.selection;return n===0&&t===e}function vs(r){if(xe())return;let e;r.mixin({mounted(){if(this.$options.name!=="k-header")return;const n=this.$children.find(s=>s.$options.name==="k-button-group");if(!n)return;const t=r.extend(cn);e=new t({parent:this}),e.$mount(),n.$el.before(e.$el)},beforeDestroy(){this.$options.name==="k-header"&&e&&(e.$destroy(),e=void 0)}})}window.panel.plugin("johannschopplich/copilot",{viewButtons:{copilot:cn},components:{"k-copilot-prompt-dialog":Jr},sections:{copilot:cs},fields:{},textareaButtons:hs,writerMarks:ms,icons:ps,use:[vs]})})();

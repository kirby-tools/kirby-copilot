var lh=Object.defineProperty;var ss=y=>{throw TypeError(y)};var ch=(y,z,oe)=>z in y?lh(y,z,{enumerable:!0,configurable:!0,writable:!0,value:oe}):y[z]=oe;var ke=(y,z,oe)=>ch(y,typeof z!="symbol"?z+"":z,oe),uh=(y,z,oe)=>z.has(y)||ss("Cannot "+oe);var It=(y,z,oe)=>(uh(y,z,"read from private field"),oe?oe.call(y):z.get(y)),as=(y,z,oe)=>z.has(y)?ss("Cannot add the same private member more than once"):z instanceof WeakSet?z.add(y):z.set(y,oe);(function(){"use strict";const y=window.Vue;function z(){return window.panel}function oe(){return z().api}const He=()=>window.panel.plugins.viewButtons!==void 0;function ls(){return He()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):z().app.$store}function mn(){const t=z(),e=ls(),n=He();if(n&&!("diff"in t.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const r=H(n?()=>t.content.version("changes"):()=>e.getters["content/values"]()),o=H(n?()=>t.content.diff():()=>e.getters["content/changes"]()),i=H(n?()=>t.content.hasDiff():()=>e.getters["content/hasChanges"]()),s=n?t.content:new Proxy({},{get(){return()=>{}}});return{content:s,currentContent:r,contentChanges:o,hasChanges:i,update:async(l,c=!0)=>{if(!n&&l)for(const[f,p]of Object.entries(l))e.dispatch("content/update",[f,p]);const u=s.merge(l);c&&await s.save(u)}}}function Tr(){const t=He();function e(r){let o=!1;return new Promise(i=>{const s=z();s.dialog.open({component:"k-text-dialog",props:{text:r},on:{submit:()=>{o=!0,s.dialog.close()},...t?{closed:()=>{i(o)}}:{close:()=>{setTimeout(()=>i(o),25)}}}})})}function n(r){let o;const{onSubmit:i,...s}=r;return new Promise(a=>{const l=z();l.dialog.open({component:"k-form-dialog",props:s,on:{submit:async c=>{const u=c;if(i)try{const f=await i(u);if(f===!1)return;o=f}catch{return}else o=u;l.dialog.close()},...t?{closed:()=>{a(o)}}:{close:()=>{setTimeout(()=>a(o),0)}}}})})}return{openTextDialog:e,openFieldsDialog:n}}function cs(){const t=z();function e(n){return!n||typeof n=="string"?n:n[t.translation.code]??Object.values(n)[0]}return{t:e}}function us(){const t=oe();return{load:({parent:n,name:r})=>t.get(`${n}/sections/${r}`)}}const fs=["localhost","127.0.0.1","[::1]"],ps=["localhost","local","test","ddev.site"];function ds(){const{hostname:t}=window.location,e=fs.includes(t),n=ps.some(r=>t.endsWith(`.${r}`));return e||n}const hs={error:0,warn:1,log:2,info:3,success:3};function ms(t){const e=new gs;return new Proxy({},{get(n,r){return(...o)=>{e.log({level:hs[r],type:r,tag:t,args:o})}}})}var gs=class{constructor(){ke(this,"defaultColor","#7f8c8d");ke(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});ke(this,"typeColorMap",{success:"#2ecc71"})}log(t){const e=ys(t.level),n=t.type==="log"?"":t.type,r=t.tag||"",o=`
background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),i=`%c${[r,n].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?e(`${i}%c ${t.args[0]}`,o,"",...t.args.slice(1)):e(i,o,...t.args)}};function ys(t){return t<1?console.error:console.log}const Nt=[],gn=new Map;async function bs(t){if(!Array.isArray(t))throw new TypeError(`Expected an array, got ${typeof t}`);for(const e of t)Nt.some(n=>n.filename===e.filename)||Nt.push(e)}function $r(t){if(Nt.length===0)throw new Error("Plugin assets not registered");const e=Nt.find(n=>n.filename===t);if(!e)throw new Error(`Plugin asset "${t}" not found`);return e}async function Er(t){if(t.endsWith(".js")||(t+=".js"),gn.has(t))return gn.get(t);const e=await import($r(t).url);return gn.set(t,e),e}const H=y.computed;y.customRef,y.defineAsyncComponent,y.defineComponent;const vs=y.effectScope;y.getCurrentInstance;const _s=y.getCurrentScope;y.h,y.inject,y.isProxy,y.isReactive,y.isReadonly,y.isRef,y.isShallow,y.markRaw;const ks=y.nextTick;y.onActivated,y.onBeforeMount;const ws=y.onBeforeUnmount;y.onBeforeUpdate,y.onDeactivated,y.onErrorCaptured;const Ss=y.onMounted;y.onRenderTracked,y.onRenderTriggered;const xs=y.onScopeDispose;y.onServerPrefetch,y.onUnmounted,y.onUpdated,y.provide,y.proxyRefs;const zs=y.reactive;y.readonly;const S=y.ref;y.shallowReactive,y.shallowReadonly,y.shallowRef,y.toRaw,y.toRef,y.toRefs,y.triggerRef;const yn=y.unref;y.useAttrs,y.useCssModule,y.useCssVars,y.useListeners,y.useSlots;const bn=y.watch;y.watchEffect,y.watchPostEffect,y.watchSyncEffect;const vn="The activation buttons appear to be hidden. Please purchase a license.",_n={de:{activate:"Aktivieren",buy:"Lizenz kaufen",upgrade:"Upgrade","notification.success":"Plugin aktiviert!"},en:{activate:"Activate",buy:"Buy a license",upgrade:"Upgrade","notification.success":"Plugin activated!"},es:{activate:"Activar",buy:"Comprar licencia",upgrade:"Actualizar","notification.success":"¡Plugin activado!"},fr:{activate:"Activer",buy:"Acheter une licence",upgrade:"Upgrade","notification.success":"Plugin activé !"},it:{activate:"Attiva",buy:"Acquista licenza",upgrade:"Aggiorna","notification.success":"Plugin attivato!"},nl:{activate:"Activeren",buy:"Koop een licentie",upgrade:"Upgrade","notification.success":"Plugin geactiveerd!"}},Os=["localhost","127.0.0.1","[::1]"],Ts=["localhost","local","test","ddev.site"];function $s(t,e,n){return t.replace(/\{(\w+)\}/g,(r,o)=>e[o]||o)}function Cr(t,e){var o;const n=window.panel.translation.code,r=((o=_n==null?void 0:_n[n])==null?void 0:o[t])??t;return e?$s(r,e):r}function Es(){const{hostname:t}=window.location,e=Os.includes(t),n=Ts.some(r=>t.endsWith(`.${r}`));return e||n}function Cs(t){const e=z(),{openFieldsDialog:n}=Tr();return{isLocalhost:Es(),assertActivationIntegrity:({component:s,licenseStatus:a})=>{var f;if(yn(a)==="active")return;const l=(f=yn(s))==null?void 0:f.$el;if(!l){e.notification.error(vn);return}const c=window.getComputedStyle(l);if(c.display==="none"||c.visibility==="hidden"||c.opacity==="0"||c.clipPath==="inset(100%)"||c.transform.includes("scale(0")){e.notification.error(vn);return}const u=l.getBoundingClientRect();(u.width===0||u.height===0||u.right<0||u.bottom<0||u.left>window.innerWidth||u.top>window.innerHeight)&&e.notification.error(vn)},openLicenseModal:async()=>{let s=!1;await n({fields:{info:{type:"info",text:e.t("kirby-tools.license.activate.info")},email:{label:e.t("kirby-tools.license.activate.email"),type:"email",required:!0},orderId:{label:e.t("kirby-tools.license.activate.orderId"),type:"text",required:!0,help:e.t("kirby-tools.license.activate.orderId.help")}},submitButton:{icon:"check",theme:"love",text:e.t("kirby-tools.license.activate.submit")},onSubmit:async a=>s?!1:(s=!0,await Ps(a,t)?(e.notification.success(Cr("notification.success")),await new Promise(l=>setTimeout(l,750)),window.location.reload(),new Promise(()=>{})):(s=!1,!1))})}}}async function Ps(t,e){var i;const n=z(),{email:r,orderId:o}=t;if(!r||!o)return!1;try{if(((i=await n.api.post(`${e.apiNamespace}/activate`,{email:r,orderId:Number(o)}))==null?void 0:i.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(s){return n.notification.error(s.message),!1}}const Is=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(t){const e=t,{openLicenseModal:n,assertActivationIntegrity:r}=Cs({label:e.label,apiNamespace:e.apiNamespace}),o=S(e.licenseStatus),i=S();Ss(()=>{r({component:i,licenseStatus:e.licenseStatus})});async function s(){await n()}return{__sfc:!0,props:e,openLicenseModal:n,assertActivationIntegrity:r,currentLicenseStatus:o,licenseButtonGroup:i,handleActivation:s,t:Cr}}});function qe(t,e,n,r,o,i,s,a){var l=typeof t=="function"?t.options:t;return e&&(l.render=e,l.staticRenderFns=n,l._compiled=!0),i&&(l._scopeId="data-v-"+i),{exports:t,options:l}}var Ns=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return r.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:r.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":e.pricingUrl,target:"_blank",text:r.currentLicenseStatus==="upgradeable"?r.t("upgrade"):r.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:r.t("activate")},on:{click:function(o){return r.handleActivation()}}})],1):e._e()},As=[],Ds=qe(Is,Ns,As,!1,null,null);const Pr=Ds.exports;function At(t){return Object.prototype.toString.call(t)==="[object Object]"}const Ms="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";function kn(t=16,e=Ms){let n="",r=t;const o=e.length;for(;r--;)n+=e[Math.random()*o|0];return n}const Rs="__copilot__/context",Ls="__copilot__/model-fields",Fs="__copilot__/fieldsets",Zs="__copilot__/proxy",js="__KIRBY_COPILOT_PROXY__",Ir="kirby$copilot$",Ye=["error","warn","info","debug"],Nr="warn",wn=["anthropic","google","mistral","openai"],Bs="low",Us={none:{anthropic:void 0,openai:"none","openai:gpt-5":"minimal","openai:gpt-5-mini":"minimal",google:"low","google:gemini-3-flash-preview":"minimal","google:gemini-3-flash":"minimal"},low:{anthropic:8e3,openai:"low",google:"low"},medium:{anthropic:16e3,openai:"medium",google:"medium","google:gemini-3-pro-preview":"high","google:gemini-3-pro":"high"},high:{anthropic:32e3,openai:"high",google:"high"}},Sn=`
You are a content assistant.

When <response_format> is provided, format your response as:
- "text": Plain text only, no formatting syntax.
- "markdown": Raw Markdown, no code fence wrappers.
- "rich-text": Use double newlines to separate paragraphs. For inline formatting, use HTML tags (<strong>, <em>, <code>, <a href="...">, etc.). Do NOT wrap paragraphs in <p> tags.

When <selection> is provided, use it as context for your response. Preserve any formatting (bold, italic, links, etc.) present in the selection unless the task explicitly requires different formatting.
`,Js={anthropic:"claude-haiku-4-5-20251001",google:"gemini-3-flash-preview",mistral:"mistral-small-latest",openai:"gpt-5-nano"},Vs=4e3,Ks=500,Ws=`
You are a writing assistant providing inline autocompletions.

RULES:
- Output ONLY the continuation text, NEVER repeat input
- Keep completions brief (1-2 sentences max)
- Match the existing tone and style
- No explanations or meta-commentary

FORMAT:
- If given <prefix> and <suffix> tags, insert text that bridges them naturally
- Otherwise, continue the text directly

EXAMPLE:
Input: "The quick brown fox"
Output: " jumps over the lazy dog."
`,xn=["image/gif","image/jpeg","image/png","image/webp"],Ar=[...xn,"application/pdf"],Gs=50*1024*1024,X={en:"IMPORTANT: Preserve all formatting (bold, italic, links, code, headings, lists, etc.) exactly as in the original.",de:"WICHTIG: Bewahre alle Formatierungen (fett, kursiv, Links, Code, Überschriften, Listen usw.) exakt wie im Original.",fr:"IMPORTANT : Conservez toutes les mises en forme (gras, italique, liens, code, titres, listes, etc.) exactement comme dans l'original.",nl:"BELANGRIJK: Behoud alle opmaak (vet, cursief, links, code, koppen, lijsten, enz.) exact zoals in het origineel."},Dr={en:[{label:"Fix Grammar & Spelling",prompt:`Fix all spelling and grammar errors in the given text. ${X.en} Only output the corrected text, nothing else.`},{label:"Make Concise",prompt:`Make the given text more concise by removing unnecessary words while keeping the meaning intact. ${X.en} Only output the reduced text, nothing else.`},{label:"Simplify",prompt:`Simplify the given text to make it easier to understand, using simpler words and shorter sentences. ${X.en} Only output the simplified text, nothing else.`},{label:"Extend",prompt:`Extend the given text with more details, examples, or explanations while maintaining the same style and tone. ${X.en} Only output the extended text, nothing else.`},{label:"Summarize",prompt:"Summarize the given text concisely while keeping the key points. Only output the summary, nothing else."}],de:[{label:"Grammatik & Rechtschreibung korrigieren",prompt:`Korrigiere alle Rechtschreib- und Grammatikfehler im gegebenen Text. ${X.de} Gib nur den korrigierten Text aus, sonst nichts.`},{label:"Kürzen",prompt:`Mache den gegebenen Text prägnanter, indem du unnötige Wörter entfernst, aber die Bedeutung beibehältst. ${X.de} Gib nur den gekürzten Text aus, sonst nichts.`},{label:"Vereinfachen",prompt:`Vereinfache den gegebenen Text, um ihn verständlicher zu machen, indem du einfachere Wörter und kürzere Sätze verwendest. ${X.de} Gib nur den vereinfachten Text aus, sonst nichts.`},{label:"Erweitern",prompt:`Erweitere den gegebenen Text mit mehr Details, Beispielen oder Erklärungen, während du den gleichen Stil und Ton beibehältst. ${X.de} Gib nur den erweiterten Text aus, sonst nichts.`},{label:"Zusammenfassen",prompt:"Fasse den gegebenen Text prägnant zusammen und behalte dabei die wichtigsten Punkte bei. Gib nur die Zusammenfassung aus, sonst nichts."}],fr:[{label:"Corriger grammaire et orthographe",prompt:`Corrigez toutes les erreurs d'orthographe et de grammaire dans le texte donné. ${X.fr} N'affichez que le texte corrigé, rien d'autre.`},{label:"Rendre concis",prompt:`Rendez le texte donné plus concis en supprimant les mots inutiles tout en conservant le sens. ${X.fr} N'affichez que le texte réduit, rien d'autre.`},{label:"Simplifier",prompt:`Simplifiez le texte donné pour le rendre plus facile à comprendre, en utilisant des mots plus simples et des phrases plus courtes. ${X.fr} N'affichez que le texte simplifié, rien d'autre.`},{label:"Développer",prompt:`Développez le texte donné avec plus de détails, d'exemples ou d'explications tout en conservant le même style et le même ton. ${X.fr} N'affichez que le texte développé, rien d'autre.`},{label:"Résumer",prompt:"Résumez le texte donné de manière concise tout en conservant les points clés. N'affichez que le résumé, rien d'autre."}],nl:[{label:"Grammatica & spelling corrigeren",prompt:`Corrigeer alle spelling- en grammaticafouten in de gegeven tekst. ${X.nl} Geef alleen de gecorrigeerde tekst weer, niets anders.`},{label:"Beknopter maken",prompt:`Maak de gegeven tekst beknopter door onnodige woorden te verwijderen terwijl de betekenis behouden blijft. ${X.nl} Geef alleen de verkorte tekst weer, niets anders.`},{label:"Vereenvoudigen",prompt:`Vereenvoudig de gegeven tekst om deze gemakkelijker te begrijpen, door eenvoudigere woorden en kortere zinnen te gebruiken. ${X.nl} Geef alleen de vereenvoudigde tekst weer, niets anders.`},{label:"Uitbreiden",prompt:`Breid de gegeven tekst uit met meer details, voorbeelden of uitleg terwijl dezelfde stijl en toon behouden blijven. ${X.nl} Geef alleen de uitgebreide tekst weer, niets anders.`},{label:"Samenvatten",prompt:"Vat de gegeven tekst beknopt samen terwijl de belangrijkste punten behouden blijven. Geef alleen de samenvatting weer, niets anders."}]};function De(){return Er("ai")}function Mr(){const t=z(),{currentContent:e}=mn(),n={...e.value,title:t.view.title};return Object.fromEntries(Object.entries(n).map(([r,o])=>[r,Array.isArray(o)||At(o)?JSON.stringify(Hs(o)?qs(o):o):String(o)]))}function Hs(t){return Array.isArray(t)&&t.length>0&&t.every(e=>At(e)&&"id"in e&&"type"in e&&"isHidden"in e&&"content"in e)}function qs(t){return t.map(({id:e,isHidden:n,...r})=>r)}class Dt extends Error{}async function zn(t){const e=z(),{AISDKError:n}=await De();if(t instanceof Dt||n.isInstance(t)){let r=t.message;r.includes("levels of nesting exceeds limit")&&(r="The fields generation exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas."),console.error(t),e.notification.error(r);return}console.error(t),e.notification.error(e.t("johannschopplich.copilot.notification.error"))}const Ys=.85,Xs=1024,Qs=new Set(["image/jpeg","image/webp","image/avif"]);function Rr({accept:t="*",multiple:e=!0}={}){return new Promise(n=>{const r=document.createElement("input");r.type="file",r.classList.add("sr-only"),r.accept=t,r.multiple=e;const o=()=>{r.remove()};r.addEventListener("change",i=>{var a;const s=(a=i.target)==null?void 0:a.files;n(s?[...s]:[]),o()},{once:!0}),window.addEventListener("focus",()=>{setTimeout(()=>{document.body.contains(r)&&(n([]),o())},300)},{once:!0}),document.body.appendChild(r),r.click()})}async function ea(t,e={}){const{maxDimension:n,quality:r=Ys,outputType:o}=e;if(!n&&!o)return t;const i=await ta(t);try{return await na(i,{mimeType:o??t.type,maxDimension:n,quality:r})}finally{i.src=""}}async function ta(t,e={}){if(!t.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${t.type}`);const n=new Image,r=URL.createObjectURL(t);e.crossOrigin&&(n.crossOrigin=e.crossOrigin);try{return await new Promise((o,i)=>{n.onload=()=>o(n),n.onerror=()=>i(new Error("Failed to load image from blob")),n.src=r})}finally{URL.revokeObjectURL(r)}}async function na(t,{mimeType:e,maxDimension:n,quality:r}){if(!t.complete||!t.naturalWidth)throw new Error("Image has not been properly loaded");if(!e.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${e}`);const o=t.naturalWidth,i=t.naturalHeight,s=n?Math.min(1,n/Math.max(o,i)):1,a=Math.round(o*s),l=Math.round(i*s);if(s===1&&e===t.src){const u=Mt(t,a,l);return On(u,e,r)}if(s<.5&&Math.max(o,i)>Xs)return ra(t,a,l,e,r);const c=Mt(t,a,l);return On(c,e,r)}async function ra(t,e,n,r,o){let i=t.naturalWidth,s=t.naturalHeight,a=t;try{for(;i>e*2||s>n*2;){const c=Math.max(e,Math.floor(i*.5)),u=Math.max(n,Math.floor(s*.5)),f=Mt(a,c,u);a!==t&&"close"in a&&a.close(),a=await createImageBitmap(f,{resizeQuality:"high"}),i=c,s=u}const l=Mt(a,e,n);return On(l,r,o)}finally{a!==t&&"close"in a&&a.close()}}function Mt(t,e,n){const r=typeof OffscreenCanvas<"u"?new OffscreenCanvas(e,n):document.createElement("canvas");"width"in r&&(r.width=e,r.height=n);const o=r.getContext("2d",{alpha:!0,willReadFrequently:!1});if(!o)throw new Error("Failed to get canvas 2D context");return o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.clearRect(0,0,e,n),o.drawImage(t,0,0,e,n),r}async function On(t,e,n){const r=Qs.has(e)?n:void 0;if(t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:r});const o=await new Promise(i=>{t.toBlob(i,e,r)});if(!o)throw new Error("Failed to convert canvas to Blob");return o}const oa=new Set(["br","hr","img","wbr"]);function Lr(t,{responseFormat:e,selection:n}={}){return[e&&`<response_format>${e}</response_format>`,n&&`<selection>
${n}
</selection>`,t].filter(Boolean).join(`

`)}function ia(t){return t.startsWith("gpt-5")||t.startsWith("gemini-2.5")||t.startsWith("gemini-3")||/^claude-[^-]+-4/.test(t)||t.startsWith("magistral")}function sa(){return t=>{if(!t)return null;const e=t.indexOf("<"),n=t.indexOf(`
`);if(e===-1&&n===-1)return t;const r=e===-1?n:n===-1?e:Math.min(e,n);return r>0?t.slice(0,r):r===n?t.match(/^\n+/)[0]:aa(t)}}function aa(t){if(!/^<\/?[a-z]/i.test(t))return t.length>1?"<":null;if(t.startsWith("</")){const s=t.indexOf(">");return s===-1?null:t.slice(0,s+1)}const e=t.match(/^<([a-z][a-z0-9-]*)(?:\s[^>]*)?(\/?)>/i);if(!e)return null;const[n,r,o]=e,i=r.toLowerCase();return o||oa.has(i)?n:la(t,i,n.length)}function la(t,e,n){const r=t.toLowerCase(),o=`<${e}`,i=`</${e}>`;let s=1,a=n;for(;s>0;){const l=r.indexOf(o,a),c=r.indexOf(i,a);if(c===-1)return null;if(l!==-1&&l<c)s++,a=l+o.length;else{if(s--,s===0)return t.slice(0,c+i.length);a=c+i.length}}return null}let ht;async function ca(t){const e=await fa(),n=await t.arrayBuffer(),r=await e.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:r.numPages},(i,s)=>ua(r,s+1)))).map(i=>i.replace(/\s+/g," ")).join(`
`)}async function ua(t,e){return(await(await t.getPage(e)).getTextContent()).items.filter(o=>"str"in o&&o.str!=null).map(o=>o.str).join(" ")}async function fa(){if(ht)return ht;ht=await Er("pdfjs");const t=$r("pdfjs.worker.js");return ht.GlobalWorkerOptions.workerSrc=t.url,ht}const Fr=/\{(\w+)\}/g;function Zr(t,e,n){return t.replace(Fr,(r,o)=>e[o.toLowerCase()]||((typeof n=="function"?n(o):n)??o))}let pa;function da(){return pa??(pa=ms("copilot"))}let Rt,mt;function ye(){return Rt?Promise.resolve(Rt):mt||(mt=window.panel.api.get(Rs,void 0,void 0,!0).then(t=>(bs(t.assets),Rt=t,mt=void 0,Rt)),mt)}async function gt({userPrompt:t,systemPrompt:e,output:n,responseFormat:r,files:o=[],logLevel:i=1,abortSignal:s,model:a,providerOptions:l}){const c=da(),{model:u,providerOptions:f}=a?{model:a,providerOptions:l}:await Tn(),{AISDKError:p,streamText:d,smoothStream:g}=await De(),{userPromptWithContext:m,imageByteArrays:b,pdfByteArrays:w}=await ha({userPrompt:t,files:o});i>1&&(c.info("System prompt:",e),c.info("User prompt:",m));const _=b.length>0||w.length>0;return d({model:u,providerOptions:f,output:n,system:e||void 0,..._?{messages:[{role:"user",content:[{type:"text",text:m},...b.map(v=>({type:"image",image:v})),...w.map(v=>({type:"file",data:v,mediaType:"application/pdf"}))]}]}:{prompt:m},...!n&&{experimental_transform:g({chunking:r==="rich-text"?sa():"line"})},abortSignal:s,onError({error:v}){if(p.isInstance(v))throw v;console.error("Unexpected error during text streaming:",v)}})}async function Tn({forCompletion:t=!1}={}){const e=z();let{config:n}=await ye();if(!n.provider||!wn.includes(n.provider))throw new Dt(`Unsupported provider "${n.provider}". Supported providers: ${wn.join(", ")}. Check "johannschopplich.copilot.provider" in your Kirby config.`);const{createAnthropic:r,createGoogleGenerativeAI:o,createMistral:i,createOpenAI:s}=await De(),a=n.provider,l=n.providers[a]??{},c={anthropic:r,google:o,mistral:i,openai:s}[a];if(!l.hasApiKey)throw new Dt(`Missing API key for the "${a}" provider. Add "apiKey" to "johannschopplich.copilot.providers.${a}" in your Kirby config.`);const u=(_,v)=>fetch(`${e.api.endpoint}/${Zs}?provider=${a}`,{...v,credentials:"same-origin",headers:ma(v==null?void 0:v.headers,{"X-CSRF":e.api.csrf,"X-Proxy-Target":String(_)})}),f=c({baseURL:l.baseUrl||void 0,apiKey:js,fetch:u,...a==="anthropic"?{headers:{"anthropic-dangerous-direct-browser-access":"true"}}:void 0}),p=t?l.completionModel||Js[a]:l.model;if(!p)throw new Dt(`Missing ${t?"completionModel":"model"} for the "${a}" provider. Add it to "johannschopplich.copilot.providers.${a}" in your Kirby config.`);const d=f.languageModel(p),g=t?"none":n.reasoningEffort??Bs,m=Us[g],b=ia(p)?(m==null?void 0:m[`${a}:${p}`])??(m==null?void 0:m[a]):void 0,w={...a==="anthropic"&&b&&{anthropic:{thinking:{type:"enabled",budgetTokens:b}}},...a==="openai"&&b&&{openai:{reasoningEffort:b}},...a==="google"&&b&&{google:{thinkingConfig:{thinkingLevel:b}}}};return At(l.options)&&(w[a]={...w[a],...l.options}),{model:d,providerOptions:Object.keys(w).length>0?w:void 0}}async function ha({userPrompt:t,files:e=[]}){const n=Mr();let r=Zr(t,n);const o=e.filter(u=>u.type.startsWith("image/")),i=e.filter(u=>u.type==="application/pdf"),a=i.reduce((u,f)=>u+f.size,0)<=Gs;if(!a&&i.length>0){const u=await Promise.all(i.map(ca));r+=`

${u.map((f,p)=>`<pdf_document_${p+1}>
${f}
</pdf_document_${p+1}>`).join(`

`)}`}const l=await Promise.all(o.map(async u=>{const p=await(await ea(u,{maxDimension:2048})).arrayBuffer();return new Uint8Array(p)})),c=a?await Promise.all(i.map(async u=>{const f=await u.arrayBuffer();return new Uint8Array(f)})):[];return{userPromptWithContext:r,imageByteArrays:l,pdfByteArrays:c}}function ma(...t){return new Headers(t.filter(Boolean).flatMap(e=>[...new Headers(e)]))}function ga(t){return typeof t=="string"?`'${t}'`:new ya().serialize(t)}const ya=(function(){var e;class t{constructor(){as(this,e,new Map)}compare(r,o){const i=typeof r,s=typeof o;return i==="string"&&s==="string"?r.localeCompare(o):i==="number"&&s==="number"?r-o:String.prototype.localeCompare.call(this.serialize(r,!0),this.serialize(o,!0))}serialize(r,o){if(r===null)return"null";switch(typeof r){case"string":return o?r:`'${r}'`;case"bigint":return`${r}n`;case"object":return this.$object(r);case"function":return this.$function(r)}return String(r)}serializeObject(r){const o=Object.prototype.toString.call(r);if(o!=="[object Object]")return this.serializeBuiltInType(o.length<10?`unknown:${o}`:o.slice(8,-1),r);const i=r.constructor,s=i===Object||i===void 0?"":i.name;if(s!==""&&globalThis[s]===i)return this.serializeBuiltInType(s,r);if(typeof r.toJSON=="function"){const a=r.toJSON();return s+(a!==null&&typeof a=="object"?this.$object(a):`(${this.serialize(a)})`)}return this.serializeObjectEntries(s,Object.entries(r))}serializeBuiltInType(r,o){const i=this["$"+r];if(i)return i.call(this,o);if(typeof(o==null?void 0:o.entries)=="function")return this.serializeObjectEntries(r,o.entries());throw new Error(`Cannot serialize ${r}`)}serializeObjectEntries(r,o){const i=Array.from(o).sort((a,l)=>this.compare(a[0],l[0]));let s=`${r}{`;for(let a=0;a<i.length;a++){const[l,c]=i[a];s+=`${this.serialize(l,!0)}:${this.serialize(c)}`,a<i.length-1&&(s+=",")}return s+"}"}$object(r){let o=It(this,e).get(r);return o===void 0&&(It(this,e).set(r,`#${It(this,e).size}`),o=this.serializeObject(r),It(this,e).set(r,o)),o}$function(r){const o=Function.prototype.toString.call(r);return o.slice(-15)==="[native code] }"?`${r.name||""}()[native]`:`${r.name}(${r.length})${o.replace(/\s*\n\s*/g,"")}`}$Array(r){let o="[";for(let i=0;i<r.length;i++)o+=this.serialize(r[i]),i<r.length-1&&(o+=",");return o+"]"}$Date(r){try{return`Date(${r.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(r){return`ArrayBuffer[${new Uint8Array(r).join(",")}]`}$Set(r){return`Set${this.$Array(Array.from(r).sort((o,i)=>this.compare(o,i)))}`}$Map(r){return this.serializeObjectEntries("Map",r.entries())}}e=new WeakMap;for(const n of["Error","RegExp","URL"])t.prototype["$"+n]=function(r){return`${n}(${r})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])t.prototype["$"+n]=function(r){return`${n}[${r.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])t.prototype["$"+n]=function(r){return`${n}[${r.join("n,")}${r.length>0?"n":""}]`};return t})(),ba=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],va=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],_a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Me=[];class ka{constructor(){ke(this,"_data",new Xe);ke(this,"_hash",new Xe([...ba]));ke(this,"_nDataBytes",0);ke(this,"_minBufferSize",0)}finalize(e){e&&this._append(e);const n=this._nDataBytes*8,r=this._data.sigBytes*8;return this._data.words[r>>>5]|=128<<24-r%32,this._data.words[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(r+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(e,n){const r=this._hash.words;let o=r[0],i=r[1],s=r[2],a=r[3],l=r[4],c=r[5],u=r[6],f=r[7];for(let p=0;p<64;p++){if(p<16)Me[p]=e[n+p]|0;else{const v=Me[p-15],I=(v<<25|v>>>7)^(v<<14|v>>>18)^v>>>3,O=Me[p-2],N=(O<<15|O>>>17)^(O<<13|O>>>19)^O>>>10;Me[p]=I+Me[p-7]+N+Me[p-16]}const d=l&c^~l&u,g=o&i^o&s^i&s,m=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),b=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),w=f+b+d+va[p]+Me[p],_=m+g;f=u,u=c,c=l,l=a+w|0,a=s,s=i,i=o,o=w+_|0}r[0]=r[0]+o|0,r[1]=r[1]+i|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+l|0,r[5]=r[5]+c|0,r[6]=r[6]+u|0,r[7]=r[7]+f|0}_append(e){typeof e=="string"&&(e=Xe.fromUtf8(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_process(e){let n,r=this._data.sigBytes/64;e?r=Math.ceil(r):r=Math.max((r|0)-this._minBufferSize,0);const o=r*16,i=Math.min(o*4,this._data.sigBytes);if(o){for(let s=0;s<o;s+=16)this._doProcessBlock(this._data.words,s);n=this._data.words.splice(0,o),this._data.sigBytes-=i}return new Xe(n,i)}}class Xe{constructor(e,n){ke(this,"words");ke(this,"sigBytes");e=this.words=e||[],this.sigBytes=n===void 0?e.length*4:n}static fromUtf8(e){const n=unescape(encodeURIComponent(e)),r=n.length,o=[];for(let i=0;i<r;i++)o[i>>>2]|=(n.charCodeAt(i)&255)<<24-i%4*8;return new Xe(o,r)}toBase64(){const e=[];for(let n=0;n<this.sigBytes;n+=3){const r=this.words[n>>>2]>>>24-n%4*8&255,o=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,i=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,s=r<<16|o<<8|i;for(let a=0;a<4&&n*8+a*6<this.sigBytes*8;a++)e.push(_a.charAt(s>>>6*(3-a)&63))}return e.join("")}concat(e){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<e.sigBytes;n++){const r=e.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=r<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<e.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=e.words[n>>>2];this.sigBytes+=e.sigBytes}}function wa(t){return new ka().finalize(t).toBase64()}function Sa(t){return wa(ga(t))}function $n(...t){return`${Ir}${Sa([...t])}`}function xa(t){let e=!1,n;const r=vs(!0);return((...o)=>(e||(n=r.run(()=>t(...o)),e=!0),n))}const En=50,za=xa(()=>{const t=$n("templates",window.location.hostname),e=localStorage.getItem(t),n=!!e;let r;return e?(r=Ta(e),localStorage.setItem(t,JSON.stringify(r))):r=Oa(),{state:zs({templates:r,configTemplates:[]}),storageKey:t,hasStoredTemplates:n}});function jr(){const{state:t,storageKey:e,hasStoredTemplates:n}=za(),r=H(()=>[...t.configTemplates,...t.templates]);function o(){localStorage.setItem(e,JSON.stringify(t.templates))}function i(p,d){const g=p==null?void 0:p.trim(),m=d==null?void 0:d.trim();if(!g||!m)return;const b={id:kn(),label:g,prompt:m,createdAt:Date.now()};return t.templates.unshift(b),t.templates.length>En&&t.templates.splice(En),o(),b}function s(p,d){const g=t.templates.findIndex(m=>m.id===p);return g===-1?!1:(Object.assign(t.templates[g],d),o(),!0)}function a(p){const d=t.templates.findIndex(g=>g.id===p);return d===-1?!1:(t.templates.splice(d,1),o(),!0)}function l(){t.templates=[],o()}function c(p){const d=[...t.templates],g=[];for(const m of p){if(!m.label||!m.prompt)continue;const b=m.label.trim(),w=m.prompt.trim();if(!b||!w)continue;let _=d.findIndex(v=>v.label===b);if(_===-1&&(_=d.findIndex(v=>v.prompt===w)),_!==-1){const v=d.splice(_,1)[0];g.push({...v,label:b,prompt:w})}else g.push({id:kn(),label:b,prompt:w,createdAt:Date.now()})}t.templates=g.slice(0,En),o()}function u(p){t.configTemplates=p.map((d,g)=>({...d,id:`config-${g}`,createdAt:0,readOnly:!0})),p.length>0&&!n&&(t.templates=[])}function f(p){return r.value.find(d=>d.id===p)}return{templates:H(()=>t.templates),allTemplates:r,addTemplate:i,updateTemplate:s,deleteTemplate:a,clearTemplates:l,setTemplates:c,setConfigTemplates:u,getTemplate:f}}function Oa(){const{user:t}=z();return(Dr[t.language]||Dr.en).map(n=>({id:kn(),...n,createdAt:Date.now()}))}function Ta(t){return JSON.parse(t).map(e=>{if("name"in e&&!("label"in e)){const{name:n,...r}=e;return{...r,label:n}}return e})}function $a(){const t=z(),{openFieldsDialog:e}=Tr(),{templates:n,addTemplate:r,setTemplates:o}=jr();async function i(a){const l=await e({fields:{label:{label:t.t("johannschopplich.copilot.template.label"),type:"text",required:!0,autofocus:!0}},value:{label:""}});l!=null&&l.label&&r(l.label,a)}async function s(){const a=await e({size:"huge",fields:{templates:{label:t.t("johannschopplich.copilot.templates"),type:"structure",empty:t.t("johannschopplich.copilot.template.empty"),columns:{label:{label:t.t("johannschopplich.copilot.template.label"),width:"1/4"},prompt:{label:t.t("johannschopplich.copilot.prompt.label"),width:"2/4"},toDelete:{label:t.t("johannschopplich.copilot.template.delete"),width:"1/4",mobile:!0}},fields:{label:{label:t.t("johannschopplich.copilot.template.label"),type:"text",required:!0},prompt:{label:t.t("johannschopplich.copilot.prompt.label"),type:"textarea",required:!0},toDelete:{label:t.t("johannschopplich.copilot.template.delete"),type:"toggle",text:t.t("johannschopplich.copilot.template.markForDeletion")}}}},value:{templates:n.value.map(l=>({label:l.label,prompt:l.prompt,toDelete:!1}))}});if(a!=null&&a.templates){const l=a.templates.filter(c=>!c.toDelete);o(l)}}return{openSaveTemplateDialog:i,openEditTemplatesDialog:s}}function Ea(t,e,n,r){let o;const i=()=>{o==null||o(),o=void 0},s=(c,u,f,p)=>(c.addEventListener(u,f,p),()=>c.removeEventListener(u,f,p)),a=bn(()=>Ca(t),c=>{i(),c&&(o=s(c,e,n,r))},{immediate:!0,flush:"post"}),l=()=>{a(),i()};return _s()&&xs(l),l}function Ca(t){const e=yn(t);return(e==null?void 0:e.$el)??e}const Br=50;function Pa(){const t=$n("history",window.location.hostname),e=S(JSON.parse(localStorage.getItem(t)||"[]")),n=S(""),r=S(-1);function o(){localStorage.setItem(t,JSON.stringify(e.value))}function i(u){if(!u||typeof u!="string"||!u.trim())return;const f=u.trim(),p=e.value.indexOf(f);p!==-1&&e.value.splice(p,1),e.value.unshift(f),e.value.length>Br&&(e.value=e.value.slice(0,Br)),o(),r.value=-1}function s(u){if(e.value.length!==0){if(u==="up"){if(r.value+1<e.value.length)return r.value++,e.value[r.value]}else if(u==="down"){if(r.value>0)return r.value--,e.value[r.value];if(r.value===0)return r.value=-1,n.value}}}function a(u){const f=e.value.indexOf(u);return f===-1?!1:(e.value.splice(f,1),o(),!0)}function l(){e.value=[],o(),r.value=-1}function c(u=10){return e.value.slice(0,u)}return{history:e,lastPrompt:n,currentIndex:r,addToHistory:i,navigateHistory:s,deleteEntry:a,clearHistory:l,getRecentEntries:c}}function h(t,e,n){function r(a,l){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:l,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(t))return;a._zod.traits.add(t),e(a,l);const c=s.prototype,u=Object.keys(c);for(let f=0;f<u.length;f++){const p=u[f];p in a||(a[p]=c[p].bind(a))}}const o=(n==null?void 0:n.Parent)??Object;class i extends o{}Object.defineProperty(i,"name",{value:t});function s(a){var l;const c=n!=null&&n.Parent?new i:this;r(c,a),(l=c._zod).deferred??(l.deferred=[]);for(const u of c._zod.deferred)u();return c}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>{var l,c;return n!=null&&n.Parent&&a instanceof n.Parent?!0:(c=(l=a==null?void 0:a._zod)==null?void 0:l.traits)==null?void 0:c.has(t)}}),Object.defineProperty(s,"name",{value:t}),s}class Qe extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Ur extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const Jr={};function ze(t){return Jr}function Vr(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,o])=>e.indexOf(+r)===-1).map(([r,o])=>o)}function Cn(t,e){return typeof e=="bigint"?e.toString():e}function Pn(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function In(t){return t==null}function Nn(t){const e=t.startsWith("^")?1:0,n=t.endsWith("$")?t.length-1:t.length;return t.slice(e,n)}function Ia(t,e){const n=(t.toString().split(".")[1]||"").length,r=e.toString();let o=(r.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(r)){const l=r.match(/\d?e-(\d?)/);l!=null&&l[1]&&(o=Number.parseInt(l[1]))}const i=n>o?n:o,s=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}const Kr=Symbol("evaluating");function P(t,e,n){let r;Object.defineProperty(t,e,{get(){if(r!==Kr)return r===void 0&&(r=Kr,r=n()),r},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function Re(t,e,n){Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Oe(...t){const e={};for(const n of t){const r=Object.getOwnPropertyDescriptors(n);Object.assign(e,r)}return Object.defineProperties({},e)}function Wr(t){return JSON.stringify(t)}function Na(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const Gr="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function Lt(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const Aa=Pn(()=>{var t;if(typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)!=null&&t.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function et(t){if(Lt(t)===!1)return!1;const e=t.constructor;if(e===void 0||typeof e!="function")return!0;const n=e.prototype;return!(Lt(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function Hr(t){return et(t)?{...t}:Array.isArray(t)?[...t]:t}const Da=new Set(["string","number","symbol"]);function tt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Te(t,e,n){const r=new t._zod.constr(e??t._zod.def);return(!e||n!=null&&n.parent)&&(r._zod.parent=t),r}function k(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function Ma(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const Ra={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function La(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const i=Oe(t._zod.def,{get shape(){const s={};for(const a in e){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);e[a]&&(s[a]=n.shape[a])}return Re(this,"shape",s),s},checks:[]});return Te(t,i)}function Fa(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const i=Oe(t._zod.def,{get shape(){const s={...t._zod.def.shape};for(const a in e){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);e[a]&&delete s[a]}return Re(this,"shape",s),s},checks:[]});return Te(t,i)}function Za(t,e){if(!et(e))throw new Error("Invalid input to extend: expected a plain object");const n=t._zod.def.checks;if(n&&n.length>0){const i=t._zod.def.shape;for(const s in e)if(Object.getOwnPropertyDescriptor(i,s)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const o=Oe(t._zod.def,{get shape(){const i={...t._zod.def.shape,...e};return Re(this,"shape",i),i}});return Te(t,o)}function ja(t,e){if(!et(e))throw new Error("Invalid input to safeExtend: expected a plain object");const n=Oe(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e};return Re(this,"shape",r),r}});return Te(t,n)}function Ba(t,e){const n=Oe(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e._zod.def.shape};return Re(this,"shape",r),r},get catchall(){return e._zod.def.catchall},checks:[]});return Te(t,n)}function Ua(t,e,n){const o=e._zod.def.checks;if(o&&o.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const s=Oe(e._zod.def,{get shape(){const a=e._zod.def.shape,l={...a};if(n)for(const c in n){if(!(c in a))throw new Error(`Unrecognized key: "${c}"`);n[c]&&(l[c]=t?new t({type:"optional",innerType:a[c]}):a[c])}else for(const c in a)l[c]=t?new t({type:"optional",innerType:a[c]}):a[c];return Re(this,"shape",l),l},checks:[]});return Te(e,s)}function Ja(t,e,n){const r=Oe(e._zod.def,{get shape(){const o=e._zod.def.shape,i={...o};if(n)for(const s in n){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=new t({type:"nonoptional",innerType:o[s]}))}else for(const s in o)i[s]=new t({type:"nonoptional",innerType:o[s]});return Re(this,"shape",i),i}});return Te(e,r)}function nt(t,e=0){var n;if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(((n=t.issues[r])==null?void 0:n.continue)!==!0)return!0;return!1}function rt(t,e){return e.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(t),n})}function Ft(t){return typeof t=="string"?t:t==null?void 0:t.message}function $e(t,e,n){var o,i,s,a,l,c;const r={...t,path:t.path??[]};if(!t.message){const u=Ft((s=(i=(o=t.inst)==null?void 0:o._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,t))??Ft((a=e==null?void 0:e.error)==null?void 0:a.call(e,t))??Ft((l=n.customError)==null?void 0:l.call(n,t))??Ft((c=n.localeError)==null?void 0:c.call(n,t))??"Invalid input";r.message=u}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}function An(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function yt(...t){const[e,n,r]=t;return typeof e=="string"?{message:e,code:"custom",input:n,inst:r}:{...e}}const qr=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,Cn,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Yr=h("$ZodError",qr),Xr=h("$ZodError",qr,{Parent:Error});function Va(t,e=n=>n.message){const n={},r=[];for(const o of t.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(e(o))):r.push(e(o));return{formErrors:r,fieldErrors:n}}function Ka(t,e=n=>n.message){const n={_errors:[]},r=o=>{for(const i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>r({issues:s}));else if(i.code==="invalid_key")r({issues:i.issues});else if(i.code==="invalid_element")r({issues:i.issues});else if(i.path.length===0)n._errors.push(e(i));else{let s=n,a=0;for(;a<i.path.length;){const l=i.path[a];a===i.path.length-1?(s[l]=s[l]||{_errors:[]},s[l]._errors.push(e(i))):s[l]=s[l]||{_errors:[]},s=s[l],a++}}};return r(t),n}const Dn=t=>(e,n,r,o)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},s=e._zod.run({value:n,issues:[]},i);if(s instanceof Promise)throw new Qe;if(s.issues.length){const a=new((o==null?void 0:o.Err)??t)(s.issues.map(l=>$e(l,i,ze())));throw Gr(a,o==null?void 0:o.callee),a}return s.value},Mn=t=>async(e,n,r,o)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:n,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new((o==null?void 0:o.Err)??t)(s.issues.map(l=>$e(l,i,ze())));throw Gr(a,o==null?void 0:o.callee),a}return s.value},Zt=t=>(e,n,r)=>{const o=r?{...r,async:!1}:{async:!1},i=e._zod.run({value:n,issues:[]},o);if(i instanceof Promise)throw new Qe;return i.issues.length?{success:!1,error:new(t??Yr)(i.issues.map(s=>$e(s,o,ze())))}:{success:!0,data:i.value}},Wa=Zt(Xr),jt=t=>async(e,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let i=e._zod.run({value:n,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new t(i.issues.map(s=>$e(s,o,ze())))}:{success:!0,data:i.value}},Ga=jt(Xr),Ha=t=>(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Dn(t)(e,n,o)},qa=t=>(e,n,r)=>Dn(t)(e,n,r),Ya=t=>async(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Mn(t)(e,n,o)},Xa=t=>async(e,n,r)=>Mn(t)(e,n,r),Qa=t=>(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Zt(t)(e,n,o)},el=t=>(e,n,r)=>Zt(t)(e,n,r),tl=t=>async(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return jt(t)(e,n,o)},nl=t=>async(e,n,r)=>jt(t)(e,n,r),rl=/^[cC][^\s-]{8,}$/,ol=/^[0-9a-z]+$/,il=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,sl=/^[0-9a-vA-V]{20}$/,al=/^[A-Za-z0-9]{27}$/,ll=/^[a-zA-Z0-9_-]{21}$/,cl=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ul=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Qr=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,fl=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,pl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function dl(){return new RegExp(pl,"u")}const hl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ml=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,gl=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,yl=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bl=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,eo=/^[A-Za-z0-9_-]*$/,vl=/^\+[1-9]\d{6,14}$/,to="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",_l=new RegExp(`^${to}$`);function no(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function kl(t){return new RegExp(`^${no(t)}$`)}function wl(t){const e=no({precision:t.precision}),n=["Z"];t.local&&n.push(""),t.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${e}(?:${n.join("|")})`;return new RegExp(`^${to}T(?:${r})$`)}const Sl=t=>{const e=t?`[\\s\\S]{${(t==null?void 0:t.minimum)??0},${(t==null?void 0:t.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},xl=/^-?\d+$/,ro=/^-?\d+(?:\.\d+)?$/,zl=/^(?:true|false)$/i,Ol=/^[^A-Z]*$/,Tl=/^[^a-z]*$/,ne=h("$ZodCheck",(t,e)=>{var n;t._zod??(t._zod={}),t._zod.def=e,(n=t._zod).onattach??(n.onattach=[])}),oo={number:"number",bigint:"bigint",object:"date"},io=h("$ZodCheckLessThan",(t,e)=>{ne.init(t,e);const n=oo[typeof e.value];t._zod.onattach.push(r=>{const o=r._zod.bag,i=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:n,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),so=h("$ZodCheckGreaterThan",(t,e)=>{ne.init(t,e);const n=oo[typeof e.value];t._zod.onattach.push(r=>{const o=r._zod.bag,i=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:n,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),$l=h("$ZodCheckMultipleOf",(t,e)=>{ne.init(t,e),t._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=e.value)}),t._zod.check=n=>{if(typeof n.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%e.value===BigInt(0):Ia(n.value,e.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:e.value,input:n.value,inst:t,continue:!e.abort})}}),El=h("$ZodCheckNumberFormat",(t,e)=>{var s;ne.init(t,e),e.format=e.format||"float64";const n=(s=e.format)==null?void 0:s.includes("int"),r=n?"int":"number",[o,i]=Ra[e.format];t._zod.onattach.push(a=>{const l=a._zod.bag;l.format=e.format,l.minimum=o,l.maximum=i,n&&(l.pattern=xl)}),t._zod.check=a=>{const l=a.value;if(n){if(!Number.isInteger(l)){a.issues.push({expected:r,format:e.format,code:"invalid_type",continue:!1,input:l,inst:t});return}if(!Number.isSafeInteger(l)){l>0?a.issues.push({input:l,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort}):a.issues.push({input:l,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort});return}}l<o&&a.issues.push({origin:"number",input:l,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),l>i&&a.issues.push({origin:"number",input:l,code:"too_big",maximum:i,inclusive:!0,inst:t,continue:!e.abort})}}),Cl=h("$ZodCheckMaxLength",(t,e)=>{var n;ne.init(t,e),(n=t._zod.def).when??(n.when=r=>{const o=r.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(r=>{const o=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(r._zod.bag.maximum=e.maximum)}),t._zod.check=r=>{const o=r.value;if(o.length<=e.maximum)return;const s=An(o);r.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Pl=h("$ZodCheckMinLength",(t,e)=>{var n;ne.init(t,e),(n=t._zod.def).when??(n.when=r=>{const o=r.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(r=>{const o=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(r._zod.bag.minimum=e.minimum)}),t._zod.check=r=>{const o=r.value;if(o.length>=e.minimum)return;const s=An(o);r.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Il=h("$ZodCheckLengthEquals",(t,e)=>{var n;ne.init(t,e),(n=t._zod.def).when??(n.when=r=>{const o=r.value;return!In(o)&&o.length!==void 0}),t._zod.onattach.push(r=>{const o=r._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=r=>{const o=r.value,i=o.length;if(i===e.length)return;const s=An(o),a=i>e.length;r.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:t,continue:!e.abort})}}),Bt=h("$ZodCheckStringFormat",(t,e)=>{var n,r;ne.init(t,e),t._zod.onattach.push(o=>{const i=o._zod.bag;i.format=e.format,e.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(e.pattern))}),e.pattern?(n=t._zod).check??(n.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(r=t._zod).check??(r.check=()=>{})}),Nl=h("$ZodCheckRegex",(t,e)=>{Bt.init(t,e),t._zod.check=n=>{e.pattern.lastIndex=0,!e.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),Al=h("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=Ol),Bt.init(t,e)}),Dl=h("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=Tl),Bt.init(t,e)}),Ml=h("$ZodCheckIncludes",(t,e)=>{ne.init(t,e);const n=tt(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${n}`:n);e.pattern=r,t._zod.onattach.push(o=>{const i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),Rl=h("$ZodCheckStartsWith",(t,e)=>{ne.init(t,e);const n=new RegExp(`^${tt(e.prefix)}.*`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),t._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:t,continue:!e.abort})}}),Ll=h("$ZodCheckEndsWith",(t,e)=>{ne.init(t,e);const n=new RegExp(`.*${tt(e.suffix)}$`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),t._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:t,continue:!e.abort})}}),Fl=h("$ZodCheckOverwrite",(t,e)=>{ne.init(t,e),t._zod.check=n=>{n.value=e.tx(n.value)}});class Zl{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(s=>s),o=Math.min(...r.map(s=>s.length-s.trimStart().length)),i=r.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(const s of i)this.content.push(s)}compile(){const e=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new e(...n,o.join(`
`))}}const jl={major:4,minor:3,patch:5},R=h("$ZodType",(t,e)=>{var o;var n;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=jl;const r=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&r.unshift(t);for(const i of r)for(const s of i._zod.onattach)s(t);if(r.length===0)(n=t._zod).deferred??(n.deferred=[]),(o=t._zod.deferred)==null||o.push(()=>{t._zod.run=t._zod.parse});else{const i=(a,l,c)=>{let u=nt(a),f;for(const p of l){if(p._zod.def.when){if(!p._zod.def.when(a))continue}else if(u)continue;const d=a.issues.length,g=p._zod.check(a);if(g instanceof Promise&&(c==null?void 0:c.async)===!1)throw new Qe;if(f||g instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await g,a.issues.length!==d&&(u||(u=nt(a,d)))});else{if(a.issues.length===d)continue;u||(u=nt(a,d))}}return f?f.then(()=>a):a},s=(a,l,c)=>{if(nt(a))return a.aborted=!0,a;const u=i(l,r,c);if(u instanceof Promise){if(c.async===!1)throw new Qe;return u.then(f=>t._zod.parse(f,c))}return t._zod.parse(u,c)};t._zod.run=(a,l)=>{if(l.skipChecks)return t._zod.parse(a,l);if(l.direction==="backward"){const u=t._zod.parse({value:a.value,issues:[]},{...l,skipChecks:!0});return u instanceof Promise?u.then(f=>s(f,a,l)):s(u,a,l)}const c=t._zod.parse(a,l);if(c instanceof Promise){if(l.async===!1)throw new Qe;return c.then(u=>i(u,r,l))}return i(c,r,l)}}P(t,"~standard",()=>({validate:i=>{var s;try{const a=Wa(t,i);return a.success?{value:a.data}:{issues:(s=a.error)==null?void 0:s.issues}}catch{return Ga(t,i).then(l=>{var c;return l.success?{value:l.data}:{issues:(c=l.error)==null?void 0:c.issues}})}},vendor:"zod",version:1}))}),Rn=h("$ZodString",(t,e)=>{var n;R.init(t,e),t._zod.pattern=[...((n=t==null?void 0:t._zod.bag)==null?void 0:n.patterns)??[]].pop()??Sl(t._zod.bag),t._zod.parse=(r,o)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),M=h("$ZodStringFormat",(t,e)=>{Bt.init(t,e),Rn.init(t,e)}),Bl=h("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=ul),M.init(t,e)}),Ul=h("$ZodUUID",(t,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Qr(r))}else e.pattern??(e.pattern=Qr());M.init(t,e)}),Jl=h("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=fl),M.init(t,e)}),Vl=h("$ZodURL",(t,e)=>{M.init(t,e),t._zod.check=n=>{try{const r=n.value.trim(),o=new URL(r);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:n.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:n.value,inst:t,continue:!e.abort})),e.normalize?n.value=o.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:t,continue:!e.abort})}}}),Kl=h("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=dl()),M.init(t,e)}),Wl=h("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=ll),M.init(t,e)}),Gl=h("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=rl),M.init(t,e)}),Hl=h("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=ol),M.init(t,e)}),ql=h("$ZodULID",(t,e)=>{e.pattern??(e.pattern=il),M.init(t,e)}),Yl=h("$ZodXID",(t,e)=>{e.pattern??(e.pattern=sl),M.init(t,e)}),Xl=h("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=al),M.init(t,e)}),Ql=h("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=wl(e)),M.init(t,e)}),ec=h("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=_l),M.init(t,e)}),tc=h("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=kl(e)),M.init(t,e)}),nc=h("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=cl),M.init(t,e)}),rc=h("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=hl),M.init(t,e),t._zod.bag.format="ipv4"}),oc=h("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=ml),M.init(t,e),t._zod.bag.format="ipv6",t._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:t,continue:!e.abort})}}}),ic=h("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=gl),M.init(t,e)}),sc=h("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=yl),M.init(t,e),t._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[o,i]=r;if(!i)throw new Error;const s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${o}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:t,continue:!e.abort})}}});function ao(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const ac=h("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=bl),M.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=n=>{ao(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:t,continue:!e.abort})}});function lc(t){if(!eo.test(t))return!1;const e=t.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=e.padEnd(Math.ceil(e.length/4)*4,"=");return ao(n)}const cc=h("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=eo),M.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=n=>{lc(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:t,continue:!e.abort})}}),uc=h("$ZodE164",(t,e)=>{e.pattern??(e.pattern=vl),M.init(t,e)});function fc(t,e=null){try{const n=t.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}const pc=h("$ZodJWT",(t,e)=>{M.init(t,e),t._zod.check=n=>{fc(n.value,e.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:t,continue:!e.abort})}}),lo=h("$ZodNumber",(t,e)=>{R.init(t,e),t._zod.pattern=t._zod.bag.pattern??ro,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...i?{received:i}:{}}),n}}),dc=h("$ZodNumberFormat",(t,e)=>{El.init(t,e),lo.init(t,e)}),hc=h("$ZodBoolean",(t,e)=>{R.init(t,e),t._zod.pattern=zl,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),n}}),mc=h("$ZodUnknown",(t,e)=>{R.init(t,e),t._zod.parse=n=>n}),gc=h("$ZodNever",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:t}),n)});function co(t,e,n){t.issues.length&&e.issues.push(...rt(n,t.issues)),e.value[n]=t.value}const yc=h("$ZodArray",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),n;n.value=Array(o.length);const i=[];for(let s=0;s<o.length;s++){const a=o[s],l=e.element._zod.run({value:a,issues:[]},r);l instanceof Promise?i.push(l.then(c=>co(c,n,s))):co(l,n,s)}return i.length?Promise.all(i).then(()=>n):n}});function Ut(t,e,n,r,o){if(t.issues.length){if(o&&!(n in r))return;e.issues.push(...rt(n,t.issues))}t.value===void 0?n in r&&(e.value[n]=void 0):e.value[n]=t.value}function uo(t){var r,o,i,s;const e=Object.keys(t.shape);for(const a of e)if(!((s=(i=(o=(r=t.shape)==null?void 0:r[a])==null?void 0:o._zod)==null?void 0:i.traits)!=null&&s.has("$ZodType")))throw new Error(`Invalid element at key "${a}": expected a Zod schema`);const n=Ma(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}}function fo(t,e,n,r,o,i){const s=[],a=o.keySet,l=o.catchall._zod,c=l.def.type,u=l.optout==="optional";for(const f in e){if(a.has(f))continue;if(c==="never"){s.push(f);continue}const p=l.run({value:e[f],issues:[]},r);p instanceof Promise?t.push(p.then(d=>Ut(d,n,f,e,u))):Ut(p,n,f,e,u)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:i}),t.length?Promise.all(t).then(()=>n):n}const bc=h("$ZodObject",(t,e)=>{R.init(t,e);const n=Object.getOwnPropertyDescriptor(e,"shape");if(!(n!=null&&n.get)){const a=e.shape;Object.defineProperty(e,"shape",{get:()=>{const l={...a};return Object.defineProperty(e,"shape",{value:l}),l}})}const r=Pn(()=>uo(e));P(t._zod,"propValues",()=>{const a=e.shape,l={};for(const c in a){const u=a[c]._zod;if(u.values){l[c]??(l[c]=new Set);for(const f of u.values)l[c].add(f)}}return l});const o=Lt,i=e.catchall;let s;t._zod.parse=(a,l)=>{s??(s=r.value);const c=a.value;if(!o(c))return a.issues.push({expected:"object",code:"invalid_type",input:c,inst:t}),a;a.value={};const u=[],f=s.shape;for(const p of s.keys){const d=f[p],g=d._zod.optout==="optional",m=d._zod.run({value:c[p],issues:[]},l);m instanceof Promise?u.push(m.then(b=>Ut(b,a,p,c,g))):Ut(m,a,p,c,g)}return i?fo(u,c,a,l,r.value,t):u.length?Promise.all(u).then(()=>a):a}}),vc=h("$ZodObjectJIT",(t,e)=>{bc.init(t,e);const n=t._zod.parse,r=Pn(()=>uo(e)),o=p=>{var v;const d=new Zl(["shape","payload","ctx"]),g=r.value,m=I=>{const O=Wr(I);return`shape[${O}]._zod.run({ value: input[${O}], issues: [] }, ctx)`};d.write("const input = payload.value;");const b=Object.create(null);let w=0;for(const I of g.keys)b[I]=`key_${w++}`;d.write("const newResult = {};");for(const I of g.keys){const O=b[I],N=Wr(I),W=p[I],B=((v=W==null?void 0:W._zod)==null?void 0:v.optout)==="optional";d.write(`const ${O} = ${m(I)};`),B?d.write(`
        if (${O}.issues.length) {
          if (${N} in input) {
            payload.issues = payload.issues.concat(${O}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${N}, ...iss.path] : [${N}]
            })));
          }
        }
        
        if (${O}.value === undefined) {
          if (${N} in input) {
            newResult[${N}] = undefined;
          }
        } else {
          newResult[${N}] = ${O}.value;
        }
        
      `):d.write(`
        if (${O}.issues.length) {
          payload.issues = payload.issues.concat(${O}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${N}, ...iss.path] : [${N}]
          })));
        }
        
        if (${O}.value === undefined) {
          if (${N} in input) {
            newResult[${N}] = undefined;
          }
        } else {
          newResult[${N}] = ${O}.value;
        }
        
      `)}d.write("payload.value = newResult;"),d.write("return payload;");const _=d.compile();return(I,O)=>_(p,I,O)};let i;const s=Lt,a=!Jr.jitless,c=a&&Aa.value,u=e.catchall;let f;t._zod.parse=(p,d)=>{f??(f=r.value);const g=p.value;return s(g)?a&&c&&(d==null?void 0:d.async)===!1&&d.jitless!==!0?(i||(i=o(e.shape)),p=i(p,d),u?fo([],g,p,d,f,t):p):n(p,d):(p.issues.push({expected:"object",code:"invalid_type",input:g,inst:t}),p)}});function po(t,e,n,r){for(const i of t)if(i.issues.length===0)return e.value=i.value,e;const o=t.filter(i=>!nt(i));return o.length===1?(e.value=o[0].value,o[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:n,errors:t.map(i=>i.issues.map(s=>$e(s,r,ze())))}),e)}const _c=h("$ZodUnion",(t,e)=>{R.init(t,e),P(t._zod,"optin",()=>e.options.some(o=>o._zod.optin==="optional")?"optional":void 0),P(t._zod,"optout",()=>e.options.some(o=>o._zod.optout==="optional")?"optional":void 0),P(t._zod,"values",()=>{if(e.options.every(o=>o._zod.values))return new Set(e.options.flatMap(o=>Array.from(o._zod.values)))}),P(t._zod,"pattern",()=>{if(e.options.every(o=>o._zod.pattern)){const o=e.options.map(i=>i._zod.pattern);return new RegExp(`^(${o.map(i=>Nn(i.source)).join("|")})$`)}});const n=e.options.length===1,r=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(n)return r(o,i);let s=!1;const a=[];for(const l of e.options){const c=l._zod.run({value:o.value,issues:[]},i);if(c instanceof Promise)a.push(c),s=!0;else{if(c.issues.length===0)return c;a.push(c)}}return s?Promise.all(a).then(l=>po(l,o,t,i)):po(a,o,t,i)}}),kc=h("$ZodIntersection",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{const o=n.value,i=e.left._zod.run({value:o,issues:[]},r),s=e.right._zod.run({value:o,issues:[]},r);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([l,c])=>ho(n,l,c)):ho(n,i,s)}});function Ln(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(et(t)&&et(e)){const n=Object.keys(e),r=Object.keys(t).filter(i=>n.indexOf(i)!==-1),o={...t,...e};for(const i of r){const s=Ln(t[i],e[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<t.length;r++){const o=t[r],i=e[r],s=Ln(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function ho(t,e,n){const r=new Map;let o;for(const a of e.issues)if(a.code==="unrecognized_keys"){o??(o=a);for(const l of a.keys)r.has(l)||r.set(l,{}),r.get(l).l=!0}else t.issues.push(a);for(const a of n.issues)if(a.code==="unrecognized_keys")for(const l of a.keys)r.has(l)||r.set(l,{}),r.get(l).r=!0;else t.issues.push(a);const i=[...r].filter(([,a])=>a.l&&a.r).map(([a])=>a);if(i.length&&o&&t.issues.push({...o,keys:i}),nt(t))return t;const s=Ln(e.value,n.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return t.value=s.data,t}const wc=h("$ZodRecord",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{const o=n.value;if(!et(o))return n.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),n;const i=[],s=e.keyType._zod.values;if(s){n.value={};const a=new Set;for(const c of s)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){a.add(typeof c=="number"?c.toString():c);const u=e.valueType._zod.run({value:o[c],issues:[]},r);u instanceof Promise?i.push(u.then(f=>{f.issues.length&&n.issues.push(...rt(c,f.issues)),n.value[c]=f.value})):(u.issues.length&&n.issues.push(...rt(c,u.issues)),n.value[c]=u.value)}let l;for(const c in o)a.has(c)||(l=l??[],l.push(c));l&&l.length>0&&n.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:l})}else{n.value={};for(const a of Reflect.ownKeys(o)){if(a==="__proto__")continue;let l=e.keyType._zod.run({value:a,issues:[]},r);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof a=="string"&&ro.test(a)&&l.issues.length&&l.issues.some(f=>f.code==="invalid_type"&&f.expected==="number")){const f=e.keyType._zod.run({value:Number(a),issues:[]},r);if(f instanceof Promise)throw new Error("Async schemas not supported in object keys currently");f.issues.length===0&&(l=f)}if(l.issues.length){e.mode==="loose"?n.value[a]=o[a]:n.issues.push({code:"invalid_key",origin:"record",issues:l.issues.map(f=>$e(f,r,ze())),input:a,path:[a],inst:t});continue}const u=e.valueType._zod.run({value:o[a],issues:[]},r);u instanceof Promise?i.push(u.then(f=>{f.issues.length&&n.issues.push(...rt(a,f.issues)),n.value[l.value]=f.value})):(u.issues.length&&n.issues.push(...rt(a,u.issues)),n.value[l.value]=u.value)}}return i.length?Promise.all(i).then(()=>n):n}}),Sc=h("$ZodEnum",(t,e)=>{R.init(t,e);const n=Vr(e.entries),r=new Set(n);t._zod.values=r,t._zod.pattern=new RegExp(`^(${n.filter(o=>Da.has(typeof o)).map(o=>typeof o=="string"?tt(o):o.toString()).join("|")})$`),t._zod.parse=(o,i)=>{const s=o.value;return r.has(s)||o.issues.push({code:"invalid_value",values:n,input:s,inst:t}),o}}),xc=h("$ZodLiteral",(t,e)=>{if(R.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(e.values);t._zod.values=n,t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?tt(r):r?tt(r.toString()):String(r)).join("|")})$`),t._zod.parse=(r,o)=>{const i=r.value;return n.has(i)||r.issues.push({code:"invalid_value",values:e.values,input:i,inst:t}),r}}),zc=h("$ZodTransform",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Ur(t.constructor.name);const o=e.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(n.value=s,n));if(o instanceof Promise)throw new Qe;return n.value=o,n}});function mo(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}const go=h("$ZodOptional",(t,e)=>{R.init(t,e),t._zod.optin="optional",t._zod.optout="optional",P(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),P(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${Nn(n.source)})?$`):void 0}),t._zod.parse=(n,r)=>{if(e.innerType._zod.optin==="optional"){const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>mo(i,n.value)):mo(o,n.value)}return n.value===void 0?n:e.innerType._zod.run(n,r)}}),Oc=h("$ZodExactOptional",(t,e)=>{go.init(t,e),P(t._zod,"values",()=>e.innerType._zod.values),P(t._zod,"pattern",()=>e.innerType._zod.pattern),t._zod.parse=(n,r)=>e.innerType._zod.run(n,r)}),Tc=h("$ZodNullable",(t,e)=>{R.init(t,e),P(t._zod,"optin",()=>e.innerType._zod.optin),P(t._zod,"optout",()=>e.innerType._zod.optout),P(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${Nn(n.source)}|null)$`):void 0}),P(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(n,r)=>n.value===null?n:e.innerType._zod.run(n,r)}),$c=h("$ZodDefault",(t,e)=>{R.init(t,e),t._zod.optin="optional",P(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);if(n.value===void 0)return n.value=e.defaultValue,n;const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>yo(i,e)):yo(o,e)}});function yo(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const Ec=h("$ZodPrefault",(t,e)=>{R.init(t,e),t._zod.optin="optional",P(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=e.defaultValue),e.innerType._zod.run(n,r))}),Cc=h("$ZodNonOptional",(t,e)=>{R.init(t,e),P(t._zod,"values",()=>{const n=e.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),t._zod.parse=(n,r)=>{const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>bo(i,t)):bo(o,t)}});function bo(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const Pc=h("$ZodCatch",(t,e)=>{R.init(t,e),P(t._zod,"optin",()=>e.innerType._zod.optin),P(t._zod,"optout",()=>e.innerType._zod.optout),P(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>(n.value=i.value,i.issues.length&&(n.value=e.catchValue({...n,error:{issues:i.issues.map(s=>$e(s,r,ze()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=e.catchValue({...n,error:{issues:o.issues.map(i=>$e(i,r,ze()))},input:n.value}),n.issues=[]),n)}}),Ic=h("$ZodPipe",(t,e)=>{R.init(t,e),P(t._zod,"values",()=>e.in._zod.values),P(t._zod,"optin",()=>e.in._zod.optin),P(t._zod,"optout",()=>e.out._zod.optout),P(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(n,r)=>{if(r.direction==="backward"){const i=e.out._zod.run(n,r);return i instanceof Promise?i.then(s=>Jt(s,e.in,r)):Jt(i,e.in,r)}const o=e.in._zod.run(n,r);return o instanceof Promise?o.then(i=>Jt(i,e.out,r)):Jt(o,e.out,r)}});function Jt(t,e,n){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},n)}const Nc=h("$ZodReadonly",(t,e)=>{R.init(t,e),P(t._zod,"propValues",()=>e.innerType._zod.propValues),P(t._zod,"values",()=>e.innerType._zod.values),P(t._zod,"optin",()=>{var n,r;return(r=(n=e.innerType)==null?void 0:n._zod)==null?void 0:r.optin}),P(t._zod,"optout",()=>{var n,r;return(r=(n=e.innerType)==null?void 0:n._zod)==null?void 0:r.optout}),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(vo):vo(o)}});function vo(t){return t.value=Object.freeze(t.value),t}const Ac=h("$ZodCustom",(t,e)=>{ne.init(t,e),R.init(t,e),t._zod.parse=(n,r)=>n,t._zod.check=n=>{const r=n.value,o=e.fn(r);if(o instanceof Promise)return o.then(i=>_o(i,n,r,t));_o(o,n,r,t)}});function _o(t,e,n,r){if(!t){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),e.issues.push(yt(o))}}var ko;class Dc{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...n){const r=n[0];return this._map.set(e,r),r&&typeof r=="object"&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const n=this._map.get(e);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(e),this}get(e){const n=e._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const o={...r,...this._map.get(e)};return Object.keys(o).length?o:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function Mc(){return new Dc}(ko=globalThis).__zod_globalRegistry??(ko.__zod_globalRegistry=Mc());const bt=globalThis.__zod_globalRegistry;function Rc(t,e){return new t({type:"string",...k(e)})}function Lc(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...k(e)})}function wo(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...k(e)})}function Fc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...k(e)})}function Zc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...k(e)})}function jc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...k(e)})}function Bc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...k(e)})}function Uc(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...k(e)})}function Jc(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...k(e)})}function Vc(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...k(e)})}function Kc(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...k(e)})}function Wc(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...k(e)})}function Gc(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...k(e)})}function Hc(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...k(e)})}function qc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...k(e)})}function Yc(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...k(e)})}function Xc(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...k(e)})}function Qc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...k(e)})}function eu(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...k(e)})}function tu(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...k(e)})}function nu(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...k(e)})}function ru(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...k(e)})}function ou(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...k(e)})}function iu(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...k(e)})}function su(t,e){return new t({type:"string",format:"date",check:"string_format",...k(e)})}function au(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...k(e)})}function lu(t,e){return new t({type:"string",format:"duration",check:"string_format",...k(e)})}function cu(t,e){return new t({type:"number",checks:[],...k(e)})}function uu(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...k(e)})}function fu(t,e){return new t({type:"boolean",...k(e)})}function pu(t){return new t({type:"unknown"})}function du(t,e){return new t({type:"never",...k(e)})}function So(t,e){return new io({check:"less_than",...k(e),value:t,inclusive:!1})}function Fn(t,e){return new io({check:"less_than",...k(e),value:t,inclusive:!0})}function xo(t,e){return new so({check:"greater_than",...k(e),value:t,inclusive:!1})}function Zn(t,e){return new so({check:"greater_than",...k(e),value:t,inclusive:!0})}function zo(t,e){return new $l({check:"multiple_of",...k(e),value:t})}function Oo(t,e){return new Cl({check:"max_length",...k(e),maximum:t})}function Vt(t,e){return new Pl({check:"min_length",...k(e),minimum:t})}function To(t,e){return new Il({check:"length_equals",...k(e),length:t})}function hu(t,e){return new Nl({check:"string_format",format:"regex",...k(e),pattern:t})}function mu(t){return new Al({check:"string_format",format:"lowercase",...k(t)})}function gu(t){return new Dl({check:"string_format",format:"uppercase",...k(t)})}function yu(t,e){return new Ml({check:"string_format",format:"includes",...k(e),includes:t})}function bu(t,e){return new Rl({check:"string_format",format:"starts_with",...k(e),prefix:t})}function vu(t,e){return new Ll({check:"string_format",format:"ends_with",...k(e),suffix:t})}function ot(t){return new Fl({check:"overwrite",tx:t})}function _u(t){return ot(e=>e.normalize(t))}function ku(){return ot(t=>t.trim())}function wu(){return ot(t=>t.toLowerCase())}function Su(){return ot(t=>t.toUpperCase())}function xu(){return ot(t=>Na(t))}function zu(t,e,n){return new t({type:"array",element:e,...k(n)})}function Ou(t,e,n){return new t({type:"custom",check:"custom",fn:e,...k(n)})}function Tu(t){const e=$u(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(yt(r,n.value,e._zod.def));else{const o=r;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),n.issues.push(yt(o))}},t(n.value,n)));return e}function $u(t,e){const n=new ne({check:"custom",...k(e)});return n._zod.check=t,n}function $o(t){let e=(t==null?void 0:t.target)??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:(t==null?void 0:t.metadata)??bt,target:e,unrepresentable:(t==null?void 0:t.unrepresentable)??"throw",override:(t==null?void 0:t.override)??(()=>{}),io:(t==null?void 0:t.io)??"output",counter:0,seen:new Map,cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0}}function J(t,e,n={path:[],schemaPath:[]}){var u,f;var r;const o=t._zod.def,i=e.seen.get(t);if(i)return i.count++,n.schemaPath.includes(t)&&(i.cycle=n.path),i.schema;const s={schema:{},count:1,cycle:void 0,path:n.path};e.seen.set(t,s);const a=(f=(u=t._zod).toJSONSchema)==null?void 0:f.call(u);if(a)s.schema=a;else{const p={...n,schemaPath:[...n.schemaPath,t],path:n.path};if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,s.schema,p);else{const g=s.schema,m=e.processors[o.type];if(!m)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${o.type}`);m(t,e,g,p)}const d=t._zod.parent;d&&(s.ref||(s.ref=d),J(d,e,p),e.seen.get(d).isParent=!0)}const l=e.metadataRegistry.get(t);return l&&Object.assign(s.schema,l),e.io==="input"&&ee(t)&&(delete s.schema.examples,delete s.schema.default),e.io==="input"&&s.schema._prefault&&((r=s.schema).default??(r.default=s.schema._prefault)),delete s.schema._prefault,e.seen.get(t).schema}function Eo(t,e){var s,a,l,c;const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=new Map;for(const u of t.seen.entries()){const f=(s=t.metadataRegistry.get(u[0]))==null?void 0:s.id;if(f){const p=r.get(f);if(p&&p!==u[0])throw new Error(`Duplicate schema id "${f}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(f,u[0])}}const o=u=>{var m;const f=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){const b=(m=t.external.registry.get(u[0]))==null?void 0:m.id,w=t.external.uri??(v=>v);if(b)return{ref:w(b)};const _=u[1].defId??u[1].schema.id??`schema${t.counter++}`;return u[1].defId=_,{defId:_,ref:`${w("__shared")}#/${f}/${_}`}}if(u[1]===n)return{ref:"#"};const d=`#/${f}/`,g=u[1].schema.id??`__schema${t.counter++}`;return{defId:g,ref:d+g}},i=u=>{if(u[1].schema.$ref)return;const f=u[1],{ref:p,defId:d}=o(u);f.def={...f.schema},d&&(f.defId=d);const g=f.schema;for(const m in g)delete g[m];g.$ref=p};if(t.cycles==="throw")for(const u of t.seen.entries()){const f=u[1];if(f.cycle)throw new Error(`Cycle detected: #/${(a=f.cycle)==null?void 0:a.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const u of t.seen.entries()){const f=u[1];if(e===u[0]){i(u);continue}if(t.external){const d=(l=t.external.registry.get(u[0]))==null?void 0:l.id;if(e!==u[0]&&d){i(u);continue}}if((c=t.metadataRegistry.get(u[0]))==null?void 0:c.id){i(u);continue}if(f.cycle){i(u);continue}if(f.count>1&&t.reused==="ref"){i(u);continue}}}function Co(t,e){var s,a,l;const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=c=>{const u=t.seen.get(c);if(u.ref===null)return;const f=u.def??u.schema,p={...f},d=u.ref;if(u.ref=null,d){r(d);const m=t.seen.get(d),b=m.schema;if(b.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(f.allOf=f.allOf??[],f.allOf.push(b)):Object.assign(f,b),Object.assign(f,p),c._zod.parent===d)for(const _ in f)_==="$ref"||_==="allOf"||_ in p||delete f[_];if(b.$ref)for(const _ in f)_==="$ref"||_==="allOf"||_ in m.def&&JSON.stringify(f[_])===JSON.stringify(m.def[_])&&delete f[_]}const g=c._zod.parent;if(g&&g!==d){r(g);const m=t.seen.get(g);if(m!=null&&m.schema.$ref&&(f.$ref=m.schema.$ref,m.def))for(const b in f)b==="$ref"||b==="allOf"||b in m.def&&JSON.stringify(f[b])===JSON.stringify(m.def[b])&&delete f[b]}t.override({zodSchema:c,jsonSchema:f,path:u.path??[]})};for(const c of[...t.seen.entries()].reverse())r(c[0]);const o={};if(t.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?o.$schema="http://json-schema.org/draft-04/schema#":t.target,(s=t.external)!=null&&s.uri){const c=(a=t.external.registry.get(e))==null?void 0:a.id;if(!c)throw new Error("Schema is missing an `id` property");o.$id=t.external.uri(c)}Object.assign(o,n.def??n.schema);const i=((l=t.external)==null?void 0:l.defs)??{};for(const c of t.seen.entries()){const u=c[1];u.def&&u.defId&&(i[u.defId]=u.def)}t.external||Object.keys(i).length>0&&(t.target==="draft-2020-12"?o.$defs=i:o.definitions=i);try{const c=JSON.parse(JSON.stringify(o));return Object.defineProperty(c,"~standard",{value:{...e["~standard"],jsonSchema:{input:Kt(e,"input",t.processors),output:Kt(e,"output",t.processors)}},enumerable:!1,writable:!1}),c}catch{throw new Error("Error converting schema to JSON.")}}function ee(t,e){const n=e??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);const r=t._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return ee(r.element,n);if(r.type==="set")return ee(r.valueType,n);if(r.type==="lazy")return ee(r.getter(),n);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return ee(r.innerType,n);if(r.type==="intersection")return ee(r.left,n)||ee(r.right,n);if(r.type==="record"||r.type==="map")return ee(r.keyType,n)||ee(r.valueType,n);if(r.type==="pipe")return ee(r.in,n)||ee(r.out,n);if(r.type==="object"){for(const o in r.shape)if(ee(r.shape[o],n))return!0;return!1}if(r.type==="union"){for(const o of r.options)if(ee(o,n))return!0;return!1}if(r.type==="tuple"){for(const o of r.items)if(ee(o,n))return!0;return!!(r.rest&&ee(r.rest,n))}return!1}const Eu=(t,e={})=>n=>{const r=$o({...n,processors:e});return J(t,r),Eo(r,t),Co(r,t)},Kt=(t,e,n={})=>r=>{const{libraryOptions:o,target:i}=r??{},s=$o({...o??{},target:i,io:e,processors:n});return J(t,s),Eo(s,t),Co(s,t)},Cu={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},Pu=(t,e,n,r)=>{const o=n;o.type="string";const{minimum:i,maximum:s,format:a,patterns:l,contentEncoding:c}=t._zod.bag;if(typeof i=="number"&&(o.minLength=i),typeof s=="number"&&(o.maxLength=s),a&&(o.format=Cu[a]??a,o.format===""&&delete o.format,a==="time"&&delete o.format),c&&(o.contentEncoding=c),l&&l.size>0){const u=[...l];u.length===1?o.pattern=u[0].source:u.length>1&&(o.allOf=[...u.map(f=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:f.source}))])}},Iu=(t,e,n,r)=>{const o=n,{minimum:i,maximum:s,format:a,multipleOf:l,exclusiveMaximum:c,exclusiveMinimum:u}=t._zod.bag;typeof a=="string"&&a.includes("int")?o.type="integer":o.type="number",typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.minimum=u,o.exclusiveMinimum=!0):o.exclusiveMinimum=u),typeof i=="number"&&(o.minimum=i,typeof u=="number"&&e.target!=="draft-04"&&(u>=i?delete o.minimum:delete o.exclusiveMinimum)),typeof c=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.maximum=c,o.exclusiveMaximum=!0):o.exclusiveMaximum=c),typeof s=="number"&&(o.maximum=s,typeof c=="number"&&e.target!=="draft-04"&&(c<=s?delete o.maximum:delete o.exclusiveMaximum)),typeof l=="number"&&(o.multipleOf=l)},Nu=(t,e,n,r)=>{n.type="boolean"},Au=(t,e,n,r)=>{n.not={}},Du=(t,e,n,r)=>{},Mu=(t,e,n,r)=>{const o=t._zod.def,i=Vr(o.entries);i.every(s=>typeof s=="number")&&(n.type="number"),i.every(s=>typeof s=="string")&&(n.type="string"),n.enum=i},Ru=(t,e,n,r)=>{const o=t._zod.def,i=[];for(const s of o.values)if(s===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(s))}else i.push(s);if(i.length!==0)if(i.length===1){const s=i[0];n.type=s===null?"null":typeof s,e.target==="draft-04"||e.target==="openapi-3.0"?n.enum=[s]:n.const=s}else i.every(s=>typeof s=="number")&&(n.type="number"),i.every(s=>typeof s=="string")&&(n.type="string"),i.every(s=>typeof s=="boolean")&&(n.type="boolean"),i.every(s=>s===null)&&(n.type="null"),n.enum=i},Lu=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},Fu=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Zu=(t,e,n,r)=>{const o=n,i=t._zod.def,{minimum:s,maximum:a}=t._zod.bag;typeof s=="number"&&(o.minItems=s),typeof a=="number"&&(o.maxItems=a),o.type="array",o.items=J(i.element,e,{...r,path:[...r.path,"items"]})},ju=(t,e,n,r)=>{var c;const o=n,i=t._zod.def;o.type="object",o.properties={};const s=i.shape;for(const u in s)o.properties[u]=J(s[u],e,{...r,path:[...r.path,"properties",u]});const a=new Set(Object.keys(s)),l=new Set([...a].filter(u=>{const f=i.shape[u]._zod;return e.io==="input"?f.optin===void 0:f.optout===void 0}));l.size>0&&(o.required=Array.from(l)),((c=i.catchall)==null?void 0:c._zod.def.type)==="never"?o.additionalProperties=!1:i.catchall?i.catchall&&(o.additionalProperties=J(i.catchall,e,{...r,path:[...r.path,"additionalProperties"]})):e.io==="output"&&(o.additionalProperties=!1)},Bu=(t,e,n,r)=>{const o=t._zod.def,i=o.inclusive===!1,s=o.options.map((a,l)=>J(a,e,{...r,path:[...r.path,i?"oneOf":"anyOf",l]}));i?n.oneOf=s:n.anyOf=s},Uu=(t,e,n,r)=>{const o=t._zod.def,i=J(o.left,e,{...r,path:[...r.path,"allOf",0]}),s=J(o.right,e,{...r,path:[...r.path,"allOf",1]}),a=c=>"allOf"in c&&Object.keys(c).length===1,l=[...a(i)?i.allOf:[i],...a(s)?s.allOf:[s]];n.allOf=l},Ju=(t,e,n,r)=>{const o=n,i=t._zod.def;o.type="object";const s=i.keyType,a=s._zod.bag,l=a==null?void 0:a.patterns;if(i.mode==="loose"&&l&&l.size>0){const u=J(i.valueType,e,{...r,path:[...r.path,"patternProperties","*"]});o.patternProperties={};for(const f of l)o.patternProperties[f.source]=u}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(o.propertyNames=J(i.keyType,e,{...r,path:[...r.path,"propertyNames"]})),o.additionalProperties=J(i.valueType,e,{...r,path:[...r.path,"additionalProperties"]});const c=s._zod.values;if(c){const u=[...c].filter(f=>typeof f=="string"||typeof f=="number");u.length>0&&(o.required=u)}},Vu=(t,e,n,r)=>{const o=t._zod.def,i=J(o.innerType,e,r),s=e.seen.get(t);e.target==="openapi-3.0"?(s.ref=o.innerType,n.nullable=!0):n.anyOf=[i,{type:"null"}]},Ku=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType},Wu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType,n.default=JSON.parse(JSON.stringify(o.defaultValue))},Gu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType,e.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(o.defaultValue)))},Hu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType;let s;try{s=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=s},qu=(t,e,n,r)=>{const o=t._zod.def,i=e.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;J(i,e,r);const s=e.seen.get(t);s.ref=i},Yu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType,n.readOnly=!0},Po=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType},Xu=h("ZodISODateTime",(t,e)=>{Ql.init(t,e),F.init(t,e)});function Qu(t){return iu(Xu,t)}const ef=h("ZodISODate",(t,e)=>{ec.init(t,e),F.init(t,e)});function tf(t){return su(ef,t)}const nf=h("ZodISOTime",(t,e)=>{tc.init(t,e),F.init(t,e)});function rf(t){return au(nf,t)}const of=h("ZodISODuration",(t,e)=>{nc.init(t,e),F.init(t,e)});function sf(t){return lu(of,t)}const le=h("ZodError",(t,e)=>{Yr.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:n=>Ka(t,n)},flatten:{value:n=>Va(t,n)},addIssue:{value:n=>{t.issues.push(n),t.message=JSON.stringify(t.issues,Cn,2)}},addIssues:{value:n=>{t.issues.push(...n),t.message=JSON.stringify(t.issues,Cn,2)}},isEmpty:{get(){return t.issues.length===0}}})},{Parent:Error}),af=Dn(le),lf=Mn(le),cf=Zt(le),uf=jt(le),ff=Ha(le),pf=qa(le),df=Ya(le),hf=Xa(le),mf=Qa(le),gf=el(le),yf=tl(le),bf=nl(le),L=h("ZodType",(t,e)=>(R.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:Kt(t,"input"),output:Kt(t,"output")}}),t.toJSONSchema=Eu(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...n)=>t.clone(Oe(e,{checks:[...e.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),{parent:!0}),t.with=t.check,t.clone=(n,r)=>Te(t,n,r),t.brand=()=>t,t.register=((n,r)=>(n.add(t,r),t)),t.parse=(n,r)=>af(t,n,r,{callee:t.parse}),t.safeParse=(n,r)=>cf(t,n,r),t.parseAsync=async(n,r)=>lf(t,n,r,{callee:t.parseAsync}),t.safeParseAsync=async(n,r)=>uf(t,n,r),t.spa=t.safeParseAsync,t.encode=(n,r)=>ff(t,n,r),t.decode=(n,r)=>pf(t,n,r),t.encodeAsync=async(n,r)=>df(t,n,r),t.decodeAsync=async(n,r)=>hf(t,n,r),t.safeEncode=(n,r)=>mf(t,n,r),t.safeDecode=(n,r)=>gf(t,n,r),t.safeEncodeAsync=async(n,r)=>yf(t,n,r),t.safeDecodeAsync=async(n,r)=>bf(t,n,r),t.refine=(n,r)=>t.check(hp(n,r)),t.superRefine=n=>t.check(mp(n)),t.overwrite=n=>t.check(ot(n)),t.optional=()=>Fo(t),t.exactOptional=()=>tp(t),t.nullable=()=>Zo(t),t.nullish=()=>Fo(Zo(t)),t.nonoptional=n=>ap(t,n),t.array=()=>be(t),t.or=n=>jn([t,n]),t.and=n=>Gf(t,n),t.transform=n=>Bo(t,Qf(n)),t.default=n=>op(t,n),t.prefault=n=>sp(t,n),t.catch=n=>cp(t,n),t.pipe=n=>Bo(t,n),t.readonly=()=>pp(t),t.describe=n=>{const r=t.clone();return bt.add(r,{description:n}),r},Object.defineProperty(t,"description",{get(){var n;return(n=bt.get(t))==null?void 0:n.description},configurable:!0}),t.meta=(...n)=>{if(n.length===0)return bt.get(t);const r=t.clone();return bt.add(r,n[0]),r},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t.apply=n=>n(t),t)),Io=h("_ZodString",(t,e)=>{Rn.init(t,e),L.init(t,e),t._zod.processJSONSchema=(r,o,i)=>Pu(t,r,o);const n=t._zod.bag;t.format=n.format??null,t.minLength=n.minimum??null,t.maxLength=n.maximum??null,t.regex=(...r)=>t.check(hu(...r)),t.includes=(...r)=>t.check(yu(...r)),t.startsWith=(...r)=>t.check(bu(...r)),t.endsWith=(...r)=>t.check(vu(...r)),t.min=(...r)=>t.check(Vt(...r)),t.max=(...r)=>t.check(Oo(...r)),t.length=(...r)=>t.check(To(...r)),t.nonempty=(...r)=>t.check(Vt(1,...r)),t.lowercase=r=>t.check(mu(r)),t.uppercase=r=>t.check(gu(r)),t.trim=()=>t.check(ku()),t.normalize=(...r)=>t.check(_u(...r)),t.toLowerCase=()=>t.check(wu()),t.toUpperCase=()=>t.check(Su()),t.slugify=()=>t.check(xu())}),vf=h("ZodString",(t,e)=>{Rn.init(t,e),Io.init(t,e),t.email=n=>t.check(Lc(_f,n)),t.url=n=>t.check(Uc(kf,n)),t.jwt=n=>t.check(ou(Mf,n)),t.emoji=n=>t.check(Jc(wf,n)),t.guid=n=>t.check(wo(No,n)),t.uuid=n=>t.check(Fc(Wt,n)),t.uuidv4=n=>t.check(Zc(Wt,n)),t.uuidv6=n=>t.check(jc(Wt,n)),t.uuidv7=n=>t.check(Bc(Wt,n)),t.nanoid=n=>t.check(Vc(Sf,n)),t.guid=n=>t.check(wo(No,n)),t.cuid=n=>t.check(Kc(xf,n)),t.cuid2=n=>t.check(Wc(zf,n)),t.ulid=n=>t.check(Gc(Of,n)),t.base64=n=>t.check(tu(Nf,n)),t.base64url=n=>t.check(nu(Af,n)),t.xid=n=>t.check(Hc(Tf,n)),t.ksuid=n=>t.check(qc($f,n)),t.ipv4=n=>t.check(Yc(Ef,n)),t.ipv6=n=>t.check(Xc(Cf,n)),t.cidrv4=n=>t.check(Qc(Pf,n)),t.cidrv6=n=>t.check(eu(If,n)),t.e164=n=>t.check(ru(Df,n)),t.datetime=n=>t.check(Qu(n)),t.date=n=>t.check(tf(n)),t.time=n=>t.check(rf(n)),t.duration=n=>t.check(sf(n))});function ce(t){return Rc(vf,t)}const F=h("ZodStringFormat",(t,e)=>{M.init(t,e),Io.init(t,e)}),_f=h("ZodEmail",(t,e)=>{Jl.init(t,e),F.init(t,e)}),No=h("ZodGUID",(t,e)=>{Bl.init(t,e),F.init(t,e)}),Wt=h("ZodUUID",(t,e)=>{Ul.init(t,e),F.init(t,e)}),kf=h("ZodURL",(t,e)=>{Vl.init(t,e),F.init(t,e)}),wf=h("ZodEmoji",(t,e)=>{Kl.init(t,e),F.init(t,e)}),Sf=h("ZodNanoID",(t,e)=>{Wl.init(t,e),F.init(t,e)}),xf=h("ZodCUID",(t,e)=>{Gl.init(t,e),F.init(t,e)}),zf=h("ZodCUID2",(t,e)=>{Hl.init(t,e),F.init(t,e)}),Of=h("ZodULID",(t,e)=>{ql.init(t,e),F.init(t,e)}),Tf=h("ZodXID",(t,e)=>{Yl.init(t,e),F.init(t,e)}),$f=h("ZodKSUID",(t,e)=>{Xl.init(t,e),F.init(t,e)}),Ef=h("ZodIPv4",(t,e)=>{rc.init(t,e),F.init(t,e)}),Cf=h("ZodIPv6",(t,e)=>{oc.init(t,e),F.init(t,e)}),Pf=h("ZodCIDRv4",(t,e)=>{ic.init(t,e),F.init(t,e)}),If=h("ZodCIDRv6",(t,e)=>{sc.init(t,e),F.init(t,e)}),Nf=h("ZodBase64",(t,e)=>{ac.init(t,e),F.init(t,e)}),Af=h("ZodBase64URL",(t,e)=>{cc.init(t,e),F.init(t,e)}),Df=h("ZodE164",(t,e)=>{uc.init(t,e),F.init(t,e)}),Mf=h("ZodJWT",(t,e)=>{pc.init(t,e),F.init(t,e)}),Ao=h("ZodNumber",(t,e)=>{lo.init(t,e),L.init(t,e),t._zod.processJSONSchema=(r,o,i)=>Iu(t,r,o),t.gt=(r,o)=>t.check(xo(r,o)),t.gte=(r,o)=>t.check(Zn(r,o)),t.min=(r,o)=>t.check(Zn(r,o)),t.lt=(r,o)=>t.check(So(r,o)),t.lte=(r,o)=>t.check(Fn(r,o)),t.max=(r,o)=>t.check(Fn(r,o)),t.int=r=>t.check(Do(r)),t.safe=r=>t.check(Do(r)),t.positive=r=>t.check(xo(0,r)),t.nonnegative=r=>t.check(Zn(0,r)),t.negative=r=>t.check(So(0,r)),t.nonpositive=r=>t.check(Fn(0,r)),t.multipleOf=(r,o)=>t.check(zo(r,o)),t.step=(r,o)=>t.check(zo(r,o)),t.finite=()=>t;const n=t._zod.bag;t.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),t.isFinite=!0,t.format=n.format??null});function Rf(t){return cu(Ao,t)}const Lf=h("ZodNumberFormat",(t,e)=>{dc.init(t,e),Ao.init(t,e)});function Do(t){return uu(Lf,t)}const Ff=h("ZodBoolean",(t,e)=>{hc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Nu(t,n,r)});function Zf(t){return fu(Ff,t)}const jf=h("ZodUnknown",(t,e)=>{mc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Du()});function Mo(){return pu(jf)}const Bf=h("ZodNever",(t,e)=>{gc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Au(t,n,r)});function Uf(t){return du(Bf,t)}const Jf=h("ZodArray",(t,e)=>{yc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Zu(t,n,r,o),t.element=e.element,t.min=(n,r)=>t.check(Vt(n,r)),t.nonempty=n=>t.check(Vt(1,n)),t.max=(n,r)=>t.check(Oo(n,r)),t.length=(n,r)=>t.check(To(n,r)),t.unwrap=()=>t.element});function be(t,e){return zu(Jf,t,e)}const Vf=h("ZodObject",(t,e)=>{vc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>ju(t,n,r,o),P(t,"shape",()=>e.shape),t.keyof=()=>Gt(Object.keys(t._zod.def.shape)),t.catchall=n=>t.clone({...t._zod.def,catchall:n}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Mo()}),t.loose=()=>t.clone({...t._zod.def,catchall:Mo()}),t.strict=()=>t.clone({...t._zod.def,catchall:Uf()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=n=>Za(t,n),t.safeExtend=n=>ja(t,n),t.merge=n=>Ba(t,n),t.pick=n=>La(t,n),t.omit=n=>Fa(t,n),t.partial=(...n)=>Ua(Lo,t,n[0]),t.required=(...n)=>Ja(jo,t,n[0])});function it(t,e){const n={type:"object",shape:t??{},...k(e)};return new Vf(n)}const Kf=h("ZodUnion",(t,e)=>{_c.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Bu(t,n,r,o),t.options=e.options});function jn(t,e){return new Kf({type:"union",options:t,...k(e)})}const Wf=h("ZodIntersection",(t,e)=>{kc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Uu(t,n,r,o)});function Gf(t,e){return new Wf({type:"intersection",left:t,right:e})}const Hf=h("ZodRecord",(t,e)=>{wc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Ju(t,n,r,o),t.keyType=e.keyType,t.valueType=e.valueType});function Ro(t,e,n){return new Hf({type:"record",keyType:t,valueType:e,...k(n)})}const Bn=h("ZodEnum",(t,e)=>{Sc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(r,o,i)=>Mu(t,r,o),t.enum=e.entries,t.options=Object.values(e.entries);const n=new Set(Object.keys(e.entries));t.extract=(r,o)=>{const i={};for(const s of r)if(n.has(s))i[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new Bn({...e,checks:[],...k(o),entries:i})},t.exclude=(r,o)=>{const i={...e.entries};for(const s of r)if(n.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new Bn({...e,checks:[],...k(o),entries:i})}});function Gt(t,e){const n=Array.isArray(t)?Object.fromEntries(t.map(r=>[r,r])):t;return new Bn({type:"enum",entries:n,...k(e)})}const qf=h("ZodLiteral",(t,e)=>{xc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Ru(t,n,r),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function Yf(t,e){return new qf({type:"literal",values:Array.isArray(t)?t:[t],...k(e)})}const Xf=h("ZodTransform",(t,e)=>{zc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Fu(t,n),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Ur(t.constructor.name);n.addIssue=i=>{if(typeof i=="string")n.issues.push(yt(i,n.value,e));else{const s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),n.issues.push(yt(s))}};const o=e.transform(n.value,n);return o instanceof Promise?o.then(i=>(n.value=i,n)):(n.value=o,n)}});function Qf(t){return new Xf({type:"transform",transform:t})}const Lo=h("ZodOptional",(t,e)=>{go.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Po(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function Fo(t){return new Lo({type:"optional",innerType:t})}const ep=h("ZodExactOptional",(t,e)=>{Oc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Po(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function tp(t){return new ep({type:"optional",innerType:t})}const np=h("ZodNullable",(t,e)=>{Tc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Vu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function Zo(t){return new np({type:"nullable",innerType:t})}const rp=h("ZodDefault",(t,e)=>{$c.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Wu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function op(t,e){return new rp({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():Hr(e)}})}const ip=h("ZodPrefault",(t,e)=>{Ec.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Gu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function sp(t,e){return new ip({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():Hr(e)}})}const jo=h("ZodNonOptional",(t,e)=>{Cc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Ku(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function ap(t,e){return new jo({type:"nonoptional",innerType:t,...k(e)})}const lp=h("ZodCatch",(t,e)=>{Pc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Hu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function cp(t,e){return new lp({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const up=h("ZodPipe",(t,e)=>{Ic.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>qu(t,n,r,o),t.in=e.in,t.out=e.out});function Bo(t,e){return new up({type:"pipe",in:t,out:e})}const fp=h("ZodReadonly",(t,e)=>{Nc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Yu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function pp(t){return new fp({type:"readonly",innerType:t})}const dp=h("ZodCustom",(t,e)=>{Ac.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>Lu(t,n)});function hp(t,e={}){return Ou(dp,t,e)}function mp(t){return Tu(t)}const Un=new Set(["files","gap","headline","hidden","info","line","pages","users"]),Uo={text:t=>we(t,`"${t.label}", single-line plain text without line breaks or formatting`),textarea:t=>we(t,`"${t.label}", multi-line text with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),markdown:t=>we(t,`"${t.label}", multi-line text with Markdown formatting`),slug:t=>we(t,`"${t.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`),url:t=>we(t,`"${t.label}", a valid URL starting with http:// or https://`),email:t=>we(t,`"${t.label}", a valid email address`),password:t=>we(t,`"${t.label}", a secure password (not for actual use)`),tel:t=>we(t,`"${t.label}", a telephone number in appropriate format for the context`),writer:t=>we(t,`"${t.label}" (WYSIWYG), ${t.inline===!0?"text with inline formatting only (bold, italic, underline, code, links, email, sub, sup). NO wrapping paragraph <p> tags allowed.":"text wrapped in paragraph <p> tags (can contain one or multiple paragraphs). Inline formatting (bold, italic, underline, code, links, email, sub, sup) is allowed."}`),list:t=>ce().describe(`"${t.label}" (WYSIWYG), HTML list wrapped in <ul> or <ol>. Use <li> for items with inline formatting (bold, italic, underline, code, links, email, sub, sup).`),number:t=>Vo(t),range:t=>Vo(t),toggle:t=>Zf().describe(`"${t.label}", a boolean`),select:t=>Vn(t),radio:t=>Vn(t),toggles:t=>Vn(t),checkboxes:t=>Kn(t),multiselect:t=>Kn(t),tags:t=>Kn(t),date:t=>ce().describe(`"${t.label}", a date ${t.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:t=>ce().describe(`"${t.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),color:t=>ce().describe(`"${t.label}", a color value in hex, rgb or hsl format`),link:t=>ce().describe(`"${t.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),structure:t=>{const e=Jo(t);return e?be(e).describe(`"${t.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`):be(Ro(ce(),ce())).describe(`"${t.label}", repeatable structured data based on expected content structure`)},object:t=>{const e=Jo(t);return e?e.describe(`"${t.label}", structured data containing the defined sub-fields with appropriate content`):Ro(ce(),ce()).describe(`"${t.label}", object data based on expected content structure`)},entries:t=>{const e=t,n=e.field,r={...n,name:"entry",label:t.label||"Entry"},o=Uo[n.type],i=o(r);let s=be(i);return e.min!=null&&(s=s.min(e.min)),e.max!=null&&(s=s.max(e.max)),s.describe(`"${t.label}", multiple entries of ${n.type} values${e.min!=null||e.max!=null?" within the defined count range":""}`)}};function Jn(t){var r,o,i,s,a;const e=Uo[t.type];if(!e)throw new Error(`Unsupported field type: ${t.type}`);let n=e(t);if(t.required===!0){const l=(o=(r=n._zod)==null?void 0:r.def)==null?void 0:o.type;l==="string"?n.minLength==null&&(n=n.min(1)):l==="array"&&((a=(s=(i=n._zod)==null?void 0:i.def)==null?void 0:s.checks)!=null&&a.some(u=>{var f,p;return((p=(f=u._zod)==null?void 0:f.def)==null?void 0:p.check)==="min_length"})||(n=n.min(1)))}else n=n.nullable();return n}function Jo(t){if(typeof t.fields!="object"||t.fields===null)return;const e={};for(const[n,r]of Object.entries(t.fields))r.disabled||r.hidden||Un.has(r.type)||(e[n]=Jn({...r,name:n}));return it(e).strict()}function we(t,e){let n=ce();return t.minlength!=null&&(n=n.min(t.minlength)),t.maxlength!=null&&(n=n.max(t.maxlength)),n.describe(e)}function Vo(t){let e=Rf();return t.min!=null&&(e=e.min(t.min)),t.max!=null&&(e=e.max(t.max)),e.describe(`"${t.label}", a numeric value${t.min!=null||t.max!=null?" within the defined range":""}`)}function Vn(t){const e=(t.options??[]).map(n=>n.value).filter(n=>typeof n=="string"&&!!n);return e.length>0?Gt(e).describe(`"${t.label}", single selection value based on the predefined options`):ce().describe(`"${t.label}", single selection value`)}function Kn(t){const e=(t.options??[]).map(n=>n.value).filter(n=>typeof n=="string"&&!!n);return e.length>0?be(Gt(e)).describe(`"${t.label}", one ore many values based on the predefined options`):be(ce()).describe(`"${t.label}", multiple selection values`)}function Ko(t){const{name:e,type:n,fields:r}=t;if(!r||Object.keys(r).length===0)return;const o={};for(const i of Object.values(r)){if(i.disabled||i.hidden||Un.has(i.type))continue;const s=Jn(i);o[i.name]=s}return it({type:Yf(n),content:it(o).strict()}).strict().describe(`Kirby block: ${e}`)}function gp(t){if(!Array.isArray(t)||t.length===0)throw new Error("Invalid fieldsets configuration");const e=t.map(Ko).filter(n=>n!=null);return jn(e).describe("Union of all Kirby block types")}function yp(t,e={}){if(!t||t.length===0)throw new Error("No fieldsets available for layout schema generation");const n=e.layouts??[["1/1"]],r=bp(n),o=vp(t,r),i=n.map(s=>`"${s}"`).join(", ");return o.describe(`Kirby layout with columns and blocks. Available layout combinations: ${i}. Use these exact column width combinations when creating layouts.`)}function bp(t){const e=new Set;for(const n of t)for(const r of n)typeof r=="string"&&r.trim()&&e.add(r);return[...e]}function vp(t,e){const n=_p(t,e);return it({columns:be(n).min(1).describe("Array of columns in this layout")}).strict()}function _p(t,e){const n=t.map(Ko).filter(o=>o!=null),r=n.length>1?jn(n):n[0];return it({width:Gt(e).describe('Column width fraction to use, e.g. "1/2"'),blocks:be(r).describe("Array of blocks contained in this column")}).strict()}let Ht,vt;function Wn(){return Ht?Promise.resolve(Ht):vt||(vt=window.panel.api.get(Fs).then(t=>(Ht=t,vt=void 0,Ht)),vt)}function Gn(){async function t(n){let r=await Wn();const{config:o}=await ye();if(o.excludedBlocks&&Array.isArray(o.excludedBlocks)&&(r=r.filter(i=>!o.excludedBlocks.includes(i.type))),n.fieldsets){const i=Array.isArray(n.fieldsets)?n.fieldsets:Object.keys(n.fieldsets);r=r.filter(s=>i.includes(s.type))}return gp(r)}function e(n){return n.isHidden??(n.isHidden=!1),n.id??(n.id=crypto.randomUUID()),n}return{getFieldsets:Wn,getZodSchema:t,normalizeBlock:e}}function Hn(){async function t(n){let r=await Wn();const{config:o}=await ye();if(o.excludedBlocks&&Array.isArray(o.excludedBlocks)&&(r=r.filter(i=>!o.excludedBlocks.includes(i.type))),n.fieldsets){const i=Array.isArray(n.fieldsets)?n.fieldsets:Object.keys(n.fieldsets);r=r.filter(s=>i.includes(s.type))}return yp(r,n)}function e(n){return n.id??(n.id=crypto.randomUUID()),n.attrs??(n.attrs=[]),n.columns=(n.columns??[]).map(r=>(r.id??(r.id=crypto.randomUUID()),r.width??(r.width="1/1"),r.blocks=(r.blocks??[]).map(o=>(o.isHidden??(o.isHidden=!1),o.id??(o.id=crypto.randomUUID()),o)),r)),n}return{getZodSchema:t,normalizeLayout:e}}const qt=new Map;function Wo(){const t=z();async function e(){const{path:r}=t.view;if(qt.has(r))return qt.get(r);const o=await t.api.get(Ls,{id:r},void 0,!0),i=Object.values(o).filter(s=>!Un.has(s.type)&&!s.disabled&&!s.hidden);return qt.set(r,i),i}function n(){qt.delete(t.view.path)}return{getModelFields:e,clearModelFields:n}}async function Go(t={}){return new Promise(e=>{const n=z();let r;n.dialog.open({component:"k-copilot-prompt-dialog",props:t,on:{close:()=>{setTimeout(()=>{e(r)},25)},submit:o=>{r=o,n.dialog.close()}}})})}const kp={list:"rich-text",markdown:"markdown",textarea:"markdown",writer:"rich-text"};function wp(t){return kp[t]??"text"}function Yt(t,e,n){if(Array.isArray(t)){for(const o of t){const i=Yt(o,e,n);if(i)return i}return}const r=t;if(r.name===e&&(!n||r.type===n))return r;if("fieldsets"in r&&r.fieldsets){for(const o of Object.values(r.fieldsets))if(o.tabs){for(const i of Object.values(o.tabs))if(i.fields)for(const s of Object.values(i.fields)){const a=Yt(s,e,n);if(a)return a}}}if("fields"in r&&r.fields)for(const o of Object.values(r.fields)){const i=Yt(o,e,n);if(i)return i}}const Sp={inheritAttrs:!1},xp=Vue.defineComponent({...Sp,__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String}},emits:["input"],setup(t,{expose:e,emit:n}){const r=t,o=S(),i=H({get(){return r.value},set(u){n("input",u)}}),s=S({start:0,end:0});function a(){o.value&&(s.value={start:o.value.selectionStart,end:o.value.selectionEnd})}function l(u){const{start:f,end:p}=s.value,d=r.value,g=d.slice(0,f)+u+d.slice(p);n("input",g),requestAnimationFrame(()=>{if(o.value){o.value.focus();const m=f+u.length;o.value.setSelectionRange(m,m),s.value={start:m,end:m}}})}function c(){var u;(u=o.value)==null||u.focus()}return e({insertAtCursor:l,focus:c,el:o}),{__sfc:!0,props:r,emit:n,textarea:o,text:i,cursorPosition:s,updateCursorPosition:a,insertAtCursor:l,focus:c}}});var zp=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",e._b({directives:[{name:"model",rawName:"v-model",value:r.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:e.sharedClass,domProps:{value:r.text},on:{mouseup:r.updateCursorPosition,keyup:r.updateCursorPosition,focus:r.updateCursorPosition,input:function(o){o.target.composing||(r.text=o.target.value)}}},"textarea",e.$attrs,!1)),e._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:e.sharedClass,domProps:{textContent:e._s(`${e.value} `)}})])},Op=[],Tp=qe(xp,zp,Op,!1,null,"ec883cae");const $p=Tp.exports,Ep=Vue.defineComponent({__name:"ContentDropdown",emits:["close"],setup(t,{expose:e,emit:n}){const r=S();function o(){var a;(a=r.value)==null||a.close()}function i(a){var l;(l=r.value)==null||l.open(a)}function s(){var a;(a=r.value)==null||a.toggle()}return e({close:o,open:i,toggle:s}),{__sfc:!0,emit:n,dropdown:r,close:o,open:i,toggle:s}}});var Cp=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("k-dropdown-content",{ref:"dropdown",staticClass:"k-copilot-dropdown-content",attrs:{"align-x":"start",navigate:!1}},[n("k-navigate",{attrs:{element:"nav",axis:"y",select:"input[type=search], label, .k-copilot-dropdown-content-body button"},on:{prev:function(o){return r.emit("close")}}},[e._t("default")],2)],1)},Pp=[],Ip=qe(Ep,Cp,Pp,!1,null,null);const Np=Ip.exports,Ap=Vue.defineComponent({__name:"Prompt",props:{fields:Array,selection:String,userPrompt:String,activeField:Object},emits:["cancel","close","input","submit","success"],setup(t,{emit:e}){const n=t,r=He(),o=z(),{lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:l,getRecentEntries:c}=Pa(),{allTemplates:u,templates:f,setConfigTemplates:p}=jr(),{openSaveTemplateDialog:d,openEditTemplatesDialog:g}=$a(),{getModelFields:m}=Wo(),b=Mr(),w=S(),_=H(()=>{var x;return(x=w.value)==null?void 0:x.el}),v=S(n.userPrompt||""),I=S([]),O=S(),N=S([...n.fields??[]]),W=S(),B=S([]),Ne=S(),q=S(!1),U=S(""),re=S(),ae=S(),Ke=[{value:"replace",text:o.t("johannschopplich.copilot.replace")},{value:"append",text:o.t("johannschopplich.copilot.append")}],We=S(Ke[0].value),Ae=H(()=>n.fields&&n.fields.length>0),xr=H(()=>c(10)),zr=H(()=>{const x=v.value.match(Fr);return x?x.map(A=>A.slice(1,-1)).some(A=>A in b):!1}),Pt=H(()=>Zr(v.value,b,x=>`{${x}}`).trim()),Y=H(()=>[{name:"title",label:o.t("title")},...N.value]),he=H(()=>{const x=U.value.toLowerCase();return x.trim()?Y.value.filter(C=>C.name.toLowerCase().includes(x)||C.label&&C.label.toLowerCase().includes(x)):Y.value});Ea(_,"keydown",x=>{if((x.metaKey||x.ctrlKey)&&x.key==="Enter"){if(x.preventDefault(),!v.value.trim()||Ae.value&&B.value.length===0)return;D()}const C=x.target;if(x.key==="ArrowUp"&&(C==null?void 0:C.selectionStart)===0||x.key==="ArrowDown"&&(C==null?void 0:C.selectionStart)===(C==null?void 0:C.value.length)){x.preventDefault(),x.key==="ArrowUp"&&s.value===-1&&(i.value=v.value);const A=l(x.key==="ArrowUp"?"up":"down");A!==void 0&&(v.value=A)}}),(async()=>{var C;const x=await ye();if(O.value=x.licenseStatus,p(x.config.promptTemplates??[]),n.fields||(N.value=await m()),n.activeField){const A=Yt(N.value,n.activeField.name,n.activeField.type);typeof((C=A==null?void 0:A.copilot)==null?void 0:C.userPrompt)=="string"&&(v.value=A.copilot.userPrompt)}})();function D(){if(Ae.value&&B.value.length===0){o.notification.info(o.t("johannschopplich.copilot.selectFields"));return}a(v.value),e("submit",{prompt:v.value,files:I.value,selectedFieldNames:B.value,insertMode:We.value})}async function Ge(){const x=await Rr({accept:Ar.join(",")});I.value=[...I.value,...x]}function ft(){var x;q.value||(U.value=""),q.value=!q.value,(x=Ne.value)==null||x.toggle()}function me(x){var A;const C=`{${x}}`;(A=w.value)==null||A.insertAtCursor(C),q.value=!1}function ge(x){var C,A;v.value=x.prompt,(C=re.value)==null||C.close(),(A=_.value)==null||A.focus()}function pt(x){var C,A;v.value=x,(C=ae.value)==null||C.close(),(A=_.value)==null||A.focus()}function dt(x){const C=b[x]??"",A=String(C);return A.length>30?`${A.slice(0,30)}…`:A}return{__sfc:!0,props:n,emit:e,_isKirby5:r,panel:o,lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:l,getRecentEntries:c,allTemplates:u,templates:f,setConfigTemplates:p,openSaveTemplateDialog:d,openEditTemplatesDialog:g,getModelFields:m,contentContext:b,textareaComponent:w,textarea:_,prompt:v,files:I,licenseStatus:O,modelFields:N,fieldsDropdown:W,selectedFieldNames:B,placeholderDropdown:Ne,isPlaceholderDropdownOpen:q,placeholderSearch:U,templateDropdown:re,historyDropdown:ae,selectionInsertOptions:Ke,insertOption:We,isFieldGenerationMode:Ae,recentPrompts:xr,hasPlaceholders:zr,resolvedPrompt:Pt,placeholderFields:Y,filteredPlaceholderFields:he,submit:D,pickFiles:Ge,togglePlaceholderDropdown:ft,insertFieldPlaceholder:me,loadTemplate:ge,loadPromptFromHistory:pt,getFieldPreview:dt,LicensingButtonGroup:Pr,AutoGrowTextarea:$p,ContentDropdown:Np}}});var Dp=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(o){return r.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] has-[textarea:focus]:kai-outline has-[textarea:focus]:kai-outline-[2px] has-[textarea:focus]:kai-outline-[var(--color-focus)]"},[n(r.AutoGrowTextarea,{ref:"textareaComponent",attrs:{value:r.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:r.panel.t("johannschopplich.copilot.prompt.placeholder")+(e.selection?` (${r.panel.t("johannschopplich.copilot.prompt.selectionContext")})`:""),rows:"3"},on:{input:function(o){r.prompt=o}}}),r.hasPlaceholders?n("details",{staticClass:"kai-group kai-mx-2 kai-mb-2 kai-rounded-[var(--rounded)] kai-bg-[var(--color-background)]"},[n("summary",{staticClass:"kai-flex kai-cursor-pointer kai-list-none kai-items-center kai-gap-0.5 kai-rounded-[var(--rounded)] kai-p-1.5 focus:kai-outline focus:kai-outline-[2px] focus:kai-outline-[var(--color-focus)] [&::-webkit-details-marker]:kai-hidden"},[n("k-icon",{staticClass:"kai-size-[var(--icon-size)] kai-transition-transform [transform:rotate(-90deg)] group-open:[transform:rotate(0deg)]",attrs:{type:"angle-dropdown"}}),n("span",[e._v(e._s(r.panel.t("johannschopplich.copilot.preview")))])],1),n("div",{staticClass:"kai-px-1.5 kai-py-2"},[n("p",{staticClass:"kai-whitespace-pre-wrap kai-leading-[1.375]",domProps:{textContent:e._s(r.resolvedPrompt)}})])]):e._e(),n("div",{staticClass:"kai-flex kai-items-center kai-justify-between kai-px-2 kai-pb-2"},[n("div",{staticClass:"kai-flex kai-flex-wrap kai-items-center kai-gap-1"},[n("k-button",{attrs:{icon:"attachment",badge:r._isKirby5&&r.files.length>0?{theme:"notice",text:r.files.length}:void 0,"aria-label":r.files.length>0?`${r.panel.t("johannschopplich.copilot.files.select")} (${r.files.length})`:r.panel.t("johannschopplich.copilot.files.select")},on:{click:function(o){return r.pickFiles()}}}),r.files.length>0?n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(o){r.files=[]}}}):e._e(),n("k-button",{staticClass:"max-sm:kai-hidden",attrs:{icon:"copilot-text-snippet",dropdown:!0,"aria-label":r.panel.t("johannschopplich.copilot.placeholder.insert")},on:{click:function(o){return r.togglePlaceholderDropdown()}}}),n(r.ContentDropdown,{ref:"placeholderDropdown",on:{close:function(o){r.isPlaceholderDropdownOpen=!1}}},[r.modelFields.length>5?n("header",{staticClass:"k-copilot-dropdown-content-header"},[n("div",{staticClass:"k-copilot-dropdown-content-search"},[n("k-search-input",{attrs:{value:r.placeholderSearch,type:"text",placeholder:r.panel.t("johannschopplich.copilot.placeholder.search")},on:{input:function(o){r.placeholderSearch=o}},nativeOn:{click:function(o){o.stopPropagation()},keydown:[function(o){o.stopPropagation()},function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"escape",void 0,o.key,void 0)?null:(o.preventDefault(),r.togglePlaceholderDropdown())}]}})],1)]):e._e(),n("div",{staticClass:"k-copilot-dropdown-content-body"},[e._l(r.filteredPlaceholderFields,function(o){return n("k-dropdown-item",{key:o.name,on:{click:function(i){return r.insertFieldPlaceholder(o.name)}}},[n("span",{staticClass:"kai-inline-flex kai-w-full kai-items-center kai-gap-3"},[n("span",[e._v(e._s(o.label||o.name))]),r.getFieldPreview(o.name)?n("span",{staticClass:"kai-truncate kai-leading-[1.5] kai-text-[var(--color-text-dimmed)] [font-size:var(--font-size-tiny)]"},[e._v(e._s(r.getFieldPreview(o.name)))]):e._e()])])}),r.filteredPlaceholderFields.length===0?n("k-dropdown-item",{attrs:{disabled:""}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.placeholder.notFound"))+" ")]):e._e()],2)]),n("k-button",{staticClass:"max-sm:kai-hidden",attrs:{icon:"bookmark",dropdown:!0,"aria-label":r.panel.t("johannschopplich.copilot.templates")},on:{click:function(o){var i;(i=r.templateDropdown)==null||i.toggle()}}}),n(r.ContentDropdown,{ref:"templateDropdown"},[n("div",{staticClass:"k-copilot-dropdown-content-body"},[r.prompt.trim()?n("k-dropdown-item",{attrs:{icon:"add"},on:{click:function(o){return r.openSaveTemplateDialog(r.prompt)}}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.template.saveAs"))+" ")]):e._e(),r.templates.length>0?n("k-dropdown-item",{attrs:{icon:"settings"},on:{click:function(o){return r.openEditTemplatesDialog()}}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.template.edit"))+" ")]):e._e(),r.allTemplates.length>0?n("hr"):e._e(),e._l(r.allTemplates,function(o){return n("k-dropdown-item",{key:o.id,on:{click:function(i){return r.loadTemplate(o)}}},[n("span",{staticClass:"kai-truncate"},[e._v(e._s(o.label))])])}),r.allTemplates.length===0?n("k-dropdown-item",{attrs:{disabled:""}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.template.empty"))+" ")]):e._e()],2)]),r.recentPrompts.length>0?[n("k-button",{staticClass:"max-sm:kai-hidden",attrs:{icon:"clock","aria-label":r.panel.t("johannschopplich.copilot.history"),dropdown:!0},on:{click:function(o){var i;(i=r.historyDropdown)==null||i.toggle()}}}),n(r.ContentDropdown,{ref:"historyDropdown"},[n("div",{staticClass:"k-copilot-dropdown-content-body"},e._l(r.recentPrompts,function(o,i){return n("k-dropdown-item",{key:i,on:{click:function(s){return r.loadPromptFromHistory(o)}}},[n("span",{staticClass:"kai-truncate"},[e._v(e._s(o))])])}),1)])]:e._e()],2),n("div",{staticClass:"kai-flex kai-gap-2"},[r.isFieldGenerationMode?[n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.fields"),variant:"filled",badge:r.selectedFieldNames.length>0?{theme:"info",text:r.selectedFieldNames.length}:void 0,dropdown:""},on:{click:function(o){var i;(i=r.fieldsDropdown)==null||i.toggle()}}}),n("k-picklist-dropdown",{ref:"fieldsDropdown",attrs:{options:r.modelFields.map(o=>({value:o.name,text:o.label||o.name})),empty:!1,value:r.selectedFieldNames},on:{input:function(o){r.selectedFieldNames=o}}})]:e.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:r.selectionInsertOptions,empty:!1,value:r.insertOption},on:{input:function(o){r.insertOption=o}}}):e._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling",disabled:!r.prompt.trim()},on:{click:function(o){return r.submit()}}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.generate"))+" ")])],2)]),r.licenseStatus!==void 0?n(r.LicensingButtonGroup,{staticClass:"k-copilot-prompt-dialog-licensing-buttons kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px-2px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":r.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):e._e()],1)])},Mp=[],Rp=qe(Ap,Dp,Mp,!1,null,null);const Lp=Rp.exports,Ho={...{blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number}},Fp={inheritAttrs:!1},Zp=Vue.defineComponent({...Fp,__name:"Copilot",props:Ho,setup(t){const e=t,n=He(),r=z(),{t:o}=cs(),{currentContent:i,update:s}=mn(),a=S(),l=S(),c=S(),u=S(),f=S(),p=S(),d=S(),g=S(),m=S(),b=S(),w=S(),_=S(),v=S(!1),I=S(!1),O=S(!1),N=S(),W=S(),B=S(),Ne=S([]),q=S([]),U=S();let re,ae;const Ke=H(()=>!I.value&&B.value!==void 0);bn(W,Y=>{v.value&&f.value&&(Y&&Y!==c.value?localStorage.setItem(`${re}$prompt`,Y):(!Y||Y===c.value)&&localStorage.removeItem(`${re}$prompt`))}),bn(O,Y=>{v.value&&f.value&&(Y?localStorage.setItem(`${re}$open`,"true"):localStorage.removeItem(`${re}$open`))}),(async()=>{var Ge;const{load:Y}=us(),[he,D]=await Promise.all([ye(),Y({parent:e.parent,name:e.name})]);if(a.value=o(D.label)||r.t("johannschopplich.copilot.label"),l.value=D.field??void 0,c.value=D.userPrompt??void 0,u.value=D.systemPrompt||he.config.systemPrompt||Sn,f.value=D.storage,D.editable===!0&&Ne.value.push("edit"),D.files===!0&&Ne.value.push("files"),p.value=D.icon||"sparkling",d.value=D.theme||"notice-icon",g.value=D.size||"md",m.value=Ye.indexOf(D.logLevel&&Ye.includes(D.logLevel)?D.logLevel:he.config.logLevel&&Ye.includes(he.config.logLevel)?he.config.logLevel:Nr),w.value=D.help?o(D.help):void 0,_.value=he.config,U.value=he.licenseStatus,D.files==="auto"&&D.modelFile){b.value=D.modelFile;const{mime:ft,url:me}=D.modelFile;xn.includes(ft)&&fetch(me).then(ge=>ge.blob()).then(ge=>{const pt=me.split("/").pop()||"file";q.value=[new File([ge],pt,{type:ft})]})}f.value&&((Ge=l.value)!=null&&Ge.name)&&(re=$n(r.view.path,l.value.name.toLowerCase()),W.value=localStorage.getItem(`${re}$prompt`)||c.value||"",O.value=localStorage.getItem(`${re}$open`)==="true"||D.open,ks(()=>{N.value&&O.value&&(N.value.open=!0)})),r.events.on("view.save",Pt),v.value=!0})(),ws(()=>{r.events.off("view.save",Pt)});async function We(){if(!W.value){r.notification.error(r.t("johannschopplich.copilot.prompt.empty"));return}if(!l.value)return;r.isLoading=!0,I.value=!0,B.value=i.value[l.value.name.toLowerCase()],ae=new AbortController;const{getZodSchema:Y,normalizeBlock:he}=Gn(),{getZodSchema:D,normalizeLayout:Ge}=Hn(),{Output:ft}=await De(),{signal:me}=ae;try{let ge="",pt=[];if(l.value.type==="layout"||l.value.type==="blocks"){const dt=l.value.type==="layout"?Ge:he,x=l.value.type==="layout"?await D(l.value):await Y(l.value),{partialOutputStream:C,output:A}=await gt({userPrompt:W.value,systemPrompt:u.value,output:ft.array({element:x}),files:q.value,logLevel:m.value,abortSignal:me});A.catch(()=>{});for await(const Or of C){if(me.aborted)return;!Or||!Array.isArray(Or)||await s({[l.value.name.toLowerCase()]:[...B.value,...Or.map(dt)]},!1)}pt=await A}else{const dt=wp(l.value.type),{textStream:x}=await gt({userPrompt:Lr(W.value,{responseFormat:dt}),systemPrompt:u.value,responseFormat:dt,files:q.value,logLevel:m.value,abortSignal:me});for await(const C of x){if(me.aborted)return;ge+=C,await s({[l.value.name.toLowerCase()]:B.value+ge},!1)}}if(me.aborted)return;await s({[l.value.name.toLowerCase()]:l.value.type==="layout"||l.value.type==="blocks"?[...B.value,...(pt??[]).map(l.value.type==="layout"?Ge:he)]:B.value+ge}),r.notification.success({icon:"check",message:r.t("johannschopplich.copilot.notification.success")})}catch(ge){if(me.aborted)return;await zn(ge)}finally{ae=void 0,r.isLoading=!1,I.value=!1}}function Ae(){ae==null||ae.abort(),ae=void 0,r.isLoading=!1,I.value=!1}function xr(){l.value&&(s({[l.value.name.toLowerCase()]:B.value}),B.value=void 0)}async function zr(){const Y=await Rr({accept:Ar.join(",")});q.value=[...q.value,...Y]}function Pt(){Ke.value&&(B.value=void 0)}return{__sfc:!0,propsDefinition:Ho,props:e,_isKirby5:n,panel:r,t:o,currentContent:i,updateContent:s,label:a,field:l,userPrompt:c,systemPrompt:u,storage:f,icon:p,theme:d,size:g,logLevel:m,modelFile:b,help:w,config:_,isInitialized:v,isGenerating:I,isDetailsOpen:O,detailsElement:N,currentPrompt:W,currentFieldContent:B,permissions:Ne,files:q,licenseStatus:U,storageKey:re,abortController:ae,canUndo:Ke,generate:We,abort:Ae,undo:xr,pickFiles:zr,onModelSave:Pt,LicensingButtonGroup:Pr,isObject:At,SUPPORTED_IMAGE_MIME_TYPES:xn,SUPPORTED_PROVIDERS:wn}}});var jp=function(){var o,i,s,a;var e=this,n=e._self._c,r=e._self._setupProxy;return r.isInitialized?n("k-section",{attrs:{label:r.label}},[r.licenseStatus!==void 0?n("template",{slot:"options"},[n(r.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":r.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):e._e(),r.config?!r.config.provider||!r.SUPPORTED_PROVIDERS.includes(r.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Unsupported provider "),n("code",[e._v(e._s(r.config.provider))]),e._v(" in the "),n("code",[e._v("johannschopplich.copilot.provider")]),e._v(" global configuration. ")])],1):(i=(o=r.config.providers)==null?void 0:o[r.config.provider])!=null&&i.model?!r.field||typeof r.field=="string"||r.isObject(r.field)&&!(((s=r.field)==null?void 0:s.name.toLowerCase())in r.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" The "),n("code",[e._v(e._s(((a=r.field)==null?void 0:a.name)??r.field))]),e._v(" field does not exist in the current model. ")])],1):!r.permissions.includes("edit")&&!r.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" If the user prompt cannot be edited by the user, a default "),n("code",[e._v("userPrompt")]),e._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:r.isGenerating?"loader":r.icon,text:r.panel.t("johannschopplich.copilot.generate"),theme:r.theme,variant:"filled",size:r.size,disabled:r.isGenerating},on:{click:function(l){return r.generate()}}}),r.isGenerating?n("k-button",{attrs:{icon:"cancel",text:r.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:r.size},on:{click:function(l){return r.abort()}}}):e._e(),r.canUndo?n("k-button",{attrs:{icon:"undo",text:r.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:r.size},on:{click:function(l){return r.undo()}}}):e._e()],1),r.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(l){r.isDetailsOpen=l.target.open}}},[n("summary",[e._v(" "+e._s([...r.permissions.includes("edit")?[r.panel.t("johannschopplich.copilot.prompt.label")]:[],...r.permissions.includes("files")?[r.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[r.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:r.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:r.currentPrompt,placeholder:r.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(l){r.currentPrompt=l}}})],1):e._e(),r.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:r.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:r._isKirby5&&r.files.length>0?{theme:"notice",text:r.files.length}:void 0,size:"sm"},on:{click:function(l){return r.pickFiles()}}}),r.files.length>0?n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(l){r.files=[]}}}):e._e(),r.permissions.includes("edit")&&r.userPrompt&&r.currentPrompt!==r.userPrompt?n("k-button",{staticClass:"kai-ml-auto",attrs:{icon:"undo",text:r.panel.t("johannschopplich.copilot.context.reset"),variant:"dimmed",size:"xs"},on:{click:function(l){r.currentPrompt=r.userPrompt}}}):e._e()],1):r.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[e._v(" "+e._s(r.panel.t(`johannschopplich.copilot.context.file.${r.SUPPORTED_IMAGE_MIME_TYPES.includes(r.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):e._e()],1)]):e._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Missing "),n("code",[e._v("model")]),e._v(" property in the "),n("code",[e._v(e._s(`johannschopplich.copilot.providers.${r.config.provider}`))]),e._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Missing "),n("code",[e._v("johannschopplich.copilot")]),e._v(" global configuration. ")])],1),r.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:r.help}})],1):e._e()],2):e._e()},Bp=[],Up=qe(Zp,jp,Bp,!1,null,null);const Jp=Up.exports,Vp=Vue.defineComponent({__name:"CopilotButton",props:{label:String,userPrompt:String,systemPrompt:String,logLevel:String,icon:{type:String,default:"sparkling"},theme:{type:String,default:"notice-icon"}},setup(t){const e=t,n=z(),{currentContent:r,update:o}=mn(),{getModelFields:i}=Wo(),s=S(!1),a=S(!1);let l;async function c(){l=new AbortController;const p=U=>{U.key==="Escape"&&u()},d=await i();if(d.length===0){n.notification.error(n.t("johannschopplich.copilot.fields.empty"));return}const g=await Go({fields:d,userPrompt:e.userPrompt});if(!g)return;const{prompt:m,files:b,selectedFieldNames:w}=g,_=d.filter(U=>w==null?void 0:w.includes(U.name));if(!m||_.length===0)return;const{getZodSchema:v}=Gn(),{getZodSchema:I}=Hn(),O={};for(const U of _)O[U.name]=U.type==="layout"?be(await I(U)):U.type==="blocks"?be(await v(U)):Jn(U);n.isLoading=!0,s.value=!0,document.addEventListener("keydown",p);const N={...r.value},{config:W}=await ye(),{Output:B}=await De(),Ne=e.systemPrompt||W.systemPrompt||Sn,{signal:q}=l;try{const{partialOutputStream:U,output:re}=await gt({userPrompt:m,systemPrompt:Ne,output:B.object({schema:it(O)}),files:b,logLevel:Ye.indexOf(e.logLevel&&Ye.includes(e.logLevel)?e.logLevel:W.logLevel&&Ye.includes(W.logLevel)?W.logLevel:Nr),abortSignal:q});re.catch(()=>{});for await(const We of U){if(q.aborted)return;if(!We)continue;const Ae=f({object:We,selectedFields:_,currentContent:N});Object.keys(Ae).length>0&&await o(Ae,!1)}if(q.aborted)return;const ae=await re,Ke=f({object:ae,selectedFields:_,currentContent:N});await o(Ke),n.notification.success({icon:"check",message:n.t("johannschopplich.copilot.notification.success")})}catch(U){if(q.aborted)return;await zn(U)}finally{l=void 0,n.isLoading=!1,s.value=!1,document.removeEventListener("keydown",p)}}function u(){l==null||l.abort(),l=void 0,s.value=!1,n.isLoading=!1}function f({object:p,selectedFields:d,currentContent:g}){const{normalizeBlock:m}=Gn(),{normalizeLayout:b}=Hn(),w={};for(const _ of d){const v=p[_.name];if(v==null)continue;const I=g[_.name],O=_.type==="layout"?b:m;_.type==="layout"||_.type==="blocks"?Array.isArray(v)&&(w[_.name]=[...I,...v.map(O)]):w[_.name]=v}return w}return{__sfc:!0,props:e,panel:n,currentContent:r,updateContent:o,getModelFields:i,isGenerating:s,isHovering:a,abortController:l,initPromptDialog:c,abort:u,processFieldValues:f}}});var Kp=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("k-button",{attrs:{icon:r.isHovering&&r.isGenerating?"cancel":r.isGenerating?"loader":e.icon,text:e.label||r.panel.t("johannschopplich.copilot.label"),theme:r.isHovering&&r.isGenerating?"notice":e.theme,variant:"filled",size:"sm",responsive:""},on:{click:function(o){r.isHovering&&r.isGenerating?r.abort():r.initPromptDialog()}},nativeOn:{mouseenter:function(o){r.isHovering=!0},mouseleave:function(o){r.isHovering=!1}}})},Wp=[],Gp=qe(Vp,Kp,Wp,!1,null,null);const qo=Gp.exports,Hp={"copilot-ai-generate":'<path fill="currentColor" d="m20.467 8.694l.246-.566a4.36 4.36 0 0 1 2.22-2.25l.759-.339a.53.53 0 0 0 0-.963l-.717-.319a4.37 4.37 0 0 1-2.251-2.326l-.253-.611a.506.506 0 0 0-.942 0l-.253.61a4.37 4.37 0 0 1-2.25 2.327l-.718.32a.53.53 0 0 0 0 .962l.76.338a4.36 4.36 0 0 1 2.219 2.251l.246.566c.18.414.753.414.934 0M5.8 16h2.154l.6-1.5h2.892l.6 1.5H14.2L11 8H9zm4.2-5.115l.646 1.615H9.354zM15 16V8h2v8zM3 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-9h-2v8H4V5h10V3z" />',"copilot-text-snippet":'<path fill="currentColor" d="M2 4a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zm2 1v14h16V5zm3 3h10v3h-2v-1h-2v4h1.5v2h-5v-2H11v-4H9v1H7z" />'};async function Yo(t,{appendText:e,replaceText:n,responseFormat:r="text"}){const o=z(),i=qp(),s=new AbortController,a=d=>{d.key==="Escape"&&s.abort()},l=await Go({selection:t,activeField:i});if(!l)return;const{prompt:c,files:u}=l;if(!c)return;i&&(i.element.dataset.copilot="generating"),document.addEventListener("keydown",a),o.isLoading=!0;const{config:f}=await ye(),{signal:p}=s;try{const{textStream:d}=await gt({userPrompt:Lr(c,{responseFormat:r,selection:t}),systemPrompt:f.systemPrompt||Sn,responseFormat:r,files:u,abortSignal:p});let g=!0;for await(let m of d){if(p.aborted)return;t&&l.insertMode==="replace"?n(m):(g&&(m=t&&!m.startsWith(" ")?` ${m}`:m,g=!1),e(m))}if(p.aborted)return;o.notification.success({icon:"check",message:o.t("johannschopplich.copilot.notification.success")})}catch(d){if(p.aborted)return;await zn(d)}finally{i&&delete i.element.dataset.copilot,document.removeEventListener("keydown",a),o.isLoading=!1}}function qp(){var i;const t=(i=document.activeElement)==null?void 0:i.closest(".k-field");if(!t)return;const e=[...t.classList].find(s=>s.startsWith("k-field-name-")),n=[...t.classList].find(s=>s.startsWith("k-field-type-")),r=e==null?void 0:e.replace("k-field-name-",""),o=n==null?void 0:n.replace("k-field-type-","");return r?{element:t,name:r,type:o}:void 0}const Yp={icon:"sparkling",label:"Copilot",shortcut:".",click(){let t="";this.command("insert",(o,i)=>(t=i,i));let e=!0;Yo(t,{responseFormat:"markdown",appendText:o=>{this.command("insert",(i,s)=>e?(e=!1,s+o):o)},replaceText:o=>{this.command("insert",()=>o)}})}};function Xo(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let o=t.child(r),i=e.child(r);if(o==i){n+=o.nodeSize;continue}if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(let s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){let s=Xo(o.content,i.content,n+1);if(s!=null)return s}n+=o.nodeSize}}function Qo(t,e,n,r){for(let o=t.childCount,i=e.childCount;;){if(o==0||i==0)return o==i?null:{a:n,b:r};let s=t.child(--o),a=e.child(--i),l=s.nodeSize;if(s==a){n-=l,r-=l;continue}if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){let c=0,u=Math.min(s.text.length,a.text.length);for(;c<u&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){let c=Qo(s.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class T{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,o=0,i){for(let s=0,a=0;a<n;s++){let l=this.content[s],c=a+l.nodeSize;if(c>e&&r(l,o+a,i||null,s)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,o+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,o){let i="",s=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?o?typeof o=="function"?o(a):o:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(s?s=!1:i+=r),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,o=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(o[o.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)o.push(e.content[i]);return new T(o,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],o=0;if(n>e)for(let i=0,s=0;s<n;i++){let a=this.content[i],l=s+a.nodeSize;l>e&&((s<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-s),Math.min(a.text.length,n-s)):a=a.cut(Math.max(0,e-s-1),Math.min(a.content.size,n-s-1))),r.push(a),o+=a.nodeSize),s=l}return new T(r,o)}cutByIndex(e,n){return e==n?T.empty:e==0&&n==this.content.length?this:new T(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let o=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return o[e]=n,new T(o,i)}addToStart(e){return new T([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new T(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let o=this.content[n];e(o,r,n),r+=o.nodeSize}}findDiffStart(e,n=0){return Xo(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return Qo(this,e,n,r)}findIndex(e){if(e==0)return Xt(0,e);if(e==this.size)return Xt(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let o=this.child(n),i=r+o.nodeSize;if(i>=e)return i==e?Xt(n+1,i):Xt(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return T.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new T(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return T.empty;let n,r=0;for(let o=0;o<e.length;o++){let i=e[o];r+=i.nodeSize,o&&i.isText&&e[o-1].sameMarkup(i)?(n||(n=e.slice(0,o)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new T(n||e,r)}static from(e){if(!e)return T.empty;if(e instanceof T)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new T([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}T.empty=new T([],0);const qn={index:0,offset:0};function Xt(t,e){return qn.index=t,qn.offset=e,qn}function Yn(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Yn(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Yn(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}class ue{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let o=0;o<e.length;o++){let i=e[o];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,o));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,o)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Yn(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let o=r.create(n.attrs);return r.checkAttrs(o.attrs),o}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return ue.none;if(e instanceof ue)return[e];let n=e.slice();return n.sort((r,o)=>r.type.rank-o.type.rank),n}}ue.none=[];class Xp extends Error{}class ${constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=ti(this.content,e+this.openStart,n);return r&&new $(r,this.openStart,this.openEnd)}removeBetween(e,n){return new $(ei(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return $.empty;let r=n.openStart||0,o=n.openEnd||0;if(typeof r!="number"||typeof o!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new $(T.fromJSON(e,n.content),r,o)}static maxOpen(e,n=!0){let r=0,o=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)o++;return new $(e,r,o)}}$.empty=new $(T.empty,0,0);function ei(t,e,n){let{index:r,offset:o}=t.findIndex(e),i=t.maybeChild(r),{index:s,offset:a}=t.findIndex(n);if(o==e||i.isText){if(a!=n&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(ei(i.content,e-o-1,n-o-1)))}function ti(t,e,n,r){let{index:o,offset:i}=t.findIndex(e),s=t.maybeChild(o);if(i==e||s.isText)return r&&!r.canReplace(o,o,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=ti(s.content,e-i-1,n,s);return a&&t.replaceChild(o,s.copy(a))}function Qp(t){return t.tag!=null}function ed(t){return t.style!=null}class _t{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(o=>{if(Qp(o))this.tags.push(o);else if(ed(o)){let i=/[^=]*/.exec(o.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(o)}}),this.normalizeLists=!this.tags.some(o=>{if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;let i=e.nodes[o.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new ii(this,n,!1);return r.addAll(e,ue.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new ii(this,n,!0);return r.addAll(e,ue.none,n.from,n.to),$.maxOpen(r.finish())}matchTag(e,n,r){for(let o=r?this.tags.indexOf(r)+1:0;o<this.tags.length;o++){let i=this.tags[o];if(rd(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let s=i.getAttrs(e);if(s===!1)continue;i.attrs=s||void 0}return i}}}matchStyle(e,n,r,o){for(let i=o?this.styles.indexOf(o)+1:0;i<this.styles.length;i++){let s=this.styles[i],a=s.style;if(!(a.indexOf(e)!=0||s.context&&!r.matchesContext(s.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(s.getAttrs){let l=s.getAttrs(n);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let n=[];function r(o){let i=o.priority==null?50:o.priority,s=0;for(;s<n.length;s++){let a=n[s];if((a.priority==null?50:a.priority)<i)break}n.splice(s,0,o)}for(let o in e.marks){let i=e.marks[o].spec.parseDOM;i&&i.forEach(s=>{r(s=si(s)),s.mark||s.ignore||s.clearMark||(s.mark=o)})}for(let o in e.nodes){let i=e.nodes[o].spec.parseDOM;i&&i.forEach(s=>{r(s=si(s)),s.node||s.ignore||s.mark||(s.node=o)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new _t(e,_t.schemaRules(e)))}}const ni={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},td={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ri={ol:!0,ul:!0},kt=1,Xn=2,wt=4;function oi(t,e,n){return e!=null?(e?kt:0)|(e==="full"?Xn:0):t&&t.whitespace=="pre"?kt|Xn:n&~wt}class Qt{constructor(e,n,r,o,i,s){this.type=e,this.attrs=n,this.marks=r,this.solid=o,this.options=s,this.content=[],this.activeMarks=ue.none,this.match=i||(s&wt?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(T.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,o;return(o=r.findWrapping(e.type))?(this.match=r,o):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&kt)){let r=this.content[this.content.length-1],o;if(r&&r.isText&&(o=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-o[0].length))}}let n=T.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(T.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!ni.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class ii{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let o=n.topNode,i,s=oi(null,n.preserveWhitespace,0)|(r?wt:0);o?i=new Qt(o.type,o.attrs,ue.none,!0,n.topMatch||o.type.contentMatch,s):r?i=new Qt(null,null,ue.none,!0,null,s):i=new Qt(e.schema.topNodeType,null,ue.none,!0,null,s),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,o=this.top,i=o.options&Xn?"full":this.localPreserveWS||(o.options&kt)>0,{schema:s}=this.parser;if(i==="full"||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(s.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(s.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(s.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(s.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let o=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),a;ri.hasOwnProperty(s)&&this.parser.normalizeLists&&nd(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:td.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(ni.hasOwnProperty(s))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=o}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let o=0;o<this.parser.matchedStyles.length;o++){let i=this.parser.matchedStyles[o],s=r.getPropertyValue(i);if(s)for(let a=void 0;;){let l=this.parser.matchStyle(i,s,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,o){let i,s;if(n.node)if(s=this.parser.schema.nodes[n.node],s.isLeaf)this.insertNode(s.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(s,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(s&&s.isLeaf)this.findInside(e);else if(o)this.addElement(e,r,o);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,o){let i=r||0;for(let s=r?e.childNodes[r]:e.firstChild,a=o==null?null:e.childNodes[o];s!=a;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s,n);this.findAtPoint(e,i)}findPlace(e,n,r){let o,i;for(let s=this.open,a=0;s>=0;s--){let l=this.nodes[s],c=l.findWrapping(e);if(c&&(!o||o.length>c.length+a)&&(o=c,i=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!o)return null;this.sync(i);for(let s=0;s<o.length;s++)n=this.enterInner(o[s],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let o=this.findPlace(e,n,r);if(o){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let s=ue.none;for(let a of o.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):ai(a.type,e.type))&&(s=a.addToSet(s));return i.content.push(e.mark(s)),!0}return!1}enter(e,n,r,o){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,o)),i}enterInner(e,n,r,o=!1,i){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let a=oi(e,i,s.options);s.options&wt&&s.content.length==0&&(a|=wt);let l=ue.none;return r=r.filter(c=>(s.type?s.type.allowsMarkType(c.type):ai(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Qt(e,n,l,o,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=kt)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let o=r.length-1;o>=0;o--)e+=r[o].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let o=0;o<this.find.length;o++)this.find[o].pos==null&&e.nodeType==1&&e.contains(this.find[o].node)&&n.compareDocumentPosition(this.find[o].node)&(r?2:4)&&(this.find[o].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(s(a-1,l))return!0;return!1}else{let u=l>0||l==0&&o?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return s(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function nd(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&ri.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function rd(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function si(t){let e={};for(let n in t)e[n]=t[n];return e}function ai(t,e){let n=e.schema.nodes;for(let r in n){let o=n[r];if(!o.allowsMarkType(t))continue;let i=[],s=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&s(u))return!0}};if(s(o.contentMatch))return!0}}class en{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=Qn(n).createDocumentFragment());let o=r,i=[];return e.forEach(s=>{if(i.length||s.marks.length){let a=0,l=0;for(;a<i.length&&l<s.marks.length;){let c=s.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)o=i.pop()[1];for(;l<s.marks.length;){let c=s.marks[l++],u=this.serializeMark(c,s.isInline,n);u&&(i.push([c,o]),o.appendChild(u.dom),o=u.contentDOM||u.dom)}}o.appendChild(this.serializeNodeInner(s,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:o}=tn(Qn(n),this.nodes[e.type.name](e),null,e.attrs);if(o){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,o)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let o=e.marks.length-1;o>=0;o--){let i=this.serializeMark(e.marks[o],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let o=this.marks[e.type.name];return o&&tn(Qn(r),o(e,n),null,e.attrs)}static renderSpec(e,n,r=null,o){return tn(e,n,r,o)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new en(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=li(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return li(e.marks)}}function li(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Qn(t){return t.document||window.document}const ci=new WeakMap;function od(t){let e=ci.get(t);return e===void 0&&ci.set(t,e=id(t)),e}function id(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let o=0;o<r.length;o++)n(r[o]);else for(let o in r)n(r[o])}return n(t),e}function tn(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let o=e[0],i;if(typeof o!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=od(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=o.indexOf(" ");s>0&&(n=o.slice(0,s),o=o.slice(s+1));let a,l=n?t.createElementNS(n,o):t.createElement(o),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let f in c)if(c[f]!=null){let p=f.indexOf(" ");p>0?l.setAttributeNS(f.slice(0,p),f.slice(p+1),c[f]):f=="style"&&l.style?l.style.cssText=c[f]:l.setAttribute(f,c[f])}}for(let f=u;f<e.length;f++){let p=e[f];if(p===0){if(f<e.length-1||f>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:d,contentDOM:g}=tn(t,p,n,r);if(l.appendChild(d),g){if(a)throw new RangeError("Multiple content holes");a=g}}}return{dom:l,contentDOM:a}}const ui=65535,fi=Math.pow(2,16);function sd(t,e){return t+e*fi}function pi(t){return t&ui}function ad(t){return(t-(t&ui))/fi}const di=1,hi=2,nn=4,mi=8;class gi{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&mi)>0}get deletedBefore(){return(this.delInfo&(di|nn))>0}get deletedAfter(){return(this.delInfo&(hi|nn))>0}get deletedAcross(){return(this.delInfo&nn)>0}}class ie{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ie.empty)return ie.empty}recover(e){let n=0,r=pi(e);if(!this.inverted)for(let o=0;o<r;o++)n+=this.ranges[o*3+2]-this.ranges[o*3+1];return this.ranges[r*3]+n+ad(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let o=0,i=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?o:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+s],f=l+c;if(e<=f){let p=c?e==l?-1:e==f?1:n:n,d=l+o+(p<0?0:u);if(r)return d;let g=e==(n<0?l:f)?null:sd(a/3,e-l),m=e==l?hi:e==f?di:nn;return(n<0?e!=l:e!=f)&&(m|=mi),new gi(d,m,g)}o+=u-c}return r?e+o:new gi(e+o,0,null)}touches(e,n){let r=0,o=pi(n),i=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==o*3)return!0;r+=this.ranges[a+s]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let o=0,i=0;o<this.ranges.length;o+=3){let s=this.ranges[o],a=s-(this.inverted?i:0),l=s+(this.inverted?0:i),c=this.ranges[o+n],u=this.ranges[o+r];e(a,a+c,l,l+u),i+=u-c}}invert(){return new ie(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ie.empty:new ie(e<0?[0,-e,0]:[0,0,e])}}ie.empty=new ie([]);const er=Object.create(null);class Q{getMap(){return ie.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=er[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in er)throw new RangeError("Duplicate use of step JSON ID "+e);return er[e]=n,n.prototype.jsonID=e,n}}class V{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new V(e,null)}static fail(e){return new V(null,e)}static fromReplace(e,n,r,o){try{return V.ok(e.replace(n,r,o))}catch(i){if(i instanceof Xp)return V.fail(i.message);throw i}}}function tr(t,e,n){let r=[];for(let o=0;o<t.childCount;o++){let i=t.child(o);i.content.size&&(i=i.copy(tr(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return T.fromArray(r)}class Le extends Q{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new $(tr(n.content,(s,a)=>!s.isAtom||!a.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),o),n.openStart,n.openEnd);return V.fromReplace(e,this.from,this.to,i)}invert(){return new Fe(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Le(n.pos,r.pos,this.mark)}merge(e){return e instanceof Le&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Le(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Le(n.from,n.to,e.markFromJSON(n.mark))}}Q.jsonID("addMark",Le);class Fe extends Q{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new $(tr(n.content,o=>o.mark(this.mark.removeFromSet(o.marks)),e),n.openStart,n.openEnd);return V.fromReplace(e,this.from,this.to,r)}invert(){return new Le(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Fe(n.pos,r.pos,this.mark)}merge(e){return e instanceof Fe&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Fe(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Fe(n.from,n.to,e.markFromJSON(n.mark))}}Q.jsonID("removeMark",Fe);class Ze extends Q{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return V.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return V.fromReplace(e,this.pos,this.pos+1,new $(T.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let o=0;o<n.marks.length;o++)if(!n.marks[o].isInSet(r))return new Ze(this.pos,n.marks[o]);return new Ze(this.pos,this.mark)}}return new St(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ze(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ze(n.pos,e.markFromJSON(n.mark))}}Q.jsonID("addNodeMark",Ze);class St extends Q{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return V.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return V.fromReplace(e,this.pos,this.pos+1,new $(T.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Ze(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new St(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new St(n.pos,e.markFromJSON(n.mark))}}Q.jsonID("removeNodeMark",St);class Se extends Q{constructor(e,n,r,o=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=o}apply(e){return this.structure&&nr(e,this.from,this.to)?V.fail("Structure replace would overwrite content"):V.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ie([this.from,this.to-this.from,this.slice.size])}invert(e){return new Se(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new Se(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Se)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?$.empty:new $(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Se(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?$.empty:new $(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Se(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Se(n.from,n.to,$.fromJSON(e,n.slice),!!n.structure)}}Q.jsonID("replace",Se);class st extends Q{constructor(e,n,r,o,i,s,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=a}apply(e){if(this.structure&&(nr(e,this.from,this.gapFrom)||nr(e,this.gapTo,this.to)))return V.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return V.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?V.fromReplace(e,this.from,this.to,r):V.fail("Content does not fit in gap")}getMap(){return new ie([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new st(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),o=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||o<n.pos||i>r.pos?null:new st(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new st(n.from,n.to,n.gapFrom,n.gapTo,$.fromJSON(e,n.slice),n.insert,!!n.structure)}}Q.jsonID("replaceAround",st);function nr(t,e,n){let r=t.resolve(e),o=n-e,i=r.depth;for(;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0){let s=r.node(i).maybeChild(r.indexAfter(i));for(;o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function ld(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let o=n.content;for(let i=0;i<n.openStart;i++)o=o.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let s=r.depth;s>=0;s--){let a=s==r.depth?0:r.pos<=(r.start(s+1)+r.end(s+1))/2?-1:1,l=r.index(s)+(a>0?1:0),c=r.node(s),u=!1;if(i==1)u=c.canReplace(l,l,o);else{let f=c.contentMatchAt(l).findWrapping(o.firstChild.type);u=f&&c.canReplaceWith(l,l,f[0])}if(u)return a==0?r.pos:a<0?r.before(s+1):r.after(s+1)}return null}class xt extends Q{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return V.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let o=n.type.create(r,null,n.marks);return V.fromReplace(e,this.pos,this.pos+1,new $(T.from(o),0,n.isLeaf?0:1))}getMap(){return ie.empty}invert(e){return new xt(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new xt(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new xt(n.pos,n.attr,n.value)}}Q.jsonID("attr",xt);class rn extends Q{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let o in e.attrs)n[o]=e.attrs[o];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return V.ok(r)}getMap(){return ie.empty}invert(e){return new rn(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new rn(n.attr,n.value)}}Q.jsonID("docAttr",rn);let zt=class extends Error{};zt=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},zt.prototype=Object.create(Error.prototype),zt.prototype.constructor=zt,zt.prototype.name="TransformError";const rr=Object.create(null);class Z{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new cd(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=$.empty){let r=n.content.lastChild,o=null;for(let a=0;a<n.openEnd;a++)o=r,r=r.lastChild;let i=e.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:l,$to:c}=s[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?$.empty:n),a==0&&vi(e,i,(r?r.isInline:o&&o.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,o=this.ranges;for(let i=0;i<o.length;i++){let{$from:s,$to:a}=o[i],l=e.mapping.slice(r),c=l.map(s.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),vi(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let o=e.parent.inlineContent?new j(e):at(e.node(0),e.parent,e.pos,e.index(),n,r);if(o)return o;for(let i=e.depth-1;i>=0;i--){let s=n<0?at(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):at(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(s)return s}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new ve(e.node(0))}static atStart(e){return at(e,e,0,0,1)||new ve(e)}static atEnd(e){return at(e,e,e.content.size,e.childCount,-1)||new ve(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=rr[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in rr)throw new RangeError("Duplicate use of selection JSON ID "+e);return rr[e]=n,n.prototype.jsonID=e,n}getBookmark(){return j.between(this.$anchor,this.$head).getBookmark()}}Z.prototype.visible=!0;class cd{constructor(e,n){this.$from=e,this.$to=n}}let yi=!1;function bi(t){!yi&&!t.parent.inlineContent&&(yi=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class j extends Z{constructor(e,n=e){bi(e),bi(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Z.near(r);let o=e.resolve(n.map(this.anchor));return new j(o.parent.inlineContent?o:r,r)}replace(e,n=$.empty){if(super.replace(e,n),n==$.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof j&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new on(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new j(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let o=e.resolve(n);return new this(o,r==n?o:e.resolve(r))}static between(e,n,r){let o=e.pos-n.pos;if((!r||o)&&(r=o>=0?1:-1),!n.parent.inlineContent){let i=Z.findFrom(n,r,!0)||Z.findFrom(n,-r,!0);if(i)n=i.$head;else return Z.near(n,r)}return e.parent.inlineContent||(o==0?e=n:(e=(Z.findFrom(e,-r,!0)||Z.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=o<0&&(e=n))),new j(e,n)}}Z.jsonID("text",j);class on{constructor(e,n){this.anchor=e,this.head=n}map(e){return new on(e.map(this.anchor),e.map(this.head))}resolve(e){return j.between(e.resolve(this.anchor),e.resolve(this.head))}}class E extends Z{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:o}=n.mapResult(this.anchor),i=e.resolve(o);return r?Z.near(i):new E(i)}content(){return new $(T.from(this.node),0,0)}eq(e){return e instanceof E&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new or(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new E(e.resolve(n.anchor))}static create(e,n){return new E(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}E.prototype.visible=!1,Z.jsonID("node",E);class or{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new on(r,r):new or(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&E.isSelectable(r)?new E(n):Z.near(n)}}class ve extends Z{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=$.empty){if(n==$.empty){e.delete(0,e.doc.content.size);let r=Z.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new ve(e)}map(e){return new ve(e)}eq(e){return e instanceof ve}getBookmark(){return ud}}Z.jsonID("all",ve);const ud={map(){return this},resolve(t){return new ve(t)}};function at(t,e,n,r,o,i=!1){if(e.inlineContent)return j.create(t,n);for(let s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){let a=e.child(s);if(a.isAtom){if(!i&&E.isSelectable(a))return E.create(t,n-(o<0?a.nodeSize:0))}else{let l=at(t,a,n+o,o<0?a.childCount:0,o,i);if(l)return l}n+=a.nodeSize*o}return null}function vi(t,e,n){let r=t.steps.length-1;if(r<e)return;let o=t.steps[r];if(!(o instanceof Se||o instanceof st))return;let i=t.mapping.maps[r],s;i.forEach((a,l,c,u)=>{s==null&&(s=u)}),t.setSelection(Z.near(t.doc.resolve(s),n))}function _i(t,e){return!e||!t?t:t.bind(e)}class sn{constructor(e,n,r){this.name=e,this.init=_i(n.init,r),this.apply=_i(n.apply,r)}}new sn("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new sn("selection",{init(t,e){return t.selection||Z.atStart(e.doc)},apply(t){return t.selection}}),new sn("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new sn("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}});const ir=Object.create(null);function fd(t){return t in ir?t+"$"+ ++ir[t]:(ir[t]=0,t+"$")}class pd{constructor(e="key"){this.key=fd(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const je=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},ki=function(t,e,n,r){return n&&(wi(t,e,n,r,-1)||wi(t,e,n,r,1))},dd=/^(img|br|input|textarea|hr)$/i;function wi(t,e,n,r,o){for(var i;;){if(t==n&&e==r)return!0;if(e==(o<0?0:an(t))){let s=t.parentNode;if(!s||s.nodeType!=1||sr(t)||dd.test(t.nodeName)||t.contentEditable=="false")return!1;e=je(t)+(o<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(o<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((i=s.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=o;else return!1;else t=s,e=o<0?an(t):0}else return!1}}function an(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function hd(t,e,n){for(let r=e==0,o=e==an(t);r||o;){if(t==n)return!0;let i=je(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,o=o&&i==an(t)}}function sr(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Si=function(t){return t.focusNode&&ki(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function xi(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}const _e=typeof navigator<"u"?navigator:null,zi=typeof document<"u"?document:null,Ee=_e&&_e.userAgent||"",ar=/Edge\/(\d+)/.exec(Ee),Oi=/MSIE \d/.exec(Ee),lr=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ee),Ot=!!(Oi||lr||ar),Ti=Oi?document.documentMode:lr?+lr[1]:ar?+ar[1]:0,ln=!Ot&&/gecko\/(\d+)/i.test(Ee);ln&&+(/Firefox\/(\d+)/.exec(Ee)||[0,0])[1];const cr=!Ot&&/Chrome\/(\d+)/.exec(Ee),xe=!!cr,$i=cr?+cr[1]:0,Be=!Ot&&!!_e&&/Apple Computer/.test(_e.vendor),ur=Be&&(/Mobile\/\w+/.test(Ee)||!!_e&&_e.maxTouchPoints>2),fe=ur||(_e?/Mac/.test(_e.platform):!1),Ei=_e?/Win/.test(_e.platform):!1,Tt=/Android \d/.test(Ee),fr=!!zi&&"webkitFontSmoothing"in zi.documentElement.style,md=fr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function gd(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let o=t.docView.nearestDesc(n.focusNode),i=o&&o.size==0,s=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;let a=r.resolve(s),l,c;if(Si(n)){for(l=s;o&&!o.node;)o=o.parent;let f=o.node;if(o&&f.isAtom&&E.isSelectable(f)&&o.parent&&!(f.isInline&&hd(n.focusNode,n.focusOffset,o.dom))){let p=o.posBefore;c=new E(s==p?a:r.resolve(p))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=s,p=s;for(let d=0;d<n.rangeCount;d++){let g=n.getRangeAt(d);f=Math.min(f,t.docView.posFromDOM(g.startContainer,g.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(g.endContainer,g.endOffset,-1))}if(f<0)return null;[l,s]=p==t.state.selection.anchor?[p,f]:[f,p],a=r.resolve(s)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let f=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;c=Di(t,u,a,f)}return c}function Ci(t){return t.editable?t.hasFocus():_d(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function pr(t,e=!1){let n=t.state.selection;if(vd(t,n),!!Ci(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&xe){let r=t.domSelectionRange(),o=t.domObserver.currentSelection;if(r.anchorNode&&o.anchorNode&&ki(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)bd(t);else{let{anchor:r,head:o}=n,i,s;Pi&&!(n instanceof j)&&(n.$from.parent.inlineContent||(i=Ii(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(s=Ii(t,n.to))),t.docView.setSelection(r,o,t,e),Pi&&(i&&Ni(i),s&&Ni(s)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&yd(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Pi=Be||xe&&$i<63;function Ii(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),o=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(Be&&o&&o.contentEditable=="false")return dr(o);if((!o||o.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(o)return dr(o);if(i)return dr(i)}}function dr(t){return t.contentEditable="true",Be&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Ni(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function yd(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=o)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!Ci(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function bd(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,je(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Ot&&Ti<=11&&(n.disabled=!0,n.disabled=!1)}function vd(t,e){if(e instanceof E){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Ai(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Ai(t)}function Ai(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Di(t,e,n,r){return t.someProp("createSelectionBetween",o=>o(t,e,n))||j.between(e,n,r)}function _d(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function hr(t,e){let{$anchor:n,$head:r}=t.selection,o=e>0?n.max(r):n.min(r),i=o.parent.inlineContent?o.depth?t.doc.resolve(e>0?o.after():o.before()):null:o;return i&&Z.findFrom(i,e)}function Ce(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Mi(t,e,n){let r=t.state.selection;if(r instanceof j)if(n.indexOf("s")>-1){let{$head:o}=r,i=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let s=t.state.doc.resolve(o.pos+i.nodeSize*(e<0?-1:1));return Ce(t,new j(r.$anchor,s))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let o=hr(t.state,e);return o&&o instanceof E?Ce(t,o):!1}else if(!(fe&&n.indexOf("m")>-1)){let o=r.$head,i=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter,s;if(!i||i.isText)return!1;let a=e<0?o.pos-i.nodeSize:o.pos;return i.isAtom||(s=t.docView.descAt(a))&&!s.contentDOM?E.isSelectable(i)?Ce(t,new E(e<0?t.state.doc.resolve(o.pos-i.nodeSize):o)):fr?Ce(t,new j(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof E&&r.node.isInline)return Ce(t,new j(e>0?r.$to:r.$from));{let o=hr(t.state,e);return o?Ce(t,o):!1}}}function cn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function $t(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function lt(t,e){return e<0?kd(t):wd(t)}function kd(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o,i,s=!1;for(ln&&n.nodeType==1&&r<cn(n)&&$t(n.childNodes[r],-1)&&(s=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if($t(a,-1))o=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(Ri(n))break;{let a=n.previousSibling;for(;a&&$t(a,-1);)o=n.parentNode,i=je(a),a=a.previousSibling;if(a)n=a,r=cn(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}s?mr(t,n,r):o&&mr(t,o,i)}function wd(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o=cn(n),i,s;for(;;)if(r<o){if(n.nodeType!=1)break;let a=n.childNodes[r];if($t(a,1))i=n,s=++r;else break}else{if(Ri(n))break;{let a=n.nextSibling;for(;a&&$t(a,1);)i=a.parentNode,s=je(a)+1,a=a.nextSibling;if(a)n=a,r=0,o=cn(n);else{if(n=n.parentNode,n==t.dom)break;r=o=0}}}i&&mr(t,i,s)}function Ri(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Sd(t,e){for(;t&&e==t.childNodes.length&&!sr(t);)e=je(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function xd(t,e){for(;t&&!e&&!sr(t);)e=je(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function mr(t,e,n){if(e.nodeType!=3){let i,s;(s=Sd(e,n))?(e=s,n=0):(i=xd(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Si(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:o}=t;setTimeout(()=>{t.state==o&&pr(t)},50)}function Li(t,e){let n=t.state.doc.resolve(e);if(!(xe||Ei)&&n.parent.inlineContent){let o=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),s=(i.top+i.bottom)/2;if(s>o.top&&s<o.bottom&&Math.abs(i.left-o.left)>1)return i.left<o.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),s=(i.top+i.bottom)/2;if(s>o.top&&s<o.bottom&&Math.abs(i.left-o.left)>1)return i.left>o.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function Fi(t,e,n){let r=t.state.selection;if(r instanceof j&&!r.empty||n.indexOf("s")>-1||fe&&n.indexOf("m")>-1)return!1;let{$from:o,$to:i}=r;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=hr(t.state,e);if(s&&s instanceof E)return Ce(t,s)}if(!o.parent.inlineContent){let s=e<0?o:i,a=r instanceof ve?Z.near(s,e):Z.findFrom(s,e);return a?Ce(t,a):!1}return!1}function Zi(t,e){if(!(t.state.selection instanceof j))return!0;let{$head:n,$anchor:r,empty:o}=t.state.selection;if(!n.sameParent(r))return!0;if(!o)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let s=t.state.tr;return e<0?s.delete(n.pos-i.nodeSize,n.pos):s.delete(n.pos,n.pos+i.nodeSize),t.dispatch(s),!0}return!1}function ji(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function zd(t){if(!Be||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;ji(t,r,"true"),setTimeout(()=>ji(t,r,"false"),20)}return!1}function Od(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function Td(t,e){let n=e.keyCode,r=Od(e);if(n==8||fe&&n==72&&r=="c")return Zi(t,-1)||lt(t,-1);if(n==46&&!e.shiftKey||fe&&n==68&&r=="c")return Zi(t,1)||lt(t,1);if(n==13||n==27)return!0;if(n==37||fe&&n==66&&r=="c"){let o=n==37?Li(t,t.state.selection.from)=="ltr"?-1:1:-1;return Mi(t,o,r)||lt(t,o)}else if(n==39||fe&&n==70&&r=="c"){let o=n==39?Li(t,t.state.selection.from)=="ltr"?1:-1:1;return Mi(t,o,r)||lt(t,o)}else{if(n==38||fe&&n==80&&r=="c")return Fi(t,-1,r)||lt(t,-1);if(n==40||fe&&n==78&&r=="c")return zd(t)||Fi(t,1,r)||lt(t,1);if(r==(fe?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Bi(t,e){t.someProp("transformCopied",d=>{e=d(e,t)});let n=[],{content:r,openStart:o,openEnd:i}=e;for(;o>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){o--,i--;let d=r.firstChild;n.push(d.type.name,d.attrs!=d.type.defaultAttrs?d.attrs:null),r=d.content}let s=t.someProp("clipboardSerializer")||en.fromSchema(t.state.schema),a=qi(),l=a.createElement("div");l.appendChild(s.serializeFragment(r,{document:a}));let c=l.firstChild,u,f=0;for(;c&&c.nodeType==1&&(u=Gi[c.nodeName.toLowerCase()]);){for(let d=u.length-1;d>=0;d--){let g=a.createElement(u[d]);for(;l.firstChild;)g.appendChild(l.firstChild);l.appendChild(g),f++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${o} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let p=t.someProp("clipboardTextSerializer",d=>d(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function Ui(t,e,n,r,o){let i=o.parent.type.spec.code,s,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,i||r,t)}),i)return a=new $(T.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{a=p(a,t,!0)}),a;let f=t.someProp("clipboardTextParser",p=>p(e,o,r,t));if(f)a=f;else{let p=o.marks(),{schema:d}=t.state,g=en.fromSchema(d);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let b=s.appendChild(document.createElement("p"));m&&b.appendChild(g.serializeNode(d.text(m,p)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),s=Pd(n),fr&&Id(s);let c=s&&s.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let f=+u[3];f>0;f--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||_t.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||u),context:o,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!$d.test(p.parentNode.nodeName)?{ignore:!0}:null}})),u)a=Nd(Wi(a,+u[1],+u[2]),u[4]);else if(a=$.maxOpen(Ed(a.content,o),!0),a.openStart||a.openEnd){let f=0,p=0;for(let d=a.content.firstChild;f<a.openStart&&!d.type.spec.isolating;f++,d=d.firstChild);for(let d=a.content.lastChild;p<a.openEnd&&!d.type.spec.isolating;p++,d=d.lastChild);a=Wi(a,f,p)}return t.someProp("transformPasted",f=>{a=f(a,t,l)}),a}const $d=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Ed(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let o=e.node(n).contentMatchAt(e.index(n)),i,s=[];if(t.forEach(a=>{if(!s)return;let l=o.findWrapping(a.type),c;if(!l)return s=null;if(c=s.length&&i.length&&Vi(l,i,a,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=Ki(s[s.length-1],i.length));let u=Ji(a,l);s.push(u),o=o.matchType(u.type),i=l}}),s)return T.from(s)}return t}function Ji(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,T.from(t));return t}function Vi(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){let i=Vi(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(T.from(Ji(n,t,o+1))))}}function Ki(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,Ki(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(T.empty,!0);return t.copy(n.append(r))}function gr(t,e,n,r,o,i){let s=e<0?t.firstChild:t.lastChild,a=s.content;return t.childCount>1&&(i=0),o<r-1&&(a=gr(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(T.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function Wi(t,e,n){return e<t.openStart&&(t=new $(gr(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new $(gr(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const Gi={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Hi=null;function qi(){return Hi||(Hi=document.implementation.createHTMLDocument("title"))}let yr=null;function Cd(t){let e=window.trustedTypes;return e?(yr||(yr=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),yr.createHTML(t)):t}function Pd(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=qi().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),o;if((o=r&&Gi[r[1].toLowerCase()])&&(t=o.map(i=>"<"+i+">").join("")+t+o.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=Cd(t),o)for(let i=0;i<o.length;i++)n=n.querySelector(o[i])||n;return n}function Id(t){let e=t.querySelectorAll(xe?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Nd(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:o,openStart:i,openEnd:s}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;o=T.from(l.create(r[a+1],o)),i++,s++}return new $(o,i,s)}const pe={},se={};function Pe(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}se.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!Xi(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Tt&&xe&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),ur&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",o=>o(t,xi(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||Td(t,n)?n.preventDefault():Pe(t,"key")},se.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)},se.keypress=(t,e)=>{let n=e;if(Xi(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||fe&&n.metaKey)return;if(t.someProp("handleKeyPress",o=>o(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof j)||!r.$from.sameParent(r.$to)){let o=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(o).scrollIntoView();!/[\r\n]/.test(o)&&!t.someProp("handleTextInput",s=>s(t,r.$from.pos,r.$to.pos,o,i))&&t.dispatch(i()),n.preventDefault()}};function un(t){return{left:t.clientX,top:t.clientY}}function Ad(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function br(t,e,n,r,o){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let s=i.depth+1;s>0;s--)if(t.someProp(e,a=>s>i.depth?a(t,n,i.nodeAfter,i.before(s),o,!0):a(t,n,i.node(s),i.before(s),o,!1)))return!0;return!1}function ct(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function Dd(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&E.isSelectable(r)?(ct(t,new E(n)),!0):!1}function Md(t,e){if(e==-1)return!1;let n=t.state.selection,r,o;n instanceof E&&(r=n.node);let i=t.state.doc.resolve(e);for(let s=i.depth+1;s>0;s--){let a=s>i.depth?i.nodeAfter:i.node(s);if(E.isSelectable(a)){r&&n.$from.depth>0&&s>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?o=i.before(n.$from.depth):o=i.before(s);break}}return o!=null?(ct(t,E.create(t.state.doc,o)),!0):!1}function Rd(t,e,n,r,o){return br(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(o?Md(t,n):Dd(t,n))}function Ld(t,e,n,r){return br(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",o=>o(t,e,r))}function Fd(t,e,n,r){return br(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",o=>o(t,e,r))||Zd(t,n,r)}function Zd(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(ct(t,j.create(r,0,r.content.size)),!0):!1;let o=r.resolve(e);for(let i=o.depth+1;i>0;i--){let s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)ct(t,j.create(r,a+1,a+1+s.content.size));else if(E.isSelectable(s))ct(t,E.create(r,a));else continue;return!0}}function vr(t){return fn(t)}const Yi=fe?"metaKey":"ctrlKey";pe.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=vr(t),o=Date.now(),i="singleClick";o-t.input.lastClick.time<500&&Ad(n,t.input.lastClick)&&!n[Yi]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:i,button:n.button};let s=t.posAtCoords(un(n));s&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new jd(t,s,n,!!r)):(i=="doubleClick"?Ld:Fd)(t,s.pos,s.inside,n)?n.preventDefault():Pe(t,"pointer"))};class jd{constructor(e,n,r,o){this.view=e,this.pos=n,this.event=r,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Yi],this.allowDefault=r.shiftKey;let i,s;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),s=n.inside;else{let u=e.state.doc.resolve(n.pos);i=u.parent,s=u.depth?u.before():0}const a=o?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof E&&c.from<=s&&c.to>s)&&(this.mightDrag={node:i,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ln&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Pe(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>pr(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(un(e))),this.updateAllowDefault(e),this.allowDefault||!n?Pe(this.view,"pointer"):Rd(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Be&&this.mightDrag&&!this.mightDrag.node.isAtom||xe&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(ct(this.view,Z.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Pe(this.view,"pointer")}move(e){this.updateAllowDefault(e),Pe(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}pe.touchstart=t=>{t.input.lastTouch=Date.now(),vr(t),Pe(t,"pointer")},pe.touchmove=t=>{t.input.lastTouch=Date.now(),Pe(t,"pointer")},pe.contextmenu=t=>vr(t);function Xi(t,e){return t.composing?!0:Be&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const Bd=Tt?5e3:-1;se.compositionstart=se.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof j&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||xe&&Ei&&Ud(t)))t.markCursor=t.state.storedMarks||n.marks(),fn(t,!0),t.markCursor=null;else if(fn(t,!e.selection.empty),ln&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let o=r.focusNode,i=r.focusOffset;o&&o.nodeType==1&&i!=0;){let s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(s.nodeType==3){let a=t.domSelection();a&&a.collapse(s,s.nodeValue.length);break}else o=s,i=-1}}t.input.composing=!0}Qi(t,Bd)};function Ud(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}se.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,Qi(t,20))};function Qi(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>fn(t),e))}function Jd(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=Vd());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function Vd(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function fn(t,e=!1){if(!(Tt&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Jd(t),e||t.docView&&t.docView.dirty){let n=gd(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function Kd(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Et=Ot&&Ti<15||ur&&md<604;pe.copy=se.cut=(t,e)=>{let n=e,r=t.state.selection,o=n.type=="cut";if(r.empty)return;let i=Et?null:n.clipboardData,s=r.content(),{dom:a,text:l}=Bi(t,s);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):Kd(t,a),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Wd(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function Gd(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let o=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?_r(t,r.value,null,o,e):_r(t,r.textContent,r.innerHTML,o,e)},50)}function _r(t,e,n,r,o){let i=Ui(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,o,i||$.empty)))return!0;if(!i)return!1;let s=Wd(i),a=s?t.state.tr.replaceSelectionWith(s,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function es(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}se.paste=(t,e)=>{let n=e;if(t.composing&&!Tt)return;let r=Et?null:n.clipboardData,o=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&_r(t,es(r),r.getData("text/html"),o,n)?n.preventDefault():Gd(t,n)};class Hd{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const qd=fe?"altKey":"ctrlKey";function ts(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[qd]}pe.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let o=t.state.selection,i=o.empty?null:t.posAtCoords(un(n)),s;if(!(i&&i.pos>=o.from&&i.pos<=(o instanceof E?o.to-1:o.to))){if(r&&r.mightDrag)s=E.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(s=E.create(t.state.doc,f.posBefore))}}let a=(s||t.state.selection).content(),{dom:l,text:c,slice:u}=Bi(t,a);(!n.dataTransfer.files.length||!xe||$i>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Et?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Et||n.dataTransfer.setData("text/plain",c),t.dragging=new Hd(u,ts(t,n),s)},pe.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)},se.dragover=se.dragenter=(t,e)=>e.preventDefault(),se.drop=(t,e)=>{try{Yd(t,e,t.dragging)}finally{t.dragging=null}};function Yd(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(un(e));if(!r)return;let o=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",d=>{i=d(i,t,!1)}):i=Ui(t,es(e.dataTransfer),Et?null:e.dataTransfer.getData("text/html"),!1,o);let s=!!(n&&ts(t,e));if(t.someProp("handleDrop",d=>d(t,e,i||$.empty,s))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?ld(t.state.doc,o.pos,i):o.pos;a==null&&(a=o.pos);let l=t.state.tr;if(s){let{node:d}=n;d?d.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(u?l.replaceRangeWith(c,c,i.content.firstChild):l.replaceRange(c,c,i),l.doc.eq(f))return;let p=l.doc.resolve(c);if(u&&E.isSelectable(i.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new E(p));else{let d=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((g,m,b,w)=>d=w),l.setSelection(Di(t,p,l.doc.resolve(d)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}pe.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&pr(t)},20))},pe.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},pe.beforeinput=(t,e)=>{if(xe&&Tt&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,xi(8,"Backspace")))))return;let{$cursor:o}=t.state.selection;o&&o.pos>0&&t.dispatch(t.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let t in se)pe[t]=se[t];function Ct(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class pn{constructor(e,n){this.toDOM=e,this.spec=n||Ue,this.side=this.spec.side||0}map(e,n,r,o){let{pos:i,deleted:s}=e.mapResult(n.from+o,this.side<0?-1:1);return s?null:new de(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof pn&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ct(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Ie{constructor(e,n){this.attrs=e,this.spec=n||Ue}map(e,n,r,o){let i=e.map(n.from+o,this.spec.inclusiveStart?-1:1)-r,s=e.map(n.to+o,this.spec.inclusiveEnd?1:-1)-r;return i>=s?null:new de(i,s,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Ie&&Ct(this.attrs,e.attrs)&&Ct(this.spec,e.spec)}static is(e){return e.type instanceof Ie}destroy(){}}class kr{constructor(e,n){this.attrs=e,this.spec=n||Ue}map(e,n,r,o){let i=e.mapResult(n.from+o,1);if(i.deleted)return null;let s=e.mapResult(n.to+o,-1);return s.deleted||s.pos<=i.pos?null:new de(i.pos-r,s.pos-r,this)}valid(e,n){let{index:r,offset:o}=e.content.findIndex(n.from),i;return o==n.from&&!(i=e.child(r)).isText&&o+i.nodeSize==n.to}eq(e){return this==e||e instanceof kr&&Ct(this.attrs,e.attrs)&&Ct(this.spec,e.spec)}destroy(){}}class de{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new de(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new de(e,e,new pn(n,r))}static inline(e,n,r,o){return new de(e,n,new Ie(r,o))}static node(e,n,r,o){return new de(e,n,new kr(r,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ie}get widget(){return this.type instanceof pn}}const ut=[],Ue={};class K{constructor(e,n){this.local=e.length?e:ut,this.children=n.length?n:ut}static create(e,n){return n.length?dn(n,e,0,Ue):te}find(e,n,r){let o=[];return this.findInner(e??0,n??1e9,o,0,r),o}findInner(e,n,r,o,i){for(let s=0;s<this.local.length;s++){let a=this.local[s];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+o,a.to+o))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<n&&this.children[s+1]>e){let a=this.children[s]+1;this.children[s+2].findInner(e-a,n-a,r,o+a,i)}}map(e,n,r){return this==te||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Ue)}mapInner(e,n,r,o,i){let s;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,o);l&&l.type.valid(n,l)?(s||(s=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?Xd(this.children,s||[],e,n,r,o,i):s?new K(s.sort(Ve),ut):te}add(e,n){return n.length?this==te?K.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let o,i=0;e.forEach((a,l)=>{let c=l+r,u;if(u=rs(n,a,c)){for(o||(o=this.children.slice());i<o.length&&o[i]<l;)i+=3;o[i]==l?o[i+2]=o[i+2].addInner(a,u,c+1):o.splice(i,0,l,l+a.nodeSize,dn(u,a,c+1,Ue)),i+=3}});let s=ns(i?os(n):n,-r);for(let a=0;a<s.length;a++)s[a].type.valid(e,s[a])||s.splice(a--,1);return new K(s.length?this.local.concat(s).sort(Ve):this.local,o||this.children)}remove(e){return e.length==0||this==te?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,o=this.local;for(let i=0;i<r.length;i+=3){let s,a=r[i]+n,l=r[i+1]+n;for(let u=0,f;u<e.length;u++)(f=e[u])&&f.from>a&&f.to<l&&(e[u]=null,(s||(s=[])).push(f));if(!s)continue;r==this.children&&(r=this.children.slice());let c=r[i+2].removeInner(s,a+1);c!=te?r[i+2]=c:(r.splice(i,3),i-=3)}if(o.length){for(let i=0,s;i<e.length;i++)if(s=e[i])for(let a=0;a<o.length;a++)o[a].eq(s,n)&&(o==this.local&&(o=this.local.slice()),o.splice(a--,1))}return r==this.children&&o==this.local?this:o.length||r.length?new K(o,r):te}forChild(e,n){if(this==te)return this;if(n.isLeaf)return K.empty;let r,o;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,s=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<s&&l.to>i&&l.type instanceof Ie){let c=Math.max(i,l.from)-i,u=Math.min(s,l.to)-i;c<u&&(o||(o=[])).push(l.copy(c,u))}}if(o){let a=new K(o.sort(Ve),ut);return r?new Je([a,r]):a}return r||te}eq(e){if(this==e)return!0;if(!(e instanceof K)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return wr(this.localsInner(e))}localsInner(e){if(this==te)return ut;if(e.inlineContent||!this.local.some(Ie.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Ie||n.push(this.local[r]);return n}forEachSet(e){e(this)}}K.empty=new K([],[]),K.removeOverlap=wr;const te=K.empty;class Je{constructor(e){this.members=e}map(e,n){const r=this.members.map(o=>o.map(e,n,Ue));return Je.from(r)}forChild(e,n){if(n.isLeaf)return K.empty;let r=[];for(let o=0;o<this.members.length;o++){let i=this.members[o].forChild(e,n);i!=te&&(i instanceof Je?r=r.concat(i.members):r.push(i))}return Je.from(r)}eq(e){if(!(e instanceof Je)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let o=0;o<this.members.length;o++){let i=this.members[o].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let s=0;s<i.length;s++)n.push(i[s])}}return n?wr(r?n:n.sort(Ve)):ut}static from(e){switch(e.length){case 0:return te;case 1:return e[0];default:return new Je(e.every(n=>n instanceof K)?e:e.reduce((n,r)=>n.concat(r instanceof K?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function Xd(t,e,n,r,o,i,s){let a=t.slice();for(let c=0,u=i;c<n.maps.length;c++){let f=0;n.maps[c].forEach((p,d,g,m)=>{let b=m-g-(d-p);for(let w=0;w<a.length;w+=3){let _=a[w+1];if(_<0||p>_+u-f)continue;let v=a[w]+u-f;d>=v?a[w+1]=p<=v?-2:-1:p>=u&&b&&(a[w]+=b,a[w+1]+=b)}f+=b}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+i),f=u-o;if(f<0||f>=r.content.size){l=!0;continue}let p=n.map(t[c+1]+i,-1),d=p-o,{index:g,offset:m}=r.content.findIndex(f),b=r.maybeChild(g);if(b&&m==f&&m+b.nodeSize==d){let w=a[c+2].mapInner(n,b,u+1,t[c]+i+1,s);w!=te?(a[c]=f,a[c+1]=d,a[c+2]=w):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=Qd(a,t,e,n,o,i,s),u=dn(c,r,0,s);e=u.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,p=0;f<u.children.length;f+=3){let d=u.children[f];for(;p<a.length&&a[p]<d;)p+=3;a.splice(p,0,u.children[f],u.children[f+1],u.children[f+2])}}return new K(e.sort(Ve),a)}function ns(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let o=t[r];n.push(new de(o.from+e,o.to+e,o.type))}return n}function Qd(t,e,n,r,o,i,s){function a(l,c){for(let u=0;u<l.local.length;u++){let f=l.local[u].map(r,o,c);f?n.push(f):s.onRemove&&s.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function rs(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,o=null;for(let i=0,s;i<t.length;i++)(s=t[i])&&s.from>n&&s.to<r&&((o||(o=[])).push(s),t[i]=null);return o}function os(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function dn(t,e,n,r){let o=[],i=!1;e.forEach((a,l)=>{let c=rs(t,a,l+n);if(c){i=!0;let u=dn(c,a,n+l+1,r);u!=te&&o.push(l,l+a.nodeSize,u)}});let s=ns(i?os(t):t,-n).sort(Ve);for(let a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new K(s,o):te}function Ve(t,e){return t.from-e.from||t.to-e.to}function wr(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let o=n+1;o<e.length;o++){let i=e[o];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),is(e,o+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),is(e,o,r.copy(i.from,r.to)));break}}}return e}function is(t,e,n){for(;e<t.length&&Ve(n,t[e])>0;)e++;t.splice(e,0,n)}const eh=3,Sr=`${Ir}completionCount`;let hn;const G=new pd("copilot-suggestions"),th={get name(){return"copilot-suggestions"},keys(t){return{Tab:()=>this._acceptSuggestion(),Escape:()=>this._dismissSuggestion(),"Mod-,":()=>this._triggerCompletion()}},plugins(t){return[nh(t,this)]},_acceptSuggestion(){const{view:t}=this.editor,e=G.getState(t.state);if(!(e!=null&&e.suggestion))return!1;const{tr:n}=t.state;return n.insertText(e.suggestion,e.position),n.setMeta(G,{suggestion:null,position:null,isLoading:!1}),t.dispatch(n),this._showLicenseToastOnce(),!0},_dismissSuggestion(){const{view:t}=this.editor,e=G.getState(t.state),n=t.state.tr.setMeta(G,{suggestion:null,position:null,isLoading:!1,skipNextTrigger:!0});return t.dispatch(n),!!(e!=null&&e.suggestion||e!=null&&e.isLoading)},_triggerCompletion(){const{view:t}=this.editor;if(!G.getState(t.state))return!1;const n=t.state.tr.setMeta(G,{manualTrigger:!0});return t.dispatch(n),!0},async _showLicenseToastOnce(){if(ds())return;const t=sessionStorage.getItem(Sr);if(t==="done")return;let e=Number(t)||0;if(e++,sessionStorage.setItem(Sr,String(e)),e<eh)return;const n=await ye();["inactive","invalid"].includes(n.licenseStatus)&&window.panel.notification.info({icon:"key",message:window.panel.t("johannschopplich.copilot.license.toast")}),sessionStorage.setItem(Sr,"done")}};function nh(t,e){let n,r;const o=()=>{r&&(r.abort(),r=void 0)};return{key:G,state:{init(){return{suggestion:null,position:null,isLoading:!1,skipNextTrigger:!1,manualTrigger:!1}},apply(s,a){const l=s.getMeta(G);return l!==void 0?(l.isLoading===!1&&o(),{...a,...l}):s.docChanged?(o(),{...a,suggestion:null,position:null,isLoading:!1}):a}},view(){return hn===void 0&&ye().then(({config:s})=>{hn=s.completion}),{update(s,a){const l=G.getState(s.state);if(l!=null&&l.manualTrigger){clearTimeout(n);const c=s.state.tr.setMeta(G,{manualTrigger:!1});s.dispatch(c),i(s,{includeSuffix:!0});return}if(l!=null&&l.skipNextTrigger){clearTimeout(n);const c=s.state.tr.setMeta(G,{skipNextTrigger:!1});s.dispatch(c);return}clearTimeout(n),!s.state.doc.eq(a.doc)&&s.hasFocus()&&hn&&(n=setTimeout(()=>{const{$head:c}=s.state.selection,u=c.parentOffset===c.parent.content.size,f=c.parent.textContent.length===0;!u||f||i(s)},hn.debounce))},destroy(){clearTimeout(n),o()}}},props:{decorations(s){const a=G.getState(s);if(a!=null&&a.isLoading&&!(a!=null&&a.suggestion)&&a.position!==null){const l=de.widget(a.position,()=>{const c=document.createElement("span");return c.className="k-copilot-suggestion-indicator",c},{side:1});return K.create(s.doc,[l])}if(a!=null&&a.suggestion&&a.position!==null){const l=de.widget(a.position,()=>{const c=document.createElement("span");return c.className="k-copilot-suggestion-text",c.textContent=a.suggestion,c},{side:1});return K.create(s.doc,[l])}return K.empty},handleDOMEvents:{blur:()=>e._dismissSuggestion()}}};async function i(s,{includeSuffix:a=!1}={}){r==null||r.abort(),r=new AbortController;const{state:l}=s,c=l.selection.head,{prefix:u,suffix:f}=rh(l,{suffixLength:a?Ks:0});if(!u.trim())return;const p=l.tr.setMeta(G,{suggestion:null,position:c,isLoading:!0});s.dispatch(p);const{signal:d}=r;try{const{model:g}=await Tn({forCompletion:!0}),{streamText:m}=await De(),b=f?`<prefix>${u}</prefix>
<suffix>${f}</suffix>`:u,{textStream:w}=m({model:g,system:Ws,prompt:b,abortSignal:d}),_=u.length>0&&!/\s$/.test(u);let v="";for await(const N of w){if(d.aborted)return;v+=N;const W=_&&!v.startsWith(" ")?` ${v}`:v,B=s.state.tr.setMeta(G,{suggestion:W,position:c,isLoading:!0});s.dispatch(B)}if(d.aborted)return;const I=_&&!v.startsWith(" ")?` ${v}`:v,O=s.state.tr.setMeta(G,{suggestion:I,position:c,isLoading:!1});s.dispatch(O)}catch(g){if(d.aborted)return;console.error("Failed to generate completion:",g);const m=s.state.tr.setMeta(G,{suggestion:null,position:null,isLoading:!1});s.dispatch(m)}finally{r=void 0}}}function rh(t,{prefixLength:e=Vs,suffixLength:n=0}={}){const{$head:r}=t.selection,o=r.pos,i=t.doc.textBetween(0,o,`

`).slice(-e),s=r.parent.textContent,a=r.parentOffset,l=n>0?s.slice(a,a+n):void 0;return{prefix:i,suffix:l}}const oh={get name(){return"copilot"},get button(){return{icon:"sparkling",label:window.panel.t("johannschopplich.copilot.label")}},commands(t){return()=>this._openPromptDialog(t)},keys(t){return{"Mod-.":()=>(this._openPromptDialog(t),!0)}},_insertText(t,e,n,r){const o=n;if(/^\n+$/.test(e)){if(e.length>=2){const i=this.editor.options.inline?[r.schema.nodes.hardBreak.create(),r.schema.nodes.hardBreak.create()]:r.schema.nodes.paragraph.create();return t=t.replaceWith(o,o,i),{tr:t,newPosition:o+2}}return t=t.replaceWith(o,o,r.schema.nodes.hardBreak.create()),{tr:t,newPosition:o+1}}if(e.includes("<"))try{const i=`<div>${e}</div>`,s=new window.DOMParser().parseFromString(i,"text/html").body.firstElementChild,l=_t.fromSchema(r.schema).parseSlice(s),c=t.doc.content.size;t=t.replaceRange(o,o,l);const u=t.doc.content.size;return{tr:t,newPosition:o+(u-c)}}catch(i){console.error("Failed to parse HTML:",i)}return t=t.setStoredMarks([]).insertText(e,o),{tr:t,newPosition:o+e.length}},_openPromptDialog(t){const{state:e}=this.editor,{from:n,to:r}=e.selection;let o="";if(n!==r){const u=e.doc.slice(n,r).content;o=sh(this.editor.getHTML(u))}let i,s=!1,a=!0;Yo(o,{responseFormat:"rich-text",replaceText:u=>{const{state:f,view:p}=this.editor;let d=f.tr;if(!s){const b=ih(f),{from:w,to:_}=f.selection;d=d.deleteRange(w,_),i=b?1:w,s=!0}const{tr:g,newPosition:m}=this._insertText(d,u,i,t);i=m,g.setMeta(G,{skipNextTrigger:!0}),p.dispatch(g)},appendText:u=>{const{state:f,view:p}=this.editor;a&&(i=f.selection.to,a=!1);const{tr:d,newPosition:g}=this._insertText(f.tr,u,i,t);i=g,d.setMeta(G,{skipNextTrigger:!0}),p.dispatch(d)}})}};function ih(t){const{from:e,to:n}=t.selection;return e<=1&&n>=t.doc.content.size-1}function sh(t){return t.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>\s*<p>/gi,`

`).replace(/^<p>|<\/p>$/gi,"")}const ah=t=>{if(He())return;let e;t.mixin({mounted(){if(this.$options.name!=="k-header")return;const n=this.$children.find(o=>o.$options.name==="k-button-group");if(!n)return;const r=t.extend(qo);e=new r({parent:this}),e.$mount(),n.$el.before(e.$el)},beforeDestroy(){this.$options.name==="k-header"&&e&&(e.$destroy(),e=void 0)}})};window.panel.plugin("johannschopplich/copilot",{viewButtons:{copilot:qo},components:{"k-copilot-prompt-dialog":Lp},sections:{copilot:Jp},fields:{},textareaButtons:{copilot:Yp},writerMarks:{copilot:oh,"copilot-suggestions":th},thirdParty:{copilot:{resolvePluginContext:ye,streamText:gt,resolveLanguageModel:Tn,loadAISDK:De}},icons:Hp,use:{legacyViewButtonSupport:ah}})})();

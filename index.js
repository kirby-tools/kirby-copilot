var Gc=Object.defineProperty;var Gn=f=>{throw TypeError(f)};var Vc=(f,k,M)=>k in f?Gc(f,k,{enumerable:!0,configurable:!0,writable:!0,value:M}):f[k]=M;var V=(f,k,M)=>Vc(f,typeof k!="symbol"?k+"":k,M),Wc=(f,k,M)=>k.has(f)||Gn("Cannot "+M);var Ee=(f,k,M)=>(Wc(f,k,"read from private field"),M?M.call(f):k.get(f)),Vn=(f,k,M)=>k.has(f)?Gn("Cannot add the same private member more than once"):k instanceof WeakSet?k.add(f):k.set(f,M);(function(){"use strict";const f=window.Vue;function k(){return window.panel}function M(){return k().api}const ye=()=>window.panel.plugins.viewButtons!==void 0;function Hn(){return ye()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):k().app.$store}function We(){const e=k(),t=Hn(),n=ye();if(n&&!("diff"in e.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const o=J(n?()=>e.content.version("changes"):()=>t.getters["content/values"]()),r=J(n?()=>e.content.diff():()=>t.getters["content/changes"]()),i=J(n?()=>e.content.hasDiff():()=>t.getters["content/hasChanges"]()),s=n?e.content:new Proxy({},{get(){return()=>{}}});return{content:s,currentContent:o,contentChanges:r,hasChanges:i,update:async(a,u=!0)=>{if(!n&&a)for(const[h,p]of Object.entries(a))t.dispatch("content/update",[h,p]);const d=s.merge(a);u&&await s.save(d)}}}function qn(){const e=k();function t(n){return!n||typeof n=="string"?n:n[e.translation.code]??Object.values(n)[0]}return{t}}function Yn(){const e=M();return{load:({parent:n,name:o})=>e.get(`${n}/sections/${o}`)}}const Jn={error:0,warn:1,log:2,info:3,success:3};function Xn(e){const t=new Qn;return new Proxy({},{get(n,o){return(...r)=>{t.log({level:Jn[o],type:o,tag:e,args:r})}}})}var Qn=class{constructor(){V(this,"defaultColor","#7f8c8d");V(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});V(this,"typeColorMap",{success:"#2ecc71"})}log(e){const t=eo(e.level),n=e.type==="log"?"":e.type,o=e.tag||"",r=`
background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),i=`%c${[o,n].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?t(`${i}%c ${e.args[0]}`,r,"",...e.args.slice(1)):t(i,r,...e.args)}};function eo(e){return e<1?console.error:console.log}const Ie=[],He=new Map;async function to(e){if(!Array.isArray(e))throw new TypeError(`Expected an array, got ${typeof e}`);for(const t of e)Ie.some(n=>n.filename===t.filename)||Ie.push(t)}function $t(e){if(Ie.length===0)throw new Error("Plugin assets not registered");const t=Ie.find(n=>n.filename===e);if(!t)throw new Error(`Plugin asset "${e}" not found`);return t}async function oe(e){if(e.endsWith(".js")||(e+=".js"),He.has(e))return He.get(e);const t=await import($t(e).url);return He.set(e,t),t}const J=f.computed;f.customRef,f.defineAsyncComponent,f.defineComponent,f.effectScope,f.getCurrentInstance;const no=f.getCurrentScope;f.h,f.inject,f.isProxy,f.isReactive,f.isReadonly,f.isRef,f.isShallow,f.markRaw;const oo=f.nextTick;f.onActivated,f.onBeforeMount;const ro=f.onBeforeUnmount;f.onBeforeUpdate,f.onDeactivated,f.onErrorCaptured;const zt=f.onMounted;f.onRenderTracked,f.onRenderTriggered;const io=f.onScopeDispose;f.onServerPrefetch,f.onUnmounted,f.onUpdated,f.provide,f.proxyRefs,f.reactive,f.readonly;const b=f.ref;f.shallowReactive,f.shallowReadonly,f.shallowRef,f.toRaw,f.toRef,f.toRefs,f.triggerRef;const qe=f.unref;f.useAttrs,f.useCssModule,f.useCssVars,f.useListeners,f.useSlots;const Ye=f.watch;f.watchEffect,f.watchPostEffect,f.watchSyncEffect;const Je={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible":"License key invalid for this plugin version","modal.error.upgradeable":"License key invalid for this plugin version. Upgrade now on https://hub.kirby.tools.","modal.error.activated":"License key already activated",activate:"Activate",activated:"Plugin activated",buy:"Buy a license",upgrade:"Upgrade"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.upgradeable":"Lizenzschlüssel ungültig für diese Plugin-Version. Aktualisiere jetzt auf https://hub.kirby.tools.","modal.error.activated":"Lizenzschlüssel bereits aktiviert",activate:"Aktivieren",activated:"Plugin aktiviert",buy:"Lizenz kaufen",upgrade:"Upgrade"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible":"Clé de licence invalide pour cette version du plugin","modal.error.upgradeable":"Clé de licence invalide pour cette version du plugin. Mettez à niveau maintenant sur https://hub.kirby.tools.","modal.error.activated":"Clé de licence déjà activée",activate:"Activer",activated:"Plugin activé",buy:"Acheter une licence",upgrade:"Upgrade"},nl:{"modal.info":"Bedankt voor het kopen van {label}! Voer je e-mailadres en bestelnummer in om je licentie te activeren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Vind je bestelnummer</a> op Lemon Squeezy of <a href="mailto:hello@kirby.tools">neem contact met ons op</a> als je het niet kunt vinden.',"modal.error.required.fields":"E-mailadres en bestelnummer zijn verplicht","modal.error.invalid.unauthorized":"E-mailadres of bestelnummer is onjuist","modal.error.invalid.licenseKey":"Licentiesleutel ongeldig voor dit plug-in","modal.error.incompatible":"Licentiesleutel ongeldig voor deze plug-inversie","modal.error.upgradeable":"Licentiesleutel ongeldig voor deze plug-inversie. Upgrade nu op https://hub.kirby.tools.","modal.error.activated":"Licentiesleutel al geactiveerd",activate:"Activeren",activated:"Plugin geactiveerd",buy:"Koop een licentie",upgrade:"Upgrade"}},so=["localhost","127.0.0.1","[::1]"],ao=["local","test","ddev.site"];function re(e="",t){var r;const n=window.panel.translation.code,o=((r=Je==null?void 0:Je[n])==null?void 0:r[e])??e;return t?co(o,t):o}function co(e,t,n){return e.replace(/\{(\w+)\}/g,(o,r)=>t[r]||r)}function uo(){const{hostname:e}=window.location,t=so.includes(e),n=ao.some(o=>e.endsWith(`.${o}`));return t||n}const St={Unauthorized:"modal.error.invalid.unauthorized","License key not valid for this plugin":"modal.error.invalid.licenseKey","License key not valid for this plugin version":"modal.error.incompatible","License key not valid for this plugin version, please upgrade your license":"modal.error.upgradeable","License key already activated":"modal.error.activated"};function lo(e){const t=k();return{isLocalhost:uo(),assertActivationIntegrity:async({component:i,licenseStatus:s})=>{if(qe(s)==="active")return;const c=qe(i);if(!(c!=null&&c.$el)||window.getComputedStyle(c.$el).display==="none"||window.getComputedStyle(c.$el).visibility==="hidden"||window.getComputedStyle(c.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let i=!1;const{label:s}=e,c={info:{type:"info",text:re("modal.info",{label:s})},email:{label:t.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:re("modal.fields.orderId.help",{label:s})}};return new Promise(a=>{t.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:re("activate",{label:s})},fields:c},on:{close:()=>{a({isLicenseActive:i})},submit:async u=>{i=await po(u,e),i&&(t.dialog.close(),t.notification.success(re("activated")))}}})})}}}async function po(e,t){const n=k(),{email:o,orderId:r}=e;if(!o||!r)return n.notification.error(re("modal.error.required.fields")),!1;try{const i=await n.api.post(`${t.apiNamespace}/activate`,{email:o,orderId:Number(r)});if((i==null?void 0:i.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(i){const s=i.message;return n.notification.error(St[s]?re(St[s]):s),!1}}const fo=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(e){const t=e,{openLicenseModal:n,assertActivationIntegrity:o}=lo({label:t.label,apiNamespace:t.apiNamespace}),r=b(t.licenseStatus),i=b();zt(()=>{o({component:i,licenseStatus:t.licenseStatus})});async function s(){const{isLicenseActive:c}=await n();c&&window.location.reload()}return{__sfc:!0,props:t,openLicenseModal:n,assertActivationIntegrity:o,currentLicenseStatus:r,licenseButtonGroup:i,handleRegistration:s,t:re}}});function be(e,t,n,o,r,i,s,c){var a=typeof e=="function"?e.options:e;return t&&(a.render=t,a.staticRenderFns=n,a._compiled=!0),i&&(a._scopeId="data-v-"+i),{exports:e,options:a}}var ho=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return o.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:o.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":t.pricingUrl,target:"_blank",text:o.currentLicenseStatus==="upgradeable"?o.t("upgrade"):o.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:o.t("activate")},on:{click:function(r){return o.handleRegistration()}}})],1):t._e()},mo=[],go=be(fo,ho,mo,!1,null,null);const xt=go.exports,vo="__copilot__/context",_o="__copilot__/model-fields",yo="__copilot__/fieldsets",Et=["anthropic","google","mistral","openai"],Xe=["image/gif","image/jpeg","image/png","image/webp"],ue=["error","warn","info","debug"],It="warn",bo="kirby$copilot$",wo={list:"HTML",markdown:"markdown",textarea:"markdown",writer:"HTML"},Qe=`
You are an AI assistant integrated into the Kirby CMS Panel. Your primary task is to help users generate content for various field types within the CMS. You must provide relevant and helpful content based on the user's question and the specified field type, while considering any provided context.

Consider the user context if provided:
- If selected_text is provided, use it as context for the user's question.
- If pdf_documents are provided, incorporate the information from these documents into your response as applicable.

Format your response according to the specified response_format if provided:
1. If response_format is "text", provide your response in plain text without any Markdown or HTML syntax.
2. If response_format is "HTML", format your response using HTML syntax. Only include the content that would go inside the <body> element. Use appropriate HTML tags to structure your response, including <h2> or <h3> tags for section headings.
3. If response_format is "markdown", format your response using Markdown syntax. Do not use backticks or any other wrapping characters around your response.
`;class we extends Error{}let ke;async function ko(e){const t=await zo(),n=await e.arrayBuffer(),o=await t.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:o.numPages},(i,s)=>$o(o,s+1)))).map(i=>i.replace(/\s+/g," ")).join(`
`)}async function $o(e,t){return(await(await e.getPage(t)).getTextContent()).items.filter(r=>r.str!=null).map(r=>r.str).join(" ")}async function zo(){if(ke)return ke;ke=await oe("pdfjs");const e=$t("pdfjs.worker.js");return ke.GlobalWorkerOptions.workerSrc=e.url,ke}function So(e,t,n){return e.replace(/\{(\w+)\}/g,(o,r)=>t[r.toLowerCase()]||r)}async function xo({accept:e="*",multiple:t=!0}={}){const n=document.createElement("input");return n.type="file",n.classList.add("sr-only"),n.value=null,n.accept=e,n.multiple=t,n.click(),new Promise(o=>{n.addEventListener("change",r=>{var i;o([...((i=r.target)==null?void 0:i.files)??[]]),n.remove()},{once:!0})})}async function Eo(e,t){const n=await Io(e);return await Zo(n,e.type,t)}async function Io(e,t={}){if(!e.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${e.type}`);const n=new Image,o=URL.createObjectURL(e);t.crossOrigin&&(n.crossOrigin=t.crossOrigin);try{return await new Promise((i,s)=>{n.addEventListener("load",()=>{i(n)}),n.addEventListener("error",s),n.src=o})}finally{URL.revokeObjectURL(o)}}async function Zo(e,t,n){if(!e.complete||!e.naturalWidth)throw new Error("Image has not been properly loaded");if(!t.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${t}`);const o=document.createElement("canvas"),r=o.getContext("2d"),i=Math.min(1,n/Math.max(e.width,e.height)),s=Math.round(e.width*i),c=Math.round(e.height*i);o.width=s,o.height=c,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(e,0,0,s,c);const a=await new Promise(u=>{o.toBlob(u,t)});if(!a)throw new Error("Failed to convert canvas to Blob");return a}function Po(){const{currentContent:e}=We(),t={...e.value,title:window.panel.view.title};return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,Array.isArray(o)||typeof o=="object"&&o!==null?JSON.stringify(o):o]))}let Ao;function Zt(){return Ao??(Ao=Xn("copilot"))}let Ze,$e;function W(){return Ze||$e||($e=window.panel.api.get(vo).then(e=>(to(e.assets),Ze=e,$e=void 0,Ze)),$e)}async function Pt({userPrompt:e,systemPrompt:t,files:n=[],logLevel:o=1,abortSignal:r}){const i=Zt(),{config:s}=await W(),{model:c,providerOptions:a}=await jt(),{AISDKError:u,APICallError:d,streamText:h,smoothStream:p}=await oe("ai"),{userPromptWithContext:g,imageByteArrays:v}=await Ct({userPrompt:e,files:n});return o>1&&(i.info("System prompt:",t),i.info("User prompt with context:",g)),h({model:c,providerOptions:a,temperature:s.temperature??void 0,system:t||void 0,...v.length>0?{messages:[{role:"user",content:[{type:"text",text:g},...v.map(_=>({type:"image",image:_}))]}]}:{prompt:g},experimental_transform:p({chunking:"line"}),abortSignal:r,onError({error:_}){if(u.isInstance(_)||d.isInstance(_))throw _}})}async function At({userPrompt:e,systemPrompt:t,schema:n,output:o="object",files:r=[],logLevel:i=1,abortSignal:s}){const c=Zt(),{config:a}=await W(),{model:u,providerOptions:d}=await jt(),{AISDKError:h,APICallError:p,streamObject:g}=await oe("ai"),{userPromptWithContext:v,imageByteArrays:_}=await Ct({userPrompt:e,files:r});return i>1&&(c.info("System prompt:",t),c.info("User prompt with context:",v)),g({model:u,providerOptions:d,temperature:a.temperature??void 0,schema:n,output:o,..._.length>0?{messages:[{role:"user",content:[{type:"text",text:v},..._.map(z=>({type:"image",image:z}))]}]}:{prompt:v},abortSignal:s,onError({error:z}){if(h.isInstance(z)||p.isInstance(z))throw z}})}async function jt(){var h,p;let{config:e}=await W();if(!e.provider||!Et.includes(e.provider))throw new we(`Unsupported provider "${e.provider}" in the "johannschopplich.copilot.provider" global configuration.`);for(const g of["apiKey","model"])if(!((p=(h=e.providers)==null?void 0:h[e.provider])!=null&&p[g]))throw new we(`Missing "${g}" property in the "johannschopplich.copilot.providers.${e.provider}" global configuration.`);const{createAnthropic:t,createGoogleGenerativeAI:n,createMistral:o,createOpenAI:r}=await oe("ai"),i=e.provider,s=e.providers[i],c={anthropic:t,google:n,mistral:o,openai:r}[i],u=c({baseUrl:s.baseUrl||void 0,apiKey:s.apiKey,...i==="anthropic"?{headers:{"anthropic-dangerous-direct-browser-access":"true"}}:void 0}).languageModel(s.model),d=typeof s.options=="object"&&s.options!==null?{[i]:s.options}:void 0;return{model:u,providerOptions:d}}async function Ct({userPrompt:e,files:t=[]}){const n=Po();let o=So(e,n);const r=t.filter(c=>c.type.startsWith("image/")),i=t.filter(c=>c.type==="application/pdf");if(i.length>0){const c=await Promise.all(i.map(ko));o+=`

${c.map((a,u)=>`<pdf_document_${u+1}>
${a}
</pdf_document_${u+1}>`).join(`

`)}`}const s=await Promise.all(r.map(async c=>{const u=await(await Eo(c,2048)).arrayBuffer();return new Uint8Array(u)}));return{userPromptWithContext:o,imageByteArrays:s}}function l(e,t,n){function o(c,a){if(c._zod||Object.defineProperty(c,"_zod",{value:{def:a,constr:s,traits:new Set},enumerable:!1}),c._zod.traits.has(e))return;c._zod.traits.add(e),t(c,a);const u=s.prototype,d=Object.keys(u);for(let h=0;h<d.length;h++){const p=d[h];p in c||(c[p]=u[p].bind(c))}}const r=(n==null?void 0:n.Parent)??Object;class i extends r{}Object.defineProperty(i,"name",{value:e});function s(c){var a;const u=n!=null&&n.Parent?new i:this;o(u,c),(a=u._zod).deferred??(a.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(s,"init",{value:o}),Object.defineProperty(s,Symbol.hasInstance,{value:c=>{var a,u;return n!=null&&n.Parent&&c instanceof n.Parent?!0:(u=(a=c==null?void 0:c._zod)==null?void 0:a.traits)==null?void 0:u.has(e)}}),Object.defineProperty(s,"name",{value:e}),s}class le extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Ot extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Tt={};function X(e){return Tt}function jo(e){const t=Object.values(e).filter(o=>typeof o=="number");return Object.entries(e).filter(([o,r])=>t.indexOf(+o)===-1).map(([o,r])=>r)}function et(e,t){return typeof t=="bigint"?t.toString():t}function tt(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function nt(e){return e==null}function ot(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Co(e,t){const n=(e.toString().split(".")[1]||"").length,o=t.toString();let r=(o.split(".")[1]||"").length;if(r===0&&/\d?e-\d?/.test(o)){const a=o.match(/\d?e-(\d?)/);a!=null&&a[1]&&(r=Number.parseInt(a[1]))}const i=n>r?n:r,s=Number.parseInt(e.toFixed(i).replace(".","")),c=Number.parseInt(t.toFixed(i).replace(".",""));return s%c/10**i}const Lt=Symbol("evaluating");function S(e,t,n){let o;Object.defineProperty(e,t,{get(){if(o!==Lt)return o===void 0&&(o=Lt,o=n()),o},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function ie(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function se(...e){const t={};for(const n of e){const o=Object.getOwnPropertyDescriptors(n);Object.assign(t,o)}return Object.defineProperties({},t)}function Ft(e){return JSON.stringify(e)}function Oo(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const Dt="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Pe(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const To=tt(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function de(e){if(Pe(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(Pe(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function Mt(e){return de(e)?{...e}:Array.isArray(e)?[...e]:e}const Lo=new Set(["string","number","symbol"]);function pe(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Q(e,t,n){const o=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(o._zod.parent=e),o}function m(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Fo(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Do={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Mo(e,t){const n=e._zod.def,o=se(e._zod.def,{get shape(){const r={};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(r[i]=n.shape[i])}return ie(this,"shape",r),r},checks:[]});return Q(e,o)}function Ro(e,t){const n=e._zod.def,o=se(e._zod.def,{get shape(){const r={...e._zod.def.shape};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete r[i]}return ie(this,"shape",r),r},checks:[]});return Q(e,o)}function Uo(e,t){if(!de(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const r=se(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return ie(this,"shape",i),i},checks:[]});return Q(e,r)}function Bo(e,t){if(!de(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...e._zod.def,get shape(){const o={...e._zod.def.shape,...t};return ie(this,"shape",o),o},checks:e._zod.def.checks};return Q(e,n)}function No(e,t){const n=se(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t._zod.def.shape};return ie(this,"shape",o),o},get catchall(){return t._zod.def.catchall},checks:[]});return Q(e,n)}function Ko(e,t,n){const o=se(t._zod.def,{get shape(){const r=t._zod.def.shape,i={...r};if(n)for(const s in n){if(!(s in r))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=e?new e({type:"optional",innerType:r[s]}):r[s])}else for(const s in r)i[s]=e?new e({type:"optional",innerType:r[s]}):r[s];return ie(this,"shape",i),i},checks:[]});return Q(t,o)}function Go(e,t,n){const o=se(t._zod.def,{get shape(){const r=t._zod.def.shape,i={...r};if(n)for(const s in n){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=new e({type:"nonoptional",innerType:r[s]}))}else for(const s in r)i[s]=new e({type:"nonoptional",innerType:r[s]});return ie(this,"shape",i),i},checks:[]});return Q(t,o)}function fe(e,t=0){var n;if(e.aborted===!0)return!0;for(let o=t;o<e.issues.length;o++)if(((n=e.issues[o])==null?void 0:n.continue)!==!0)return!0;return!1}function he(e,t){return t.map(n=>{var o;return(o=n).path??(o.path=[]),n.path.unshift(e),n})}function Ae(e){return typeof e=="string"?e:e==null?void 0:e.message}function ee(e,t,n){var r,i,s,c,a,u;const o={...e,path:e.path??[]};if(!e.message){const d=Ae((s=(i=(r=e.inst)==null?void 0:r._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,e))??Ae((c=t==null?void 0:t.error)==null?void 0:c.call(t,e))??Ae((a=n.customError)==null?void 0:a.call(n,e))??Ae((u=n.localeError)==null?void 0:u.call(n,e))??"Invalid input";o.message=d}return delete o.inst,delete o.continue,t!=null&&t.reportInput||delete o.input,o}function rt(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function ze(...e){const[t,n,o]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:o}:{...t}}const Rt=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,et,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Ut=l("$ZodError",Rt),Bt=l("$ZodError",Rt,{Parent:Error});function Vo(e,t=n=>n.message){const n={},o=[];for(const r of e.issues)r.path.length>0?(n[r.path[0]]=n[r.path[0]]||[],n[r.path[0]].push(t(r))):o.push(t(r));return{formErrors:o,fieldErrors:n}}function Wo(e,t=n=>n.message){const n={_errors:[]},o=r=>{for(const i of r.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>o({issues:s}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(t(i));else{let s=n,c=0;for(;c<i.path.length;){const a=i.path[c];c===i.path.length-1?(s[a]=s[a]||{_errors:[]},s[a]._errors.push(t(i))):s[a]=s[a]||{_errors:[]},s=s[a],c++}}};return o(e),n}const it=e=>(t,n,o,r)=>{const i=o?Object.assign(o,{async:!1}):{async:!1},s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise)throw new le;if(s.issues.length){const c=new((r==null?void 0:r.Err)??e)(s.issues.map(a=>ee(a,i,X())));throw Dt(c,r==null?void 0:r.callee),c}return s.value},st=e=>async(t,n,o,r)=>{const i=o?Object.assign(o,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const c=new((r==null?void 0:r.Err)??e)(s.issues.map(a=>ee(a,i,X())));throw Dt(c,r==null?void 0:r.callee),c}return s.value},je=e=>(t,n,o)=>{const r=o?{...o,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},r);if(i instanceof Promise)throw new le;return i.issues.length?{success:!1,error:new(e??Ut)(i.issues.map(s=>ee(s,r,X())))}:{success:!0,data:i.value}},Ho=je(Bt),Ce=e=>async(t,n,o)=>{const r=o?Object.assign(o,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},r);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(s=>ee(s,r,X())))}:{success:!0,data:i.value}},qo=Ce(Bt),Yo=e=>(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return it(e)(t,n,r)},Jo=e=>(t,n,o)=>it(e)(t,n,o),Xo=e=>async(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return st(e)(t,n,r)},Qo=e=>async(t,n,o)=>st(e)(t,n,o),er=e=>(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return je(e)(t,n,r)},tr=e=>(t,n,o)=>je(e)(t,n,o),nr=e=>async(t,n,o)=>{const r=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Ce(e)(t,n,r)},or=e=>async(t,n,o)=>Ce(e)(t,n,o),rr=/^[cC][^\s-]{8,}$/,ir=/^[0-9a-z]+$/,sr=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ar=/^[0-9a-vA-V]{20}$/,cr=/^[A-Za-z0-9]{27}$/,ur=/^[a-zA-Z0-9_-]{21}$/,lr=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,dr=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Nt=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,pr=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,fr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function hr(){return new RegExp(fr,"u")}const mr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,gr=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,vr=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,_r=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,yr=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Kt=/^[A-Za-z0-9_-]*$/,br=/^\+(?:[0-9]){6,14}[0-9]$/,Gt="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",wr=new RegExp(`^${Gt}$`);function Vt(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function kr(e){return new RegExp(`^${Vt(e)}$`)}function $r(e){const t=Vt({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const o=`${t}(?:${n.join("|")})`;return new RegExp(`^${Gt}T(?:${o})$`)}const zr=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Sr=/^-?\d+$/,xr=/^-?\d+(?:\.\d+)?/,Er=/^(?:true|false)$/i,Ir=/^[^A-Z]*$/,Zr=/^[^a-z]*$/,F=l("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Wt={number:"number",bigint:"bigint",object:"date"},Ht=l("$ZodCheckLessThan",(e,t)=>{F.init(e,t);const n=Wt[typeof t.value];e._zod.onattach.push(o=>{const r=o._zod.bag,i=(t.inclusive?r.maximum:r.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value<=t.value:o.value<t.value)||o.issues.push({origin:n,code:"too_big",maximum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),qt=l("$ZodCheckGreaterThan",(e,t)=>{F.init(e,t);const n=Wt[typeof t.value];e._zod.onattach.push(o=>{const r=o._zod.bag,i=(t.inclusive?r.minimum:r.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value>=t.value:o.value>t.value)||o.issues.push({origin:n,code:"too_small",minimum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Pr=l("$ZodCheckMultipleOf",(e,t)=>{F.init(e,t),e._zod.onattach.push(n=>{var o;(o=n._zod.bag).multipleOf??(o.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Co(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Ar=l("$ZodCheckNumberFormat",(e,t)=>{var s;F.init(e,t),t.format=t.format||"float64";const n=(s=t.format)==null?void 0:s.includes("int"),o=n?"int":"number",[r,i]=Do[t.format];e._zod.onattach.push(c=>{const a=c._zod.bag;a.format=t.format,a.minimum=r,a.maximum=i,n&&(a.pattern=Sr)}),e._zod.check=c=>{const a=c.value;if(n){if(!Number.isInteger(a)){c.issues.push({expected:o,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?c.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,continue:!t.abort}):c.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,continue:!t.abort});return}}a<r&&c.issues.push({origin:"number",input:a,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),a>i&&c.issues.push({origin:"number",input:a,code:"too_big",maximum:i,inst:e})}}),jr=l("$ZodCheckMaxLength",(e,t)=>{var n;F.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!nt(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(o._zod.bag.maximum=t.maximum)}),e._zod.check=o=>{const r=o.value;if(r.length<=t.maximum)return;const s=rt(r);o.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Cr=l("$ZodCheckMinLength",(e,t)=>{var n;F.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!nt(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(o._zod.bag.minimum=t.minimum)}),e._zod.check=o=>{const r=o.value;if(r.length>=t.minimum)return;const s=rt(r);o.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Or=l("$ZodCheckLengthEquals",(e,t)=>{var n;F.init(e,t),(n=e._zod.def).when??(n.when=o=>{const r=o.value;return!nt(r)&&r.length!==void 0}),e._zod.onattach.push(o=>{const r=o._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=o=>{const r=o.value,i=r.length;if(i===t.length)return;const s=rt(r),c=i>t.length;o.issues.push({origin:s,...c?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:o.value,inst:e,continue:!t.abort})}}),Oe=l("$ZodCheckStringFormat",(e,t)=>{var n,o;F.init(e,t),e._zod.onattach.push(r=>{const i=r._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(o=e._zod).check??(o.check=()=>{})}),Tr=l("$ZodCheckRegex",(e,t)=>{Oe.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Lr=l("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Ir),Oe.init(e,t)}),Fr=l("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Zr),Oe.init(e,t)}),Dr=l("$ZodCheckIncludes",(e,t)=>{F.init(e,t);const n=pe(t.includes),o=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=o,e._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(o)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),Mr=l("$ZodCheckStartsWith",(e,t)=>{F.init(e,t);const n=new RegExp(`^${pe(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const r=o._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(n)}),e._zod.check=o=>{o.value.startsWith(t.prefix)||o.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:o.value,inst:e,continue:!t.abort})}}),Rr=l("$ZodCheckEndsWith",(e,t)=>{F.init(e,t);const n=new RegExp(`.*${pe(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const r=o._zod.bag;r.patterns??(r.patterns=new Set),r.patterns.add(n)}),e._zod.check=o=>{o.value.endsWith(t.suffix)||o.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:o.value,inst:e,continue:!t.abort})}}),Ur=l("$ZodCheckOverwrite",(e,t)=>{F.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Br{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const o=t.split(`
`).filter(s=>s),r=Math.min(...o.map(s=>s.length-s.trimStart().length)),i=o.map(s=>s.slice(r)).map(s=>" ".repeat(this.indent*2)+s);for(const s of i)this.content.push(s)}compile(){const t=Function,n=this==null?void 0:this.args,r=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new t(...n,r.join(`
`))}}const Nr={major:4,minor:1,patch:13},Z=l("$ZodType",(e,t)=>{var r;var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Nr;const o=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&o.unshift(e);for(const i of o)for(const s of i._zod.onattach)s(e);if(o.length===0)(n=e._zod).deferred??(n.deferred=[]),(r=e._zod.deferred)==null||r.push(()=>{e._zod.run=e._zod.parse});else{const i=(c,a,u)=>{let d=fe(c),h;for(const p of a){if(p._zod.def.when){if(!p._zod.def.when(c))continue}else if(d)continue;const g=c.issues.length,v=p._zod.check(c);if(v instanceof Promise&&(u==null?void 0:u.async)===!1)throw new le;if(h||v instanceof Promise)h=(h??Promise.resolve()).then(async()=>{await v,c.issues.length!==g&&(d||(d=fe(c,g)))});else{if(c.issues.length===g)continue;d||(d=fe(c,g))}}return h?h.then(()=>c):c},s=(c,a,u)=>{if(fe(c))return c.aborted=!0,c;const d=i(a,o,u);if(d instanceof Promise){if(u.async===!1)throw new le;return d.then(h=>e._zod.parse(h,u))}return e._zod.parse(d,u)};e._zod.run=(c,a)=>{if(a.skipChecks)return e._zod.parse(c,a);if(a.direction==="backward"){const d=e._zod.parse({value:c.value,issues:[]},{...a,skipChecks:!0});return d instanceof Promise?d.then(h=>s(h,c,a)):s(d,c,a)}const u=e._zod.parse(c,a);if(u instanceof Promise){if(a.async===!1)throw new le;return u.then(d=>i(d,o,a))}return i(u,o,a)}}e["~standard"]={validate:i=>{var s;try{const c=Ho(e,i);return c.success?{value:c.data}:{issues:(s=c.error)==null?void 0:s.issues}}catch{return qo(e,i).then(a=>{var u;return a.success?{value:a.data}:{issues:(u=a.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),at=l("$ZodString",(e,t)=>{var n;Z.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??zr(e._zod.bag),e._zod.parse=(o,r)=>{if(t.coerce)try{o.value=String(o.value)}catch{}return typeof o.value=="string"||o.issues.push({expected:"string",code:"invalid_type",input:o.value,inst:e}),o}}),I=l("$ZodStringFormat",(e,t)=>{Oe.init(e,t),at.init(e,t)}),Kr=l("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=dr),I.init(e,t)}),Gr=l("$ZodUUID",(e,t)=>{if(t.version){const o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(o===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Nt(o))}else t.pattern??(t.pattern=Nt());I.init(e,t)}),Vr=l("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=pr),I.init(e,t)}),Wr=l("$ZodURL",(e,t)=>{I.init(e,t),e._zod.check=n=>{try{const o=n.value.trim(),r=new URL(o);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=r.href:n.value=o;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Hr=l("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=hr()),I.init(e,t)}),qr=l("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=ur),I.init(e,t)}),Yr=l("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=rr),I.init(e,t)}),Jr=l("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=ir),I.init(e,t)}),Xr=l("$ZodULID",(e,t)=>{t.pattern??(t.pattern=sr),I.init(e,t)}),Qr=l("$ZodXID",(e,t)=>{t.pattern??(t.pattern=ar),I.init(e,t)}),ei=l("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=cr),I.init(e,t)}),ti=l("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=$r(t)),I.init(e,t)}),ni=l("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=wr),I.init(e,t)}),oi=l("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=kr(t)),I.init(e,t)}),ri=l("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=lr),I.init(e,t)}),ii=l("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=mr),I.init(e,t),e._zod.bag.format="ipv4"}),si=l("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=gr),I.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),ai=l("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=vr),I.init(e,t)}),ci=l("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=_r),I.init(e,t),e._zod.check=n=>{const o=n.value.split("/");try{if(o.length!==2)throw new Error;const[r,i]=o;if(!i)throw new Error;const s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Yt(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const ui=l("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=yr),I.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{Yt(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function li(e){if(!Kt.test(e))return!1;const t=e.replace(/[-_]/g,o=>o==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Yt(n)}const di=l("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Kt),I.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{li(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),pi=l("$ZodE164",(e,t)=>{t.pattern??(t.pattern=br),I.init(e,t)});function fi(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[o]=n;if(!o)return!1;const r=JSON.parse(atob(o));return!("typ"in r&&(r==null?void 0:r.typ)!=="JWT"||!r.alg||t&&(!("alg"in r)||r.alg!==t))}catch{return!1}}const hi=l("$ZodJWT",(e,t)=>{I.init(e,t),e._zod.check=n=>{fi(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Jt=l("$ZodNumber",(e,t)=>{Z.init(e,t),e._zod.pattern=e._zod.bag.pattern??xr,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const r=n.value;if(typeof r=="number"&&!Number.isNaN(r)&&Number.isFinite(r))return n;const i=typeof r=="number"?Number.isNaN(r)?"NaN":Number.isFinite(r)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:r,inst:e,...i?{received:i}:{}}),n}}),mi=l("$ZodNumberFormat",(e,t)=>{Ar.init(e,t),Jt.init(e,t)}),gi=l("$ZodBoolean",(e,t)=>{Z.init(e,t),e._zod.pattern=Er,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=!!n.value}catch{}const r=n.value;return typeof r=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:r,inst:e}),n}}),vi=l("$ZodUnknown",(e,t)=>{Z.init(e,t),e._zod.parse=n=>n}),_i=l("$ZodNever",(e,t)=>{Z.init(e,t),e._zod.parse=(n,o)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function Xt(e,t,n){e.issues.length&&t.issues.push(...he(n,e.issues)),t.value[n]=e.value}const yi=l("$ZodArray",(e,t)=>{Z.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!Array.isArray(r))return n.issues.push({expected:"array",code:"invalid_type",input:r,inst:e}),n;n.value=Array(r.length);const i=[];for(let s=0;s<r.length;s++){const c=r[s],a=t.element._zod.run({value:c,issues:[]},o);a instanceof Promise?i.push(a.then(u=>Xt(u,n,s))):Xt(a,n,s)}return i.length?Promise.all(i).then(()=>n):n}});function Te(e,t,n,o){e.issues.length&&t.issues.push(...he(n,e.issues)),e.value===void 0?n in o&&(t.value[n]=void 0):t.value[n]=e.value}function Qt(e){var o,r,i,s;const t=Object.keys(e.shape);for(const c of t)if(!((s=(i=(r=(o=e.shape)==null?void 0:o[c])==null?void 0:r._zod)==null?void 0:i.traits)!=null&&s.has("$ZodType")))throw new Error(`Invalid element at key "${c}": expected a Zod schema`);const n=Fo(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function en(e,t,n,o,r,i){const s=[],c=r.keySet,a=r.catchall._zod,u=a.def.type;for(const d in t){if(c.has(d))continue;if(u==="never"){s.push(d);continue}const h=a.run({value:t[d],issues:[]},o);h instanceof Promise?e.push(h.then(p=>Te(p,n,d,t))):Te(h,n,d,t)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:i}),e.length?Promise.all(e).then(()=>n):n}const bi=l("$ZodObject",(e,t)=>{Z.init(e,t);const n=Object.getOwnPropertyDescriptor(t,"shape");if(!(n!=null&&n.get)){const c=t.shape;Object.defineProperty(t,"shape",{get:()=>{const a={...c};return Object.defineProperty(t,"shape",{value:a}),a}})}const o=tt(()=>Qt(t));S(e._zod,"propValues",()=>{const c=t.shape,a={};for(const u in c){const d=c[u]._zod;if(d.values){a[u]??(a[u]=new Set);for(const h of d.values)a[u].add(h)}}return a});const r=Pe,i=t.catchall;let s;e._zod.parse=(c,a)=>{s??(s=o.value);const u=c.value;if(!r(u))return c.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),c;c.value={};const d=[],h=s.shape;for(const p of s.keys){const v=h[p]._zod.run({value:u[p],issues:[]},a);v instanceof Promise?d.push(v.then(_=>Te(_,c,p,u))):Te(v,c,p,u)}return i?en(d,u,c,a,o.value,e):d.length?Promise.all(d).then(()=>c):c}}),wi=l("$ZodObjectJIT",(e,t)=>{bi.init(e,t);const n=e._zod.parse,o=tt(()=>Qt(t)),r=p=>{const g=new Br(["shape","payload","ctx"]),v=o.value,_=w=>{const y=Ft(w);return`shape[${y}]._zod.run({ value: input[${y}], issues: [] }, ctx)`};g.write("const input = payload.value;");const z=Object.create(null);let C=0;for(const w of v.keys)z[w]=`key_${C++}`;g.write("const newResult = {};");for(const w of v.keys){const y=z[w],$=Ft(w);g.write(`const ${y} = ${_(w)};`),g.write(`
        if (${y}.issues.length) {
          payload.issues = payload.issues.concat(${y}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${$}, ...iss.path] : [${$}]
          })));
        }
        
        
        if (${y}.value === undefined) {
          if (${$} in input) {
            newResult[${$}] = undefined;
          }
        } else {
          newResult[${$}] = ${y}.value;
        }
        
      `)}g.write("payload.value = newResult;"),g.write("return payload;");const x=g.compile();return(w,y)=>x(p,w,y)};let i;const s=Pe,c=!Tt.jitless,u=c&&To.value,d=t.catchall;let h;e._zod.parse=(p,g)=>{h??(h=o.value);const v=p.value;return s(v)?c&&u&&(g==null?void 0:g.async)===!1&&g.jitless!==!0?(i||(i=r(t.shape)),p=i(p,g),d?en([],v,p,g,h,e):p):n(p,g):(p.issues.push({expected:"object",code:"invalid_type",input:v,inst:e}),p)}});function tn(e,t,n,o){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const r=e.filter(i=>!fe(i));return r.length===1?(t.value=r[0].value,r[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(i=>i.issues.map(s=>ee(s,o,X())))}),t)}const ki=l("$ZodUnion",(e,t)=>{Z.init(e,t),S(e._zod,"optin",()=>t.options.some(r=>r._zod.optin==="optional")?"optional":void 0),S(e._zod,"optout",()=>t.options.some(r=>r._zod.optout==="optional")?"optional":void 0),S(e._zod,"values",()=>{if(t.options.every(r=>r._zod.values))return new Set(t.options.flatMap(r=>Array.from(r._zod.values)))}),S(e._zod,"pattern",()=>{if(t.options.every(r=>r._zod.pattern)){const r=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${r.map(i=>ot(i.source)).join("|")})$`)}});const n=t.options.length===1,o=t.options[0]._zod.run;e._zod.parse=(r,i)=>{if(n)return o(r,i);let s=!1;const c=[];for(const a of t.options){const u=a._zod.run({value:r.value,issues:[]},i);if(u instanceof Promise)c.push(u),s=!0;else{if(u.issues.length===0)return u;c.push(u)}}return s?Promise.all(c).then(a=>tn(a,r,e,i)):tn(c,r,e,i)}}),$i=l("$ZodIntersection",(e,t)=>{Z.init(e,t),e._zod.parse=(n,o)=>{const r=n.value,i=t.left._zod.run({value:r,issues:[]},o),s=t.right._zod.run({value:r,issues:[]},o);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([a,u])=>nn(n,a,u)):nn(n,i,s)}});function ct(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(de(e)&&de(t)){const n=Object.keys(t),o=Object.keys(e).filter(i=>n.indexOf(i)!==-1),r={...e,...t};for(const i of o){const s=ct(e[i],t[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};r[i]=s.data}return{valid:!0,data:r}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let o=0;o<e.length;o++){const r=e[o],i=t[o],s=ct(r,i);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function nn(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),fe(e))return e;const o=ct(t.value,n.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const zi=l("$ZodRecord",(e,t)=>{Z.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!de(r))return n.issues.push({expected:"record",code:"invalid_type",input:r,inst:e}),n;const i=[],s=t.keyType._zod.values;if(s){n.value={};const c=new Set;for(const u of s)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){c.add(typeof u=="number"?u.toString():u);const d=t.valueType._zod.run({value:r[u],issues:[]},o);d instanceof Promise?i.push(d.then(h=>{h.issues.length&&n.issues.push(...he(u,h.issues)),n.value[u]=h.value})):(d.issues.length&&n.issues.push(...he(u,d.issues)),n.value[u]=d.value)}let a;for(const u in r)c.has(u)||(a=a??[],a.push(u));a&&a.length>0&&n.issues.push({code:"unrecognized_keys",input:r,inst:e,keys:a})}else{n.value={};for(const c of Reflect.ownKeys(r)){if(c==="__proto__")continue;const a=t.keyType._zod.run({value:c,issues:[]},o);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){n.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(d=>ee(d,o,X())),input:c,path:[c],inst:e}),n.value[a.value]=a.value;continue}const u=t.valueType._zod.run({value:r[c],issues:[]},o);u instanceof Promise?i.push(u.then(d=>{d.issues.length&&n.issues.push(...he(c,d.issues)),n.value[a.value]=d.value})):(u.issues.length&&n.issues.push(...he(c,u.issues)),n.value[a.value]=u.value)}}return i.length?Promise.all(i).then(()=>n):n}}),Si=l("$ZodEnum",(e,t)=>{Z.init(e,t);const n=jo(t.entries),o=new Set(n);e._zod.values=o,e._zod.pattern=new RegExp(`^(${n.filter(r=>Lo.has(typeof r)).map(r=>typeof r=="string"?pe(r):r.toString()).join("|")})$`),e._zod.parse=(r,i)=>{const s=r.value;return o.has(s)||r.issues.push({code:"invalid_value",values:n,input:s,inst:e}),r}}),xi=l("$ZodLiteral",(e,t)=>{if(Z.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(t.values);e._zod.values=n,e._zod.pattern=new RegExp(`^(${t.values.map(o=>typeof o=="string"?pe(o):o?pe(o.toString()):String(o)).join("|")})$`),e._zod.parse=(o,r)=>{const i=o.value;return n.has(i)||o.issues.push({code:"invalid_value",values:t.values,input:i,inst:e}),o}}),Ei=l("$ZodTransform",(e,t)=>{Z.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new Ot(e.constructor.name);const r=t.transform(n.value,n);if(o.async)return(r instanceof Promise?r:Promise.resolve(r)).then(s=>(n.value=s,n));if(r instanceof Promise)throw new le;return n.value=r,n}});function on(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Ii=l("$ZodOptional",(e,t)=>{Z.init(e,t),e._zod.optin="optional",e._zod.optout="optional",S(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),S(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${ot(n.source)})?$`):void 0}),e._zod.parse=(n,o)=>{if(t.innerType._zod.optin==="optional"){const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>on(i,n.value)):on(r,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,o)}}),Zi=l("$ZodNullable",(e,t)=>{Z.init(e,t),S(e._zod,"optin",()=>t.innerType._zod.optin),S(e._zod,"optout",()=>t.innerType._zod.optout),S(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${ot(n.source)}|null)$`):void 0}),S(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,o)=>n.value===null?n:t.innerType._zod.run(n,o)}),Pi=l("$ZodDefault",(e,t)=>{Z.init(e,t),e._zod.optin="optional",S(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);if(n.value===void 0)return n.value=t.defaultValue,n;const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>rn(i,t)):rn(r,t)}});function rn(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Ai=l("$ZodPrefault",(e,t)=>{Z.init(e,t),e._zod.optin="optional",S(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>(o.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,o))}),ji=l("$ZodNonOptional",(e,t)=>{Z.init(e,t),S(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(o=>o!==void 0)):void 0}),e._zod.parse=(n,o)=>{const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>sn(i,e)):sn(r,e)}});function sn(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Ci=l("$ZodCatch",(e,t)=>{Z.init(e,t),S(e._zod,"optin",()=>t.innerType._zod.optin),S(e._zod,"optout",()=>t.innerType._zod.optout),S(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(i=>(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(s=>ee(s,o,X()))},input:n.value}),n.issues=[]),n)):(n.value=r.value,r.issues.length&&(n.value=t.catchValue({...n,error:{issues:r.issues.map(i=>ee(i,o,X()))},input:n.value}),n.issues=[]),n)}}),Oi=l("$ZodPipe",(e,t)=>{Z.init(e,t),S(e._zod,"values",()=>t.in._zod.values),S(e._zod,"optin",()=>t.in._zod.optin),S(e._zod,"optout",()=>t.out._zod.optout),S(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,o)=>{if(o.direction==="backward"){const i=t.out._zod.run(n,o);return i instanceof Promise?i.then(s=>Le(s,t.in,o)):Le(i,t.in,o)}const r=t.in._zod.run(n,o);return r instanceof Promise?r.then(i=>Le(i,t.out,o)):Le(r,t.out,o)}});function Le(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const Ti=l("$ZodReadonly",(e,t)=>{Z.init(e,t),S(e._zod,"propValues",()=>t.innerType._zod.propValues),S(e._zod,"values",()=>t.innerType._zod.values),S(e._zod,"optin",()=>{var n,o;return(o=(n=t.innerType)==null?void 0:n._zod)==null?void 0:o.optin}),S(e._zod,"optout",()=>{var n,o;return(o=(n=t.innerType)==null?void 0:n._zod)==null?void 0:o.optout}),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(an):an(r)}});function an(e){return e.value=Object.freeze(e.value),e}const Li=l("$ZodCustom",(e,t)=>{F.init(e,t),Z.init(e,t),e._zod.parse=(n,o)=>n,e._zod.check=n=>{const o=n.value,r=t.fn(o);if(r instanceof Promise)return r.then(i=>cn(i,n,o,e));cn(r,n,o,e)}});function cn(e,t,n,o){if(!e){const r={code:"custom",input:n,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(r.params=o._zod.def.params),t.issues.push(ze(r))}}var un;class Fi{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const o=n[0];if(this._map.set(t,o),o&&typeof o=="object"&&"id"in o){if(this._idmap.has(o.id))throw new Error(`ID ${o.id} already exists in the registry`);this._idmap.set(o.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const o={...this.get(n)??{}};delete o.id;const r={...o,...this._map.get(t)};return Object.keys(r).length?r:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Di(){return new Fi}(un=globalThis).__zod_globalRegistry??(un.__zod_globalRegistry=Di());const Fe=globalThis.__zod_globalRegistry;function Mi(e,t){return new e({type:"string",...m(t)})}function Ri(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...m(t)})}function ln(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...m(t)})}function Ui(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...m(t)})}function Bi(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...m(t)})}function Ni(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...m(t)})}function Ki(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...m(t)})}function Gi(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...m(t)})}function Vi(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...m(t)})}function Wi(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...m(t)})}function Hi(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...m(t)})}function qi(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...m(t)})}function Yi(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...m(t)})}function Ji(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...m(t)})}function Xi(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...m(t)})}function Qi(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...m(t)})}function es(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...m(t)})}function ts(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...m(t)})}function ns(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...m(t)})}function os(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...m(t)})}function rs(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...m(t)})}function is(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...m(t)})}function ss(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...m(t)})}function as(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...m(t)})}function cs(e,t){return new e({type:"string",format:"date",check:"string_format",...m(t)})}function us(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...m(t)})}function ls(e,t){return new e({type:"string",format:"duration",check:"string_format",...m(t)})}function ds(e,t){return new e({type:"number",checks:[],...m(t)})}function ps(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...m(t)})}function fs(e,t){return new e({type:"boolean",...m(t)})}function hs(e){return new e({type:"unknown"})}function ms(e,t){return new e({type:"never",...m(t)})}function dn(e,t){return new Ht({check:"less_than",...m(t),value:e,inclusive:!1})}function ut(e,t){return new Ht({check:"less_than",...m(t),value:e,inclusive:!0})}function pn(e,t){return new qt({check:"greater_than",...m(t),value:e,inclusive:!1})}function lt(e,t){return new qt({check:"greater_than",...m(t),value:e,inclusive:!0})}function fn(e,t){return new Pr({check:"multiple_of",...m(t),value:e})}function hn(e,t){return new jr({check:"max_length",...m(t),maximum:e})}function De(e,t){return new Cr({check:"min_length",...m(t),minimum:e})}function mn(e,t){return new Or({check:"length_equals",...m(t),length:e})}function gs(e,t){return new Tr({check:"string_format",format:"regex",...m(t),pattern:e})}function vs(e){return new Lr({check:"string_format",format:"lowercase",...m(e)})}function _s(e){return new Fr({check:"string_format",format:"uppercase",...m(e)})}function ys(e,t){return new Dr({check:"string_format",format:"includes",...m(t),includes:e})}function bs(e,t){return new Mr({check:"string_format",format:"starts_with",...m(t),prefix:e})}function ws(e,t){return new Rr({check:"string_format",format:"ends_with",...m(t),suffix:e})}function me(e){return new Ur({check:"overwrite",tx:e})}function ks(e){return me(t=>t.normalize(e))}function $s(){return me(e=>e.trim())}function zs(){return me(e=>e.toLowerCase())}function Ss(){return me(e=>e.toUpperCase())}function xs(){return me(e=>Oo(e))}function Es(e,t,n){return new e({type:"array",element:t,...m(n)})}function Is(e,t,n){return new e({type:"custom",check:"custom",fn:t,...m(n)})}function Zs(e){const t=Ps(n=>(n.addIssue=o=>{if(typeof o=="string")n.issues.push(ze(o,n.value,t._zod.def));else{const r=o;r.fatal&&(r.continue=!1),r.code??(r.code="custom"),r.input??(r.input=n.value),r.inst??(r.inst=t),r.continue??(r.continue=!t._zod.def.abort),n.issues.push(ze(r))}},e(n.value,n)));return t}function Ps(e,t){const n=new F({check:"custom",...m(t)});return n._zod.check=e,n}const As=l("ZodISODateTime",(e,t)=>{ti.init(e,t),P.init(e,t)});function js(e){return as(As,e)}const Cs=l("ZodISODate",(e,t)=>{ni.init(e,t),P.init(e,t)});function Os(e){return cs(Cs,e)}const Ts=l("ZodISOTime",(e,t)=>{oi.init(e,t),P.init(e,t)});function Ls(e){return us(Ts,e)}const Fs=l("ZodISODuration",(e,t)=>{ri.init(e,t),P.init(e,t)});function Ds(e){return ls(Fs,e)}const B=l("ZodError",(e,t)=>{Ut.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Wo(e,n)},flatten:{value:n=>Vo(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,et,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,et,2)}},isEmpty:{get(){return e.issues.length===0}}})},{Parent:Error}),Ms=it(B),Rs=st(B),Us=je(B),Bs=Ce(B),Ns=Yo(B),Ks=Jo(B),Gs=Xo(B),Vs=Qo(B),Ws=er(B),Hs=tr(B),qs=nr(B),Ys=or(B),A=l("ZodType",(e,t)=>(Z.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(se(t,{checks:[...t.checks??[],...n.map(o=>typeof o=="function"?{_zod:{check:o,def:{check:"custom"},onattach:[]}}:o)]})),e.clone=(n,o)=>Q(e,n,o),e.brand=()=>e,e.register=((n,o)=>(n.add(e,o),e)),e.parse=(n,o)=>Ms(e,n,o,{callee:e.parse}),e.safeParse=(n,o)=>Us(e,n,o),e.parseAsync=async(n,o)=>Rs(e,n,o,{callee:e.parseAsync}),e.safeParseAsync=async(n,o)=>Bs(e,n,o),e.spa=e.safeParseAsync,e.encode=(n,o)=>Ns(e,n,o),e.decode=(n,o)=>Ks(e,n,o),e.encodeAsync=async(n,o)=>Gs(e,n,o),e.decodeAsync=async(n,o)=>Vs(e,n,o),e.safeEncode=(n,o)=>Ws(e,n,o),e.safeDecode=(n,o)=>Hs(e,n,o),e.safeEncodeAsync=async(n,o)=>qs(e,n,o),e.safeDecodeAsync=async(n,o)=>Ys(e,n,o),e.refine=(n,o)=>e.check(Ka(n,o)),e.superRefine=n=>e.check(Ga(n)),e.overwrite=n=>e.check(me(n)),e.optional=()=>$n(e),e.nullable=()=>zn(e),e.nullish=()=>$n(zn(e)),e.nonoptional=n=>Fa(e,n),e.array=()=>G(e),e.or=n=>dt([e,n]),e.and=n=>xa(e,n),e.transform=n=>xn(e,Aa(n)),e.default=n=>Oa(e,n),e.prefault=n=>La(e,n),e.catch=n=>Ma(e,n),e.pipe=n=>xn(e,n),e.readonly=()=>Ba(e),e.describe=n=>{const o=e.clone();return Fe.add(o,{description:n}),o},Object.defineProperty(e,"description",{get(){var n;return(n=Fe.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Fe.get(e);const o=e.clone();return Fe.add(o,n[0]),o},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),gn=l("_ZodString",(e,t)=>{at.init(e,t),A.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...o)=>e.check(gs(...o)),e.includes=(...o)=>e.check(ys(...o)),e.startsWith=(...o)=>e.check(bs(...o)),e.endsWith=(...o)=>e.check(ws(...o)),e.min=(...o)=>e.check(De(...o)),e.max=(...o)=>e.check(hn(...o)),e.length=(...o)=>e.check(mn(...o)),e.nonempty=(...o)=>e.check(De(1,...o)),e.lowercase=o=>e.check(vs(o)),e.uppercase=o=>e.check(_s(o)),e.trim=()=>e.check($s()),e.normalize=(...o)=>e.check(ks(...o)),e.toLowerCase=()=>e.check(zs()),e.toUpperCase=()=>e.check(Ss()),e.slugify=()=>e.check(xs())}),Js=l("ZodString",(e,t)=>{at.init(e,t),gn.init(e,t),e.email=n=>e.check(Ri(Xs,n)),e.url=n=>e.check(Gi(Qs,n)),e.jwt=n=>e.check(ss(ha,n)),e.emoji=n=>e.check(Vi(ea,n)),e.guid=n=>e.check(ln(vn,n)),e.uuid=n=>e.check(Ui(Me,n)),e.uuidv4=n=>e.check(Bi(Me,n)),e.uuidv6=n=>e.check(Ni(Me,n)),e.uuidv7=n=>e.check(Ki(Me,n)),e.nanoid=n=>e.check(Wi(ta,n)),e.guid=n=>e.check(ln(vn,n)),e.cuid=n=>e.check(Hi(na,n)),e.cuid2=n=>e.check(qi(oa,n)),e.ulid=n=>e.check(Yi(ra,n)),e.base64=n=>e.check(os(da,n)),e.base64url=n=>e.check(rs(pa,n)),e.xid=n=>e.check(Ji(ia,n)),e.ksuid=n=>e.check(Xi(sa,n)),e.ipv4=n=>e.check(Qi(aa,n)),e.ipv6=n=>e.check(es(ca,n)),e.cidrv4=n=>e.check(ts(ua,n)),e.cidrv6=n=>e.check(ns(la,n)),e.e164=n=>e.check(is(fa,n)),e.datetime=n=>e.check(js(n)),e.date=n=>e.check(Os(n)),e.time=n=>e.check(Ls(n)),e.duration=n=>e.check(Ds(n))});function K(e){return Mi(Js,e)}const P=l("ZodStringFormat",(e,t)=>{I.init(e,t),gn.init(e,t)}),Xs=l("ZodEmail",(e,t)=>{Vr.init(e,t),P.init(e,t)}),vn=l("ZodGUID",(e,t)=>{Kr.init(e,t),P.init(e,t)}),Me=l("ZodUUID",(e,t)=>{Gr.init(e,t),P.init(e,t)}),Qs=l("ZodURL",(e,t)=>{Wr.init(e,t),P.init(e,t)}),ea=l("ZodEmoji",(e,t)=>{Hr.init(e,t),P.init(e,t)}),ta=l("ZodNanoID",(e,t)=>{qr.init(e,t),P.init(e,t)}),na=l("ZodCUID",(e,t)=>{Yr.init(e,t),P.init(e,t)}),oa=l("ZodCUID2",(e,t)=>{Jr.init(e,t),P.init(e,t)}),ra=l("ZodULID",(e,t)=>{Xr.init(e,t),P.init(e,t)}),ia=l("ZodXID",(e,t)=>{Qr.init(e,t),P.init(e,t)}),sa=l("ZodKSUID",(e,t)=>{ei.init(e,t),P.init(e,t)}),aa=l("ZodIPv4",(e,t)=>{ii.init(e,t),P.init(e,t)}),ca=l("ZodIPv6",(e,t)=>{si.init(e,t),P.init(e,t)}),ua=l("ZodCIDRv4",(e,t)=>{ai.init(e,t),P.init(e,t)}),la=l("ZodCIDRv6",(e,t)=>{ci.init(e,t),P.init(e,t)}),da=l("ZodBase64",(e,t)=>{ui.init(e,t),P.init(e,t)}),pa=l("ZodBase64URL",(e,t)=>{di.init(e,t),P.init(e,t)}),fa=l("ZodE164",(e,t)=>{pi.init(e,t),P.init(e,t)}),ha=l("ZodJWT",(e,t)=>{hi.init(e,t),P.init(e,t)}),_n=l("ZodNumber",(e,t)=>{Jt.init(e,t),A.init(e,t),e.gt=(o,r)=>e.check(pn(o,r)),e.gte=(o,r)=>e.check(lt(o,r)),e.min=(o,r)=>e.check(lt(o,r)),e.lt=(o,r)=>e.check(dn(o,r)),e.lte=(o,r)=>e.check(ut(o,r)),e.max=(o,r)=>e.check(ut(o,r)),e.int=o=>e.check(yn(o)),e.safe=o=>e.check(yn(o)),e.positive=o=>e.check(pn(0,o)),e.nonnegative=o=>e.check(lt(0,o)),e.negative=o=>e.check(dn(0,o)),e.nonpositive=o=>e.check(ut(0,o)),e.multipleOf=(o,r)=>e.check(fn(o,r)),e.step=(o,r)=>e.check(fn(o,r)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function ma(e){return ds(_n,e)}const ga=l("ZodNumberFormat",(e,t)=>{mi.init(e,t),_n.init(e,t)});function yn(e){return ps(ga,e)}const va=l("ZodBoolean",(e,t)=>{gi.init(e,t),A.init(e,t)});function _a(e){return fs(va,e)}const ya=l("ZodUnknown",(e,t)=>{vi.init(e,t),A.init(e,t)});function bn(){return hs(ya)}const ba=l("ZodNever",(e,t)=>{_i.init(e,t),A.init(e,t)});function wa(e){return ms(ba,e)}const ka=l("ZodArray",(e,t)=>{yi.init(e,t),A.init(e,t),e.element=t.element,e.min=(n,o)=>e.check(De(n,o)),e.nonempty=n=>e.check(De(1,n)),e.max=(n,o)=>e.check(hn(n,o)),e.length=(n,o)=>e.check(mn(n,o)),e.unwrap=()=>e.element});function G(e,t){return Es(ka,e,t)}const $a=l("ZodObject",(e,t)=>{wi.init(e,t),A.init(e,t),S(e,"shape",()=>t.shape),e.keyof=()=>Re(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:bn()}),e.loose=()=>e.clone({...e._zod.def,catchall:bn()}),e.strict=()=>e.clone({...e._zod.def,catchall:wa()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>Uo(e,n),e.safeExtend=n=>Bo(e,n),e.merge=n=>No(e,n),e.pick=n=>Mo(e,n),e.omit=n=>Ro(e,n),e.partial=(...n)=>Ko(kn,e,n[0]),e.required=(...n)=>Go(Sn,e,n[0])});function ge(e,t){const n={type:"object",shape:e??{},...m(t)};return new $a(n)}const za=l("ZodUnion",(e,t)=>{ki.init(e,t),A.init(e,t),e.options=t.options});function dt(e,t){return new za({type:"union",options:e,...m(t)})}const Sa=l("ZodIntersection",(e,t)=>{$i.init(e,t),A.init(e,t)});function xa(e,t){return new Sa({type:"intersection",left:e,right:t})}const Ea=l("ZodRecord",(e,t)=>{zi.init(e,t),A.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function wn(e,t,n){return new Ea({type:"record",keyType:e,valueType:t,...m(n)})}const pt=l("ZodEnum",(e,t)=>{Si.init(e,t),A.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(o,r)=>{const i={};for(const s of o)if(n.has(s))i[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new pt({...t,checks:[],...m(r),entries:i})},e.exclude=(o,r)=>{const i={...t.entries};for(const s of o)if(n.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new pt({...t,checks:[],...m(r),entries:i})}});function Re(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,o])):e;return new pt({type:"enum",entries:n,...m(t)})}const Ia=l("ZodLiteral",(e,t)=>{xi.init(e,t),A.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function Za(e,t){return new Ia({type:"literal",values:Array.isArray(e)?e:[e],...m(t)})}const Pa=l("ZodTransform",(e,t)=>{Ei.init(e,t),A.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new Ot(e.constructor.name);n.addIssue=i=>{if(typeof i=="string")n.issues.push(ze(i,n.value,t));else{const s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),n.issues.push(ze(s))}};const r=t.transform(n.value,n);return r instanceof Promise?r.then(i=>(n.value=i,n)):(n.value=r,n)}});function Aa(e){return new Pa({type:"transform",transform:e})}const kn=l("ZodOptional",(e,t)=>{Ii.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function $n(e){return new kn({type:"optional",innerType:e})}const ja=l("ZodNullable",(e,t)=>{Zi.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function zn(e){return new ja({type:"nullable",innerType:e})}const Ca=l("ZodDefault",(e,t)=>{Pi.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Oa(e,t){return new Ca({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Mt(t)}})}const Ta=l("ZodPrefault",(e,t)=>{Ai.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function La(e,t){return new Ta({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Mt(t)}})}const Sn=l("ZodNonOptional",(e,t)=>{ji.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Fa(e,t){return new Sn({type:"nonoptional",innerType:e,...m(t)})}const Da=l("ZodCatch",(e,t)=>{Ci.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Ma(e,t){return new Da({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Ra=l("ZodPipe",(e,t)=>{Oi.init(e,t),A.init(e,t),e.in=t.in,e.out=t.out});function xn(e,t){return new Ra({type:"pipe",in:e,out:t})}const Ua=l("ZodReadonly",(e,t)=>{Ti.init(e,t),A.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ba(e){return new Ua({type:"readonly",innerType:e})}const Na=l("ZodCustom",(e,t)=>{Li.init(e,t),A.init(e,t)});function Ka(e,t={}){return Is(Na,e,t)}function Ga(e){return Zs(e)}const ft=new Set(["files","gap","headline","hidden","info","line","pages","users"]),En={text:e=>H(e,`"${e.label}", single-line plain text without line breaks or formatting`),textarea:e=>H(e,`"${e.label}", multi-line text with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),markdown:e=>H(e,`"${e.label}", multi-line text with Markdown formatting`),slug:e=>H(e,`"${e.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`),url:e=>H(e,`"${e.label}", a valid URL starting with http:// or https://`),email:e=>H(e,`"${e.label}", a valid email address`),password:e=>H(e,`"${e.label}", a secure password (not for actual use)`),tel:e=>H(e,`"${e.label}", a telephone number in appropriate format for the context`),writer:e=>H(e,`"${e.label}" (WYSIWYG), ${e.inline===!0?"text with inline formatting only (bold, italic, underline, code, links, email, sub, sup). NO wrapping paragraph <p> tags allowed.":"text wrapped in paragraph <p> tags (can contain one or multiple paragraphs). Inline formatting (bold, italic, underline, code, links, email, sub, sup) is allowed."}`),list:e=>K().describe(`"${e.label}" (WYSIWYG), HTML list wrapped in <ul> or <ol>. Use <li> for items with inline formatting (bold, italic, underline, code, links, email, sub, sup).`),number:e=>Zn(e),range:e=>Zn(e),toggle:e=>_a().describe(`"${e.label}", a boolean`),select:e=>mt(e),radio:e=>mt(e),toggles:e=>mt(e),checkboxes:e=>gt(e),multiselect:e=>gt(e),tags:e=>gt(e),date:e=>K().describe(`"${e.label}", a date ${e.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:e=>K().describe(`"${e.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),color:e=>K().describe(`"${e.label}", a color value in hex, rgb or hsl format`),link:e=>K().describe(`"${e.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),structure:e=>{const t=In(e);return t?G(t).describe(`"${e.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`):G(wn(K())).describe(`"${e.label}", repeatable structured data based on expected content structure`)},object:e=>{const t=In(e);return t?t.describe(`"${e.label}", structured data containing the defined sub-fields with appropriate content`):wn(K()).describe(`"${e.label}", object data based on expected content structure`)},entries:e=>{const{field:t}=e.field,n={...t,name:"entry",label:e.label||"Entry"},o=En[t.type],r=o(n);let i=G(r);return e.min!=null&&(i=i.min(e.min)),e.max!=null&&(i=i.max(e.max)),i.describe(`"${e.label}", multiple entries of ${t.type} values${e.min!=null||e.max!=null?" within the defined count range":""}`)}};function ht(e){var o;const t=En[e.type];let n=t(e);return e.required===!0&&(n._def.typeName==="ZodString"?((o=n._def.checks)==null?void 0:o.some(r=>r.kind==="min"))!==!0&&(n=n.min(1)):n._def.typeName==="ZodArray"&&n._def.minLength==null&&(n=n.min(1))),n}function In(e){if(typeof e.fields!="object"||e.fields===null)return;const t={};for(const[n,o]of Object.entries(e.fields))o.disabled||o.hidden||ft.has(o.type)||(t[n]=ht({...o,name:n}));return ge(t)}function H(e,t){let n=K();return e.minlength!=null&&(n=n.min(e.minlength)),e.maxlength!=null&&(n=n.max(e.maxlength)),n.describe(t)}function Zn(e){let t=ma();return e.min!=null&&(t=t.min(e.min)),e.max!=null&&(t=t.max(e.max)),t.describe(`"${e.label}", a numeric value${e.min!=null||e.max!=null?" within the defined range":""}`)}function mt(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?Re(t).describe(`"${e.label}", single selection value based on the predefined options`):K().describe(`"${e.label}", single selection value`)}function gt(e){const t=(e.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return t.length>0?G(Re(t)).describe(`"${e.label}", one ore many values based on the predefined options`):G(K()).describe(`"${e.label}", multiple selection values`)}function Pn(e){const{name:t,type:n,fields:o}=e;if(!o||Object.keys(o).length===0)return;const r={};for(const i of Object.values(o)){if(i.disabled||i.hidden||ft.has(i.type))continue;const s=ht(i);r[i.name]=s}return ge({type:Za(n),content:ge(r)}).describe(`Kirby block: ${t}`)}function Va(e){if(!Array.isArray(e)||e.length===0)throw new Error("Invalid fieldsets configuration");const t=e.map(Pn).filter(Boolean);return dt(t).describe("Union of all Kirby block types")}let Ue,Se;function Be(){async function e(){return Ue||Se||(Se=window.panel.api.get(yo).then(o=>(Ue=o,Se=void 0,Ue)),Se)}async function t(o){let r=await e();const{config:i}=await W();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(r=r.filter(s=>!i.excludedBlocks.includes(s.type))),o.fieldsets){const s=Array.isArray(o.fieldsets)?o.fieldsets:Object.keys(o.fieldsets);r=r.filter(c=>s.includes(c.type))}return Va(r)}function n(o){return o.isHidden??(o.isHidden=!1),o.id??(o.id=crypto.randomUUID()),o}return{getFieldsets:e,getZodSchema:t,normalizeBlock:n}}function Wa(e,t,n,o){let r;const i=()=>{r==null||r(),r=void 0},s=(u,d,h,p)=>(u.addEventListener(d,h,p),()=>u.removeEventListener(d,h,p)),c=Ye(()=>Ha(e),u=>{i(),u&&(r=s(u,t,n,o))},{immediate:!0,flush:"post"}),a=()=>{c(),i()};return no()&&io(a),a}function Ha(e){const t=qe(e);return(t==null?void 0:t.$el)??t}const Ne=new Map;function An(){const e=k();async function t(){const{path:o}=e.view;if(Ne.has(o))return Ne.get(o);let r=await e.api.get(_o,{id:o},void 0,!0);return r=Object.values(r).filter(i=>!ft.has(i.type)&&!i.disabled&&!i.hidden),Ne.set(o,r),r}function n(){Ne.delete(e.view.path)}return{getViewFields:t,clearViewFields:n}}function jn(){return xo({accept:[...Xe,"application/pdf"].join(",")})}function qa(e){const t=new Set;for(const n of e)for(const o of n)typeof o=="string"&&o.trim()&&t.add(o);return[...t]}function Ya(e,t){const n=e.map(Pn).filter(Boolean),o=n.length>1?dt(n):n[0];return ge({width:Re(t).describe('Column width fraction to use, e.g. "1/2"'),blocks:G(o).describe("Array of blocks contained in this column")})}function Ja(e,t){const n=Ya(e,t);return ge({columns:G(n).min(1).describe("Array of columns in this layout")})}function Xa(e,t={}){if(!e||e.length===0)throw new Error("No fieldsets available for layout schema generation");const n=t.layouts??[["1/1"]],o=qa(n),r=Ja(e,o),i=n.map(s=>`"${s}"`).join(", ");return r.describe(`Kirby layout with columns and blocks. Available layout combinations: ${i}. Use these exact column width combinations when creating layouts.`)}function vt(){const{getFieldsets:e}=Be();async function t(o){let r=await e();const{config:i}=await W();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(r=r.filter(s=>!i.excludedBlocks.includes(s.type))),o.fieldsets){const s=Array.isArray(o.fieldsets)?o.fieldsets:Object.keys(o.fieldsets);r=r.filter(c=>s.includes(c.type))}return Xa(r,o)}function n(o){return o.id??(o.id=crypto.randomUUID()),o.attrs??(o.attrs=[]),o.columns=(o.columns??[]).map(r=>(r.id??(r.id=crypto.randomUUID()),r.width??(r.width="1/1"),r.blocks=(r.blocks??[]).map(i=>(i.isHidden??(i.isHidden=!1),i.id??(i.id=crypto.randomUUID()),i)),r)),o}return{getZodSchema:t,normalizeLayout:n}}function Qa(e){return typeof e=="string"?`'${e}'`:new ec().serialize(e)}const ec=(function(){var t;class e{constructor(){Vn(this,t,new Map)}compare(o,r){const i=typeof o,s=typeof r;return i==="string"&&s==="string"?o.localeCompare(r):i==="number"&&s==="number"?o-r:String.prototype.localeCompare.call(this.serialize(o,!0),this.serialize(r,!0))}serialize(o,r){if(o===null)return"null";switch(typeof o){case"string":return r?o:`'${o}'`;case"bigint":return`${o}n`;case"object":return this.$object(o);case"function":return this.$function(o)}return String(o)}serializeObject(o){const r=Object.prototype.toString.call(o);if(r!=="[object Object]")return this.serializeBuiltInType(r.length<10?`unknown:${r}`:r.slice(8,-1),o);const i=o.constructor,s=i===Object||i===void 0?"":i.name;if(s!==""&&globalThis[s]===i)return this.serializeBuiltInType(s,o);if(typeof o.toJSON=="function"){const c=o.toJSON();return s+(c!==null&&typeof c=="object"?this.$object(c):`(${this.serialize(c)})`)}return this.serializeObjectEntries(s,Object.entries(o))}serializeBuiltInType(o,r){const i=this["$"+o];if(i)return i.call(this,r);if(typeof(r==null?void 0:r.entries)=="function")return this.serializeObjectEntries(o,r.entries());throw new Error(`Cannot serialize ${o}`)}serializeObjectEntries(o,r){const i=Array.from(r).sort((c,a)=>this.compare(c[0],a[0]));let s=`${o}{`;for(let c=0;c<i.length;c++){const[a,u]=i[c];s+=`${this.serialize(a,!0)}:${this.serialize(u)}`,c<i.length-1&&(s+=",")}return s+"}"}$object(o){let r=Ee(this,t).get(o);return r===void 0&&(Ee(this,t).set(o,`#${Ee(this,t).size}`),r=this.serializeObject(o),Ee(this,t).set(o,r)),r}$function(o){const r=Function.prototype.toString.call(o);return r.slice(-15)==="[native code] }"?`${o.name||""}()[native]`:`${o.name}(${o.length})${r.replace(/\s*\n\s*/g,"")}`}$Array(o){let r="[";for(let i=0;i<o.length;i++)r+=this.serialize(o[i]),i<o.length-1&&(r+=",");return r+"]"}$Date(o){try{return`Date(${o.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(o){return`ArrayBuffer[${new Uint8Array(o).join(",")}]`}$Set(o){return`Set${this.$Array(Array.from(o).sort((r,i)=>this.compare(r,i)))}`}$Map(o){return this.serializeObjectEntries("Map",o.entries())}}t=new WeakMap;for(const n of["Error","RegExp","URL"])e.prototype["$"+n]=function(o){return`${n}(${o})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])e.prototype["$"+n]=function(o){return`${n}[${o.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])e.prototype["$"+n]=function(o){return`${n}[${o.join("n,")}${o.length>0?"n":""}]`};return e})(),tc=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],nc=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],oc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",ae=[];class rc{constructor(){V(this,"_data",new ve);V(this,"_hash",new ve([...tc]));V(this,"_nDataBytes",0);V(this,"_minBufferSize",0)}finalize(t){t&&this._append(t);const n=this._nDataBytes*8,o=this._data.sigBytes*8;return this._data.words[o>>>5]|=128<<24-o%32,this._data.words[(o+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(o+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,n){const o=this._hash.words;let r=o[0],i=o[1],s=o[2],c=o[3],a=o[4],u=o[5],d=o[6],h=o[7];for(let p=0;p<64;p++){if(p<16)ae[p]=t[n+p]|0;else{const w=ae[p-15],y=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,$=ae[p-2],T=($<<15|$>>>17)^($<<13|$>>>19)^$>>>10;ae[p]=y+ae[p-7]+T+ae[p-16]}const g=a&u^~a&d,v=r&i^r&s^i&s,_=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),z=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),C=h+z+g+nc[p]+ae[p],x=_+v;h=d,d=u,u=a,a=c+C|0,c=s,s=i,i=r,r=C+x|0}o[0]=o[0]+r|0,o[1]=o[1]+i|0,o[2]=o[2]+s|0,o[3]=o[3]+c|0,o[4]=o[4]+a|0,o[5]=o[5]+u|0,o[6]=o[6]+d|0,o[7]=o[7]+h|0}_append(t){typeof t=="string"&&(t=ve.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let n,o=this._data.sigBytes/64;t?o=Math.ceil(o):o=Math.max((o|0)-this._minBufferSize,0);const r=o*16,i=Math.min(r*4,this._data.sigBytes);if(r){for(let s=0;s<r;s+=16)this._doProcessBlock(this._data.words,s);n=this._data.words.splice(0,r),this._data.sigBytes-=i}return new ve(n,i)}}class ve{constructor(t,n){V(this,"words");V(this,"sigBytes");t=this.words=t||[],this.sigBytes=n===void 0?t.length*4:n}static fromUtf8(t){const n=unescape(encodeURIComponent(t)),o=n.length,r=[];for(let i=0;i<o;i++)r[i>>>2]|=(n.charCodeAt(i)&255)<<24-i%4*8;return new ve(r,o)}toBase64(){const t=[];for(let n=0;n<this.sigBytes;n+=3){const o=this.words[n>>>2]>>>24-n%4*8&255,r=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,i=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,s=o<<16|r<<8|i;for(let c=0;c<4&&n*8+c*6<this.sigBytes*8;c++)t.push(oc.charAt(s>>>6*(3-c)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<t.sigBytes;n++){const o=t.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=o<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<t.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=t.words[n>>>2];this.sigBytes+=t.sigBytes}}function ic(e){return new rc().finalize(e).toBase64()}function sc(e){return ic(Qa(e))}function Cn(...e){return`${bo}${sc([...e])}`}const On=50;function ac(){const e=Cn("history",window.location.hostname),t=b(JSON.parse(localStorage.getItem(e)||"[]")),n=b(""),o=b(-1);function r(s){if(!s||typeof s!="string"||!s.trim())return;const c=s.trim(),a=t.value.indexOf(c);a!==-1&&t.value.splice(a,1),t.value.unshift(c),t.value.length>On&&(t.value=t.value.slice(0,On)),localStorage.setItem(e,JSON.stringify(t.value)),o.value=-1}function i(s){if(t.value.length!==0){if(s==="up"){if(o.value+1<t.value.length)return o.value++,t.value[o.value]}else if(s==="down"){if(o.value>0)return o.value--,t.value[o.value];if(o.value===0)return o.value=-1,n.value}}}return{lastPrompt:n,currentIndex:o,addToHistory:r,navigateHistory:i}}function _t(e,t,n){if(e.name===t&&(!n||e.type===n))return e;if(e.fieldsets){for(const o of Object.values(e.fieldsets))if(o.tabs){for(const r of Object.values(o.tabs))if(r.fields)for(const i of Object.values(r.fields)){const s=_t(i,t,n);if(s)return s}}}if(e.fields)for(const o of Object.values(e.fields)){const r=_t(o,t,n);if(r)return r}}const cc=Object.assign({inheritAttrs:!1},{__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String,default:void 0}},emits:["input","mounted"],setup(e,{emit:t}){const n=e,o=b(),r=J({get(){return n.value},set(i){t("input",i)}});return zt(()=>{t("mounted",o.value)}),{__sfc:!0,props:n,emit:t,textarea:o,text:r}}});var uc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",t._b({directives:[{name:"model",rawName:"v-model",value:o.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:t.sharedClass,domProps:{value:o.text},on:{input:function(r){r.target.composing||(o.text=r.target.value)}}},"textarea",t.$attrs,!1)),t._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:t.sharedClass,domProps:{textContent:t._s(`${t.value} `)}})])},lc=[],dc=be(cc,uc,lc,!1,null,"a814ce2d");const pc=dc.exports,fc={__name:"Prompt",props:{fields:{type:Array,default:()=>[]},selection:{type:String,default:""},userPrompt:{type:String,default:""},fieldMeta:{type:Object,default:null}},emits:["cancel","close","input","submit","success"],setup(e,{emit:t}){const n=e,o=ye(),r=k(),{lastPrompt:i,currentIndex:s,addToHistory:c,navigateHistory:a}=ac(),{getViewFields:u}=An(),d=b(),h=b(),p=b([]),g=b([]),v=b("append"),_=b(n.userPrompt||""),z=b();Wa(d,"keydown",y=>{if((y.metaKey||y.ctrlKey)&&y.key==="Enter"){if(y.preventDefault(),!_.value.trim()||n.fields.length>0&&g.value.length===0)return;C()}if(y.key==="ArrowUp"&&y.target.selectionStart===0||y.key==="ArrowDown"&&y.target.selectionStart===y.target.value.length){y.preventDefault(),y.key==="ArrowUp"&&s.value===-1&&(i.value=_.value);const $=a(y.key==="ArrowUp"?"up":"down");$!==void 0&&(_.value=$)}}),(async()=>{var $;const y=await W();if(z.value=y.licenseStatus,n.fieldMeta){const T=await x(n.fieldMeta);($=T==null?void 0:T.copilot)!=null&&$.userPrompt&&(_.value=T.copilot.userPrompt)}})();function C(){c(_.value),t("submit",{prompt:_.value,files:p.value,fields:g.value,append:v.value==="append"})}async function x(y){if(!y)return;const $=await u(),{name:T,type:L}=y;for(const O of $){if(O.name===T&&(!L||O.type===L))return O;const te=_t(O,T,L);if(te)return te}}async function w(){const y=await jn();p.value=[...p.value,...y]}return{__sfc:!0,props:n,emit:t,_isKirby5:o,panel:r,lastPrompt:i,currentIndex:s,addToHistory:c,navigateHistory:a,getViewFields:u,textarea:d,picklist:h,files:p,selectedFields:g,insertOption:v,prompt:_,licenseStatus:z,submit:C,findFieldDefinition:x,pickFiles:w,LicensingButtonGroup:xt,AutoGrowTextarea:pc}}};var hc=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(r){return o.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] focus-within:kai-outline focus-within:kai-outline-[2px] focus-within:kai-outline-[var(--color-focus,currentColor)]"},[n(o.AutoGrowTextarea,{attrs:{value:o.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:o.panel.t("johannschopplich.copilot.prompt.placeholder")+(t.selection?` (${o.panel.t("johannschopplich.copilot.prompt.selectionContext")})`:""),rows:"3"},on:{input:function(r){o.prompt=r},mounted:function(r){o.textarea=r}}}),n("div",{staticClass:"kai-flex kai-items-center kai-justify-between kai-px-2 kai-pb-2"},[n("k-button-group",{staticClass:"kai-gap-1"},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{theme:"empty",icon:"attachment",badge:o._isKirby5&&o.files.length>0?{theme:"notice",text:o.files.length}:void 0},on:{click:function(r){return o.pickFiles()}}}),o.files.length>0?n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(r){o.files=[]}}}):t._e()],1),n("div",{staticClass:"kai-flex kai-gap-2"},[t.fields.length>0?[n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.fields"),variant:"filled",badge:o.selectedFields.length>0?{theme:"info",text:o.selectedFields.length}:void 0,dropdown:""},on:{click:function(r){return o.picklist.toggle()}}}),n("k-picklist-dropdown",{ref:"picklist",attrs:{options:t.fields.map(r=>({value:r.name,text:r.label||r.name})),empty:!1,value:o.selectedFields},on:{input:function(r){o.selectedFields=r}}})]:t.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:[{value:"append",text:o.panel.t("johannschopplich.copilot.append")},{value:"replace",text:o.panel.t("johannschopplich.copilot.replace")}],empty:!1,value:o.insertOption},on:{input:function(r){o.insertOption=r}}}):t._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling",disabled:!o.prompt.trim()||t.fields.length>0&&o.selectedFields.length===0},on:{click:function(r){return o.submit()}}},[t._v(" "+t._s(o.panel.t("johannschopplich.copilot.generate"))+" ")])],2)],1),o.licenseStatus!==void 0?n(o.LicensingButtonGroup,{staticClass:"kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":o.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):t._e()],1)])},mc=[],gc=be(fc,hc,mc,!1,null,null);const vc=gc.exports,_c={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};var Tn="vercel.ai.error",yc=Symbol.for(Tn),Ln,bc=class Wn extends Error{constructor({name:t,message:n,cause:o}){super(n),this[Ln]=!0,this.name=t,this.cause=o}static isInstance(t){return Wn.hasMarker(t,Tn)}static hasMarker(t,n){const o=Symbol.for(n);return t!=null&&typeof t=="object"&&o in t&&typeof t[o]=="boolean"&&t[o]===!0}};Ln=yc;var Fn=bc,Dn="AI_InvalidArgumentError",Mn=`vercel.ai.error.${Dn}`,wc=Symbol.for(Mn),Rn,kc=class extends Fn{constructor({message:e,cause:t,argument:n}){super({name:Dn,message:e,cause:t}),this[Rn]=!0,this.argument=n}static isInstance(e){return Fn.hasMarker(e,Mn)}};Rn=wc;var $c=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{const r=()=>{const i=n.length,s=new Array(t);for(let c=0;c<t;c++)s[c]=n[Math.random()*i|0];return s.join("")};if(e==null)return r;if(n.includes(o))throw new kc({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return()=>`${e}${o}${r()}`};$c();function yt(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");const Un={..._c},zc=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:Un,setup(e){const t=e,n=ye(),o=k(),{t:r}=qn(),{currentContent:i,update:s}=We(),c=b(),a=b(),u=b(),d=b(),h=b(),p=b(),g=b(),v=b(),_=b(),z=b(),C=b(),x=b(),w=b(!1),y=b(!1),$=b(!1),T=b(),L=b(),O=b(),te=b([]),ne=b([]),E=b();let D,N;const Ke=J(()=>!y.value&&O.value!==void 0);Ye(L,R=>{w.value&&h.value&&(R&&R!==u.value?localStorage.setItem(`${D}$prompt`,R):(!R||R===u.value)&&localStorage.removeItem(`${D}$prompt`))}),Ye($,R=>{w.value&&h.value&&(R?localStorage.setItem(`${D}$open`,"true"):localStorage.removeItem(`${D}$open`))}),(async()=>{var xe;const{load:R}=Yn(),[q,j]=await Promise.all([W(),R({parent:t.parent,name:t.name})]);if(c.value=r(j.label)||o.t("johannschopplich.copilot.label"),a.value=j.field??void 0,u.value=j.userPrompt??void 0,d.value=j.systemPrompt||q.config.systemPrompt||Qe,h.value=j.storage,j.editable===!0&&te.value.push("edit"),j.files===!0&&te.value.push("files"),p.value=j.icon||"sparkling",g.value=j.theme||"notice-icon",v.value=j.size||"md",_.value=ue.indexOf(j.logLevel&&ue.includes(j.logLevel)?j.logLevel:q.config.logLevel&&ue.includes(q.config.logLevel)?q.config.logLevel:It),C.value=j.help?r(j.help):void 0,x.value=q.config,E.value=q.licenseStatus,j.files==="auto"&&j.modelFile){z.value=j.modelFile;const{mime:U,url:_e}=j.modelFile;Xe.includes(U)&&fetch(_e).then(Y=>Y.blob()).then(Y=>{ne.value=[Y]})}h.value&&((xe=a.value)!=null&&xe.name)&&(D=Cn(o.view.path,a.value.name.toLowerCase()),L.value=localStorage.getItem(`${D}$prompt`)||u.value||"",$.value=localStorage.getItem(`${D}$open`)==="true"||j.open,oo(()=>{T.value&&$.value&&(T.value.open=!0)})),o.events.on("view.save",wt),w.value=!0})(),ro(()=>{o.events.off("view.save",wt)});async function Ge(){if(!L.value){o.notification.error(o.t("johannschopplich.copilot.prompt.empty"));return}o.isLoading=!0,y.value=!0,O.value=i.value[a.value.name.toLowerCase()],N=new AbortController;const{getZodSchema:R,normalizeBlock:q}=Be(),{getZodSchema:j,normalizeLayout:xe}=vt();try{let U="",_e=[];if(a.value.type==="layout"||a.value.type==="blocks"){const Y=await(a.value.type==="layout"?j:R)(a.value),{partialObjectStream:ce,object:Kc}=await At({userPrompt:L.value,systemPrompt:d.value,schema:Y,output:"array",files:ne.value,logLevel:_.value,abortSignal:N.signal});for await(const kt of ce)!kt||!Array.isArray(kt)||await s({[a.value.name.toLowerCase()]:[...O.value,...kt.map(a.value.type==="layout"?xe:q)]},!1);_e=await Kc}else{const{textStream:Y}=await Pt({userPrompt:[`<response_format>
${wo[a.value.type]||"text"}
</response_format>`,L.value].join(`

`),systemPrompt:d.value,files:ne.value,logLevel:_.value,abortSignal:N.signal});for await(const ce of Y)U+=ce,await s({[a.value.name.toLowerCase()]:O.value+U},!1)}await s({[a.value.name.toLowerCase()]:a.value.type==="layout"||a.value.type==="blocks"?[...O.value,...(_e??[]).map(a.value.type==="layout"?xe:q)]:O.value+U}),o.notification.success({icon:"sparkling",message:o.t("johannschopplich.copilot.generator.success")})}catch(U){if(yt(U))return;const{AISDKError:_e,APICallError:Y}=await oe("ai");if(U instanceof we||_e.isInstance(U)||Y.isInstance(U)){let ce=U.message;ce.includes("levels of nesting exceeds limit")&&(ce=`The ${a.value.type} generation for the "${a.value.name}" field exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas.`),console.error(U),o.notification.error(ce);return}console.error(U),o.notification.error(o.t("johannschopplich.copilot.generator.error"))}finally{N=void 0,o.isLoading=!1,y.value=!1}}function Ve(){N==null||N.abort(),N=void 0,o.isLoading=!1,y.value=!1}function Bc(){s({[a.value.name.toLowerCase()]:O.value}),O.value=void 0}async function Nc(){const R=await jn();ne.value=[...ne.value,...R]}function wt(){Ke.value&&(O.value=void 0)}return{__sfc:!0,propsDefinition:Un,props:t,_isKirby5:n,panel:o,t:r,currentContent:i,updateContent:s,label:c,field:a,userPrompt:u,systemPrompt:d,storage:h,icon:p,theme:g,size:v,logLevel:_,modelFile:z,help:C,config:x,isInitialized:w,isGenerating:y,isDetailsOpen:$,detailsElement:T,currentPrompt:L,currentFieldContent:O,permissions:te,files:ne,licenseStatus:E,storageKey:D,abortController:N,canUndo:Ke,generate:Ge,abort:Ve,undo:Bc,pickFiles:Nc,onModelSave:wt,LicensingButtonGroup:xt,SUPPORTED_IMAGE_MIME_TYPES:Xe,SUPPORTED_PROVIDERS:Et}}});var Sc=function(){var r,i,s,c,a,u;var t=this,n=t._self._c,o=t._self._setupProxy;return o.isInitialized?n("k-section",{attrs:{label:o.label}},[o.licenseStatus!==void 0?n("template",{slot:"options"},[n(o.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":o.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):t._e(),!o.config.provider||!o.SUPPORTED_PROVIDERS.includes(o.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Unsupported provider "),n("code",[t._v(t._s(o.config.provider))]),t._v(" in the "),n("code",[t._v("johannschopplich.copilot.provider")]),t._v(" global configuration. ")])],1):(i=(r=o.config.providers)==null?void 0:r[o.config.provider])!=null&&i.apiKey?(c=(s=o.config.providers)==null?void 0:s[o.config.provider])!=null&&c.model?!o.field||typeof o.field=="string"||typeof o.field=="object"&&!(((a=o.field)==null?void 0:a.name.toLowerCase())in o.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" The "),n("code",[t._v(t._s(((u=o.field)==null?void 0:u.name)??o.field))]),t._v(" field does not exist in the current model. ")])],1):!o.permissions.includes("edit")&&!o.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" If the user prompt cannot be edited by the user, a default "),n("code",[t._v("userPrompt")]),t._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:o.isGenerating?"loader":o.icon,text:o.panel.t("johannschopplich.copilot.generate"),theme:o.theme,variant:"filled",size:o.size,disabled:o.isGenerating},on:{click:function(d){return o.generate()}}}),o.isGenerating?n("k-button",{attrs:{icon:"cancel",text:o.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:o.size},on:{click:function(d){return o.abort()}}}):t._e(),o.canUndo?n("k-button",{attrs:{icon:"undo",text:o.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:o.size},on:{click:function(d){return o.undo()}}}):t._e()],1),o.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(d){o.isDetailsOpen=d.target.open}}},[n("summary",[t._v(" "+t._s([...o.permissions.includes("edit")?[o.panel.t("johannschopplich.copilot.prompt.label")]:[],...o.permissions.includes("files")?[o.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[o.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:o.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:o.currentPrompt,placeholder:o.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(d){o.currentPrompt=d}}})],1):t._e(),o.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:o.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:o._isKirby5&&o.files.length>0?{theme:"notice",text:o.files.length}:void 0,size:"sm"},on:{click:function(d){return o.pickFiles()}}}),o.files.length>0?n("k-button",{attrs:{text:o.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(d){o.files=[]}}}):t._e(),o.permissions.includes("edit")&&o.userPrompt&&o.currentPrompt!==o.userPrompt?n("k-button",{staticClass:"kai-ml-auto",attrs:{icon:"undo",text:o.panel.t("johannschopplich.copilot.reset"),variant:"dimmed",size:"xs"},on:{click:function(d){o.currentPrompt=o.userPrompt}}}):t._e()],1):o.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[t._v(" "+t._s(o.panel.t(`johannschopplich.copilot.context.file.${o.SUPPORTED_IMAGE_MIME_TYPES.includes(o.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):t._e()],1)]):t._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("model")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${o.config.provider}`))]),t._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("apiKey")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${o.config.provider}`))]),t._v(" global configuration. ")])],1),o.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:o.help}})],1):t._e()],2):t._e()},xc=[],Ec=be(zc,Sc,xc,!1,null,null);const Ic=Ec.exports;async function Bn(e,{appendText:t,replaceText:n,responseFormat:o="text"}){const r=k(),i=Zc(),s=new AbortController,c=v=>{v.key==="Escape"&&s.abort()},a=await Nn({selection:e,fieldMeta:i});if(!a)return;const{prompt:u,files:d}=a;if(!u)return;r.isLoading=!0,document.addEventListener("keydown",c);const{config:h}=await W(),{AISDKError:p,APICallError:g}=await oe("ai");try{const{textStream:v}=await Pt({userPrompt:[`<response_format>
${o}
</response_format>`,e&&`<selected_text>
${e}
</selected_text>`,u].filter(Boolean).join(`

`),systemPrompt:h.systemPrompt||Qe,files:d,abortSignal:s.signal});let _=!0;for await(let z of v)a.append?(_&&(z=e?` ${z}`:z,_=!1),t(z)):n(z);r.notification.success({icon:"sparkling",message:r.t("johannschopplich.copilot.generator.success")})}catch(v){if(yt(v))return;if(v instanceof we||p.isInstance(v)||g.isInstance(v)){console.error(v),r.notification.error(v.message);return}console.error(v),r.notification.error(r.t("johannschopplich.copilot.generator.error"))}finally{r.isLoading=!1,document.removeEventListener("keydown",c)}}async function Nn(e={}){return new Promise(t=>{const n=k();let o;n.dialog.open({component:"k-copilot-prompt-dialog",props:e,on:{close:()=>{setTimeout(()=>{t(o)},25)},submit:r=>{o=r,n.dialog.close()}}})})}function Zc(){var i;const e=(i=document.activeElement)==null?void 0:i.closest(".k-field");if(!e)return;const t=[...e.classList].find(s=>s.startsWith("k-field-name-")),n=[...e.classList].find(s=>s.startsWith("k-field-type-")),o=t==null?void 0:t.replace("k-field-name-",""),r=n==null?void 0:n.replace("k-field-type-","");return o?{name:o,type:r}:void 0}const Pc={__name:"CopilotButton",props:{label:{type:String,required:!1},userPrompt:{type:String,required:!1},systemPrompt:{type:String,required:!1},logLevel:{type:String,default:""},icon:{type:String,default:"sparkling"},theme:{type:String,default:"notice-icon"}},setup(e){const t=e,n=k(),{currentContent:o,update:r}=We(),{getViewFields:i}=An(),s=b(!1),c=b(!1);let a;async function u(){a=new AbortController;const p=E=>{E.key==="Escape"&&d()},g=await i();if(g.length===0){n.notification.error(n.t("johannschopplich.copilot.generator.noFields"));return}const v=await Nn({fields:g,userPrompt:t.userPrompt});if(!v)return;const{prompt:_,files:z,fields:C}=v,x=g.filter(E=>C.includes(E.name));if(!_||x.length===0)return;const{getZodSchema:w}=Be(),{getZodSchema:y}=vt(),$={};for(const E of x)E.type==="layout"?$[E.name]=G(await y(E)):E.type==="blocks"?$[E.name]=G(await w(E)):$[E.name]=ht(E);n.isLoading=!0,s.value=!0,document.addEventListener("keydown",p);const T={...o.value},{config:L}=await W(),{AISDKError:O,APICallError:te}=await oe("ai"),ne=t.systemPrompt||L.systemPrompt||Qe;try{const{partialObjectStream:E,object:D}=await At({userPrompt:_,systemPrompt:ne,schema:ge($),output:"object",files:z,logLevel:ue.indexOf(t.logLevel&&ue.includes(t.logLevel)?t.logLevel:L.logLevel&&ue.includes(L.logLevel)?L.logLevel:It),abortSignal:a.signal});for await(const Ge of E){if(!Ge)continue;const Ve=h({object:Ge,selectedFields:x,currentContent:T});Object.keys(Ve).length>0&&await r(Ve,!1)}const N=await D,Ke=h({object:N,selectedFields:x,currentContent:T});await r(Ke),n.notification.success({icon:"sparkling",message:n.t("johannschopplich.copilot.generator.success")})}catch(E){if(yt(E))return;if(E instanceof we||O.isInstance(E)||te.isInstance(E)){let D=E.message;D.includes("levels of nesting exceeds limit")&&(D="The fields generation exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas."),console.error(E),n.notification.error(D);return}console.error(E),n.notification.error(n.t("johannschopplich.copilot.generator.error"))}finally{a=void 0,n.isLoading=!1,s.value=!1,document.removeEventListener("keydown",p)}}function d(){a==null||a.abort(),a=void 0,s.value=!1,n.isLoading=!1}function h({object:p,selectedFields:g,currentContent:v}){const{normalizeBlock:_}=Be(),{normalizeLayout:z}=vt(),C={};for(const x of g){const w=p[x.name];if(w==null)continue;const y=v[x.name];x.type==="layout"||x.type==="blocks"?Array.isArray(w)&&(C[x.name]=[...y,...w.map(x.type==="layout"?z:_)]):C[x.name]=w}return C}return{__sfc:!0,props:t,panel:n,currentContent:o,updateContent:r,getViewFields:i,isGenerating:s,isHovering:c,abortController:a,initPromptDialog:u,abort:d,processFieldValues:h}}};var Ac=function(){var t=this,n=t._self._c,o=t._self._setupProxy;return n("k-button",{attrs:{icon:o.isHovering&&o.isGenerating?"cancel":o.isGenerating?"loader":t.icon,text:t.label||o.panel.t("johannschopplich.copilot.label"),theme:o.isHovering&&o.isGenerating?"notice":t.theme,variant:"filled",size:"sm",responsive:""},on:{click:function(r){o.isHovering&&o.isGenerating?o.abort():o.initPromptDialog()}},nativeOn:{mouseenter:function(r){o.isHovering=!0},mouseleave:function(r){o.isHovering=!1}}})},jc=[],Cc=be(Pc,Ac,jc,!1,null,null);const Kn=Cc.exports,Oc={"copilot-ai-generate":'<path fill="currentColor" d="m20.467 8.694l.246-.566a4.36 4.36 0 0 1 2.22-2.25l.759-.339a.53.53 0 0 0 0-.963l-.717-.319a4.37 4.37 0 0 1-2.251-2.326l-.253-.611a.506.506 0 0 0-.942 0l-.253.61a4.37 4.37 0 0 1-2.25 2.327l-.718.32a.53.53 0 0 0 0 .962l.76.338a4.36 4.36 0 0 1 2.219 2.251l.246.566c.18.414.753.414.934 0M5.8 16h2.154l.6-1.5h2.892l.6 1.5H14.2L11 8H9zm4.2-5.115l.646 1.615H9.354zM15 16V8h2v8zM3 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-9h-2v8H4V5h10V3z" />'},Tc={copilot:{icon:"sparkling",label:"Copilot Prompt",click(){let e="";this.command("insert",(r,i)=>(e=i,i));let t=!0;Bn(e,{responseFormat:"markdown",appendText:r=>{this.command("insert",(i,s)=>t?(t=!1,s+r):r)},replaceText:r=>{this.command("insert",()=>r)}})},shortcut:"."}},bt={"***":["bold","italic"],"**":["bold"],"*":["italic"],"`":["code"]},Lc={copilot:{get button(){return{icon:"sparkling",label:"Copilot Prompt"}},commands(e){return()=>this._openPromptDialog(e)},keys(e){return{"Mod-.":()=>this._openPromptDialog(e)}},get name(){return"copilot"},_insertText(e,t,n,o,r){let i=n;const s=t.split(/(\n\n?|\*{1,3}|`{1,3})/);for(let c=0;c<s.length;c++){const a=s[c];if(a){if(a===`

`){const u=this.editor.options.inline?[r.schema.nodes.hardBreak.create(),r.schema.nodes.hardBreak.create()]:r.schema.nodes.paragraph.create();e=e.replaceWith(i,i,u),i+=2,o.lastSegment=a}else if(a===`
`)e=e.replaceWith(i,i,r.schema.nodes.hardBreak.create()),i+=1,o.lastSegment=a;else if(a.length>0){if(a in bt){const d=c<s.length-1?s[c+1]:"";if((Mc(a,o.activeMarks)||Rc(a,d))&&!o.lastSegment.includes(a)){for(const g of bt[a])e=Dc(e,g,o,r);o.lastSegment=a;continue}}e=e.insertText(a,i),i+=a.length,o.lastSegment=a}}}return{tr:e,newPosition:i}},_openPromptDialog(e){const{state:t}=this.editor,{from:n,to:o}=t.selection,r=t.doc.textBetween(n,o),i={activeMarks:new Set,lastSegment:""};let s,c=!1,a=!0;Bn(r,{responseFormat:"text",replaceText:h=>{const{state:p,view:g}=this.editor;let v=p.tr;if(!c){const C=Fc(p),{from:x,to:w}=p.selection;v=v.deleteRange(x,w),s=C?1:x,c=!0}const{tr:_,newPosition:z}=this._insertText(v,h,s,i,e);s=z,g.dispatch(_)},appendText:h=>{const{state:p,view:g}=this.editor;a&&(s=p.selection.to,a=!1);const{tr:v,newPosition:_}=this._insertText(p.tr,h,s,i,e);s=_,g.dispatch(v)}})}}};function Fc(e){const t=e.doc.content.size,{from:n,to:o}=e.selection;return n===0&&o===t}function Dc(e,t,n,{schema:o}){const r=o.marks[t];if(!r)return e;const i=[...n.activeMarks].find(s=>s.type.name===t);if(i){n.activeMarks.delete(i);const s=[...n.activeMarks];return e.setStoredMarks(s)}else{const s=r.create();return n.activeMarks.add(s),e.addStoredMark(s)}}function Mc(e,t){return[...t].some(n=>{for(const[o,r]of Object.entries(bt))if(o===e&&r.includes(n.type.name))return!0;return!1})}function Rc(e,t){return e.startsWith("*")?t.length>0&&/^\S/.test(t):!0}function Uc(e){if(ye())return;let t;e.mixin({mounted(){if(this.$options.name!=="k-header")return;const n=this.$children.find(r=>r.$options.name==="k-button-group");if(!n)return;const o=e.extend(Kn);t=new o({parent:this}),t.$mount(),n.$el.before(t.$el)},beforeDestroy(){this.$options.name==="k-header"&&t&&(t.$destroy(),t=void 0)}})}window.panel.plugin("johannschopplich/copilot",{viewButtons:{copilot:Kn},components:{"k-copilot-prompt-dialog":vc},sections:{copilot:Ic},fields:{},textareaButtons:Tc,writerMarks:Lc,icons:Oc,use:[Uc]})})();

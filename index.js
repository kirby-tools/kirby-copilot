var Jd=Object.defineProperty;var Xi=v=>{throw TypeError(v)};var Vd=(v,T,re)=>T in v?Jd(v,T,{enumerable:!0,configurable:!0,writable:!0,value:re}):v[T]=re;var _e=(v,T,re)=>Vd(v,typeof T!="symbol"?T+"":T,re),Kd=(v,T,re)=>T.has(v)||Xi("Cannot "+re);var At=(v,T,re)=>(Kd(v,T,"read from private field"),re?re.call(v):T.get(v)),Qi=(v,T,re)=>T.has(v)?Xi("Cannot add the same private member more than once"):T instanceof WeakSet?T.add(v):T.set(v,re);(function(){"use strict";const v=window.Vue;function T(){return window.panel}function re(){return T().api}const dt=()=>window.panel.plugins.viewButtons!==void 0;function es(){return dt()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):T().app.$store}function yn(){const t=T(),e=es(),n=dt();if(n&&!("diff"in t.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const r=X(n?()=>t.content.version("changes"):()=>e.getters["content/values"]()),o=X(n?()=>t.content.diff():()=>e.getters["content/changes"]()),i=X(n?()=>t.content.hasDiff():()=>e.getters["content/hasChanges"]()),s=n?t.content:new Proxy({},{get(){return()=>{}}});return{content:s,currentContent:r,contentChanges:o,hasChanges:i,update:async(l,c=!0)=>{if(!n&&l)for(const[f,p]of Object.entries(l))e.dispatch("content/update",[f,p]);const u=s.merge(l);c&&await s.save(u)}}}function ts(){const t=T();function e(n){return!n||typeof n=="string"?n:n[t.translation.code]??Object.values(n)[0]}return{t:e}}function ns(){const t=re();return{load:({parent:n,name:r})=>t.get(`${n}/sections/${r}`)}}const rs={error:0,warn:1,log:2,info:3,success:3};function os(t){const e=new is;return new Proxy({},{get(n,r){return(...o)=>{e.log({level:rs[r],type:r,tag:t,args:o})}}})}var is=class{constructor(){_e(this,"defaultColor","#7f8c8d");_e(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});_e(this,"typeColorMap",{success:"#2ecc71"})}log(t){const e=ss(t.level),n=t.type==="log"?"":t.type,r=t.tag||"",o=`
background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),i=`%c${[r,n].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?e(`${i}%c ${t.args[0]}`,o,"",...t.args.slice(1)):e(i,o,...t.args)}};function ss(t){return t<1?console.error:console.log}const Dt=[],vn=new Map;async function as(t){if(!Array.isArray(t))throw new TypeError(`Expected an array, got ${typeof t}`);for(const e of t)Dt.some(n=>n.filename===e.filename)||Dt.push(e)}function wr(t){if(Dt.length===0)throw new Error("Plugin assets not registered");const e=Dt.find(n=>n.filename===t);if(!e)throw new Error(`Plugin asset "${t}" not found`);return e}async function Oe(t){if(t.endsWith(".js")||(t+=".js"),vn.has(t))return vn.get(t);const e=await import(wr(t).url);return vn.set(t,e),e}const X=v.computed;v.customRef,v.defineAsyncComponent,v.defineComponent,v.effectScope,v.getCurrentInstance;const ls=v.getCurrentScope;v.h,v.inject,v.isProxy,v.isReactive,v.isReadonly,v.isRef,v.isShallow,v.markRaw;const cs=v.nextTick;v.onActivated,v.onBeforeMount;const us=v.onBeforeUnmount;v.onBeforeUpdate,v.onDeactivated,v.onErrorCaptured;const fs=v.onMounted;v.onRenderTracked,v.onRenderTriggered;const ps=v.onScopeDispose;v.onServerPrefetch,v.onUnmounted,v.onUpdated,v.provide,v.proxyRefs,v.reactive,v.readonly;const S=v.ref;v.shallowReactive,v.shallowReadonly,v.shallowRef,v.toRaw,v.toRef,v.toRefs,v.triggerRef;const bn=v.unref;v.useAttrs,v.useCssModule,v.useCssVars,v.useListeners,v.useSlots;const _n=v.watch;v.watchEffect,v.watchPostEffect,v.watchSyncEffect;const kn={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible":"License key invalid for this plugin version","modal.error.upgradeable":"License key invalid for this plugin version. Upgrade now on https://hub.kirby.tools.","modal.error.activated":"License key already activated",activate:"Activate",activated:"Plugin activated",buy:"Buy a license",upgrade:"Upgrade"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.upgradeable":"Lizenzschlüssel ungültig für diese Plugin-Version. Aktualisiere jetzt auf https://hub.kirby.tools.","modal.error.activated":"Lizenzschlüssel bereits aktiviert",activate:"Aktivieren",activated:"Plugin aktiviert",buy:"Lizenz kaufen",upgrade:"Upgrade"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible":"Clé de licence invalide pour cette version du plugin","modal.error.upgradeable":"Clé de licence invalide pour cette version du plugin. Mettez à niveau maintenant sur https://hub.kirby.tools.","modal.error.activated":"Clé de licence déjà activée",activate:"Activer",activated:"Plugin activé",buy:"Acheter une licence",upgrade:"Upgrade"},nl:{"modal.info":"Bedankt voor het kopen van {label}! Voer je e-mailadres en bestelnummer in om je licentie te activeren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Vind je bestelnummer</a> op Lemon Squeezy of <a href="mailto:hello@kirby.tools">neem contact met ons op</a> als je het niet kunt vinden.',"modal.error.required.fields":"E-mailadres en bestelnummer zijn verplicht","modal.error.invalid.unauthorized":"E-mailadres of bestelnummer is onjuist","modal.error.invalid.licenseKey":"Licentiesleutel ongeldig voor dit plug-in","modal.error.incompatible":"Licentiesleutel ongeldig voor deze plug-inversie","modal.error.upgradeable":"Licentiesleutel ongeldig voor deze plug-inversie. Upgrade nu op https://hub.kirby.tools.","modal.error.activated":"Licentiesleutel al geactiveerd",activate:"Activeren",activated:"Plugin geactiveerd",buy:"Koop een licentie",upgrade:"Upgrade"}},ds=["localhost","127.0.0.1","[::1]"],hs=["local","test","ddev.site"];function Me(t="",e){var o;const n=window.panel.translation.code,r=((o=kn==null?void 0:kn[n])==null?void 0:o[t])??t;return e?ms(r,e):r}function ms(t,e,n){return t.replace(/\{(\w+)\}/g,(r,o)=>e[o]||o)}function gs(){const{hostname:t}=window.location,e=ds.includes(t),n=hs.some(r=>t.endsWith(`.${r}`));return e||n}const Sr={Unauthorized:"modal.error.invalid.unauthorized","License key not valid for this plugin":"modal.error.invalid.licenseKey","License key not valid for this plugin version":"modal.error.incompatible","License key not valid for this plugin version, please upgrade your license":"modal.error.upgradeable","License key already activated":"modal.error.activated"};function ys(t){const e=T();return{isLocalhost:gs(),assertActivationIntegrity:async({component:i,licenseStatus:s})=>{if(bn(s)==="active")return;const a=bn(i);if(!(a!=null&&a.$el)||window.getComputedStyle(a.$el).display==="none"||window.getComputedStyle(a.$el).visibility==="hidden"||window.getComputedStyle(a.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let i=!1;const{label:s}=t,a={info:{type:"info",text:Me("modal.info",{label:s})},email:{label:e.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:Me("modal.fields.orderId.help",{label:s})}};return new Promise(l=>{e.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:Me("activate",{label:s})},fields:a},on:{close:()=>{l({isLicenseActive:i})},submit:async c=>{i=await vs(c,t),i&&(e.dialog.close(),e.notification.success(Me("activated")))}}})})}}}async function vs(t,e){const n=T(),{email:r,orderId:o}=t;if(!r||!o)return n.notification.error(Me("modal.error.required.fields")),!1;try{const i=await n.api.post(`${e.apiNamespace}/activate`,{email:r,orderId:Number(o)});if((i==null?void 0:i.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(i){const s=i.message;return n.notification.error(Sr[s]?Me(Sr[s]):s),!1}}const bs=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(t){const e=t,{openLicenseModal:n,assertActivationIntegrity:r}=ys({label:e.label,apiNamespace:e.apiNamespace}),o=S(e.licenseStatus),i=S();fs(()=>{r({component:i,licenseStatus:e.licenseStatus})});async function s(){const{isLicenseActive:a}=await n();a&&window.location.reload()}return{__sfc:!0,props:e,openLicenseModal:n,assertActivationIntegrity:r,currentLicenseStatus:o,licenseButtonGroup:i,handleRegistration:s,t:Me}}});function qe(t,e,n,r,o,i,s,a){var l=typeof t=="function"?t.options:t;return e&&(l.render=e,l.staticRenderFns=n,l._compiled=!0),i&&(l._scopeId="data-v-"+i),{exports:t,options:l}}var _s=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return r.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:r.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":e.pricingUrl,target:"_blank",text:r.currentLicenseStatus==="upgradeable"?r.t("upgrade"):r.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:r.t("activate")},on:{click:function(o){return r.handleRegistration()}}})],1):e._e()},ks=[],ws=qe(bs,_s,ks,!1,null,null);const zr=ws.exports,Ss="__copilot__/context",zs="__copilot__/model-fields",xs="__copilot__/fieldsets",Os="__copilot__/proxy",Es="__KIRBY_COPILOT_PROXY__",wn=["anthropic","google","mistral","openai"],Ts={none:{anthropic:void 0,openai:"none","openai:gpt-5":"minimal","openai:gpt-5-mini":"minimal",google:"low","google:gemini-3-flash-preview":"minimal","google:gemini-3-flash":"minimal"},low:{anthropic:8e3,openai:"low",google:"low"},medium:{anthropic:16e3,openai:"medium",google:"medium","google:gemini-3-pro-preview":"high","google:gemini-3-pro":"high"},high:{anthropic:32e3,openai:"high",google:"high"}},$s="low",Cs={anthropic:"claude-haiku-4-5-20251001",google:"gemini-3-flash-preview",mistral:"mistral-small-latest",openai:"gpt-5-nano"},Ps=100,Is=4e3,Ns=500,Sn=`
You are a content assistant.

When <response_format> is provided, format your response as:
- "text": Plain text only, no formatting syntax.
- "markdown": Raw Markdown, no code fence wrappers.
- "rich-text": Use double newlines to separate paragraphs. For inline formatting, use HTML tags (<strong>, <em>, <code>, <a href="...">, etc.). Do NOT wrap paragraphs in <p> tags.

When <selection> is provided, use it as context for your response. Preserve any formatting (bold, italic, links, etc.) present in the selection unless the task explicitly requires different formatting.
`,As=`
You are a writing assistant providing inline autocompletions.

RULES:
- Output ONLY the continuation text, NEVER repeat input
- Keep completions brief (1-2 sentences max)
- Match the existing tone and style
- No explanations or meta-commentary

FORMAT:
- If given <prefix> and <suffix> tags, insert text that bridges them naturally
- Otherwise, continue the text directly

EXAMPLE:
Input: "The quick brown fox"
Output: " jumps over the lazy dog."
`,zn=["image/gif","image/jpeg","image/png","image/webp"],Ds=[...zn,"application/pdf"],Ms=50*1024*1024,Ge=["error","warn","info","debug"],xr="warn",Or="kirby$copilot$";class He extends Error{}const Rs=new Set(["br","hr","img","wbr"]);function Er(t,{responseFormat:e,selection:n}={}){return[e&&`<response_format>${e}</response_format>`,n&&`<selection>
${n}
</selection>`,t].filter(Boolean).join(`

`)}function Ls(t){return t.startsWith("gpt-5")||t.startsWith("gemini-2.5")||t.startsWith("gemini-3")||/^claude-[^-]+-4/.test(t)||t.startsWith("magistral")}function Fs(){return t=>{if(!t)return null;const e=t.indexOf("<"),n=t.indexOf(`
`);if(e===-1&&n===-1)return t;const r=e===-1?n:n===-1?e:Math.min(e,n);return r>0?t.slice(0,r):r===n?t.match(/^\n+/)[0]:Zs(t)}}function Zs(t){if(!/^<\/?[a-z]/i.test(t))return t.length>1?"<":null;if(t.startsWith("</")){const s=t.indexOf(">");return s===-1?null:t.slice(0,s+1)}const e=t.match(/^<([a-z][a-z0-9-]*)(?:\s[^>]*)?(\/?)>/i);if(!e)return null;const[n,r,o]=e,i=r.toLowerCase();return o||Rs.has(i)?n:js(t,i,n.length)}function js(t,e,n){const r=t.toLowerCase(),o=`<${e}`,i=`</${e}>`;let s=1,a=n;for(;s>0;){const l=r.indexOf(o,a),c=r.indexOf(i,a);if(c===-1)return null;if(l!==-1&&l<c)s++,a=l+o.length;else{if(s--,s===0)return t.slice(0,c+i.length);a=c+i.length}}return null}let ht;async function Bs(t){const e=await Js(),n=await t.arrayBuffer(),r=await e.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:r.numPages},(i,s)=>Us(r,s+1)))).map(i=>i.replace(/\s+/g," ")).join(`
`)}async function Us(t,e){return(await(await t.getPage(e)).getTextContent()).items.filter(o=>o.str!=null).map(o=>o.str).join(" ")}async function Js(){if(ht)return ht;ht=await Oe("pdfjs");const t=wr("pdfjs.worker.js");return ht.GlobalWorkerOptions.workerSrc=t.url,ht}const Tr=/\{(\w+)\}/g;function $r(t,e,n){return t.replace(Tr,(r,o)=>e[o.toLowerCase()]||((typeof n=="function"?n(o):n)??o))}async function Vs({accept:t="*",multiple:e=!0}={}){const n=document.createElement("input");return n.type="file",n.classList.add("sr-only"),n.value=null,n.accept=t,n.multiple=e,n.click(),new Promise(r=>{n.addEventListener("change",o=>{var i;r([...((i=o.target)==null?void 0:i.files)??[]]),n.remove()},{once:!0})})}async function Ks(t,e){const n=await Ws(t);return await qs(n,t.type,e)}async function Ws(t,e={}){if(!t.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${t.type}`);const n=new Image,r=URL.createObjectURL(t);e.crossOrigin&&(n.crossOrigin=e.crossOrigin);try{return await new Promise((i,s)=>{n.addEventListener("load",()=>{i(n)}),n.addEventListener("error",s),n.src=r})}finally{URL.revokeObjectURL(r)}}async function qs(t,e,n){if(!t.complete||!t.naturalWidth)throw new Error("Image has not been properly loaded");if(!e.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${e}`);const r=document.createElement("canvas"),o=r.getContext("2d"),i=Math.min(1,n/Math.max(t.width,t.height)),s=Math.round(t.width*i),a=Math.round(t.height*i);r.width=s,r.height=a,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(t,0,0,s,a);const l=await new Promise(c=>{r.toBlob(c,e)});if(!l)throw new Error("Failed to convert canvas to Blob");return l}function Cr(){const t=T(),{currentContent:e}=yn(),n={...e.value,title:t.view.title};return Object.fromEntries(Object.entries(n).map(([r,o])=>[r,Array.isArray(o)||typeof o=="object"&&o!==null?JSON.stringify(Gs(o)?Hs(o):o):o]))}function Gs(t){return Array.isArray(t)&&t.length>0&&t.every(e=>typeof e=="object"&&e!==null&&"id"in e&&"type"in e&&"isHidden"in e&&"content"in e)}function Hs(t){return t.map(({id:e,isHidden:n,...r})=>r)}let Ys;function Xs(){return Ys??(Ys=os("copilot"))}let Mt,mt;function ke(){return Mt?Promise.resolve(Mt):mt||(mt=window.panel.api.get(Ss).then(t=>(as(t.assets),Mt=t,mt=void 0,Mt)),mt)}async function Rt({userPrompt:t,systemPrompt:e,output:n,responseFormat:r,files:o=[],logLevel:i=1,abortSignal:s}){const a=Xs(),{model:l,providerOptions:c}=await Pr(),{AISDKError:u,streamText:f,smoothStream:p}=await Oe("ai"),{userPromptWithContext:d,imageByteArrays:m,pdfByteArrays:g}=await Qs({userPrompt:t,files:o});i>1&&(a.info("System prompt:",e),a.info("User prompt with context:",d));const y=m.length>0||g.length>0;return f({model:l,providerOptions:c,output:n,system:e||void 0,...y?{messages:[{role:"user",content:[{type:"text",text:d},...m.map(b=>({type:"image",image:b})),...g.map(b=>({type:"file",data:b,mediaType:"application/pdf"}))]}]}:{prompt:d},...!n&&{experimental_transform:p({chunking:r==="rich-text"?Fs():"line"})},abortSignal:s,onError({error:b}){if(u.isInstance(b))throw b;console.error("Unexpected error during text streaming:",b)}})}async function Pr({forCompletion:t=!1}={}){const e=T();let{config:n}=await ke();if(!n.provider||!wn.includes(n.provider))throw new He(`Unsupported provider "${n.provider}". Supported providers: ${wn.join(", ")}. Check "johannschopplich.copilot.provider" in your Kirby config.`);const{createAnthropic:r,createGoogleGenerativeAI:o,createMistral:i,createOpenAI:s}=await Oe("ai"),a=n.provider,l=n.providers[a]??{},c={anthropic:r,google:o,mistral:i,openai:s}[a];if(!l.hasApiKey)throw new He(`Missing API key for the "${a}" provider. Add "apiKey" to "johannschopplich.copilot.providers.${a}" in your Kirby config.`);const u=(k,z)=>fetch(`${e.api.endpoint}/${Os}?provider=${a}`,{...z,credentials:"same-origin",headers:{...z.headers,"X-CSRF":e.api.csrf,"X-Proxy-Target":k}}),f=c({baseUrl:l.baseUrl||void 0,apiKey:Es,fetch:u,...a==="anthropic"?{headers:{"anthropic-dangerous-direct-browser-access":"true"}}:void 0}),p=t?l.completionModel||Cs[a]:l.model;if(!p)throw new He(`Missing ${t?"completionModel":"model"} for the "${a}" provider. Add it to "johannschopplich.copilot.providers.${a}" in your Kirby config.`);const d=f.languageModel(p),m=t?"none":n.reasoningEffort??$s,g=Ts[m],y=Ls(p)?(g==null?void 0:g[`${a}:${p}`])??(g==null?void 0:g[a]):void 0,b={...a==="anthropic"&&y&&{anthropic:{thinking:{type:"enabled",budgetTokens:y}}},...a==="openai"&&y&&{openai:{reasoningEffort:y}},...a==="google"&&y&&{google:{thinkingConfig:{thinkingLevel:y}}}};return typeof l.options=="object"&&l.options!==null&&(b[a]={...b[a],...l.options}),{model:d,providerOptions:Object.keys(b).length>0?b:void 0}}async function Qs({userPrompt:t,files:e=[]}){const n=Cr();let r=$r(t,n);const o=e.filter(u=>u.type.startsWith("image/")),i=e.filter(u=>u.type==="application/pdf"),a=i.reduce((u,f)=>u+f.size,0)<=Ms;if(!a&&i.length>0){const u=await Promise.all(i.map(Bs));r+=`

${u.map((f,p)=>`<pdf_document_${p+1}>
${f}
</pdf_document_${p+1}>`).join(`

`)}`}const l=await Promise.all(o.map(async u=>{const p=await(await Ks(u,2048)).arrayBuffer();return new Uint8Array(p)})),c=a?await Promise.all(i.map(async u=>{const f=await u.arrayBuffer();return new Uint8Array(f)})):[];return{userPromptWithContext:r,imageByteArrays:l,pdfByteArrays:c}}function h(t,e,n){function r(a,l){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:l,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(t))return;a._zod.traits.add(t),e(a,l);const c=s.prototype,u=Object.keys(c);for(let f=0;f<u.length;f++){const p=u[f];p in a||(a[p]=c[p].bind(a))}}const o=(n==null?void 0:n.Parent)??Object;class i extends o{}Object.defineProperty(i,"name",{value:t});function s(a){var l;const c=n!=null&&n.Parent?new i:this;r(c,a),(l=c._zod).deferred??(l.deferred=[]);for(const u of c._zod.deferred)u();return c}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>{var l,c;return n!=null&&n.Parent&&a instanceof n.Parent?!0:(c=(l=a==null?void 0:a._zod)==null?void 0:l.traits)==null?void 0:c.has(t)}}),Object.defineProperty(s,"name",{value:t}),s}class Ye extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Ir extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const Nr={};function Ee(t){return Nr}function Ar(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,o])=>e.indexOf(+r)===-1).map(([r,o])=>o)}function xn(t,e){return typeof e=="bigint"?e.toString():e}function On(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function En(t){return t==null}function Tn(t){const e=t.startsWith("^")?1:0,n=t.endsWith("$")?t.length-1:t.length;return t.slice(e,n)}function ea(t,e){const n=(t.toString().split(".")[1]||"").length,r=e.toString();let o=(r.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(r)){const l=r.match(/\d?e-(\d?)/);l!=null&&l[1]&&(o=Number.parseInt(l[1]))}const i=n>o?n:o,s=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}const Dr=Symbol("evaluating");function P(t,e,n){let r;Object.defineProperty(t,e,{get(){if(r!==Dr)return r===void 0&&(r=Dr,r=n()),r},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function Re(t,e,n){Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Te(...t){const e={};for(const n of t){const r=Object.getOwnPropertyDescriptors(n);Object.assign(e,r)}return Object.defineProperties({},e)}function Mr(t){return JSON.stringify(t)}function ta(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const Rr="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function Lt(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const na=On(()=>{var t;if(typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)!=null&&t.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Xe(t){if(Lt(t)===!1)return!1;const e=t.constructor;if(e===void 0||typeof e!="function")return!0;const n=e.prototype;return!(Lt(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function Lr(t){return Xe(t)?{...t}:Array.isArray(t)?[...t]:t}const ra=new Set(["string","number","symbol"]);function Qe(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $e(t,e,n){const r=new t._zod.constr(e??t._zod.def);return(!e||n!=null&&n.parent)&&(r._zod.parent=t),r}function _(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function oa(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const ia={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function sa(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const i=Te(t._zod.def,{get shape(){const s={};for(const a in e){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);e[a]&&(s[a]=n.shape[a])}return Re(this,"shape",s),s},checks:[]});return $e(t,i)}function aa(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const i=Te(t._zod.def,{get shape(){const s={...t._zod.def.shape};for(const a in e){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);e[a]&&delete s[a]}return Re(this,"shape",s),s},checks:[]});return $e(t,i)}function la(t,e){if(!Xe(e))throw new Error("Invalid input to extend: expected a plain object");const n=t._zod.def.checks;if(n&&n.length>0){const i=t._zod.def.shape;for(const s in e)if(Object.getOwnPropertyDescriptor(i,s)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const o=Te(t._zod.def,{get shape(){const i={...t._zod.def.shape,...e};return Re(this,"shape",i),i}});return $e(t,o)}function ca(t,e){if(!Xe(e))throw new Error("Invalid input to safeExtend: expected a plain object");const n=Te(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e};return Re(this,"shape",r),r}});return $e(t,n)}function ua(t,e){const n=Te(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e._zod.def.shape};return Re(this,"shape",r),r},get catchall(){return e._zod.def.catchall},checks:[]});return $e(t,n)}function fa(t,e,n){const o=e._zod.def.checks;if(o&&o.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const s=Te(e._zod.def,{get shape(){const a=e._zod.def.shape,l={...a};if(n)for(const c in n){if(!(c in a))throw new Error(`Unrecognized key: "${c}"`);n[c]&&(l[c]=t?new t({type:"optional",innerType:a[c]}):a[c])}else for(const c in a)l[c]=t?new t({type:"optional",innerType:a[c]}):a[c];return Re(this,"shape",l),l},checks:[]});return $e(e,s)}function pa(t,e,n){const r=Te(e._zod.def,{get shape(){const o=e._zod.def.shape,i={...o};if(n)for(const s in n){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(i[s]=new t({type:"nonoptional",innerType:o[s]}))}else for(const s in o)i[s]=new t({type:"nonoptional",innerType:o[s]});return Re(this,"shape",i),i}});return $e(e,r)}function et(t,e=0){var n;if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(((n=t.issues[r])==null?void 0:n.continue)!==!0)return!0;return!1}function tt(t,e){return e.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(t),n})}function Ft(t){return typeof t=="string"?t:t==null?void 0:t.message}function Ce(t,e,n){var o,i,s,a,l,c;const r={...t,path:t.path??[]};if(!t.message){const u=Ft((s=(i=(o=t.inst)==null?void 0:o._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,t))??Ft((a=e==null?void 0:e.error)==null?void 0:a.call(e,t))??Ft((l=n.customError)==null?void 0:l.call(n,t))??Ft((c=n.localeError)==null?void 0:c.call(n,t))??"Invalid input";r.message=u}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}function $n(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function gt(...t){const[e,n,r]=t;return typeof e=="string"?{message:e,code:"custom",input:n,inst:r}:{...e}}const Fr=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,xn,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Zr=h("$ZodError",Fr),jr=h("$ZodError",Fr,{Parent:Error});function da(t,e=n=>n.message){const n={},r=[];for(const o of t.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(e(o))):r.push(e(o));return{formErrors:r,fieldErrors:n}}function ha(t,e=n=>n.message){const n={_errors:[]},r=o=>{for(const i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(s=>r({issues:s}));else if(i.code==="invalid_key")r({issues:i.issues});else if(i.code==="invalid_element")r({issues:i.issues});else if(i.path.length===0)n._errors.push(e(i));else{let s=n,a=0;for(;a<i.path.length;){const l=i.path[a];a===i.path.length-1?(s[l]=s[l]||{_errors:[]},s[l]._errors.push(e(i))):s[l]=s[l]||{_errors:[]},s=s[l],a++}}};return r(t),n}const Cn=t=>(e,n,r,o)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},s=e._zod.run({value:n,issues:[]},i);if(s instanceof Promise)throw new Ye;if(s.issues.length){const a=new((o==null?void 0:o.Err)??t)(s.issues.map(l=>Ce(l,i,Ee())));throw Rr(a,o==null?void 0:o.callee),a}return s.value},Pn=t=>async(e,n,r,o)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:n,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new((o==null?void 0:o.Err)??t)(s.issues.map(l=>Ce(l,i,Ee())));throw Rr(a,o==null?void 0:o.callee),a}return s.value},Zt=t=>(e,n,r)=>{const o=r?{...r,async:!1}:{async:!1},i=e._zod.run({value:n,issues:[]},o);if(i instanceof Promise)throw new Ye;return i.issues.length?{success:!1,error:new(t??Zr)(i.issues.map(s=>Ce(s,o,Ee())))}:{success:!0,data:i.value}},ma=Zt(jr),jt=t=>async(e,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let i=e._zod.run({value:n,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new t(i.issues.map(s=>Ce(s,o,Ee())))}:{success:!0,data:i.value}},ga=jt(jr),ya=t=>(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Cn(t)(e,n,o)},va=t=>(e,n,r)=>Cn(t)(e,n,r),ba=t=>async(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Pn(t)(e,n,o)},_a=t=>async(e,n,r)=>Pn(t)(e,n,r),ka=t=>(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Zt(t)(e,n,o)},wa=t=>(e,n,r)=>Zt(t)(e,n,r),Sa=t=>async(e,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return jt(t)(e,n,o)},za=t=>async(e,n,r)=>jt(t)(e,n,r),xa=/^[cC][^\s-]{8,}$/,Oa=/^[0-9a-z]+$/,Ea=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Ta=/^[0-9a-vA-V]{20}$/,$a=/^[A-Za-z0-9]{27}$/,Ca=/^[a-zA-Z0-9_-]{21}$/,Pa=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Ia=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Br=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Na=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Aa="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Da(){return new RegExp(Aa,"u")}const Ma=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ra=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,La=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Fa=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Za=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Ur=/^[A-Za-z0-9_-]*$/,ja=/^\+[1-9]\d{6,14}$/,Jr="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Ba=new RegExp(`^${Jr}$`);function Vr(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Ua(t){return new RegExp(`^${Vr(t)}$`)}function Ja(t){const e=Vr({precision:t.precision}),n=["Z"];t.local&&n.push(""),t.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${e}(?:${n.join("|")})`;return new RegExp(`^${Jr}T(?:${r})$`)}const Va=t=>{const e=t?`[\\s\\S]{${(t==null?void 0:t.minimum)??0},${(t==null?void 0:t.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},Ka=/^-?\d+$/,Kr=/^-?\d+(?:\.\d+)?$/,Wa=/^(?:true|false)$/i,qa=/^[^A-Z]*$/,Ga=/^[^a-z]*$/,ne=h("$ZodCheck",(t,e)=>{var n;t._zod??(t._zod={}),t._zod.def=e,(n=t._zod).onattach??(n.onattach=[])}),Wr={number:"number",bigint:"bigint",object:"date"},qr=h("$ZodCheckLessThan",(t,e)=>{ne.init(t,e);const n=Wr[typeof e.value];t._zod.onattach.push(r=>{const o=r._zod.bag,i=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:n,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Gr=h("$ZodCheckGreaterThan",(t,e)=>{ne.init(t,e);const n=Wr[typeof e.value];t._zod.onattach.push(r=>{const o=r._zod.bag,i=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:n,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Ha=h("$ZodCheckMultipleOf",(t,e)=>{ne.init(t,e),t._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=e.value)}),t._zod.check=n=>{if(typeof n.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%e.value===BigInt(0):ea(n.value,e.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:e.value,input:n.value,inst:t,continue:!e.abort})}}),Ya=h("$ZodCheckNumberFormat",(t,e)=>{var s;ne.init(t,e),e.format=e.format||"float64";const n=(s=e.format)==null?void 0:s.includes("int"),r=n?"int":"number",[o,i]=ia[e.format];t._zod.onattach.push(a=>{const l=a._zod.bag;l.format=e.format,l.minimum=o,l.maximum=i,n&&(l.pattern=Ka)}),t._zod.check=a=>{const l=a.value;if(n){if(!Number.isInteger(l)){a.issues.push({expected:r,format:e.format,code:"invalid_type",continue:!1,input:l,inst:t});return}if(!Number.isSafeInteger(l)){l>0?a.issues.push({input:l,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort}):a.issues.push({input:l,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort});return}}l<o&&a.issues.push({origin:"number",input:l,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),l>i&&a.issues.push({origin:"number",input:l,code:"too_big",maximum:i,inclusive:!0,inst:t,continue:!e.abort})}}),Xa=h("$ZodCheckMaxLength",(t,e)=>{var n;ne.init(t,e),(n=t._zod.def).when??(n.when=r=>{const o=r.value;return!En(o)&&o.length!==void 0}),t._zod.onattach.push(r=>{const o=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(r._zod.bag.maximum=e.maximum)}),t._zod.check=r=>{const o=r.value;if(o.length<=e.maximum)return;const s=$n(o);r.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),Qa=h("$ZodCheckMinLength",(t,e)=>{var n;ne.init(t,e),(n=t._zod.def).when??(n.when=r=>{const o=r.value;return!En(o)&&o.length!==void 0}),t._zod.onattach.push(r=>{const o=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(r._zod.bag.minimum=e.minimum)}),t._zod.check=r=>{const o=r.value;if(o.length>=e.minimum)return;const s=$n(o);r.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),el=h("$ZodCheckLengthEquals",(t,e)=>{var n;ne.init(t,e),(n=t._zod.def).when??(n.when=r=>{const o=r.value;return!En(o)&&o.length!==void 0}),t._zod.onattach.push(r=>{const o=r._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=r=>{const o=r.value,i=o.length;if(i===e.length)return;const s=$n(o),a=i>e.length;r.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:t,continue:!e.abort})}}),Bt=h("$ZodCheckStringFormat",(t,e)=>{var n,r;ne.init(t,e),t._zod.onattach.push(o=>{const i=o._zod.bag;i.format=e.format,e.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(e.pattern))}),e.pattern?(n=t._zod).check??(n.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(r=t._zod).check??(r.check=()=>{})}),tl=h("$ZodCheckRegex",(t,e)=>{Bt.init(t,e),t._zod.check=n=>{e.pattern.lastIndex=0,!e.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),nl=h("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=qa),Bt.init(t,e)}),rl=h("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=Ga),Bt.init(t,e)}),ol=h("$ZodCheckIncludes",(t,e)=>{ne.init(t,e);const n=Qe(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${n}`:n);e.pattern=r,t._zod.onattach.push(o=>{const i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),il=h("$ZodCheckStartsWith",(t,e)=>{ne.init(t,e);const n=new RegExp(`^${Qe(e.prefix)}.*`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),t._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:t,continue:!e.abort})}}),sl=h("$ZodCheckEndsWith",(t,e)=>{ne.init(t,e);const n=new RegExp(`.*${Qe(e.suffix)}$`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),t._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:t,continue:!e.abort})}}),al=h("$ZodCheckOverwrite",(t,e)=>{ne.init(t,e),t._zod.check=n=>{n.value=e.tx(n.value)}});class ll{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(s=>s),o=Math.min(...r.map(s=>s.length-s.trimStart().length)),i=r.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(const s of i)this.content.push(s)}compile(){const e=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new e(...n,o.join(`
`))}}const cl={major:4,minor:3,patch:4},R=h("$ZodType",(t,e)=>{var o;var n;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=cl;const r=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&r.unshift(t);for(const i of r)for(const s of i._zod.onattach)s(t);if(r.length===0)(n=t._zod).deferred??(n.deferred=[]),(o=t._zod.deferred)==null||o.push(()=>{t._zod.run=t._zod.parse});else{const i=(a,l,c)=>{let u=et(a),f;for(const p of l){if(p._zod.def.when){if(!p._zod.def.when(a))continue}else if(u)continue;const d=a.issues.length,m=p._zod.check(a);if(m instanceof Promise&&(c==null?void 0:c.async)===!1)throw new Ye;if(f||m instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await m,a.issues.length!==d&&(u||(u=et(a,d)))});else{if(a.issues.length===d)continue;u||(u=et(a,d))}}return f?f.then(()=>a):a},s=(a,l,c)=>{if(et(a))return a.aborted=!0,a;const u=i(l,r,c);if(u instanceof Promise){if(c.async===!1)throw new Ye;return u.then(f=>t._zod.parse(f,c))}return t._zod.parse(u,c)};t._zod.run=(a,l)=>{if(l.skipChecks)return t._zod.parse(a,l);if(l.direction==="backward"){const u=t._zod.parse({value:a.value,issues:[]},{...l,skipChecks:!0});return u instanceof Promise?u.then(f=>s(f,a,l)):s(u,a,l)}const c=t._zod.parse(a,l);if(c instanceof Promise){if(l.async===!1)throw new Ye;return c.then(u=>i(u,r,l))}return i(c,r,l)}}P(t,"~standard",()=>({validate:i=>{var s;try{const a=ma(t,i);return a.success?{value:a.data}:{issues:(s=a.error)==null?void 0:s.issues}}catch{return ga(t,i).then(l=>{var c;return l.success?{value:l.data}:{issues:(c=l.error)==null?void 0:c.issues}})}},vendor:"zod",version:1}))}),In=h("$ZodString",(t,e)=>{var n;R.init(t,e),t._zod.pattern=[...((n=t==null?void 0:t._zod.bag)==null?void 0:n.patterns)??[]].pop()??Va(t._zod.bag),t._zod.parse=(r,o)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),A=h("$ZodStringFormat",(t,e)=>{Bt.init(t,e),In.init(t,e)}),ul=h("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Ia),A.init(t,e)}),fl=h("$ZodUUID",(t,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Br(r))}else e.pattern??(e.pattern=Br());A.init(t,e)}),pl=h("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Na),A.init(t,e)}),dl=h("$ZodURL",(t,e)=>{A.init(t,e),t._zod.check=n=>{try{const r=n.value.trim(),o=new URL(r);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:n.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:n.value,inst:t,continue:!e.abort})),e.normalize?n.value=o.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:t,continue:!e.abort})}}}),hl=h("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Da()),A.init(t,e)}),ml=h("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Ca),A.init(t,e)}),gl=h("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=xa),A.init(t,e)}),yl=h("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Oa),A.init(t,e)}),vl=h("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Ea),A.init(t,e)}),bl=h("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Ta),A.init(t,e)}),_l=h("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=$a),A.init(t,e)}),kl=h("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=Ja(e)),A.init(t,e)}),wl=h("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=Ba),A.init(t,e)}),Sl=h("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=Ua(e)),A.init(t,e)}),zl=h("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Pa),A.init(t,e)}),xl=h("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Ma),A.init(t,e),t._zod.bag.format="ipv4"}),Ol=h("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Ra),A.init(t,e),t._zod.bag.format="ipv6",t._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:t,continue:!e.abort})}}}),El=h("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=La),A.init(t,e)}),Tl=h("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Fa),A.init(t,e),t._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[o,i]=r;if(!i)throw new Error;const s=Number(i);if(`${s}`!==i)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${o}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:t,continue:!e.abort})}}});function Hr(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const $l=h("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Za),A.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=n=>{Hr(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:t,continue:!e.abort})}});function Cl(t){if(!Ur.test(t))return!1;const e=t.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=e.padEnd(Math.ceil(e.length/4)*4,"=");return Hr(n)}const Pl=h("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Ur),A.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=n=>{Cl(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:t,continue:!e.abort})}}),Il=h("$ZodE164",(t,e)=>{e.pattern??(e.pattern=ja),A.init(t,e)});function Nl(t,e=null){try{const n=t.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}const Al=h("$ZodJWT",(t,e)=>{A.init(t,e),t._zod.check=n=>{Nl(n.value,e.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:t,continue:!e.abort})}}),Yr=h("$ZodNumber",(t,e)=>{R.init(t,e),t._zod.pattern=t._zod.bag.pattern??Kr,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...i?{received:i}:{}}),n}}),Dl=h("$ZodNumberFormat",(t,e)=>{Ya.init(t,e),Yr.init(t,e)}),Ml=h("$ZodBoolean",(t,e)=>{R.init(t,e),t._zod.pattern=Wa,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),n}}),Rl=h("$ZodUnknown",(t,e)=>{R.init(t,e),t._zod.parse=n=>n}),Ll=h("$ZodNever",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:t}),n)});function Xr(t,e,n){t.issues.length&&e.issues.push(...tt(n,t.issues)),e.value[n]=t.value}const Fl=h("$ZodArray",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),n;n.value=Array(o.length);const i=[];for(let s=0;s<o.length;s++){const a=o[s],l=e.element._zod.run({value:a,issues:[]},r);l instanceof Promise?i.push(l.then(c=>Xr(c,n,s))):Xr(l,n,s)}return i.length?Promise.all(i).then(()=>n):n}});function Ut(t,e,n,r,o){if(t.issues.length){if(o&&!(n in r))return;e.issues.push(...tt(n,t.issues))}t.value===void 0?n in r&&(e.value[n]=void 0):e.value[n]=t.value}function Qr(t){var r,o,i,s;const e=Object.keys(t.shape);for(const a of e)if(!((s=(i=(o=(r=t.shape)==null?void 0:r[a])==null?void 0:o._zod)==null?void 0:i.traits)!=null&&s.has("$ZodType")))throw new Error(`Invalid element at key "${a}": expected a Zod schema`);const n=oa(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}}function eo(t,e,n,r,o,i){const s=[],a=o.keySet,l=o.catchall._zod,c=l.def.type,u=l.optout==="optional";for(const f in e){if(a.has(f))continue;if(c==="never"){s.push(f);continue}const p=l.run({value:e[f],issues:[]},r);p instanceof Promise?t.push(p.then(d=>Ut(d,n,f,e,u))):Ut(p,n,f,e,u)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:i}),t.length?Promise.all(t).then(()=>n):n}const Zl=h("$ZodObject",(t,e)=>{R.init(t,e);const n=Object.getOwnPropertyDescriptor(e,"shape");if(!(n!=null&&n.get)){const a=e.shape;Object.defineProperty(e,"shape",{get:()=>{const l={...a};return Object.defineProperty(e,"shape",{value:l}),l}})}const r=On(()=>Qr(e));P(t._zod,"propValues",()=>{const a=e.shape,l={};for(const c in a){const u=a[c]._zod;if(u.values){l[c]??(l[c]=new Set);for(const f of u.values)l[c].add(f)}}return l});const o=Lt,i=e.catchall;let s;t._zod.parse=(a,l)=>{s??(s=r.value);const c=a.value;if(!o(c))return a.issues.push({expected:"object",code:"invalid_type",input:c,inst:t}),a;a.value={};const u=[],f=s.shape;for(const p of s.keys){const d=f[p],m=d._zod.optout==="optional",g=d._zod.run({value:c[p],issues:[]},l);g instanceof Promise?u.push(g.then(y=>Ut(y,a,p,c,m))):Ut(g,a,p,c,m)}return i?eo(u,c,a,l,r.value,t):u.length?Promise.all(u).then(()=>a):a}}),jl=h("$ZodObjectJIT",(t,e)=>{Zl.init(t,e);const n=t._zod.parse,r=On(()=>Qr(e)),o=p=>{var z;const d=new ll(["shape","payload","ctx"]),m=r.value,g=I=>{const E=Mr(I);return`shape[${E}]._zod.run({ value: input[${E}], issues: [] }, ctx)`};d.write("const input = payload.value;");const y=Object.create(null);let b=0;for(const I of m.keys)y[I]=`key_${b++}`;d.write("const newResult = {};");for(const I of m.keys){const E=y[I],N=Mr(I),W=p[I],U=((z=W==null?void 0:W._zod)==null?void 0:z.optout)==="optional";d.write(`const ${E} = ${g(I)};`),U?d.write(`
        if (${E}.issues.length) {
          if (${N} in input) {
            payload.issues = payload.issues.concat(${E}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${N}, ...iss.path] : [${N}]
            })));
          }
        }
        
        if (${E}.value === undefined) {
          if (${N} in input) {
            newResult[${N}] = undefined;
          }
        } else {
          newResult[${N}] = ${E}.value;
        }
        
      `):d.write(`
        if (${E}.issues.length) {
          payload.issues = payload.issues.concat(${E}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${N}, ...iss.path] : [${N}]
          })));
        }
        
        if (${E}.value === undefined) {
          if (${N} in input) {
            newResult[${N}] = undefined;
          }
        } else {
          newResult[${N}] = ${E}.value;
        }
        
      `)}d.write("payload.value = newResult;"),d.write("return payload;");const k=d.compile();return(I,E)=>k(p,I,E)};let i;const s=Lt,a=!Nr.jitless,c=a&&na.value,u=e.catchall;let f;t._zod.parse=(p,d)=>{f??(f=r.value);const m=p.value;return s(m)?a&&c&&(d==null?void 0:d.async)===!1&&d.jitless!==!0?(i||(i=o(e.shape)),p=i(p,d),u?eo([],m,p,d,f,t):p):n(p,d):(p.issues.push({expected:"object",code:"invalid_type",input:m,inst:t}),p)}});function to(t,e,n,r){for(const i of t)if(i.issues.length===0)return e.value=i.value,e;const o=t.filter(i=>!et(i));return o.length===1?(e.value=o[0].value,o[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:n,errors:t.map(i=>i.issues.map(s=>Ce(s,r,Ee())))}),e)}const Bl=h("$ZodUnion",(t,e)=>{R.init(t,e),P(t._zod,"optin",()=>e.options.some(o=>o._zod.optin==="optional")?"optional":void 0),P(t._zod,"optout",()=>e.options.some(o=>o._zod.optout==="optional")?"optional":void 0),P(t._zod,"values",()=>{if(e.options.every(o=>o._zod.values))return new Set(e.options.flatMap(o=>Array.from(o._zod.values)))}),P(t._zod,"pattern",()=>{if(e.options.every(o=>o._zod.pattern)){const o=e.options.map(i=>i._zod.pattern);return new RegExp(`^(${o.map(i=>Tn(i.source)).join("|")})$`)}});const n=e.options.length===1,r=e.options[0]._zod.run;t._zod.parse=(o,i)=>{if(n)return r(o,i);let s=!1;const a=[];for(const l of e.options){const c=l._zod.run({value:o.value,issues:[]},i);if(c instanceof Promise)a.push(c),s=!0;else{if(c.issues.length===0)return c;a.push(c)}}return s?Promise.all(a).then(l=>to(l,o,t,i)):to(a,o,t,i)}}),Ul=h("$ZodIntersection",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{const o=n.value,i=e.left._zod.run({value:o,issues:[]},r),s=e.right._zod.run({value:o,issues:[]},r);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([l,c])=>no(n,l,c)):no(n,i,s)}});function Nn(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Xe(t)&&Xe(e)){const n=Object.keys(e),r=Object.keys(t).filter(i=>n.indexOf(i)!==-1),o={...t,...e};for(const i of r){const s=Nn(t[i],e[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<t.length;r++){const o=t[r],i=e[r],s=Nn(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function no(t,e,n){const r=new Map;let o;for(const a of e.issues)if(a.code==="unrecognized_keys"){o??(o=a);for(const l of a.keys)r.has(l)||r.set(l,{}),r.get(l).l=!0}else t.issues.push(a);for(const a of n.issues)if(a.code==="unrecognized_keys")for(const l of a.keys)r.has(l)||r.set(l,{}),r.get(l).r=!0;else t.issues.push(a);const i=[...r].filter(([,a])=>a.l&&a.r).map(([a])=>a);if(i.length&&o&&t.issues.push({...o,keys:i}),et(t))return t;const s=Nn(e.value,n.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return t.value=s.data,t}const Jl=h("$ZodRecord",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{const o=n.value;if(!Xe(o))return n.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),n;const i=[],s=e.keyType._zod.values;if(s){n.value={};const a=new Set;for(const c of s)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){a.add(typeof c=="number"?c.toString():c);const u=e.valueType._zod.run({value:o[c],issues:[]},r);u instanceof Promise?i.push(u.then(f=>{f.issues.length&&n.issues.push(...tt(c,f.issues)),n.value[c]=f.value})):(u.issues.length&&n.issues.push(...tt(c,u.issues)),n.value[c]=u.value)}let l;for(const c in o)a.has(c)||(l=l??[],l.push(c));l&&l.length>0&&n.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:l})}else{n.value={};for(const a of Reflect.ownKeys(o)){if(a==="__proto__")continue;let l=e.keyType._zod.run({value:a,issues:[]},r);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof a=="string"&&Kr.test(a)&&l.issues.length&&l.issues.some(f=>f.code==="invalid_type"&&f.expected==="number")){const f=e.keyType._zod.run({value:Number(a),issues:[]},r);if(f instanceof Promise)throw new Error("Async schemas not supported in object keys currently");f.issues.length===0&&(l=f)}if(l.issues.length){e.mode==="loose"?n.value[a]=o[a]:n.issues.push({code:"invalid_key",origin:"record",issues:l.issues.map(f=>Ce(f,r,Ee())),input:a,path:[a],inst:t});continue}const u=e.valueType._zod.run({value:o[a],issues:[]},r);u instanceof Promise?i.push(u.then(f=>{f.issues.length&&n.issues.push(...tt(a,f.issues)),n.value[l.value]=f.value})):(u.issues.length&&n.issues.push(...tt(a,u.issues)),n.value[l.value]=u.value)}}return i.length?Promise.all(i).then(()=>n):n}}),Vl=h("$ZodEnum",(t,e)=>{R.init(t,e);const n=Ar(e.entries),r=new Set(n);t._zod.values=r,t._zod.pattern=new RegExp(`^(${n.filter(o=>ra.has(typeof o)).map(o=>typeof o=="string"?Qe(o):o.toString()).join("|")})$`),t._zod.parse=(o,i)=>{const s=o.value;return r.has(s)||o.issues.push({code:"invalid_value",values:n,input:s,inst:t}),o}}),Kl=h("$ZodLiteral",(t,e)=>{if(R.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(e.values);t._zod.values=n,t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Qe(r):r?Qe(r.toString()):String(r)).join("|")})$`),t._zod.parse=(r,o)=>{const i=r.value;return n.has(i)||r.issues.push({code:"invalid_value",values:e.values,input:i,inst:t}),r}}),Wl=h("$ZodTransform",(t,e)=>{R.init(t,e),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Ir(t.constructor.name);const o=e.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(n.value=s,n));if(o instanceof Promise)throw new Ye;return n.value=o,n}});function ro(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}const oo=h("$ZodOptional",(t,e)=>{R.init(t,e),t._zod.optin="optional",t._zod.optout="optional",P(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),P(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${Tn(n.source)})?$`):void 0}),t._zod.parse=(n,r)=>{if(e.innerType._zod.optin==="optional"){const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>ro(i,n.value)):ro(o,n.value)}return n.value===void 0?n:e.innerType._zod.run(n,r)}}),ql=h("$ZodExactOptional",(t,e)=>{oo.init(t,e),P(t._zod,"values",()=>e.innerType._zod.values),P(t._zod,"pattern",()=>e.innerType._zod.pattern),t._zod.parse=(n,r)=>e.innerType._zod.run(n,r)}),Gl=h("$ZodNullable",(t,e)=>{R.init(t,e),P(t._zod,"optin",()=>e.innerType._zod.optin),P(t._zod,"optout",()=>e.innerType._zod.optout),P(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${Tn(n.source)}|null)$`):void 0}),P(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(n,r)=>n.value===null?n:e.innerType._zod.run(n,r)}),Hl=h("$ZodDefault",(t,e)=>{R.init(t,e),t._zod.optin="optional",P(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);if(n.value===void 0)return n.value=e.defaultValue,n;const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>io(i,e)):io(o,e)}});function io(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const Yl=h("$ZodPrefault",(t,e)=>{R.init(t,e),t._zod.optin="optional",P(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=e.defaultValue),e.innerType._zod.run(n,r))}),Xl=h("$ZodNonOptional",(t,e)=>{R.init(t,e),P(t._zod,"values",()=>{const n=e.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),t._zod.parse=(n,r)=>{const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>so(i,t)):so(o,t)}});function so(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const Ql=h("$ZodCatch",(t,e)=>{R.init(t,e),P(t._zod,"optin",()=>e.innerType._zod.optin),P(t._zod,"optout",()=>e.innerType._zod.optout),P(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>(n.value=i.value,i.issues.length&&(n.value=e.catchValue({...n,error:{issues:i.issues.map(s=>Ce(s,r,Ee()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=e.catchValue({...n,error:{issues:o.issues.map(i=>Ce(i,r,Ee()))},input:n.value}),n.issues=[]),n)}}),ec=h("$ZodPipe",(t,e)=>{R.init(t,e),P(t._zod,"values",()=>e.in._zod.values),P(t._zod,"optin",()=>e.in._zod.optin),P(t._zod,"optout",()=>e.out._zod.optout),P(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(n,r)=>{if(r.direction==="backward"){const i=e.out._zod.run(n,r);return i instanceof Promise?i.then(s=>Jt(s,e.in,r)):Jt(i,e.in,r)}const o=e.in._zod.run(n,r);return o instanceof Promise?o.then(i=>Jt(i,e.out,r)):Jt(o,e.out,r)}});function Jt(t,e,n){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},n)}const tc=h("$ZodReadonly",(t,e)=>{R.init(t,e),P(t._zod,"propValues",()=>e.innerType._zod.propValues),P(t._zod,"values",()=>e.innerType._zod.values),P(t._zod,"optin",()=>{var n,r;return(r=(n=e.innerType)==null?void 0:n._zod)==null?void 0:r.optin}),P(t._zod,"optout",()=>{var n,r;return(r=(n=e.innerType)==null?void 0:n._zod)==null?void 0:r.optout}),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const o=e.innerType._zod.run(n,r);return o instanceof Promise?o.then(ao):ao(o)}});function ao(t){return t.value=Object.freeze(t.value),t}const nc=h("$ZodCustom",(t,e)=>{ne.init(t,e),R.init(t,e),t._zod.parse=(n,r)=>n,t._zod.check=n=>{const r=n.value,o=e.fn(r);if(o instanceof Promise)return o.then(i=>lo(i,n,r,t));lo(o,n,r,t)}});function lo(t,e,n,r){if(!t){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),e.issues.push(gt(o))}}var co;class rc{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...n){const r=n[0];return this._map.set(e,r),r&&typeof r=="object"&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const n=this._map.get(e);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(e),this}get(e){const n=e._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const o={...r,...this._map.get(e)};return Object.keys(o).length?o:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function oc(){return new rc}(co=globalThis).__zod_globalRegistry??(co.__zod_globalRegistry=oc());const yt=globalThis.__zod_globalRegistry;function ic(t,e){return new t({type:"string",..._(e)})}function sc(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,..._(e)})}function uo(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,..._(e)})}function ac(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,..._(e)})}function lc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",..._(e)})}function cc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",..._(e)})}function uc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",..._(e)})}function fc(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,..._(e)})}function pc(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,..._(e)})}function dc(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,..._(e)})}function hc(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,..._(e)})}function mc(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,..._(e)})}function gc(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,..._(e)})}function yc(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,..._(e)})}function vc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,..._(e)})}function bc(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,..._(e)})}function _c(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,..._(e)})}function kc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,..._(e)})}function wc(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,..._(e)})}function Sc(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,..._(e)})}function zc(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,..._(e)})}function xc(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,..._(e)})}function Oc(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,..._(e)})}function Ec(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,..._(e)})}function Tc(t,e){return new t({type:"string",format:"date",check:"string_format",..._(e)})}function $c(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,..._(e)})}function Cc(t,e){return new t({type:"string",format:"duration",check:"string_format",..._(e)})}function Pc(t,e){return new t({type:"number",checks:[],..._(e)})}function Ic(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",..._(e)})}function Nc(t,e){return new t({type:"boolean",..._(e)})}function Ac(t){return new t({type:"unknown"})}function Dc(t,e){return new t({type:"never",..._(e)})}function fo(t,e){return new qr({check:"less_than",..._(e),value:t,inclusive:!1})}function An(t,e){return new qr({check:"less_than",..._(e),value:t,inclusive:!0})}function po(t,e){return new Gr({check:"greater_than",..._(e),value:t,inclusive:!1})}function Dn(t,e){return new Gr({check:"greater_than",..._(e),value:t,inclusive:!0})}function ho(t,e){return new Ha({check:"multiple_of",..._(e),value:t})}function mo(t,e){return new Xa({check:"max_length",..._(e),maximum:t})}function Vt(t,e){return new Qa({check:"min_length",..._(e),minimum:t})}function go(t,e){return new el({check:"length_equals",..._(e),length:t})}function Mc(t,e){return new tl({check:"string_format",format:"regex",..._(e),pattern:t})}function Rc(t){return new nl({check:"string_format",format:"lowercase",..._(t)})}function Lc(t){return new rl({check:"string_format",format:"uppercase",..._(t)})}function Fc(t,e){return new ol({check:"string_format",format:"includes",..._(e),includes:t})}function Zc(t,e){return new il({check:"string_format",format:"starts_with",..._(e),prefix:t})}function jc(t,e){return new sl({check:"string_format",format:"ends_with",..._(e),suffix:t})}function nt(t){return new al({check:"overwrite",tx:t})}function Bc(t){return nt(e=>e.normalize(t))}function Uc(){return nt(t=>t.trim())}function Jc(){return nt(t=>t.toLowerCase())}function Vc(){return nt(t=>t.toUpperCase())}function Kc(){return nt(t=>ta(t))}function Wc(t,e,n){return new t({type:"array",element:e,..._(n)})}function qc(t,e,n){return new t({type:"custom",check:"custom",fn:e,..._(n)})}function Gc(t){const e=Hc(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(gt(r,n.value,e._zod.def));else{const o=r;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),n.issues.push(gt(o))}},t(n.value,n)));return e}function Hc(t,e){const n=new ne({check:"custom",..._(e)});return n._zod.check=t,n}function yo(t){let e=(t==null?void 0:t.target)??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:(t==null?void 0:t.metadata)??yt,target:e,unrepresentable:(t==null?void 0:t.unrepresentable)??"throw",override:(t==null?void 0:t.override)??(()=>{}),io:(t==null?void 0:t.io)??"output",counter:0,seen:new Map,cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0}}function J(t,e,n={path:[],schemaPath:[]}){var u,f;var r;const o=t._zod.def,i=e.seen.get(t);if(i)return i.count++,n.schemaPath.includes(t)&&(i.cycle=n.path),i.schema;const s={schema:{},count:1,cycle:void 0,path:n.path};e.seen.set(t,s);const a=(f=(u=t._zod).toJSONSchema)==null?void 0:f.call(u);if(a)s.schema=a;else{const p={...n,schemaPath:[...n.schemaPath,t],path:n.path};if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,s.schema,p);else{const m=s.schema,g=e.processors[o.type];if(!g)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${o.type}`);g(t,e,m,p)}const d=t._zod.parent;d&&(s.ref||(s.ref=d),J(d,e,p),e.seen.get(d).isParent=!0)}const l=e.metadataRegistry.get(t);return l&&Object.assign(s.schema,l),e.io==="input"&&Q(t)&&(delete s.schema.examples,delete s.schema.default),e.io==="input"&&s.schema._prefault&&((r=s.schema).default??(r.default=s.schema._prefault)),delete s.schema._prefault,e.seen.get(t).schema}function vo(t,e){var s,a,l,c;const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=new Map;for(const u of t.seen.entries()){const f=(s=t.metadataRegistry.get(u[0]))==null?void 0:s.id;if(f){const p=r.get(f);if(p&&p!==u[0])throw new Error(`Duplicate schema id "${f}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(f,u[0])}}const o=u=>{var g;const f=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){const y=(g=t.external.registry.get(u[0]))==null?void 0:g.id,b=t.external.uri??(z=>z);if(y)return{ref:b(y)};const k=u[1].defId??u[1].schema.id??`schema${t.counter++}`;return u[1].defId=k,{defId:k,ref:`${b("__shared")}#/${f}/${k}`}}if(u[1]===n)return{ref:"#"};const d=`#/${f}/`,m=u[1].schema.id??`__schema${t.counter++}`;return{defId:m,ref:d+m}},i=u=>{if(u[1].schema.$ref)return;const f=u[1],{ref:p,defId:d}=o(u);f.def={...f.schema},d&&(f.defId=d);const m=f.schema;for(const g in m)delete m[g];m.$ref=p};if(t.cycles==="throw")for(const u of t.seen.entries()){const f=u[1];if(f.cycle)throw new Error(`Cycle detected: #/${(a=f.cycle)==null?void 0:a.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const u of t.seen.entries()){const f=u[1];if(e===u[0]){i(u);continue}if(t.external){const d=(l=t.external.registry.get(u[0]))==null?void 0:l.id;if(e!==u[0]&&d){i(u);continue}}if((c=t.metadataRegistry.get(u[0]))==null?void 0:c.id){i(u);continue}if(f.cycle){i(u);continue}if(f.count>1&&t.reused==="ref"){i(u);continue}}}function bo(t,e){var s,a,l;const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=c=>{const u=t.seen.get(c);if(u.ref===null)return;const f=u.def??u.schema,p={...f},d=u.ref;if(u.ref=null,d){r(d);const g=t.seen.get(d),y=g.schema;if(y.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(f.allOf=f.allOf??[],f.allOf.push(y)):Object.assign(f,y),Object.assign(f,p),c._zod.parent===d)for(const k in f)k==="$ref"||k==="allOf"||k in p||delete f[k];if(y.$ref)for(const k in f)k==="$ref"||k==="allOf"||k in g.def&&JSON.stringify(f[k])===JSON.stringify(g.def[k])&&delete f[k]}const m=c._zod.parent;if(m&&m!==d){r(m);const g=t.seen.get(m);if(g!=null&&g.schema.$ref&&(f.$ref=g.schema.$ref,g.def))for(const y in f)y==="$ref"||y==="allOf"||y in g.def&&JSON.stringify(f[y])===JSON.stringify(g.def[y])&&delete f[y]}t.override({zodSchema:c,jsonSchema:f,path:u.path??[]})};for(const c of[...t.seen.entries()].reverse())r(c[0]);const o={};if(t.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?o.$schema="http://json-schema.org/draft-04/schema#":t.target,(s=t.external)!=null&&s.uri){const c=(a=t.external.registry.get(e))==null?void 0:a.id;if(!c)throw new Error("Schema is missing an `id` property");o.$id=t.external.uri(c)}Object.assign(o,n.def??n.schema);const i=((l=t.external)==null?void 0:l.defs)??{};for(const c of t.seen.entries()){const u=c[1];u.def&&u.defId&&(i[u.defId]=u.def)}t.external||Object.keys(i).length>0&&(t.target==="draft-2020-12"?o.$defs=i:o.definitions=i);try{const c=JSON.parse(JSON.stringify(o));return Object.defineProperty(c,"~standard",{value:{...e["~standard"],jsonSchema:{input:Kt(e,"input",t.processors),output:Kt(e,"output",t.processors)}},enumerable:!1,writable:!1}),c}catch{throw new Error("Error converting schema to JSON.")}}function Q(t,e){const n=e??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);const r=t._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return Q(r.element,n);if(r.type==="set")return Q(r.valueType,n);if(r.type==="lazy")return Q(r.getter(),n);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return Q(r.innerType,n);if(r.type==="intersection")return Q(r.left,n)||Q(r.right,n);if(r.type==="record"||r.type==="map")return Q(r.keyType,n)||Q(r.valueType,n);if(r.type==="pipe")return Q(r.in,n)||Q(r.out,n);if(r.type==="object"){for(const o in r.shape)if(Q(r.shape[o],n))return!0;return!1}if(r.type==="union"){for(const o of r.options)if(Q(o,n))return!0;return!1}if(r.type==="tuple"){for(const o of r.items)if(Q(o,n))return!0;return!!(r.rest&&Q(r.rest,n))}return!1}const Yc=(t,e={})=>n=>{const r=yo({...n,processors:e});return J(t,r),vo(r,t),bo(r,t)},Kt=(t,e,n={})=>r=>{const{libraryOptions:o,target:i}=r??{},s=yo({...o??{},target:i,io:e,processors:n});return J(t,s),vo(s,t),bo(s,t)},Xc={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},Qc=(t,e,n,r)=>{const o=n;o.type="string";const{minimum:i,maximum:s,format:a,patterns:l,contentEncoding:c}=t._zod.bag;if(typeof i=="number"&&(o.minLength=i),typeof s=="number"&&(o.maxLength=s),a&&(o.format=Xc[a]??a,o.format===""&&delete o.format,a==="time"&&delete o.format),c&&(o.contentEncoding=c),l&&l.size>0){const u=[...l];u.length===1?o.pattern=u[0].source:u.length>1&&(o.allOf=[...u.map(f=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:f.source}))])}},eu=(t,e,n,r)=>{const o=n,{minimum:i,maximum:s,format:a,multipleOf:l,exclusiveMaximum:c,exclusiveMinimum:u}=t._zod.bag;typeof a=="string"&&a.includes("int")?o.type="integer":o.type="number",typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.minimum=u,o.exclusiveMinimum=!0):o.exclusiveMinimum=u),typeof i=="number"&&(o.minimum=i,typeof u=="number"&&e.target!=="draft-04"&&(u>=i?delete o.minimum:delete o.exclusiveMinimum)),typeof c=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(o.maximum=c,o.exclusiveMaximum=!0):o.exclusiveMaximum=c),typeof s=="number"&&(o.maximum=s,typeof c=="number"&&e.target!=="draft-04"&&(c<=s?delete o.maximum:delete o.exclusiveMaximum)),typeof l=="number"&&(o.multipleOf=l)},tu=(t,e,n,r)=>{n.type="boolean"},nu=(t,e,n,r)=>{n.not={}},ru=(t,e,n,r)=>{},ou=(t,e,n,r)=>{const o=t._zod.def,i=Ar(o.entries);i.every(s=>typeof s=="number")&&(n.type="number"),i.every(s=>typeof s=="string")&&(n.type="string"),n.enum=i},iu=(t,e,n,r)=>{const o=t._zod.def,i=[];for(const s of o.values)if(s===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(s))}else i.push(s);if(i.length!==0)if(i.length===1){const s=i[0];n.type=s===null?"null":typeof s,e.target==="draft-04"||e.target==="openapi-3.0"?n.enum=[s]:n.const=s}else i.every(s=>typeof s=="number")&&(n.type="number"),i.every(s=>typeof s=="string")&&(n.type="string"),i.every(s=>typeof s=="boolean")&&(n.type="boolean"),i.every(s=>s===null)&&(n.type="null"),n.enum=i},su=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},au=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},lu=(t,e,n,r)=>{const o=n,i=t._zod.def,{minimum:s,maximum:a}=t._zod.bag;typeof s=="number"&&(o.minItems=s),typeof a=="number"&&(o.maxItems=a),o.type="array",o.items=J(i.element,e,{...r,path:[...r.path,"items"]})},cu=(t,e,n,r)=>{var c;const o=n,i=t._zod.def;o.type="object",o.properties={};const s=i.shape;for(const u in s)o.properties[u]=J(s[u],e,{...r,path:[...r.path,"properties",u]});const a=new Set(Object.keys(s)),l=new Set([...a].filter(u=>{const f=i.shape[u]._zod;return e.io==="input"?f.optin===void 0:f.optout===void 0}));l.size>0&&(o.required=Array.from(l)),((c=i.catchall)==null?void 0:c._zod.def.type)==="never"?o.additionalProperties=!1:i.catchall?i.catchall&&(o.additionalProperties=J(i.catchall,e,{...r,path:[...r.path,"additionalProperties"]})):e.io==="output"&&(o.additionalProperties=!1)},uu=(t,e,n,r)=>{const o=t._zod.def,i=o.inclusive===!1,s=o.options.map((a,l)=>J(a,e,{...r,path:[...r.path,i?"oneOf":"anyOf",l]}));i?n.oneOf=s:n.anyOf=s},fu=(t,e,n,r)=>{const o=t._zod.def,i=J(o.left,e,{...r,path:[...r.path,"allOf",0]}),s=J(o.right,e,{...r,path:[...r.path,"allOf",1]}),a=c=>"allOf"in c&&Object.keys(c).length===1,l=[...a(i)?i.allOf:[i],...a(s)?s.allOf:[s]];n.allOf=l},pu=(t,e,n,r)=>{const o=n,i=t._zod.def;o.type="object";const s=i.keyType,a=s._zod.bag,l=a==null?void 0:a.patterns;if(i.mode==="loose"&&l&&l.size>0){const u=J(i.valueType,e,{...r,path:[...r.path,"patternProperties","*"]});o.patternProperties={};for(const f of l)o.patternProperties[f.source]=u}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(o.propertyNames=J(i.keyType,e,{...r,path:[...r.path,"propertyNames"]})),o.additionalProperties=J(i.valueType,e,{...r,path:[...r.path,"additionalProperties"]});const c=s._zod.values;if(c){const u=[...c].filter(f=>typeof f=="string"||typeof f=="number");u.length>0&&(o.required=u)}},du=(t,e,n,r)=>{const o=t._zod.def,i=J(o.innerType,e,r),s=e.seen.get(t);e.target==="openapi-3.0"?(s.ref=o.innerType,n.nullable=!0):n.anyOf=[i,{type:"null"}]},hu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType},mu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType,n.default=JSON.parse(JSON.stringify(o.defaultValue))},gu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType,e.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(o.defaultValue)))},yu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType;let s;try{s=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=s},vu=(t,e,n,r)=>{const o=t._zod.def,i=e.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;J(i,e,r);const s=e.seen.get(t);s.ref=i},bu=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType,n.readOnly=!0},_o=(t,e,n,r)=>{const o=t._zod.def;J(o.innerType,e,r);const i=e.seen.get(t);i.ref=o.innerType},_u=h("ZodISODateTime",(t,e)=>{kl.init(t,e),F.init(t,e)});function ku(t){return Ec(_u,t)}const wu=h("ZodISODate",(t,e)=>{wl.init(t,e),F.init(t,e)});function Su(t){return Tc(wu,t)}const zu=h("ZodISOTime",(t,e)=>{Sl.init(t,e),F.init(t,e)});function xu(t){return $c(zu,t)}const Ou=h("ZodISODuration",(t,e)=>{zl.init(t,e),F.init(t,e)});function Eu(t){return Cc(Ou,t)}const se=h("ZodError",(t,e)=>{Zr.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:n=>ha(t,n)},flatten:{value:n=>da(t,n)},addIssue:{value:n=>{t.issues.push(n),t.message=JSON.stringify(t.issues,xn,2)}},addIssues:{value:n=>{t.issues.push(...n),t.message=JSON.stringify(t.issues,xn,2)}},isEmpty:{get(){return t.issues.length===0}}})},{Parent:Error}),Tu=Cn(se),$u=Pn(se),Cu=Zt(se),Pu=jt(se),Iu=ya(se),Nu=va(se),Au=ba(se),Du=_a(se),Mu=ka(se),Ru=wa(se),Lu=Sa(se),Fu=za(se),L=h("ZodType",(t,e)=>(R.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:Kt(t,"input"),output:Kt(t,"output")}}),t.toJSONSchema=Yc(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...n)=>t.clone(Te(e,{checks:[...e.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),{parent:!0}),t.with=t.check,t.clone=(n,r)=>$e(t,n,r),t.brand=()=>t,t.register=((n,r)=>(n.add(t,r),t)),t.parse=(n,r)=>Tu(t,n,r,{callee:t.parse}),t.safeParse=(n,r)=>Cu(t,n,r),t.parseAsync=async(n,r)=>$u(t,n,r,{callee:t.parseAsync}),t.safeParseAsync=async(n,r)=>Pu(t,n,r),t.spa=t.safeParseAsync,t.encode=(n,r)=>Iu(t,n,r),t.decode=(n,r)=>Nu(t,n,r),t.encodeAsync=async(n,r)=>Au(t,n,r),t.decodeAsync=async(n,r)=>Du(t,n,r),t.safeEncode=(n,r)=>Mu(t,n,r),t.safeDecode=(n,r)=>Ru(t,n,r),t.safeEncodeAsync=async(n,r)=>Lu(t,n,r),t.safeDecodeAsync=async(n,r)=>Fu(t,n,r),t.refine=(n,r)=>t.check(Mf(n,r)),t.superRefine=n=>t.check(Rf(n)),t.overwrite=n=>t.check(nt(n)),t.optional=()=>To(t),t.exactOptional=()=>Sf(t),t.nullable=()=>$o(t),t.nullish=()=>To($o(t)),t.nonoptional=n=>$f(t,n),t.array=()=>he(t),t.or=n=>Mn([t,n]),t.and=n=>gf(t,n),t.transform=n=>Po(t,kf(n)),t.default=n=>Of(t,n),t.prefault=n=>Tf(t,n),t.catch=n=>Pf(t,n),t.pipe=n=>Po(t,n),t.readonly=()=>Af(t),t.describe=n=>{const r=t.clone();return yt.add(r,{description:n}),r},Object.defineProperty(t,"description",{get(){var n;return(n=yt.get(t))==null?void 0:n.description},configurable:!0}),t.meta=(...n)=>{if(n.length===0)return yt.get(t);const r=t.clone();return yt.add(r,n[0]),r},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t.apply=n=>n(t),t)),ko=h("_ZodString",(t,e)=>{In.init(t,e),L.init(t,e),t._zod.processJSONSchema=(r,o,i)=>Qc(t,r,o);const n=t._zod.bag;t.format=n.format??null,t.minLength=n.minimum??null,t.maxLength=n.maximum??null,t.regex=(...r)=>t.check(Mc(...r)),t.includes=(...r)=>t.check(Fc(...r)),t.startsWith=(...r)=>t.check(Zc(...r)),t.endsWith=(...r)=>t.check(jc(...r)),t.min=(...r)=>t.check(Vt(...r)),t.max=(...r)=>t.check(mo(...r)),t.length=(...r)=>t.check(go(...r)),t.nonempty=(...r)=>t.check(Vt(1,...r)),t.lowercase=r=>t.check(Rc(r)),t.uppercase=r=>t.check(Lc(r)),t.trim=()=>t.check(Uc()),t.normalize=(...r)=>t.check(Bc(...r)),t.toLowerCase=()=>t.check(Jc()),t.toUpperCase=()=>t.check(Vc()),t.slugify=()=>t.check(Kc())}),Zu=h("ZodString",(t,e)=>{In.init(t,e),ko.init(t,e),t.email=n=>t.check(sc(ju,n)),t.url=n=>t.check(fc(Bu,n)),t.jwt=n=>t.check(Oc(rf,n)),t.emoji=n=>t.check(pc(Uu,n)),t.guid=n=>t.check(uo(wo,n)),t.uuid=n=>t.check(ac(Wt,n)),t.uuidv4=n=>t.check(lc(Wt,n)),t.uuidv6=n=>t.check(cc(Wt,n)),t.uuidv7=n=>t.check(uc(Wt,n)),t.nanoid=n=>t.check(dc(Ju,n)),t.guid=n=>t.check(uo(wo,n)),t.cuid=n=>t.check(hc(Vu,n)),t.cuid2=n=>t.check(mc(Ku,n)),t.ulid=n=>t.check(gc(Wu,n)),t.base64=n=>t.check(Sc(ef,n)),t.base64url=n=>t.check(zc(tf,n)),t.xid=n=>t.check(yc(qu,n)),t.ksuid=n=>t.check(vc(Gu,n)),t.ipv4=n=>t.check(bc(Hu,n)),t.ipv6=n=>t.check(_c(Yu,n)),t.cidrv4=n=>t.check(kc(Xu,n)),t.cidrv6=n=>t.check(wc(Qu,n)),t.e164=n=>t.check(xc(nf,n)),t.datetime=n=>t.check(ku(n)),t.date=n=>t.check(Su(n)),t.time=n=>t.check(xu(n)),t.duration=n=>t.check(Eu(n))});function ae(t){return ic(Zu,t)}const F=h("ZodStringFormat",(t,e)=>{A.init(t,e),ko.init(t,e)}),ju=h("ZodEmail",(t,e)=>{pl.init(t,e),F.init(t,e)}),wo=h("ZodGUID",(t,e)=>{ul.init(t,e),F.init(t,e)}),Wt=h("ZodUUID",(t,e)=>{fl.init(t,e),F.init(t,e)}),Bu=h("ZodURL",(t,e)=>{dl.init(t,e),F.init(t,e)}),Uu=h("ZodEmoji",(t,e)=>{hl.init(t,e),F.init(t,e)}),Ju=h("ZodNanoID",(t,e)=>{ml.init(t,e),F.init(t,e)}),Vu=h("ZodCUID",(t,e)=>{gl.init(t,e),F.init(t,e)}),Ku=h("ZodCUID2",(t,e)=>{yl.init(t,e),F.init(t,e)}),Wu=h("ZodULID",(t,e)=>{vl.init(t,e),F.init(t,e)}),qu=h("ZodXID",(t,e)=>{bl.init(t,e),F.init(t,e)}),Gu=h("ZodKSUID",(t,e)=>{_l.init(t,e),F.init(t,e)}),Hu=h("ZodIPv4",(t,e)=>{xl.init(t,e),F.init(t,e)}),Yu=h("ZodIPv6",(t,e)=>{Ol.init(t,e),F.init(t,e)}),Xu=h("ZodCIDRv4",(t,e)=>{El.init(t,e),F.init(t,e)}),Qu=h("ZodCIDRv6",(t,e)=>{Tl.init(t,e),F.init(t,e)}),ef=h("ZodBase64",(t,e)=>{$l.init(t,e),F.init(t,e)}),tf=h("ZodBase64URL",(t,e)=>{Pl.init(t,e),F.init(t,e)}),nf=h("ZodE164",(t,e)=>{Il.init(t,e),F.init(t,e)}),rf=h("ZodJWT",(t,e)=>{Al.init(t,e),F.init(t,e)}),So=h("ZodNumber",(t,e)=>{Yr.init(t,e),L.init(t,e),t._zod.processJSONSchema=(r,o,i)=>eu(t,r,o),t.gt=(r,o)=>t.check(po(r,o)),t.gte=(r,o)=>t.check(Dn(r,o)),t.min=(r,o)=>t.check(Dn(r,o)),t.lt=(r,o)=>t.check(fo(r,o)),t.lte=(r,o)=>t.check(An(r,o)),t.max=(r,o)=>t.check(An(r,o)),t.int=r=>t.check(zo(r)),t.safe=r=>t.check(zo(r)),t.positive=r=>t.check(po(0,r)),t.nonnegative=r=>t.check(Dn(0,r)),t.negative=r=>t.check(fo(0,r)),t.nonpositive=r=>t.check(An(0,r)),t.multipleOf=(r,o)=>t.check(ho(r,o)),t.step=(r,o)=>t.check(ho(r,o)),t.finite=()=>t;const n=t._zod.bag;t.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),t.isFinite=!0,t.format=n.format??null});function of(t){return Pc(So,t)}const sf=h("ZodNumberFormat",(t,e)=>{Dl.init(t,e),So.init(t,e)});function zo(t){return Ic(sf,t)}const af=h("ZodBoolean",(t,e)=>{Ml.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>tu(t,n,r)});function lf(t){return Nc(af,t)}const cf=h("ZodUnknown",(t,e)=>{Rl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>ru()});function xo(){return Ac(cf)}const uf=h("ZodNever",(t,e)=>{Ll.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>nu(t,n,r)});function ff(t){return Dc(uf,t)}const pf=h("ZodArray",(t,e)=>{Fl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>lu(t,n,r,o),t.element=e.element,t.min=(n,r)=>t.check(Vt(n,r)),t.nonempty=n=>t.check(Vt(1,n)),t.max=(n,r)=>t.check(mo(n,r)),t.length=(n,r)=>t.check(go(n,r)),t.unwrap=()=>t.element});function he(t,e){return Wc(pf,t,e)}const df=h("ZodObject",(t,e)=>{jl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>cu(t,n,r,o),P(t,"shape",()=>e.shape),t.keyof=()=>qt(Object.keys(t._zod.def.shape)),t.catchall=n=>t.clone({...t._zod.def,catchall:n}),t.passthrough=()=>t.clone({...t._zod.def,catchall:xo()}),t.loose=()=>t.clone({...t._zod.def,catchall:xo()}),t.strict=()=>t.clone({...t._zod.def,catchall:ff()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=n=>la(t,n),t.safeExtend=n=>ca(t,n),t.merge=n=>ua(t,n),t.pick=n=>sa(t,n),t.omit=n=>aa(t,n),t.partial=(...n)=>fa(Eo,t,n[0]),t.required=(...n)=>pa(Co,t,n[0])});function rt(t,e){const n={type:"object",shape:t??{},..._(e)};return new df(n)}const hf=h("ZodUnion",(t,e)=>{Bl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>uu(t,n,r,o),t.options=e.options});function Mn(t,e){return new hf({type:"union",options:t,..._(e)})}const mf=h("ZodIntersection",(t,e)=>{Ul.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>fu(t,n,r,o)});function gf(t,e){return new mf({type:"intersection",left:t,right:e})}const yf=h("ZodRecord",(t,e)=>{Jl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>pu(t,n,r,o),t.keyType=e.keyType,t.valueType=e.valueType});function Oo(t,e,n){return new yf({type:"record",keyType:t,valueType:e,..._(n)})}const Rn=h("ZodEnum",(t,e)=>{Vl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(r,o,i)=>ou(t,r,o),t.enum=e.entries,t.options=Object.values(e.entries);const n=new Set(Object.keys(e.entries));t.extract=(r,o)=>{const i={};for(const s of r)if(n.has(s))i[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new Rn({...e,checks:[],..._(o),entries:i})},t.exclude=(r,o)=>{const i={...e.entries};for(const s of r)if(n.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new Rn({...e,checks:[],..._(o),entries:i})}});function qt(t,e){const n=Array.isArray(t)?Object.fromEntries(t.map(r=>[r,r])):t;return new Rn({type:"enum",entries:n,..._(e)})}const vf=h("ZodLiteral",(t,e)=>{Kl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>iu(t,n,r),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function bf(t,e){return new vf({type:"literal",values:Array.isArray(t)?t:[t],..._(e)})}const _f=h("ZodTransform",(t,e)=>{Wl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>au(t,n),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Ir(t.constructor.name);n.addIssue=i=>{if(typeof i=="string")n.issues.push(gt(i,n.value,e));else{const s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),n.issues.push(gt(s))}};const o=e.transform(n.value,n);return o instanceof Promise?o.then(i=>(n.value=i,n)):(n.value=o,n)}});function kf(t){return new _f({type:"transform",transform:t})}const Eo=h("ZodOptional",(t,e)=>{oo.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>_o(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function To(t){return new Eo({type:"optional",innerType:t})}const wf=h("ZodExactOptional",(t,e)=>{ql.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>_o(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function Sf(t){return new wf({type:"optional",innerType:t})}const zf=h("ZodNullable",(t,e)=>{Gl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>du(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function $o(t){return new zf({type:"nullable",innerType:t})}const xf=h("ZodDefault",(t,e)=>{Hl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>mu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Of(t,e){return new xf({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():Lr(e)}})}const Ef=h("ZodPrefault",(t,e)=>{Yl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>gu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function Tf(t,e){return new Ef({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():Lr(e)}})}const Co=h("ZodNonOptional",(t,e)=>{Xl.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>hu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function $f(t,e){return new Co({type:"nonoptional",innerType:t,..._(e)})}const Cf=h("ZodCatch",(t,e)=>{Ql.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>yu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function Pf(t,e){return new Cf({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const If=h("ZodPipe",(t,e)=>{ec.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>vu(t,n,r,o),t.in=e.in,t.out=e.out});function Po(t,e){return new If({type:"pipe",in:t,out:e})}const Nf=h("ZodReadonly",(t,e)=>{tc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>bu(t,n,r,o),t.unwrap=()=>t._zod.def.innerType});function Af(t){return new Nf({type:"readonly",innerType:t})}const Df=h("ZodCustom",(t,e)=>{nc.init(t,e),L.init(t,e),t._zod.processJSONSchema=(n,r,o)=>su(t,n)});function Mf(t,e={}){return qc(Df,t,e)}function Rf(t){return Gc(t)}const Ln=new Set(["files","gap","headline","hidden","info","line","pages","users"]),Io={text:t=>we(t,`"${t.label}", single-line plain text without line breaks or formatting`),textarea:t=>we(t,`"${t.label}", multi-line text with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),markdown:t=>we(t,`"${t.label}", multi-line text with Markdown formatting`),slug:t=>we(t,`"${t.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`),url:t=>we(t,`"${t.label}", a valid URL starting with http:// or https://`),email:t=>we(t,`"${t.label}", a valid email address`),password:t=>we(t,`"${t.label}", a secure password (not for actual use)`),tel:t=>we(t,`"${t.label}", a telephone number in appropriate format for the context`),writer:t=>we(t,`"${t.label}" (WYSIWYG), ${t.inline===!0?"text with inline formatting only (bold, italic, underline, code, links, email, sub, sup). NO wrapping paragraph <p> tags allowed.":"text wrapped in paragraph <p> tags (can contain one or multiple paragraphs). Inline formatting (bold, italic, underline, code, links, email, sub, sup) is allowed."}`),list:t=>ae().describe(`"${t.label}" (WYSIWYG), HTML list wrapped in <ul> or <ol>. Use <li> for items with inline formatting (bold, italic, underline, code, links, email, sub, sup).`),number:t=>Ao(t),range:t=>Ao(t),toggle:t=>lf().describe(`"${t.label}", a boolean`),select:t=>Zn(t),radio:t=>Zn(t),toggles:t=>Zn(t),checkboxes:t=>jn(t),multiselect:t=>jn(t),tags:t=>jn(t),date:t=>ae().describe(`"${t.label}", a date ${t.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:t=>ae().describe(`"${t.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),color:t=>ae().describe(`"${t.label}", a color value in hex, rgb or hsl format`),link:t=>ae().describe(`"${t.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),structure:t=>{const e=No(t);return e?he(e).describe(`"${t.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`):he(Oo(ae(),ae())).describe(`"${t.label}", repeatable structured data based on expected content structure`)},object:t=>{const e=No(t);return e?e.describe(`"${t.label}", structured data containing the defined sub-fields with appropriate content`):Oo(ae(),ae()).describe(`"${t.label}", object data based on expected content structure`)},entries:t=>{const{field:e}=t.field,n={...e,name:"entry",label:t.label||"Entry"},r=Io[e.type],o=r(n);let i=he(o);return t.min!=null&&(i=i.min(t.min)),t.max!=null&&(i=i.max(t.max)),i.describe(`"${t.label}", multiple entries of ${e.type} values${t.min!=null||t.max!=null?" within the defined count range":""}`)}};function Fn(t){var r,o,i,s,a;const e=Io[t.type];if(!e)throw new Error(`Unsupported field type: ${t.type}`);let n=e(t);if(t.required===!0){const l=(o=(r=n._zod)==null?void 0:r.def)==null?void 0:o.type;l==="string"?n.minLength==null&&(n=n.min(1)):l==="array"&&((a=(s=(i=n._zod)==null?void 0:i.def)==null?void 0:s.checks)!=null&&a.some(u=>{var f,p;return((p=(f=u._zod)==null?void 0:f.def)==null?void 0:p.check)==="min_length"})||(n=n.min(1)))}else n=n.nullable();return n}function No(t){if(typeof t.fields!="object"||t.fields===null)return;const e={};for(const[n,r]of Object.entries(t.fields))r.disabled||r.hidden||Ln.has(r.type)||(e[n]=Fn({...r,name:n}));return rt(e).strict()}function we(t,e){let n=ae();return t.minlength!=null&&(n=n.min(t.minlength)),t.maxlength!=null&&(n=n.max(t.maxlength)),n.describe(e)}function Ao(t){let e=of();return t.min!=null&&(e=e.min(t.min)),t.max!=null&&(e=e.max(t.max)),e.describe(`"${t.label}", a numeric value${t.min!=null||t.max!=null?" within the defined range":""}`)}function Zn(t){const e=(t.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return e.length>0?qt(e).describe(`"${t.label}", single selection value based on the predefined options`):ae().describe(`"${t.label}", single selection value`)}function jn(t){const e=(t.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return e.length>0?he(qt(e)).describe(`"${t.label}", one ore many values based on the predefined options`):he(ae()).describe(`"${t.label}", multiple selection values`)}function Do(t){const{name:e,type:n,fields:r}=t;if(!r||Object.keys(r).length===0)return;const o={};for(const i of Object.values(r)){if(i.disabled||i.hidden||Ln.has(i.type))continue;const s=Fn(i);o[i.name]=s}return rt({type:bf(n),content:rt(o).strict()}).strict().describe(`Kirby block: ${e}`)}function Lf(t){if(!Array.isArray(t)||t.length===0)throw new Error("Invalid fieldsets configuration");const e=t.map(Do).filter(Boolean);return Mn(e).describe("Union of all Kirby block types")}let Gt,vt;function Ht(){async function t(){return Gt||vt||(vt=window.panel.api.get(xs).then(r=>(Gt=r,vt=void 0,Gt)),vt)}async function e(r){let o=await t();const{config:i}=await ke();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(o=o.filter(s=>!i.excludedBlocks.includes(s.type))),r.fieldsets){const s=Array.isArray(r.fieldsets)?r.fieldsets:Object.keys(r.fieldsets);o=o.filter(a=>s.includes(a.type))}return Lf(o)}function n(r){return r.isHidden??(r.isHidden=!1),r.id??(r.id=crypto.randomUUID()),r}return{getFieldsets:t,getZodSchema:e,normalizeBlock:n}}async function Mo(t={}){return new Promise(e=>{const n=T();let r;n.dialog.open({component:"k-copilot-prompt-dialog",props:t,on:{close:()=>{setTimeout(()=>{e(r)},25)},submit:o=>{r=o,n.dialog.close()}}})})}function Ff(t,e,n,r){let o;const i=()=>{o==null||o(),o=void 0},s=(c,u,f,p)=>(c.addEventListener(u,f,p),()=>c.removeEventListener(u,f,p)),a=_n(()=>Zf(t),c=>{i(),c&&(o=s(c,e,n,r))},{immediate:!0,flush:"post"}),l=()=>{a(),i()};return ls()&&ps(l),l}function Zf(t){const e=bn(t);return(e==null?void 0:e.$el)??e}const Yt=new Map;function Ro(){const t=T();async function e(){const{path:r}=t.view;if(Yt.has(r))return Yt.get(r);let o=await t.api.get(zs,{id:r},void 0,!0);return o=Object.values(o).filter(i=>!Ln.has(i.type)&&!i.disabled&&!i.hidden),Yt.set(r,o),o}function n(){Yt.delete(t.view.path)}return{getViewFields:e,clearViewFields:n}}function Lo(){return Vs({accept:Ds.join(",")})}function jf(t){return typeof t=="string"?`'${t}'`:new Bf().serialize(t)}const Bf=(function(){var e;class t{constructor(){Qi(this,e,new Map)}compare(r,o){const i=typeof r,s=typeof o;return i==="string"&&s==="string"?r.localeCompare(o):i==="number"&&s==="number"?r-o:String.prototype.localeCompare.call(this.serialize(r,!0),this.serialize(o,!0))}serialize(r,o){if(r===null)return"null";switch(typeof r){case"string":return o?r:`'${r}'`;case"bigint":return`${r}n`;case"object":return this.$object(r);case"function":return this.$function(r)}return String(r)}serializeObject(r){const o=Object.prototype.toString.call(r);if(o!=="[object Object]")return this.serializeBuiltInType(o.length<10?`unknown:${o}`:o.slice(8,-1),r);const i=r.constructor,s=i===Object||i===void 0?"":i.name;if(s!==""&&globalThis[s]===i)return this.serializeBuiltInType(s,r);if(typeof r.toJSON=="function"){const a=r.toJSON();return s+(a!==null&&typeof a=="object"?this.$object(a):`(${this.serialize(a)})`)}return this.serializeObjectEntries(s,Object.entries(r))}serializeBuiltInType(r,o){const i=this["$"+r];if(i)return i.call(this,o);if(typeof(o==null?void 0:o.entries)=="function")return this.serializeObjectEntries(r,o.entries());throw new Error(`Cannot serialize ${r}`)}serializeObjectEntries(r,o){const i=Array.from(o).sort((a,l)=>this.compare(a[0],l[0]));let s=`${r}{`;for(let a=0;a<i.length;a++){const[l,c]=i[a];s+=`${this.serialize(l,!0)}:${this.serialize(c)}`,a<i.length-1&&(s+=",")}return s+"}"}$object(r){let o=At(this,e).get(r);return o===void 0&&(At(this,e).set(r,`#${At(this,e).size}`),o=this.serializeObject(r),At(this,e).set(r,o)),o}$function(r){const o=Function.prototype.toString.call(r);return o.slice(-15)==="[native code] }"?`${r.name||""}()[native]`:`${r.name}(${r.length})${o.replace(/\s*\n\s*/g,"")}`}$Array(r){let o="[";for(let i=0;i<r.length;i++)o+=this.serialize(r[i]),i<r.length-1&&(o+=",");return o+"]"}$Date(r){try{return`Date(${r.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(r){return`ArrayBuffer[${new Uint8Array(r).join(",")}]`}$Set(r){return`Set${this.$Array(Array.from(r).sort((o,i)=>this.compare(o,i)))}`}$Map(r){return this.serializeObjectEntries("Map",r.entries())}}e=new WeakMap;for(const n of["Error","RegExp","URL"])t.prototype["$"+n]=function(r){return`${n}(${r})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])t.prototype["$"+n]=function(r){return`${n}[${r.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])t.prototype["$"+n]=function(r){return`${n}[${r.join("n,")}${r.length>0?"n":""}]`};return t})(),Uf=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Jf=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Vf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Le=[];class Kf{constructor(){_e(this,"_data",new ot);_e(this,"_hash",new ot([...Uf]));_e(this,"_nDataBytes",0);_e(this,"_minBufferSize",0)}finalize(e){e&&this._append(e);const n=this._nDataBytes*8,r=this._data.sigBytes*8;return this._data.words[r>>>5]|=128<<24-r%32,this._data.words[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(r+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(e,n){const r=this._hash.words;let o=r[0],i=r[1],s=r[2],a=r[3],l=r[4],c=r[5],u=r[6],f=r[7];for(let p=0;p<64;p++){if(p<16)Le[p]=e[n+p]|0;else{const z=Le[p-15],I=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,E=Le[p-2],N=(E<<15|E>>>17)^(E<<13|E>>>19)^E>>>10;Le[p]=I+Le[p-7]+N+Le[p-16]}const d=l&c^~l&u,m=o&i^o&s^i&s,g=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),y=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),b=f+y+d+Jf[p]+Le[p],k=g+m;f=u,u=c,c=l,l=a+b|0,a=s,s=i,i=o,o=b+k|0}r[0]=r[0]+o|0,r[1]=r[1]+i|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+l|0,r[5]=r[5]+c|0,r[6]=r[6]+u|0,r[7]=r[7]+f|0}_append(e){typeof e=="string"&&(e=ot.fromUtf8(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_process(e){let n,r=this._data.sigBytes/64;e?r=Math.ceil(r):r=Math.max((r|0)-this._minBufferSize,0);const o=r*16,i=Math.min(o*4,this._data.sigBytes);if(o){for(let s=0;s<o;s+=16)this._doProcessBlock(this._data.words,s);n=this._data.words.splice(0,o),this._data.sigBytes-=i}return new ot(n,i)}}class ot{constructor(e,n){_e(this,"words");_e(this,"sigBytes");e=this.words=e||[],this.sigBytes=n===void 0?e.length*4:n}static fromUtf8(e){const n=unescape(encodeURIComponent(e)),r=n.length,o=[];for(let i=0;i<r;i++)o[i>>>2]|=(n.charCodeAt(i)&255)<<24-i%4*8;return new ot(o,r)}toBase64(){const e=[];for(let n=0;n<this.sigBytes;n+=3){const r=this.words[n>>>2]>>>24-n%4*8&255,o=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,i=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,s=r<<16|o<<8|i;for(let a=0;a<4&&n*8+a*6<this.sigBytes*8;a++)e.push(Vf.charAt(s>>>6*(3-a)&63))}return e.join("")}concat(e){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<e.sigBytes;n++){const r=e.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=r<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<e.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=e.words[n>>>2];this.sigBytes+=e.sigBytes}}function Wf(t){return new Kf().finalize(t).toBase64()}function qf(t){return Wf(jf(t))}function Bn(...t){return`${Or}${qf([...t])}`}const Fo=50;function Gf(){const t=Bn("history",window.location.hostname),e=S(JSON.parse(localStorage.getItem(t)||"[]")),n=S(""),r=S(-1);function o(){localStorage.setItem(t,JSON.stringify(e.value))}function i(u){if(!u||typeof u!="string"||!u.trim())return;const f=u.trim(),p=e.value.indexOf(f);p!==-1&&e.value.splice(p,1),e.value.unshift(f),e.value.length>Fo&&(e.value=e.value.slice(0,Fo)),o(),r.value=-1}function s(u){if(e.value.length!==0){if(u==="up"){if(r.value+1<e.value.length)return r.value++,e.value[r.value]}else if(u==="down"){if(r.value>0)return r.value--,e.value[r.value];if(r.value===0)return r.value=-1,n.value}}}function a(u){const f=e.value.indexOf(u);return f===-1?!1:(e.value.splice(f,1),o(),!0)}function l(){e.value=[],o(),r.value=-1}function c(u=10){return e.value.slice(0,u)}return{history:e,lastPrompt:n,currentIndex:r,addToHistory:i,navigateHistory:s,deleteEntry:a,clearHistory:l,getRecentEntries:c}}function Hf(t,e={}){if(!t||t.length===0)throw new Error("No fieldsets available for layout schema generation");const n=e.layouts??[["1/1"]],r=Yf(n),o=Xf(t,r),i=n.map(s=>`"${s}"`).join(", ");return o.describe(`Kirby layout with columns and blocks. Available layout combinations: ${i}. Use these exact column width combinations when creating layouts.`)}function Yf(t){const e=new Set;for(const n of t)for(const r of n)typeof r=="string"&&r.trim()&&e.add(r);return[...e]}function Xf(t,e){const n=Qf(t,e);return rt({columns:he(n).min(1).describe("Array of columns in this layout")}).strict()}function Qf(t,e){const n=t.map(Do).filter(Boolean),r=n.length>1?Mn(n):n[0];return rt({width:qt(e).describe('Column width fraction to use, e.g. "1/2"'),blocks:he(r).describe("Array of blocks contained in this column")}).strict()}function Un(){const{getFieldsets:t}=Ht();async function e(r){let o=await t();const{config:i}=await ke();if(i.excludedBlocks&&Array.isArray(i.excludedBlocks)&&(o=o.filter(s=>!i.excludedBlocks.includes(s.type))),r.fieldsets){const s=Array.isArray(r.fieldsets)?r.fieldsets:Object.keys(r.fieldsets);o=o.filter(a=>s.includes(a.type))}return Hf(o,r)}function n(r){return r.id??(r.id=crypto.randomUUID()),r.attrs??(r.attrs=[]),r.columns=(r.columns??[]).map(o=>(o.id??(o.id=crypto.randomUUID()),o.width??(o.width="1/1"),o.blocks=(o.blocks??[]).map(i=>(i.isHidden??(i.isHidden=!1),i.id??(i.id=crypto.randomUUID()),i)),o)),r}return{getZodSchema:e,normalizeLayout:n}}const ep="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";function Jn(t=16,e=ep){let n="",r=t;const o=e.length;for(;r--;)n+=e[Math.random()*o|0];return n}const Vn=50,Xt="IMPORTANT: Preserve all formatting (bold, italic, links, code, headings, lists, etc.) exactly as in the original.",tp=[{name:"Fix Grammar & Spelling",prompt:`Fix all spelling and grammar errors in the given text. ${Xt} Only output the corrected text, nothing else.`},{name:"Make Concise",prompt:`Make the given text more concise by removing unnecessary words while keeping the meaning intact. ${Xt} Only output the reduced text, nothing else.`},{name:"Simplify",prompt:`Simplify the given text to make it easier to understand, using simpler words and shorter sentences. ${Xt} Only output the simplified text, nothing else.`},{name:"Extend",prompt:`Extend the given text with more details, examples, or explanations while maintaining the same style and tone. ${Xt} Only output the extended text, nothing else.`},{name:"Summarize",prompt:"Summarize the given text concisely while keeping the key points. Only output the summary, nothing else."}];function np(){const t=Bn("templates",window.location.hostname),e=localStorage.getItem(t),n=e?JSON.parse(e):tp.map(f=>({id:Jn(),...f,createdAt:Date.now()})),r=S(n);e||localStorage.setItem(t,JSON.stringify(n));function o(){localStorage.setItem(t,JSON.stringify(r.value))}function i(f,p){if(!f||!p)return;const d=f.trim(),m=p.trim();if(!d||!m)return;const g={id:Jn(),name:d,prompt:m,createdAt:Date.now()};return r.value.unshift(g),r.value.length>Vn&&(r.value=r.value.slice(0,Vn)),o(),g}function s(f,p){const d=r.value.findIndex(m=>m.id===f);return d===-1?!1:(r.value[d]={...r.value[d],...p},o(),!0)}function a(f){const p=r.value.findIndex(d=>d.id===f);return p===-1?!1:(r.value.splice(p,1),o(),!0)}function l(){r.value=[],o()}function c(f){const p=[...r.value],d=[];for(const m of f){if(!m.name||!m.prompt)continue;const g=m.name.trim(),y=m.prompt.trim();if(!g||!y)continue;let b=p.findIndex(k=>k.name===g);if(b===-1&&(b=p.findIndex(k=>k.prompt===y)),b!==-1){const k=p.splice(b,1)[0];d.push({...k,name:g,prompt:y})}else d.push({id:Jn(),name:g,prompt:y,createdAt:Date.now()})}r.value=d.slice(0,Vn),o()}function u(f){return r.value.find(p=>p.id===f)}return{templates:r,addTemplate:i,updateTemplate:s,deleteTemplate:a,clearTemplates:l,setTemplates:c,getTemplate:u}}const rp={list:"rich-text",markdown:"markdown",textarea:"markdown",writer:"rich-text"};function op(t){return rp[t]||"text"}function Qt(t,e,n){if(Array.isArray(t)){for(const o of t){const i=Qt(o,e,n);if(i)return i}return}const r=t;if(r.name===e&&(!n||r.type===n))return r;if(r.fieldsets){for(const o of Object.values(r.fieldsets))if(o.tabs){for(const i of Object.values(o.tabs))if(i.fields)for(const s of Object.values(i.fields)){const a=Qt(s,e,n);if(a)return a}}}if(r.fields)for(const o of Object.values(r.fields)){const i=Qt(o,e,n);if(i)return i}}const ip=Object.assign({inheritAttrs:!1},{__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String}},emits:["input"],setup(t,{expose:e,emit:n}){const r=t,o=S(),i=X({get(){return r.value},set(u){n("input",u)}}),s=S({start:0,end:0});function a(){o.value&&(s.value={start:o.value.selectionStart,end:o.value.selectionEnd})}function l(u){const{start:f,end:p}=s.value,d=r.value,m=d.slice(0,f)+u+d.slice(p);n("input",m),requestAnimationFrame(()=>{if(o.value){o.value.focus();const g=f+u.length;o.value.setSelectionRange(g,g),s.value={start:g,end:g}}})}function c(){var u;(u=o.value)==null||u.focus()}return e({insertAtCursor:l,focus:c,el:o}),{__sfc:!0,props:r,emit:n,textarea:o,text:i,cursorPosition:s,updateCursorPosition:a,insertAtCursor:l,focus:c}}});var sp=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",e._b({directives:[{name:"model",rawName:"v-model",value:r.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:e.sharedClass,domProps:{value:r.text},on:{mouseup:r.updateCursorPosition,keyup:r.updateCursorPosition,focus:r.updateCursorPosition,input:function(o){o.target.composing||(r.text=o.target.value)}}},"textarea",e.$attrs,!1)),e._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:e.sharedClass,domProps:{textContent:e._s(`${e.value} `)}})])},ap=[],lp=qe(ip,sp,ap,!1,null,"e9afba17");const cp=lp.exports,up={__name:"ContentDropdown",emits:["close"],setup(t,{expose:e,emit:n}){const r=S();function o(){var a;(a=r.value)==null||a.close()}function i(a){var l;(l=r.value)==null||l.open(a)}function s(){var a;(a=r.value)==null||a.toggle()}return e({close:o,open:i,toggle:s}),{__sfc:!0,emit:n,dropdown:r,close:o,open:i,toggle:s}}};var fp=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("k-dropdown-content",{ref:"dropdown",staticClass:"k-copilot-dropdown-content",attrs:{"align-x":"start",navigate:!1}},[n("k-navigate",{attrs:{element:"nav",axis:"y",select:"input[type=search], label, .k-copilot-dropdown-content-body button"},on:{prev:function(o){return r.emit("close")}}},[e._t("default")],2)],1)},pp=[],dp=qe(up,fp,pp,!1,null,null);const hp=dp.exports,mp={__name:"Prompt",props:{fields:Array,selection:String,userPrompt:String,activeField:Object},emits:["cancel","close","input","submit","success"],setup(t,{emit:e}){const n=t,r=dt(),o=T(),{lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:l,getRecentEntries:c}=Gf(),{templates:u,addTemplate:f,setTemplates:p}=np(),{getViewFields:d}=Ro(),m=Cr(),g=S(),y=X(()=>{var w;return(w=g.value)==null?void 0:w.el}),b=S(n.userPrompt||""),k=S([]),z=S(),I=S([...n.fields??[]]),E=S(),N=S([]),W=S(),U=S(!1),xe=S(""),pe=S(),ye=S(),C=[{value:"replace",text:o.t("johannschopplich.copilot.replace")},{value:"append",text:o.t("johannschopplich.copilot.append")}],G=S(C[0].value),De=X(()=>n.fields&&n.fields.length>0),Ct=X(()=>c(10)),ut=X(()=>{const w=b.value.match(Tr);return w?w.map(Z=>Z.slice(1,-1)).some(Z=>Z in m):!1}),ft=X(()=>$r(b.value,m,w=>`{${w}}`).trim()),Pt=X(()=>[{name:"title",label:o.t("title")},...I.value]),It=X(()=>{const w=xe.value.toLowerCase();return w.trim()?Pt.value.filter(M=>M.name.toLowerCase().includes(w)||M.label&&M.label.toLowerCase().includes(w)):Pt.value});Ff(y,"keydown",w=>{if((w.metaKey||w.ctrlKey)&&w.key==="Enter"){if(w.preventDefault(),!b.value.trim()||De.value&&N.value.length===0)return;Y()}if(w.key==="ArrowUp"&&w.target.selectionStart===0||w.key==="ArrowDown"&&w.target.selectionStart===w.target.value.length){w.preventDefault(),w.key==="ArrowUp"&&s.value===-1&&(i.value=b.value);const M=l(w.key==="ArrowUp"?"up":"down");M!==void 0&&(b.value=M)}}),(async()=>{var M;const w=await ke();if(z.value=w.licenseStatus,n.fields||(I.value=await d()),n.activeField){const Z=Qt(I.value,n.activeField.name,n.activeField.type);typeof((M=Z==null?void 0:Z.copilot)==null?void 0:M.userPrompt)=="string"&&(b.value=Z.copilot.userPrompt)}})();function Y(){if(De.value&&N.value.length===0){o.notification.info(o.t("johannschopplich.copilot.selectFields"));return}a(b.value),e("submit",{prompt:b.value,files:k.value,fields:N.value,insertMode:G.value})}async function de(){const w=await Lo();k.value=[...k.value,...w]}function D(){var w;U.value||(xe.value=""),U.value=!U.value,(w=W.value)==null||w.toggle()}function We(w){var Z;const M=`{${w}}`;(Z=g.value)==null||Z.insertAtCursor(M),U.value=!1}function Nt(w){var M,Z;b.value=w.prompt,(M=pe.value)==null||M.close(),(Z=y.value)==null||Z.focus()}function ve(){o.dialog.open({component:"k-form-dialog",props:{fields:{name:{label:o.t("johannschopplich.copilot.template.name"),type:"text",required:!0,autofocus:!0}},value:{name:""}},on:{submit(w){w.name&&f(w.name,b.value),o.dialog.close()}}})}function te(){o.dialog.open({component:"k-form-dialog",props:{size:"huge",fields:{templates:{label:o.t("johannschopplich.copilot.templates"),type:"structure",empty:o.t("johannschopplich.copilot.template.empty"),columns:{name:{label:o.t("johannschopplich.copilot.template.name"),width:"1/3"},prompt:{label:o.t("johannschopplich.copilot.prompt.label"),width:"2/3"}},fields:{name:{label:o.t("johannschopplich.copilot.template.name"),type:"text",required:!0},prompt:{label:o.t("johannschopplich.copilot.prompt.label"),type:"textarea",required:!0}}}},value:{templates:u.value.map(w=>({name:w.name,prompt:w.prompt}))}},on:{submit(w){p(w.templates),o.dialog.close()}}})}function pt(w){var M,Z;b.value=w,(M=ye.value)==null||M.close(),(Z=y.value)==null||Z.focus()}function be(w){const M=m[w]??"",Z=String(M);return Z.length>30?`${Z.slice(0,30)}…`:Z}return{__sfc:!0,props:n,emit:e,_isKirby5:r,panel:o,lastPrompt:i,currentIndex:s,addToHistory:a,navigateHistory:l,getRecentEntries:c,templates:u,addTemplate:f,setTemplates:p,getViewFields:d,contentContext:m,textareaComponent:g,textarea:y,prompt:b,files:k,licenseStatus:z,modelFields:I,fieldsDropdown:E,selectedFieldNames:N,placeholderDropdown:W,isPlaceholderDropdownOpen:U,placeholderSearch:xe,templateDropdown:pe,historyDropdown:ye,selectionInsertOptions:C,insertOption:G,isFieldGenerationMode:De,recentPrompts:Ct,hasPlaceholders:ut,resolvedPrompt:ft,placeholderFields:Pt,filteredPlaceholderFields:It,submit:Y,pickFiles:de,togglePlaceholderDropdown:D,insertFieldPlaceholder:We,loadTemplate:Nt,openSaveTemplateDialog:ve,openEditTemplatesDialog:te,loadPromptFromHistory:pt,getFieldPreview:be,LicensingButtonGroup:zr,AutoGrowTextarea:cp,ContentDropdown:hp}}};var gp=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(o){return r.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] has-[textarea:focus]:kai-outline has-[textarea:focus]:kai-outline-[2px] has-[textarea:focus]:kai-outline-[var(--color-focus)]"},[n(r.AutoGrowTextarea,{ref:"textareaComponent",attrs:{value:r.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:r.panel.t("johannschopplich.copilot.prompt.placeholder")+(e.selection?` (${r.panel.t("johannschopplich.copilot.prompt.selectionContext")})`:""),rows:"3"},on:{input:function(o){r.prompt=o}}}),r.hasPlaceholders?n("details",{staticClass:"kai-group kai-mx-2 kai-mb-2 kai-rounded-[var(--rounded)] kai-bg-[var(--color-background)]"},[n("summary",{staticClass:"kai-flex kai-cursor-pointer kai-list-none kai-items-center kai-gap-0.5 kai-rounded-[var(--rounded)] kai-p-1.5 focus:kai-outline focus:kai-outline-[2px] focus:kai-outline-[var(--color-focus)] [&::-webkit-details-marker]:kai-hidden"},[n("k-icon",{staticClass:"kai-size-[var(--icon-size)] kai-transition-transform [transform:rotate(-90deg)] group-open:[transform:rotate(0deg)]",attrs:{type:"angle-dropdown"}}),n("span",[e._v(e._s(r.panel.t("johannschopplich.copilot.preview")))])],1),n("div",{staticClass:"kai-px-1.5 kai-py-2"},[n("p",{staticClass:"kai-whitespace-pre-wrap kai-leading-[1.375]",domProps:{textContent:e._s(r.resolvedPrompt)}})])]):e._e(),n("div",{staticClass:"kai-flex kai-items-center kai-justify-between kai-px-2 kai-pb-2"},[n("div",{staticClass:"kai-flex kai-flex-wrap kai-items-center kai-gap-1"},[n("k-button",{attrs:{icon:"attachment",badge:r._isKirby5&&r.files.length>0?{theme:"notice",text:r.files.length}:void 0,"aria-label":r.files.length>0?`${r.panel.t("johannschopplich.copilot.files.select")} (${r.files.length})`:r.panel.t("johannschopplich.copilot.files.select")},on:{click:function(o){return r.pickFiles()}}}),r.files.length>0?n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(o){r.files=[]}}}):e._e(),n("k-button",{staticClass:"max-sm:kai-hidden",attrs:{icon:"copilot-text-snippet",dropdown:!0,"aria-label":r.panel.t("johannschopplich.copilot.placeholder.insert")},on:{click:function(o){return r.togglePlaceholderDropdown()}}}),n(r.ContentDropdown,{ref:"placeholderDropdown",on:{close:function(o){r.isPlaceholderDropdownOpen=!1}}},[r.modelFields.length>5?n("header",{staticClass:"k-copilot-dropdown-content-header"},[n("div",{staticClass:"k-copilot-dropdown-content-search"},[n("k-search-input",{attrs:{value:r.placeholderSearch,type:"text",placeholder:r.panel.t("johannschopplich.copilot.placeholder.search")},on:{input:function(o){r.placeholderSearch=o}},nativeOn:{click:function(o){o.stopPropagation()},keydown:[function(o){o.stopPropagation()},function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"escape",void 0,o.key,void 0)?null:(o.preventDefault(),r.togglePlaceholderDropdown())}]}})],1)]):e._e(),n("div",{staticClass:"k-copilot-dropdown-content-body"},[e._l(r.filteredPlaceholderFields,function(o){return n("k-dropdown-item",{key:o.name,on:{click:function(i){return r.insertFieldPlaceholder(o.name)}}},[n("span",{staticClass:"kai-inline-flex kai-w-full kai-items-center kai-gap-3"},[n("span",[e._v(e._s(o.label||o.name))]),r.getFieldPreview(o.name)?n("span",{staticClass:"kai-truncate kai-leading-[1.5] kai-text-[var(--color-text-dimmed)] [font-size:var(--font-size-tiny)]"},[e._v(e._s(r.getFieldPreview(o.name)))]):e._e()])])}),r.filteredPlaceholderFields.length===0?n("k-dropdown-item",{attrs:{disabled:""}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.placeholder.notFound"))+" ")]):e._e()],2)]),n("k-button",{staticClass:"max-sm:kai-hidden",attrs:{icon:"bookmark",dropdown:!0,"aria-label":r.panel.t("johannschopplich.copilot.templates")},on:{click:function(o){var i;(i=r.templateDropdown)==null||i.toggle()}}}),n(r.ContentDropdown,{ref:"templateDropdown"},[n("div",{staticClass:"k-copilot-dropdown-content-body"},[r.prompt.trim()?n("k-dropdown-item",{attrs:{icon:"add"},on:{click:function(o){return r.openSaveTemplateDialog()}}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.template.saveAs"))+" ")]):e._e(),r.templates.length>0?n("k-dropdown-item",{attrs:{icon:"settings"},on:{click:function(o){return r.openEditTemplatesDialog()}}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.template.edit"))+" ")]):e._e(),r.templates.length>0?n("hr"):e._e(),e._l(r.templates,function(o){return n("k-dropdown-item",{key:o.id,on:{click:function(i){return r.loadTemplate(o)}}},[n("span",{staticClass:"kai-truncate"},[e._v(e._s(o.name))])])}),r.templates.length===0?n("k-dropdown-item",{attrs:{disabled:""}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.template.empty"))+" ")]):e._e()],2)]),r.recentPrompts.length>0?[n("k-button",{staticClass:"max-sm:kai-hidden",attrs:{icon:"clock","aria-label":r.panel.t("johannschopplich.copilot.history"),dropdown:!0},on:{click:function(o){var i;(i=r.historyDropdown)==null||i.toggle()}}}),n(r.ContentDropdown,{ref:"historyDropdown"},[n("div",{staticClass:"k-copilot-dropdown-content-body"},e._l(r.recentPrompts,function(o,i){return n("k-dropdown-item",{key:i,on:{click:function(s){return r.loadPromptFromHistory(o)}}},[n("span",{staticClass:"kai-truncate"},[e._v(e._s(o))])])}),1)])]:e._e()],2),n("div",{staticClass:"kai-flex kai-gap-2"},[r.isFieldGenerationMode?[n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.fields"),variant:"filled",badge:r.selectedFieldNames.length>0?{theme:"info",text:r.selectedFieldNames.length}:void 0,dropdown:""},on:{click:function(o){var i;(i=r.fieldsDropdown)==null||i.toggle()}}}),n("k-picklist-dropdown",{ref:"fieldsDropdown",attrs:{options:r.modelFields.map(o=>({value:o.name,text:o.label||o.name})),empty:!1,value:r.selectedFieldNames},on:{input:function(o){r.selectedFieldNames=o}}})]:e.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:r.selectionInsertOptions,empty:!1,value:r.insertOption},on:{input:function(o){r.insertOption=o}}}):e._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling",disabled:!r.prompt.trim()},on:{click:function(o){return r.submit()}}},[e._v(" "+e._s(r.panel.t("johannschopplich.copilot.generate"))+" ")])],2)]),r.licenseStatus!==void 0?n(r.LicensingButtonGroup,{staticClass:"k-copilot-prompt-dialog-licensing-buttons kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px-2px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":r.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):e._e()],1)])},yp=[],vp=qe(mp,gp,yp,!1,null,null);const bp=vp.exports,Zo={...{blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number}},_p=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:Zo,setup(t){const e=t,n=dt(),r=T(),{t:o}=ts(),{currentContent:i,update:s}=yn(),a=S(),l=S(),c=S(),u=S(),f=S(),p=S(),d=S(),m=S(),g=S(),y=S(),b=S(),k=S(),z=S(!1),I=S(!1),E=S(!1),N=S(),W=S(),U=S(),xe=S([]),pe=S([]),ye=S();let C,G;const De=X(()=>!I.value&&U.value!==void 0);_n(W,Y=>{z.value&&f.value&&(Y&&Y!==c.value?localStorage.setItem(`${C}$prompt`,Y):(!Y||Y===c.value)&&localStorage.removeItem(`${C}$prompt`))}),_n(E,Y=>{z.value&&f.value&&(Y?localStorage.setItem(`${C}$open`,"true"):localStorage.removeItem(`${C}$open`))}),(async()=>{var We;const{load:Y}=ns(),[de,D]=await Promise.all([ke(),Y({parent:e.parent,name:e.name})]);if(a.value=o(D.label)||r.t("johannschopplich.copilot.label"),l.value=D.field??void 0,c.value=D.userPrompt??void 0,u.value=D.systemPrompt||de.config.systemPrompt||Sn,f.value=D.storage,D.editable===!0&&xe.value.push("edit"),D.files===!0&&xe.value.push("files"),p.value=D.icon||"sparkling",d.value=D.theme||"notice-icon",m.value=D.size||"md",g.value=Ge.indexOf(D.logLevel&&Ge.includes(D.logLevel)?D.logLevel:de.config.logLevel&&Ge.includes(de.config.logLevel)?de.config.logLevel:xr),b.value=D.help?o(D.help):void 0,k.value=de.config,ye.value=de.licenseStatus,D.files==="auto"&&D.modelFile){y.value=D.modelFile;const{mime:Nt,url:ve}=D.modelFile;zn.includes(Nt)&&fetch(ve).then(te=>te.blob()).then(te=>{pe.value=[te]})}f.value&&((We=l.value)!=null&&We.name)&&(C=Bn(r.view.path,l.value.name.toLowerCase()),W.value=localStorage.getItem(`${C}$prompt`)||c.value||"",E.value=localStorage.getItem(`${C}$open`)==="true"||D.open,cs(()=>{N.value&&E.value&&(N.value.open=!0)})),r.events.on("view.save",It),z.value=!0})(),us(()=>{r.events.off("view.save",It)});async function Ct(){if(!W.value){r.notification.error(r.t("johannschopplich.copilot.prompt.empty"));return}r.isLoading=!0,I.value=!0,U.value=i.value[l.value.name.toLowerCase()],G=new AbortController;const{getZodSchema:Y,normalizeBlock:de}=Ht(),{getZodSchema:D,normalizeLayout:We}=Un(),{Output:Nt}=await Oe("ai"),{signal:ve}=G;try{let te="",pt=[];if(l.value.type==="layout"||l.value.type==="blocks"){const be=l.value.type==="layout"?D:Y,w=l.value.type==="layout"?We:de,M=await be(l.value),{partialOutputStream:Z,output:Yi}=await Rt({userPrompt:W.value,systemPrompt:u.value,output:Nt.array({element:M}),files:pe.value,logLevel:g.value,abortSignal:ve});Yi.catch(()=>{});for await(const kr of Z){if(ve.aborted)return;!kr||!Array.isArray(kr)||await s({[l.value.name.toLowerCase()]:[...U.value,...kr.map(w)]},!1)}pt=await Yi}else{const be=op(l.value.type),{textStream:w}=await Rt({userPrompt:Er(W.value,{responseFormat:be}),systemPrompt:u.value,responseFormat:be,files:pe.value,logLevel:g.value,abortSignal:ve});for await(const M of w){if(ve.aborted)return;te+=M,await s({[l.value.name.toLowerCase()]:U.value+te},!1)}}if(ve.aborted)return;await s({[l.value.name.toLowerCase()]:l.value.type==="layout"||l.value.type==="blocks"?[...U.value,...(pt??[]).map(l.value.type==="layout"?We:de)]:U.value+te}),r.notification.success({icon:"check",message:r.t("johannschopplich.copilot.notification.success")})}catch(te){if(ve.aborted)return;const{AISDKError:pt}=await Oe("ai");if(te instanceof He||pt.isInstance(te)){let be=te.message;be.includes("levels of nesting exceeds limit")&&(be=`The ${l.value.type} generation for the "${l.value.name}" field exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas.`),console.error(te),r.notification.error(be);return}console.error(te),r.notification.error(r.t("johannschopplich.copilot.notification.error"))}finally{G=void 0,r.isLoading=!1,I.value=!1}}function ut(){G==null||G.abort(),G=void 0,r.isLoading=!1,I.value=!1}function ft(){s({[l.value.name.toLowerCase()]:U.value}),U.value=void 0}async function Pt(){const Y=await Lo();pe.value=[...pe.value,...Y]}function It(){De.value&&(U.value=void 0)}return{__sfc:!0,propsDefinition:Zo,props:e,_isKirby5:n,panel:r,t:o,currentContent:i,updateContent:s,label:a,field:l,userPrompt:c,systemPrompt:u,storage:f,icon:p,theme:d,size:m,logLevel:g,modelFile:y,help:b,config:k,isInitialized:z,isGenerating:I,isDetailsOpen:E,detailsElement:N,currentPrompt:W,currentFieldContent:U,permissions:xe,files:pe,licenseStatus:ye,storageKey:C,abortController:G,canUndo:De,generate:Ct,abort:ut,undo:ft,pickFiles:Pt,onModelSave:It,LicensingButtonGroup:zr,SUPPORTED_IMAGE_MIME_TYPES:zn,SUPPORTED_PROVIDERS:wn}}});var kp=function(){var o,i,s,a;var e=this,n=e._self._c,r=e._self._setupProxy;return r.isInitialized?n("k-section",{attrs:{label:r.label}},[r.licenseStatus!==void 0?n("template",{slot:"options"},[n(r.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":r.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):e._e(),!r.config.provider||!r.SUPPORTED_PROVIDERS.includes(r.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Unsupported provider "),n("code",[e._v(e._s(r.config.provider))]),e._v(" in the "),n("code",[e._v("johannschopplich.copilot.provider")]),e._v(" global configuration. ")])],1):(i=(o=r.config.providers)==null?void 0:o[r.config.provider])!=null&&i.model?!r.field||typeof r.field=="string"||typeof r.field=="object"&&!(((s=r.field)==null?void 0:s.name.toLowerCase())in r.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" The "),n("code",[e._v(e._s(((a=r.field)==null?void 0:a.name)??r.field))]),e._v(" field does not exist in the current model. ")])],1):!r.permissions.includes("edit")&&!r.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" If the user prompt cannot be edited by the user, a default "),n("code",[e._v("userPrompt")]),e._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:r.isGenerating?"loader":r.icon,text:r.panel.t("johannschopplich.copilot.generate"),theme:r.theme,variant:"filled",size:r.size,disabled:r.isGenerating},on:{click:function(l){return r.generate()}}}),r.isGenerating?n("k-button",{attrs:{icon:"cancel",text:r.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:r.size},on:{click:function(l){return r.abort()}}}):e._e(),r.canUndo?n("k-button",{attrs:{icon:"undo",text:r.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:r.size},on:{click:function(l){return r.undo()}}}):e._e()],1),r.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(l){r.isDetailsOpen=l.target.open}}},[n("summary",[e._v(" "+e._s([...r.permissions.includes("edit")?[r.panel.t("johannschopplich.copilot.prompt.label")]:[],...r.permissions.includes("files")?[r.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[r.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:r.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:r.currentPrompt,placeholder:r.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(l){r.currentPrompt=l}}})],1):e._e(),r.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:r.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:r._isKirby5&&r.files.length>0?{theme:"notice",text:r.files.length}:void 0,size:"sm"},on:{click:function(l){return r.pickFiles()}}}),r.files.length>0?n("k-button",{attrs:{text:r.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(l){r.files=[]}}}):e._e(),r.permissions.includes("edit")&&r.userPrompt&&r.currentPrompt!==r.userPrompt?n("k-button",{staticClass:"kai-ml-auto",attrs:{icon:"undo",text:r.panel.t("johannschopplich.copilot.context.reset"),variant:"dimmed",size:"xs"},on:{click:function(l){r.currentPrompt=r.userPrompt}}}):e._e()],1):r.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[e._v(" "+e._s(r.panel.t(`johannschopplich.copilot.context.file.${r.SUPPORTED_IMAGE_MIME_TYPES.includes(r.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):e._e()],1)]):e._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Missing "),n("code",[e._v("model")]),e._v(" property in the "),n("code",[e._v(e._s(`johannschopplich.copilot.providers.${r.config.provider}`))]),e._v(" global configuration. ")])],1),r.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:r.help}})],1):e._e()],2):e._e()},wp=[],Sp=qe(_p,kp,wp,!1,null,null);const zp=Sp.exports;function jo(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let o=t.child(r),i=e.child(r);if(o==i){n+=o.nodeSize;continue}if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(let s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){let s=jo(o.content,i.content,n+1);if(s!=null)return s}n+=o.nodeSize}}function Bo(t,e,n,r){for(let o=t.childCount,i=e.childCount;;){if(o==0||i==0)return o==i?null:{a:n,b:r};let s=t.child(--o),a=e.child(--i),l=s.nodeSize;if(s==a){n-=l,r-=l;continue}if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){let c=0,u=Math.min(s.text.length,a.text.length);for(;c<u&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){let c=Bo(s.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class x{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,o=0,i){for(let s=0,a=0;a<n;s++){let l=this.content[s],c=a+l.nodeSize;if(c>e&&r(l,o+a,i||null,s)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,o+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,o){let i="",s=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?o?typeof o=="function"?o(a):o:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(s?s=!1:i+=r),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,o=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(o[o.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)o.push(e.content[i]);return new x(o,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],o=0;if(n>e)for(let i=0,s=0;s<n;i++){let a=this.content[i],l=s+a.nodeSize;l>e&&((s<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-s),Math.min(a.text.length,n-s)):a=a.cut(Math.max(0,e-s-1),Math.min(a.content.size,n-s-1))),r.push(a),o+=a.nodeSize),s=l}return new x(r,o)}cutByIndex(e,n){return e==n?x.empty:e==0&&n==this.content.length?this:new x(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let o=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return o[e]=n,new x(o,i)}addToStart(e){return new x([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new x(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let o=this.content[n];e(o,r,n),r+=o.nodeSize}}findDiffStart(e,n=0){return jo(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return Bo(this,e,n,r)}findIndex(e){if(e==0)return en(0,e);if(e==this.size)return en(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let o=this.child(n),i=r+o.nodeSize;if(i>=e)return i==e?en(n+1,i):en(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return x.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new x(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return x.empty;let n,r=0;for(let o=0;o<e.length;o++){let i=e[o];r+=i.nodeSize,o&&i.isText&&e[o-1].sameMarkup(i)?(n||(n=e.slice(0,o)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new x(n||e,r)}static from(e){if(!e)return x.empty;if(e instanceof x)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new x([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}x.empty=new x([],0);const Kn={index:0,offset:0};function en(t,e){return Kn.index=t,Kn.offset=e,Kn}function Wn(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Wn(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Wn(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}class le{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let o=0;o<e.length;o++){let i=e[o];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,o));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,o)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Wn(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let o=r.create(n.attrs);return r.checkAttrs(o.attrs),o}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return le.none;if(e instanceof le)return[e];let n=e.slice();return n.sort((r,o)=>r.type.rank-o.type.rank),n}}le.none=[];class xp extends Error{}class O{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=Jo(this.content,e+this.openStart,n);return r&&new O(r,this.openStart,this.openEnd)}removeBetween(e,n){return new O(Uo(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return O.empty;let r=n.openStart||0,o=n.openEnd||0;if(typeof r!="number"||typeof o!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new O(x.fromJSON(e,n.content),r,o)}static maxOpen(e,n=!0){let r=0,o=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)o++;return new O(e,r,o)}}O.empty=new O(x.empty,0,0);function Uo(t,e,n){let{index:r,offset:o}=t.findIndex(e),i=t.maybeChild(r),{index:s,offset:a}=t.findIndex(n);if(o==e||i.isText){if(a!=n&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(Uo(i.content,e-o-1,n-o-1)))}function Jo(t,e,n,r){let{index:o,offset:i}=t.findIndex(e),s=t.maybeChild(o);if(i==e||s.isText)return r&&!r.canReplace(o,o,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=Jo(s.content,e-i-1,n,s);return a&&t.replaceChild(o,s.copy(a))}function Op(t){return t.tag!=null}function Ep(t){return t.style!=null}class bt{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(o=>{if(Op(o))this.tags.push(o);else if(Ep(o)){let i=/[^=]*/.exec(o.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(o)}}),this.normalizeLists=!this.tags.some(o=>{if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;let i=e.nodes[o.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new qo(this,n,!1);return r.addAll(e,le.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new qo(this,n,!0);return r.addAll(e,le.none,n.from,n.to),O.maxOpen(r.finish())}matchTag(e,n,r){for(let o=r?this.tags.indexOf(r)+1:0;o<this.tags.length;o++){let i=this.tags[o];if(Cp(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let s=i.getAttrs(e);if(s===!1)continue;i.attrs=s||void 0}return i}}}matchStyle(e,n,r,o){for(let i=o?this.styles.indexOf(o)+1:0;i<this.styles.length;i++){let s=this.styles[i],a=s.style;if(!(a.indexOf(e)!=0||s.context&&!r.matchesContext(s.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(s.getAttrs){let l=s.getAttrs(n);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let n=[];function r(o){let i=o.priority==null?50:o.priority,s=0;for(;s<n.length;s++){let a=n[s];if((a.priority==null?50:a.priority)<i)break}n.splice(s,0,o)}for(let o in e.marks){let i=e.marks[o].spec.parseDOM;i&&i.forEach(s=>{r(s=Go(s)),s.mark||s.ignore||s.clearMark||(s.mark=o)})}for(let o in e.nodes){let i=e.nodes[o].spec.parseDOM;i&&i.forEach(s=>{r(s=Go(s)),s.node||s.ignore||s.mark||(s.node=o)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new bt(e,bt.schemaRules(e)))}}const Vo={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Tp={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Ko={ol:!0,ul:!0},_t=1,qn=2,kt=4;function Wo(t,e,n){return e!=null?(e?_t:0)|(e==="full"?qn:0):t&&t.whitespace=="pre"?_t|qn:n&~kt}class tn{constructor(e,n,r,o,i,s){this.type=e,this.attrs=n,this.marks=r,this.solid=o,this.options=s,this.content=[],this.activeMarks=le.none,this.match=i||(s&kt?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(x.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,o;return(o=r.findWrapping(e.type))?(this.match=r,o):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&_t)){let r=this.content[this.content.length-1],o;if(r&&r.isText&&(o=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-o[0].length))}}let n=x.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(x.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Vo.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class qo{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let o=n.topNode,i,s=Wo(null,n.preserveWhitespace,0)|(r?kt:0);o?i=new tn(o.type,o.attrs,le.none,!0,n.topMatch||o.type.contentMatch,s):r?i=new tn(null,null,le.none,!0,null,s):i=new tn(e.schema.topNodeType,null,le.none,!0,null,s),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,o=this.top,i=o.options&qn?"full":this.localPreserveWS||(o.options&_t)>0,{schema:s}=this.parser;if(i==="full"||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(s.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(s.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(s.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(s.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(s.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let o=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),a;Ko.hasOwnProperty(s)&&this.parser.normalizeLists&&$p(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:Tp.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(Vo.hasOwnProperty(s))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=o}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let o=0;o<this.parser.matchedStyles.length;o++){let i=this.parser.matchedStyles[o],s=r.getPropertyValue(i);if(s)for(let a=void 0;;){let l=this.parser.matchStyle(i,s,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,o){let i,s;if(n.node)if(s=this.parser.schema.nodes[n.node],s.isLeaf)this.insertNode(s.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(s,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(s&&s.isLeaf)this.findInside(e);else if(o)this.addElement(e,r,o);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,o){let i=r||0;for(let s=r?e.childNodes[r]:e.firstChild,a=o==null?null:e.childNodes[o];s!=a;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s,n);this.findAtPoint(e,i)}findPlace(e,n,r){let o,i;for(let s=this.open,a=0;s>=0;s--){let l=this.nodes[s],c=l.findWrapping(e);if(c&&(!o||o.length>c.length+a)&&(o=c,i=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!o)return null;this.sync(i);for(let s=0;s<o.length;s++)n=this.enterInner(o[s],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let o=this.findPlace(e,n,r);if(o){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let s=le.none;for(let a of o.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):Ho(a.type,e.type))&&(s=a.addToSet(s));return i.content.push(e.mark(s)),!0}return!1}enter(e,n,r,o){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,o)),i}enterInner(e,n,r,o=!1,i){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let a=Wo(e,i,s.options);s.options&kt&&s.content.length==0&&(a|=kt);let l=le.none;return r=r.filter(c=>(s.type?s.type.allowsMarkType(c.type):Ho(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new tn(e,n,l,o,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=_t)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let o=r.length-1;o>=0;o--)e+=r[o].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let o=0;o<this.find.length;o++)this.find[o].pos==null&&e.nodeType==1&&e.contains(this.find[o].node)&&n.compareDocumentPosition(this.find[o].node)&(r?2:4)&&(this.find[o].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(s(a-1,l))return!0;return!1}else{let u=l>0||l==0&&o?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return s(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function $p(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Ko.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function Cp(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Go(t){let e={};for(let n in t)e[n]=t[n];return e}function Ho(t,e){let n=e.schema.nodes;for(let r in n){let o=n[r];if(!o.allowsMarkType(t))continue;let i=[],s=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&s(u))return!0}};if(s(o.contentMatch))return!0}}class nn{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=Gn(n).createDocumentFragment());let o=r,i=[];return e.forEach(s=>{if(i.length||s.marks.length){let a=0,l=0;for(;a<i.length&&l<s.marks.length;){let c=s.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)o=i.pop()[1];for(;l<s.marks.length;){let c=s.marks[l++],u=this.serializeMark(c,s.isInline,n);u&&(i.push([c,o]),o.appendChild(u.dom),o=u.contentDOM||u.dom)}}o.appendChild(this.serializeNodeInner(s,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:o}=rn(Gn(n),this.nodes[e.type.name](e),null,e.attrs);if(o){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,o)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let o=e.marks.length-1;o>=0;o--){let i=this.serializeMark(e.marks[o],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let o=this.marks[e.type.name];return o&&rn(Gn(r),o(e,n),null,e.attrs)}static renderSpec(e,n,r=null,o){return rn(e,n,r,o)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new nn(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=Yo(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return Yo(e.marks)}}function Yo(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Gn(t){return t.document||window.document}const Xo=new WeakMap;function Pp(t){let e=Xo.get(t);return e===void 0&&Xo.set(t,e=Ip(t)),e}function Ip(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let o=0;o<r.length;o++)n(r[o]);else for(let o in r)n(r[o])}return n(t),e}function rn(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let o=e[0],i;if(typeof o!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=Pp(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=o.indexOf(" ");s>0&&(n=o.slice(0,s),o=o.slice(s+1));let a,l=n?t.createElementNS(n,o):t.createElement(o),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let f in c)if(c[f]!=null){let p=f.indexOf(" ");p>0?l.setAttributeNS(f.slice(0,p),f.slice(p+1),c[f]):f=="style"&&l.style?l.style.cssText=c[f]:l.setAttribute(f,c[f])}}for(let f=u;f<e.length;f++){let p=e[f];if(p===0){if(f<e.length-1||f>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:d,contentDOM:m}=rn(t,p,n,r);if(l.appendChild(d),m){if(a)throw new RangeError("Multiple content holes");a=m}}}return{dom:l,contentDOM:a}}const Qo=65535,ei=Math.pow(2,16);function Np(t,e){return t+e*ei}function ti(t){return t&Qo}function Ap(t){return(t-(t&Qo))/ei}const ni=1,ri=2,on=4,oi=8;class ii{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&oi)>0}get deletedBefore(){return(this.delInfo&(ni|on))>0}get deletedAfter(){return(this.delInfo&(ri|on))>0}get deletedAcross(){return(this.delInfo&on)>0}}class oe{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&oe.empty)return oe.empty}recover(e){let n=0,r=ti(e);if(!this.inverted)for(let o=0;o<r;o++)n+=this.ranges[o*3+2]-this.ranges[o*3+1];return this.ranges[r*3]+n+Ap(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let o=0,i=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?o:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+s],f=l+c;if(e<=f){let p=c?e==l?-1:e==f?1:n:n,d=l+o+(p<0?0:u);if(r)return d;let m=e==(n<0?l:f)?null:Np(a/3,e-l),g=e==l?ri:e==f?ni:on;return(n<0?e!=l:e!=f)&&(g|=oi),new ii(d,g,m)}o+=u-c}return r?e+o:new ii(e+o,0,null)}touches(e,n){let r=0,o=ti(n),i=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==o*3)return!0;r+=this.ranges[a+s]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let o=0,i=0;o<this.ranges.length;o+=3){let s=this.ranges[o],a=s-(this.inverted?i:0),l=s+(this.inverted?0:i),c=this.ranges[o+n],u=this.ranges[o+r];e(a,a+c,l,l+u),i+=u-c}}invert(){return new oe(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?oe.empty:new oe(e<0?[0,-e,0]:[0,0,e])}}oe.empty=new oe([]);const Hn=Object.create(null);class H{getMap(){return oe.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Hn[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Hn)throw new RangeError("Duplicate use of step JSON ID "+e);return Hn[e]=n,n.prototype.jsonID=e,n}}class V{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new V(e,null)}static fail(e){return new V(null,e)}static fromReplace(e,n,r,o){try{return V.ok(e.replace(n,r,o))}catch(i){if(i instanceof xp)return V.fail(i.message);throw i}}}function Yn(t,e,n){let r=[];for(let o=0;o<t.childCount;o++){let i=t.child(o);i.content.size&&(i=i.copy(Yn(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return x.fromArray(r)}class Fe extends H{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new O(Yn(n.content,(s,a)=>!s.isAtom||!a.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),o),n.openStart,n.openEnd);return V.fromReplace(e,this.from,this.to,i)}invert(){return new Ze(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Fe(n.pos,r.pos,this.mark)}merge(e){return e instanceof Fe&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Fe(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Fe(n.from,n.to,e.markFromJSON(n.mark))}}H.jsonID("addMark",Fe);class Ze extends H{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new O(Yn(n.content,o=>o.mark(this.mark.removeFromSet(o.marks)),e),n.openStart,n.openEnd);return V.fromReplace(e,this.from,this.to,r)}invert(){return new Fe(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ze(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ze&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ze(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ze(n.from,n.to,e.markFromJSON(n.mark))}}H.jsonID("removeMark",Ze);class je extends H{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return V.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return V.fromReplace(e,this.pos,this.pos+1,new O(x.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let o=0;o<n.marks.length;o++)if(!n.marks[o].isInSet(r))return new je(this.pos,n.marks[o]);return new je(this.pos,this.mark)}}return new wt(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new je(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new je(n.pos,e.markFromJSON(n.mark))}}H.jsonID("addNodeMark",je);class wt extends H{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return V.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return V.fromReplace(e,this.pos,this.pos+1,new O(x.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new je(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new wt(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new wt(n.pos,e.markFromJSON(n.mark))}}H.jsonID("removeNodeMark",wt);class Se extends H{constructor(e,n,r,o=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=o}apply(e){return this.structure&&Xn(e,this.from,this.to)?V.fail("Structure replace would overwrite content"):V.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new oe([this.from,this.to-this.from,this.slice.size])}invert(e){return new Se(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new Se(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Se)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?O.empty:new O(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Se(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?O.empty:new O(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Se(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Se(n.from,n.to,O.fromJSON(e,n.slice),!!n.structure)}}H.jsonID("replace",Se);class it extends H{constructor(e,n,r,o,i,s,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=a}apply(e){if(this.structure&&(Xn(e,this.from,this.gapFrom)||Xn(e,this.gapTo,this.to)))return V.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return V.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?V.fromReplace(e,this.from,this.to,r):V.fail("Content does not fit in gap")}getMap(){return new oe([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new it(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),o=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||o<n.pos||i>r.pos?null:new it(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new it(n.from,n.to,n.gapFrom,n.gapTo,O.fromJSON(e,n.slice),n.insert,!!n.structure)}}H.jsonID("replaceAround",it);function Xn(t,e,n){let r=t.resolve(e),o=n-e,i=r.depth;for(;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0){let s=r.node(i).maybeChild(r.indexAfter(i));for(;o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function Dp(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let o=n.content;for(let i=0;i<n.openStart;i++)o=o.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let s=r.depth;s>=0;s--){let a=s==r.depth?0:r.pos<=(r.start(s+1)+r.end(s+1))/2?-1:1,l=r.index(s)+(a>0?1:0),c=r.node(s),u=!1;if(i==1)u=c.canReplace(l,l,o);else{let f=c.contentMatchAt(l).findWrapping(o.firstChild.type);u=f&&c.canReplaceWith(l,l,f[0])}if(u)return a==0?r.pos:a<0?r.before(s+1):r.after(s+1)}return null}class St extends H{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return V.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let o=n.type.create(r,null,n.marks);return V.fromReplace(e,this.pos,this.pos+1,new O(x.from(o),0,n.isLeaf?0:1))}getMap(){return oe.empty}invert(e){return new St(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new St(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new St(n.pos,n.attr,n.value)}}H.jsonID("attr",St);class sn extends H{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let o in e.attrs)n[o]=e.attrs[o];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return V.ok(r)}getMap(){return oe.empty}invert(e){return new sn(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new sn(n.attr,n.value)}}H.jsonID("docAttr",sn);let zt=class extends Error{};zt=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},zt.prototype=Object.create(Error.prototype),zt.prototype.constructor=zt,zt.prototype.name="TransformError";const Qn=Object.create(null);class j{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new Mp(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=O.empty){let r=n.content.lastChild,o=null;for(let a=0;a<n.openEnd;a++)o=r,r=r.lastChild;let i=e.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:l,$to:c}=s[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?O.empty:n),a==0&&li(e,i,(r?r.isInline:o&&o.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,o=this.ranges;for(let i=0;i<o.length;i++){let{$from:s,$to:a}=o[i],l=e.mapping.slice(r),c=l.map(s.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),li(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let o=e.parent.inlineContent?new B(e):st(e.node(0),e.parent,e.pos,e.index(),n,r);if(o)return o;for(let i=e.depth-1;i>=0;i--){let s=n<0?st(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):st(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(s)return s}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new me(e.node(0))}static atStart(e){return st(e,e,0,0,1)||new me(e)}static atEnd(e){return st(e,e,e.content.size,e.childCount,-1)||new me(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Qn[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Qn)throw new RangeError("Duplicate use of selection JSON ID "+e);return Qn[e]=n,n.prototype.jsonID=e,n}getBookmark(){return B.between(this.$anchor,this.$head).getBookmark()}}j.prototype.visible=!0;class Mp{constructor(e,n){this.$from=e,this.$to=n}}let si=!1;function ai(t){!si&&!t.parent.inlineContent&&(si=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class B extends j{constructor(e,n=e){ai(e),ai(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return j.near(r);let o=e.resolve(n.map(this.anchor));return new B(o.parent.inlineContent?o:r,r)}replace(e,n=O.empty){if(super.replace(e,n),n==O.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof B&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new an(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new B(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let o=e.resolve(n);return new this(o,r==n?o:e.resolve(r))}static between(e,n,r){let o=e.pos-n.pos;if((!r||o)&&(r=o>=0?1:-1),!n.parent.inlineContent){let i=j.findFrom(n,r,!0)||j.findFrom(n,-r,!0);if(i)n=i.$head;else return j.near(n,r)}return e.parent.inlineContent||(o==0?e=n:(e=(j.findFrom(e,-r,!0)||j.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=o<0&&(e=n))),new B(e,n)}}j.jsonID("text",B);class an{constructor(e,n){this.anchor=e,this.head=n}map(e){return new an(e.map(this.anchor),e.map(this.head))}resolve(e){return B.between(e.resolve(this.anchor),e.resolve(this.head))}}class $ extends j{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:o}=n.mapResult(this.anchor),i=e.resolve(o);return r?j.near(i):new $(i)}content(){return new O(x.from(this.node),0,0)}eq(e){return e instanceof $&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new er(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new $(e.resolve(n.anchor))}static create(e,n){return new $(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}$.prototype.visible=!1,j.jsonID("node",$);class er{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new an(r,r):new er(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&$.isSelectable(r)?new $(n):j.near(n)}}class me extends j{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=O.empty){if(n==O.empty){e.delete(0,e.doc.content.size);let r=j.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new me(e)}map(e){return new me(e)}eq(e){return e instanceof me}getBookmark(){return Rp}}j.jsonID("all",me);const Rp={map(){return this},resolve(t){return new me(t)}};function st(t,e,n,r,o,i=!1){if(e.inlineContent)return B.create(t,n);for(let s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){let a=e.child(s);if(a.isAtom){if(!i&&$.isSelectable(a))return $.create(t,n-(o<0?a.nodeSize:0))}else{let l=st(t,a,n+o,o<0?a.childCount:0,o,i);if(l)return l}n+=a.nodeSize*o}return null}function li(t,e,n){let r=t.steps.length-1;if(r<e)return;let o=t.steps[r];if(!(o instanceof Se||o instanceof it))return;let i=t.mapping.maps[r],s;i.forEach((a,l,c,u)=>{s==null&&(s=u)}),t.setSelection(j.near(t.doc.resolve(s),n))}function ci(t,e){return!e||!t?t:t.bind(e)}class ln{constructor(e,n,r){this.name=e,this.init=ci(n.init,r),this.apply=ci(n.apply,r)}}new ln("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new ln("selection",{init(t,e){return t.selection||j.atStart(e.doc)},apply(t){return t.selection}}),new ln("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new ln("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}});const tr=Object.create(null);function Lp(t){return t in tr?t+"$"+ ++tr[t]:(tr[t]=0,t+"$")}class Fp{constructor(e="key"){this.key=Lp(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Be=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},ui=function(t,e,n,r){return n&&(fi(t,e,n,r,-1)||fi(t,e,n,r,1))},Zp=/^(img|br|input|textarea|hr)$/i;function fi(t,e,n,r,o){for(var i;;){if(t==n&&e==r)return!0;if(e==(o<0?0:cn(t))){let s=t.parentNode;if(!s||s.nodeType!=1||nr(t)||Zp.test(t.nodeName)||t.contentEditable=="false")return!1;e=Be(t)+(o<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(o<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((i=s.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=o;else return!1;else t=s,e=o<0?cn(t):0}else return!1}}function cn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function jp(t,e,n){for(let r=e==0,o=e==cn(t);r||o;){if(t==n)return!0;let i=Be(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,o=o&&i==cn(t)}}function nr(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const pi=function(t){return t.focusNode&&ui(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function di(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}const ge=typeof navigator<"u"?navigator:null,hi=typeof document<"u"?document:null,Pe=ge&&ge.userAgent||"",rr=/Edge\/(\d+)/.exec(Pe),mi=/MSIE \d/.exec(Pe),or=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Pe),xt=!!(mi||or||rr),gi=mi?document.documentMode:or?+or[1]:rr?+rr[1]:0,un=!xt&&/gecko\/(\d+)/i.test(Pe);un&&+(/Firefox\/(\d+)/.exec(Pe)||[0,0])[1];const ir=!xt&&/Chrome\/(\d+)/.exec(Pe),ze=!!ir,yi=ir?+ir[1]:0,Ue=!xt&&!!ge&&/Apple Computer/.test(ge.vendor),sr=Ue&&(/Mobile\/\w+/.test(Pe)||!!ge&&ge.maxTouchPoints>2),ce=sr||(ge?/Mac/.test(ge.platform):!1),vi=ge?/Win/.test(ge.platform):!1,Ot=/Android \d/.test(Pe),ar=!!hi&&"webkitFontSmoothing"in hi.documentElement.style,Bp=ar?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Up(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let o=t.docView.nearestDesc(n.focusNode),i=o&&o.size==0,s=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;let a=r.resolve(s),l,c;if(pi(n)){for(l=s;o&&!o.node;)o=o.parent;let f=o.node;if(o&&f.isAtom&&$.isSelectable(f)&&o.parent&&!(f.isInline&&jp(n.focusNode,n.focusOffset,o.dom))){let p=o.posBefore;c=new $(s==p?a:r.resolve(p))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=s,p=s;for(let d=0;d<n.rangeCount;d++){let m=n.getRangeAt(d);f=Math.min(f,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(f<0)return null;[l,s]=p==t.state.selection.anchor?[p,f]:[f,p],a=r.resolve(s)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let f=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;c=zi(t,u,a,f)}return c}function bi(t){return t.editable?t.hasFocus():Wp(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function lr(t,e=!1){let n=t.state.selection;if(Kp(t,n),!!bi(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&ze){let r=t.domSelectionRange(),o=t.domObserver.currentSelection;if(r.anchorNode&&o.anchorNode&&ui(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Vp(t);else{let{anchor:r,head:o}=n,i,s;_i&&!(n instanceof B)&&(n.$from.parent.inlineContent||(i=ki(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(s=ki(t,n.to))),t.docView.setSelection(r,o,t,e),_i&&(i&&wi(i),s&&wi(s)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Jp(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const _i=Ue||ze&&yi<63;function ki(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),o=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(Ue&&o&&o.contentEditable=="false")return cr(o);if((!o||o.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(o)return cr(o);if(i)return cr(i)}}function cr(t){return t.contentEditable="true",Ue&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function wi(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Jp(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=o)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!bi(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function Vp(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,Be(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&xt&&gi<=11&&(n.disabled=!0,n.disabled=!1)}function Kp(t,e){if(e instanceof $){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Si(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Si(t)}function Si(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function zi(t,e,n,r){return t.someProp("createSelectionBetween",o=>o(t,e,n))||B.between(e,n,r)}function Wp(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function ur(t,e){let{$anchor:n,$head:r}=t.selection,o=e>0?n.max(r):n.min(r),i=o.parent.inlineContent?o.depth?t.doc.resolve(e>0?o.after():o.before()):null:o;return i&&j.findFrom(i,e)}function Ie(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function xi(t,e,n){let r=t.state.selection;if(r instanceof B)if(n.indexOf("s")>-1){let{$head:o}=r,i=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let s=t.state.doc.resolve(o.pos+i.nodeSize*(e<0?-1:1));return Ie(t,new B(r.$anchor,s))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let o=ur(t.state,e);return o&&o instanceof $?Ie(t,o):!1}else if(!(ce&&n.indexOf("m")>-1)){let o=r.$head,i=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter,s;if(!i||i.isText)return!1;let a=e<0?o.pos-i.nodeSize:o.pos;return i.isAtom||(s=t.docView.descAt(a))&&!s.contentDOM?$.isSelectable(i)?Ie(t,new $(e<0?t.state.doc.resolve(o.pos-i.nodeSize):o)):ar?Ie(t,new B(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof $&&r.node.isInline)return Ie(t,new B(e>0?r.$to:r.$from));{let o=ur(t.state,e);return o?Ie(t,o):!1}}}function fn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Et(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function at(t,e){return e<0?qp(t):Gp(t)}function qp(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o,i,s=!1;for(un&&n.nodeType==1&&r<fn(n)&&Et(n.childNodes[r],-1)&&(s=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Et(a,-1))o=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(Oi(n))break;{let a=n.previousSibling;for(;a&&Et(a,-1);)o=n.parentNode,i=Be(a),a=a.previousSibling;if(a)n=a,r=fn(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}s?fr(t,n,r):o&&fr(t,o,i)}function Gp(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o=fn(n),i,s;for(;;)if(r<o){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Et(a,1))i=n,s=++r;else break}else{if(Oi(n))break;{let a=n.nextSibling;for(;a&&Et(a,1);)i=a.parentNode,s=Be(a)+1,a=a.nextSibling;if(a)n=a,r=0,o=fn(n);else{if(n=n.parentNode,n==t.dom)break;r=o=0}}}i&&fr(t,i,s)}function Oi(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Hp(t,e){for(;t&&e==t.childNodes.length&&!nr(t);)e=Be(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function Yp(t,e){for(;t&&!e&&!nr(t);)e=Be(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function fr(t,e,n){if(e.nodeType!=3){let i,s;(s=Hp(e,n))?(e=s,n=0):(i=Yp(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(pi(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:o}=t;setTimeout(()=>{t.state==o&&lr(t)},50)}function Ei(t,e){let n=t.state.doc.resolve(e);if(!(ze||vi)&&n.parent.inlineContent){let o=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),s=(i.top+i.bottom)/2;if(s>o.top&&s<o.bottom&&Math.abs(i.left-o.left)>1)return i.left<o.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),s=(i.top+i.bottom)/2;if(s>o.top&&s<o.bottom&&Math.abs(i.left-o.left)>1)return i.left>o.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function Ti(t,e,n){let r=t.state.selection;if(r instanceof B&&!r.empty||n.indexOf("s")>-1||ce&&n.indexOf("m")>-1)return!1;let{$from:o,$to:i}=r;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=ur(t.state,e);if(s&&s instanceof $)return Ie(t,s)}if(!o.parent.inlineContent){let s=e<0?o:i,a=r instanceof me?j.near(s,e):j.findFrom(s,e);return a?Ie(t,a):!1}return!1}function $i(t,e){if(!(t.state.selection instanceof B))return!0;let{$head:n,$anchor:r,empty:o}=t.state.selection;if(!n.sameParent(r))return!0;if(!o)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let s=t.state.tr;return e<0?s.delete(n.pos-i.nodeSize,n.pos):s.delete(n.pos,n.pos+i.nodeSize),t.dispatch(s),!0}return!1}function Ci(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Xp(t){if(!Ue||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;Ci(t,r,"true"),setTimeout(()=>Ci(t,r,"false"),20)}return!1}function Qp(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function ed(t,e){let n=e.keyCode,r=Qp(e);if(n==8||ce&&n==72&&r=="c")return $i(t,-1)||at(t,-1);if(n==46&&!e.shiftKey||ce&&n==68&&r=="c")return $i(t,1)||at(t,1);if(n==13||n==27)return!0;if(n==37||ce&&n==66&&r=="c"){let o=n==37?Ei(t,t.state.selection.from)=="ltr"?-1:1:-1;return xi(t,o,r)||at(t,o)}else if(n==39||ce&&n==70&&r=="c"){let o=n==39?Ei(t,t.state.selection.from)=="ltr"?1:-1:1;return xi(t,o,r)||at(t,o)}else{if(n==38||ce&&n==80&&r=="c")return Ti(t,-1,r)||at(t,-1);if(n==40||ce&&n==78&&r=="c")return Xp(t)||Ti(t,1,r)||at(t,1);if(r==(ce?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Pi(t,e){t.someProp("transformCopied",d=>{e=d(e,t)});let n=[],{content:r,openStart:o,openEnd:i}=e;for(;o>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){o--,i--;let d=r.firstChild;n.push(d.type.name,d.attrs!=d.type.defaultAttrs?d.attrs:null),r=d.content}let s=t.someProp("clipboardSerializer")||nn.fromSchema(t.state.schema),a=Fi(),l=a.createElement("div");l.appendChild(s.serializeFragment(r,{document:a}));let c=l.firstChild,u,f=0;for(;c&&c.nodeType==1&&(u=Ri[c.nodeName.toLowerCase()]);){for(let d=u.length-1;d>=0;d--){let m=a.createElement(u[d]);for(;l.firstChild;)m.appendChild(l.firstChild);l.appendChild(m),f++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${o} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let p=t.someProp("clipboardTextSerializer",d=>d(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function Ii(t,e,n,r,o){let i=o.parent.type.spec.code,s,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,i||r,t)}),i)return a=new O(x.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{a=p(a,t,!0)}),a;let f=t.someProp("clipboardTextParser",p=>p(e,o,r,t));if(f)a=f;else{let p=o.marks(),{schema:d}=t.state,m=nn.fromSchema(d);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let y=s.appendChild(document.createElement("p"));g&&y.appendChild(m.serializeNode(d.text(g,p)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),s=od(n),ar&&id(s);let c=s&&s.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let f=+u[3];f>0;f--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||bt.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||u),context:o,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!td.test(p.parentNode.nodeName)?{ignore:!0}:null}})),u)a=sd(Mi(a,+u[1],+u[2]),u[4]);else if(a=O.maxOpen(nd(a.content,o),!0),a.openStart||a.openEnd){let f=0,p=0;for(let d=a.content.firstChild;f<a.openStart&&!d.type.spec.isolating;f++,d=d.firstChild);for(let d=a.content.lastChild;p<a.openEnd&&!d.type.spec.isolating;p++,d=d.lastChild);a=Mi(a,f,p)}return t.someProp("transformPasted",f=>{a=f(a,t,l)}),a}const td=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function nd(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let o=e.node(n).contentMatchAt(e.index(n)),i,s=[];if(t.forEach(a=>{if(!s)return;let l=o.findWrapping(a.type),c;if(!l)return s=null;if(c=s.length&&i.length&&Ai(l,i,a,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=Di(s[s.length-1],i.length));let u=Ni(a,l);s.push(u),o=o.matchType(u.type),i=l}}),s)return x.from(s)}return t}function Ni(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,x.from(t));return t}function Ai(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){let i=Ai(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(x.from(Ni(n,t,o+1))))}}function Di(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,Di(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(x.empty,!0);return t.copy(n.append(r))}function pr(t,e,n,r,o,i){let s=e<0?t.firstChild:t.lastChild,a=s.content;return t.childCount>1&&(i=0),o<r-1&&(a=pr(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(x.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function Mi(t,e,n){return e<t.openStart&&(t=new O(pr(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new O(pr(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const Ri={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Li=null;function Fi(){return Li||(Li=document.implementation.createHTMLDocument("title"))}let dr=null;function rd(t){let e=window.trustedTypes;return e?(dr||(dr=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),dr.createHTML(t)):t}function od(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=Fi().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),o;if((o=r&&Ri[r[1].toLowerCase()])&&(t=o.map(i=>"<"+i+">").join("")+t+o.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=rd(t),o)for(let i=0;i<o.length;i++)n=n.querySelector(o[i])||n;return n}function id(t){let e=t.querySelectorAll(ze?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function sd(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:o,openStart:i,openEnd:s}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;o=x.from(l.create(r[a+1],o)),i++,s++}return new O(o,i,s)}const ue={},ie={};function Ne(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}ie.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!ji(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Ot&&ze&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),sr&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",o=>o(t,di(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||ed(t,n)?n.preventDefault():Ne(t,"key")},ie.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)},ie.keypress=(t,e)=>{let n=e;if(ji(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||ce&&n.metaKey)return;if(t.someProp("handleKeyPress",o=>o(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof B)||!r.$from.sameParent(r.$to)){let o=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(o).scrollIntoView();!/[\r\n]/.test(o)&&!t.someProp("handleTextInput",s=>s(t,r.$from.pos,r.$to.pos,o,i))&&t.dispatch(i()),n.preventDefault()}};function pn(t){return{left:t.clientX,top:t.clientY}}function ad(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function hr(t,e,n,r,o){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let s=i.depth+1;s>0;s--)if(t.someProp(e,a=>s>i.depth?a(t,n,i.nodeAfter,i.before(s),o,!0):a(t,n,i.node(s),i.before(s),o,!1)))return!0;return!1}function lt(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function ld(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&$.isSelectable(r)?(lt(t,new $(n)),!0):!1}function cd(t,e){if(e==-1)return!1;let n=t.state.selection,r,o;n instanceof $&&(r=n.node);let i=t.state.doc.resolve(e);for(let s=i.depth+1;s>0;s--){let a=s>i.depth?i.nodeAfter:i.node(s);if($.isSelectable(a)){r&&n.$from.depth>0&&s>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?o=i.before(n.$from.depth):o=i.before(s);break}}return o!=null?(lt(t,$.create(t.state.doc,o)),!0):!1}function ud(t,e,n,r,o){return hr(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(o?cd(t,n):ld(t,n))}function fd(t,e,n,r){return hr(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",o=>o(t,e,r))}function pd(t,e,n,r){return hr(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",o=>o(t,e,r))||dd(t,n,r)}function dd(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(lt(t,B.create(r,0,r.content.size)),!0):!1;let o=r.resolve(e);for(let i=o.depth+1;i>0;i--){let s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)lt(t,B.create(r,a+1,a+1+s.content.size));else if($.isSelectable(s))lt(t,$.create(r,a));else continue;return!0}}function mr(t){return dn(t)}const Zi=ce?"metaKey":"ctrlKey";ue.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=mr(t),o=Date.now(),i="singleClick";o-t.input.lastClick.time<500&&ad(n,t.input.lastClick)&&!n[Zi]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:i,button:n.button};let s=t.posAtCoords(pn(n));s&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new hd(t,s,n,!!r)):(i=="doubleClick"?fd:pd)(t,s.pos,s.inside,n)?n.preventDefault():Ne(t,"pointer"))};class hd{constructor(e,n,r,o){this.view=e,this.pos=n,this.event=r,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Zi],this.allowDefault=r.shiftKey;let i,s;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),s=n.inside;else{let u=e.state.doc.resolve(n.pos);i=u.parent,s=u.depth?u.before():0}const a=o?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof $&&c.from<=s&&c.to>s)&&(this.mightDrag={node:i,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&un&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ne(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>lr(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(pn(e))),this.updateAllowDefault(e),this.allowDefault||!n?Ne(this.view,"pointer"):ud(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ue&&this.mightDrag&&!this.mightDrag.node.isAtom||ze&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(lt(this.view,j.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Ne(this.view,"pointer")}move(e){this.updateAllowDefault(e),Ne(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}ue.touchstart=t=>{t.input.lastTouch=Date.now(),mr(t),Ne(t,"pointer")},ue.touchmove=t=>{t.input.lastTouch=Date.now(),Ne(t,"pointer")},ue.contextmenu=t=>mr(t);function ji(t,e){return t.composing?!0:Ue&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const md=Ot?5e3:-1;ie.compositionstart=ie.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof B&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||ze&&vi&&gd(t)))t.markCursor=t.state.storedMarks||n.marks(),dn(t,!0),t.markCursor=null;else if(dn(t,!e.selection.empty),un&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let o=r.focusNode,i=r.focusOffset;o&&o.nodeType==1&&i!=0;){let s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(s.nodeType==3){let a=t.domSelection();a&&a.collapse(s,s.nodeValue.length);break}else o=s,i=-1}}t.input.composing=!0}Bi(t,md)};function gd(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}ie.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,Bi(t,20))};function Bi(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>dn(t),e))}function yd(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=vd());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function vd(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function dn(t,e=!1){if(!(Ot&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),yd(t),e||t.docView&&t.docView.dirty){let n=Up(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function bd(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Tt=xt&&gi<15||sr&&Bp<604;ue.copy=ie.cut=(t,e)=>{let n=e,r=t.state.selection,o=n.type=="cut";if(r.empty)return;let i=Tt?null:n.clipboardData,s=r.content(),{dom:a,text:l}=Pi(t,s);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):bd(t,a),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function _d(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function kd(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let o=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?gr(t,r.value,null,o,e):gr(t,r.textContent,r.innerHTML,o,e)},50)}function gr(t,e,n,r,o){let i=Ii(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,o,i||O.empty)))return!0;if(!i)return!1;let s=_d(i),a=s?t.state.tr.replaceSelectionWith(s,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Ui(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}ie.paste=(t,e)=>{let n=e;if(t.composing&&!Ot)return;let r=Tt?null:n.clipboardData,o=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&gr(t,Ui(r),r.getData("text/html"),o,n)?n.preventDefault():kd(t,n)};class wd{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const Sd=ce?"altKey":"ctrlKey";function Ji(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[Sd]}ue.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let o=t.state.selection,i=o.empty?null:t.posAtCoords(pn(n)),s;if(!(i&&i.pos>=o.from&&i.pos<=(o instanceof $?o.to-1:o.to))){if(r&&r.mightDrag)s=$.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(s=$.create(t.state.doc,f.posBefore))}}let a=(s||t.state.selection).content(),{dom:l,text:c,slice:u}=Pi(t,a);(!n.dataTransfer.files.length||!ze||yi>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Tt?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Tt||n.dataTransfer.setData("text/plain",c),t.dragging=new wd(u,Ji(t,n),s)},ue.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)},ie.dragover=ie.dragenter=(t,e)=>e.preventDefault(),ie.drop=(t,e)=>{try{zd(t,e,t.dragging)}finally{t.dragging=null}};function zd(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(pn(e));if(!r)return;let o=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",d=>{i=d(i,t,!1)}):i=Ii(t,Ui(e.dataTransfer),Tt?null:e.dataTransfer.getData("text/html"),!1,o);let s=!!(n&&Ji(t,e));if(t.someProp("handleDrop",d=>d(t,e,i||O.empty,s))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?Dp(t.state.doc,o.pos,i):o.pos;a==null&&(a=o.pos);let l=t.state.tr;if(s){let{node:d}=n;d?d.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,f=l.doc;if(u?l.replaceRangeWith(c,c,i.content.firstChild):l.replaceRange(c,c,i),l.doc.eq(f))return;let p=l.doc.resolve(c);if(u&&$.isSelectable(i.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new $(p));else{let d=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((m,g,y,b)=>d=b),l.setSelection(zi(t,p,l.doc.resolve(d)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}ue.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&lr(t)},20))},ue.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},ue.beforeinput=(t,e)=>{if(ze&&Ot&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,di(8,"Backspace")))))return;let{$cursor:o}=t.state.selection;o&&o.pos>0&&t.dispatch(t.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let t in ie)ue[t]=ie[t];function $t(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class hn{constructor(e,n){this.toDOM=e,this.spec=n||Je,this.side=this.spec.side||0}map(e,n,r,o){let{pos:i,deleted:s}=e.mapResult(n.from+o,this.side<0?-1:1);return s?null:new fe(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof hn&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&$t(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Ae{constructor(e,n){this.attrs=e,this.spec=n||Je}map(e,n,r,o){let i=e.map(n.from+o,this.spec.inclusiveStart?-1:1)-r,s=e.map(n.to+o,this.spec.inclusiveEnd?1:-1)-r;return i>=s?null:new fe(i,s,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Ae&&$t(this.attrs,e.attrs)&&$t(this.spec,e.spec)}static is(e){return e.type instanceof Ae}destroy(){}}class yr{constructor(e,n){this.attrs=e,this.spec=n||Je}map(e,n,r,o){let i=e.mapResult(n.from+o,1);if(i.deleted)return null;let s=e.mapResult(n.to+o,-1);return s.deleted||s.pos<=i.pos?null:new fe(i.pos-r,s.pos-r,this)}valid(e,n){let{index:r,offset:o}=e.content.findIndex(n.from),i;return o==n.from&&!(i=e.child(r)).isText&&o+i.nodeSize==n.to}eq(e){return this==e||e instanceof yr&&$t(this.attrs,e.attrs)&&$t(this.spec,e.spec)}destroy(){}}class fe{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new fe(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new fe(e,e,new hn(n,r))}static inline(e,n,r,o){return new fe(e,n,new Ae(r,o))}static node(e,n,r,o){return new fe(e,n,new yr(r,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ae}get widget(){return this.type instanceof hn}}const ct=[],Je={};class K{constructor(e,n){this.local=e.length?e:ct,this.children=n.length?n:ct}static create(e,n){return n.length?mn(n,e,0,Je):ee}find(e,n,r){let o=[];return this.findInner(e??0,n??1e9,o,0,r),o}findInner(e,n,r,o,i){for(let s=0;s<this.local.length;s++){let a=this.local[s];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+o,a.to+o))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<n&&this.children[s+1]>e){let a=this.children[s]+1;this.children[s+2].findInner(e-a,n-a,r,o+a,i)}}map(e,n,r){return this==ee||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Je)}mapInner(e,n,r,o,i){let s;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,o);l&&l.type.valid(n,l)?(s||(s=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?xd(this.children,s||[],e,n,r,o,i):s?new K(s.sort(Ke),ct):ee}add(e,n){return n.length?this==ee?K.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let o,i=0;e.forEach((a,l)=>{let c=l+r,u;if(u=Ki(n,a,c)){for(o||(o=this.children.slice());i<o.length&&o[i]<l;)i+=3;o[i]==l?o[i+2]=o[i+2].addInner(a,u,c+1):o.splice(i,0,l,l+a.nodeSize,mn(u,a,c+1,Je)),i+=3}});let s=Vi(i?Wi(n):n,-r);for(let a=0;a<s.length;a++)s[a].type.valid(e,s[a])||s.splice(a--,1);return new K(s.length?this.local.concat(s).sort(Ke):this.local,o||this.children)}remove(e){return e.length==0||this==ee?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,o=this.local;for(let i=0;i<r.length;i+=3){let s,a=r[i]+n,l=r[i+1]+n;for(let u=0,f;u<e.length;u++)(f=e[u])&&f.from>a&&f.to<l&&(e[u]=null,(s||(s=[])).push(f));if(!s)continue;r==this.children&&(r=this.children.slice());let c=r[i+2].removeInner(s,a+1);c!=ee?r[i+2]=c:(r.splice(i,3),i-=3)}if(o.length){for(let i=0,s;i<e.length;i++)if(s=e[i])for(let a=0;a<o.length;a++)o[a].eq(s,n)&&(o==this.local&&(o=this.local.slice()),o.splice(a--,1))}return r==this.children&&o==this.local?this:o.length||r.length?new K(o,r):ee}forChild(e,n){if(this==ee)return this;if(n.isLeaf)return K.empty;let r,o;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,s=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<s&&l.to>i&&l.type instanceof Ae){let c=Math.max(i,l.from)-i,u=Math.min(s,l.to)-i;c<u&&(o||(o=[])).push(l.copy(c,u))}}if(o){let a=new K(o.sort(Ke),ct);return r?new Ve([a,r]):a}return r||ee}eq(e){if(this==e)return!0;if(!(e instanceof K)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return vr(this.localsInner(e))}localsInner(e){if(this==ee)return ct;if(e.inlineContent||!this.local.some(Ae.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Ae||n.push(this.local[r]);return n}forEachSet(e){e(this)}}K.empty=new K([],[]),K.removeOverlap=vr;const ee=K.empty;class Ve{constructor(e){this.members=e}map(e,n){const r=this.members.map(o=>o.map(e,n,Je));return Ve.from(r)}forChild(e,n){if(n.isLeaf)return K.empty;let r=[];for(let o=0;o<this.members.length;o++){let i=this.members[o].forChild(e,n);i!=ee&&(i instanceof Ve?r=r.concat(i.members):r.push(i))}return Ve.from(r)}eq(e){if(!(e instanceof Ve)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let o=0;o<this.members.length;o++){let i=this.members[o].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let s=0;s<i.length;s++)n.push(i[s])}}return n?vr(r?n:n.sort(Ke)):ct}static from(e){switch(e.length){case 0:return ee;case 1:return e[0];default:return new Ve(e.every(n=>n instanceof K)?e:e.reduce((n,r)=>n.concat(r instanceof K?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function xd(t,e,n,r,o,i,s){let a=t.slice();for(let c=0,u=i;c<n.maps.length;c++){let f=0;n.maps[c].forEach((p,d,m,g)=>{let y=g-m-(d-p);for(let b=0;b<a.length;b+=3){let k=a[b+1];if(k<0||p>k+u-f)continue;let z=a[b]+u-f;d>=z?a[b+1]=p<=z?-2:-1:p>=u&&y&&(a[b]+=y,a[b+1]+=y)}f+=y}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+i),f=u-o;if(f<0||f>=r.content.size){l=!0;continue}let p=n.map(t[c+1]+i,-1),d=p-o,{index:m,offset:g}=r.content.findIndex(f),y=r.maybeChild(m);if(y&&g==f&&g+y.nodeSize==d){let b=a[c+2].mapInner(n,y,u+1,t[c]+i+1,s);b!=ee?(a[c]=f,a[c+1]=d,a[c+2]=b):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=Od(a,t,e,n,o,i,s),u=mn(c,r,0,s);e=u.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,p=0;f<u.children.length;f+=3){let d=u.children[f];for(;p<a.length&&a[p]<d;)p+=3;a.splice(p,0,u.children[f],u.children[f+1],u.children[f+2])}}return new K(e.sort(Ke),a)}function Vi(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let o=t[r];n.push(new fe(o.from+e,o.to+e,o.type))}return n}function Od(t,e,n,r,o,i,s){function a(l,c){for(let u=0;u<l.local.length;u++){let f=l.local[u].map(r,o,c);f?n.push(f):s.onRemove&&s.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function Ki(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,o=null;for(let i=0,s;i<t.length;i++)(s=t[i])&&s.from>n&&s.to<r&&((o||(o=[])).push(s),t[i]=null);return o}function Wi(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function mn(t,e,n,r){let o=[],i=!1;e.forEach((a,l)=>{let c=Ki(t,a,l+n);if(c){i=!0;let u=mn(c,a,n+l+1,r);u!=ee&&o.push(l,l+a.nodeSize,u)}});let s=Vi(i?Wi(t):t,-n).sort(Ke);for(let a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new K(s,o):ee}function Ke(t,e){return t.from-e.from||t.to-e.to}function vr(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let o=n+1;o<e.length;o++){let i=e[o];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),qi(e,o+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),qi(e,o,r.copy(i.from,r.to)));break}}}return e}function qi(t,e,n){for(;e<t.length&&Ke(n,t[e])>0;)e++;t.splice(e,0,n)}const Ed=3,br=`${Or}completionCount`;let gn,_r=!1;const q=new Fp("copilot-suggestions");function Td(){_r=!0}function $d(){_r=!1}const Cd={get name(){return"copilot-suggestions"},keys(t){return{Tab:()=>this._acceptSuggestion(),Escape:()=>this._dismissSuggestion(),"Mod-,":()=>this._triggerCompletion()}},plugins(t){return[Pd(t,this)]},_acceptSuggestion(){const{view:t}=this.editor,e=q.getState(t.state);if(!(e!=null&&e.suggestion))return!1;const{tr:n}=t.state;return n.insertText(e.suggestion,e.position),n.setMeta(q,{suggestion:null,position:null,isLoading:!1}),t.dispatch(n),this._showLicenseToastOnce(),!0},_dismissSuggestion(){const{view:t}=this.editor,e=q.getState(t.state),n=t.state.tr.setMeta(q,{suggestion:null,position:null,isLoading:!1,skipNextTrigger:!0});return t.dispatch(n),!!(e!=null&&e.suggestion||e!=null&&e.isLoading)},_triggerCompletion(){const{view:t}=this.editor;if(!q.getState(t.state))return!1;const n=t.state.tr.setMeta(q,{manualTrigger:!0});return t.dispatch(n),!0},async _showLicenseToastOnce(){const t=sessionStorage.getItem(br);if(t==="done")return;let e=Number(t)||0;if(e++,sessionStorage.setItem(br,String(e)),e<Ed)return;const n=await ke();["inactive","invalid"].includes(n.licenseStatus)&&window.panel.notification.info({icon:"key",message:window.panel.t("johannschopplich.copilot.license.toast")}),sessionStorage.setItem(br,"done")}};function Pd(t,e){let n,r;const o=()=>{r&&(r.abort(),r=void 0)};return{key:q,state:{init(){return{suggestion:null,position:null,isLoading:!1,skipNextTrigger:!1,manualTrigger:!1}},apply(s,a){const l=s.getMeta(q);return l!==void 0?(l.isLoading===!1&&o(),{...a,...l}):s.docChanged?(o(),{...a,suggestion:null,position:null,isLoading:!1}):a}},view(){return gn===void 0&&ke().then(({config:s})=>{gn=s.completion}),{update(s,a){const l=q.getState(s.state);if(l!=null&&l.manualTrigger){clearTimeout(n);const c=s.state.tr.setMeta(q,{manualTrigger:!1});s.dispatch(c),i(s,{includeSuffix:!0});return}if(l!=null&&l.skipNextTrigger){clearTimeout(n);const c=s.state.tr.setMeta(q,{skipNextTrigger:!1});s.dispatch(c);return}clearTimeout(n),!s.state.doc.eq(a.doc)&&(!gn||_r||(n=setTimeout(()=>{const{$head:c}=s.state.selection,u=c.parentOffset===c.parent.content.size,f=c.parent.textContent.length===0;!u||f||i(s)},gn.debounce)))},destroy(){clearTimeout(n),o()}}},props:{decorations(s){const a=q.getState(s);if(a!=null&&a.isLoading&&!(a!=null&&a.suggestion)&&a.position!==null){const l=fe.widget(a.position,()=>{const c=document.createElement("span");return c.className="k-copilot-suggestion-indicator",c},{side:1});return K.create(s.doc,[l])}if(a!=null&&a.suggestion&&a.position!==null){const l=fe.widget(a.position,()=>{const c=document.createElement("span");return c.className="k-copilot-suggestion-text",c.textContent=a.suggestion,c},{side:1});return K.create(s.doc,[l])}return K.empty},handleDOMEvents:{blur:()=>e._dismissSuggestion()}}};async function i(s,{includeSuffix:a=!1}={}){r==null||r.abort(),r=new AbortController;const{state:l}=s,c=l.selection.head,{prefix:u,suffix:f}=Id(l,{suffixLength:a?Ns:0});if(!u.trim())return;const p=l.tr.setMeta(q,{suggestion:null,position:c,isLoading:!0});s.dispatch(p);const{signal:d}=r;try{const{model:m}=await Pr({forCompletion:!0}),{streamText:g}=await Oe("ai"),y=f?`<prefix>${u}</prefix>
<suffix>${f}</suffix>`:u,{textStream:b}=await g({model:m,system:As,prompt:y,maxTokens:Ps,abortSignal:d}),k=u.length>0&&!/\s$/.test(u);let z="";for await(const N of b){if(d.aborted)return;z+=N;const W=k&&!z.startsWith(" ")?` ${z}`:z,U=s.state.tr.setMeta(q,{suggestion:W,position:c,isLoading:!0});s.dispatch(U)}if(d.aborted)return;const I=k&&!z.startsWith(" ")?` ${z}`:z,E=s.state.tr.setMeta(q,{suggestion:I,position:c,isLoading:!1});s.dispatch(E)}catch(m){if(d.aborted)return;console.error("Failed to generate completion:",m);const g=s.state.tr.setMeta(q,{suggestion:null,position:null,isLoading:!1});s.dispatch(g)}finally{r=void 0}}}function Id(t,{prefixLength:e=Is,suffixLength:n=0}={}){const{$head:r}=t.selection,o=r.pos,i=t.doc.textBetween(0,o,`

`).slice(-e),s=r.parent.textContent,a=r.parentOffset,l=n>0?s.slice(a,a+n):void 0;return{prefix:i,suffix:l}}const Nd={__name:"CopilotButton",props:{label:String,userPrompt:String,systemPrompt:String,logLevel:String,icon:{type:String,default:"sparkling"},theme:{type:String,default:"notice-icon"}},setup(t){const e=t,n=T(),{currentContent:r,update:o}=yn(),{getViewFields:i}=Ro(),s=S(!1),a=S(!1);let l;async function c(){l=new AbortController;const p=C=>{C.key==="Escape"&&u()},d=await i();if(d.length===0){n.notification.error(n.t("johannschopplich.copilot.fields.empty"));return}const m=await Mo({fields:d,userPrompt:e.userPrompt});if(!m)return;const{prompt:g,files:y,fields:b}=m,k=d.filter(C=>b.includes(C.name));if(!g||k.length===0)return;const{getZodSchema:z}=Ht(),{getZodSchema:I}=Un(),E={};for(const C of k)E[C.name]=C.type==="layout"?he(await I(C)):C.type==="blocks"?he(await z(C)):Fn(C);n.isLoading=!0,s.value=!0,Td(),document.addEventListener("keydown",p);const N={...r.value},{config:W}=await ke(),{Output:U,AISDKError:xe}=await Oe("ai"),pe=e.systemPrompt||W.systemPrompt||Sn,{signal:ye}=l;try{const{partialOutputStream:C,output:G}=await Rt({userPrompt:g,systemPrompt:pe,output:U.object({schema:rt(E)}),files:y,logLevel:Ge.indexOf(e.logLevel&&Ge.includes(e.logLevel)?e.logLevel:W.logLevel&&Ge.includes(W.logLevel)?W.logLevel:xr),abortSignal:ye});G.catch(()=>{});for await(const ut of C){if(ye.aborted)return;if(!ut)continue;const ft=f({object:ut,selectedFields:k,currentContent:N});Object.keys(ft).length>0&&await o(ft,!1)}if(ye.aborted)return;const De=await G,Ct=f({object:De,selectedFields:k,currentContent:N});await o(Ct),n.notification.success({icon:"check",message:n.t("johannschopplich.copilot.notification.success")})}catch(C){if(ye.aborted)return;if(C instanceof He||xe.isInstance(C)){let G=C.message;G.includes("levels of nesting exceeds limit")&&(G="The fields generation exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas."),console.error(C),n.notification.error(G);return}console.error(C),n.notification.error(n.t("johannschopplich.copilot.notification.error"))}finally{l=void 0,n.isLoading=!1,s.value=!1,$d(),document.removeEventListener("keydown",p)}}function u(){l==null||l.abort(),l=void 0,s.value=!1,n.isLoading=!1}function f({object:p,selectedFields:d,currentContent:m}){const{normalizeBlock:g}=Ht(),{normalizeLayout:y}=Un(),b={};for(const k of d){const z=p[k.name];if(z==null)continue;const I=m[k.name],E=k.type==="layout"?y:g;k.type==="layout"||k.type==="blocks"?Array.isArray(z)&&(b[k.name]=[...I,...z.map(E)]):b[k.name]=z}return b}return{__sfc:!0,props:e,panel:n,currentContent:r,updateContent:o,getViewFields:i,isGenerating:s,isHovering:a,abortController:l,initPromptDialog:c,abort:u,processFieldValues:f}}};var Ad=function(){var e=this,n=e._self._c,r=e._self._setupProxy;return n("k-button",{attrs:{icon:r.isHovering&&r.isGenerating?"cancel":r.isGenerating?"loader":e.icon,text:e.label||r.panel.t("johannschopplich.copilot.label"),theme:r.isHovering&&r.isGenerating?"notice":e.theme,variant:"filled",size:"sm",responsive:""},on:{click:function(o){r.isHovering&&r.isGenerating?r.abort():r.initPromptDialog()}},nativeOn:{mouseenter:function(o){r.isHovering=!0},mouseleave:function(o){r.isHovering=!1}}})},Dd=[],Md=qe(Nd,Ad,Dd,!1,null,null);const Gi=Md.exports,Rd={"copilot-ai-generate":'<path fill="currentColor" d="m20.467 8.694l.246-.566a4.36 4.36 0 0 1 2.22-2.25l.759-.339a.53.53 0 0 0 0-.963l-.717-.319a4.37 4.37 0 0 1-2.251-2.326l-.253-.611a.506.506 0 0 0-.942 0l-.253.61a4.37 4.37 0 0 1-2.25 2.327l-.718.32a.53.53 0 0 0 0 .962l.76.338a4.36 4.36 0 0 1 2.219 2.251l.246.566c.18.414.753.414.934 0M5.8 16h2.154l.6-1.5h2.892l.6 1.5H14.2L11 8H9zm4.2-5.115l.646 1.615H9.354zM15 16V8h2v8zM3 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-9h-2v8H4V5h10V3z" />',"copilot-text-snippet":'<path fill="currentColor" d="M2 4a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zm2 1v14h16V5zm3 3h10v3h-2v-1h-2v4h1.5v2h-5v-2H11v-4H9v1H7z" />'};async function Hi(t,{appendText:e,replaceText:n,responseFormat:r="text"}){const o=T(),i=Ld(),s=new AbortController,a=m=>{m.key==="Escape"&&s.abort()},l=await Mo({selection:t,activeField:i});if(!l)return;const{prompt:c,files:u}=l;if(!c)return;i&&(i.element.dataset.copilot="generating"),document.addEventListener("keydown",a),o.isLoading=!0;const{config:f}=await ke(),{AISDKError:p}=await Oe("ai"),{signal:d}=s;try{const{textStream:m}=await Rt({userPrompt:Er(c,{responseFormat:r,selection:t}),systemPrompt:f.systemPrompt||Sn,responseFormat:r,files:u,abortSignal:d});let g=!0;for await(let y of m){if(d.aborted)return;t&&l.insertMode==="replace"?n(y):(g&&(y=t&&!y.startsWith(" ")?` ${y}`:y,g=!1),e(y))}if(d.aborted)return;o.notification.success({icon:"check",message:o.t("johannschopplich.copilot.notification.success")})}catch(m){if(d.aborted)return;if(m instanceof He||p.isInstance(m)){console.error(m),o.notification.error(m.message);return}console.error(m),o.notification.error(o.t("johannschopplich.copilot.notification.error"))}finally{i&&delete i.element.dataset.copilot,document.removeEventListener("keydown",a),o.isLoading=!1}}function Ld(){var i;const t=(i=document.activeElement)==null?void 0:i.closest(".k-field");if(!t)return;const e=[...t.classList].find(s=>s.startsWith("k-field-name-")),n=[...t.classList].find(s=>s.startsWith("k-field-type-")),r=e==null?void 0:e.replace("k-field-name-",""),o=n==null?void 0:n.replace("k-field-type-","");return r?{element:t,name:r,type:o}:void 0}const Fd={icon:"sparkling",label:"Copilot",shortcut:".",click(){let t="";this.command("insert",(o,i)=>(t=i,i));let e=!0;Hi(t,{responseFormat:"markdown",appendText:o=>{this.command("insert",(i,s)=>e?(e=!1,s+o):o)},replaceText:o=>{this.command("insert",()=>o)}})}},Zd={get name(){return"copilot"},get button(){return{icon:"sparkling",label:window.panel.t("johannschopplich.copilot.label")}},commands(t){return()=>this._openPromptDialog(t)},keys(t){return{"Mod-.":()=>(this._openPromptDialog(t),!0)}},_insertText(t,e,n,r){const o=n;if(/^\n+$/.test(e)){if(e.length>=2){const i=this.editor.options.inline?[r.schema.nodes.hardBreak.create(),r.schema.nodes.hardBreak.create()]:r.schema.nodes.paragraph.create();return t=t.replaceWith(o,o,i),{tr:t,newPosition:o+2}}return t=t.replaceWith(o,o,r.schema.nodes.hardBreak.create()),{tr:t,newPosition:o+1}}if(e.includes("<"))try{const i=`<div>${e}</div>`,s=new window.DOMParser().parseFromString(i,"text/html").body.firstElementChild,l=bt.fromSchema(r.schema).parseSlice(s),c=t.doc.content.size;t=t.replaceRange(o,o,l);const u=t.doc.content.size;return{tr:t,newPosition:o+(u-c)}}catch(i){console.error("Failed to parse HTML:",i)}return t=t.setStoredMarks([]).insertText(e,o),{tr:t,newPosition:o+e.length}},_openPromptDialog(t){const{state:e}=this.editor,{from:n,to:r}=e.selection;let o="";if(n!==r){const u=e.doc.slice(n,r).content;o=Bd(this.editor.getHTML(u))}let i,s=!1,a=!0;Hi(o,{responseFormat:"rich-text",replaceText:u=>{const{state:f,view:p}=this.editor;let d=f.tr;if(!s){const y=jd(f),{from:b,to:k}=f.selection;d=d.deleteRange(b,k),i=y?1:b,s=!0}const{tr:m,newPosition:g}=this._insertText(d,u,i,t);i=g,m.setMeta(q,{skipNextTrigger:!0}),p.dispatch(m)},appendText:u=>{const{state:f,view:p}=this.editor;a&&(i=f.selection.to,a=!1);const{tr:d,newPosition:m}=this._insertText(f.tr,u,i,t);i=m,d.setMeta(q,{skipNextTrigger:!0}),p.dispatch(d)}})}};function jd(t){const{from:e,to:n}=t.selection;return e<=1&&n>=t.doc.content.size-1}function Bd(t){return t.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>\s*<p>/gi,`

`).replace(/^<p>|<\/p>$/gi,"")}function Ud(t){if(dt())return;let e;t.mixin({mounted(){if(this.$options.name!=="k-header")return;const n=this.$children.find(o=>o.$options.name==="k-button-group");if(!n)return;const r=t.extend(Gi);e=new r({parent:this}),e.$mount(),n.$el.before(e.$el)},beforeDestroy(){this.$options.name==="k-header"&&e&&(e.$destroy(),e=void 0)}})}window.panel.plugin("johannschopplich/copilot",{viewButtons:{copilot:Gi},components:{"k-copilot-prompt-dialog":bp},sections:{copilot:zp},fields:{},textareaButtons:{copilot:Fd},writerMarks:{copilot:Zd,"copilot-suggestions":Cd},icons:Rd,use:[Ud]})})();

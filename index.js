var ks=Object.defineProperty;var xs=(m,O,ae)=>O in m?ks(m,O,{enumerable:!0,configurable:!0,writable:!0,value:ae}):m[O]=ae;var M=(m,O,ae)=>xs(m,typeof O!="symbol"?O+"":O,ae);(function(){"use strict";const m=window.Vue;function O(){return window.panel}function ae(){return O().api}const Ie=()=>window.panel.plugins.viewButtons!==void 0;function ln(){return Ie()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):O().app.$store}function ot(){const r=O(),e=ln(),n=Ie();if(n&&!("diff"in r.content))throw new Error("This plugin requires Kirby 5.0.0-rc.1 or higher. Please update your Kirby installation.");const t=W(n?()=>r.content.version("changes"):()=>e.getters["content/values"]()),s=W(n?()=>r.content.diff():()=>e.getters["content/changes"]()),a=W(n?()=>r.content.hasDiff():()=>e.getters["content/hasChanges"]()),i=n?r.content:new Proxy({},{get(){return()=>{}}});return{content:i,currentContent:t,contentChanges:s,hasChanges:a,update:async(l,c=!0)=>{if(!n&&l)for(const[y,g]of Object.entries(l))e.dispatch("content/update",[y,g]);const f=i.merge(l);c&&await i.save(f)}}}function un(){const r=O();function e(n){return!n||typeof n=="string"?n:n[r.translation.code]??Object.values(n)[0]}return{t:e}}function dn(){const r=ae();return{load:({parent:n,name:t})=>r.get(`${n}/sections/${t}`)}}const fn={error:0,warn:1,log:2,info:3,success:3};function hn(r){const e=new pn;return new Proxy({},{get(n,t){return(...s)=>{e.log({level:fn[t],type:t,tag:r,args:s})}}})}class pn{constructor(){M(this,"defaultColor","#7f8c8d");M(this,"levelColorMap",{0:"#c0392b",1:"#f39c12",3:"#00BCD4"});M(this,"typeColorMap",{success:"#2ecc71"})}log(e){const n=mn(e.level),t=e.type==="log"?"":e.type,s=e.tag||"",i=`
background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
border-radius: 0.5em;
color: white;
font-weight: bold;
padding: 2px 0.5em;
`.trimStart(),o=`%c${[s,t].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?n(`${o}%c ${e.args[0]}`,i,"",...e.args.slice(1)):n(o,i,...e.args)}}function mn(r){return r<1?console.error:console.log}const Oe=[],De=new Map;async function gn(r){if(!Array.isArray(r))throw new TypeError(`Expected an array, got ${typeof r}`);for(const e of r)Oe.some(n=>n.filename===e.filename)||Oe.push(e)}function ct(r){if(Oe.length===0)throw new Error("Plugin assets not registered");const e=Oe.find(n=>n.filename===r);if(!e)throw new Error(`Plugin asset "${r}" not found`);return e}async function ie(r){if(r.endsWith(".js")||(r+=".js"),De.has(r))return De.get(r);const n=await import(ct(r).url);return De.set(r,n),n}const W=m.computed;m.customRef,m.defineAsyncComponent,m.defineComponent,m.effectScope,m.getCurrentInstance;const yn=m.getCurrentScope;m.h,m.inject,m.isProxy,m.isReactive,m.isReadonly,m.isRef,m.isShallow,m.markRaw;const vn=m.nextTick;m.onActivated,m.onBeforeMount;const _n=m.onBeforeUnmount;m.onBeforeUpdate,m.onDeactivated,m.onErrorCaptured;const lt=m.onMounted;m.onRenderTracked,m.onRenderTriggered;const bn=m.onScopeDispose;m.onServerPrefetch,m.onUnmounted,m.onUpdated,m.provide,m.proxyRefs,m.reactive,m.readonly;const w=m.ref;m.shallowReactive,m.shallowReadonly,m.shallowRef,m.toRaw,m.toRef,m.toRefs,m.triggerRef;const Ue=m.unref;m.useAttrs,m.useCssModule,m.useCssVars,m.useListeners,m.useSlots;const Fe=m.watch;m.watchEffect,m.watchPostEffect,m.watchSyncEffect;const Ve={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible":"License key invalid for this plugin version","modal.error.upgradeable":"License key invalid for this plugin version. Upgrade now on https://hub.kirby.tools.","modal.error.activated":"License key already activated",activate:"Activate",activated:"Plugin activated",buy:"Buy a license",upgrade:"Upgrade"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.upgradeable":"Lizenzschlüssel ungültig für diese Plugin-Version. Aktualisiere jetzt auf https://hub.kirby.tools.","modal.error.activated":"Lizenzschlüssel bereits aktiviert",activate:"Aktivieren",activated:"Plugin aktiviert",buy:"Lizenz kaufen",upgrade:"Upgrade"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible":"Clé de licence invalide pour cette version du plugin","modal.error.upgradeable":"Clé de licence invalide pour cette version du plugin. Mettez à niveau maintenant sur https://hub.kirby.tools.","modal.error.activated":"Clé de licence déjà activée",activate:"Activer",activated:"Plugin activé",buy:"Acheter une licence",upgrade:"Upgrade"},nl:{"modal.info":"Bedankt voor het kopen van {label}! Voer je e-mailadres en bestelnummer in om je licentie te activeren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Vind je bestelnummer</a> op Lemon Squeezy of <a href="mailto:hello@kirby.tools">neem contact met ons op</a> als je het niet kunt vinden.',"modal.error.required.fields":"E-mailadres en bestelnummer zijn verplicht","modal.error.invalid.unauthorized":"E-mailadres of bestelnummer is onjuist","modal.error.invalid.licenseKey":"Licentiesleutel ongeldig voor dit plug-in","modal.error.incompatible":"Licentiesleutel ongeldig voor deze plug-inversie","modal.error.upgradeable":"Licentiesleutel ongeldig voor deze plug-inversie. Upgrade nu op https://hub.kirby.tools.","modal.error.activated":"Licentiesleutel al geactiveerd",activate:"Activeren",activated:"Plugin geactiveerd",buy:"Koop een licentie",upgrade:"Upgrade"}},kn=["localhost","127.0.0.1","[::1]"],xn=["local","test","ddev.site"];function Q(r="",e){var s;const n=window.panel.translation.code,t=((s=Ve==null?void 0:Ve[n])==null?void 0:s[r])??r;return e?wn(t,e):t}function wn(r,e,n){return r.replace(/\{(\w+)\}/g,(t,s)=>e[s]||s)}function Sn(){const{hostname:r}=window.location,e=kn.includes(r),n=xn.some(t=>r.endsWith(`.${t}`));return e||n}const ut={Unauthorized:"modal.error.invalid.unauthorized","License key not valid for this plugin":"modal.error.invalid.licenseKey","License key not valid for this plugin version":"modal.error.incompatible","License key not valid for this plugin version, please upgrade your license":"modal.error.upgradeable","License key already activated":"modal.error.activated"};function Cn(r){const e=O();return{isLocalhost:Sn(),assertActivationIntegrity:async({component:a,licenseStatus:i})=>{if(Ue(i)==="active")return;const o=Ue(a);if(!(o!=null&&o.$el)||window.getComputedStyle(o.$el).display==="none"||window.getComputedStyle(o.$el).visibility==="hidden"||window.getComputedStyle(o.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let a=!1;const{label:i}=r,o={info:{type:"info",text:Q("modal.info",{label:i})},email:{label:e.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:Q("modal.fields.orderId.help",{label:i})}};return new Promise(l=>{e.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:Q("activate",{label:i})},fields:o},on:{close:()=>{l({isLicenseActive:a})},submit:async c=>{a=await An(c,r),a&&(e.dialog.close(),e.notification.success(Q("activated")))}}})})}}}async function An(r,e){const n=O(),{email:t,orderId:s}=r;if(!t||!s)return n.notification.error(Q("modal.error.required.fields")),!1;try{const a=await n.api.post(`${e.apiNamespace}/activate`,{email:t,orderId:Number(s)});if((a==null?void 0:a.status)!=="ok")throw new Error("Failed to activate license key");return!0}catch(a){const i=a.message;return n.notification.error(ut[i]?Q(ut[i]):i),!1}}const Tn=Vue.defineComponent({__name:"LicensingButtonGroup",props:{label:{type:String,required:!0},apiNamespace:{type:String,required:!0},licenseStatus:{type:String,required:!0},pricingUrl:{type:String,required:!0}},setup(r){const e=r,{openLicenseModal:n,assertActivationIntegrity:t}=Cn({label:e.label,apiNamespace:e.apiNamespace}),s=w(e.licenseStatus),a=w();lt(()=>{t({component:a,licenseStatus:e.licenseStatus})});async function i(){const{isLicenseActive:o}=await n();o&&window.location.reload()}return{__sfc:!0,props:e,openLicenseModal:n,assertActivationIntegrity:t,currentLicenseStatus:s,licenseButtonGroup:a,handleRegistration:i,t:Q}}});function Ee(r,e,n,t,s,a,i,o){var l=typeof r=="function"?r.options:r;return e&&(l.render=e,l.staticRenderFns=n,l._compiled=!0),a&&(l._scopeId="data-v-"+a),{exports:r,options:l}}var In=function(){var e=this,n=e._self._c,t=e._self._setupProxy;return t.currentLicenseStatus!=="active"?n("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:t.currentLicenseStatus==="upgradeable"?"https://hub.kirby.tools":e.pricingUrl,target:"_blank",text:t.currentLicenseStatus==="upgradeable"?t.t("upgrade"):t.t("buy")}}),n("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:t.t("activate")},on:{click:function(s){return t.handleRegistration()}}})],1):e._e()},On=[],En=Ee(Tn,In,On,!1,null,null);const dt=En.exports,$n="__copilot__/context",ft=["anthropic","google","mistral","openai"],Ke=["image/png","image/jpeg","image/webp","image/gif"],jn=["error","warn","info","debug"],Pn="kirby$copilot$",ht=`
You are an AI assistant integrated into the Kirby CMS Panel. Your primary task is to help users generate content for various field types within the CMS. You must provide relevant and helpful content based on the user's question and the specified field type, while considering any provided context.

Consider the user context if provided:
- If selected_text is provided, use it as context for the user's question.
- If pdf_documents are provided, incorporate the information from these documents into your response as applicable.

Format your response according to the specified response_format if provided:
1. If response_format is "text", provide your response in plain text without any Markdown or HTML syntax.
2. If response_format is "HTML", format your response using HTML syntax. Only include the content that would go inside the <body> element. Use appropriate HTML tags to structure your response, including <h2> or <h3> tags for section headings.
3. If response_format is "markdown", format your response using Markdown syntax. Do not use backticks or any other wrapping characters around your response.
`;class $e extends Error{}let ve;async function Ln(r){const e=await Nn(),n=await r.arrayBuffer(),t=await e.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:t.numPages},(a,i)=>Rn(t,i+1)))).map(a=>a.replace(/\s+/g," ")).join(`
`)}async function Rn(r,e){return(await(await r.getPage(e)).getTextContent()).items.filter(s=>s.str!=null).map(s=>s.str).join(" ")}async function Nn(){if(ve)return ve;ve=await ie("pdfjs");const r=ct("pdfjs.worker.js");return ve.GlobalWorkerOptions.workerSrc=r.url,ve}function Mn(r,e,n){return r.replace(/\{(\w+)\}/g,(t,s)=>e[s.toLowerCase()]||s)}async function Bn({accept:r="*",multiple:e=!0}={}){const n=document.createElement("input");return n.type="file",n.classList.add("sr-only"),n.value=null,n.accept=r,n.multiple=e,n.click(),new Promise(t=>{n.addEventListener("change",s=>{var a;t([...((a=s.target)==null?void 0:a.files)??[]]),n.remove()},{once:!0})})}async function zn(r,e){const n=await Zn(r);return await Dn(n,r.type,e)}async function Zn(r,e={}){if(!r.type.startsWith("image/"))throw new TypeError(`MIME type must be an image, but got: ${r.type}`);const n=new Image,t=URL.createObjectURL(r);e.crossOrigin&&(n.crossOrigin=e.crossOrigin);try{return await new Promise((a,i)=>{n.addEventListener("load",()=>{a(n)}),n.addEventListener("error",i),n.src=t})}finally{URL.revokeObjectURL(t)}}async function Dn(r,e,n){if(!r.complete||!r.naturalWidth)throw new Error("Image has not been properly loaded");if(!e.startsWith("image/"))throw new Error(`Blob type must be an image, but got: ${e}`);const t=document.createElement("canvas"),s=t.getContext("2d"),a=Math.min(1,n/Math.max(r.width,r.height)),i=Math.round(r.width*a),o=Math.round(r.height*a);t.width=i,t.height=o,s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(r,0,0,i,o);const l=await new Promise(c=>{t.toBlob(c,e)});if(!l)throw new Error("Failed to convert canvas to Blob");return l}function Un(){const{currentContent:r}=ot(),e={...r.value,title:window.panel.view.title};return Object.fromEntries(Object.entries(e).map(([n,t])=>[n,Array.isArray(t)||typeof t=="object"&&t!==null?JSON.stringify(t):t]))}let Fn;function pt(){return Fn??(Fn=hn("copilot"))}let je,_e;function oe(){return je||_e||(_e=window.panel.api.get($n).then(r=>(gn(r.assets),je=r,_e=void 0,je)),_e)}async function mt({userPrompt:r,systemPrompt:e,files:n=[],logLevel:t=1,abortSignal:s}){const a=pt(),{config:i}=await oe(),o=await gt(),{AISDKError:l,APICallError:c,streamText:f,smoothStream:y}=await ie("ai"),{userPromptWithContext:g,imageByteArrays:x}=await yt({userPrompt:r,files:n});return t>1&&(a.info("System prompt:",e),a.info("User prompt with context:",g)),f({model:o,temperature:i.temperature,system:e||void 0,...x.length>0?{messages:[{role:"user",content:[{type:"text",text:g},...x.map(C=>({type:"image",image:C}))]}]}:{prompt:g},experimental_transform:y({chunking:"line"}),abortSignal:s,onError({error:C}){if(l.isInstance(C)||c.isInstance(C))throw C}})}async function Vn({userPrompt:r,systemPrompt:e,schema:n,output:t="object",files:s=[],logLevel:a=1,abortSignal:i}){const o=pt(),{config:l}=await oe(),c=await gt(),{AISDKError:f,APICallError:y,streamObject:g}=await ie("ai"),{userPromptWithContext:x,imageByteArrays:C}=await yt({userPrompt:r,files:s});return a>1&&(o.info("System prompt:",e),o.info("User prompt with context:",x)),g({model:c,temperature:l.temperature,schema:n,output:t,...C.length>0?{messages:[{role:"user",content:[{type:"text",text:x},...C.map($=>({type:"image",image:$}))]}]}:{prompt:x},abortSignal:i,onError({error:$}){if(f.isInstance($)||y.isInstance($))throw $}})}async function gt(){var c,f;let{config:r}=await oe();if(!r.provider||!ft.includes(r.provider))throw new $e(`Unsupported provider "${r.provider}" in the "johannschopplich.copilot.provider" global configuration.`);for(const y of["apiKey","model"])if(!((f=(c=r.providers)==null?void 0:c[r.provider])!=null&&f[y]))throw new $e(`Missing "${y}" property in the "johannschopplich.copilot.providers.${r.provider}" global configuration.`);const{createAnthropic:e,createGoogleGenerativeAI:n,createMistral:t,createOpenAI:s}=await ie("ai"),a=r.provider,i=r.providers[a],o={anthropic:e,google:n,mistral:t,openai:s}[a];return o({baseUrl:i.baseUrl||void 0,apiKey:i.apiKey}).languageModel(i.model)}async function yt({userPrompt:r,files:e=[]}){const n=Un();let t=Mn(r,n);const s=e.filter(o=>o.type.startsWith("image/")),a=e.filter(o=>o.type==="application/pdf");if(a.length>0){const o=await Promise.all(a.map(Ln));t+=`

${o.map((l,c)=>`<pdf_document_${c+1}>
${l}
</pdf_document_${c+1}>`).join(`

`)}`}const i=await Promise.all(s.map(async o=>{const c=await(await zn(o,2048)).arrayBuffer();return new Uint8Array(c)}));return{userPromptWithContext:t,imageByteArrays:i}}var S;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function n(s){throw new Error}r.assertNever=n,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function t(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=t,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(S||(S={}));var vt;(function(r){r.mergeShapes=(e,n)=>({...e,...n})})(vt||(vt={}));const h=S.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),H=r=>{switch(typeof r){case"undefined":return h.undefined;case"string":return h.string;case"number":return Number.isNaN(r)?h.nan:h.number;case"boolean":return h.boolean;case"function":return h.function;case"bigint":return h.bigint;case"symbol":return h.symbol;case"object":return Array.isArray(r)?h.array:r===null?h.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?h.promise:typeof Map<"u"&&r instanceof Map?h.map:typeof Set<"u"&&r instanceof Set?h.set:typeof Date<"u"&&r instanceof Date?h.date:h.object;default:return h.unknown}},u=S.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class U extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=t=>{this.issues=[...this.issues,t]},this.addIssues=(t=[])=>{this.issues=[...this.issues,...t]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},t={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)t._errors.push(n(i));else{let o=t,l=0;for(;l<i.path.length;){const c=i.path[l];l===i.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(n(i))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return s(this),t}static assert(e){if(!(e instanceof U))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,S.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},t=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):t.push(e(s));return{formErrors:t,fieldErrors:n}}get formErrors(){return this.flatten()}}U.create=r=>new U(r);const We=(r,e)=>{let n;switch(r.code){case u.invalid_type:r.received===h.undefined?n="Required":n=`Expected ${r.expected}, received ${r.received}`;break;case u.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(r.expected,S.jsonStringifyReplacer)}`;break;case u.unrecognized_keys:n=`Unrecognized key(s) in object: ${S.joinValues(r.keys,", ")}`;break;case u.invalid_union:n="Invalid input";break;case u.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${S.joinValues(r.options)}`;break;case u.invalid_enum_value:n=`Invalid enum value. Expected ${S.joinValues(r.options)}, received '${r.received}'`;break;case u.invalid_arguments:n="Invalid function arguments";break;case u.invalid_return_type:n="Invalid function return type";break;case u.invalid_date:n="Invalid date";break;case u.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(n=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?n=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?n=`Invalid input: must end with "${r.validation.endsWith}"`:S.assertNever(r.validation):r.validation!=="regex"?n=`Invalid ${r.validation}`:n="Invalid";break;case u.too_small:r.type==="array"?n=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?n=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?n=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?n=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:n="Invalid input";break;case u.too_big:r.type==="array"?n=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?n=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?n=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?n=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?n=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:n="Invalid input";break;case u.custom:n="Invalid input";break;case u.invalid_intersection_types:n="Intersection results could not be merged";break;case u.not_multiple_of:n=`Number must be a multiple of ${r.multipleOf}`;break;case u.not_finite:n="Number must be finite";break;default:n=e.defaultError,S.assertNever(r)}return{message:n}};let Kn=We;function Wn(){return Kn}const Hn=r=>{const{data:e,path:n,errorMaps:t,issueData:s}=r,a=[...n,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const l=t.filter(c=>!!c).slice().reverse();for(const c of l)o=c(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}};function d(r,e){const n=Wn(),t=Hn({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,n,n===We?void 0:We].filter(s=>!!s)});r.common.issues.push(t)}class j{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const t=[];for(const s of n){if(s.status==="aborted")return _;s.status==="dirty"&&e.dirty(),t.push(s.value)}return{status:e.value,value:t}}static async mergeObjectAsync(e,n){const t=[];for(const s of n){const a=await s.key,i=await s.value;t.push({key:a,value:i})}return j.mergeObjectSync(e,t)}static mergeObjectSync(e,n){const t={};for(const s of n){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return _;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(t[a.value]=i.value)}return{status:e.value,value:t}}}const _=Object.freeze({status:"aborted"}),be=r=>({status:"dirty",value:r}),R=r=>({status:"valid",value:r}),_t=r=>r.status==="aborted",bt=r=>r.status==="dirty",ce=r=>r.status==="valid",Pe=r=>typeof Promise<"u"&&r instanceof Promise;var p;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(p||(p={}));class B{constructor(e,n,t,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=t,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const kt=(r,e)=>{if(ce(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new U(r.common.issues);return this._error=n,this._error}}};function b(r){if(!r)return{};const{errorMap:e,invalid_type_error:n,required_error:t,description:s}=r;if(e&&(n||t))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{const{message:l}=r;return i.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??t??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:l??n??o.defaultError}},description:s}}class k{get description(){return this._def.description}_getType(e){return H(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:H(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new j,ctx:{common:e.parent.common,data:e.data,parsedType:H(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Pe(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const t=this.safeParse(e,n);if(t.success)return t.data;throw t.error}safeParse(e,n){const t={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:H(e)},s=this._parseSync({data:e,path:t.path,parent:t});return kt(t,s)}"~validate"(e){var t,s;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:H(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:n});return ce(a)?{value:a.value}:{issues:n.common.issues}}catch(a){(s=(t=a==null?void 0:a.message)==null?void 0:t.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(a=>ce(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(e,n){const t=await this.safeParseAsync(e,n);if(t.success)return t.data;throw t.error}async safeParseAsync(e,n){const t={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:H(e)},s=this._parse({data:e,path:t.path,parent:t}),a=await(Pe(s)?s:Promise.resolve(s));return kt(t,a)}refine(e,n){const t=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:u.custom,...t(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,n){return this._refinement((t,s)=>e(t)?!0:(s.addIssue(typeof n=="function"?n(t,s):n),!1))}_refinement(e){return new fe({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return G.create(this,this._def)}nullable(){return he.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return z.create(this)}promise(){return Be.create(this,this._def)}or(e){return Re.create([this,e],this._def)}and(e){return Ne.create(this,e,this._def)}transform(e){return new fe({...b(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new Je({...b(this._def),innerType:this,defaultValue:n,typeName:v.ZodDefault})}brand(){return new gr({typeName:v.ZodBranded,type:this,...b(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Xe({...b(this._def),innerType:this,catchValue:n,typeName:v.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Qe.create(this,e)}readonly(){return et.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const qn=/^c[^\s-]{8,}$/i,Gn=/^[0-9a-z]+$/,Yn=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Jn=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Xn=/^[a-z0-9_-]{21}$/i,Qn=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,er=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tr=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,nr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let He;const rr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,sr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ar=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ir=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,or=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xt="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",lr=new RegExp(`^${xt}$`);function wt(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const n=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function ur(r){return new RegExp(`^${wt(r)}$`)}function dr(r){let e=`${xt}T${wt(r)}`;const n=[];return n.push(r.local?"Z?":"Z"),r.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function fr(r,e){return!!((e==="v4"||!e)&&rr.test(r)||(e==="v6"||!e)&&ar.test(r))}function hr(r,e){if(!Qn.test(r))return!1;try{const[n]=r.split("."),t=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(t));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function pr(r,e){return!!((e==="v4"||!e)&&sr.test(r)||(e==="v6"||!e)&&ir.test(r))}class F extends k{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==h.string){const a=this._getOrReturnCtx(e);return d(a,{code:u.invalid_type,expected:h.string,received:a.parsedType}),_}const t=new j;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),d(s,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),d(s,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?d(s,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&d(s,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if(a.kind==="email")tr.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"email",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="emoji")He||(He=new RegExp(nr,"u")),He.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"emoji",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="uuid")Jn.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"uuid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="nanoid")Xn.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"nanoid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="cuid")qn.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"cuid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="cuid2")Gn.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"cuid2",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="ulid")Yn.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"ulid",code:u.invalid_string,message:a.message}),t.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),d(s,{validation:"url",code:u.invalid_string,message:a.message}),t.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"regex",code:u.invalid_string,message:a.message}),t.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),d(s,{code:u.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),d(s,{code:u.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),d(s,{code:u.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty()):a.kind==="datetime"?dr(a).test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{code:u.invalid_string,validation:"datetime",message:a.message}),t.dirty()):a.kind==="date"?lr.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{code:u.invalid_string,validation:"date",message:a.message}),t.dirty()):a.kind==="time"?ur(a).test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{code:u.invalid_string,validation:"time",message:a.message}),t.dirty()):a.kind==="duration"?er.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"duration",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="ip"?fr(e.data,a.version)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"ip",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="jwt"?hr(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"jwt",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="cidr"?pr(e.data,a.version)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"cidr",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="base64"?or.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"base64",code:u.invalid_string,message:a.message}),t.dirty()):a.kind==="base64url"?cr.test(e.data)||(s=this._getOrReturnCtx(e,s),d(s,{validation:"base64url",code:u.invalid_string,message:a.message}),t.dirty()):S.assertNever(a);return{status:t.value,value:e.data}}_regex(e,n,t){return this.refinement(s=>e.test(s),{validation:n,code:u.invalid_string,...p.errToObj(t)})}_addCheck(e){return new F({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...p.errToObj(e)})}url(e){return this._addCheck({kind:"url",...p.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...p.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...p.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...p.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...p.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...p.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...p.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...p.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...p.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...p.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...p.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...p.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...p.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...p.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...p.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...p.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...p.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...p.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...p.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...p.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...p.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...p.errToObj(n)})}nonempty(e){return this.min(1,p.errToObj(e))}trim(){return new F({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new F({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new F({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}F.create=r=>new F({checks:[],typeName:v.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...b(r)});function mr(r,e){const n=(r.toString().split(".")[1]||"").length,t=(e.toString().split(".")[1]||"").length,s=n>t?n:t,a=Number.parseInt(r.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}class le extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==h.number){const a=this._getOrReturnCtx(e);return d(a,{code:u.invalid_type,expected:h.number,received:a.parsedType}),_}let t;const s=new j;for(const a of this._def.checks)a.kind==="int"?S.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),d(t,{code:u.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),d(t,{code:u.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),d(t,{code:u.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?mr(e.data,a.value)!==0&&(t=this._getOrReturnCtx(e,t),d(t,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),d(t,{code:u.not_finite,message:a.message}),s.dirty()):S.assertNever(a);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,p.toString(n))}gt(e,n){return this.setLimit("min",e,!1,p.toString(n))}lte(e,n){return this.setLimit("max",e,!0,p.toString(n))}lt(e,n){return this.setLimit("max",e,!1,p.toString(n))}setLimit(e,n,t,s){return new le({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:t,message:p.toString(s)}]})}_addCheck(e){return new le({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:p.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:p.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:p.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:p.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:p.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:p.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:p.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:p.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:p.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&S.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const t of this._def.checks){if(t.kind==="finite"||t.kind==="int"||t.kind==="multipleOf")return!0;t.kind==="min"?(n===null||t.value>n)&&(n=t.value):t.kind==="max"&&(e===null||t.value<e)&&(e=t.value)}return Number.isFinite(n)&&Number.isFinite(e)}}le.create=r=>new le({checks:[],typeName:v.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...b(r)});class ke extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==h.bigint)return this._getInvalidInput(e);let t;const s=new j;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),d(t,{code:u.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),d(t,{code:u.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),d(t,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):S.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return d(n,{code:u.invalid_type,expected:h.bigint,received:n.parsedType}),_}gte(e,n){return this.setLimit("min",e,!0,p.toString(n))}gt(e,n){return this.setLimit("min",e,!1,p.toString(n))}lte(e,n){return this.setLimit("max",e,!0,p.toString(n))}lt(e,n){return this.setLimit("max",e,!1,p.toString(n))}setLimit(e,n,t,s){return new ke({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:t,message:p.toString(s)}]})}_addCheck(e){return new ke({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:p.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:p.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:p.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:p.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:p.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}ke.create=r=>new ke({checks:[],typeName:v.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...b(r)});class qe extends k{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==h.boolean){const t=this._getOrReturnCtx(e);return d(t,{code:u.invalid_type,expected:h.boolean,received:t.parsedType}),_}return R(e.data)}}qe.create=r=>new qe({typeName:v.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...b(r)});class Le extends k{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==h.date){const a=this._getOrReturnCtx(e);return d(a,{code:u.invalid_type,expected:h.date,received:a.parsedType}),_}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return d(a,{code:u.invalid_date}),_}const t=new j;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),d(s,{code:u.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),d(s,{code:u.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):S.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Le({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:p.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:p.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Le.create=r=>new Le({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:v.ZodDate,...b(r)});class St extends k{_parse(e){if(this._getType(e)!==h.symbol){const t=this._getOrReturnCtx(e);return d(t,{code:u.invalid_type,expected:h.symbol,received:t.parsedType}),_}return R(e.data)}}St.create=r=>new St({typeName:v.ZodSymbol,...b(r)});class Ct extends k{_parse(e){if(this._getType(e)!==h.undefined){const t=this._getOrReturnCtx(e);return d(t,{code:u.invalid_type,expected:h.undefined,received:t.parsedType}),_}return R(e.data)}}Ct.create=r=>new Ct({typeName:v.ZodUndefined,...b(r)});class At extends k{_parse(e){if(this._getType(e)!==h.null){const t=this._getOrReturnCtx(e);return d(t,{code:u.invalid_type,expected:h.null,received:t.parsedType}),_}return R(e.data)}}At.create=r=>new At({typeName:v.ZodNull,...b(r)});class Tt extends k{constructor(){super(...arguments),this._any=!0}_parse(e){return R(e.data)}}Tt.create=r=>new Tt({typeName:v.ZodAny,...b(r)});class It extends k{constructor(){super(...arguments),this._unknown=!0}_parse(e){return R(e.data)}}It.create=r=>new It({typeName:v.ZodUnknown,...b(r)});class q extends k{_parse(e){const n=this._getOrReturnCtx(e);return d(n,{code:u.invalid_type,expected:h.never,received:n.parsedType}),_}}q.create=r=>new q({typeName:v.ZodNever,...b(r)});class Ot extends k{_parse(e){if(this._getType(e)!==h.undefined){const t=this._getOrReturnCtx(e);return d(t,{code:u.invalid_type,expected:h.void,received:t.parsedType}),_}return R(e.data)}}Ot.create=r=>new Ot({typeName:v.ZodVoid,...b(r)});class z extends k{_parse(e){const{ctx:n,status:t}=this._processInputParams(e),s=this._def;if(n.parsedType!==h.array)return d(n,{code:u.invalid_type,expected:h.array,received:n.parsedType}),_;if(s.exactLength!==null){const i=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(i||o)&&(d(n,{code:i?u.too_big:u.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),t.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(d(n,{code:u.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),t.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(d(n,{code:u.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),t.dirty()),n.common.async)return Promise.all([...n.data].map((i,o)=>s.type._parseAsync(new B(n,i,n.path,o)))).then(i=>j.mergeArray(t,i));const a=[...n.data].map((i,o)=>s.type._parseSync(new B(n,i,n.path,o)));return j.mergeArray(t,a)}get element(){return this._def.type}min(e,n){return new z({...this._def,minLength:{value:e,message:p.toString(n)}})}max(e,n){return new z({...this._def,maxLength:{value:e,message:p.toString(n)}})}length(e,n){return new z({...this._def,exactLength:{value:e,message:p.toString(n)}})}nonempty(e){return this.min(1,e)}}z.create=(r,e)=>new z({type:r,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...b(e)});function ue(r){if(r instanceof T){const e={};for(const n in r.shape){const t=r.shape[n];e[n]=G.create(ue(t))}return new T({...r._def,shape:()=>e})}else return r instanceof z?new z({...r._def,type:ue(r.element)}):r instanceof G?G.create(ue(r.unwrap())):r instanceof he?he.create(ue(r.unwrap())):r instanceof ee?ee.create(r.items.map(e=>ue(e))):r}class T extends k{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=S.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==h.object){const c=this._getOrReturnCtx(e);return d(c,{code:u.invalid_type,expected:h.object,received:c.parsedType}),_}const{status:t,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof q&&this._def.unknownKeys==="strip"))for(const c in s.data)i.includes(c)||o.push(c);const l=[];for(const c of i){const f=a[c],y=s.data[c];l.push({key:{status:"valid",value:c},value:f._parse(new B(s,y,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof q){const c=this._def.unknownKeys;if(c==="passthrough")for(const f of o)l.push({key:{status:"valid",value:f},value:{status:"valid",value:s.data[f]}});else if(c==="strict")o.length>0&&(d(s,{code:u.unrecognized_keys,keys:o}),t.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const f of o){const y=s.data[f];l.push({key:{status:"valid",value:f},value:c._parse(new B(s,y,s.path,f)),alwaysSet:f in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const f of l){const y=await f.key,g=await f.value;c.push({key:y,value:g,alwaysSet:f.alwaysSet})}return c}).then(c=>j.mergeObjectSync(t,c)):j.mergeObjectSync(t,l)}get shape(){return this._def.shape()}strict(e){return p.errToObj,new T({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,t)=>{var a,i;const s=((i=(a=this._def).errorMap)==null?void 0:i.call(a,n,t).message)??t.defaultError;return n.code==="unrecognized_keys"?{message:p.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new T({...this._def,unknownKeys:"strip"})}passthrough(){return new T({...this._def,unknownKeys:"passthrough"})}extend(e){return new T({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new T({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new T({...this._def,catchall:e})}pick(e){const n={};for(const t of S.objectKeys(e))e[t]&&this.shape[t]&&(n[t]=this.shape[t]);return new T({...this._def,shape:()=>n})}omit(e){const n={};for(const t of S.objectKeys(this.shape))e[t]||(n[t]=this.shape[t]);return new T({...this._def,shape:()=>n})}deepPartial(){return ue(this)}partial(e){const n={};for(const t of S.objectKeys(this.shape)){const s=this.shape[t];e&&!e[t]?n[t]=s:n[t]=s.optional()}return new T({...this._def,shape:()=>n})}required(e){const n={};for(const t of S.objectKeys(this.shape))if(e&&!e[t])n[t]=this.shape[t];else{let a=this.shape[t];for(;a instanceof G;)a=a._def.innerType;n[t]=a}return new T({...this._def,shape:()=>n})}keyof(){return jt(S.objectKeys(this.shape))}}T.create=(r,e)=>new T({shape:()=>r,unknownKeys:"strip",catchall:q.create(),typeName:v.ZodObject,...b(e)}),T.strictCreate=(r,e)=>new T({shape:()=>r,unknownKeys:"strict",catchall:q.create(),typeName:v.ZodObject,...b(e)}),T.lazycreate=(r,e)=>new T({shape:r,unknownKeys:"strip",catchall:q.create(),typeName:v.ZodObject,...b(e)});class Re extends k{_parse(e){const{ctx:n}=this._processInputParams(e),t=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new U(o.ctx.common.issues));return d(n,{code:u.invalid_union,unionErrors:i}),_}if(n.common.async)return Promise.all(t.map(async a=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const l of t){const c={...n,common:{...n.common,issues:[]},parent:null},f=l._parseSync({data:n.data,path:n.path,parent:c});if(f.status==="valid")return f;f.status==="dirty"&&!a&&(a={result:f,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(l=>new U(l));return d(n,{code:u.invalid_union,unionErrors:o}),_}}get options(){return this._def.options}}Re.create=(r,e)=>new Re({options:r,typeName:v.ZodUnion,...b(e)});function Ge(r,e){const n=H(r),t=H(e);if(r===e)return{valid:!0,data:r};if(n===h.object&&t===h.object){const s=S.objectKeys(e),a=S.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const l=Ge(r[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(n===h.array&&t===h.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],l=Ge(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return n===h.date&&t===h.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Ne extends k{_parse(e){const{status:n,ctx:t}=this._processInputParams(e),s=(a,i)=>{if(_t(a)||_t(i))return _;const o=Ge(a.value,i.value);return o.valid?((bt(a)||bt(i))&&n.dirty(),{status:n.value,value:o.data}):(d(t,{code:u.invalid_intersection_types}),_)};return t.common.async?Promise.all([this._def.left._parseAsync({data:t.data,path:t.path,parent:t}),this._def.right._parseAsync({data:t.data,path:t.path,parent:t})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:t.data,path:t.path,parent:t}),this._def.right._parseSync({data:t.data,path:t.path,parent:t}))}}Ne.create=(r,e,n)=>new Ne({left:r,right:e,typeName:v.ZodIntersection,...b(n)});class ee extends k{_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.array)return d(t,{code:u.invalid_type,expected:h.array,received:t.parsedType}),_;if(t.data.length<this._def.items.length)return d(t,{code:u.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),_;!this._def.rest&&t.data.length>this._def.items.length&&(d(t,{code:u.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...t.data].map((i,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new B(t,i,t.path,o)):null}).filter(i=>!!i);return t.common.async?Promise.all(a).then(i=>j.mergeArray(n,i)):j.mergeArray(n,a)}get items(){return this._def.items}rest(e){return new ee({...this._def,rest:e})}}ee.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ee({items:r,typeName:v.ZodTuple,rest:null,...b(e)})};class Me extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.object)return d(t,{code:u.invalid_type,expected:h.object,received:t.parsedType}),_;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in t.data)s.push({key:a._parse(new B(t,o,t.path,o)),value:i._parse(new B(t,t.data[o],t.path,o)),alwaysSet:o in t.data});return t.common.async?j.mergeObjectAsync(n,s):j.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(e,n,t){return n instanceof k?new Me({keyType:e,valueType:n,typeName:v.ZodRecord,...b(t)}):new Me({keyType:F.create(),valueType:e,typeName:v.ZodRecord,...b(n)})}}class Et extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.map)return d(t,{code:u.invalid_type,expected:h.map,received:t.parsedType}),_;const s=this._def.keyType,a=this._def.valueType,i=[...t.data.entries()].map(([o,l],c)=>({key:s._parse(new B(t,o,t.path,[c,"key"])),value:a._parse(new B(t,l,t.path,[c,"value"]))}));if(t.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of i){const c=await l.key,f=await l.value;if(c.status==="aborted"||f.status==="aborted")return _;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),o.set(c.value,f.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const l of i){const c=l.key,f=l.value;if(c.status==="aborted"||f.status==="aborted")return _;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),o.set(c.value,f.value)}return{status:n.value,value:o}}}}Et.create=(r,e,n)=>new Et({valueType:e,keyType:r,typeName:v.ZodMap,...b(n)});class xe extends k{_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.parsedType!==h.set)return d(t,{code:u.invalid_type,expected:h.set,received:t.parsedType}),_;const s=this._def;s.minSize!==null&&t.data.size<s.minSize.value&&(d(t,{code:u.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&t.data.size>s.maxSize.value&&(d(t,{code:u.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const a=this._def.valueType;function i(l){const c=new Set;for(const f of l){if(f.status==="aborted")return _;f.status==="dirty"&&n.dirty(),c.add(f.value)}return{status:n.value,value:c}}const o=[...t.data.values()].map((l,c)=>a._parse(new B(t,l,t.path,c)));return t.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,n){return new xe({...this._def,minSize:{value:e,message:p.toString(n)}})}max(e,n){return new xe({...this._def,maxSize:{value:e,message:p.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}xe.create=(r,e)=>new xe({valueType:r,minSize:null,maxSize:null,typeName:v.ZodSet,...b(e)});class $t extends k{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}$t.create=(r,e)=>new $t({getter:r,typeName:v.ZodLazy,...b(e)});class Ye extends k{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return d(n,{received:n.data,code:u.invalid_literal,expected:this._def.value}),_}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ye.create=(r,e)=>new Ye({value:r,typeName:v.ZodLiteral,...b(e)});function jt(r,e){return new de({values:r,typeName:v.ZodEnum,...b(e)})}class de extends k{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),t=this._def.values;return d(n,{expected:S.joinValues(t),received:n.parsedType,code:u.invalid_type}),_}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),t=this._def.values;return d(n,{received:n.data,code:u.invalid_enum_value,options:t}),_}return R(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return de.create(e,{...this._def,...n})}exclude(e,n=this._def){return de.create(this.options.filter(t=>!e.includes(t)),{...this._def,...n})}}de.create=jt;class Pt extends k{_parse(e){const n=S.getValidEnumValues(this._def.values),t=this._getOrReturnCtx(e);if(t.parsedType!==h.string&&t.parsedType!==h.number){const s=S.objectValues(n);return d(t,{expected:S.joinValues(s),received:t.parsedType,code:u.invalid_type}),_}if(this._cache||(this._cache=new Set(S.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=S.objectValues(n);return d(t,{received:t.data,code:u.invalid_enum_value,options:s}),_}return R(e.data)}get enum(){return this._def.values}}Pt.create=(r,e)=>new Pt({values:r,typeName:v.ZodNativeEnum,...b(e)});class Be extends k{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==h.promise&&n.common.async===!1)return d(n,{code:u.invalid_type,expected:h.promise,received:n.parsedType}),_;const t=n.parsedType===h.promise?n.data:Promise.resolve(n.data);return R(t.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Be.create=(r,e)=>new Be({type:r,typeName:v.ZodPromise,...b(e)});class fe extends k{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:t}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{d(t,i),i.fatal?n.abort():n.dirty()},get path(){return t.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(t.data,a);if(t.common.async)return Promise.resolve(i).then(async o=>{if(n.value==="aborted")return _;const l=await this._def.schema._parseAsync({data:o,path:t.path,parent:t});return l.status==="aborted"?_:l.status==="dirty"||n.value==="dirty"?be(l.value):l});{if(n.value==="aborted")return _;const o=this._def.schema._parseSync({data:i,path:t.path,parent:t});return o.status==="aborted"?_:o.status==="dirty"||n.value==="dirty"?be(o.value):o}}if(s.type==="refinement"){const i=o=>{const l=s.refinement(o,a);if(t.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(t.common.async===!1){const o=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});return o.status==="aborted"?_:(o.status==="dirty"&&n.dirty(),i(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(o=>o.status==="aborted"?_:(o.status==="dirty"&&n.dirty(),i(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(t.common.async===!1){const i=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});if(!ce(i))return _;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(i=>ce(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:n.value,value:o})):_);S.assertNever(s)}}fe.create=(r,e,n)=>new fe({schema:r,typeName:v.ZodEffects,effect:e,...b(n)}),fe.createWithPreprocess=(r,e,n)=>new fe({schema:e,effect:{type:"preprocess",transform:r},typeName:v.ZodEffects,...b(n)});class G extends k{_parse(e){return this._getType(e)===h.undefined?R(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}G.create=(r,e)=>new G({innerType:r,typeName:v.ZodOptional,...b(e)});class he extends k{_parse(e){return this._getType(e)===h.null?R(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}he.create=(r,e)=>new he({innerType:r,typeName:v.ZodNullable,...b(e)});class Je extends k{_parse(e){const{ctx:n}=this._processInputParams(e);let t=n.data;return n.parsedType===h.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Je.create=(r,e)=>new Je({innerType:r,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...b(e)});class Xe extends k{_parse(e){const{ctx:n}=this._processInputParams(e),t={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return Pe(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new U(t.common.issues)},input:t.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new U(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}}Xe.create=(r,e)=>new Xe({innerType:r,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...b(e)});class Lt extends k{_parse(e){if(this._getType(e)!==h.nan){const t=this._getOrReturnCtx(e);return d(t,{code:u.invalid_type,expected:h.nan,received:t.parsedType}),_}return{status:"valid",value:e.data}}}Lt.create=r=>new Lt({typeName:v.ZodNaN,...b(r)});class gr extends k{_parse(e){const{ctx:n}=this._processInputParams(e),t=n.data;return this._def.type._parse({data:t,path:n.path,parent:n})}unwrap(){return this._def.type}}class Qe extends k{_parse(e){const{status:n,ctx:t}=this._processInputParams(e);if(t.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:t.data,path:t.path,parent:t});return a.status==="aborted"?_:a.status==="dirty"?(n.dirty(),be(a.value)):this._def.out._parseAsync({data:a.value,path:t.path,parent:t})})();{const s=this._def.in._parseSync({data:t.data,path:t.path,parent:t});return s.status==="aborted"?_:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:t.path,parent:t})}}static create(e,n){return new Qe({in:e,out:n,typeName:v.ZodPipeline})}}class et extends k{_parse(e){const n=this._def.innerType._parse(e),t=s=>(ce(s)&&(s.value=Object.freeze(s.value)),s);return Pe(n)?n.then(s=>t(s)):t(n)}unwrap(){return this._def.innerType}}et.create=(r,e)=>new et({innerType:r,typeName:v.ZodReadonly,...b(e)});var v;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(v||(v={}));const E=F.create,Rt=le.create,yr=qe.create;q.create;const pe=z.create,we=T.create,Nt=Re.create;Ne.create,ee.create;const vr=Me.create,_r=Ye.create,tt=de.create;Be.create,G.create,he.create;const Mt=new Set(["files","gap","headline","info","layout","layout","line"]),br={text:r=>E().describe(`"${r.label}", single-line plain text without line breaks or formatting`),textarea:r=>E().describe(`"${r.label}", multi-line plain text content with line breaks for paragraphs. Markdown formatting is allowed if content requires it.`),email:r=>E().describe(`"${r.label}", a valid email address`),tel:r=>E().describe(`"${r.label}", a telephone number in appropriate format for the context`),url:r=>E().describe(`"${r.label}", a complete and valid URL starting with http:// or https://`),password:r=>E().describe(`"${r.label}", a secure password (not for actual use)`),writer:r=>E().describe(`"${r.label}" (WYSIWYG), ${r.inline?"inline formatting only (bold, italic, underline, code, links) – NO paragraph <p> tags allowed":"content must be wrapped in <p> tags (can contain one or multiple paragraphs) plus inline formatting (bold, italic, underline, code, links)"}`),markdown:r=>E().describe(`"${r.label}", content in Markdown syntax (headers, lists, links, emphasis, etc.)`),list:r=>E().describe(`"${r.label}" (WYSIWYG), HTML list content: wrap in <ul> for unordered or <ol> for ordered lists, with <li> items`),toggle:r=>yr().describe(`"${r.label}", a boolean based on context appropriateness`),select:r=>nt(r),radio:r=>nt(r),toggles:r=>nt(r),checkboxes:r=>rt(r),multiselect:r=>rt(r),tags:r=>rt(r),number:r=>{let e=Rt();return r.min!=null&&(e=e.min(r.min)),r.max!=null&&(e=e.max(r.max)),e.describe(`"${r.label}", a numeric value${r.min!=null||r.max!=null?" within the defined range":""}`)},range:r=>{let e=Rt();return r.min!=null&&(e=e.min(r.min)),r.max!=null&&(e=e.max(r.max)),e.describe(`"${r.label}", a numeric value${r.min!=null||r.max!=null?" within the defined range":""}`)},date:r=>E().describe(`"${r.label}", a date ${r.time?"with time in YYYY-MM-DD HH:MM:SS format (ISO 8601)":"in YYYY-MM-DD format (ISO 8601)"}`),time:r=>E().describe(`"${r.label}", a time in HH:MM:SS format (24-hour, ISO 8601)`),structure:r=>{if(typeof r.fields=="object"&&r.fields!==null){const e={};for(const[n,t]of Object.entries(r.fields))t.disabled||t.hidden||Mt.has(t.type)||(e[n]=Bt({...t,name:n}));return pe(we(e)).describe(`"${r.label}", repeatable structured data, each containing the defined sub-fields with appropriate content`)}return pe(vr(E())).describe(`"${r.label}", repeatable structured data based on expected content structure`)},color:r=>E().describe(`"${r.label}", a color value in hex, rgb or hsl format`),link:r=>E().describe(`"${r.label}", a link: internal page UUIDs (page://...), external URLs (https://...), email links (mailto:...), or anchors (#section)`),slug:r=>E().describe(`"${r.label}", a URL-friendly slug (lowercase, hyphens, no spaces or special characters)`)};function nt(r){const e=(r.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return e.length>0?tt(e).describe(`"${r.label}", single selection value based on the predefined options`):E().describe(`"${r.label}", single selection value`)}function rt(r){const e=(r.options??[]).map(n=>typeof n=="string"?n:n.value).filter(Boolean);return e.length>0?pe(tt(e)).describe(`"${r.label}", one ore many values based on the predefined options`):pe(E()).describe(`"${r.label}", multiple selection values`)}function Bt(r){const e=br[r.type];let n=e(r);if(r.required===!0)if(n._def.typeName==="ZodString"){const t=n._def.description;n=E().min(1).describe(t)}else n._def.typeName==="ZodArray"&&(n=n.min(1));return n}function zt(r){const{name:e,type:n,fields:t}=r;if(!t||Object.keys(t).length===0)return;const s={};for(const a of Object.values(t)){if(a.disabled||a.hidden||Mt.has(a.type))continue;const i=Bt(a);s[a.name]=i}return we({type:_r(n),content:we(s)}).describe(`Kirby block: ${e}`)}function kr(r){if(!Array.isArray(r)||r.length===0)throw new Error("Invalid fieldsets configuration");const e=r.map(zt).filter(Boolean);return Nt(e).describe("Union of all Kirby block types")}let ze,Se;function Zt(){async function r(){return ze||Se||(Se=window.panel.api.get("/__copilot__/fieldsets").then(t=>(ze=t,Se=void 0,ze)),Se)}async function e(t){let s=await r();return t.fieldsets&&Array.isArray(t.fieldsets)&&(s=s.filter(a=>t.fieldsets.includes(a.type))),kr(s)}function n(t){return t.isHidden??(t.isHidden=!1),t.id??(t.id=crypto.randomUUID()),t}return{getFieldsets:r,getZodSchema:e,normalizeBlock:n}}function xr(r,e,n,t){let s;const a=()=>{s==null||s(),s=void 0},i=(c,f,y,g)=>(c.addEventListener(f,y,g),()=>c.removeEventListener(f,y,g)),o=Fe(()=>wr(r),c=>{a(),c&&(s=i(c,e,n,t))},{immediate:!0,flush:"post"}),l=()=>{o(),a()};return yn()&&bn(l),l}function wr(r){const e=Ue(r);return(e==null?void 0:e.$el)??e}function Dt(){return Bn({accept:[...Ke,"application/pdf"].join(",")})}function Sr(r){const e=new Set;for(const n of r)if(typeof n=="string"){const t=n.split(",").map(s=>s.trim());for(const s of t)e.add(s)}return Array.from(e)}function Cr(r,e){const n=r.map(zt).filter(Boolean),t=n.length>1?Nt(n):n[0];return we({width:tt(e).describe('Column width fraction to use, e.g. "1/2"'),blocks:pe(t).describe("Array of blocks contained in this column")})}function Ar(r,e){const n=Cr(r,e);return we({columns:pe(n).min(1).describe("Array of columns in this layout")})}function Tr(r,e={}){if(!r||r.length===0)throw new Error("No fieldsets available for layout schema generation");const n=e.layouts||["1/1"],t=Sr(n),s=Ar(r,t),a=n.map(i=>`"${i}"`).join(", ");return s.describe(`Kirby layout with columns and blocks. Available layout combinations: ${a}. Use these exact column width combinations when creating layouts.`)}function Ir(){const{getFieldsets:r}=Zt();async function e(t){const s=await r();let a=s;return t.fieldsets&&Array.isArray(t.fieldsets)&&(a=s.filter(i=>t.fieldsets.includes(i.type))),Tr(a,t)}function n(t){return t.id??(t.id=crypto.randomUUID()),t.attrs??(t.attrs=[]),t.columns=(t.columns??[]).map(s=>(s.id??(s.id=crypto.randomUUID()),s.width??(s.width="1/1"),s.blocks=(s.blocks??[]).map(a=>(a.isHidden??(a.isHidden=!1),a.id??(a.id=crypto.randomUUID()),a)),s)),t}return{getZodSchema:e,normalizeLayout:n}}const Ut=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});function Or(r,e){e?e={...Ut,...e}:e=Ut;const n=Ft(e);return n.dispatch(r),n.toString()}const Er=Object.freeze(["prototype","__proto__","constructor"]);function Ft(r){let e="",n=new Map;const t=s=>{e+=s};return{toString(){return e},getContext(){return n},dispatch(s){return r.replacer&&(s=r.replacer(s)),this[s===null?"null":typeof s](s)},object(s){if(s&&typeof s.toJSON=="function")return this.object(s.toJSON());const a=Object.prototype.toString.call(s);let i="";const o=a.length;o<10?i="unknown:["+a+"]":i=a.slice(8,o-1),i=i.toLowerCase();let l=null;if((l=n.get(s))===void 0)n.set(s,n.size);else return this.dispatch("[CIRCULAR:"+l+"]");if(typeof Buffer<"u"&&Buffer.isBuffer&&Buffer.isBuffer(s))return t("buffer:"),t(s.toString("utf8"));if(i!=="object"&&i!=="function"&&i!=="asyncfunction")this[i]?this[i](s):r.ignoreUnknown||this.unkown(s,i);else{let c=Object.keys(s);r.unorderedObjects&&(c=c.sort());let f=[];r.respectType!==!1&&!Kt(s)&&(f=Er),r.excludeKeys&&(c=c.filter(g=>!r.excludeKeys(g)),f=f.filter(g=>!r.excludeKeys(g))),t("object:"+(c.length+f.length)+":");const y=g=>{this.dispatch(g),t(":"),r.excludeValues||this.dispatch(s[g]),t(",")};for(const g of c)y(g);for(const g of f)y(g)}},array(s,a){if(a=a===void 0?r.unorderedArrays!==!1:a,t("array:"+s.length+":"),!a||s.length<=1){for(const l of s)this.dispatch(l);return}const i=new Map,o=s.map(l=>{const c=Ft(r);c.dispatch(l);for(const[f,y]of c.getContext())i.set(f,y);return c.toString()});return n=i,o.sort(),this.array(o,!1)},date(s){return t("date:"+s.toJSON())},symbol(s){return t("symbol:"+s.toString())},unkown(s,a){if(t(a),!!s&&(t(":"),s&&typeof s.entries=="function"))return this.array(Array.from(s.entries()),!0)},error(s){return t("error:"+s.toString())},boolean(s){return t("bool:"+s)},string(s){t("string:"+s.length+":"),t(s)},function(s){t("fn:"),Kt(s)?this.dispatch("[native]"):this.dispatch(s.toString()),r.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(s.name)),r.respectFunctionProperties&&this.object(s)},number(s){return t("number:"+s)},xml(s){return t("xml:"+s.toString())},null(){return t("Null")},undefined(){return t("Undefined")},regexp(s){return t("regex:"+s.toString())},uint8array(s){return t("uint8array:"),this.dispatch(Array.prototype.slice.call(s))},uint8clampedarray(s){return t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(s))},int8array(s){return t("int8array:"),this.dispatch(Array.prototype.slice.call(s))},uint16array(s){return t("uint16array:"),this.dispatch(Array.prototype.slice.call(s))},int16array(s){return t("int16array:"),this.dispatch(Array.prototype.slice.call(s))},uint32array(s){return t("uint32array:"),this.dispatch(Array.prototype.slice.call(s))},int32array(s){return t("int32array:"),this.dispatch(Array.prototype.slice.call(s))},float32array(s){return t("float32array:"),this.dispatch(Array.prototype.slice.call(s))},float64array(s){return t("float64array:"),this.dispatch(Array.prototype.slice.call(s))},arraybuffer(s){return t("arraybuffer:"),this.dispatch(new Uint8Array(s))},url(s){return t("url:"+s.toString())},map(s){t("map:");const a=[...s];return this.array(a,r.unorderedSets!==!1)},set(s){t("set:");const a=[...s];return this.array(a,r.unorderedSets!==!1)},file(s){return t("file:"),this.dispatch([s.name,s.size,s.type,s.lastModfied])},blob(){if(r.ignoreUnknown)return t("[blob]");throw new Error(`Hashing Blob objects is currently not supported
Use "options.replacer" or "options.ignoreUnknown"
`)},domwindow(){return t("domwindow")},bigint(s){return t("bigint:"+s.toString())},process(){return t("process")},timer(){return t("timer")},pipe(){return t("pipe")},tcp(){return t("tcp")},udp(){return t("udp")},tty(){return t("tty")},statwatcher(){return t("statwatcher")},securecontext(){return t("securecontext")},connection(){return t("connection")},zlib(){return t("zlib")},context(){return t("context")},nodescript(){return t("nodescript")},httpparser(){return t("httpparser")},dataview(){return t("dataview")},signal(){return t("signal")},fsevent(){return t("fsevent")},tlswrap(){return t("tlswrap")}}}const Vt="[native code] }",$r=Vt.length;function Kt(r){return typeof r!="function"?!1:Function.prototype.toString.call(r).slice(-$r)===Vt}class Y{constructor(e,n){M(this,"words");M(this,"sigBytes");e=this.words=e||[],this.sigBytes=n===void 0?e.length*4:n}toString(e){return(e||jr).stringify(this)}concat(e){if(this.clamp(),this.sigBytes%4)for(let n=0;n<e.sigBytes;n++){const t=e.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=t<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<e.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=e.words[n>>>2];return this.sigBytes+=e.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new Y([...this.words])}}const jr={stringify(r){const e=[];for(let n=0;n<r.sigBytes;n++){const t=r.words[n>>>2]>>>24-n%4*8&255;e.push((t>>>4).toString(16),(t&15).toString(16))}return e.join("")}},Pr={stringify(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=[];for(let t=0;t<r.sigBytes;t+=3){const s=r.words[t>>>2]>>>24-t%4*8&255,a=r.words[t+1>>>2]>>>24-(t+1)%4*8&255,i=r.words[t+2>>>2]>>>24-(t+2)%4*8&255,o=s<<16|a<<8|i;for(let l=0;l<4&&t*8+l*6<r.sigBytes*8;l++)n.push(e.charAt(o>>>6*(3-l)&63))}return n.join("")}},Lr={parse(r){const e=r.length,n=[];for(let t=0;t<e;t++)n[t>>>2]|=(r.charCodeAt(t)&255)<<24-t%4*8;return new Y(n,e)}},Rr={parse(r){return Lr.parse(unescape(encodeURIComponent(r)))}};class Nr{constructor(){M(this,"_data",new Y);M(this,"_nDataBytes",0);M(this,"_minBufferSize",0);M(this,"blockSize",512/32)}reset(){this._data=new Y,this._nDataBytes=0}_append(e){typeof e=="string"&&(e=Rr.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_doProcessBlock(e,n){}_process(e){let n,t=this._data.sigBytes/(this.blockSize*4);e?t=Math.ceil(t):t=Math.max((t|0)-this._minBufferSize,0);const s=t*this.blockSize,a=Math.min(s*4,this._data.sigBytes);if(s){for(let i=0;i<s;i+=this.blockSize)this._doProcessBlock(this._data.words,i);n=this._data.words.splice(0,s),this._data.sigBytes-=a}return new Y(n,a)}}class Mr extends Nr{update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e)}}const Wt=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Br=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],te=[];class zr extends Mr{constructor(){super(...arguments);M(this,"_hash",new Y([...Wt]))}reset(){super.reset(),this._hash=new Y([...Wt])}_doProcessBlock(n,t){const s=this._hash.words;let a=s[0],i=s[1],o=s[2],l=s[3],c=s[4],f=s[5],y=s[6],g=s[7];for(let x=0;x<64;x++){if(x<16)te[x]=n[t+x]|0;else{const N=te[x-15],ge=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,V=te[x-2],J=(V<<15|V>>>17)^(V<<13|V>>>19)^V>>>10;te[x]=ge+te[x-7]+J+te[x-16]}const C=c&f^~c&y,$=a&i^a&o^i&o,A=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),Z=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),ne=g+Z+C+Br[x]+te[x],me=A+$;g=y,y=f,f=c,c=l+ne|0,l=o,o=i,i=a,a=ne+me|0}s[0]=s[0]+a|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+l|0,s[4]=s[4]+c|0,s[5]=s[5]+f|0,s[6]=s[6]+y|0,s[7]=s[7]+g|0}finalize(n){super.finalize(n);const t=this._nDataBytes*8,s=this._data.sigBytes*8;return this._data.words[s>>>5]|=128<<24-s%32,this._data.words[(s+64>>>9<<4)+14]=Math.floor(t/4294967296),this._data.words[(s+64>>>9<<4)+15]=t,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}}function Zr(r){return new zr().finalize(r).toString(Pr)}function Dr(r,e={}){const n=typeof r=="string"?r:Or(r,e);return Zr(n).slice(0,10)}function Ht(...r){return`${Pn}${Dr([...r])}`}const qt=50;function Ur(){const r=Ht("history",window.location.hostname),e=w(JSON.parse(localStorage.getItem(r)||"[]")),n=w(""),t=w(-1);function s(i){if(!i)return;const o=e.value.indexOf(i);o!==-1&&e.value.splice(o,1),e.value.unshift(i),e.value.length>qt&&(e.value=e.value.slice(0,qt)),localStorage.setItem(r,JSON.stringify(e.value)),t.value=-1}function a(i){if(i==="up"){if(t.value+1<e.value.length)return t.value++,e.value[t.value]}else if(i==="down"){if(t.value>0)return t.value--,e.value[t.value];if(t.value===0)return t.value=-1,n.value}}return{lastPrompt:n,currentIndex:t,addToHistory:s,navigateHistory:a}}const Fr=Object.assign({inheritAttrs:!1},{__name:"AutoGrowTextarea",props:{value:{type:String,required:!0},sharedClass:{type:String,default:void 0}},emits:["input","mounted"],setup(r,{emit:e}){const n=r,t=w(),s=W({get(){return n.value},set(a){e("input",a)}});return lt(()=>{e("mounted",t.value)}),{__sfc:!0,props:n,emit:e,textarea:t,text:s}}});var Vr=function(){var e=this,n=e._self._c,t=e._self._setupProxy;return n("div",{staticClass:"kai-grid"},[n("textarea",e._b({directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],ref:"textarea",staticClass:"stack-layer kai-resize-none kai-overflow-hidden",class:e.sharedClass,domProps:{value:t.text},on:{input:function(s){s.target.composing||(t.text=s.target.value)}}},"textarea",e.$attrs,!1)),e._v(" "),n("div",{staticClass:"stack-layer kai-invisible kai-whitespace-pre-wrap",class:e.sharedClass,domProps:{textContent:e._s(`${e.value} `)}})])},Kr=[],Wr=Ee(Fr,Vr,Kr,!1,null,"a814ce2d");const Hr=Wr.exports,qr={__name:"Prompt",props:{selection:{type:String,default:""}},emits:["cancel","close","input","submit","success"],setup(r,{emit:e}){const n=Ie(),t=O(),{lastPrompt:s,currentIndex:a,addToHistory:i,navigateHistory:o}=Ur(),l=w(),c=w([]),f=w("append"),y=w(""),g=w(!1),x=w();xr(l,"keydown",A=>{if(A.metaKey&&A.key==="Enter"&&C(),A.key==="ArrowUp"&&A.target.selectionStart===0||A.key==="ArrowDown"&&A.target.selectionStart===A.target.value.length){A.preventDefault(),A.key==="ArrowUp"&&a.value===-1&&(s.value=y.value);const Z=o(A.key==="ArrowUp"?"up":"down");Z!==void 0&&(y.value=Z)}}),(async()=>{const A=await oe();x.value=A.licenseStatus})();function C(){i(y.value),e("submit",{prompt:y.value,files:c.value,append:f.value==="append"})}async function $(){const A=await Dt();c.value=[...c.value,...A]}return{__sfc:!0,emit:e,_isKirby5:n,panel:t,lastPrompt:s,currentIndex:a,addToHistory:i,navigateHistory:o,textarea:l,files:c,insertOption:f,prompt:y,isBadgeHovered:g,licenseStatus:x,submit:C,pickFiles:$,LicensingButtonGroup:dt,AutoGrowTextarea:Hr}}};var Gr=function(){var e=this,n=e._self._c,t=e._self._setupProxy;return n("k-dialog",{staticClass:"k-copilot-prompt-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"medium"},on:{cancel:function(s){return t.emit("cancel")}}},[n("div",{staticClass:"kai-relative kai-rounded-[var(--rounded)] kai-pb-[calc(1rem+32px)] focus-within:kai-outline focus-within:kai-outline-[2px] focus-within:kai-outline-[var(--color-focus,currentColor)]"},[n(t.AutoGrowTextarea,{attrs:{value:t.prompt,"shared-class":"kai-p-2 kai-leading-[1.5] focus:kai-outline-none",placeholder:t.panel.t(e.selection?"johannschopplich.copilot.prompt.dialogContextPlaceholder":"johannschopplich.copilot.prompt.dialogPlaceholder")},on:{input:function(s){t.prompt=s},mounted:function(s){t.textarea=s}}}),n("div",{staticClass:"kai-absolute kai-inset-x-px kai-bottom-px kai-p-2"},[n("div",{staticClass:"kai-flex kai-items-center kai-justify-between"},[n("div",{staticClass:"kai-relative"},[n("k-button",{attrs:{theme:"empty",icon:"attachment"},on:{click:function(s){return t.pickFiles()}}}),t.files.length>0?n("span",{staticClass:"kai-cursor-pointer",class:[t._isKirby5?"k-button-badge kai-top-[-2px]":"k-tabs-badge kai-top-[-6px]"],attrs:{"data-theme":t.isBadgeHovered?"negative":"notice"},on:{mouseenter:function(s){t.isBadgeHovered=!0},mouseleave:function(s){t.isBadgeHovered=!1},click:function(s){t.files=[],t.isBadgeHovered=!1}}},[e._v(" "+e._s(t.isBadgeHovered?t.panel.t("johannschopplich.copilot.delete"):t.files.length)+" ")]):e._e()],1),n("div",{staticClass:"kai-flex kai-gap-2"},[e.selection?n("k-select-input",{staticClass:"kai-underline kai-underline-offset-[var(--link-underline-offset)]",attrs:{options:[{value:"append",text:t.panel.t("johannschopplich.copilot.append")},{value:"replace",text:t.panel.t("johannschopplich.copilot.replace")}],empty:!1,value:t.insertOption},on:{input:function(s){t.insertOption=s}}}):e._e(),n("k-button",{attrs:{theme:"notice-icon",variant:"filled",icon:"sparkling"},on:{click:function(s){return t.submit()}}},[e._v(" "+e._s(t.panel.t("johannschopplich.copilot.generate"))+" ")])],1)])]),t.licenseStatus!==void 0?n(t.LicensingButtonGroup,{staticClass:"kai-absolute kai-right-0 kai-top-[calc(-0.25rem-24px)]",attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":t.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}}):e._e()],1)])},Yr=[],Jr=Ee(qr,Gr,Yr,!1,null,null);const Xr=Jr.exports,Qr={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};var Gt="vercel.ai.error",es=Symbol.for(Gt),Yt,ts=class cn extends Error{constructor({name:e,message:n,cause:t}){super(n),this[Yt]=!0,this.name=e,this.cause=t}static isInstance(e){return cn.hasMarker(e,Gt)}static hasMarker(e,n){const t=Symbol.for(n);return e!=null&&typeof e=="object"&&t in e&&typeof e[t]=="boolean"&&e[t]===!0}};Yt=es;var Jt=ts,Xt="AI_InvalidArgumentError",Qt=`vercel.ai.error.${Xt}`,ns=Symbol.for(Qt),en,rs=class extends Jt{constructor({message:r,cause:e,argument:n}){super({name:Xt,message:r,cause:e}),this[en]=!0,this.argument=n}static isInstance(r){return Jt.hasMarker(r,Qt)}};en=ns,new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var ss=({prefix:r,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:t="-"}={})=>{const s=()=>{const a=n.length,i=new Array(e);for(let o=0;o<e;o++)i[o]=n[Math.random()*a|0];return i.join("")};if(r==null)return s;if(n.includes(t))throw new rs({argument:"separator",message:`The separator "${t}" must not be part of the alphabet "${n}".`});return()=>`${r}${t}${s()}`};ss();function as(r){return r instanceof Error&&(r.name==="AbortError"||r.name==="TimeoutError")}const tn={...Qr},is=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:tn,setup(r){const e=r,n=Ie(),t=O(),{t:s}=un(),{currentContent:a,update:i}=ot(),o={writer:"HTML",textarea:"markdown",markdown:"markdown"},l=w(),c=w(),f=w(),y=w(),g=w(),x=w(),C=w(),$=w(),A=w(),Z=w(),ne=w(),me=w(!1),N=w(!1),ge=w(!1),V=w(),J=w(),D=w(),st=w([]),ye=w([]),sn=w();let X,K;const an=W(()=>!N.value&&D.value!==void 0);Fe(J,P=>{me.value&&g.value&&(P&&P!==f.value?localStorage.setItem(`${X}$prompt`,P):(!P||P===f.value)&&localStorage.removeItem(`${X}$prompt`))}),Fe(ge,P=>{me.value&&g.value&&(P?localStorage.setItem(`${X}$open`,"true"):localStorage.removeItem(`${X}$open`))}),(async()=>{var Ce;const{load:P}=dn(),[re,I]=await Promise.all([oe(),P({parent:e.parent,name:e.name})]);if(l.value=s(I.label)||t.t("johannschopplich.copilot.label"),c.value=I.field??void 0,f.value=I.userPrompt??void 0,y.value=I.systemPrompt||re.config.systemPrompt||ht,g.value=I.storage,I.editable===!0&&st.value.push("edit"),I.files===!0&&st.value.push("files"),x.value=I.theme||"notice-icon",C.value=I.size||"md",$.value=jn.indexOf(re.config.logLevel??I.logLevel),Z.value=I.help?s(I.help):void 0,ne.value=re.config,sn.value=re.licenseStatus,I.files==="auto"&&I.modelFile){A.value=I.modelFile;const{mime:Ae,url:Ze}=I.modelFile;Ke.includes(Ae)&&fetch(Ze).then(L=>L.blob()).then(L=>{ye.value=[L]})}g.value&&((Ce=c.value)!=null&&Ce.name)&&(X=Ht(t.view.path,c.value.name.toLowerCase()),J.value=localStorage.getItem(`${X}$prompt`)||f.value||"",ge.value=localStorage.getItem(`${X}$open`)==="true"||I.open,vn(()=>{V.value&&ge.value&&(V.value.open=!0)})),t.events.on("view.save",at),me.value=!0})(),_n(()=>{t.events.off("view.save",at)});async function ys(){if(!J.value){t.notification.error(t.t("johannschopplich.copilot.prompt.empty"));return}t.isLoading=!0,N.value=!0,D.value=a.value[c.value.name.toLowerCase()],K=new AbortController;const{getZodSchema:P,normalizeBlock:re}=Zt(),{getZodSchema:I,normalizeLayout:Ce}=Ir();let Ae="",Ze=[];try{if(c.value.type==="layout"||c.value.type==="blocks"){const L=await(c.value.type==="layout"?I:P)(c.value),{partialObjectStream:Te,object:it}=await Vn({userPrompt:J.value,systemPrompt:y.value,schema:L,output:"array",files:ye.value,logLevel:$.value,abortSignal:K.signal});for await(const se of Te)!se||!Array.isArray(se)||await i({[c.value.name.toLowerCase()]:[...D.value,...se.map(c.value.type==="layout"?Ce:re)]},!1);Ze=await it}else{const{textStream:L}=await mt({userPrompt:[`<response_format>
${on(c.value.type)}
</response_format>`,J.value].join(`

`),systemPrompt:y.value,files:ye.value,logLevel:$.value,abortSignal:K.signal});for await(const Te of L)Ae+=Te,await i({[c.value.name.toLowerCase()]:D.value+Ae},!1)}}catch(L){if(K=void 0,t.isLoading=!1,N.value=!1,as(L))return;const{AISDKError:Te,APICallError:it}=await ie("ai");if(L instanceof $e||Te.isInstance(L)||it.isInstance(L)){let se=L.message;se.includes("levels of nesting exceeds limit")&&(se=`The ${c.value.type} generation for the "${c.value.name}" field exceeds OpenAI's architectural constraints for nested data structures. This is a known limitation of OpenAI's API. Please use Google Gemini or Anthropic Claude instead, which support complex schemas.`),console.error(L),t.notification.error(se);return}console.error(L),t.notification.error(t.t("johannschopplich.copilot.generator.error"));return}i({[c.value.name.toLowerCase()]:c.value.type==="layout"||c.value.type==="blocks"?[...D.value,...(Ze??[]).map(c.value.type==="layout"?Ce:re)]:D.value+Ae}),K=void 0,t.isLoading=!1,N.value=!1,t.notification.success({icon:"sparkling",message:t.t("johannschopplich.copilot.generator.success")})}function vs(){K==null||K.abort()}function _s(){i({[c.value.name.toLowerCase()]:D.value}),D.value=void 0}async function bs(){const P=await Dt();ye.value=[...ye.value,...P]}function at(){an.value&&(D.value=void 0)}function on(P){return o[P]||"text"}return{__sfc:!0,propsDefinition:tn,props:e,_isKirby5:n,panel:t,t:s,currentContent:a,updateContent:i,RESPONSE_FORMAT_PER_FIELD:o,label:l,field:c,userPrompt:f,systemPrompt:y,storage:g,theme:x,size:C,logLevel:$,modelFile:A,help:Z,config:ne,isInitialized:me,isGenerating:N,isDetailsOpen:ge,detailsElement:V,currentPrompt:J,currentFieldContent:D,permissions:st,files:ye,licenseStatus:sn,storageKey:X,abortController:K,canUndo:an,generate:ys,abort:vs,undo:_s,pickFiles:bs,onModelSave:at,fieldTypeToResponseFormat:on,LicensingButtonGroup:dt,SUPPORTED_PROVIDERS:ft,SUPPORTED_VISION_MIME_TYPES:Ke}}});var os=function(){var s,a,i,o;var e=this,n=e._self._c,t=e._self._setupProxy;return t.isInitialized?n("k-section",{attrs:{label:t.label}},[t.licenseStatus!==void 0?n("template",{slot:"options"},[n(t.LicensingButtonGroup,{attrs:{label:"Kirby Copilot","api-namespace":"__copilot__","license-status":t.licenseStatus,"pricing-url":"https://kirby.tools/copilot/buy"}})],1):e._e(),!t.config.provider||!t.SUPPORTED_PROVIDERS.includes(t.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Unsupported provider "),n("code",[e._v(e._s(t.config.provider))]),e._v(" in the "),n("code",[e._v("johannschopplich.copilot.provider")]),e._v(" global configuration. ")])],1):(a=(s=t.config.providers)==null?void 0:s[t.config.provider])!=null&&a.apiKey?(o=(i=t.config.providers)==null?void 0:i[t.config.provider])!=null&&o.model?!t.field||!(t.field.name.toLowerCase()in t.currentContent)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" The "),n("code",[e._v(e._s(t.field.name))]),e._v(" field does not exist in the current model. ")])],1):!t.permissions.includes("edit")&&!t.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" If the user prompt cannot be edited by the user, a default "),n("code",[e._v("userPrompt")]),e._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:t.isGenerating?"loader":"sparkling",text:t.panel.t("johannschopplich.copilot.generate"),theme:t.theme,variant:"filled",size:t.size,disabled:t.isGenerating},on:{click:function(l){return t.generate()}}}),t.isGenerating?n("k-button",{attrs:{icon:"cancel",text:t.panel.t("johannschopplich.copilot.stop"),theme:"notice",variant:"filled",size:t.size},on:{click:function(l){return t.abort()}}}):e._e(),t.canUndo?n("k-button",{attrs:{icon:"undo",text:t.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:t.size},on:{click:function(l){return t.undo()}}}):e._e()],1),t.permissions.length>0?n("details",{ref:"detailsElement",on:{toggle:function(l){t.isDetailsOpen=l.target.open}}},[n("summary",[e._v(" "+e._s([...t.permissions.includes("edit")?[t.panel.t("johannschopplich.copilot.prompt.label")]:[],...t.permissions.includes("files")?[t.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[t.permissions.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:t.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{value:t.currentPrompt,placeholder:t.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},on:{input:function(l){t.currentPrompt=l}}}),n("k-button",{directives:[{name:"show",rawName:"v-show",value:t.userPrompt&&t.currentPrompt!==t.userPrompt,expression:"userPrompt && currentPrompt !== userPrompt"}],attrs:{icon:"undo",text:"Reset",variant:"dimmed",size:"xs"},on:{click:function(l){t.currentPrompt=t.userPrompt}}})],1):e._e(),t.permissions.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{staticClass:"!kai-rounded-[var(--button-rounded)]",attrs:{icon:"attachment",text:t.panel.t("johannschopplich.copilot.files.select"),variant:"filled",badge:t._isKirby5&&t.files.length>0?{theme:"notice",text:t.files.length}:void 0,size:"sm"},on:{click:function(l){return t.pickFiles()}}}),t.files.length>0?n("k-button",{attrs:{text:t.panel.t("johannschopplich.copilot.delete"),variant:"dimmed",size:"sm"},on:{click:function(l){t.files=[]}}}):e._e()],1):t.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[e._v(" "+e._s(t.panel.t(`johannschopplich.copilot.context.file.${t.SUPPORTED_VISION_MIME_TYPES.includes(t.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):e._e()],1)]):e._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Missing "),n("code",[e._v("model")]),e._v(" property in the "),n("code",[e._v(e._s(`johannschopplich.copilot.providers.${t.config.provider}`))]),e._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[e._v(" Missing "),n("code",[e._v("apiKey")]),e._v(" property in the "),n("code",[e._v(e._s(`johannschopplich.copilot.providers.${t.config.provider}`))]),e._v(" global configuration. ")])],1),t.help?n("footer",{staticClass:"kai-mt-[var(--spacing-2)]"},[n("k-text",{staticClass:"k-help",attrs:{html:t.help}})],1):e._e()],2):e._e()},cs=[],ls=Ee(is,os,cs,!1,null,null);const us=ls.exports,ds={};async function nn(r,{appendText:e,replaceText:n,responseFormat:t="text"}){const s=O(),a=new AbortController,i=g=>{g.key==="Escape"&&a.abort()},o=await fs({selection:r});if(!o)return;const{prompt:l,files:c}=o;if(!l)return;s.isLoading=!0,document.addEventListener("keydown",i),await oe();const{AISDKError:f,APICallError:y}=await ie("ai");try{const{textStream:g}=await mt({userPrompt:[`<response_format>
${t}
</response_format>`,r&&`<selected_text>
${r}
</selected_text>`,l].filter(Boolean).join(`

`),systemPrompt:ht,files:c,abortSignal:a.signal});let x=!0;for await(let C of g)o.append?(x&&(C=r?` ${C}`:C,x=!1),e(C)):n(C);s.notification.success({icon:"sparkling",message:s.t("johannschopplich.copilot.generator.success")})}catch(g){if(g instanceof Error&&(g.name==="AbortError"||g.name==="TimeoutError"))return;if(g instanceof $e||f.isInstance(g)||y.isInstance(g)){console.error(g),s.notification.error(g.message);return}console.error(g),s.notification.error(s.t("johannschopplich.copilot.generator.error"))}finally{s.isLoading=!1,document.removeEventListener("keydown",i)}}async function fs(r={}){return new Promise(e=>{const n=O();let t;n.dialog.open({component:"k-copilot-prompt-dialog",props:r,on:{close:()=>{setTimeout(()=>{e(t)},25)},submit:s=>{t=s,n.dialog.close()}}})})}const hs={copilot:{icon:"sparkling",label:"Copilot Prompt",click(){let r="";this.command("insert",(s,a)=>(r=a,a));let e=!0;nn(r,{responseFormat:"markdown",appendText:s=>{this.command("insert",(a,i)=>e?(e=!1,i+s):s)},replaceText:s=>{this.command("insert",()=>s)}})},shortcut:"."}},rn={"***":["bold","italic"],"**":["bold"],"*":["italic"],"`":["code"]},ps={copilot:{get button(){return{icon:"sparkling",label:"Copilot Prompt"}},commands(r){return()=>this._openPromptDialog(r)},keys(r){return{"Mod-.":()=>this._openPromptDialog(r)}},get name(){return"copilot"},_insertText(r,e,n,t,s){let a=n;const i=e.split(/(\n\n?|\*{1,3}|`{1,3})/);for(const o of i)if(o===`

`)r=r.replaceWith(a,a,this.editor.options.inline?[s.schema.nodes.hardBreak.create(),s.schema.nodes.hardBreak.create()]:s.schema.nodes.paragraph.create()),a+=2;else if(o===`
`)r=r.replaceWith(a,a,s.schema.nodes.hardBreak.create()),a+=1;else if(o.length>0){if(o in rn&&!t.lastSegment.includes(o)||[...t.activeMarks].some(l=>l.type.name===o)){for(const l of rn[o])r=ms(r,l,t,s);t.lastSegment=o;continue}r=r.insertText(o,a),a+=o.length,t.lastSegment=o}return{tr:r,newPosition:a}},_openPromptDialog(r){const{state:e}=this.editor,{from:n,to:t}=e.selection,s=e.doc.textBetween(n,t),a={activeMarks:new Set,lastSegment:""};let i,o=!1;nn(s,{responseFormat:"text",replaceText:f=>{const{state:y,view:g}=this.editor;let x=y.tr;if(!o){const A=gs(y),{from:Z,to:ne}=y.selection;x=x.deleteRange(Z,ne),i=A?1:Z,o=!0}const{tr:C,newPosition:$}=this._insertText(x,f,i,a,r);i=$,g.dispatch(C)},appendText:f=>{const{state:y,view:g}=this.editor;i=y.selection.to;const{tr:x,newPosition:C}=this._insertText(y.tr,f,i,a,r);i=C,g.dispatch(x)}})}}};function ms(r,e,n,{schema:t}){if([...n.activeMarks].some(s=>s.type.name===e)){n.activeMarks.delete(e);const s=[...n.activeMarks].filter(a=>a.type.name!==e);return r.setStoredMarks(s)}else{const s=t.marks[e].create();return n.activeMarks.add(s),r.addStoredMark(s)}}function gs(r){const e=r.doc.content.size,{from:n,to:t}=r.selection;return n===0&&t===e}window.panel.plugin("johannschopplich/copilot",{components:{"k-copilot-prompt-dialog":Xr},sections:{copilot:us},fields:{},textareaButtons:hs,writerMarks:ps,icons:ds})})();
